var J0=Object.defineProperty;var L0=a=>{throw TypeError(a)};var e2=(a,e,t)=>e in a?J0(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t;var A0=(a,e,t)=>e2(a,typeof e!="symbol"?e+"":e,t),w0=(a,e,t)=>e.has(a)||L0("Cannot "+t);var st=(a,e,t)=>(w0(a,e,"read from private field"),t?t.call(a):e.get(a)),Rt=(a,e,t)=>e.has(a)?L0("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t),Ot=(a,e,t,i)=>(w0(a,e,"write to private field"),i?i.call(a,t):e.set(a,t),t),Yt=(a,e,t)=>(w0(a,e,"access private method"),t);import{r as r$1,x,E}from"./lit-element.L04JKUcP.js";import{P as PointerInteraction,V as VectorLayer,a as VectorSource,n as noModifierKeys,b as always,s as shiftKeyOnly,I as InteractionProperty,M as MapBrowserEventType,c as MapBrowserEvent,d as never,e as createEditingStyle,p as primaryAction,f as altKeyOnly,g as singleClick,R as RBush,h as VectorEventType,i as READ_FEATURES_OPTIONS,K as KML,T as TopoJSON,r as register,j as fromEPSGCode,k as MouseWheelZoom,D as DragPan,l as platformModifierKeyOnly,C as CLASS_SELECTABLE,m as removeChildren,o as MapEventType,q as outerWidth,t as outerHeight,u as ImageSource,v as defaultImageLoadFunction,w as calculateSourceResolution,x as getFeatureInfoUrl,y as getLegendUrl,z as createLoader,A as decode,B as VectorTileLayer,E as TileLayer,F as ImageLayer,X as XYZ,W as WMTS,G as VectorTile,H as TileWMS,J as TileSource,O as OSM,L as MVT,N as Interaction,S as Style,Q as Stroke,U as WMTSTileGrid,Y as createXYZ,Z as Control,_ as CLASS_UNSELECTABLE,$ as CLASS_CONTROL,a0 as replaceNode,a1 as MapProperty,a2 as CLASS_UNSUPPORTED,a3 as EventType$1,a4 as easeOut,a5 as Map$1,a6 as CLASS_COLLAPSED,a7 as View,a8 as ViewProperty,a9 as Fill,aa as Attribution,ab as Rotate,ac as Zoom,ad as defaults}from"./WMTS.B-JsNFwq.js";import{Q as createOrUpdate,I as intersects,F as forEachCorner,x as squaredDistance,t as toFixed,d as clamp,R as boundingExtent,S as getBottomLeft,T as getBottomRight,U as getTopRight,V as getTopLeft,W as FALSE,X as TRUE,E as EventType,b as BaseEvent,C as createOrUpdateFromCoordinate,g as getUid,Y as buffer,Z as equals$1,B as BaseObject,u as unlistenByKey,l as listen,_ as containsExtent,N as extend,L as isEmpty,n as createEmpty,$ as getArea$1,h as getWidth,a0 as stopPropagation,O as ObjectEventType,a1 as equals$2,a2 as scaleFromCenter,a3 as listenOnce,i as toRadians}from"./extent.B6zYA2nd.js";import{S as SimpleGeometry,g as deflateCoordinate,r as rotate,h as distance,L as LineString,b as MultiLineString,P as Polygon,M as MultiPolygon,G as GeometryCollection,i as fromUserCoordinate,s as squaredDistance$1,a as Feature,d as Point,j as getStrideForLayout,c as MultiPoint,k as equals,l as closestOnSegment,m as toUserCoordinate,n as fromUserExtent,o as toUserExtent,p as squaredDistanceToSegment,q as getLength,u as getArea,e as GeoJSON,v as get,w as transform$1,x as transformExtent$1,y as fromLonLat,R as RenderFeature,z as getPointResolution,A as METERS_PER_UNIT,B as fromExtent,C as getTransformFromProjections,D as identityTransform,E as wrapX,H as circular,I as equivalent}from"./GeoJSON.Bn398gYN.js";import{p as proj4}from"./index.Du0sVlOV.js";import{g as getDefaultExportFromCjs}from"./commonjsHelpers.BosuxZz1.js";import{C as Collection,a as CollectionEventType,L as LayerGroup}from"./Group.ovD7bfEG.js";const olCss=':root,:host{--ol-background-color: white;--ol-accent-background-color: #F5F5F5;--ol-subtle-background-color: rgba(128, 128, 128, .25);--ol-partial-background-color: rgba(255, 255, 255, .75);--ol-foreground-color: #333333;--ol-subtle-foreground-color: #666666;--ol-brand-color: #00AAFF}.ol-box{box-sizing:border-box;border-radius:2px;border:1.5px solid var(--ol-background-color);background-color:var(--ol-partial-background-color)}.ol-mouse-position{top:8px;right:8px;position:absolute}.ol-scale-line{background:var(--ol-partial-background-color);border-radius:4px;bottom:8px;left:8px;padding:2px;position:absolute}.ol-scale-line-inner{border:1px solid var(--ol-subtle-foreground-color);border-top:none;color:var(--ol-foreground-color);font-size:10px;text-align:center;margin:1px;will-change:contents,width;transition:all .25s}.ol-scale-bar{position:absolute;bottom:8px;left:8px}.ol-scale-bar-inner{display:flex}.ol-scale-step-marker{width:1px;height:15px;background-color:var(--ol-foreground-color);float:right;z-index:10}.ol-scale-step-text{position:absolute;bottom:-5px;font-size:10px;z-index:11;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-text{position:absolute;font-size:12px;text-align:center;bottom:25px;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-singlebar{position:relative;height:10px;z-index:9;box-sizing:border-box;border:1px solid var(--ol-foreground-color)}.ol-scale-singlebar-even{background-color:var(--ol-subtle-foreground-color)}.ol-scale-singlebar-odd{background-color:var(--ol-background-color)}.ol-unsupported{display:none}.ol-viewport,.ol-unselectable{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}.ol-viewport canvas{all:unset;overflow:hidden}.ol-viewport{touch-action:pan-x pan-y}.ol-selectable{-webkit-touch-callout:default;-webkit-user-select:text;-moz-user-select:text;user-select:text}.ol-grabbing{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.ol-grab{cursor:move;cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.ol-control{position:absolute;background-color:var(--ol-subtle-background-color);border-radius:4px}.ol-zoom{top:.5em;left:.5em}.ol-rotate{top:.5em;right:.5em;transition:opacity .25s linear,visibility 0s linear}.ol-rotate.ol-hidden{opacity:0;visibility:hidden;transition:opacity .25s linear,visibility 0s linear .25s}.ol-zoom-extent{top:4.643em;left:.5em}.ol-full-screen{right:.5em;top:.5em}.ol-control button{display:block;margin:1px;padding:0;color:var(--ol-subtle-foreground-color);font-weight:700;text-decoration:none;font-size:inherit;text-align:center;height:1.375em;width:1.375em;line-height:.4em;background-color:var(--ol-background-color);border:none;border-radius:2px}.ol-control button::-moz-focus-inner{border:none;padding:0}.ol-zoom-extent button{line-height:1.4em}.ol-compass{display:block;font-weight:400;will-change:transform}.ol-touch .ol-control button{font-size:1.5em}.ol-touch .ol-zoom-extent{top:5.5em}.ol-control button:hover,.ol-control button:focus{text-decoration:none;outline:1px solid var(--ol-subtle-foreground-color);color:var(--ol-foreground-color)}.ol-zoom .ol-zoom-in{border-radius:2px 2px 0 0}.ol-zoom .ol-zoom-out{border-radius:0 0 2px 2px}.ol-attribution{text-align:right;bottom:.5em;right:.5em;max-width:calc(100% - 1.3em);display:flex;flex-flow:row-reverse;align-items:center}.ol-attribution a{color:var(--ol-subtle-foreground-color);text-decoration:none}.ol-attribution ul{margin:0;padding:1px .5em;color:var(--ol-foreground-color);text-shadow:0 0 2px var(--ol-background-color);font-size:12px}.ol-attribution li{display:inline;list-style:none}.ol-attribution li:not(:last-child):after{content:" "}.ol-attribution img{max-height:2em;max-width:inherit;vertical-align:middle}.ol-attribution button{flex-shrink:0}.ol-attribution.ol-collapsed ul{display:none}.ol-attribution:not(.ol-collapsed){background:var(--ol-partial-background-color)}.ol-attribution.ol-uncollapsible{bottom:0;right:0;border-radius:4px 0 0}.ol-attribution.ol-uncollapsible img{margin-top:-.2em;max-height:1.6em}.ol-attribution.ol-uncollapsible button{display:none}.ol-zoomslider{top:4.5em;left:.5em;height:200px}.ol-zoomslider button{position:relative;height:10px}.ol-touch .ol-zoomslider{top:5.5em}.ol-overviewmap{left:.5em;bottom:.5em}.ol-overviewmap.ol-uncollapsible{bottom:0;left:0;border-radius:0 4px 0 0}.ol-overviewmap .ol-overviewmap-map,.ol-overviewmap button{display:block}.ol-overviewmap .ol-overviewmap-map{border:1px solid var(--ol-subtle-foreground-color);height:150px;width:150px}.ol-overviewmap:not(.ol-collapsed) button{bottom:0;left:0;position:absolute}.ol-overviewmap.ol-collapsed .ol-overviewmap-map,.ol-overviewmap.ol-uncollapsible button{display:none}.ol-overviewmap:not(.ol-collapsed){background:var(--ol-subtle-background-color)}.ol-overviewmap-box{border:1.5px dotted var(--ol-subtle-foreground-color)}.ol-overviewmap .ol-overviewmap-box:hover{cursor:move}.ol-overviewmap .ol-viewport:hover{cursor:pointer}';class Circle extends SimpleGeometry{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new Circle(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,s){const n=this.flatCoordinates,o=e-n[0],l=t-n[1],h=o*o+l*l;if(h<s){if(h===0)for(let c=0;c<this.stride;++c)i[c]=n[c];else{const c=this.getRadius()/Math.sqrt(h);i[0]=n[0]+c*o,i[1]=n[1]+c*l;for(let d=2;d<this.stride;++d)i[d]=n[d]}return i.length=this.stride,h}return s}containsXY(e,t){const i=this.flatCoordinates,s=e-i[0],n=t-i[1];return s*s+n*n<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return createOrUpdate(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(intersects(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:forEachCorner(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],s=e.slice();s[t]=s[0]+i;for(let n=1;n<t;++n)s[t+n]=e[n];this.setFlatCoordinates(this.layout,s),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const s=this.flatCoordinates;let n=deflateCoordinate(s,0,e,this.stride);s[n++]=s[0]+t;for(let o=1,l=this.stride;o<l;++o)s[n++]=s[o];s.length=n,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),s=this.getStride();this.setCenter(rotate(i,0,i.length,s,e,t,i)),this.changed()}}Circle.prototype.transform;function getCoordinate(a,e){const t=a.length;return e<0?a[e+t]:e>=t?a[e-t]:a[e]}function interpolateCoordinate(a,e){const t=a.length;let i=Math.floor(e);const s=e-i;i>=t?i-=t:i<0&&(i+=t);let n=i+1;n>=t&&(n-=t);const o=a[i],l=o[0],h=o[1],c=a[n],d=c[0]-l,u=c[1]-h;return[l+d*s,h+u*s]}const sharedUpdateInfo={index:-1,endIndex:NaN,closestTargetDistance:1/0};function getTraceTargetUpdate(a,e,t,i){const s=a[0],n=a[1];let o=1/0,l=-1,h=NaN;for(let u=0;u<e.targets.length;++u){const f=e.targets[u],_=f.coordinates;let g=1/0,v;for(let p=0;p<_.length-1;++p){const y=_[p],b=_[p+1],C=getPointSegmentRelationship(s,n,y,b);C.squaredDistance<g&&(g=C.squaredDistance,v=p+C.along)}g<o&&(o=g,f.ring&&e.targetIndex===u&&(f.endIndex>f.startIndex?v<f.startIndex&&(v+=_.length):f.endIndex<f.startIndex&&v>f.startIndex&&(v-=_.length)),h=v,l=u)}const c=e.targets[l];let d=c.ring;if(e.targetIndex===l&&d){const u=interpolateCoordinate(c.coordinates,h),f=t.getPixelFromCoordinate(u),_=t.getPixelFromCoordinate(e.startCoord);distance(f,_)>i&&(d=!1)}if(d){const u=c.coordinates,f=u.length,_=c.startIndex,g=h;if(_<g){const v=getCumulativeSquaredDistance(u,_,g);getCumulativeSquaredDistance(u,_,g-f)<v&&(h-=f)}else{const v=getCumulativeSquaredDistance(u,_,g);getCumulativeSquaredDistance(u,_,g+f)<v&&(h+=f)}}return sharedUpdateInfo.index=l,sharedUpdateInfo.endIndex=h,sharedUpdateInfo.closestTargetDistance=o,sharedUpdateInfo}function getTraceTargets(a,e){const t=[];for(let i=0;i<e.length;++i){const n=e[i].getGeometry();appendGeometryTraceTargets(a,n,t)}return t}function appendGeometryTraceTargets(a,e,t){if(e instanceof LineString){appendTraceTarget(a,e.getCoordinates(),!1,t);return}if(e instanceof MultiLineString){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s)appendTraceTarget(a,i[s],!1,t);return}if(e instanceof Polygon){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s)appendTraceTarget(a,i[s],!0,t);return}if(e instanceof MultiPolygon){const i=e.getCoordinates();for(let s=0,n=i.length;s<n;++s){const o=i[s];for(let l=0,h=o.length;l<h;++l)appendTraceTarget(a,o[l],!0,t)}return}if(e instanceof GeometryCollection){const i=e.getGeometries();for(let s=0;s<i.length;++s)appendGeometryTraceTargets(a,i[s],t);return}}function appendTraceTarget(a,e,t,i){const s=a[0],n=a[1];for(let o=0,l=e.length-1;o<l;++o){const h=e[o],c=e[o+1],d=getPointSegmentRelationship(s,n,h,c);if(d.squaredDistance===0){const u=o+d.along;i.push({coordinates:e,ring:t,startIndex:u,endIndex:u});return}}}function getSquaredDistance(a,e){return squaredDistance(a[0],a[1],e[0],e[1])}function getCumulativeSquaredDistance(a,e,t){let i,s;e<t?(i=e,s=t):(i=t,s=e);const n=Math.ceil(i),o=Math.floor(s);if(n>o){const h=interpolateCoordinate(a,i),c=interpolateCoordinate(a,s);return getSquaredDistance(h,c)}let l=0;if(i<n){const h=interpolateCoordinate(a,i),c=getCoordinate(a,n);l+=getSquaredDistance(h,c)}if(o<s){const h=getCoordinate(a,o),c=interpolateCoordinate(a,s);l+=getSquaredDistance(h,c)}for(let h=n;h<o-1;++h){const c=getCoordinate(a,h),d=getCoordinate(a,h+1);l+=getSquaredDistance(c,d)}return l}const sharedRel={along:0,squaredDistance:0};function getPointSegmentRelationship(a,e,t,i){const s=t[0],n=t[1],o=i[0],l=i[1],h=o-s,c=l-n;let d=0,u=s,f=n;return(h!==0||c!==0)&&(d=clamp(((a-s)*h+(e-n)*c)/(h*h+c*c),0,1),u+=h*d,f+=c*d),sharedRel.along=d,sharedRel.squaredDistance=toFixed(squaredDistance(a,e,u,f),10),sharedRel}const DrawEventType={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class DrawEvent extends BaseEvent{constructor(e,t){super(e),this.feature=t}}class Draw extends PointerInteraction{constructor(e){const t=e;t.stopDown||(t.stopDown=FALSE),super(t),this.on,this.once,this.un,this.options_=e,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=getMode(this.type_),this.stopClick_=!!e.stopClick,this.ignoreNextUpEvent_=!1,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:TRUE,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const s=this.mode_;if(s==="Circle")i=(n,o,l)=>{const h=o||new Circle([NaN,NaN]),c=fromUserCoordinate(n[0]),d=squaredDistance$1(c,fromUserCoordinate(n[n.length-1]));return h.setCenterAndRadius(c,Math.sqrt(d),this.geometryLayout_),h};else{let n;s==="Point"?n=Point:s==="LineString"?n=LineString:s==="Polygon"&&(n=Polygon),i=(o,l,h)=>(l?s==="Polygon"?o[0].length?l.setCoordinates([o[0].concat([o[0][0]])],this.geometryLayout_):l.setCoordinates([],this.geometryLayout_):l.setCoordinates(o,this.geometryLayout_):l=new n(o,this.geometryLayout_),l)}}this.geometryFunction_=i,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:getDefaultStyleFunction$1(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:noModifierKeys,this.freehandCondition_,e.freehand?this.freehandCondition_=always:this.freehandCondition_=e.freehandCondition?e.freehandCondition:shiftKeyOnly,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(InteractionProperty.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=always:t=e:t=never,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}setFreehand(e){this.freehand_=e,this.freehand_?this.freehandCondition_=always:this.freehandCondition_=this.options_&&this.options_.freehandCondition?this.options_.freehandCondition:shiftKeyOnly}getOverlay(){return this.overlay_}getFreehand(){return this.freehand_}handleEvent(e){e.originalEvent.type===EventType.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===MapBrowserEventType.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===MapBrowserEventType.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===MapBrowserEventType.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===MapBrowserEventType.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===MapBrowserEventType.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===MapBrowserEventType.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===MapBrowserEventType.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new MapBrowserEvent(MapBrowserEventType.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),s=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),n=boundingExtent([i,s]),o=this.traceSource_.getFeaturesInExtent(n);if(o.length===0)return;const l=getTraceTargets(e.coordinate,o);l.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:l,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,s=e.startIndex<=t;i===s?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const s=Math.ceil(e);let n=Math.floor(t);n===t&&(n-=1),i=n-s+1}else{const s=Math.floor(e);let n=Math.ceil(t);n===t&&(n+=1),i=s-n+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const s=[];if(t<i){const n=Math.ceil(t);let o=Math.floor(i);o===i&&(o-=1);for(let l=n;l<=o;++l)s.push(getCoordinate(e.coordinates,l))}else{const n=Math.floor(t);let o=Math.ceil(i);o===i&&(o+=1);for(let l=n;l>=o;--l)s.push(getCoordinate(e.coordinates,l))}s.length&&this.appendCoordinates(s)}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const l=e.map.getPixelFromCoordinate(t.startCoord);if(distance(l,e.pixel)<this.snapTolerance_)return}const i=getTraceTargetUpdate(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const h=t.targets[t.targetIndex];this.removeTracedCoordinates_(h.startIndex,h.endIndex)}const l=t.targets[i.index];this.addTracedCoordinates_(l,l.startIndex,i.endIndex)}else{const l=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(l,i.endIndex)}t.targetIndex=i.index;const s=t.targets[t.targetIndex];s.endIndex=i.endIndex;const n=interpolateCoordinate(s.coordinates,s.endIndex),o=this.getMap().getPixelFromCoordinate(n);e.coordinate=n,e.pixel=[Math.round(o[0]),Math.round(o[1])]}handleDragEvent(e){this.ignoreNextUpEvent_=!0,super.handleDragEvent(e)}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.ignoreNextUpEvent_||this.toggleTraceState_(e),this.shouldHandle_){const s=!this.finishCoordinate_;s&&this.startDrawing_(e.coordinate),!s&&this.freehand_?this.finishDrawing():!this.freehand_&&(!s||this.mode_==="Point")&&(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return this.ignoreNextUpEvent_=!1,!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,s=t[0]-i[0],n=t[1]-i[1],o=s*s+n*n;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let s=!1,n=[this.finishCoordinate_];const o=this.mode_;if(o==="Point")i=!0;else if(o==="Circle")i=this.sketchCoords_.length===2;else if(o==="LineString")s=!t&&this.sketchCoords_.length>this.minPoints_;else if(o==="Polygon"){const l=this.sketchCoords_;s=l[0].length>this.minPoints_,n=[l[0][0],l[0][l[0].length-2]],t?n=[l[0][0]]:n=[l[0][0],l[0][l[0].length-2]]}if(s){const l=this.getMap();for(let h=0,c=n.length;h<c;h++){const d=n[h],u=l.getPixelFromCoordinate(d),f=e[0]-u[0],_=e[1]-u[1],g=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(f*f+_*_)<=g,i){this.finishCoordinate_=d;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new Feature(new Point(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new Feature);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new LineString(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=getStrideForLayout(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new Feature(new LineString(this.sketchLineCoords_)));const s=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new Feature,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(s),this.updateSketchFeatures_(),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),s=t.getView().getProjection(),n=getStrideForLayout(this.geometryLayout_);let o,l;for(;e.length<n;)e.push(0);this.mode_==="Point"?l=this.sketchCoords_:this.mode_==="Polygon"?(o=this.sketchCoords_[0],l=o[o.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(o=this.sketchCoords_,l=o[o.length-1]),l[0]=e[0],l[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,s),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let s,n;const o=this.mode_;return o==="LineString"||o==="Circle"?(this.finishCoordinate_=e.slice(),n=this.sketchCoords_,n.length>=this.maxPoints_&&(this.freehand_?n.pop():s=!0),n.push(e.slice()),this.geometryFunction_(n,t,i)):o==="Polygon"&&(n=this.sketchCoords_[0],n.length>=this.maxPoints_&&(this.freehand_?n.pop():s=!0),n.push(e.slice()),s&&(this.finishCoordinate_=n[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),s?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),s=this.mode_;for(let n=0;n<e;++n){let o;if(s==="LineString"||s==="Circle"){if(o=this.sketchCoords_,o.splice(-2,1),o.length>=2){this.finishCoordinate_=o[o.length-2].slice();const l=this.finishCoordinate_.slice();o[o.length-1]=l,this.createOrUpdateSketchPoint_(l)}this.geometryFunction_(o,t,i),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(s==="Polygon"){o=this.sketchCoords_[0],o.splice(-2,1);const l=this.sketchLine_.getGeometry();if(o.length>=2){const h=o[o.length-2].slice();o[o.length-1]=h,this.createOrUpdateSketchPoint_(h)}l.setCoordinates(o),this.geometryFunction_(this.sketchCoords_,t,i)}if(o.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const i=e.getGeometry(),s=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,i,s)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,i,s),t=i.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new MultiPoint([t])):this.type_==="MultiLineString"?e.setGeometry(new MultiLineString([t])):this.type_==="MultiPolygon"&&e.setGeometry(new MultiPolygon([t])),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new DrawEvent(DrawEventType.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(e[0]);let s;if(t==="LineString"||t==="Circle")s=this.sketchCoords_;else if(t==="Polygon")s=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&s.shift(),s.pop();for(let o=0;o<e.length;o++)this.addToDrawing_(e[o]);const n=e[e.length-1];this.sketchFeature_=this.addToDrawing_(n),this.modifyDrawing_(n)}extend(e){const i=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=i.getCoordinates();const s=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=s.slice(),this.sketchCoords_.push(s.slice()),this.sketchPoint_=new Feature(new Point(s)),this.updateSketchFeatures_(),this.dispatchEvent(new DrawEvent(DrawEventType.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function getDefaultStyleFunction$1(){const a=createEditingStyle();return function(e,t){return a[e.getGeometry().getType()]}}function createBox(){return function(a,e,t){const i=boundingExtent([a[0],a[a.length-1]].map(function(n){return fromUserCoordinate(n)})),s=[[getBottomLeft(i),getBottomRight(i),getTopRight(i),getTopLeft(i),getBottomLeft(i)]];return e?e.setCoordinates(s):e=new Polygon(s),e}}function getMode(a){switch(a){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+a)}}const CIRCLE_CENTER_INDEX=0,CIRCLE_CIRCUMFERENCE_INDEX=1,tempExtent=[0,0,0,0],tempSegment=[],ModifyEventType={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};function getCoordinatesArray(a,e,t){let i;switch(e){case"LineString":i=a;break;case"MultiLineString":case"Polygon":i=a[t[0]];break;case"MultiPolygon":i=a[t[1]][t[0]];break}return i}class ModifyEvent extends BaseEvent{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class Modify extends PointerInteraction{constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:primaryAction,this.defaultDeleteCondition_=function(i){return altKeyOnly(i)&&singleClick(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:always,this.vertexFeature_=null,this.vertexSegments_=null,this.lastCoordinate_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new RBush,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new VectorLayer({source:new VectorSource({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:getDefaultStyleFunction(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.traceSource_=e.traceSource||e.source||null,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSegments_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new Collection(this.source_.getFeatures()),this.source_.addEventListener(VectorEventType.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(VectorEventType.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(CollectionEventType.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(CollectionEventType.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}setTrace(e){let t;e?e===!0?t=always:t=e:t=never,this.traceCondition_=t}addFeature_(e){const t=e.getGeometry();if(t){const s=this.SEGMENT_WRITERS_[t.getType()];s&&s(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(this.lastCoordinate_),e.addEventListener(EventType.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new Collection;const i=this.featuresBeingModified_.getArray();for(let s=0,n=t.length;s<n;++s){const o=t[s].feature;o&&!i.includes(o)&&this.featuresBeingModified_.push(o)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(EventType.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(s){e===s.feature&&i.push(s)});for(let s=i.length-1;s>=0;--s){const n=i[s];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===n&&this.dragSegments_.splice(o,1);t.remove(n)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),s={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),s)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let s=0,n=i.length;s<n;++s){const o=i[s],l={feature:e,geometry:t,depth:[s],index:s,segment:[o,o]};this.rBush_.insert(t.getExtent(),l)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let s=0,n=i.length-1;s<n;++s){const o=i.slice(s,s+2),l={feature:e,geometry:t,index:s,segment:o};this.rBush_.insert(boundingExtent(o),l)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let s=0,n=i.length;s<n;++s){const o=i[s];for(let l=0,h=o.length-1;l<h;++l){const c=o.slice(l,l+2),d={feature:e,geometry:t,depth:[s],index:l,segment:c};this.rBush_.insert(boundingExtent(c),d)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let s=0,n=i.length;s<n;++s){const o=i[s];for(let l=0,h=o.length-1;l<h;++l){const c=o.slice(l,l+2),d={feature:e,geometry:t,depth:[s],index:l,segment:c};this.rBush_.insert(boundingExtent(c),d)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let s=0,n=i.length;s<n;++s){const o=i[s];for(let l=0,h=o.length;l<h;++l){const c=o[l];for(let d=0,u=c.length-1;d<u;++d){const f=c.slice(d,d+2),_={feature:e,geometry:t,depth:[l,s],index:d,segment:f};this.rBush_.insert(boundingExtent(f),_)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),s={feature:e,geometry:t,index:CIRCLE_CENTER_INDEX,segment:[i,i]},n={feature:e,geometry:t,index:CIRCLE_CIRCUMFERENCE_INDEX,segment:[i,i]},o=[s,n];s.featureSegments=o,n.featureSegments=o,this.rBush_.insert(createOrUpdateFromCoordinate(i),s);let l=t;this.rBush_.insert(l.getExtent(),n)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let s=0;s<i.length;++s){const n=i[s],o=this.SEGMENT_WRITERS_[n.getType()];o(e,n)}}createOrUpdateVertexFeature_(e,t,i,s){let n=this.vertexFeature_;return n?n.getGeometry().setCoordinates(e):(n=new Feature(new Point(e)),this.vertexFeature_=n,this.overlay_.getSource().addFeature(n)),n.set("features",t),n.set("geometries",i),n.set("existing",s),n}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==MapBrowserEventType.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=MapBrowserEventType.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==MapBrowserEventType.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}findInsertVerticesAndUpdateDragSegments_(e){if(this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null,!this.vertexFeature_)return;this.getMap().getView().getProjection();const i=[],s=this.vertexFeature_.getGeometry().getCoordinates(),n=boundingExtent([s]),o=this.rBush_.getInExtent(n),l={};o.sort(compareIndexes);for(let h=0,c=o.length;h<c;++h){const d=o[h],u=d.segment;let f=getUid(d.geometry);const _=d.depth;if(_&&(f+="-"+_.join("-")),l[f]||(l[f]=new Array(2)),d.geometry.getType()==="Circle"&&d.index===CIRCLE_CIRCUMFERENCE_INDEX){const g=closestOnSegmentData(e,d);equals(g,s)&&!l[f][0]&&(this.dragSegments_.push([d,0]),l[f][0]=d);continue}if(equals(u[0],s)&&!l[f][0]){this.dragSegments_.push([d,0]),l[f][0]=d;continue}if(equals(u[1],s)&&!l[f][1]){if(l[f][0]&&l[f][0].index===0){let g=d.geometry.getCoordinates();switch(d.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":g=g[_[1]];case"Polygon":if(d.index!==g[_[0]].length-2)continue;break}}this.dragSegments_.push([d,1]),l[f][1]=d;continue}getUid(u)in this.vertexSegments_&&!l[f][0]&&!l[f][1]&&i.push(d)}return i}deactivateTrace_(){this.traceState_={active:!1}}updateTrace_(e){const t=this.traceState_;if(!t.active)return;if(t.targetIndex===-1){const n=e.map.getPixelFromCoordinate(t.startCoord);if(distance(n,e.pixel)<this.pixelTolerance_)return}const i=getTraceTargetUpdate(e.coordinate,t,e.map,this.pixelTolerance_);if(t.targetIndex===-1&&Math.sqrt(i.closestTargetDistance)/e.map.getView().getResolution()>this.pixelTolerance_)return;if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const o=t.targets[t.targetIndex];this.removeTracedCoordinates_(o.startIndex,o.endIndex)}else for(const o of this.traceSegments_){const l=o[0],h=l.geometry,c=o[1],d=h.getCoordinates();getCoordinatesArray(d,h.getType(),l.depth).splice(l.index+c,1),h.setCoordinates(d),c===0&&(l.index-=1)}const n=t.targets[i.index];this.addTracedCoordinates_(n,n.startIndex,i.endIndex)}else{const n=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(n,i.endIndex)}t.targetIndex=i.index;const s=t.targets[t.targetIndex];s.endIndex=i.endIndex}getTraceCandidates_(e){const t=this.getMap(),i=this.pixelTolerance_,s=t.getCoordinateFromPixel([e.pixel[0]-i,e.pixel[1]+i]),n=t.getCoordinateFromPixel([e.pixel[0]+i,e.pixel[1]-i]),o=boundingExtent([s,n]);return this.traceSource_.getFeaturesInExtent(o)}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_(),this.traceSegments_=null;return}const t=this.getTraceCandidates_(e);if(t.length===0)return;const i=getTraceTargets(e.coordinate,t);i.length&&(this.traceState_={active:!0,startCoord:e.coordinate.slice(),targets:i,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,s=e.startIndex<=t;i===s?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const s=Math.ceil(e);let n=Math.floor(t);n===t&&(n-=1),i=n-s+1}else{const s=Math.floor(e);let n=Math.ceil(t);n===t&&(n+=1),i=s-n+1}if(i>0)for(const s of this.traceSegments_){const n=s[0],o=n.geometry,l=s[1];let h=s[0].index+1;l===1&&(h-=i);const c=o.getCoordinates();getCoordinatesArray(c,o.getType(),n.depth).splice(h,i),o.setCoordinates(c),l===1&&(n.index-=i)}}addTracedCoordinates_(e,t,i){if(t===i)return;const s=[];if(t<i){const n=Math.ceil(t);let o=Math.floor(i);o===i&&(o-=1);for(let l=n;l<=o;++l)s.push(getCoordinate(e.coordinates,l))}else{const n=Math.floor(t);let o=Math.ceil(i);o===i&&(o+=1);for(let l=n;l>=o;--l)s.push(getCoordinate(e.coordinates,l))}if(s.length)for(const n of this.traceSegments_){const o=n[0],l=o.geometry,h=n[1],c=o.index+1;h===0&&s.reverse();const d=l.getCoordinates();getCoordinatesArray(d,l.getType(),o.depth).splice(c,0,...s),l.setCoordinates(d),h===1&&(o.index+=s.length)}}updateGeometry_(e,t){const i=t[0],s=i.depth;let n;const o=i.segment,l=i.geometry,h=t[1];for(;e.length<l.getStride();)e.push(o[h][e.length]);switch(l.getType()){case"Point":n=e,o[0]=e,o[1]=e;break;case"MultiPoint":n=l.getCoordinates(),n[i.index]=e,o[0]=e,o[1]=e;break;case"LineString":n=l.getCoordinates(),n[i.index+h]=e,o[h]=e;break;case"MultiLineString":n=l.getCoordinates(),n[s[0]][i.index+h]=e,o[h]=e;break;case"Polygon":n=l.getCoordinates(),n[s[0]][i.index+h]=e,o[h]=e;break;case"MultiPolygon":n=l.getCoordinates(),n[s[1]][s[0]][i.index+h]=e,o[h]=e;break;case"Circle":const c=l;if(o[0]=e,o[1]=e,i.index===CIRCLE_CENTER_INDEX)this.changingFeature_=!0,c.setCenter(e),this.changingFeature_=!1;else{this.changingFeature_=!0,this.getMap().getView().getProjection();let d=distance(fromUserCoordinate(c.getCenter()),fromUserCoordinate(e));c.setRadius(d),this.changingFeature_=!1}break}n&&this.setGeometryCoordinates_(l,n)}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([o])=>o));const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],s=[],n=this.traceState_.active&&!this.traceSegments_?this.traceState_.startCoord:null;if(n){this.traceSegments_=[];for(const o of this.dragSegments_){const l=o[0];distance(closestOnSegment(n,l.segment),n)/e.map.getView().getResolution()<1&&this.traceSegments_.push(o)}}for(let o=0,l=this.dragSegments_.length;o<l;++o){const h=this.dragSegments_[o],c=h[0],d=c.feature;i.includes(d)||i.push(d);const u=c.geometry;s.includes(u)||s.push(u),this.updateGeometry_(t,h)}this.updateTrace_(e),this.createOrUpdateVertexFeature_(t,i,s,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate,i=this.findInsertVerticesAndUpdateDragSegments_(t);if(i!=null&&i.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,i),this.vertexFeature_)){const s=this.vertexFeature_.getGeometry().getCoordinates();for(let n=i.length-1;n>=0;--n)this.insertVertex_(i[n],s);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],s=i.geometry;if(s.getType()==="Circle"){const n=s,o=n.getCenter(),l=i.featureSegments[0],h=i.featureSegments[1];l.segment[0]=o,l.segment[1]=o,h.segment[0]=o,h.segment[1]=o,this.rBush_.update(createOrUpdateFromCoordinate(o),l);let c=n;this.rBush_.update(c.getExtent(),h)}else this.rBush_.update(boundingExtent(i.segment),i)}return this.featuresBeingModified_&&(this.toggleTraceState_(e),this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastCoordinate_=e.coordinate,this.handlePointerAtPixel_(this.lastCoordinate_)}handlePointerAtPixel_(e){const t=this.getMap(),i=t.getPixelFromCoordinate(e);t.getView().getProjection();const s=function(l,h){return projectedDistanceToSegmentDataSquared(e,l)-projectedDistanceToSegmentDataSquared(e,h)};let n,o;if(this.hitDetection_){const l=typeof this.hitDetection_=="object"?h=>h===this.hitDetection_:void 0;t.forEachFeatureAtPixel(i,(h,c,d)=>{d&&d.getType()==="Point"&&(d=new Point(toUserCoordinate(d.getCoordinates())));const u=d||h.getGeometry();if(u&&u.getType()==="Point"&&h instanceof Feature&&this.features_.getArray().includes(h)){o=u;const f=h.getGeometry().getFlatCoordinates().slice(0,2);n=[{feature:h,geometry:o,segment:[f,f]}]}return!0},{layerFilter:l})}if(!n){const l=fromUserExtent(createOrUpdateFromCoordinate(e,tempExtent)),h=t.getView().getResolution()*this.pixelTolerance_,c=toUserExtent(buffer(l,h,tempExtent));n=this.rBush_.getInExtent(c)}if(n&&n.length>0){const l=n.sort(s)[0],h=l.segment;let c=closestOnSegmentData(e,l);const d=t.getPixelFromCoordinate(c);let u=distance(i,d);if(o||u<=this.pixelTolerance_){const f={};if(f[getUid(h)]=!0,this.snapToPointer_||(this.delta_[0]=c[0]-e[0],this.delta_[1]=c[1]-e[1]),l.geometry.getType()==="Circle"&&l.index===CIRCLE_CIRCUMFERENCE_INDEX)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(c,[l.feature],[l.geometry],this.snappedToVertex_);else{const _=t.getPixelFromCoordinate(h[0]),g=t.getPixelFromCoordinate(h[1]),v=squaredDistance$1(d,_),p=squaredDistance$1(d,g);if(u=Math.sqrt(Math.min(v,p)),this.snappedToVertex_=u<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(c=v>p?h[1]:h[0]),this.createOrUpdateVertexFeature_(c,[l.feature],[l.geometry],this.snappedToVertex_);const y={};y[getUid(l.geometry)]=!0;for(let b=1,C=n.length;b<C;++b){const T=n[b].segment;if(equals(h[0],T[0])&&equals(h[1],T[1])||equals(h[0],T[1])&&equals(h[1],T[0])){const w=getUid(n[b].geometry);w in y||(y[w]=!0,f[getUid(T)]=!0)}else break}}this.vertexSegments_=f;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,s=e.feature,n=e.geometry,o=e.depth,l=e.index;let h;for(;t.length<n.getStride();)t.push(0);switch(n.getType()){case"MultiLineString":h=n.getCoordinates(),h[o[0]].splice(l+1,0,t);break;case"Polygon":h=n.getCoordinates(),h[o[0]].splice(l+1,0,t);break;case"MultiPolygon":h=n.getCoordinates(),h[o[1]][o[0]].splice(l+1,0,t);break;case"LineString":h=n.getCoordinates(),h.splice(l+1,0,t);break;default:return!1}this.setGeometryCoordinates_(n,h);const c=this.rBush_;c.remove(e),this.updateSegmentIndices_(n,l,o,1);const d={segment:[i[0],t],feature:s,geometry:n,depth:o,index:l};c.insert(boundingExtent(d.segment),d),this.dragSegments_.push([d,1]);const u={segment:[t,i[1]],feature:s,geometry:n,depth:o,index:l+1};return c.insert(boundingExtent(u.segment),u),this.dragSegments_.push([u,0]),!0}updatePointer_(e){var t;return e&&this.findInsertVerticesAndUpdateDragSegments_(e),(t=this.vertexFeature_)==null?void 0:t.getGeometry().getCoordinates()}getPoint(){var t;const e=(t=this.vertexFeature_)==null?void 0:t.getGeometry().getCoordinates();return e?toUserCoordinate(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(boundingExtent([e])).some(({segment:i})=>equals(i[0],e)||equals(i[1],e))}removePoint(e){if(e&&(e=fromUserCoordinate(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=MapBrowserEventType.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_.map(([s])=>s));const i=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new ModifyEvent(ModifyEventType.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,i}return!1}removeVertex_(){const e=this.dragSegments_,t={};let i=!1,s,n,o,l,h,c,d,u,f,_,g;for(h=e.length-1;h>=0;--h)o=e[h],_=o[0],g=getUid(_.feature),_.depth&&(g+="-"+_.depth.join("-")),g in t||(t[g]={}),o[1]===0?(t[g].right=_,t[g].index=_.index):o[1]==1&&(t[g].left=_,t[g].index=_.index+1);for(g in t){switch(f=t[g].right,d=t[g].left,c=t[g].index,u=c-1,d!==void 0?_=d:_=f,u<0&&(u=0),l=_.geometry,n=l.getCoordinates(),s=n,i=!1,l.getType()){case"MultiLineString":n[_.depth[0]].length>2&&(n[_.depth[0]].splice(c,1),i=!0);break;case"LineString":n.length>2&&(n.splice(c,1),i=!0);break;case"MultiPolygon":s=s[_.depth[1]];case"Polygon":s=s[_.depth[0]],s.length>4&&(c==s.length-1&&(c=0),s.splice(c,1),i=!0,c===0&&(s.pop(),s.push(s[0]),u=s.length-1));break}if(i){this.setGeometryCoordinates_(l,n);const v=[];if(d!==void 0&&(this.rBush_.remove(d),v.push(d.segment[0])),f!==void 0&&(this.rBush_.remove(f),v.push(f.segment[1])),d!==void 0&&f!==void 0){const p={depth:_.depth,feature:_.feature,geometry:_.geometry,index:u,segment:v};this.rBush_.insert(boundingExtent(p.segment),p)}this.updateSegmentIndices_(l,c,_.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(boundingExtent([e])).some(({segment:i})=>!(equals(i[0],e)||equals(i[1],e)))}insertPoint(e){var s;const t=e?fromUserCoordinate(e,this.getMap().getView().getProjection()):(s=this.vertexFeature_)==null?void 0:s.getGeometry().getCoordinates();return t?this.findInsertVerticesAndUpdateDragSegments_(t).reduce((n,o)=>n||this.insertVertex_(o,t),!1):!1}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,s){this.rBush_.forEachInExtent(e.getExtent(),function(n){n.geometry===e&&(i===void 0||n.depth===void 0||equals$1(n.depth,i))&&n.index>t&&(n.index+=s)})}}function compareIndexes(a,e){return a.index-e.index}function projectedDistanceToSegmentDataSquared(a,e,t){const i=e.geometry;if(i.getType()==="Circle"){let n=i;if(e.index===CIRCLE_CIRCUMFERENCE_INDEX){const o=squaredDistance$1(n.getCenter(),fromUserCoordinate(a)),l=Math.sqrt(o)-n.getRadius();return l*l}}const s=fromUserCoordinate(a);return tempSegment[0]=fromUserCoordinate(e.segment[0]),tempSegment[1]=fromUserCoordinate(e.segment[1]),squaredDistanceToSegment(s,tempSegment)}function closestOnSegmentData(a,e,t){const i=e.geometry;if(i.getType()==="Circle"&&e.index===CIRCLE_CIRCUMFERENCE_INDEX)return toUserCoordinate(i.getClosestPoint(fromUserCoordinate(a)));const s=fromUserCoordinate(a);return tempSegment[0]=fromUserCoordinate(e.segment[0]),tempSegment[1]=fromUserCoordinate(e.segment[1]),toUserCoordinate(closestOnSegment(s,tempSegment))}function getDefaultStyleFunction(){const a=createEditingStyle();return function(e,t){return a.Point}}const controlCss='.geolocation{top:85px;left:.5em}.geolocation button{background:var(--primary);color:var(--on-primary)}.geolocation button>svg{fill:var(--on-primary);min-inline-size:1.25rem!important;max-inline-size:1.25rem!important;min-block-size:1.25rem!important;max-block-size:1.25rem!important}.ol-touch.geolocation{top:100px}.loading-indicator{position:absolute;pointer-events:none!important;display:flex;align-items:center;justify-content:center;background-color:#0000}.loading-indicator.small{bottom:.5em;left:.5em;width:30px;height:30px}.loading-indicator.fullscreen{width:100%;height:100%}.disabled{filter:brightness(1.7);pointer-events:none}.ol-unselectable{pointer-events:none}.ol-control{background:none}.ol-control button,.ol-control button:hover,.ol-control button:focus{--_round: 32px;border-radius:var(--_round);background:var(--primary);color:var(--on-primary);width:32px;height:32px;cursor:pointer;border:none;outline:none;pointer-events:all;position:relative;font-size:1rem}.ol-control button:hover:after{background-size:15000%;opacity:.1;transition:background-size var(--speed2) linear;content:"";position:absolute;top:0;right:0;bottom:0;left:0;z-index:1;border-radius:inherit;inline-size:100%;block-size:100%;background-position:center;background-image:radial-gradient(circle,currentColor 1%,transparent 1%)}.ol-control button.ol-zoom-in,.ol-control button.ol-zoom-in:hover{border-top-left-radius:var(--_round);border-top-right-radius:var(--_round);border-bottom-left-radius:.5rem;border-bottom-right-radius:.5rem;margin-bottom:.125rem}.ol-control button.ol-zoom-out,.ol-control button.ol-zoom-out:hover{border-top-left-radius:.5rem;border-top-right-radius:.5rem;border-bottom-left-radius:var(--_round);border-bottom-right-radius:var(--_round)}';/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const r=(a,e,t)=>{for(const i of e)if(i[0]===a)return(0,i[1])();return t==null?void 0:t()};var v0,P0;class EOxMapCompare extends r$1{constructor(){super();Rt(this,v0);this.value=50,this.enabled="true"}static get properties(){return{value:{attribute:"value",type:Number},enabled:{attribute:"enabled",type:String}}}render(){return x`
      <style>
        :host {
          display: block;
          --thumb-size: 3rem;
        }
        .eox-map-compare {
          --thumb-bgc: #fff;
          --thumb-w: var(--thumb-size);

          position: relative;
          height: 100%;
        }
        .eox-map-compare::after {
          content: "";
          display: block;
        }
        .eox-map-compare__first,
        .eox-map-compare__second {
          height: 100%;
          object-fit: cover;
          position: absolute;
          top: 0;
          width: 100%;
        }
        .eox-map-compare__first {
          clip-path: polygon(
            0% 0%,
            ${this.value}% 0%,
            ${this.value}% 100%,
            0% 100%
          );
        }
        .eox-map-compare__second {
          clip-path: polygon(
            100% 0%,
            ${this.value}% 0%,
            ${this.value}% 100%,
            100% 100%
          );
        }
        .eox-map-compare__range {
          background-color: transparent;
          box-sizing: border-box;
          font-family: inherit;
          height: 100%;
          margin: 0;
          outline: none;
          position: absolute;
          top: 0;
          width: 100%;
          pointer-events: none;
        }
        .eox-map-compare__range::-moz-range-thumb {
          cursor: ew-resize;
          height: 100%;
          width: var(--thumb-w);
          pointer-events: all;
          background: transparent;
          border: none;
        }
        .eox-map-compare__range::-webkit-slider-thumb {
          cursor: ew-resize;
          height: 100%;
          width: var(--thumb-w);
          pointer-events: all;
          position: relative;
          background: transparent;
          border: none;
        }
        .eox-map-compare__range::-moz-range-track {
          background: transparent;
          background-size: 100%;
          box-sizing: border-box;
        }
        .eox-map-compare__range::-webkit-slider-runnable-track {
          background: transparent;
          background-size: 100%;
          box-sizing: border-box;
          height: 100%;
        }
        .eox-map-compare__range,
        .eox-map-compare__range::-webkit-slider-runnable-track,
        .eox-map-compare__range::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
        }
        .slider-bar,
        .slider-thumb {
          position: absolute;
          box-shadow: 0 0.125rem 0.125rem 0 rgb(0 0 0 / 0.32);
        }
        .slider-bar {
          pointer-events: none;
          top: 0;
          width: 0.3rem;
          height: 100%;
          background-color: var(--thumb-bgc);
          z-index: 2;
          left: calc(${this.value}% - 0.15rem);
          -webkit-clip-path: inset(0 -5px 0 -5px);
          clip-path: inset(0 -5px 0 -5px);
        }
        .slider-thumb {
          pointer-events: none;
          top: calc(50% - var(--thumb-size) / 2);
          background: var(--primary);
          z-index: 3;
          width: var(--thumb-size);
          aspect-ratio: 1;
          left: calc(${this.value}% - var(--thumb-size) / 2);
          border-radius: 50%;
          padding: 0.7rem;
          color: var(--on-primary);
          display: flex;
          align-items: center;
          justify-content: center;
          box-sizing: border-box;
        }
        .slider-thumb svg {
          fill: currentColor;
        }
      </style>
      ${r(this.enabled,[["first",()=>x`<slot name="first"></slot>`],["second",()=>x`<slot name="second"></slot>`]],()=>x`
          <div class="eox-map-compare">
            <div class="eox-map-compare__first">
              <slot name="first"></slot>
            </div>
            <div class="eox-map-compare__second">
              <slot name="second"></slot>
            </div>
            <input
              type="range"
              class="eox-map-compare__range"
              min="0"
              max="100"
              value=${this.value}
              @input=${Yt(this,v0,P0)}
            />
            <div class="slider-bar"></div>
            <div class="slider-thumb">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                <title>arrow-left-right</title>
                <path
                  d="M6.45,17.45L1,12L6.45,6.55L7.86,7.96L4.83,11H19.17L16.14,7.96L17.55,6.55L23,12L17.55,17.45L16.14,16.04L19.17,13H4.83L7.86,16.04L6.45,17.45Z"
                />
              </svg>
            </div>
          </div>
        `)}
    `}}v0=new WeakSet,P0=function(t){this.value=parseInt(t.target.value)};customElements.define("eox-map-compare",EOxMapCompare);function addNewFeature(a,e,t,i=!1,s=!1,n=!0){const o=i?[a.feature]:a.features;s&&e.getSource().clear();const l=e.getSource().getFeatures();if(!e.get("multipleFeatures")&&(l.length||o.length>1))return console.error("Multiple features detected!");o.forEach(d=>{const u=d.getGeometry();if(u instanceof LineString){const _=getLength(u,{radius:6378137,projection:t.projection});d.set("measure",_)}else if(u instanceof Polygon){const _=getArea(u,{radius:6378137,projection:t.projection});d.set("measure",_)}const f=getUid(d);d.set("id",f),d.setId(f)}),!i&&o.length&&(e.getSource().addFeatures(o),t.map.getView().fit(e.getSource().getExtent(),{duration:n?750:0}));const h=new GeoJSON,c=JSON.parse(h.writeFeatures(o,READ_FEATURES_OPTIONS));(i||s)&&dispatchEvt(t,"drawend",a,c),dispatchEvt(t,"addfeatures",a,c)}function dispatchEvt(a,e,t,i){const s=new CustomEvent(e,{detail:{originalEvent:t,geoJSON:i}});a.dispatchEvent(s)}function cancelAnimation(a){a.setRotation(a.getRotation())}function getProj(a,e){const n=a.readFeatures(e)[0].getGeometry().getCoordinates();if(n&&n.length>0){const o=findFirstCoordinateValue(n);if(typeof o=="number")return o>=-180&&o<=180?"EPSG:4326":"EPSG:3857"}}function findFirstCoordinateValue(a){if(typeof a=="number")return a;if(Array.isArray(a)&&a.length>0)return findFirstCoordinateValue(a[0])}function parseTextToFeature(a,e,t,i=!1,s=!0){try{const n=getFormatReader(a);if(!n){console.error("Unsupported format or invalid data");return}const o=getProj(n,a),l=n.readFeatures(a,{dataProjection:o||READ_FEATURES_OPTIONS.dataProjection,featureProjection:t.projection});addNewFeature({features:l},e,t,!1,i,s)}catch(n){console.error("Error parsing data:",n)}}function getFormatReader(a){return isGeoJSON(a)?new GeoJSON:isKML(a)?new KML({extractStyles:!1}):isTopoJSON(a)?new TopoJSON:null}function isGeoJSON(a){try{const e=JSON.parse(a);return e.type==="FeatureCollection"||e.type==="Feature"}catch{return!1}}function isKML(a){return a.includes("<kml")&&a.includes("</kml>")}function isTopoJSON(a){try{const e=JSON.parse(a);return e.type==="Topology"&&e.objects}catch{return!1}}function registerProjection(a,e,t=void 0){proj4.defs(a,e),register(proj4),typeof t<"u"&&get(a).setExtent(t)}async function registerProjectionFromCode(a){return register(proj4),await fromEPSGCode(a)}function parseFeature(a){return new GeoJSON().writeFeaturesObject(a)}function transform(a,e,t=void 0){return t||(t="EPSG:4326"),transform$1(a,e,t)}function transformExtent(a,e,t=void 0){return t||(t="EPSG:4326"),transformExtent$1(a,e,t)}function addScrollInteractions(a,e=!1){e?(a.addInteraction(new MouseWheelZoom({condition:platformModifierKeyOnly})),"ontouchstart"in window||navigator.maxTouchPoints>0?a.addInteraction(new DragPan({condition:function(i){return this.getPointerCount()===2||platformModifierKeyOnly(i)}})):a.addInteraction(new DragPan)):(a.addInteraction(new MouseWheelZoom),a.addInteraction(new DragPan))}function removeDefaultScrollInteractions(a){a.getInteractions().getArray().forEach(e=>{(e instanceof MouseWheelZoom||e instanceof DragPan)&&a.removeInteraction(e)})}function coordinatesRoughlyEquals(a,e,t=.001){let i=!0;for(let s=a.length-1;s>=0;--s)if(!numbersRoughlyEquals(a[s],e[s],t)){i=!1;break}return i}function numbersRoughlyEquals(a,e,t=.001){return Math.abs(a-e)<t}function getCenterFromProperty(a){if(a){const e=a;return!equals(e,[0,0])&&e[0]>=-180&&e[0]<=180&&e[1]>=-90&&e[1]<=90?fromLonLat(e):e}return[0,0]}function addDraw(a,e,t){const i=Object.assign({},t);if(a.interactions[i.id])throw Error(`Interaction with id: ${i.id} already exists.`);i.modify=typeof i.modify=="boolean"?i.modify:!0;const s=e.getSource();i.type==="Box"&&(i.geometryFunction=createBox(),i.type="Circle");const n=new Draw({...i,source:s});i.active===!1&&n.setActive(!1),n.on("drawend",h=>{e.get("isDrawingEnabled")&&addNewFeature(h,e,a,!0)}),a.map.addInteraction(n),a.interactions[i.id]=n;const o=new Modify({source:s});o.setActive(i.modify),a.map.addInteraction(o),a.interactions[`${i.id}_modify`]=o;const l=()=>{a.getLayerById(e.get("id"))||(a.removeInteraction(i.id),a.removeInteraction(`${i.id}_modify`),a.map.getLayerGroup().un("change",l))};a.map.getLayerGroup().on("change",l)}const Property$1={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Overlay extends BaseObject{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+CLASS_SELECTABLE,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(Property$1.ELEMENT,this.handleElementChanged),this.addChangeListener(Property$1.MAP,this.handleMapChanged),this.addChangeListener(Property$1.OFFSET,this.handleOffsetChanged),this.addChangeListener(Property$1.POSITION,this.handlePositionChanged),this.addChangeListener(Property$1.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(Property$1.ELEMENT)}getId(){return this.id}getMap(){return this.get(Property$1.MAP)||null}getOffset(){return this.get(Property$1.OFFSET)}getPosition(){return this.get(Property$1.POSITION)}getPositioning(){return this.get(Property$1.POSITIONING)}handleElementChanged(){removeChildren(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){var t;this.mapPostrenderListenerKey&&((t=this.element)==null||t.remove(),unlistenByKey(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=listen(e,MapEventType.POSTRENDER,this.render,this),this.updatePixelPosition();const i=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(Property$1.ELEMENT,e)}setMap(e){this.set(Property$1.MAP,e)}setOffset(e){this.set(Property$1.OFFSET,e)}setPosition(e){this.set(Property$1.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(Property$1.POSITION))return;const i=this.getRect(t.getTargetElement(),t.getSize()),s=this.getElement(),n=this.getRect(s,[outerWidth(s),outerHeight(s)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!containsExtent(i,n)){const l=n[0]-i[0],h=i[2]-n[2],c=n[1]-i[1],d=i[3]-n[3],u=[0,0];if(l<0?u[0]=l-o:h<0&&(u[0]=Math.abs(h)+o),c<0?u[1]=c-o:d<0&&(u[1]=Math.abs(d)+o),u[0]!==0||u[1]!==0){const f=t.getView().getCenterInternal(),_=t.getPixelFromCoordinateInternal(f);if(!_)return;const g=[_[0]+u[0],_[1]+u[1]],v=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(g),duration:v.duration,easing:v.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),s=i.left+window.pageXOffset,n=i.top+window.pageYOffset;return[s,n,s+t[0],n+t[1]]}setPositioning(e){this.set(Property$1.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const i=e.getPixelFromCoordinate(t),s=e.getSize();this.updateRenderedPosition(i,s)}updateRenderedPosition(e,t){const i=this.element.style,s=this.getOffset(),n=this.getPositioning();this.setVisible(!0);const o=`${e[0]+s[0]}px`,l=`${e[1]+s[1]}px`;let h="0%",c="0%";n=="bottom-right"||n=="center-right"||n=="top-right"?h="-100%":(n=="bottom-center"||n=="center-center"||n=="top-center")&&(h="-50%"),n=="bottom-left"||n=="bottom-center"||n=="bottom-right"?c="-100%":(n=="center-left"||n=="center-center"||n=="center-right")&&(c="-50%");const d=`translate(${h}, ${c}) translate(${o}, ${l})`;this.rendered.transform_!=d&&(this.rendered.transform_=d,i.transform=d)}getOptions(){return this.options}}class EOxMapTooltip extends r$1{static get properties(){return{feature:{attribute:!1,property:!0,type:Object},propertyTransform:{attribute:!1,property:!0,type:Function}}}constructor(){super(),this.feature=null,this.propertyTransform=(e,t)=>e}render(){return this.feature?x` <style>
            ul {
              margin: 0;
              padding: 1rem 1rem 1rem 2rem;
              border-radius: 0.5rem;
              max-width: 250px;
              font-size: small;
              background-color: var(--inverse-surface);
              color: var(--inverse-on-surface);
              box-shadow: 0 0.25rem 0.5rem 0 rgb(0 0 0 / 0.4);
              line-height: normal;
              white-space: normal;
            }
            span {
              font-weight: bold;
            }
          </style>
          <ul>
            ${Object.entries(this.feature.getProperties()).map(([e,t])=>this.propertyTransform({key:e,value:t},this.feature)).filter(e=>e).map(({key:e,value:t})=>x`<li><span>${e}</span>: ${t}</li>`)}
          </ul>`:E}}customElements.get("eox-map-tooltip")||customElements.define("eox-map-tooltip",EOxMapTooltip);class ImageWMS extends ImageSource{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:defaultImageLoadFunction,this.params_=Object.assign({},e.params),this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,t,i,s){const n=get(i),o=this.getProjection();o&&o!==n&&(t=calculateSourceResolution(o,n,e,t),e=transform$1(e,n,o));const l={url:this.url_,params:{...this.params_,...s},projection:o||n};return getFeatureInfoUrl(l,e,t)}getLegendUrl(e,t){return getLegendUrl({url:this.url_,params:{...this.params_,...t}},e)}getParams(){return this.params_}getImageInternal(e,t,i,s){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==s)&&(this.loaderProjection_=s,this.loader=createLoader({crossOrigin:this.crossOrigin_,params:this.params_,projection:s,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(n,o)=>(this.image.setImage(n),this.imageLoadFunction_(this.image,o),decode(n))})),super.getImageInternal(e,t,i,s))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}var UID_LENGTH=16,UID=generateUID(),PLACE_HOLDER_REGEXP=new RegExp('(\\\\)?"@__(F|R|D|M|S|A|U|I|B|L)-'+UID+'-(\\d+)__@"',"g"),IS_NATIVE_CODE_REGEXP=/\{\s*\[native code\]\s*\}/g,IS_PURE_FUNCTION=/function.*?\(/,IS_ARROW_FUNCTION=/.*?=>.*?/,UNSAFE_CHARS_REGEXP=/[<>\/\u2028\u2029]/g,SCRIPT_CLOSE_REGEXP=/<\/script[^>]*>/gi,RESERVED_SYMBOLS=["*","async"],ESCAPED_CHARS={"<":"\\u003C",">":"\\u003E","/":"\\u002F","\u2028":"\\u2028","\u2029":"\\u2029"};function escapeUnsafeChars(a){return ESCAPED_CHARS[a]}function escapeFunctionBody(a){return a=a.replace(SCRIPT_CLOSE_REGEXP,function(e){return e.replace(/</g,"\\u003C").replace(/\//g,"\\u002F").replace(/>/g,"\\u003E")}),a=a.replace(/\u2028/g,"\\u2028"),a=a.replace(/\u2029/g,"\\u2029"),a}function generateUID(){for(var a=crypto.getRandomValues(new Uint8Array(UID_LENGTH)),e="",t=0;t<UID_LENGTH;++t)e+=a[t].toString(16);return e}function deleteFunctions(a){var e=[];for(var t in a)typeof a[t]=="function"&&e.push(t);for(var i=0;i<e.length;i++)delete a[e[i]]}var serializeJavascript=function a(e,t){t||(t={}),(typeof t=="number"||typeof t=="string")&&(t={space:t});var i=[],s=[],n=[],o=[],l=[],h=[],c=[],d=[],u=[],f=[];function _(p,y){if(t.ignoreFunction&&deleteFunctions(y),!y&&y!==void 0&&y!==BigInt(0))return y;var b=this[p],C=typeof b;if(C==="object"){if(b instanceof RegExp)return"@__R-"+UID+"-"+(s.push(b)-1)+"__@";if(b instanceof Date)return"@__D-"+UID+"-"+(n.push(b)-1)+"__@";if(b instanceof Map)return"@__M-"+UID+"-"+(o.push(b)-1)+"__@";if(b instanceof Set)return"@__S-"+UID+"-"+(l.push(b)-1)+"__@";if(b instanceof Array){var T=b.filter(function(){return!0}).length!==b.length;if(T)return"@__A-"+UID+"-"+(h.push(b)-1)+"__@"}if(b instanceof URL)return"@__L-"+UID+"-"+(f.push(b)-1)+"__@"}return C==="function"?"@__F-"+UID+"-"+(i.push(b)-1)+"__@":C==="undefined"?"@__U-"+UID+"-"+(c.push(b)-1)+"__@":C==="number"&&!isNaN(b)&&!isFinite(b)?"@__I-"+UID+"-"+(d.push(b)-1)+"__@":C==="bigint"?"@__B-"+UID+"-"+(u.push(b)-1)+"__@":y}function g(p,y){var b=p.toString();if(IS_NATIVE_CODE_REGEXP.test(b))throw new TypeError("Serializing native function: "+p.name);if(y&&y.unsafe!==!0&&(b=escapeFunctionBody(b)),IS_PURE_FUNCTION.test(b)||IS_ARROW_FUNCTION.test(b))return b;var C=b.indexOf("("),T=b.substr(0,C).trim().split(" ").filter(function(L){return L.length>0}),w=T.filter(function(L){return RESERVED_SYMBOLS.indexOf(L)===-1});return w.length>0?(T.indexOf("async")>-1?"async ":"")+"function"+(T.join("").indexOf("*")>-1?"*":"")+b.substr(C):b}if(t.ignoreFunction&&typeof e=="function"&&(e=void 0),e===void 0)return String(e);var v;return t.isJSON&&!t.space?v=JSON.stringify(e):v=JSON.stringify(e,t.isJSON?null:_,t.space),typeof v!="string"?String(v):(t.unsafe!==!0&&(v=v.replace(UNSAFE_CHARS_REGEXP,escapeUnsafeChars)),i.length===0&&s.length===0&&n.length===0&&o.length===0&&l.length===0&&h.length===0&&c.length===0&&d.length===0&&u.length===0&&f.length===0?v:v.replace(PLACE_HOLDER_REGEXP,function(p,y,b,C){if(y)return p;if(b==="D")return'new Date("'+n[C].toISOString()+'")';if(b==="R")return"new RegExp("+a(s[C].source)+', "'+s[C].flags+'")';if(b==="M")return"new Map("+a(Array.from(o[C].entries()),t)+")";if(b==="S")return"new Set("+a(Array.from(l[C].values()),t)+")";if(b==="A")return"Array.prototype.slice.call("+a(Object.assign({length:h[C].length},h[C]),t)+")";if(b==="U")return"undefined";if(b==="I")return d[C];if(b==="B")return'BigInt("'+u[C]+'")';if(b==="L")return"new URL("+a(f[C].toString(),t)+")";var T=i[C];return g(T,t)}))};const serialize=getDefaultExportFromCjs(serializeJavascript),basicOlFormats={GeoJSON,MVT},basicOlLayers={Group:LayerGroup,Image:ImageLayer,Tile:TileLayer,Vector:VectorLayer,VectorTile:VectorTileLayer},basicOlSources={ImageWMS,OSM,Tile:TileSource,TileWMS,Vector:VectorSource,VectorTile,WMTS,XYZ};function createLayer(a,e,t=!0){var o;const s={...window.eoxMapAdvancedOlLayers,...basicOlLayers}[e.type];if(!s)throw new Error(`Layer type ${e.type} not supported!`);const n=new s({...e,...e.type!=="MapboxStyle"&&e.source&&{source:createOlSourceFromDefinition(e.source)},...e.type==="Group"&&{layers:[]},...e.properties,style:void 0});if(n.set("_jsonDefinition",e,!0),e.type==="Group"){const l=e.layers.map(h=>createLayer(a,h));l.forEach(h=>h.set("_group",n,!0)),n.setLayers(new Collection(l))}if("style"in e&&n.setStyle(e.style),t&&((o=e.interactions)!=null&&o.length))for(let l=0;l<e.interactions.length;l++){const h=e.interactions[l];addInteraction(a,n,h)}return setSyncListeners(n,e),n}function createOlSourceFromDefinition(a){const t={...window.eoxMapAdvancedOlSources,...basicOlSources}[a.type];if(a&&!t)throw new Error(`Source type ${a.type} not supported!`);const i={...window.eoxMapAdvancedOlFormats,...basicOlFormats},s=generateTileGrid(a);return new t({...a,..."format"in a&&a.type!=="WMTS"&&{format:new i[typeof a.format=="object"?a.format.type:a.format]({...typeof a.format=="object"&&{...a.format}})},..."source"in a&&{source:createOlSourceFromDefinition(a.source)},..."tileGrid"in a&&{tileGrid:s},..."projection"in a&&{projection:get(a.projection)}})}function addInteraction(a,e,t){t.type==="draw"?addDraw(a,e,t.options):t.type==="select"?addSelect(a,e,t.options):t.type==="clusterExplode"&&addClusterExplode(a,e,t.options)}function updateLayer(a,e,t){var n,o,l,h;const i=t.get("_jsonDefinition");if(e.type!==i.type||e.type!=="MapboxStyle"&&((n=e.source)==null?void 0:n.type)!==((o=i.source)==null?void 0:o.type))throw new Error("Layers are not compatible to be updated");const s=createLayer(a,e,!1);if(e.type!=="MapboxStyle"&&serialize(e.source)!==serialize(i.source)&&t.setSource(s.getSource()),e.type==="MapboxStyle"&&serialize(e.properties.mapboxStyle)!==serialize(i.properties.mapboxStyle)&&(t.getLayers().clear(),t.applyMapboxStyle(e.properties.mapboxStyle,e.properties.applyOptions)),["Vector","VectorTile"].includes(e.type)&&serialize(e.style)!==serialize(i.style)&&t.setStyle(s.getStyle()),serialize(e.properties)!==serialize(i.properties)&&t.setProperties(e.properties),e.visible!==i.visible&&t.setVisible(e.visible),e.opacity&&e.opacity!==i.opacity&&t.setOpacity(e.opacity),serialize(e.interactions)!==serialize(i.interactions)&&((l=i.interactions)==null||l.forEach(c=>{const d=e.interactions.find(u=>{var f,_;return u.type===c.type&&((f=u.options)==null?void 0:f.id)===((_=c.options)==null?void 0:_.id)});d?d.type==="draw"?(a.interactions[d.options.id].setActive(d.options.active),a.interactions[`${d.options.id}_modify`].setActive(d.options.modify)):(a.selectInteractions[d.options.id]||a.interactions[d.options.id]).setActive(d.options.active):c.type==="select"?a.removeSelect(c.options.id):a.removeInteraction(c.options.id)}),(h=e.interactions)==null||h.forEach(c=>{i.interactions.find(u=>{var f,_;return u.type===c.type&&((f=u.options)==null?void 0:f.id)===((_=c.options)==null?void 0:_.id)})||addInteraction(a,t,c)})),e.type==="Group"){const c=e.layers.map(_=>{var g;return(g=_.properties)==null?void 0:g.id}),d=t.getLayers();d.getArray().slice().forEach(_=>{c.includes(_.get("id"))||d.remove(_)}),e.layers.forEach(_=>{const g=_.properties.id;if(d.getArray().map(v=>v.get("id")).includes(g))updateLayer(a,_,a.getLayerById(g));else{const v=createLayer(a,_);d.push(v)}});const f=c;d.getArray().sort((_,g)=>f.indexOf(_.get("id"))-f.indexOf(g.get("id"))),d.changed()}return setSyncListeners(t,e),t.set("_jsonDefinition",e,!0),t}const generateLayers=(a,e)=>e?[...e].map(t=>createLayer(a,t)):[];function setSyncListeners(a,e){a.on("change:opacity",()=>{e.opacity=a.getOpacity()}),a.on("change:visible",()=>{e.visible=a.getVisible()}),a.on("change:zIndex",()=>{e.zIndex=a.getZIndex()}),a.on("propertychange",t=>{t.key==="map"||t.key==="source"||e.properties&&(e.properties[t.key]=t.target.get(t.key))})}class EOxSelectInteraction{constructor(e,t,i){A0(this,"panIntoFeature",(e,t)=>{const i=e instanceof Feature||e instanceof RenderFeature?e.getGeometry().getExtent():e;this.eoxMap.map.getView().fit(i,t||{duration:750})});var c,d,u;this.eoxMap=e,this.selectLayer=t,this.options=i,this.active=i.active||t.getVisible(),this.panIn=i.panIn||!1,this.tooltip=i.tooltip!==!1;const s=this.eoxMap.map.getOverlayById("eox-map-tooltip");let n;this.tooltip&&(s?(this.tooltipElement=s.getElement(),n=s):(this.tooltipElement=this.eoxMap.querySelector("eox-map-tooltip")||this.eoxMap.querySelector("[is=eox-map-tooltip]")||((c=i.overlay)==null?void 0:c.element),this.tooltipElement&&(n=new Overlay({element:this.tooltipElement,position:void 0,offset:[0,0],positioning:"top-left",className:"eox-map-tooltip",id:"eox-map-tooltip",...i.overlay}),this.eoxMap.map.addOverlay(n))));const o=()=>{n&&i.condition==="pointermove"&&n.setPosition(void 0)};e.map.on("change:target",f=>{var _,g;(_=f.oldValue)==null||_.removeEventListener("pointerleave",o),(g=f.target.getTargetElement())==null||g.addEventListener("pointerleave",o)}),(d=e.map.getTargetElement())==null||d.addEventListener("pointerleave",o);const l=f=>{var p,y,b,C;i!=null&&i.projection&&(proj4.defs((p=i.projection)==null?void 0:p.name)||(proj4.defs((y=i.projection)==null?void 0:y.name,(b=i==null?void 0:i.projection)==null?void 0:b.proj4_string),register(proj4)));const _=get(((C=i==null?void 0:i.projection)==null?void 0:C.name)||"EPSG:4326"),g=e.map.getView().getProjection().getCode(),v=transform$1(f.coordinate,g,_);return{lon:v[0].toFixed((i==null?void 0:i.precision)||2),lat:v[1].toFixed((i==null?void 0:i.precision)||2)}},h=f=>Object.values(f).every(_=>_===0);if(this.selectLayer instanceof VectorLayer||this.selectLayer instanceof VectorTileLayer){this.selectedFids=[];let f;if(this.options.layer)f=this.options.layer;else{const v=this.selectLayer.get("_jsonDefinition");f={...v,style:i.style,properties:{id:this.selectLayer.get("id")+"_select"},source:{type:v.type}}}f.renderMode="vector",delete f.interactions,this.selectStyleLayer=createLayer(e,f),this.selectStyleLayer.setSource(this.selectLayer.getSource()),this.selectStyleLayer.setMap(this.eoxMap.map);const _=this.selectStyleLayer.getStyleFunction();this.selectStyleLayer.setStyle((v,p)=>this.selectedFids.length&&this.selectedFids.includes(this.getId(v))?_(v,p):null),this.listener=v=>{if(!this.active||v.dragging)return;const p=this.eoxMap.map.getView().getZoom();if(p<this.selectLayer.getMinZoom()||p>this.selectLayer.getMaxZoom())return;const y=this.eoxMap.map.forEachFeatureAtPixel(v.pixel,w=>w,{layerFilter:w=>w===this.selectLayer}),b=y?[this.getId(y)]:[],C=this.selectedFids[0]!==b[0];if(this.selectedFids=b,C&&(this.selectStyleLayer.changed(),y&&this.panIn&&this.panIntoFeature(y)),n){const w=v.pixel[0]>this.eoxMap.offsetWidth/2?"right":"left",L=v.pixel[1]>this.eoxMap.offsetHeight/2?"bottom":"top";n.setPositioning(`${L}-${w}`),n.setPosition(y?v.coordinate:null),y&&this.tooltipElement&&(this.tooltipElement.feature=y,i!=null&&i.coordinates&&Object.assign(y==null?void 0:y.values_,l(v)))}const T=new CustomEvent("select",{detail:{id:i.id,originalEvent:v,feature:y}});this.eoxMap.dispatchEvent(T)},this.eoxMap.map.on(i.condition||"click",this.listener),this.selectLayer.on("change:opacity",()=>{this.selectStyleLayer.setOpacity(this.selectLayer.getOpacity())}),this.selectLayer.on("change:visible",()=>{const v=this.selectLayer.getVisible();this.selectStyleLayer.setVisible(v),this.setActive(v)}),this.changeSourceListener=()=>{this.selectStyleLayer.setSource(this.selectLayer.getSource())},this.selectLayer.on("change:source",this.changeSourceListener);const g=()=>{var v,p;e.getLayerById(t.get("id"))?((v=this.selectStyleLayer)==null||v.setMap(this.eoxMap.map),n==null||n.setMap(this.eoxMap.map)):((p=this.selectStyleLayer)==null||p.setMap(null),n==null||n.setMap(null))};e.map.getLayerGroup().on("change",g),this.pointerMoveListener=v=>{var p;v.dragging||(e.map.getTargetElement().style.cursor=e.map.hasFeatureAtPixel(v.pixel,{layerFilter:y=>{var b,C;return(C=(b=y.get("_jsonDefinition"))==null?void 0:b.interactions)==null?void 0:C.find(T=>{var w;return T.type=="select"&&((w=T.options)==null?void 0:w.condition)==="click"})},...i.atPixelOptions})?i.cursor||"pointer":(p=this.eoxMap.interactions.drawInteraction)!=null&&p.getActive()?"crosshair":"auto")},e.map.on("pointermove",this.pointerMoveListener)}(this.selectLayer.getSource()instanceof ImageWMS||this.selectLayer.getSource()instanceof TileWMS)&&(this.listener=f=>{if(!this.active||f.dragging)return;const _=e.map.getView().getResolution(),g=this.selectLayer.getSource().getFeatureInfoUrl(f.coordinate,_,e.map.getView().getProjection(),{INFO_FORMAT:"application/json"});g&&fetch(g).then(v=>v.text()).then(v=>{if(n){const p=f.pixel[0]>this.eoxMap.offsetWidth/2?"right":"left",y=f.pixel[1]>this.eoxMap.offsetHeight/2?"bottom":"top";n.setPositioning(`${y}-${p}`)}if(v&&this.tooltipElement){const p=JSON.parse(v);let y;p.type==="FeatureCollection"&&p.features.length>0?y=p.features[0]:p.type==="Feature"?(y=p,this.tooltipElement.innerHTML=`<pre>${JSON.stringify(y.properties,null,2)}</pre>`):n==null||n.setPosition(null),i!=null&&i.coordinates&&y&&Object.assign(y==null?void 0:y.properties,l(f));const b=new Feature({...y==null?void 0:y.properties});this.tooltipElement.feature=b,n.setPosition(y?f.coordinate:null)}})},i.condition=="click"&&this.eoxMap.map.on(i.condition,this.listener)),((u=this.selectLayer.getProperties())==null?void 0:u.type)==="WebGLTile"&&(this.listener=f=>{if(!this.active||f.dragging)return;const _=this.selectLayer.getData(f.pixel);if(_){if(n){const g=f.pixel[0]>this.eoxMap.offsetWidth/2?"right":"left",v=f.pixel[1]>this.eoxMap.offsetHeight/2?"bottom":"top";n.setPositioning(`${v}-${g}`),n.setPosition(f.coordinate);let p={};for(const[y,b]of _.entries()){const C=(y+1).toString();p[`band${C}`]=b}if(h(p))n==null||n.setPosition(null);else if(this.tooltipElement){i!=null&&i.coordinates&&Object.assign(p,l(f));const y=new Feature({...p});this.tooltipElement.feature=y,n.setPosition(Object.keys(p).length>0?f.coordinate:null)}}}else n==null||n.setPosition(null)},this.eoxMap.map.on(i.condition||"click",this.listener))}setActive(e){this.active=e}highlightById(e,t){if(this.selectedFids=e,e.length&&t){const i=createEmpty();if(this.selectLayer instanceof VectorLayer)for(let s=0;s<this.selectedFids.length;s++){const n=this.selectedFids[s],o=this.selectLayer.getSource().getFeatureById(n);o&&o.getGeometry()&&extend(i,o.getGeometry().getExtent())}else if(this.selectLayer instanceof VectorTileLayer){const s=this.eoxMap.map,n=this.selectLayer.getFeaturesInExtent(s.getView().calculateExtent(s.getSize()));for(let o=0;o<n.length;o++){const l=n[o];this.selectedFids.includes(this.getId(l))&&extend(i,l.getGeometry().getExtent())}}isEmpty(i)||this.panIntoFeature(i,t)}this.selectStyleLayer.changed()}remove(){this.eoxMap.map.un(this.options.condition||"click",this.listener),(this.selectLayer instanceof VectorLayer||this.selectLayer instanceof VectorTileLayer)&&(this.selectStyleLayer.setMap(null),delete this.eoxMap.selectInteractions[this.options.id],this.selectLayer.un("change:source",this.changeSourceListener),this.eoxMap.map.un("pointermove",this.pointerMoveListener))}getId(e){if(this.options.idProperty)return e.get(this.options.idProperty);if(e.getId()!==void 0)return e.getId();if(e.get("id")!==void 0)return e.get("id");if(getUid(e)!==void 0)return getUid(e);throw Error("No feature id found. Please provide which feature property should be taken instead using idProperty.")}}function addSelect(a,e,t){if(a.interactions[t.id])throw Error(`Interaction with id: ${t.id} already exists.`);return a.selectInteractions[t.id]=new EOxSelectInteraction(a,e,t),a.selectInteractions[t.id]}const circleDistanceMultiplier=1,circleFootSeparation=28,circleStartAngle=Math.PI/2;var e0,a0,go,bt,T0,s0,y0,_0,S0,E0;class EOxClusterExplodeInteraction extends Interaction{constructor(t,i,s){super(s);Rt(this,bt);Rt(this,e0,null);Rt(this,a0,null);Rt(this,go,null);Rt(this,y0,t=>new Promise(i=>{const s=this.eoxMap.map.getView().getZoom(),n={...st(this,e0).fitOptions};n.callback=o=>{var l,h;i(this.eoxMap.map.getView().getZoom()!==s),(h=(l=st(this,e0).fitOptions).callback)==null||h.call(l,o)},this.eoxMap.map.getView().fit(t,n)}));this.clusterLayer=i,this.eoxMap=t;const n={maxZoom:20,atPixelOptions:{},fitOptions:{duration:500,padding:[40,40,40,40]}},o=structuredClone(s);o.fitOptions&&(n.fitOptions={...n.fitOptions,...o.fitOptions},delete o.fitOptions),Ot(this,e0,{...n,...o}),this.active=s.active||i.getVisible();const l=new VectorLayer;l.setStyle(s.style),Ot(this,a0,l.getStyleFunction())}handleEvent(t){if(!this.getActive())return!0;if(t.type==="pointermove"){const i=this.eoxMap.map.hasFeatureAtPixel(t.pixel,{layerFilter:s=>s===this.clusterLayer,...st(this,e0).atPixelOptions});return this.eoxMap.map.getTargetElement().style.cursor=i?"pointer":"default",!i}if(t.type==="click"){const i=this.eoxMap.map.getFeaturesAtPixel(t.pixel,{layerFilter:l=>l===this.clusterLayer,...st(this,e0).atPixelOptions});if(i.length===0)return Yt(this,bt,s0).call(this),!0;const s=i[0],n=s.get("features");if(n.length===1)return Yt(this,bt,T0).call(this,t,n[0]),Yt(this,bt,s0).call(this),!0;if(st(this,go)&&st(this,go)===s){const l=Yt(this,bt,S0).call(this,s,t.coordinate);Yt(this,bt,T0).call(this,t,l.feature)}if(this.eoxMap.map.getView().getZoom()>st(this,e0).maxZoom-1)return Yt(this,bt,_0).call(this,s),!1;const o=createEmpty();return n.forEach(l=>{extend(o,l.getGeometry().getExtent())}),getArea$1(o)<100?(Yt(this,bt,_0).call(this,s),!1):(st(this,y0).call(this,o).then(l=>{l||Yt(this,bt,_0).call(this,s)}),!1)}return!0}setActive(t){t||(Yt(this,bt,s0).call(this),this.eoxMap.map.getTargetElement().style.cursor="default"),super.setActive(t)}setMap(t){t||(Yt(this,bt,s0).call(this),this.eoxMap.map.getTargetElement().style.cursor="default"),super.setMap(t)}remove(){this.setMap(null)}}e0=new WeakMap,a0=new WeakMap,go=new WeakMap,bt=new WeakSet,T0=function(t,i){const s=new CustomEvent("clusterSelect",{detail:{originalEvent:t,feature:i}});this.eoxMap.dispatchEvent(s)},s0=function(){st(this,go)&&(st(this,go).setStyle(void 0),Ot(this,go,null))},y0=new WeakMap,_0=function(t){st(this,go)&&Yt(this,bt,s0).call(this);const i=t.getGeometry().getCoordinates(),s=t.get("features"),n=Yt(this,bt,E0).call(this,s.length,i,this.eoxMap.map.getView().getResolution()).reduce((o,l,h)=>{const c=new Point(l),d=new LineString([i,l]);o.unshift(new Style({geometry:d,stroke:new Stroke({color:"rgba(50, 50, 50, 0.5)",width:2.5})}));const u=new Feature({...s[h].getProperties()}),f=st(this,a0).call(this,u,this.eoxMap.map.getView().getResolution());return f!=null&&f.length&&f.forEach(_=>{const g=_.clone();g.setGeometry(c),o.unshift(g)}),o},[]);t.setStyle(n),Ot(this,go,t)},S0=function(t,i){const s=t.get("features"),n=Yt(this,bt,E0).call(this,s.length,t.getGeometry().getCoordinates(),this.eoxMap.map.getView().getResolution());let o=1/0,l;for(let h=0,c=n.length;h<c;++h){const d=(i[0]-n[h][0])**2+(i[1]-n[h][1])**2;d<o&&(l=h,o=d)}return{feature:s[l],coords:n[l]}},E0=function(t,i,s){let o=circleDistanceMultiplier*circleFootSeparation*(2+t)/(Math.PI*2);const l=Math.PI*2/t,h=[];let c;o=Math.max(o,35)*s;for(let d=0;d<t;++d)c=circleStartAngle+d*l,h.push([i[0]+o*Math.cos(c),i[1]+o*Math.sin(c)]);return h};function addClusterExplode(a,e,t){if(a.interactions[t.id])throw Error(`Interaction with id: ${t.id} already exists.`);const i=new EOxClusterExplodeInteraction(a,e,t);a.interactions[t.id]=i,a.map.addInteraction(i)}function generateTileGrid(a){let e;if(!(!a||!("tileGrid"in a))){if(a.type==="WMTS"){const i=get("EPSG:3857").getExtent(),s=getWidth(i)/128,n=new Array(19),o=new Array(19);for(let l=0;l<19;++l)n[l]=s/Math.pow(2,l),o[l]=l;e=new WMTSTileGrid({resolutions:n,origin:getTopLeft(i),projection:a.tileGrid.projection||"EPSG:3857",matrixIds:o,...a.tileGrid})}else e=createXYZ({...a.tileGrid});return e}}function getLayerById(a,e){return getFlatLayersArray(a.map.getLayers().getArray()).find(i=>i.get("id")===e)}function getFlatLayersArray(a){const e=[];e.push(...a);let t=e.filter(i=>i instanceof LayerGroup);for(;t.length;){const i=[];for(let s=0;s<t.length;s++){const n=t[s].getLayers().getArray();e.push(...n),i.push(...n.filter(o=>o instanceof LayerGroup))}t=i}return e}function animateToStateMethod(a){const e=Object.assign({},a.animationOptions),t=a.map.getView();if(cancelAnimation(t),!e||!Object.keys(e).length){t.setCenter(a.center),t.setZoom(a.zoom);return}e.center=getCenterFromProperty(a.center),e.zoom=a.zoom,t.animate(e)}const UNITS_PROP="units",LEADING_DIGITS=[1,2,5],DEFAULT_DPI=25.4/.28;class ScaleLine extends Control{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const i=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+CLASS_UNSELECTABLE,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(UNITS_PROP,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(UNITS_PROP)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(UNITS_PROP,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,i=e.projection,s=this.getUnits(),n=s=="degrees"?"degrees":"m";let o=getPointResolution(i,e.resolution,t,n);const l=this.minWidth_*(this.dpi_||DEFAULT_DPI)/DEFAULT_DPI,h=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||DEFAULT_DPI)/DEFAULT_DPI:void 0;let c=l*o,d="";if(s=="degrees"){const C=METERS_PER_UNIT.degrees;c*=C,c<C/60?(d="",o*=3600):c<C?(d="",o*=60):d=""}else if(s=="imperial")c<.9144?(d="in",o/=.0254):c<1609.344?(d="ft",o/=.3048):(d="mi",o/=1609.344);else if(s=="nautical")o/=1852,d="NM";else if(s=="metric")c<1e-6?(d="nm",o*=1e9):c<.001?(d="m",o*=1e6):c<1?(d="mm",o*=1e3):c<1e3?d="m":(d="km",o/=1e3);else if(s=="us")c<.9144?(d="in",o*=39.37):c<1609.344?(d="ft",o/=.30480061):(d="mi",o/=1609.3472);else throw new Error("Invalid units");let u=3*Math.floor(Math.log(l*o)/Math.log(10)),f,_,g,v=0,p,y;for(;;){g=Math.floor(u/3);const C=Math.pow(10,g);if(f=LEADING_DIGITS[(u%3+3)%3]*C,_=Math.round(f/o),isNaN(_)){this.element.style.display="none",this.renderedVisible_=!1;return}if(h!==void 0&&_>=h){f=v,_=p,g=y;break}else if(_>=l)break;v=f,p=_,y=g,++u}const b=this.scaleBar_?this.createScaleBar(_,f,d):f.toFixed(g<0?-g:0)+" "+d;this.renderedHTML_!=b&&(this.innerElement_.innerHTML=b,this.renderedHTML_=b),this.renderedWidth_!=_&&(this.innerElement_.style.width=_+"px",this.renderedWidth_=_),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,i){const s=this.getScaleForResolution(),n=s<1?Math.round(1/s).toLocaleString()+" : 1":"1 : "+Math.round(s).toLocaleString(),o=this.scaleBarSteps_,l=e/o,h=[this.createMarker("absolute")];for(let d=0;d<o;++d){const u=d%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";h.push(`<div><div class="ol-scale-singlebar ${u}" style="width: ${l}px;"></div>`+this.createMarker("relative")+(d%2===0||o===2?this.createStepText(d,e,!1,t,i):"")+"</div>")}return h.push(this.createStepText(o,e,!0,t,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+n+"</div>":"")+h.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,i,s,n){const l=(e===0?0:Math.round(s/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+n),h=e===0?-3:t/this.scaleBarSteps_*-1,c=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${h}px;text-align: ${e===0?"left":"center"};min-width: ${c}px;left: ${i?t+"px":"unset"};">`+l+"</div>"}getScaleForResolution(){const e=getPointResolution(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||DEFAULT_DPI,i=1e3/25.4;return e*i*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}const events=["fullscreenchange","webkitfullscreenchange"],FullScreenEventType={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class FullScreen extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==void 0?e.label:"";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const i=e.labelActive!==void 0?e.labelActive:"";this.labelActiveNode_=typeof i=="string"?document.createTextNode(i):i;const s=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=s,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${CLASS_UNSELECTABLE} ${CLASS_CONTROL}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const t=e.getOwnerDocument();if(isFullScreenSupported(t))if(isFullScreen(t))exitFullScreen(t);else{let i;this.source_?i=typeof this.source_=="string"?t.getElementById(this.source_):this.source_:i=e.getTargetElement(),this.keys_?requestFullScreenWithKeys(i):requestFullScreen(i)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=isFullScreen(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(replaceNode(this.labelActiveNode_,this.labelNode_),this.dispatchEvent(FullScreenEventType.ENTERFULLSCREEN)):(replaceNode(this.labelNode_,this.labelActiveNode_),this.dispatchEvent(FullScreenEventType.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(MapProperty.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(MapProperty.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let i=0,s=e.length;i<s;++i)unlistenByKey(e[i]);e.length=0;const t=this.getMap();if(t){const i=t.getOwnerDocument();isFullScreenSupported(i)?this.element.classList.remove(CLASS_UNSUPPORTED):this.element.classList.add(CLASS_UNSUPPORTED);for(let s=0,n=events.length;s<n;++s)e.push(listen(i,events[s],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function isFullScreenSupported(a){const e=a.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&a.fullscreenEnabled)}function isFullScreen(a){return!!(a.webkitIsFullScreen||a.fullscreenElement)}function requestFullScreen(a){a.requestFullscreen?a.requestFullscreen():a.webkitRequestFullscreen&&a.webkitRequestFullscreen()}function requestFullScreenWithKeys(a){a.webkitRequestFullscreen?a.webkitRequestFullscreen():requestFullScreen(a)}function exitFullScreen(a){a.exitFullscreen?a.exitFullscreen():a.webkitExitFullscreen&&a.webkitExitFullscreen()}const Direction={VERTICAL:0,HORIZONTAL:1};class ZoomSlider extends Control{constructor(e){e=e||{},super({target:e.target,element:document.createElement("div"),render:e.render}),this.dragListenerKeys_=[],this.currentResolution_=void 0,this.direction_=Direction.VERTICAL,this.dragging_,this.heightLimit_=0,this.widthLimit_=0,this.startX_,this.startY_,this.thumbSize_=null,this.sliderInitialized_=!1,this.duration_=e.duration!==void 0?e.duration:200;const t=e.className!==void 0?e.className:"ol-zoomslider",i=document.createElement("button");i.setAttribute("type","button"),i.className=t+"-thumb "+CLASS_UNSELECTABLE;const s=this.element;s.className=t+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,s.appendChild(i),s.addEventListener(EventType$1.POINTERDOWN,this.handleDraggerStart_.bind(this),!1),s.addEventListener(EventType$1.POINTERMOVE,this.handleDraggerDrag_.bind(this),!1),s.addEventListener(EventType$1.POINTERUP,this.handleDraggerEnd_.bind(this),!1),s.addEventListener(EventType.CLICK,this.handleContainerClick_.bind(this),!1),i.addEventListener(EventType.CLICK,stopPropagation,!1)}setMap(e){super.setMap(e),e&&e.render()}initSlider_(){const e=this.element;let t=e.offsetWidth,i=e.offsetHeight;if(t===0&&i===0)return this.sliderInitialized_=!1;const s=getComputedStyle(e);t-=parseFloat(s.paddingRight)+parseFloat(s.paddingLeft),i-=parseFloat(s.paddingTop)+parseFloat(s.paddingBottom);const n=e.firstElementChild,o=getComputedStyle(n),l=n.offsetWidth+parseFloat(o.marginRight)+parseFloat(o.marginLeft),h=n.offsetHeight+parseFloat(o.marginTop)+parseFloat(o.marginBottom);return this.thumbSize_=[l,h],t>i?(this.direction_=Direction.HORIZONTAL,this.widthLimit_=t-l):(this.direction_=Direction.VERTICAL,this.heightLimit_=i-h),this.sliderInitialized_=!0}handleContainerClick_(e){const t=this.getMap().getView(),i=this.getRelativePosition_(e.offsetX-this.thumbSize_[0]/2,e.offsetY-this.thumbSize_[1]/2),s=this.getResolutionForPosition_(i),n=t.getConstrainedZoom(t.getZoomForResolution(s));t.animateInternal({zoom:n,duration:this.duration_,easing:easeOut})}handleDraggerStart_(e){if(!this.dragging_&&e.target===this.element.firstElementChild){const t=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=e.clientX-parseFloat(t.style.left),this.startY_=e.clientY-parseFloat(t.style.top),this.dragging_=!0,this.dragListenerKeys_.length===0){const i=this.handleDraggerDrag_,s=this.handleDraggerEnd_,n=this.getMap().getOwnerDocument();this.dragListenerKeys_.push(listen(n,EventType$1.POINTERMOVE,i,this),listen(n,EventType$1.POINTERUP,s,this))}}}handleDraggerDrag_(e){if(this.dragging_){const t=e.clientX-this.startX_,i=e.clientY-this.startY_,s=this.getRelativePosition_(t,i);this.currentResolution_=this.getResolutionForPosition_(s),this.getMap().getView().setResolution(this.currentResolution_)}}handleDraggerEnd_(e){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(unlistenByKey),this.dragListenerKeys_.length=0)}setThumbPosition_(e){const t=this.getPositionForResolution_(e),i=this.element.firstElementChild;this.direction_==Direction.HORIZONTAL?i.style.left=this.widthLimit_*t+"px":i.style.top=this.heightLimit_*t+"px"}getRelativePosition_(e,t){let i;return this.direction_===Direction.HORIZONTAL?i=e/this.widthLimit_:i=t/this.heightLimit_,clamp(i,0,1)}getResolutionForPosition_(e){return this.getMap().getView().getResolutionForValueFunction()(1-e)}getPositionForResolution_(e){const t=this.getMap().getView().getValueForResolutionFunction();return clamp(1-t(e),0,1)}render(e){if(!e.frameState||!this.sliderInitialized_&&!this.initSlider_())return;const t=e.frameState.viewState.resolution;this.currentResolution_=t,this.setThumbPosition_(t)}}const MAX_RATIO=.75,MIN_RATIO=.1;class OverviewMap extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const t=e.className!==void 0?e.className:"ol-overviewmap",i=e.tipLabel!==void 0?e.tipLabel:"Overview map",s=e.collapseLabel!==void 0?e.collapseLabel:"";typeof s=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=s):this.collapseLabel_=s;const n=e.label!==void 0?e.label:"";typeof n=="string"?(this.label_=document.createElement("span"),this.label_.textContent=n):this.label_=n;const o=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,l=document.createElement("button");l.setAttribute("type","button"),l.title=i,l.appendChild(o),l.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const h=new Map$1({view:e.view,controls:new Collection,interactions:new Collection});this.ovmap_=h,e.layers&&e.layers.forEach(function(y){h.addLayer(y)});const c=document.createElement("div");c.className="ol-overviewmap-box",c.style.boxSizing="border-box",this.boxOverlay_=new Overlay({position:[0,0],positioning:"center-center",element:c}),this.ovmap_.addOverlay(this.boxOverlay_);const d=t+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL+(this.collapsed_&&this.collapsible_?" "+CLASS_COLLAPSED:"")+(this.collapsible_?"":" ol-uncollapsible"),u=this.element;u.className=d,u.appendChild(this.ovmapDiv_),u.appendChild(l);const f=this.boxOverlay_,_=this.boxOverlay_.getElement(),g=y=>({clientX:y.clientX,clientY:y.clientY}),v=function(y){const b=g(y),C=h.getEventCoordinate(b);f.setPosition(C)},p=y=>{const b=h.getEventCoordinateInternal(y),C=this.getMap();C.getView().setCenterInternal(b);const T=C.getOwnerDocument();T.removeEventListener("pointermove",v),T.removeEventListener("pointerup",p)};this.ovmapDiv_.addEventListener("pointerdown",y=>{const b=this.getMap().getOwnerDocument();y.target===_&&b.addEventListener("pointermove",v),b.addEventListener("pointerup",p)})}setMap(e){const t=this.getMap();if(e!==t){if(t){const i=t.getView();i&&this.unbindView_(i),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(listen(e,ObjectEventType.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const i=e.getView();i&&this.bindView_(i),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===MapProperty.VIEW){const t=e.oldValue;t&&this.unbindView_(t);const i=this.getMap().getView();this.bindView_(i)}else!this.ovmap_.isRendered()&&(e.key===MapProperty.TARGET||e.key===MapProperty.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const t=new View({projection:e.getProjection()});this.ovmap_.setView(t)}e.addChangeListener(ViewProperty.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_(),e.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())}unbindView_(e){e.removeChangeListener(ViewProperty.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),n=e.getView().calculateExtentInternal(i);if(this.viewExtent_&&equals$2(n,this.viewExtent_))return;this.viewExtent_=n;const o=t.getSize(),h=t.getView().calculateExtentInternal(o),c=t.getPixelFromCoordinateInternal(getTopLeft(n)),d=t.getPixelFromCoordinateInternal(getBottomRight(n)),u=Math.abs(c[0]-d[0]),f=Math.abs(c[1]-d[1]),_=o[0],g=o[1];u<_*MIN_RATIO||f<g*MIN_RATIO||u>_*MAX_RATIO||f>g*MAX_RATIO?this.resetExtent_():containsExtent(h,n)||this.recenter_()}resetExtent_(){const e=this.getMap(),t=this.ovmap_,i=e.getSize(),n=e.getView().calculateExtentInternal(i),o=t.getView(),l=Math.log(MAX_RATIO/MIN_RATIO)/Math.LN2,h=1/(Math.pow(2,l/2)*MIN_RATIO);scaleFromCenter(n,h),o.fitInternal(fromExtent(n))}recenter_(){const e=this.getMap(),t=this.ovmap_,i=e.getView();t.getView().setCenterInternal(i.getCenterInternal())}updateBox_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),s=e.getView(),n=t.getView(),o=this.rotateWithView_?0:-s.getRotation(),l=this.boxOverlay_,h=this.boxOverlay_.getElement(),c=s.getCenter(),d=s.getResolution(),u=n.getResolution(),f=i[0]*d/u,_=i[1]*d/u;if(l.setPosition(c),h){h.style.width=f+"px",h.style.height=_+"px";const g="rotate("+o+"rad)";h.style.transform=g}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=listenOnce(this.ovmap_,MapEventType.POSTRENDER,e=>{delete this.ovmapPostrenderKey_,this.updateBox_()}))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(CLASS_COLLAPSED),this.collapsed_?replaceNode(this.collapseLabel_,this.label_):replaceNode(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}}class ZoomToExtent extends Control{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.extent=e.extent?e.extent:null,this.fitOptions=e.fitOptions||{};const t=e.className!==void 0?e.className:"ol-zoom-extent",i=e.label!==void 0?e.label:"E",s=e.tipLabel!==void 0?e.tipLabel:"Fit to extent",n=document.createElement("button");n.setAttribute("type","button"),n.title=s,n.appendChild(typeof i=="string"?document.createTextNode(i):i),n.addEventListener(EventType.CLICK,this.handleClick_.bind(this),!1);const o=t+" "+CLASS_UNSELECTABLE+" "+CLASS_CONTROL,l=this.element;l.className=o,l.appendChild(n)}handleClick_(e){e.preventDefault(),this.handleZoomToExtent()}handleZoomToExtent(){const t=this.getMap().getView(),i=this.extent?fromUserExtent(this.extent,t.getProjection()):t.getProjection().getExtent();t.fitInternal(fromExtent(i),this.fitOptions)}}const PROJECTION="projection",COORDINATE_FORMAT="coordinateFormat";class MousePosition extends Control{constructor(e){e=e||{};const t=document.createElement("div");t.className=e.className!==void 0?e.className:"ol-mouse-position",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un,this.addChangeListener(PROJECTION,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=e.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?e.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=e.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(COORDINATE_FORMAT)}getProjection(){return this.get(PROJECTION)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){const t=e.getViewport();this.listenerKeys.push(listen(t,EventType$1.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(listen(t,EventType$1.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(COORDINATE_FORMAT,e)}setProjection(e){this.set(PROJECTION,get(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){const n=this.getProjection();n?this.transform_=getTransformFromProjections(this.mapProjection_,n):this.transform_=identityTransform}const s=this.getMap().getCoordinateFromPixelInternal(e);if(s){if(this.transform_(s,s),this.wrapX_){const o=this.getProjection()||this.mapProjection_;wrapX(s,o)}const n=this.getCoordinateFormat();n?t=n(s):t=s.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}}const Property={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},GeolocationErrorType={ERROR:"error"};class GeolocationError extends BaseEvent{constructor(e){super(GeolocationErrorType.ERROR),this.code=e.code,this.message=e.message}}class Geolocation extends BaseObject{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=identityTransform,this.watchId_=void 0,this.addChangeListener(Property.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(Property.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=getTransformFromProjections(get("EPSG:4326"),e),this.position_&&this.set(Property.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(Property.ACCURACY,t.accuracy),this.set(Property.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(Property.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(Property.HEADING,t.heading===null?void 0:toRadians(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const i=this.transform_(this.position_);this.set(Property.POSITION,i.slice()),this.set(Property.SPEED,t.speed===null?void 0:t.speed);const s=circular(this.position_,t.accuracy);s.applyTransform(this.transform_),this.set(Property.ACCURACY_GEOMETRY,s),this.changed()}positionError_(e){this.dispatchEvent(new GeolocationError(e))}getAccuracy(){return this.get(Property.ACCURACY)}getAccuracyGeometry(){return this.get(Property.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(Property.ALTITUDE)}getAltitudeAccuracy(){return this.get(Property.ALTITUDE_ACCURACY)}getHeading(){return this.get(Property.HEADING)}getPosition(){return this.get(Property.POSITION)}getProjection(){return this.get(Property.PROJECTION)}getSpeed(){return this.get(Property.SPEED)}getTracking(){return this.get(Property.TRACKING)}getTrackingOptions(){return this.get(Property.TRACKING_OPTIONS)}setProjection(e){this.set(Property.PROJECTION,get(e))}setTracking(e){this.set(Property.TRACKING,e)}setTrackingOptions(e){this.set(Property.TRACKING_OPTIONS,e)}}class GeolocationControl extends Control{constructor(e){const t=e||{},i=document.createElement("div");i.className="geolocation ol-unselectable ol-control";const s=document.createElement("button");s.title="Show your location",s.innerHTML=t.buttonIcon?`
      <img src="${t.buttonIcon}" alt="Geolocation" />
    `:`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>crosshairs-gps</title><path d="M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M3.05,13H1V11H3.05C3.5,6.83 6.83,3.5 11,3.05V1H13V3.05C17.17,3.5 20.5,6.83 20.95,11H23V13H20.95C20.5,17.17 17.17,20.5 13,20.95V23H11V20.95C6.83,20.5 3.5,17.17 3.05,13M12,5A7,7 0 0,0 5,12A7,7 0 0,0 12,19A7,7 0 0,0 19,12A7,7 0 0,0 12,5Z" /></svg>
    `,i.appendChild(s),super({element:i}),this._centerWhenReady=t.centerWhenReady,this._highAccuracy=t.highAccuracy,this._trackAccuracy=t.trackAccuracy,this._trackHeading=t.trackHeading,this._positionFeature=new Feature({geometry:new Point([NaN,NaN]),heading:0}),this._source=new VectorSource({features:[this._positionFeature]}),this._trackAccuracy&&(this._accuracyFeature=new Feature,this._accuracyFeature.setStyle(new Style({fill:new Fill({color:"rgba(0, 0, 0, 0.2)"}),stroke:new Stroke({width:2,color:"rgba(0, 0, 0, 0.7)"})})),this._source.addFeature(this._accuracyFeature)),this._layer=new VectorLayer({source:this._source}),t.style&&this._layer.setStyle(t.style),s.addEventListener("click",this.centerOnPosition.bind(this),!1)}setMap(e){this._layer.setMap(e),super.setMap(e),e&&this._centerWhenReady&&this.initGeolocation()}initGeolocation(){return new Promise((e,t)=>{const i=this.getMap();i&&(this._geolocation=new Geolocation({tracking:!0,trackingOptions:{enableHighAccuracy:this._highAccuracy},projection:i.getView().getProjection()})),this._centerWhenReady&&this._geolocation.once("change:position",s=>{i.getView().setCenter(s.target.getPosition())}),this._geolocation.on("error",s=>t(s)),this._geolocation.on("change:accuracyGeometry",()=>{this._trackAccuracy&&this._accuracyFeature.setGeometry(this._geolocation.getAccuracyGeometry())}),this._geolocation.on("change:heading",s=>{this._trackHeading&&this._highAccuracy&&this._positionFeature.set("heading",s.target.getHeading())}),this._geolocation.on("change:position",()=>{const s=this._geolocation.getPosition();this._positionFeature.getGeometry().setCoordinates(s||null),e(s)})})}getElement(){return this.element}async centerOnPosition(){var e,t;try{await this.initGeolocation();const i=(e=this._geolocation)==null?void 0:e.getPosition();i&&((t=this.getMap())==null||t.getView().setCenter(i))}catch(i){console.error(i)}}}class LoadingIndicatorControl extends Control{constructor(e){const t=e||{};t.opacity===void 0&&(t.opacity=1),t.type===void 0&&(t.type="small");const i=document.createElement("div");i.className="LoadingIndicator ol-unselectable ol-control",i.classList.add("loading-indicator"),i.style.opacity=String(t.opacity),t.spinnerSvg?i.innerHTML=t.spinnerSvg:i.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" width="50" height="50" style="shape-rendering: auto; display: block; background: transparent;" xmlns:xlink="http://www.w3.org/1999/xlink"><g><circle stroke-dasharray="164.93361431346415 56.97787143782138" r="35" stroke-width="12" stroke="#1a467c" fill="none" cy="50" cx="50">
      <animateTransform keyTimes="0;1" values="0 50 50;360 50 50" dur="1.2222222222222223s" repeatCount="indefinite" type="rotate" attributeName="transform"></animateTransform>
      </circle></g></svg>`,t.type==="fullscreen"?i.classList.add("fullscreen"):i.classList.add("small"),super({element:i})}setMap(e){super.setMap(e),e&&(e.on("loadstart",()=>{this.getElement().style.visibility="visible"}),e.on("loadend",()=>{this.getElement().style.visibility="hidden"}))}getElement(){return this.element}}const availableControls={Zoom,Rotate,ScaleLine,FullScreen,ZoomSlider,Attribution,OverviewMap,ZoomToExtent,MousePosition,Geolocation:GeolocationControl,LoadingIndicator:LoadingIndicatorControl};function addOrUpdateControl(a,e,t,i){e&&e[t]?serialize(e[t])!==serialize(i)&&(a.removeControl(t),addControl(a,t,i)):addControl(a,t,i)}function addControl(a,e,t){const i=Object.assign({},t);t&&t.layers&&(i.layers=generateLayers(a,t.layers));const s=new availableControls[e](i);a.map.addControl(s),a.mapControls[e]=s}const eoxStyle=`@import"https://eox.at/fonts/inter/inter.css";@import"https://eox.at/fonts/materialdesignicons/materialdesignicons.min.css";:root{--size: 1rem;--font: Inter, Roboto, "Helvetica Neue", "Arial Nova", "Nimbus Sans", Noto Sans, Arial, sans-serif;--font-icon: "Material Symbols Outlined";--speed1: .1s;--speed2: .2s;--speed3: .3s;--speed4: .4s;--active: rgb(128 128 128 / .192);--overlay: rgb(0 0 0 / .5);--elevate1: 0 .125rem .125rem 0 rgb(0 0 0 / .32);--elevate2: 0 .25rem .5rem 0 rgb(0 0 0 / .4);--elevate3: 0 .375rem .75rem 0 rgb(0 0 0 / .48);--top: env(safe-area-inset-top);--bottom: env(safe-area-inset-bottom);--left: env(safe-area-inset-left);--right: env(safe-area-inset-right)}:root,body.light{--primary: #6750a4;--on-primary: #ffffff;--primary-container: #e9ddff;--on-primary-container: #22005d;--secondary: #625b71;--on-secondary: #ffffff;--secondary-container: #e8def8;--on-secondary-container: #1e192b;--tertiary: #7e5260;--on-tertiary: #ffffff;--tertiary-container: #ffd9e3;--on-tertiary-container: #31101d;--error: #ba1a1a;--on-error: #ffffff;--error-container: #ffdad6;--on-error-container: #410002;--background: #fffbff;--on-background: #1c1b1e;--surface: #fdf8fd;--on-surface: #1c1b1e;--surface-variant: #e7e0eb;--on-surface-variant: #49454e;--outline: #7a757f;--outline-variant: #cac4cf;--shadow: #000000;--scrim: #000000;--inverse-surface: #313033;--inverse-on-surface: #f4eff4;--inverse-primary: #cfbcff;--surface-dim: #ddd8dd;--surface-bright: #fdf8fd;--surface-container-lowest: #ffffff;--surface-container-low: #f7f2f7;--surface-container: #f2ecf1;--surface-container-high: #ece7eb;--surface-container-highest: #e6e1e6}body.dark{--primary: #cfbcff;--on-primary: #381e72;--primary-container: #4f378a;--on-primary-container: #e9ddff;--secondary: #cbc2db;--on-secondary: #332d41;--secondary-container: #4a4458;--on-secondary-container: #e8def8;--tertiary: #efb8c8;--on-tertiary: #4a2532;--tertiary-container: #633b48;--on-tertiary-container: #ffd9e3;--error: #ffb4ab;--on-error: #690005;--error-container: #93000a;--on-error-container: #ffb4ab;--background: #1c1b1e;--on-background: #e6e1e6;--surface: #141316;--on-surface: #e6e1e6;--surface-variant: #49454e;--on-surface-variant: #cac4cf;--outline: #948f99;--outline-variant: #49454e;--shadow: #000000;--scrim: #000000;--inverse-surface: #e6e1e6;--inverse-on-surface: #313033;--inverse-primary: #6750a4;--surface-dim: #141316;--surface-bright: #3a383c;--surface-container-lowest: #0f0e11;--surface-container-low: #1c1b1e;--surface-container: #201f22;--surface-container-high: #2b292d;--surface-container-highest: #363438}@font-face{font-family:Material Symbols Outlined;font-style:normal;font-weight:400;font-display:block;src:url(/assets/material-symbols-outlined.BZinq3R6.woff2?no-inline) format("woff2"),url(https://cdn.jsdelivr.net/npm/beercss@3.12.13/dist/cdn/material-symbols-outlined.woff2) format("woff2")}@font-face{font-family:Material Symbols Rounded;font-style:normal;font-weight:400;font-display:block;src:url(/assets/material-symbols-rounded.DVluyMkh.woff2?no-inline) format("woff2"),url(https://cdn.jsdelivr.net/npm/beercss@3.12.13/dist/cdn/material-symbols-rounded.woff2) format("woff2")}@font-face{font-family:Material Symbols Sharp;font-style:normal;font-weight:400;font-display:block;src:url(/assets/material-symbols-sharp.DQLBrjHA.woff2?no-inline) format("woff2"),url(https://cdn.jsdelivr.net/npm/beercss@3.12.13/dist/cdn/material-symbols-sharp.woff2) format("woff2")}@font-face{font-family:Material Symbols Subset;font-style:normal;font-weight:400;font-display:block;src:url(data:font/woff2;base64,d09GMgABAAAAAAeoABEAAAAAEhgAAAdHAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHIM+BmA/U1RBVHAnFgCBDC8sEQgKkGyNSQs8ADCCSAE2AiQDPAQgBYVCByAMBxsTDxHVpB7INFIWzt8P4mutt9/QAgYIUN3acHkkH/VJRx8IFTZiDP7drAkkK3no7pmka0ppHW8d6hJMAhXVv1VPT9w5E//5+7381zqd1U8c0Br5vXPvj/POslM/rhqomirEizJIRvR1qGPaS5qWyFMRyxvljU6yTrgFIMmKi9nPdSBHcLDB4QmVB35LKcAiEpzZ15KDS0GtXL1xJ/nFYzcvk2NyJXmP6m+urp+4eJOe1y+eO0POURUUY3EENz4hG+zIndBY1EBhZpbiO3GAT5Z7juIsMYqpvb1pepJS0J0+DCSjP/3oZ7E3fr2cbpTk9KCkQOhdyHh/eheMMoQZEQWlKVrSl150p8NFA2ZgKtiHAQgK2vdtJx2VZq8ZS8+4GFvcuCOiGrf0uZUNhFZSz3qpDIHYqN70eJueSI7RXfIMy1zDxqJFiba/lLjFmi1b1tDF0L+RGepfQ6oZzYGPZxXdpbuAoUyogUIx1HNTeCZq9bqNG/NccM32ZStFkCtXb9wXhbpz5uxN0WimMpK+olfTKAnkGag23pIKJSl9oyhOSRJpDU6wSdJddA2jl7I0XgQg3QLS2dASvIsX7UuJJmQoRzjFOa5wnVvc/fnjz5y/kfcCVjvCMc5ygevcDJrNPKH/79v9N//Ff/Yf/Qf/rv9S6O3js8Gc3CnKYaMSMqmMbuxppfCN0BdjNk2Q4DJLvKdIaNDGe35io96F6AcFyEzIvlWSeXuY8TUvEKvPR7129XaWej0xWmvdM017piu7snQlGhTAxgWXKYrGxnGapqFxvfM8TyIT9g5DkwSFO35g/zm7d2+2Xw6kJx40m02pWq1W8rDRaFCr1+u7H7akasYP6tQaB6pKXKsVa38mZCq7KHvY86BDbNWZFA/bMbW2+HLhDBa+i+RVJaaqzpzZvnP31r0Fgq3szKRbHzKE0fXKKRlLU+P9OStKy73FVJD42YCvslJZThj5bFci4/HYNpp1yAWHyqhJJ/ZuZ5azR1577Q2RorgWmX399devJdFoNMqipzNflDBqKKBcHZQwRKKUEpqVKiSEkjMySg0ZLQ+t2kqaoPRUuglD6EKZ9bEkrhHPuZHVVLE1WjZGQhjSTjYwhGY72BiJfeY1ihpuDlTnU5FEzkTRoCBGKSeVlUmkAlLbayqr6+NioqRE0na2B/jhvMRLXKxL6WE9xE3c5ZQaTz6oefD93pucN7kXn3r6JucTy66bnDU32Hm8X1i6bAwGjculpcblYHDZWHo5b0nhxF13TawGjJu+0G1LHX9paVtbqflVJU88bH480RnzXYwGIvYWaqABPKuzSZdf3vnhh83NnQn+nDDg6xaWXLC49I6loqXCRb5mUJZC//cffzx14UI4PNX781eud1+4PtAR7gwn3bjTtmOXDYL4a+3RnFCKKeMFaiCrMD10tKpBzFkpLk1PTik1Fa9YDxcXpMYlFsQXH8bvirIjO3qqcsdranPHeiqP7CjTDa9v0ZZVyjNqns1Oqd3Ay7aa+zY6MvXejMXXJiY2eGR2LldnqGEyyqu7tJPrIYij+384d1Z29oez+7flbO+/qX9KNn1Tb/92COKVtofeDllDPz2VC0Gs2aLZUifW6TQ66Kxdl3ZZrdauS7uswRtzPPfYbPSX24V7gtm7/t+HyF18+EkbnGL7D6oa2vqDql2s/NNERz77o+TzPxrpvX9CEBtiLbRRWiE27jHS1/6PDxTnfj51u/r2n0+dO/vzmVvVt/585kz+2D39i+rFewbGJu7uX1Iv3dMHt0Vdv2T3BuZ5/o5L+TuMZaa0tHK94Y5G/sONjapv4nErP25z2EZ5fKDImd4SLLB0FvfW9I7eLLQ23xoZ7q3qLTZ3BgumtkB2exdri5040cQ2puzjU1Ydb5qxxq66owu7a2wuG37duFrzKfo1o5JN1rUwon4hC3lJr7dZ/62QwAHHMv7v+e9BcPZ/z1AGJijzFJgYPZp2J3DIktMkRokeWvGUKLt4kDPZEo3tN3NXhjunfO7QO8s+f9FV6eMrjUr9r2skfdElf3zXuSd3Ng//E/L/aRVGq7QPI3ClxgtqMxrMS1LSB/Ekirx1Fx0wWQLMEAB1GBGBEzETiu6FHTLsaVHM1UjWkk3qoEgVHlcdAfRaE8NTh05yCnqKl0ugoErkUtThNzmNPFyQM7gCS/JVyIK1vYrDhVqitLRPmpFTYJEsl+AycNFSyJShCO1X0yIIZMgBDqsBWsSjCW0oUIpFBdgRQqVyLOqFD20ozIjywxm05VC6XQ/cyEYL7HDBjSyAGM/Ihx1tJqoF/mIVS9ENAQ5ErH0rCtGOIcgLww1XnQV3owRueI0AWXa0oIKMrfjREYTBQYs9SIYGCdydcdg5h34cusXVY/wv6JCNQhQiG7rWN3LRZi0umo4ImtBN4x8EhCtqoEUCOGRjRgRehMxuHPKQh3TsAQcOFgS5OopPq3hqbQV11EF7/j90Aq3eYG64ExLHb6TnAQAAAA==) format("woff2"),url(https://cdn.jsdelivr.net/npm/beercss@3.12.13/dist/cdn/material-symbols-subset.woff2) format("woff2")}*{-webkit-tap-highlight-color:transparent;position:relative;vertical-align:middle;color:inherit;margin:0;padding:0;border-radius:inherit;box-sizing:border-box}*:after,*:before{all:unset}body{color:var(--on-surface);background-color:var(--surface);overflow-x:hidden}label{font-size:.75rem;vertical-align:baseline}a,b,i,span,strong,em,code{vertical-align:baseline}a,button,.button{cursor:pointer;text-decoration:none;display:inline-flex;align-items:center;border:none;font-family:inherit;outline:inherit;justify-content:center}a,button,.button,i,label{-webkit-user-select:none;user-select:none}@media (pointer: fine){body ::-webkit-scrollbar,body ::-webkit-scrollbar-thumb,body ::-webkit-scrollbar-button{background:none;inline-size:.4rem;block-size:.4rem}body :is(:focus,:hover)::-webkit-scrollbar-thumb,body :has(:focus,:hover)::-webkit-scrollbar-thumb{background:var(--outline);border-radius:1rem}}:not(.grid,nav,.row)>:not(progress.max)+:is(address,article,blockquote,code,.field,fieldset,form,.grid,h1,h2,h3,h4,h5,h6,nav,ol,p,pre,.row,section,aside,table,.tabs,ul):not([class*=margin],.right,.left,.top,.bottom){margin-block-start:1rem}:has(>[class*=margin]){padding:.1px}:is(a,button,.button,.chip):focus-visible{outline:.125rem solid var(--primary);outline-offset:.25rem}:is(nav,.row,li).group>:focus-visible{z-index:1}:is(button,.button,.chip)>:is(span,i,img,svg){pointer-events:none}.transparent{background-color:transparent!important;box-shadow:none!important;color:inherit!important}.primary{background-color:var(--primary)!important;color:var(--on-primary)!important}.primary-text{color:var(--primary)!important}.primary-border{border-color:var(--primary)!important}.primary-container{background-color:var(--primary-container)!important;color:var(--on-primary-container)!important}.secondary{background-color:var(--secondary)!important;color:var(--on-secondary)!important}.secondary-text{color:var(--secondary)!important}.secondary-border{border-color:var(--secondary)!important}.secondary-container{background-color:var(--secondary-container)!important;color:var(--on-secondary-container)!important}.tertiary{background-color:var(--tertiary)!important;color:var(--on-tertiary)!important}.tertiary-text{color:var(--tertiary)!important}.tertiary-border{border-color:var(--tertiary)!important}.tertiary-container{background-color:var(--tertiary-container)!important;color:var(--on-tertiary-container)!important}.error{background-color:var(--error)!important;color:var(--on-error)!important}.error-text{color:var(--error)!important}.error-border{border-color:var(--error)!important}.error-container{background-color:var(--error-container)!important;color:var(--on-error-container)!important}.background{background-color:var(--background)!important;color:var(--on-background)!important}.surface,.surface-dim,.surface-bright,.surface-container-lowest,.surface-container-low,.surface-container,.surface-container-high,.surface-container-highest{background-color:var(--surface)!important;color:var(--on-surface)!important}.surface-variant{background-color:var(--surface-variant)!important;color:var(--on-surface-variant)!important}.inverse-surface{background-color:var(--inverse-surface);color:var(--inverse-on-surface)}.inverse-primary{background-color:var(--inverse-primary);color:var(--primary)}.inverse-primary-text{color:var(--inverse-primary)!important}.inverse-primary-border{border-color:var(--inverse-primary)!important}.surface-dim{background-color:var(--surface-dim)!important}.surface-bright{background-color:var(--surface-bright)!important}.surface-container-lowest{background-color:var(--surface-container-lowest)!important}.surface-container{background-color:var(--surface-container)!important}.surface-container-high{background-color:var(--surface-container-high)!important}.surface-container-highest{background-color:var(--surface-container-highest)!important}.surface-container-low{background-color:var(--surface-container-low)!important}.black{background-color:#000!important}.black-border{border-color:#000!important}.black-text{color:#000!important}.white{background-color:#fff!important}.white-border{border-color:#fff!important}.white-text{color:#fff!important}.transparent-border{border-color:transparent!important}.transparent-text{color:transparent!important}.fill:not(i){background-color:var(--surface-variant)!important;color:var(--on-surface-variant)!important}.middle-align{display:flex;align-items:center!important}.bottom-align{display:flex;align-items:flex-end!important}.top-align{display:flex;align-items:flex-start!important}.left-align{text-align:start;justify-content:flex-start!important}.right-align{text-align:end;justify-content:flex-end!important}.center-align{text-align:center;justify-content:center!important}[class*=blur],[class*=blur].light{--_blur: 1rem;-webkit-backdrop-filter:blur(var(--_blur));backdrop-filter:blur(var(--_blur));color:var(--on-surface);background-color:#ffffff80!important}.dark [class*=blur],[class*=blur].dark{background-color:#00000080!important}.small-blur{--_blur: .5rem}.large-blur{--_blur: 1.5rem}.red,.red6{background-color:#f44336!important}.red-border{border-color:#f44336!important}.red-text{color:#f44336!important}.red1{background-color:#ffebee!important}.red2{background-color:#ffcdd2!important}.red3{background-color:#ef9a9a!important}.red4{background-color:#e57373!important}.red5{background-color:#ef5350!important}.red7{background-color:#e53935!important}.red8{background-color:#d32f2f!important}.red9{background-color:#c62828!important}.red10{background-color:#b71c1c!important}.pink,.pink6{background-color:#e91e63!important}.pink-border{border-color:#e91e63!important}.pink-text{color:#e91e63!important}.pink1{background-color:#fce4ec!important}.pink2{background-color:#f8bbd0!important}.pink3{background-color:#f48fb1!important}.pink4{background-color:#f06292!important}.pink5{background-color:#ec407a!important}.pink7{background-color:#d81b60!important}.pink8{background-color:#c2185b!important}.pink9{background-color:#ad1457!important}.pink10{background-color:#880e4f!important}.purple,.purple6{background-color:#9c27b0!important}.purple-border{border-color:#9c27b0!important}.purple-text{color:#9c27b0!important}.purple1{background-color:#f3e5f5!important}.purple2{background-color:#e1bee7!important}.purple3{background-color:#ce93d8!important}.purple4{background-color:#ba68c8!important}.purple5{background-color:#ab47bc!important}.purple7{background-color:#8e24aa!important}.purple8{background-color:#7b1fa2!important}.purple9{background-color:#6a1b9a!important}.purple10{background-color:#4a148c!important}.deep-purple,.deep-purple6{background-color:#673ab7!important}.deep-purple-border{border-color:#673ab7!important}.deep-purple-text{color:#673ab7!important}.deep-purple1{background-color:#ede7f6!important}.deep-purple2{background-color:#d1c4e9!important}.deep-purple3{background-color:#b39ddb!important}.deep-purple4{background-color:#9575cd!important}.deep-purple5{background-color:#7e57c2!important}.deep-purple7{background-color:#5e35b1!important}.deep-purple8{background-color:#512da8!important}.deep-purple9{background-color:#4527a0!important}.deep-purple10{background-color:#311b92!important}.indigo,.indigo6{background-color:#3f51b5!important}.indigo-border{border-color:#3f51b5!important}.indigo-text{color:#3f51b5!important}.indigo1{background-color:#e8eaf6!important}.indigo2{background-color:#c5cae9!important}.indigo3{background-color:#9fa8da!important}.indigo4{background-color:#7986cb!important}.indigo5{background-color:#5c6bc0!important}.indigo7{background-color:#3949ab!important}.indigo8{background-color:#303f9f!important}.indigo9{background-color:#283593!important}.indigo10{background-color:#1a237e!important}.blue,.blue6{background-color:#2196f3!important}.blue-border{border-color:#2196f3!important}.blue-text{color:#2196f3!important}.blue1{background-color:#e3f2fd!important}.blue2{background-color:#bbdefb!important}.blue3{background-color:#90caf9!important}.blue4{background-color:#64b5f6!important}.blue5{background-color:#42a5f5!important}.blue7{background-color:#1e88e5!important}.blue8{background-color:#1976d2!important}.blue9{background-color:#1565c0!important}.blue10{background-color:#0d47a1!important}.light-blue,.light-blue6{background-color:#03a9f4!important}.light-blue-border{border-color:#03a9f4!important}.light-blue-text{color:#03a9f4!important}.light-blue1{background-color:#e1f5fe!important}.light-blue2{background-color:#b3e5fc!important}.light-blue3{background-color:#81d4fa!important}.light-blue4{background-color:#4fc3f7!important}.light-blue5{background-color:#29b6f6!important}.light-blue7{background-color:#039be5!important}.light-blue8{background-color:#0288d1!important}.light-blue9{background-color:#0277bd!important}.light-blue10{background-color:#01579b!important}.cyan,.cyan6{background-color:#00bcd4!important}.cyan-border{border-color:#00bcd4!important}.cyan-text{color:#00bcd4!important}.cyan1{background-color:#e0f7fa!important}.cyan2{background-color:#b2ebf2!important}.cyan3{background-color:#80deea!important}.cyan4{background-color:#4dd0e1!important}.cyan5{background-color:#26c6da!important}.cyan7{background-color:#00acc1!important}.cyan8{background-color:#0097a7!important}.cyan9{background-color:#00838f!important}.cyan10{background-color:#006064!important}.teal,.teal6{background-color:#009688!important}.teal-border{border-color:#009688!important}.teal-text{color:#009688!important}.teal1{background-color:#e0f2f1!important}.teal2{background-color:#b2dfdb!important}.teal3{background-color:#80cbc4!important}.teal4{background-color:#4db6ac!important}.teal5{background-color:#26a69a!important}.teal7{background-color:#00897b!important}.teal8{background-color:#00796b!important}.teal9{background-color:#00695c!important}.teal10{background-color:#004d40!important}.green,.green6{background-color:#4caf50!important}.green-border{border-color:#4caf50!important}.green-text{color:#4caf50!important}.green1{background-color:#e8f5e9!important}.green2{background-color:#c8e6c9!important}.green3{background-color:#a5d6a7!important}.green4{background-color:#81c784!important}.green5{background-color:#66bb6a!important}.green7{background-color:#43a047!important}.green8{background-color:#388e3c!important}.green9{background-color:#2e7d32!important}.green10{background-color:#1b5e20!important}.light-green,.light-green6{background-color:#8bc34a!important}.light-green-border{border-color:#8bc34a!important}.light-green-text{color:#8bc34a!important}.light-green1{background-color:#f1f8e9!important}.light-green2{background-color:#dcedc8!important}.light-green3{background-color:#c5e1a5!important}.light-green4{background-color:#aed581!important}.light-green5{background-color:#9ccc65!important}.light-green7{background-color:#7cb342!important}.light-green8{background-color:#689f38!important}.light-green9{background-color:#558b2f!important}.light-green10{background-color:#33691e!important}.lime,.lime6{background-color:#cddc39!important}.lime-border{border-color:#cddc39!important}.lime-text{color:#cddc39!important}.lime1{background-color:#f9fbe7!important}.lime2{background-color:#f0f4c3!important}.lime3{background-color:#e6ee9c!important}.lime4{background-color:#dce775!important}.lime5{background-color:#d4e157!important}.lime7{background-color:#c0ca33!important}.lime8{background-color:#afb42b!important}.lime9{background-color:#9e9d24!important}.lime10{background-color:#827717!important}.yellow,.yellow6{background-color:#ffeb3b!important}.yellow-border{border-color:#ffeb3b!important}.yellow-text{color:#ffeb3b!important}.yellow1{background-color:#fffde7!important}.yellow2{background-color:#fff9c4!important}.yellow3{background-color:#fff59d!important}.yellow4{background-color:#fff176!important}.yellow5{background-color:#ffee58!important}.yellow7{background-color:#fdd835!important}.yellow8{background-color:#fbc02d!important}.yellow9{background-color:#f9a825!important}.yellow10{background-color:#f57f17!important}.amber,.amber6{background-color:#ffc107!important}.amber-border{border-color:#ffc107!important}.amber-text{color:#ffc107!important}.amber1{background-color:#fff8e1!important}.amber2{background-color:#ffecb3!important}.amber3{background-color:#ffe082!important}.amber4{background-color:#ffd54f!important}.amber5{background-color:#ffca28!important}.amber7{background-color:#ffb300!important}.amber8{background-color:#ffa000!important}.amber9{background-color:#ff8f00!important}.amber10{background-color:#ff6f00!important}.orange,.orange6{background-color:#ff9800!important}.orange-border{border-color:#ff9800!important}.orange-text{color:#ff9800!important}.orange1{background-color:#fff3e0!important}.orange2{background-color:#ffe0b2!important}.orange3{background-color:#ffcc80!important}.orange4{background-color:#ffb74d!important}.orange5{background-color:#ffa726!important}.orange7{background-color:#fb8c00!important}.orange8{background-color:#f57c00!important}.orange9{background-color:#ef6c00!important}.orange10{background-color:#e65100!important}.deep-orange,.deep-orange6{background-color:#ff5722!important}.deep-orange-border{border-color:#ff5722!important}.deep-orange-text{color:#ff5722!important}.deep-orange1{background-color:#fbe9e7!important}.deep-orange2{background-color:#ffccbc!important}.deep-orange3{background-color:#ffab91!important}.deep-orange4{background-color:#ff8a65!important}.deep-orange5{background-color:#ff7043!important}.deep-orange7{background-color:#f4511e!important}.deep-orange8{background-color:#e64a19!important}.deep-orange9{background-color:#d84315!important}.deep-orange10{background-color:#bf360c!important}.brown,.brown6{background-color:#795548!important}.brown-border{border-color:#795548!important}.brown-text{color:#795548!important}.brown1{background-color:#efebe9!important}.brown2{background-color:#d7ccc8!important}.brown3{background-color:#bcaaa4!important}.brown4{background-color:#a1887f!important}.brown5{background-color:#8d6e63!important}.brown7{background-color:#6d4c41!important}.brown8{background-color:#5d4037!important}.brown9{background-color:#4e342e!important}.brown10{background-color:#3e2723!important}.blue-grey,.blue-grey6{background-color:#607d8b!important}.blue-grey-border{border-color:#607d8b!important}.blue-grey-text{color:#607d8b!important}.blue-grey1{background-color:#eceff1!important}.blue-grey2{background-color:#cfd8dc!important}.blue-grey3{background-color:#b0bec5!important}.blue-grey4{background-color:#90a4ae!important}.blue-grey5{background-color:#78909c!important}.blue-grey7{background-color:#546e7a!important}.blue-grey8{background-color:#455a64!important}.blue-grey9{background-color:#37474f!important}.blue-grey10{background-color:#263238!important}.grey,.grey6{background-color:#9e9e9e!important}.grey-border{border-color:#9e9e9e!important}.grey-text{color:#9e9e9e!important}.grey1{background-color:#fafafa!important}.grey2{background-color:#f5f5f5!important}.grey3{background-color:#eee!important}.grey4{background-color:#e0e0e0!important}.grey5{background-color:#bdbdbd!important}.grey7{background-color:#757575!important}.grey8{background-color:#616161!important}.grey9{background-color:#424242!important}.grey10{background-color:#212121!important}.horizontal{display:inline-flex;flex-direction:row!important;gap:1rem;inline-size:auto!important;max-inline-size:none!important}.horizontal>*{margin-block:0!important}.vertical{display:flex;flex-direction:column!important}:is(a,button,.button,.chip).vertical{display:inline-flex;gap:.25rem;block-size:auto!important;max-block-size:none!important;padding-block:.5rem}.vertical>*{margin-inline:0!important}.no-elevate{box-shadow:none!important}.small-elevate,.elevate{box-shadow:var(--elevate1)!important}.medium-elevate{box-shadow:var(--elevate2)!important}.large-elevate{box-shadow:var(--elevate3)!important}.round,[class*=-round]{--_round: 2rem;border-radius:var(--_round)!important}.small-round{--_round: .5rem}.large-round{--_round: 3.5rem}.no-round,.square,.top-round,.bottom-round,.left-round,.right-round{border-radius:.5rem!important}.top-round{border-start-start-radius:var(--_round)!important;border-start-end-radius:var(--_round)!important}.bottom-round{border-end-end-radius:var(--_round)!important;border-end-start-radius:var(--_round)!important}.left-round{border-start-start-radius:var(--_round)!important;border-end-start-radius:var(--_round)!important}.right-round{border-start-end-radius:var(--_round)!important;border-end-end-radius:var(--_round)!important}.circle:not(.extend){border-radius:50%}:is(.circle,.square):is(button,.button,.chip){padding:0;block-size:var(--_size);inline-size:var(--_size)}:is(.circle,.square)>span{display:none}:is(.circle,.square).round{border-radius:1rem!important}.border:not(table,.field,.list,menu,article){box-sizing:border-box;border:.0625rem solid var(--outline);background-color:transparent;box-shadow:none}.no-border{border-color:transparent!important}.border:not(.extend,.circle,.square,.badge){box-sizing:content-box}.margin,[class*=-margin]:not(.left-margin,.right-margin,.top-margin,.bottom-margin,.horizontal-margin,.vertical-margin){margin:var(--_margin)!important}.margin,[class*=-margin]{--_margin: 1rem}.no-margin{--_margin: 0}.auto-margin{--_margin: auto}.tiny-margin{--_margin: .25rem}.small-margin{--_margin: .5rem}.large-margin{--_margin: 1.5rem}.left-margin,.horizontal-margin{margin-inline-start:var(--_margin)!important}.right-margin,.horizontal-margin{margin-inline-end:var(--_margin)!important}.top-margin,.vertical-margin{margin-block-start:var(--_margin)!important}.bottom-margin,.vertical-margin{margin-block-end:var(--_margin)!important}.no-opacity{opacity:1!important}.opacity{opacity:0!important}.small-opacity{opacity:.75!important}.medium-opacity{opacity:.5!important}.large-opacity{opacity:.25!important}.padding,[class*=-padding]:not(.left-padding,.right-padding,.top-padding,.bottom-padding,.horizontal-padding,.vertical-padding){padding:var(--_padding)!important}.padding,[class*=-padding]{--_padding: 1rem}.no-padding{--_padding: 0 !important}.tiny-padding{--_padding: .25rem !important}.small-padding{--_padding: .5rem !important}.large-padding{--_padding: 1.5rem !important}.left-padding,.horizontal-padding{padding-inline-start:var(--_padding)!important}.right-padding,.horizontal-padding{padding-inline-end:var(--_padding)!important}.top-padding,.vertical-padding{padding-block-start:var(--_padding)!important}.bottom-padding,.vertical-padding{padding-block-end:var(--_padding)!important}.front{z-index:10!important}.back{z-index:-10!important}.left{inset-inline-start:0}.right{inset-inline-end:0}.top{inset-block-start:0}.bottom{inset-block-end:0}.center{inset-inline-start:50%;transform:translate(-50%)}[dir=rtl] .center{transform:translate(50%)}.middle{inset-block-start:50%;transform:translateY(-50%)}.middle.center{transform:translate(-50%,-50%)}[dir=rtl] .middle.center{transform:translate(50%,-50%)}.ripple{--_duration: .6s}.fast-ripple{--_duration: .2s}.slow-ripple{--_duration: 1.8s}.ripple-js{position:absolute;top:0;right:0;bottom:0;left:0;pointer-events:none;overflow:hidden}.ripple-js>div{position:absolute;border-radius:50%;background:currentColor;opacity:.3;transform:scale(0);animation:to-ripple var(--_duration) linear}@keyframes to-ripple{to{transform:scale(4);opacity:0}}.scroll{overflow:auto;min-inline-size:0}.no-scroll{overflow:hidden}.shadow{background-color:#00000050}:is(.left-shadow,.right-shadow,.top-shadow,.bottom-shadow){background-color:transparent!important}.left-shadow{background-image:linear-gradient(to right,black,transparent)!important}.right-shadow{background-image:linear-gradient(to left,black,transparent)!important}.bottom-shadow{background-image:linear-gradient(to top,black,transparent)!important}.top-shadow{background-image:linear-gradient(to bottom,black,transparent)!important}[class*=-width]{max-inline-size:100%}.auto-width{inline-size:auto}.small-width{inline-size:12rem!important}.medium-width{inline-size:24rem!important}.large-width{inline-size:36rem!important}.auto-height{block-size:auto}.small-height{block-size:12rem!important}.medium-height{block-size:24rem!important}.large-height{block-size:36rem!important}.wrap{display:block;white-space:normal}.no-wrap:not(menu){display:flex;white-space:nowrap}.tiny-space:not(nav,.row,.grid,table,.tooltip,.list,menu,.shape){block-size:.5rem}:is(.space,.small-space):not(nav,.row,.grid,table,.tooltip,.list,menu,.shape){block-size:1rem}.medium-space:not(nav,.row,.grid,table,.tooltip,.list,menu,.shape){block-size:2rem}.large-space:not(nav,.row,.grid,table,.tooltip,.list,menu,.shape){block-size:3rem}.extra-space:not(nav,.row,.grid,table,.tooltip,.list,menu,.shape){block-size:4rem}.responsive{inline-size:-webkit-fill-available;inline-size:-moz-available}@media only screen and (max-width: 600px){:is(.m,.l):not(.s){display:none!important}}@media only screen and (min-width: 601px) and (max-width: 992px){:is(.s,.l):not(.m){display:none!important}}@media only screen and (min-width: 993px){:is(.m,.s):not(.l){display:none!important}}html{font-size:var(--size)}body{font-family:var(--font);font-size:.875rem;line-height:1.5rem;letter-spacing:.0313rem}h1,h2,h3,h4,h5,h6{font-weight:400;display:block;align-items:center;line-height:normal}h1{font-size:3.5625rem}h2{font-size:2.8125rem}h3{font-size:2.25rem}h4{font-size:2rem}h5{font-size:1.75rem}h6{font-size:1.5rem}h1.small{font-size:3.0625rem}h2.small{font-size:2.3125rem}h3.small{font-size:1.75rem}h4.small{font-size:1.5rem}h5.small{font-size:1.25rem}h6.small{font-size:1rem}h1.large{font-size:4.0625rem}h2.large{font-size:3.3125rem}h3.large{font-size:2.75rem}h4.large{font-size:2.5rem}h5.large{font-size:2.25rem}h6.large{font-size:2rem}.link{color:var(--primary)!important}.inverse-link{color:var(--inverse-primary)!important}.truncate{overflow:hidden;white-space:nowrap!important;text-overflow:ellipsis;flex:inherit}.truncate>*{white-space:nowrap!important}.small-text{font-size:.75rem}.medium-text{font-size:.875rem}.large-text{font-size:1rem}.upper{text-transform:uppercase}.lower{text-transform:lowercase}.capitalize{text-transform:capitalize}.bold{font-weight:700}.overline{text-decoration:line-through}.underline{text-decoration:underline}.italic{font-style:italic}p{margin:.5rem 0}.no-line{line-height:normal}.tiny-line{line-height:1.25rem}.small-line{line-height:1.5rem}.medium-line{line-height:1.75rem}.large-line{line-height:2rem}.extra-line{line-height:2.25rem}pre{border-radius:0;background-color:var(--surface-container);white-space:pre-wrap;padding:1rem;border-inline-start:.25rem solid var(--primary);font-family:inherit}blockquote{border-radius:0;padding:1rem;border-inline-start:.25rem solid var(--primary);font-family:inherit}code{border-radius:0;background-color:var(--surface-container);white-space:pre-wrap;padding:.25rem}pre>code,blockquote>code{padding:0}.scroll>code{white-space:pre}pre:has(>code){direction:ltr;text-align:start}sub{vertical-align:sub}sup{vertical-align:super}:is(.wave,.chip,.button,button,nav.tabbed>a,.tabs>a,nav.toolbar>a):not(.slow-ripple,.ripple,.fast-ripple):after,nav:is(.left,.right,.bottom,.top).max>a:after,nav:is(.left,.right,.bottom,.top).max>:is(ol,ul)>li>a:after,nav:is(.left,.right,.bottom,.top):not(.max)>a>i:after,nav:is(.left,.right,.bottom,.top):not(.max)>:is(ol,ul)>li>a>i:after{content:"";position:absolute;top:0;right:0;bottom:0;left:0;z-index:1;border-radius:inherit;inline-size:100%;block-size:100%;background-position:center;background-image:radial-gradient(circle,currentColor 1%,transparent 1%);opacity:0;transition:none;pointer-events:none}:is(.wave,.chip,.button,button,nav.tabbed>a,.tabs>a,nav.toolbar>a):not(.slow-ripple,.ripple,.fast-ripple):is(:focus-visible,:hover):after,nav:is(.left,.right,.bottom,.top).max>a:not(.button,.chip):is(:focus-visible,:hover):after,nav:is(.left,.right,.bottom,.top).max>:is(ol,ul)>li>a:not(.button,.chip):is(:focus-visible,:hover):after,nav:is(.left,.right,.bottom,.top):not(.max)>a:not(.button,.chip):is(:focus-visible,:hover)>i:after,nav:is(.left,.right,.bottom,.top):not(.max)>:is(ol,ul)>li>a:not(.button,.chip):is(:focus-visible,:hover)>i:after{background-size:22500%;opacity:.1;transition:background-size var(--speed2) linear}:is(.wave,.chip,.button,button,nav.tabbed>a,.tabs>a,nav.toolbar>a,nav.max>a):not(.slow-ripple,.ripple,.fast-ripple):active:after,nav:is(.left,.right,.bottom,.top).max>a:active:after,nav:is(.left,.right,.bottom,.top).max>:is(ol,ul)>li>a:active:after,nav:is(.left,.right,.bottom,.top):not(.max)>a:active>i:after,nav:is(.left,.right,.bottom,.top):not(.max)>:is(ol,ul)>li>a:active>i:after{background-size:0%;opacity:0;transition:none}.no-wave:after,.no-wave:is(:hover,:active):after{display:none}.zoom,.tiny-zoom{zoom:2}.small-zoom{zoom:3}.medium-zoom{zoom:4}.large-zoom{zoom:5}.extra-zoom{zoom:6}.badge{--_x: 0;--_y: -100%;display:inline-flex;align-items:center;justify-content:center;position:absolute;font-size:.6875rem;text-transform:none;z-index:2;padding:0 .25rem;min-block-size:1rem;min-inline-size:1rem;background-color:var(--error);color:var(--on-error);line-height:normal;border-radius:1rem;inset:50% auto auto 50%;transform:translate(var(--_x, 50%),var(--_y, -50%));font-family:var(--font)}.badge.top{--_y: -100%}.badge.bottom{--_y: 0}.badge.left{--_x: -100%}.badge.right{--_x: 0}.badge.border{border-color:var(--error);color:var(--error);background-color:var(--surface)}.badge:is(.circle,.square){text-align:center;inline-size:auto;block-size:auto;padding:0 .25rem;border-radius:1rem}.badge.square{border-radius:0}.badge.min>*{display:none}.badge.min{clip-path:circle(18.75% at 50% 50%)}nav:is(.left,.right,.top,.bottom)>a>.badge,nav:is(.left,.right,.top,.bottom)>:is(ol,ul)>li>a>.badge{inset:1rem auto auto 50%}.badge.none{inset:auto!important;transform:none;position:relative;margin:0 .125rem}header,footer{display:grid;align-content:center;border-radius:0;padding:0 1rem}:is(dialog,article)>:is(header,footer){padding-inline:0;top:0;right:0;bottom:0;left:0}header{min-block-size:4rem}footer{min-block-size:5rem}:is(header,footer,menu>*).fixed{position:sticky;top:0;right:0;bottom:0;left:0;z-index:11;background-color:inherit}header.fixed{inset:calc(-1 * var(--_padding)) 0 0 0;margin-block-start:calc(-1 * var(--_padding))}footer.fixed{inset:0 0 calc(-1 * var(--_padding)) 0;margin-block-end:calc(-1 * var(--_padding))}:is(header,footer).fixed.min{margin-inline:auto}dialog>:is(header,footer){background:none}dialog>:is(header,footer).fixed{background-color:inherit}:is(main,header,footer,section).responsive{max-inline-size:min(100vw,75rem);margin:0 auto}:is(main,header,footer,section).responsive.max{max-inline-size:none}:has(>main)>:is(header,footer).fixed{transform:none;box-sizing:content-box;position:sticky;top:0;right:0;bottom:0;left:0;z-index:12}:has(>main)>header{padding-block-start:var(--top)}:has(>main)>footer{padding-block-end:var(--bottom)}nav.top~header,nav.bottom~footer{padding-block:0}nav.top~header.fixed{inset-block:calc(var(--top) + 4.5rem) 0}nav.bottom~footer.fixed{inset-block:0 calc(var(--bottom) + 4.5rem)}:is(nav,.row)>header{background-color:inherit}.button,button{--_padding: 1rem;--_size: 2.5rem;box-sizing:content-box;display:inline-flex;align-items:center;justify-content:center;block-size:var(--_size);font-size:.875rem;font-weight:500;color:var(--on-primary);padding:0 var(--_padding);background-color:var(--primary);margin:0 .5rem;border-radius:var(--_size);transition:transform var(--speed3),border-radius var(--speed2),padding var(--speed3);-webkit-user-select:none;user-select:none;gap:.5rem;line-height:normal}:is(button,.button).small{--_size: 2rem;--_padding: .75rem}:is(button,.button).large{--_size: 3rem;--_padding: 1.25rem}:is(.button,button):is(.extra,.extend){--_size: 3.5rem;font-size:1rem;--_padding: 1.5rem}:is(button,.button):is(.square,.circle){--_padding: 0}:is(button,.button).border{border-color:var(--outline-variant);color:var(--primary)}.extend>span{display:none}.extend:is(:hover,.active){inline-size:auto;--_padding: 1.5rem;padding:0 var(--_padding)}.extend:is(:hover,.active)>i+span{display:inherit;margin-inline-start:var(--_padding)}.extend:is(:hover,.active)>:is(img,svg)+span{display:inherit;margin-inline-start:calc(1rem + var(--_padding))}:is(.button,button)[disabled]{opacity:.5;cursor:not-allowed}.button[disabled]{pointer-events:none}:is(.button,button)[disabled]:before,:is(.button,button)[disabled]:after{display:none}:is(.button,button):not(.chip,.extend).fill{background-color:var(--secondary-container)!important;color:var(--on-secondary-container)!important}:is(.button,button):not(.chip,.extend).active{background-color:var(--primary-container);color:var(--on-primary-container)}:is(.button,button):not(.chip,.extend).fill.active{background-color:var(--secondary)!important;color:var(--on-secondary)!important}:is(.button,button):not(.chip,.extend).border.active{background-color:var(--inverse-surface)!important;color:var(--inverse-on-surface)!important;border-color:var(--inverse-surface)!important}:is(.button,button):not(.chip):active,:is(.button,button):not(.chip).active{border-radius:.5rem!important}article{--_padding: 1rem;box-shadow:var(--elevate1);background-color:var(--surface-container-low);color:var(--on-surface);padding:var(--_padding);border-radius:.75rem;display:block;transition:transform var(--speed3),border-radius var(--speed3),padding var(--speed3)}article.small{block-size:12rem}article.medium{block-size:20rem}article.large{block-size:32rem}article.border{box-shadow:none;border:.0625rem solid var(--outline-variant)}.chip{--_padding: .75rem;--_size: 2rem;box-sizing:border-box;display:inline-flex;align-items:center;justify-content:center;block-size:var(--_size);min-inline-size:var(--_size);font-size:.875rem;font-weight:500;background-color:transparent;border:.0625rem solid var(--outline-variant);color:var(--on-surface-variant);padding:0 var(--_padding);margin:0 .5rem;text-transform:none;border-radius:.5rem;transition:transform var(--speed3),border-radius var(--speed3),padding var(--speed3);-webkit-user-select:none;user-select:none;gap:.5rem;line-height:normal;letter-spacing:normal}.chip.medium{--_size: 2.5rem;--_padding: 1rem}.chip.large{--_padding: 1.25rem;--_size: 3rem}.chip.fill{border:none}dialog{--_padding: 1.5rem;--_top: calc(var(--_padding) + var(--top));--_bottom: calc(var(--_padding) + var(--bottom));display:block;visibility:hidden;border:none;opacity:0;position:fixed;box-shadow:var(--elevate2);color:var(--on-surface);background-color:var(--surface-container-high);padding:var(--_padding);z-index:100;inset:10% auto auto 50%;min-inline-size:20rem;max-inline-size:100%;max-block-size:80%;overflow-x:hidden;overflow-y:auto;transition:all var(--speed3),0s background-color;border-radius:1.75rem;transform:translate(-50%,-4rem);outline:none}dialog.small{inline-size:25%;block-size:25%}dialog.medium{inline-size:50%;block-size:50%}dialog.large{inline-size:75%;block-size:75%}dialog:is(.active,[open]){visibility:visible;opacity:1;transform:translate(-50%)}dialog:popover-open{visibility:visible;opacity:1;transform:translate(-50%)}dialog:is(.top,.right,.bottom,.left,.max){--_padding: 1rem}dialog:is(.top,.bottom){opacity:1;block-size:auto;inline-size:100%;min-inline-size:auto;max-block-size:100%}dialog.top{inset:0 auto auto 0;transform:translateY(-100%);border-radius:0 0 1rem 1rem;padding-block-start:var(--_top)}dialog.bottom{inset:auto auto 0 0;transform:translateY(100%);border-radius:1rem 1rem 0 0;padding-block-end:var(--_bottom)}dialog:is(.left,.right){opacity:1;inset:0 auto auto 0;inline-size:auto;block-size:100%;max-block-size:100%;background-color:var(--surface);padding-block:var(--_top) var(--_bottom)}[dir=rtl] dialog.right,dialog.left{inset:0 auto auto 0;border-radius:0 1rem 1rem 0;transform:translate(-100%)}[dir=rtl] dialog.left,dialog.right{inset:0 0 auto auto;border-radius:1rem 0 0 1rem;transform:translate(100%)}dialog.max{inset:0 auto auto 0;inline-size:100%;block-size:100%;max-inline-size:100%;max-block-size:100%;transform:translateY(4rem);background-color:var(--surface);border-radius:0;padding-block:var(--_top) var(--_bottom)}dialog:is(.active,[open]):is(.left,.right,.top,.bottom,.max){transform:translate(0)}dialog:popover-open:is(.left,.right,.top,.bottom,.max){transform:translate(0)}dialog.small:is(.left,.right){inline-size:20rem}dialog.medium:is(.left,.right){inline-size:32rem}dialog.large:is(.left,.right){inline-size:44rem}dialog.small:is(.top,.bottom){block-size:16rem}dialog.medium:is(.top,.bottom){block-size:24rem}dialog.large:is(.top,.bottom){block-size:32rem}@media (pointer: coarse){body:has(dialog[open],dialog.active){overflow:hidden}}hr,[class*=divider]{all:unset;inline-size:-webkit-fill-available;min-block-size:auto;block-size:.0625rem;background-color:var(--outline-variant);display:block}hr+*,[class*=divider]+*{margin:0!important}hr.medium,.medium-divider{margin:1rem 0!important}hr.large,.large-divider{margin:1.5rem 0!important}hr.small,.small-divider{margin:.5rem 0!important}li:has(>hr),li:has(>.divider){padding:0!important;align-self:normal!important;min-inline-size:auto!important;min-block-size:auto!important;inline-size:-webkit-fill-available}hr.vertical,.divider.vertical,li:has(>hr.vertical),li:has(>.divider.vertical){padding:0!important;align-self:center!important;min-inline-size:auto;min-block-size:1.5rem;inline-size:.0625rem}summary,summary:focus{list-style-type:none;cursor:pointer;outline:none}summary::-webkit-details-marker{display:none}.field{--_size: 3rem;--_start: 1.2rem;block-size:var(--_size);margin-block-end:2rem;border-radius:.25rem .25rem 0 0;max-block-size:12rem}.grid>*>.field{margin-block-end:1rem}.grid>*>.field+.field{margin-block-start:2rem}.grid.no-space>*>.field+.field{margin-block-start:1rem}.grid.medium-space>*>.field+.field{margin-block-start:2.5rem}.grid.large-space>*>.field+.field{margin-block-start:3rem}.field.small{--_size: 2.5rem;--_start: 1rem}.field.large{--_size: 3.5rem;--_start: 1.4rem}.field.extra{--_size: 4rem;--_start: 1.6rem}.field.border{border-radius:.25rem}.field.round.small{border-radius:1.25rem}.field.round{border-radius:1.5rem}.field.round.large{border-radius:1.75rem}.field.round.extra{border-radius:2rem}.field>:is(i,img,svg,progress,a:not(.helper,.error)){position:absolute;inset:50% auto auto auto;transform:translateY(-50%);cursor:pointer;z-index:0;inline-size:1.5rem;block-size:1.5rem}.field>:is(i,img,svg,progress,a:not(.helper,.error)),[dir=rtl] .field>:is(i,img,svg,progress,a:not(.helper,.error)):first-child{inset:50% 1rem auto auto}.field>:is(i,img,svg,progress,a:not(.helper,.error)):first-child,[dir=rtl] .field>:is(i,img,svg,progress,a:not(.helper,.error)){inset:50% auto auto 1rem}.field.invalid>i{color:var(--error)}.field>progress.circle{inset-block-start:calc(50% - .75rem)!important;border-width:.1875rem}.field>a:not(.helper,.error){z-index:10}.field>a>:is(i,img,svg,progress,a:not(.helper,.error)){inline-size:1.5rem;block-size:1.5rem}.field>:is(input,textarea,select){all:unset;position:relative;display:flex;align-items:center;box-sizing:border-box;border-radius:inherit;border:.0625rem solid transparent;padding:0 .9375rem;font-family:inherit;font-size:1rem;inline-size:100%;block-size:100%;outline:none;z-index:1;background:none;resize:none;text-align:start;cursor:text}input::-webkit-date-and-time-value{text-align:start}:is(input,select,textarea):is(:-webkit-autofill,:autofill){-webkit-background-clip:text;-webkit-text-fill-color:var(--on-surface)}.field>:is(input,textarea,select):focus{border:.125rem solid transparent;padding:0 .875rem}.field.min>textarea{overflow:hidden auto;position:absolute;top:0;right:0;bottom:0;left:0}input[type=file],input[type=color],:not(.field)>input[type^=date],:not(.field)>input[type^=time],input::-webkit-calendar-picker-indicator{opacity:0;position:absolute;top:0;right:0;bottom:0;left:0;inline-size:100%;block-size:100%;margin:0;padding:0;border:0;outline:0;z-index:2!important}input::-webkit-search-decoration,input::-webkit-search-cancel-button,input::-webkit-search-results-button,input::-webkit-search-results-decoration,input::-webkit-inner-spin-button,input::-webkit-outer-spin-button{display:none}input[type=number]{-webkit-appearance:textfield;-moz-appearance:textfield;appearance:textfield}.field.border>:is(input,textarea,select){border-color:var(--outline)}.field.border>:is(input,textarea,select):focus{border-color:var(--primary)}.field.round>:is(input,textarea,select){padding-inline:1.4376rem}.field.round>:is(input,textarea,select):focus{padding-inline:1.375rem}.field.prefix>:is(input,textarea,select){padding-inline-start:2.9375rem}.field.prefix>.slider{margin-inline-start:3.5rem}.field.prefix>:is(input,textarea,select):focus{padding-inline-start:2.875rem}.field.suffix>:is(input,textarea,select){padding-inline-end:2.9375rem}.field.suffix>.slider{margin-inline-end:3.5rem}.field.suffix>:is(input,textarea,select):focus{padding-inline-end:2.875rem}.field:not(.border,.round)>:is(input,textarea,select){border-block-end-color:var(--outline)}.field:not(.border,.round)>:is(input,textarea,select):focus{border-block-end-color:var(--primary)}.field.round:not(.border,.fill)>:is(input,textarea,select),.field.round:not(.border)>:is(input,textarea,select):focus{box-shadow:var(--elevate1)}.field.round:not(.border,.fill)>:is(input,textarea,select):focus{box-shadow:var(--elevate2)}.field.invalid:not(.border,.round)>:is(input,textarea,select),.field.invalid:not(.border,.round)>:is(input,textarea,select):focus{border-block-end-color:var(--error)}.field.invalid.border>:is(input,textarea,select),.field.invalid.border>:is(input,textarea,select):focus{border-color:var(--error)}.field:has(>:disabled){opacity:.5;cursor:not-allowed}.field>:disabled{cursor:not-allowed}.field.textarea.small:not(.min){--_size: 5rem}.field.textarea:not(.min){--_size: 5.5rem}.field.textarea.large:not(.min){--_size: 6rem}.field.textarea.extra:not(.min){--_size: 6.5rem}.field>select{-webkit-user-select:none;user-select:none}@-moz-document url-prefix(){.field>select:focus{background-color:var(--surface)}.field.fill>select:focus{background-color:var(--surface-variant)}.field>select:focus+label{z-index:1}}.field>select>option{background-color:var(--surface)}.field.label>:is(input,select){padding-block-start:1rem}.field.label.border:not(.fill)>:is(input,select){padding-block-start:0}.field>textarea{padding-block-start:var(--_start);white-space:pre-wrap;overflow-wrap:break-word}.field>textarea:focus{padding-block-start:calc(var(--_start) - .06rem)}.field:not(.label)>textarea,.field.border.label:not(.fill)>textarea{padding-block-start:calc(var(--_start) - .5rem)}.field:not(.label)>textarea:focus,.field.border.label:not(.fill)>textarea:focus{padding-block-start:calc(var(--_start) - .56rem)}.field.label>label{--_start: 1rem;position:absolute;inset:-.5rem 1rem 0 var(--_start);display:flex;block-size:calc(var(--_size) + 1rem);line-height:calc(var(--_size) + 1rem);font-size:1rem;transition:all .2s;gap:.25rem;white-space:nowrap}.field.label.round>label{inset:-.5rem 1.75rem 0 var(--_start)}.field.label.textarea:not(.min)>label{block-size:calc(var(--_size) - 1.5rem);line-height:calc(var(--_size) - 1.5rem)}.field.label.border.prefix:not(.fill)>:is(label.active,:focus+label,[placeholder]:not(:placeholder-shown)+label,select+label){--_start: 1rem}.field.label.round>label,.field.label.border.prefix.round:not(.fill)>:is(label.active,:focus+label,[placeholder]:not(:placeholder-shown)+label,select+label){--_start: 1.5rem}.field.label.prefix>label{--_start: 3rem}.field.label>:is(label.active,:focus+label,[placeholder]:not(:placeholder-shown)+label,select+label){block-size:2.5rem;line-height:2.5rem;font-size:.75rem}.field.label.border:not(.fill)>:is(label.active,:focus+label,[placeholder]:not(:placeholder-shown)+label,select+label){block-size:1rem;line-height:1rem}.field.label.border:not(.fill)>label:after{content:"";display:block;margin:.5rem 0 0;border-block-start:.0625rem solid var(--outline);block-size:1rem;transition:none;flex:auto}.field.label.border:not(.fill)>:focus+label:after{border-block-start:.125rem solid var(--primary)}.field.label.border:not(.fill)>:is(input,textarea):is(:focus,[placeholder]:not(:placeholder-shown),.active),.field.label.border:not(.fill)>select{clip-path:polygon(-2% -2%,.75rem -2%,.75rem .5rem,calc(100% - 1rem) .5rem,calc(100% - 1rem) -2%,102% -2%,102% 102%,-2% 102%)}[dir=rtl] .field.label.border:not(.fill)>:is(input,textarea):is(:focus,[placeholder]:not(:placeholder-shown),.active),[dir=rtl] .field.label.border:not(.fill)>select{clip-path:polygon(-2% -2%,1rem -2%,1rem .5rem,calc(100% - .75rem) .5rem,calc(100% - .75rem) -2%,102% -2%,102% 102%,-2% 102%)}.field.label.border.round:not(.fill)>:is(input,textarea):is(:focus,[placeholder]:not(:placeholder-shown),.active),.field.label.border.round:not(.fill)>select{clip-path:polygon(-2% -2%,1.25rem -2%,1.25rem .5rem,calc(100% - 1.75rem) .5rem,calc(100% - 1.75rem) -2%,102% -2%,102% 102%,-2% 102%)}[dir=rtl] .field.label.border.round:not(.fill)>:is(input,textarea):is(:focus,[placeholder]:not(:placeholder-shown),.active),[dir=rtl] .field.label.border.round:not(.fill)>select{clip-path:polygon(-2% -2%,1.75rem -2%,1.75rem .5rem,calc(100% - 1.25rem) .5rem,calc(100% - 1.25rem) -2%,102% -2%,102% 102%,-2% 102%)}.field.label>:focus+label{color:var(--primary)}.field.label.invalid>label,.field.label.invalid>label:after{color:var(--error)!important;border-color:var(--error)!important}.field.label>label>a{block-size:inherit;line-height:inherit;inline-size:1rem}.field.label>label>a>:is(i,img,svg){block-size:1rem;line-height:1rem;inline-size:1rem;font-size:1rem}.field>:is(.helper,.error){position:absolute;inset:auto auto 0 1rem;transform:translateY(100%);font-size:.75rem;background:none!important;padding-block-start:.125rem}[dir=rtl] .field>:is(.helper,.error){inset:auto 1rem 0 auto}a.helper{color:var(--primary)}.field>.error{color:var(--error)!important}.field.round>:is(.helper,.error){inset-inline-start:1.5rem}.field.invalid>.helper{display:none}table td>.field{margin:0}fieldset{border-radius:.25rem;padding:1rem;border:.0625rem solid var(--outline-variant)}fieldset>legend{margin:0 -.25rem;padding:0 .25rem}fieldset>legend+*{margin-block-start:0!important}.grid{--_gap: 1rem;display:grid;grid-template-columns:repeat(12,1fr);gap:var(--_gap);block-size:auto}.grid.no-space{--_gap: 0rem}.grid.medium-space{--_gap: 1.5rem}.grid.large-space{--_gap: 2rem}.grid>*{margin:0}.s1{grid-area:auto/span 1}.s2{grid-area:auto/span 2}.s3{grid-area:auto/span 3}.s4{grid-area:auto/span 4}.s5{grid-area:auto/span 5}.s6{grid-area:auto/span 6}.s7{grid-area:auto/span 7}.s8{grid-area:auto/span 8}.s9{grid-area:auto/span 9}.s10{grid-area:auto/span 10}.s11{grid-area:auto/span 11}.s12{grid-area:auto/span 12}@media only screen and (min-width: 601px){.m1{grid-area:auto/span 1}.m2{grid-area:auto/span 2}.m3{grid-area:auto/span 3}.m4{grid-area:auto/span 4}.m5{grid-area:auto/span 5}.m6{grid-area:auto/span 6}.m7{grid-area:auto/span 7}.m8{grid-area:auto/span 8}.m9{grid-area:auto/span 9}.m10{grid-area:auto/span 10}.m11{grid-area:auto/span 11}.m12{grid-area:auto/span 12}}@media only screen and (min-width: 993px){.l1{grid-area:auto/span 1}.l2{grid-area:auto/span 2}.l3{grid-area:auto/span 3}.l4{grid-area:auto/span 4}.l5{grid-area:auto/span 5}.l6{grid-area:auto/span 6}.l7{grid-area:auto/span 7}.l8{grid-area:auto/span 8}.l9{grid-area:auto/span 9}.l10{grid-area:auto/span 10}.l11{grid-area:auto/span 11}.l12{grid-area:auto/span 12}}i,:is(.checkbox,.radio,.switch)>span:before,:is(.checkbox,.radio,.switch)>span>i{--_size: 1.5rem;font-family:var(--font-icon);font-weight:400;font-style:normal;font-size:var(--_size);letter-spacing:normal;text-transform:none;display:inline-flex;align-items:center;justify-content:center;white-space:nowrap;word-wrap:normal;direction:ltr;font-feature-settings:"liga";-webkit-font-smoothing:antialiased;vertical-align:middle;text-align:center;overflow:hidden;inline-size:var(--_size);min-inline-size:var(--_size);block-size:var(--_size);min-block-size:var(--_size);box-sizing:content-box;line-height:normal;border-radius:0}i:has(.badge){overflow:unset}i.tiny{--_size: 1rem}.chip>i,i.small{--_size: 1.25rem}i.medium{--_size: 1.5rem}i.large{--_size: 1.75rem}i.extra{--_size: 2rem}i.fill,a.active>i,button.active>i{font-variation-settings:"FILL" 1}i>:is(img,svg){inline-size:100%;block-size:100%;background-size:100%;border-radius:inherit;position:absolute;inset:0 auto auto 0;padding:inherit}i[class*=fa-]{font-size:calc(var(--_size) * .85);line-height:normal;block-size:auto;min-block-size:auto}.absolute{position:absolute}.fixed{position:fixed}:is(.absolute,.fixed).left.right{inline-size:auto}:is(.absolute,.fixed).left.right.small{block-size:20rem}:is(.absolute,.fixed).left.right.medium{block-size:28rem}:is(.absolute,.fixed).left.right.large{block-size:44rem}:is(.absolute,.fixed).top.bottom.small{inline-size:20rem}:is(.absolute,.fixed).top.bottom.medium{inline-size:28rem}:is(.absolute,.fixed).top.bottom.large{inline-size:44rem}.list{display:flex;flex-direction:column;padding:0;margin:0;flex:1}.list>li,.list>li>details>summary,.list>li>a:only-child{all:unset;box-sizing:border-box;position:relative;display:flex;align-items:center;align-self:normal;text-align:start;justify-content:flex-start;white-space:nowrap;gap:1rem;min-block-size:3.5rem;padding:.5rem 1rem;cursor:pointer;flex:1}.list>li:has(ul,ol,details[open],a:only-child){padding:0}.list>li>.list{padding:0 0 0 1rem}.list>li>*,.list>li>a:only-child>*,.list>li>details>summary>*{margin:0}.list>li>:is(details,.max),.list>li>a:only-child>.max,.list>li>details>summary>.max{flex:1}.list.border>li:not(:last-child):before,.list.border>li>details[open]>summary:before{content:"";position:absolute;background-color:var(--outline-variant);inset:auto 0 0 0;block-size:.0625rem;inline-size:auto}.list.no-space>li,.list.no-space>li>details>summary{min-block-size:2.5rem}.list.medium-space>li,.list.medium-space>li>details>summary{min-block-size:4.5rem}.list.large-space>li,.list.large-space>li>details>summary{min-block-size:5.5rem}:has(>main){display:grid;grid-template-columns:auto 1fr auto;grid-template-rows:auto auto 1fr auto auto;grid-template-areas:"left top right" "left header right" "left main right" "left footer right" "left bottom right";min-block-size:100dvh;box-sizing:border-box;background-color:var(--surface)}nav.left{grid-area:left}nav.right{grid-area:right}nav.top{grid-area:top}nav.bottom{grid-area:bottom}header{grid-area:header}footer{grid-area:footer}main{--_padding: .5rem;grid-area:main;padding:var(--_padding);overflow:hidden}aside{z-index:1}aside:not(.fixed,.absolute).right{float:right}aside:not(.fixed,.absolute).left{float:left}svg{fill:currentcolor}:is(img,svg,video):is(.small,.medium,.large,.tiny,.extra,.round,.circle,.square,.responsive){--_size: 3rem;object-fit:cover;object-position:center;transition:transform var(--speed3),border-radius var(--speed3),padding var(--speed3);block-size:var(--_size);inline-size:var(--_size)}:is(img,svg,video).round{--_round: .5rem}:is(img,svg,video).tiny{--_size: 2rem}:is(img,svg,video).small{--_size: 2.5rem}:is(img,svg,video).large{--_size: 3.5rem}:is(img,svg,video).extra{--_size: 4rem}:is(img,svg,video).responsive{--_size: 100%;margin:0 auto}:is(img,svg,video).responsive.tiny{inline-size:100%;block-size:4rem}:is(img,svg,video).responsive.small{inline-size:100%;block-size:8rem}:is(img,svg,video).responsive.medium{inline-size:100%;block-size:12rem}:is(img,svg,video).responsive.large{inline-size:100%;block-size:16rem}:is(img,svg,video).responsive.extra{inline-size:100%;block-size:20rem}:is(img,svg,video).responsive.round{--_round: 2rem}:is(img,svg,video).empty-state{max-inline-size:100%;inline-size:24rem}:is(button,.button,.chip):not(.transparent)>.responsive{border:.25rem solid transparent}:is(button,.button,.chip,.field)>:is(img,svg):not(.responsive),.tabs :is(img,svg):not(.responsive){min-inline-size:1.5rem;max-inline-size:1.5rem;min-block-size:1.5rem;max-block-size:1.5rem}:is(button,.button,.chip):not(.extend)>.responsive:first-child{margin-inline-start:calc(-1 * var(--_padding))}:is(button,.button,.chip):not(.extend)>.responsive:not(:first-child){margin-inline-end:calc(-1 * var(--_padding))}:is(button,.button,.chip,.circle,.square,.extend)>.responsive{--_size: inherit;margin:0 auto}.extend>:is(.responsive,i){margin:0;position:absolute;inset-inline:1rem;z-index:1}.extend>.responsive{inset-inline:0;inline-size:3.5rem}.extend.border>.responsive{inline-size:3.375rem}menu{opacity:0;visibility:hidden;position:absolute;box-shadow:var(--elevate2);background-color:var(--surface-container);z-index:11;inset:auto auto 0 0;inline-size:100%;max-block-size:50vh;max-inline-size:none!important;overflow-x:hidden;overflow-y:auto;font-size:.875rem;font-weight:400;text-transform:none;color:var(--on-surface);line-height:normal;text-align:start;border-radius:.25rem;transform:scale(.8) translateY(120%);transition:all var(--speed2),0s background-color;justify-content:flex-start;padding:.5rem 0}[dir=rtl] menu{inset:auto 0 0 auto}menu.no-wrap{inline-size:max-content;white-space:nowrap!important}menu.active,:not(menu,[data-ui]):focus-within>menu,menu>li:hover>menu,menu>li>menu:hover{opacity:1;visibility:visible;transform:scale(1) translateY(100%)}menu.active.top,:not(menu,[data-ui]):focus-within>menu.top,menu>li:hover>menu.top,menu>li>menu.top:hover{transform:scale(1) translateY(-100%)}menu *{white-space:inherit!important}menu>li,menu>li>a:only-child{all:unset;box-sizing:border-box;position:relative;display:flex;align-items:center;align-self:normal;text-align:start;justify-content:inherit;white-space:nowrap;gap:1rem;padding:.5rem 1rem;min-block-size:3rem;flex:1;margin:0!important;cursor:pointer}menu>li:is(:hover,:focus,.active){background-color:var(--active)}menu>li>:is(.max,.field),menu>li>a:only-child>.max,menu>li:has(.field,a:only-child){flex:1;padding:0;margin:0}menu.min{inset:0 0 auto 0;transform:none!important;background-color:var(--surface-variant)!important;color:var(--on-surface-variant)!important;padding:0}[dir=rtl] menu.min.right,menu.min.left,menu.top.left{inset:0 0 auto auto}[dir=rtl] menu.min.left,menu.min.right,menu.top,menu.top.right{inset:0 auto auto 0}menu.max{position:fixed;top:0;right:0;bottom:0;left:0;block-size:100%;max-block-size:none;min-block-size:auto;z-index:100;transform:none!important;background-color:var(--surface-variant)!important;color:var(--on-surface-variant)!important;border-radius:0}menu.no-wrap:is(.min,.max){min-inline-size:16rem}[dir=rtl] menu.right,[dir=rtl] menu.top.min.right,menu.left,menu.top.min.left{inset:auto 0 0 auto}[dir=rtl] menu.left,[dir=rtl] menu.top.min.left,menu.right,menu.top.min{inset:auto auto 0 0}menu.top{transform:scale(.8) translateY(-120%)}menu:has(menu){--_child: 1;--_type: 0;overflow:unset;white-space:nowrap;inline-size:auto;min-inline-size:12rem;max-block-size:none}menu>li>:is(menu,menu.right),[dir=rtl] menu>li>menu.left{inset:auto auto calc(3rem * (var(--_child) - var(--_type))) 100%}[dir=rtl] menu>li>:is(menu,menu.right),menu>li>menu.left{inset:auto 100% calc(3rem * (var(--_child) - var(--_type))) auto}menu>li>:is(menu.top,menu.top.right),[dir=rtl] menu>li>menu.top.left{inset:calc(3rem * (var(--_child) - var(--_type))) auto auto 100%}[dir=rtl] menu>li>:is(menu.top,menu.top.right),menu>li>menu.top.left{inset:calc(3rem * (var(--_child) - var(--_type))) 100% auto auto}menu.no-space>li{min-block-size:2.5rem}menu.medium-space>li{min-block-size:3.5rem}menu.large-space>li{min-block-size:4rem}menu.border>li:not(:last-child):before{content:"";position:absolute;background-color:var(--outline-variant);inset:auto 0 0 0;block-size:.0625rem;inline-size:auto}menu.transparent{margin:0 -1rem!important;padding:.5rem}menu.transparent>li{background-color:inherit;box-shadow:none;padding:0}menu>li:nth-last-child(2){--_child: 2}menu>li:nth-last-child(3){--_child: 3}menu>li:nth-last-child(4){--_child: 4}menu>li:nth-last-child(5){--_child: 5}menu>li:nth-last-child(6){--_child: 6}menu>li:nth-last-child(7){--_child: 7}menu>li:nth-last-child(8){--_child: 8}menu>li:nth-last-child(9){--_child: 9}menu>li:nth-last-child(10){--_child: 10}menu>li:nth-last-child(11){--_child: 11}menu>li:nth-last-of-type(2){--_type: 1}menu>li:nth-last-of-type(3){--_type: 2}menu>li:nth-last-of-type(4){--_type: 3}menu>li:nth-last-of-type(5){--_type: 4}menu>li:nth-last-of-type(6){--_type: 5}menu>li:nth-last-of-type(7){--_type: 6}menu>li:nth-last-of-type(8){--_type: 7}menu>li:nth-last-of-type(9){--_type: 8}menu>li:nth-last-of-type(10){--_type: 9}menu>li:nth-last-of-type(11){--_type: 10}@media (pointer: coarse){:not(menu,[data-ui]):hover>menu{opacity:1;visibility:visible;transform:scale(1) translateY(100%)}:not(menu,[data-ui]):hover>menu.top{transform:scale(1) translateY(-100%)}}nav>:is(ol,ul),nav>:is(ol,ul)>li{all:unset}nav,.row,a.row{display:flex;align-items:center;align-self:normal;text-align:start;justify-content:flex-start;white-space:nowrap;gap:1rem;border-radius:0;min-inline-size:0}a.row,nav.row{min-block-size:3rem;margin:0}:is(nav,.row,.max)>:only-child,nav>:is(ol,ul)>li>:only-child{margin:0}:is(nav,.row)>:not(ul,ol,header,footer){margin:0;white-space:normal;flex:none}:is(nav,.row).min{display:inline-flex}:is(nav,.row,li).no-space{gap:0}:is(nav,.row,li).tiny-space{gap:.5rem}:is(nav,.row,li).medium-space{gap:1.5rem}:is(nav,.row,li).large-space{gap:2rem}:is(nav,.row)>.max,:is(nav,.row)>:is(ol,ul)>.max{flex:1}:is(nav,.row).wrap{display:flex;flex-wrap:wrap}:is(header,footer)>:is(nav,.row){min-block-size:inherit}nav:is(.left,.right,.top,.bottom){--_padding: .5rem;--_top: calc(var(--_padding) + var(--top));--_bottom: calc(var(--_padding) + var(--bottom));position:sticky;top:0;right:0;bottom:0;left:0;border:0;color:var(--on-surface);transform:none;z-index:100;text-align:center;padding:var(--_padding);margin:0}nav:is(.left,.right){justify-content:flex-start;flex-direction:column;background-color:var(--surface);block-size:100dvh;min-inline-size:6rem;padding-block:var(--_top) var(--_bottom)}nav:is(.top,.bottom){position:sticky;top:0;right:0;bottom:0;left:0;padding:.5rem;justify-content:center;flex-direction:row;background-color:var(--surface-container);block-size:auto;min-block-size:4.5rem}nav.top{block-size:calc(var(--top) + 4.5rem);padding-block-start:var(--_top)}nav.bottom{block-size:calc(var(--bottom) + 4.5rem);padding-block-end:var(--_bottom)}nav>header{min-block-size:auto;padding:0;margin:0 0 1rem;align-items:flex-start;gap:1rem;background:none!important}nav:is(.top,.bottom)>header{flex-direction:row;align-items:center;margin:0 1rem 0 0}nav>header>*{margin:0}nav>header>.extend:hover{--_padding: 0;inline-size:var(--_size)}nav>header>.extend:hover>span{display:none}nav>:is(ol,ul){all:inherit;min-inline-size:auto;margin:0;padding:0;flex:auto}nav.max:is(.left,.right,.top,.bottom){gap:0;inline-size:auto;align-items:flex-start;min-inline-size:12.75rem;padding:var(--_top) 1.25rem var(--_bottom) 1.25rem}nav.max>:is(ol,ul){padding:0}nav.max>header{margin:0 0 1.25rem}nav.max:is(.top,.bottom)>header{margin:0 1.25rem 0 0}nav.max>header>.extend{--_padding: 1.5rem;inline-size:auto;padding:0 var(--_padding)}nav.max>header>.extend>span{display:block;margin-inline-start:var(--_padding)}nav.max>header>.extend>:is(img,svg)+span{margin-inline-start:calc(1rem + var(--_padding))}nav.max:is(.top,.bottom){padding:0 .5rem;align-items:center;min-inline-size:auto;max-inline-size:none}nav:is(.left,.right,.top,.bottom)>a:not(.button,.chip),nav:is(.left,.right,.top,.bottom)>:is(ol,ul)>li>a:not(.button,.chip){display:flex;flex-direction:column;gap:.25rem;line-height:normal;inline-size:3.5rem;font-size:.8rem}nav:not(.max):is(.left,.right,.top,.bottom)>a:not(.button,.chip)>i,nav:not(.max):is(.left,.right,.top,.bottom)>:is(ol,ul)>li>a:not(.button,.chip)>i{padding:.25rem 1rem;border-radius:2rem;transition:padding var(--speed1) linear;margin:0 auto}nav.max:is(.left,.right,.top,.bottom)>a:not(.button,.chip),nav.max:is(.left,.right,.top,.bottom)>:is(ol,ul)>li>a:not(.button,.chip){flex-direction:row;gap:.5rem;inline-size:auto;block-size:3.5rem;padding:0 1rem;border-radius:2rem;font-size:inherit}nav.max:is(.top,.bottom)>a:not(.button,.chip),nav.max:is(.top,.bottom)>:is(ol,ul)>li>a:not(.button,.chip){gap:.25rem;block-size:2.5rem;font-size:.8rem}nav.max:is(.left,.right,.top,.bottom)>a.active:not(.button,.chip),nav.max:is(.left,.right,.top,.bottom)>:is(ol,ul)>li>a.active:not(.button,.chip),nav:is(.left,.right,.top,.bottom):not(.max)>a.active:not(.button,.chip)>i,nav:is(.left,.right,.top,.bottom):not(.max)>:is(ol,ul)>li>a.active:not(.button,.chip)>i{background-color:var(--secondary-container);color:var(--on-secondary-container)}:is(nav,.row):is(.left-align,.top-align,.vertical){justify-content:flex-start}:is(nav,.row):is(.right-align,.bottom-align){justify-content:flex-end}:is(nav,.row):is(.center-align,.middle-align){justify-content:center}:is(nav,.row):is(.left-align,.top-align,.vertical).vertical{align-items:flex-start}:is(nav,.row):is(.right-align,.bottom-align).vertical{align-items:flex-end}:is(nav,.row):is(.center-align,.middle-align).vertical{align-items:center}nav:not(.left,.right)>.space{inline-size:.5rem}nav:not(.left,.right)>.medium-space{inline-size:1rem}nav:not(.left,.right)>.large-space{inline-size:1.5rem}nav.tabbed{background-color:var(--surface-container);border-radius:4rem!important;gap:0rem;block-size:4rem}nav.tabbed.small{block-size:3rem}nav.tabbed.large{block-size:5rem}nav.tabbed>a{border-radius:inherit;block-size:inherit;display:inline-flex;align-items:center;padding-inline:1rem;gap:.5rem;font-size:1rem;flex:1}nav.tabbed>a.active{background-color:var(--primary-container)}nav.toolbar{display:inline-flex;justify-content:space-around;border-radius:2rem;background-color:var(--surface-container);color:var(--on-surface);padding:0 1rem;gap:.5rem;min-block-size:4rem;min-inline-size:4rem}nav.toolbar>a{display:inline-flex;gap:.5rem;min-inline-size:2.5rem;min-block-size:2.5rem;border-radius:1.75rem}nav.toolbar>a:has(>:not(i)){padding:0 1rem}nav.toolbar>a.active{background-color:var(--secondary-container);color:var(--on-secondary-container)}nav.toolbar.fill{background-color:var(--primary-container)!important;color:var(--on-primary-container)!important}nav.toolbar.fill>a.active{background-color:var(--surface-container)!important;color:var(--on-surface)!important}nav.toolbar.vertical{flex-direction:column!important;min-inline-size:4rem;padding:1rem 0;align-self:center;align-items:center!important}nav.toolbar.vertical>a{inline-size:2.5rem;block-size:2.5rem}nav.toolbar.vertical>a>:is(div,span):not(.badge,.tooltip){display:none}nav.toolbar.max{border-radius:0;display:flex}nav.group{background:none!important}nav.group:is(.connected,.split){gap:.125rem}nav.group:not(.split)>:is(.button,button):not(.border){background-color:var(--surface-container);color:var(--on-surface-container)}nav.group:not(.split)>:is(.button,button).active{background-color:var(--primary);color:var(--on-primary)}nav.group.connected>:is(.button,button):not(.border){background-color:var(--surface-container);color:var(--on-surface-container)}nav.group.connected>:is(.button,button).active{background-color:var(--secondary-container);color:var(--on-secondary-container)}nav.group:is(.connected,.split)>:is(.button,button).active,nav.split>:is(.button,button):active{border-radius:2rem!important}:not(nav)>:is(ul,ol){all:revert}:is(.scroll,.no-scroll,.no-space,.tabs,.tabbed)>:focus-visible{outline:.125rem solid var(--primary);outline-offset:-.125rem}nav.split>:is(.button,button):not(.chip,.fill,.border){background-color:var(--primary);color:var(--on-primary)}nav.group.primary-container>button,nav:is(.max,.toolbar,.tabbed,.group).primary>:is(button,a).active,nav:not(.max,.toolbar,.tabbed,.group).primary>a.active:not(.button,.chip)>i{background-color:var(--primary-container)!important;color:var(--on-primary-container)!important}nav.group.primary>button,nav:is(.max,.toolbar,.tabbed,.group).primary-container>:is(button,a).active,nav:not(.max,.toolbar,.tabbed,.group).primary-container>a.active:not(.button,.chip)>i{background-color:var(--primary)!important;color:var(--on-primary)!important}nav.group.secondary-container>button,nav:is(.max,.toolbar,.tabbed,.group).secondary>:is(button,a).active,nav:not(.max,.toolbar,.tabbed,.group).secondary>a.active:not(.button,.chip)>i{background-color:var(--secondary-container)!important;color:var(--on-secondary-container)!important}nav.group.secondary>button,nav:is(.max,.toolbar,.tabbed,.group).secondary-container>:is(button,a).active,nav:not(.max,.toolbar,.tabbed,.group).secondary-container>a.active:not(.button,.chip)>i{background-color:var(--secondary)!important;color:var(--on-secondary)!important}nav.group.tertiary-container>button,nav:is(.max,.toolbar,.tabbed,.group).tertiary>:is(button,a).active,nav:not(.max,.toolbar,.tabbed,.group).tertiary>a.active:not(.button,.chip)>i{background-color:var(--tertiary-container)!important;color:var(--on-tertiary-container)!important}nav.group.tertiary>button,nav:is(.max,.toolbar,.tabbed,.group).tertiary-container>:is(button,a).active,nav:not(.max,.toolbar,.tabbed,.group).tertiary-container>a.active:not(.button,.chip)>i{background-color:var(--tertiary)!important;color:var(--on-tertiary)!important}@media only screen and (max-width: 600px){nav.top,nav.bottom{justify-content:space-around}}.overlay,dialog::backdrop{display:block!important;opacity:0;visibility:hidden;position:fixed;top:0;right:0;bottom:0;left:0;color:var(--on-surface);background-color:var(--overlay);z-index:100;transition:all var(--speed3),0s background-color;border-radius:0}.overlay.active{opacity:1;visibility:visible}dialog:popover-open::backdrop{opacity:1;visibility:visible}.overlay+dialog::backdrop,.snackbar::backdrop{display:none}[popover]{border:0}.page{--_transform: translate(0, 0);opacity:0;position:absolute;display:none}.page.active{opacity:1;position:inherit;display:inherit;animation:var(--speed4) to-page ease}.page.active.top{--_transform: translate(0, -4rem)}.page.active.bottom{--_transform: translate(0, 4rem)}.page.active.left{--_transform: translate(-4rem, 0)}.page.active.right{--_transform: translate(4rem, 0)}@keyframes to-page{0%{opacity:0;transform:var(--_transform)}to{opacity:1;transform:translate(0)}}progress{--_light: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR4AWJiYGAQBgAAAP//ZyYa+wAAAAZJREFUAwAAIgAWeX9MsQAAAABJRU5ErkJggg==);--_dark: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR4AWL6//+/FAAAAP//qSv5QwAAAAZJREFUAwAJIAMaJWjIvQAAAABJRU5ErkJggg==);--_size: .25rem;position:relative;inline-size:100%;block-size:var(--_size);color:var(--primary);background:var(--_light);border-radius:1rem;flex:none;border:none;overflow:hidden;writing-mode:horizontal-tb;direction:ltr;-webkit-appearance:none}.dark progress{background:var(--_dark)}progress.small{--_size: .25rem}progress.medium{--_size: .35rem}progress.large{--_size: .45rem}progress:not(.circle,[value]):after{content:"";position:absolute;top:0;right:0;bottom:0;left:0;inline-size:100%;block-size:100%;clip-path:none;background:currentcolor;animation:3.2s to-linear ease infinite}progress:not(.circle,[value])::-moz-progress-bar{animation:3.2s to-linear ease infinite}progress:not(.circle,[value])::-webkit-progress-value{animation:3.2s to-linear ease infinite}progress::-webkit-progress-bar{background:none}progress::-webkit-progress-value{background:currentColor}progress::-moz-progress-bar{background:currentColor}progress.wavy{block-size:calc(var(--_size) * 2);background:none;background-image:var(--_light);background-repeat:repeat-x;background-position:0 50%;background-size:auto calc(var(--_size) / 2)}.dark progress.wavy{background-image:var(--_dark)}progress.wavy::-webkit-progress-value,progress.wavy:not(.circle,[value]):after{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='610%201101%201220%2075'%3e%3cpath%20fill='%23D0BCFF'%20d='M1870.425,1173.746c-29.448,0-58.665-7.477-84.493-21.622c-0.03-0.016-0.061-0.032-0.09-0.049%20c-43.555-23.82-95.546-23.809-139.091,0.039c-0.037,0.021-0.075,0.042-0.113,0.062c-25.803,14.109-54.984,21.567-84.394,21.568%20c-29.449,0-58.667-7.478-84.495-21.623c-43.554-23.852-95.539-23.865-139.089-0.052c-0.03,0.018-0.062,0.034-0.092,0.051%20c-25.83,14.146-55.048,21.623-84.497,21.623c-29.423,0-58.613-7.463-84.425-21.584c-0.025-0.014-0.052-0.028-0.077-0.042%20c-43.572-23.863-95.596-23.862-139.164-0.001c-0.028,0.016-0.057,0.031-0.085,0.046c-25.809,14.117-55.001,21.581-84.418,21.581%20c-0.002,0,0,0-0.001,0c-29.45-0.001-58.669-7.479-84.498-21.625c-43.534-23.845-95.513-23.863-139.063-0.058%20c-0.036,0.021-0.072,0.04-0.108,0.06c-25.829,14.146-55.047,21.623-84.496,21.623c-29.398,0-58.566-7.451-84.362-21.551%20c-0.048-0.024-0.095-0.05-0.142-0.075c-43.568-23.863-95.593-23.863-139.163,0c-0.027,0.015-0.054,0.028-0.081,0.043%20c-25.811,14.12-55.001,21.583-84.421,21.583c-29.45,0-58.668-7.478-84.497-21.624c-7.521-4.118-10.278-13.554-6.159-21.074%20s13.554-10.277,21.074-6.158c43.57,23.862,95.593,23.864,139.163,0c0.033-0.018,0.065-0.035,0.098-0.053%20c25.807-14.114,54.991-21.573,84.406-21.573c29.398,0,58.567,7.451,84.364,21.55c0.047,0.025,0.093,0.051,0.14,0.076%20c43.534,23.843,95.508,23.864,139.056,0.059c0.038-0.021,0.075-0.042,0.113-0.063c25.828-14.145,55.049-21.622,84.496-21.622%20c0.002,0,0,0,0.002,0c29.449,0,58.668,7.478,84.497,21.625c43.57,23.863,95.595,23.862,139.165,0.001%20c0.021-0.013,0.043-0.024,0.065-0.036c25.813-14.124,55.011-21.591,84.438-21.591c29.42,0,58.61,7.463,84.421,21.582%20c0.027,0.015,0.055,0.03,0.082,0.045c43.539,23.847,95.521,23.862,139.074,0.049c0.032-0.018,0.064-0.035,0.096-0.053%20c25.829-14.146,55.047-21.623,84.496-21.623s58.667,7.477,84.496,21.623c43.58,23.867,95.604,23.866,139.172,0.005%20c0.039-0.021,0.079-0.043,0.118-0.064c25.803-14.108,54.98-21.564,84.389-21.564c29.448-0.001,58.666,7.476,84.494,21.62%20c0.038,0.021,0.076,0.042,0.114,0.063c43.549,23.807,95.528,23.791,139.063-0.051c7.52-4.121,16.955-1.361,21.073,6.159%20c4.119,7.521,1.361,16.955-6.159,21.073C1929.089,1166.27,1899.872,1173.746,1870.425,1173.746z'%3e%3canimateTransform%20attributeName='transform'%20type='translate'%20from='0%200'%20to='312.5%200'%20dur='1s'%20calcMode='linear'%20repeatCount='indefinite'%20/%3e%3c/path%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='610%201101%201220%2075'%3e%3cpath%20fill='%23D0BCFF'%20d='M1870.425,1173.746c-29.448,0-58.665-7.477-84.493-21.622c-0.03-0.016-0.061-0.032-0.09-0.049%20c-43.555-23.82-95.546-23.809-139.091,0.039c-0.037,0.021-0.075,0.042-0.113,0.062c-25.803,14.109-54.984,21.567-84.394,21.568%20c-29.449,0-58.667-7.478-84.495-21.623c-43.554-23.852-95.539-23.865-139.089-0.052c-0.03,0.018-0.062,0.034-0.092,0.051%20c-25.83,14.146-55.048,21.623-84.497,21.623c-29.423,0-58.613-7.463-84.425-21.584c-0.025-0.014-0.052-0.028-0.077-0.042%20c-43.572-23.863-95.596-23.862-139.164-0.001c-0.028,0.016-0.057,0.031-0.085,0.046c-25.809,14.117-55.001,21.581-84.418,21.581%20c-0.002,0,0,0-0.001,0c-29.45-0.001-58.669-7.479-84.498-21.625c-43.534-23.845-95.513-23.863-139.063-0.058%20c-0.036,0.021-0.072,0.04-0.108,0.06c-25.829,14.146-55.047,21.623-84.496,21.623c-29.398,0-58.566-7.451-84.362-21.551%20c-0.048-0.024-0.095-0.05-0.142-0.075c-43.568-23.863-95.593-23.863-139.163,0c-0.027,0.015-0.054,0.028-0.081,0.043%20c-25.811,14.12-55.001,21.583-84.421,21.583c-29.45,0-58.668-7.478-84.497-21.624c-7.521-4.118-10.278-13.554-6.159-21.074%20s13.554-10.277,21.074-6.158c43.57,23.862,95.593,23.864,139.163,0c0.033-0.018,0.065-0.035,0.098-0.053%20c25.807-14.114,54.991-21.573,84.406-21.573c29.398,0,58.567,7.451,84.364,21.55c0.047,0.025,0.093,0.051,0.14,0.076%20c43.534,23.843,95.508,23.864,139.056,0.059c0.038-0.021,0.075-0.042,0.113-0.063c25.828-14.145,55.049-21.622,84.496-21.622%20c0.002,0,0,0,0.002,0c29.449,0,58.668,7.478,84.497,21.625c43.57,23.863,95.595,23.862,139.165,0.001%20c0.021-0.013,0.043-0.024,0.065-0.036c25.813-14.124,55.011-21.591,84.438-21.591c29.42,0,58.61,7.463,84.421,21.582%20c0.027,0.015,0.055,0.03,0.082,0.045c43.539,23.847,95.521,23.862,139.074,0.049c0.032-0.018,0.064-0.035,0.096-0.053%20c25.829-14.146,55.047-21.623,84.496-21.623s58.667,7.477,84.496,21.623c43.58,23.867,95.604,23.866,139.172,0.005%20c0.039-0.021,0.079-0.043,0.118-0.064c25.803-14.108,54.98-21.564,84.389-21.564c29.448-0.001,58.666,7.476,84.494,21.62%20c0.038,0.021,0.076,0.042,0.114,0.063c43.549,23.807,95.528,23.791,139.063-0.051c7.52-4.121,16.955-1.361,21.073,6.159%20c4.119,7.521,1.361,16.955-6.159,21.073C1929.089,1166.27,1899.872,1173.746,1870.425,1173.746z'%3e%3canimateTransform%20attributeName='transform'%20type='translate'%20from='0%200'%20to='312.5%200'%20dur='1s'%20calcMode='linear'%20repeatCount='indefinite'%20/%3e%3c/path%3e%3c/svg%3e");-webkit-mask-position:0 50%;mask-position:0 50%;-webkit-mask-repeat:repeat-x;mask-repeat:repeat-x;-webkit-mask-size:auto 100%;mask-size:auto 100%}progress.wavy::-moz-progress-bar{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='610%201101%201220%2075'%3e%3cpath%20fill='%23D0BCFF'%20d='M1870.425,1173.746c-29.448,0-58.665-7.477-84.493-21.622c-0.03-0.016-0.061-0.032-0.09-0.049%20c-43.555-23.82-95.546-23.809-139.091,0.039c-0.037,0.021-0.075,0.042-0.113,0.062c-25.803,14.109-54.984,21.567-84.394,21.568%20c-29.449,0-58.667-7.478-84.495-21.623c-43.554-23.852-95.539-23.865-139.089-0.052c-0.03,0.018-0.062,0.034-0.092,0.051%20c-25.83,14.146-55.048,21.623-84.497,21.623c-29.423,0-58.613-7.463-84.425-21.584c-0.025-0.014-0.052-0.028-0.077-0.042%20c-43.572-23.863-95.596-23.862-139.164-0.001c-0.028,0.016-0.057,0.031-0.085,0.046c-25.809,14.117-55.001,21.581-84.418,21.581%20c-0.002,0,0,0-0.001,0c-29.45-0.001-58.669-7.479-84.498-21.625c-43.534-23.845-95.513-23.863-139.063-0.058%20c-0.036,0.021-0.072,0.04-0.108,0.06c-25.829,14.146-55.047,21.623-84.496,21.623c-29.398,0-58.566-7.451-84.362-21.551%20c-0.048-0.024-0.095-0.05-0.142-0.075c-43.568-23.863-95.593-23.863-139.163,0c-0.027,0.015-0.054,0.028-0.081,0.043%20c-25.811,14.12-55.001,21.583-84.421,21.583c-29.45,0-58.668-7.478-84.497-21.624c-7.521-4.118-10.278-13.554-6.159-21.074%20s13.554-10.277,21.074-6.158c43.57,23.862,95.593,23.864,139.163,0c0.033-0.018,0.065-0.035,0.098-0.053%20c25.807-14.114,54.991-21.573,84.406-21.573c29.398,0,58.567,7.451,84.364,21.55c0.047,0.025,0.093,0.051,0.14,0.076%20c43.534,23.843,95.508,23.864,139.056,0.059c0.038-0.021,0.075-0.042,0.113-0.063c25.828-14.145,55.049-21.622,84.496-21.622%20c0.002,0,0,0,0.002,0c29.449,0,58.668,7.478,84.497,21.625c43.57,23.863,95.595,23.862,139.165,0.001%20c0.021-0.013,0.043-0.024,0.065-0.036c25.813-14.124,55.011-21.591,84.438-21.591c29.42,0,58.61,7.463,84.421,21.582%20c0.027,0.015,0.055,0.03,0.082,0.045c43.539,23.847,95.521,23.862,139.074,0.049c0.032-0.018,0.064-0.035,0.096-0.053%20c25.829-14.146,55.047-21.623,84.496-21.623s58.667,7.477,84.496,21.623c43.58,23.867,95.604,23.866,139.172,0.005%20c0.039-0.021,0.079-0.043,0.118-0.064c25.803-14.108,54.98-21.564,84.389-21.564c29.448-0.001,58.666,7.476,84.494,21.62%20c0.038,0.021,0.076,0.042,0.114,0.063c43.549,23.807,95.528,23.791,139.063-0.051c7.52-4.121,16.955-1.361,21.073,6.159%20c4.119,7.521,1.361,16.955-6.159,21.073C1929.089,1166.27,1899.872,1173.746,1870.425,1173.746z'%3e%3canimateTransform%20attributeName='transform'%20type='translate'%20from='0%200'%20to='312.5%200'%20dur='1s'%20calcMode='linear'%20repeatCount='indefinite'%20/%3e%3c/path%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='610%201101%201220%2075'%3e%3cpath%20fill='%23D0BCFF'%20d='M1870.425,1173.746c-29.448,0-58.665-7.477-84.493-21.622c-0.03-0.016-0.061-0.032-0.09-0.049%20c-43.555-23.82-95.546-23.809-139.091,0.039c-0.037,0.021-0.075,0.042-0.113,0.062c-25.803,14.109-54.984,21.567-84.394,21.568%20c-29.449,0-58.667-7.478-84.495-21.623c-43.554-23.852-95.539-23.865-139.089-0.052c-0.03,0.018-0.062,0.034-0.092,0.051%20c-25.83,14.146-55.048,21.623-84.497,21.623c-29.423,0-58.613-7.463-84.425-21.584c-0.025-0.014-0.052-0.028-0.077-0.042%20c-43.572-23.863-95.596-23.862-139.164-0.001c-0.028,0.016-0.057,0.031-0.085,0.046c-25.809,14.117-55.001,21.581-84.418,21.581%20c-0.002,0,0,0-0.001,0c-29.45-0.001-58.669-7.479-84.498-21.625c-43.534-23.845-95.513-23.863-139.063-0.058%20c-0.036,0.021-0.072,0.04-0.108,0.06c-25.829,14.146-55.047,21.623-84.496,21.623c-29.398,0-58.566-7.451-84.362-21.551%20c-0.048-0.024-0.095-0.05-0.142-0.075c-43.568-23.863-95.593-23.863-139.163,0c-0.027,0.015-0.054,0.028-0.081,0.043%20c-25.811,14.12-55.001,21.583-84.421,21.583c-29.45,0-58.668-7.478-84.497-21.624c-7.521-4.118-10.278-13.554-6.159-21.074%20s13.554-10.277,21.074-6.158c43.57,23.862,95.593,23.864,139.163,0c0.033-0.018,0.065-0.035,0.098-0.053%20c25.807-14.114,54.991-21.573,84.406-21.573c29.398,0,58.567,7.451,84.364,21.55c0.047,0.025,0.093,0.051,0.14,0.076%20c43.534,23.843,95.508,23.864,139.056,0.059c0.038-0.021,0.075-0.042,0.113-0.063c25.828-14.145,55.049-21.622,84.496-21.622%20c0.002,0,0,0,0.002,0c29.449,0,58.668,7.478,84.497,21.625c43.57,23.863,95.595,23.862,139.165,0.001%20c0.021-0.013,0.043-0.024,0.065-0.036c25.813-14.124,55.011-21.591,84.438-21.591c29.42,0,58.61,7.463,84.421,21.582%20c0.027,0.015,0.055,0.03,0.082,0.045c43.539,23.847,95.521,23.862,139.074,0.049c0.032-0.018,0.064-0.035,0.096-0.053%20c25.829-14.146,55.047-21.623,84.496-21.623s58.667,7.477,84.496,21.623c43.58,23.867,95.604,23.866,139.172,0.005%20c0.039-0.021,0.079-0.043,0.118-0.064c25.803-14.108,54.98-21.564,84.389-21.564c29.448-0.001,58.666,7.476,84.494,21.62%20c0.038,0.021,0.076,0.042,0.114,0.063c43.549,23.807,95.528,23.791,139.063-0.051c7.52-4.121,16.955-1.361,21.073,6.159%20c4.119,7.521,1.361,16.955-6.159,21.073C1929.089,1166.27,1899.872,1173.746,1870.425,1173.746z'%3e%3canimateTransform%20attributeName='transform'%20type='translate'%20from='0%200'%20to='312.5%200'%20dur='1s'%20calcMode='linear'%20repeatCount='indefinite'%20/%3e%3c/path%3e%3c/svg%3e");-webkit-mask-position:0 50%;mask-position:0 50%;-webkit-mask-repeat:repeat-x;mask-repeat:repeat-x;-webkit-mask-size:auto 100%;mask-size:auto 100%}progress.circle{display:inline-block;inline-size:2.5rem;block-size:2.5rem;border-radius:50%;border-width:.3rem;border-style:solid;border-color:currentcolor;animation:1.6s to-circular linear infinite;background:none;flex:none}progress.circle::-moz-progress-bar{background:none}progress.circle.small{inline-size:1.5rem;block-size:1.5rem;border-width:.2rem}progress.circle.large{inline-size:3.5rem;block-size:3.5rem;border-width:.4rem}:is(nav,.row,.field)>progress:not(.circle,.small,.medium,.large){flex:auto}progress.max{display:unset;position:absolute;inline-size:100%!important;block-size:100%!important;color:currentColor;background:none;top:0;right:0;bottom:0;left:0;border-radius:inherit;animation:none;writing-mode:horizontal-tb;opacity:.33}progress.max[class*=-text]{opacity:1}progress:is(.horizontal,.vertical,.max){display:unset;inline-size:100%!important}progress.vertical{writing-mode:vertical-lr}progress.max.vertical{transform:rotate(-180deg)}progress.max+*{margin-block-start:0}:is(.button,button,.chip)>progress.circle{color:inherit}@supports (-moz-appearance:none){progress.max.vertical{transform:none}}@keyframes to-linear{0%{margin-inline-start:-100%}50%{margin-inline-start:0%}to{margin-inline-start:100%}}@keyframes to-circular{0%{transform:rotate(0);clip-path:polygon(50% 50%,0% 0%,50% 0%,50% 0%,50% 0%,50% 0%,50% 0%,50% 0%,50% 0%)}20%{clip-path:polygon(50% 50%,0% 0%,50% 0%,100% 0%,100% 0%,100% 0%,100% 0%,100% 0%,100% 0%)}30%{clip-path:polygon(50% 50%,0% 0%,50% 0%,100% 0%,100% 50%,100% 50%,100% 50%,100% 50%,100% 50%)}40%{clip-path:polygon(50% 50%,0% 0%,50% 0%,100% 0%,100% 50%,100% 100%,100% 100%,100% 100%,100% 100%)}50%{clip-path:polygon(50% 50%,50% 0%,50% 0%,100% 0%,100% 50%,100% 100%,50% 100%,50% 100%,50% 100%)}60%{clip-path:polygon(50% 50%,100% 50%,100% 50%,100% 50%,100% 50%,100% 100%,50% 100%,0% 100%,0% 100%)}70%{clip-path:polygon(50% 50%,50% 100%,50% 100%,50% 100%,50% 100%,50% 100%,50% 100%,0% 100%,0% 50%)}80%{clip-path:polygon(50% 50%,0% 100%,0% 100%,0% 100%,0% 100%,0% 100%,0% 100%,0% 100%,0% 50%)}90%{transform:rotate(360deg);clip-path:polygon(50% 50%,0% 50%,0% 50%,0% 50%,0% 50%,0% 50%,0% 50%,0% 50%,0% 50%)}to{clip-path:polygon(50% 50%,0% 50%,0% 50%,0% 50%,0% 50%,0% 50%,0% 50%,0% 50%,0% 50%)}}.shape{display:flex;align-items:center;justify-content:center;color:var(--on-primary);background-color:var(--primary);-webkit-mask-repeat:no-repeat;mask-repeat:no-repeat;-webkit-mask-position:center;mask-position:center;-webkit-mask-size:contain;mask-size:contain;border-radius:0;block-size:3.5rem;inline-size:3.5rem;margin:0!important;padding:0!important;border:0!important}.transparent>.shape>i{filter:invert(1)}.shape.tiny-space{-webkit-mask-size:90%;mask-size:90%}.shape.space,.shape.small-space{-webkit-mask-size:80%;mask-size:80%}.shape.medium-space{-webkit-mask-size:70%;mask-size:70%}.shape.large-space{-webkit-mask-size:60%;mask-size:60%}.shape.extra-space{-webkit-mask-size:50%;mask-size:50%}.shape.tiny{block-size:2.5rem;inline-size:2.5rem}.shape.medium{block-size:4.5rem;inline-size:4.5rem}.shape.large{block-size:5.5rem;inline-size:5.5rem}.shape.extra{block-size:6.5rem;inline-size:6.5rem}.shape.max,.shape>.responsive,.shape>.responsive>.responsive{position:absolute;top:0;right:0;bottom:0;left:0;block-size:100%;inline-size:100%;margin:0!important;padding:0!important;border:0!important}.shape>.responsive{background:inherit;color:inherit}.shape.rotate{animation:linear to-shape-rotate infinite 12s}.shape.rotate>*{animation:linear to-shape-rotate infinite 12s reverse}.shape.fast-rotate{animation:linear to-shape-rotate infinite 6s}.shape.fast-rotate>*{animation:linear to-shape-rotate infinite 6s reverse}.shape.slow-rotate{animation:linear to-shape-rotate infinite 24s}.shape.slow-rotate>*{animation:linear to-shape-rotate infinite 24s reverse}:is(button,.button,.chip):has(>.shape)>.responsive{border:none}.shape.arch{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='304'%20height='304'%20viewBox='0%200%20304%20304'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M304%20253.72C304%20259.83%20304%20262.89%20303.69%20265.46C301.31%20285.51%20285.51%20301.31%20265.46%20303.69C262.89%20304%20259.83%20304%20253.72%20304H50.281C44.169%20304%2041.113%20304%2038.544%20303.69C18.495%20301.31%202.68799%20285.51%200.304993%20265.46C-7.33137e-06%20262.89%200%20259.83%200%20253.72V152C0%2068.05%2068.053%200%20152%200C235.95%200%20304%2068.05%20304%20152V253.72Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='304'%20height='304'%20viewBox='0%200%20304%20304'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M304%20253.72C304%20259.83%20304%20262.89%20303.69%20265.46C301.31%20285.51%20285.51%20301.31%20265.46%20303.69C262.89%20304%20259.83%20304%20253.72%20304H50.281C44.169%20304%2041.113%20304%2038.544%20303.69C18.495%20301.31%202.68799%20285.51%200.304993%20265.46C-7.33137e-06%20262.89%200%20259.83%200%20253.72V152C0%2068.05%2068.053%200%20152%200C235.95%200%20304%2068.05%20304%20152V253.72Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.arrow{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='316'%20height='278'%20viewBox='0%200%20316%20278'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M271.57%20122.2C257.552%20100.62%20243.535%2079.01%20229.517%2057.43C220.423%2043.42%20211.167%2029.2202%20198.872%2018.0902C186.576%206.94018%20170.648%20-0.939823%20154.316%200.0901773C139.976%201.01018%20126.684%208.72013%20116.191%2018.7901C105.698%2028.8601%2097.546%2041.2601%2089.528%2053.5401C67.842%2086.7201%2046.13%20119.9%2024.444%20153.1C14.139%20168.86%203.56499%20185.31%200.712987%20204.09C-2.73101%20226.78%206.55198%20249.89%2023.018%20264.98C40.237%20280.76%2068.138%20279.48%2089.098%20275.16C112.075%20270.41%20134.541%20261.48%20157.975%20261.51C178.047%20261.51%20197.446%20268.11%20216.979%20272.91C236.485%20277.68%20257.445%20280.62%20276.279%20273.52C299.659%20264.73%20316.448%20239.73%20315.991%20214.07C315.56%20190.66%20302.457%20169.75%20289.839%20150.27C283.758%20140.92%20277.678%20131.55%20271.597%20122.2H271.57Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='316'%20height='278'%20viewBox='0%200%20316%20278'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M271.57%20122.2C257.552%20100.62%20243.535%2079.01%20229.517%2057.43C220.423%2043.42%20211.167%2029.2202%20198.872%2018.0902C186.576%206.94018%20170.648%20-0.939823%20154.316%200.0901773C139.976%201.01018%20126.684%208.72013%20116.191%2018.7901C105.698%2028.8601%2097.546%2041.2601%2089.528%2053.5401C67.842%2086.7201%2046.13%20119.9%2024.444%20153.1C14.139%20168.86%203.56499%20185.31%200.712987%20204.09C-2.73101%20226.78%206.55198%20249.89%2023.018%20264.98C40.237%20280.76%2068.138%20279.48%2089.098%20275.16C112.075%20270.41%20134.541%20261.48%20157.975%20261.51C178.047%20261.51%20197.446%20268.11%20216.979%20272.91C236.485%20277.68%20257.445%20280.62%20276.279%20273.52C299.659%20264.73%20316.448%20239.73%20315.991%20214.07C315.56%20190.66%20302.457%20169.75%20289.839%20150.27C283.758%20140.92%20277.678%20131.55%20271.597%20122.2H271.57Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.boom{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M156.818%2010.1599C157.571%204.13988%20157.948%201.13006%20158.52%200.590059C159.353%20-0.199941%20160.647%20-0.199941%20161.48%200.590059C162.052%201.13006%20162.429%204.13988%20163.182%2010.1599L172.76%2086.74C173.064%2089.17%20173.216%2090.3799%20173.652%2090.8899C174.285%2091.6099%20175.32%2091.8399%20176.193%2091.4299C176.794%2091.1499%20177.425%2090.1%20178.686%2088L218.415%2021.9599C221.539%2016.7699%20223.101%2014.1699%20223.842%2013.9099C224.92%2013.5399%20226.102%2014.0699%20226.546%2015.1299C226.851%2015.8499%20225.977%2018.76%20224.229%2024.57L201.999%2098.4399C201.293%20100.79%20200.941%20101.96%20201.136%20102.59C201.42%20103.52%20202.276%20104.14%20203.238%20104.13C203.901%20104.12%20204.901%20103.42%20206.901%20102.02L269.911%2057.9399C274.867%2054.4699%20277.344%2052.74%20278.125%2052.8C279.261%2052.9%20280.127%2053.87%20280.105%2055.01C280.091%2055.8%20278.117%2058.0999%20274.17%2062.6899L223.976%20121.09C222.383%20122.94%20221.587%20123.87%20221.508%20124.53C221.393%20125.49%20221.922%20126.41%20222.807%20126.79C223.416%20127.06%20224.613%20126.82%20227.006%20126.36L302.403%20111.86C308.332%20110.72%20311.297%20110.15%20311.983%20110.53C312.981%20111.08%20313.381%20112.32%20312.898%20113.36C312.566%20114.07%20309.834%20115.36%20304.37%20117.94L234.892%20150.77C232.686%20151.81%20231.584%20152.33%20231.244%20152.9C230.751%20153.73%20230.862%20154.79%20231.516%20155.5C231.966%20155.99%20233.152%20156.27%20235.525%20156.82L310.272%20174.41C316.15%20175.79%20319.09%20176.48%20319.562%20177.11C320.249%20178.02%20320.114%20179.32%20319.253%20180.07C318.66%20180.58%20315.643%20180.65%20309.607%20180.77L232.857%20182.34C230.421%20182.39%20229.203%20182.42%20228.662%20182.8C227.875%20183.36%20227.548%20184.37%20227.859%20185.29C228.073%20185.92%20229.043%20186.66%20230.985%20188.14L292.158%20234.76C296.968%20238.43%20299.374%20240.27%20299.551%20241.03C299.809%20242.15%20299.162%20243.28%20298.071%20243.61C297.322%20243.84%20294.54%20242.66%20288.975%20240.31L218.226%20210.36C215.98%20209.41%20214.857%20208.93%20214.207%20209.06C213.263%20209.25%20212.555%20210.04%20212.468%20211C212.409%20211.66%20212.996%20212.74%20214.171%20214.88L251.192%20282.5C254.103%20287.81%20255.559%20290.47%20255.411%20291.25C255.194%20292.37%20254.148%20293.14%20253.016%20293C252.238%20292.9%20250.173%20290.69%20246.043%20286.26L193.526%20229.96C191.859%20228.18%20191.025%20227.28%20190.38%20227.14C189.441%20226.92%20188.475%20227.35%20188.006%20228.2C187.683%20228.78%20187.786%20230%20187.991%20232.44L194.458%20309.35C194.967%20315.4%20195.221%20318.42%20194.773%20319.07C194.12%20320.01%20192.854%20320.28%20191.878%20319.69C191.206%20319.28%20190.215%20316.41%20188.233%20310.68L163.029%20237.78C162.229%20235.46%20161.829%20234.31%20161.299%20233.91C160.529%20233.33%20159.471%20233.33%20158.701%20233.91C158.171%20234.31%20157.771%20235.46%20156.971%20237.78L131.767%20310.68C129.785%20316.41%20128.794%20319.28%20128.122%20319.69C127.146%20320.28%20125.88%20320.01%20125.227%20319.07C124.779%20318.42%20125.033%20315.4%20125.542%20309.35L132.009%20232.44C132.214%20230%20132.317%20228.78%20131.994%20228.2C131.525%20227.35%20130.559%20226.92%20129.621%20227.14C128.975%20227.28%20128.141%20228.18%20126.474%20229.96L73.9568%20286.26C69.8267%20290.69%2067.7616%20292.9%2066.984%20293C65.8524%20293.14%2064.8055%20292.37%2064.5894%20291.25C64.4409%20290.47%2065.8966%20287.81%2068.808%20282.5L105.829%20214.88C107.004%20212.74%20107.591%20211.66%20107.532%20211C107.445%20210.04%20106.737%20209.25%20105.793%20209.06C105.143%20208.93%20104.02%20209.41%20101.774%20210.36L31.0245%20240.31C25.4605%20242.66%2022.6785%20243.84%2021.9288%20243.61C20.838%20243.28%2020.191%20242.15%2020.4489%20241.03C20.6262%20240.27%2023.0316%20238.43%2027.8424%20234.76L89.0148%20188.14C90.957%20186.66%2091.927%20185.92%2092.141%20185.29C92.452%20184.37%2092.125%20183.36%2091.338%20182.8C90.797%20182.42%2089.5787%20182.39%2087.1425%20182.34L10.3933%20180.77C4.35749%20180.65%201.3395%20180.58%200.747495%20180.07C-0.114065%20179.32%20-0.249315%20178.02%200.438095%20177.11C0.910495%20176.48%203.84969%20175.79%209.72809%20174.41L84.475%20156.82C86.8477%20156.27%2088.034%20155.99%2088.4844%20155.5C89.1385%20154.79%2089.2491%20153.73%2088.756%20152.9C88.4164%20152.33%2087.3137%20151.81%2085.1083%20150.77L15.6304%20117.94C10.1664%20115.36%207.4344%20114.07%207.1023%20113.36C6.6191%20112.32%207.01889%20111.08%208.01699%20110.53C8.70279%20110.15%2011.6676%20110.72%2017.5971%20111.86L92.994%20126.36C95.387%20126.82%2096.584%20127.06%2097.193%20126.79C98.078%20126.41%2098.607%20125.49%2098.492%20124.53C98.414%20123.87%2097.617%20122.94%2096.024%20121.09L45.8303%2062.6899C41.8829%2058.0999%2039.9092%2055.8%2039.8946%2055.01C39.8732%2053.87%2040.739%2052.9%2041.8751%2052.8C42.6558%2052.74%2045.1335%2054.4699%2050.0889%2057.9399L113.099%20102.02C115.099%20103.42%20116.099%20104.12%20116.762%20104.13C117.724%20104.14%20118.58%20103.52%20118.864%20102.59C119.059%20101.96%20118.707%20100.79%20118.001%2098.4399L95.771%2024.57C94.023%2018.76%2093.149%2015.8499%2093.454%2015.1299C93.898%2014.0699%2095.08%2013.5399%2096.158%2013.9099C96.899%2014.1699%2098.461%2016.7699%20101.585%2021.9599L141.314%2088C142.575%2090.1%20143.206%2091.1499%20143.807%2091.4299C144.68%2091.8399%20145.715%2091.6099%20146.348%2090.8899C146.784%2090.3799%20146.936%2089.17%20147.24%2086.74L156.818%2010.1599Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M156.818%2010.1599C157.571%204.13988%20157.948%201.13006%20158.52%200.590059C159.353%20-0.199941%20160.647%20-0.199941%20161.48%200.590059C162.052%201.13006%20162.429%204.13988%20163.182%2010.1599L172.76%2086.74C173.064%2089.17%20173.216%2090.3799%20173.652%2090.8899C174.285%2091.6099%20175.32%2091.8399%20176.193%2091.4299C176.794%2091.1499%20177.425%2090.1%20178.686%2088L218.415%2021.9599C221.539%2016.7699%20223.101%2014.1699%20223.842%2013.9099C224.92%2013.5399%20226.102%2014.0699%20226.546%2015.1299C226.851%2015.8499%20225.977%2018.76%20224.229%2024.57L201.999%2098.4399C201.293%20100.79%20200.941%20101.96%20201.136%20102.59C201.42%20103.52%20202.276%20104.14%20203.238%20104.13C203.901%20104.12%20204.901%20103.42%20206.901%20102.02L269.911%2057.9399C274.867%2054.4699%20277.344%2052.74%20278.125%2052.8C279.261%2052.9%20280.127%2053.87%20280.105%2055.01C280.091%2055.8%20278.117%2058.0999%20274.17%2062.6899L223.976%20121.09C222.383%20122.94%20221.587%20123.87%20221.508%20124.53C221.393%20125.49%20221.922%20126.41%20222.807%20126.79C223.416%20127.06%20224.613%20126.82%20227.006%20126.36L302.403%20111.86C308.332%20110.72%20311.297%20110.15%20311.983%20110.53C312.981%20111.08%20313.381%20112.32%20312.898%20113.36C312.566%20114.07%20309.834%20115.36%20304.37%20117.94L234.892%20150.77C232.686%20151.81%20231.584%20152.33%20231.244%20152.9C230.751%20153.73%20230.862%20154.79%20231.516%20155.5C231.966%20155.99%20233.152%20156.27%20235.525%20156.82L310.272%20174.41C316.15%20175.79%20319.09%20176.48%20319.562%20177.11C320.249%20178.02%20320.114%20179.32%20319.253%20180.07C318.66%20180.58%20315.643%20180.65%20309.607%20180.77L232.857%20182.34C230.421%20182.39%20229.203%20182.42%20228.662%20182.8C227.875%20183.36%20227.548%20184.37%20227.859%20185.29C228.073%20185.92%20229.043%20186.66%20230.985%20188.14L292.158%20234.76C296.968%20238.43%20299.374%20240.27%20299.551%20241.03C299.809%20242.15%20299.162%20243.28%20298.071%20243.61C297.322%20243.84%20294.54%20242.66%20288.975%20240.31L218.226%20210.36C215.98%20209.41%20214.857%20208.93%20214.207%20209.06C213.263%20209.25%20212.555%20210.04%20212.468%20211C212.409%20211.66%20212.996%20212.74%20214.171%20214.88L251.192%20282.5C254.103%20287.81%20255.559%20290.47%20255.411%20291.25C255.194%20292.37%20254.148%20293.14%20253.016%20293C252.238%20292.9%20250.173%20290.69%20246.043%20286.26L193.526%20229.96C191.859%20228.18%20191.025%20227.28%20190.38%20227.14C189.441%20226.92%20188.475%20227.35%20188.006%20228.2C187.683%20228.78%20187.786%20230%20187.991%20232.44L194.458%20309.35C194.967%20315.4%20195.221%20318.42%20194.773%20319.07C194.12%20320.01%20192.854%20320.28%20191.878%20319.69C191.206%20319.28%20190.215%20316.41%20188.233%20310.68L163.029%20237.78C162.229%20235.46%20161.829%20234.31%20161.299%20233.91C160.529%20233.33%20159.471%20233.33%20158.701%20233.91C158.171%20234.31%20157.771%20235.46%20156.971%20237.78L131.767%20310.68C129.785%20316.41%20128.794%20319.28%20128.122%20319.69C127.146%20320.28%20125.88%20320.01%20125.227%20319.07C124.779%20318.42%20125.033%20315.4%20125.542%20309.35L132.009%20232.44C132.214%20230%20132.317%20228.78%20131.994%20228.2C131.525%20227.35%20130.559%20226.92%20129.621%20227.14C128.975%20227.28%20128.141%20228.18%20126.474%20229.96L73.9568%20286.26C69.8267%20290.69%2067.7616%20292.9%2066.984%20293C65.8524%20293.14%2064.8055%20292.37%2064.5894%20291.25C64.4409%20290.47%2065.8966%20287.81%2068.808%20282.5L105.829%20214.88C107.004%20212.74%20107.591%20211.66%20107.532%20211C107.445%20210.04%20106.737%20209.25%20105.793%20209.06C105.143%20208.93%20104.02%20209.41%20101.774%20210.36L31.0245%20240.31C25.4605%20242.66%2022.6785%20243.84%2021.9288%20243.61C20.838%20243.28%2020.191%20242.15%2020.4489%20241.03C20.6262%20240.27%2023.0316%20238.43%2027.8424%20234.76L89.0148%20188.14C90.957%20186.66%2091.927%20185.92%2092.141%20185.29C92.452%20184.37%2092.125%20183.36%2091.338%20182.8C90.797%20182.42%2089.5787%20182.39%2087.1425%20182.34L10.3933%20180.77C4.35749%20180.65%201.3395%20180.58%200.747495%20180.07C-0.114065%20179.32%20-0.249315%20178.02%200.438095%20177.11C0.910495%20176.48%203.84969%20175.79%209.72809%20174.41L84.475%20156.82C86.8477%20156.27%2088.034%20155.99%2088.4844%20155.5C89.1385%20154.79%2089.2491%20153.73%2088.756%20152.9C88.4164%20152.33%2087.3137%20151.81%2085.1083%20150.77L15.6304%20117.94C10.1664%20115.36%207.4344%20114.07%207.1023%20113.36C6.6191%20112.32%207.01889%20111.08%208.01699%20110.53C8.70279%20110.15%2011.6676%20110.72%2017.5971%20111.86L92.994%20126.36C95.387%20126.82%2096.584%20127.06%2097.193%20126.79C98.078%20126.41%2098.607%20125.49%2098.492%20124.53C98.414%20123.87%2097.617%20122.94%2096.024%20121.09L45.8303%2062.6899C41.8829%2058.0999%2039.9092%2055.8%2039.8946%2055.01C39.8732%2053.87%2040.739%2052.9%2041.8751%2052.8C42.6558%2052.74%2045.1335%2054.4699%2050.0889%2057.9399L113.099%20102.02C115.099%20103.42%20116.099%20104.12%20116.762%20104.13C117.724%20104.14%20118.58%20103.52%20118.864%20102.59C119.059%20101.96%20118.707%20100.79%20118.001%2098.4399L95.771%2024.57C94.023%2018.76%2093.149%2015.8499%2093.454%2015.1299C93.898%2014.0699%2095.08%2013.5399%2096.158%2013.9099C96.899%2014.1699%2098.461%2016.7699%20101.585%2021.9599L141.314%2088C142.575%2090.1%20143.206%2091.1499%20143.807%2091.4299C144.68%2091.8399%20145.715%2091.6099%20146.348%2090.8899C146.784%2090.3799%20146.936%2089.17%20147.24%2086.74L156.818%2010.1599Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.bun{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='310'%20height='320'%20viewBox='0%200%20310%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0%2081.36C0%2036.42%2036.42%200%2081.36%200H228.64C273.58%200%20310%2036.42%20310%2081.36C310%20118.41%20285.23%20149.68%20251.34%20159.5C251.12%20159.57%20250.97%20159.77%20250.97%20160C250.97%20160.23%20251.12%20160.43%20251.34%20160.5C285.23%20170.32%20310%20201.59%20310%20238.64C310%20283.58%20273.58%20320%20228.64%20320H81.36C36.42%20320%200%20283.58%200%20238.64C0%20201.83%2024.45%20170.73%2058%20160.69C58.3%20160.6%2058.51%20160.32%2058.51%20160C58.51%20159.68%2058.3%20159.4%2058%20159.31C24.45%20149.27%200%20118.17%200%2081.36Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='310'%20height='320'%20viewBox='0%200%20310%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0%2081.36C0%2036.42%2036.42%200%2081.36%200H228.64C273.58%200%20310%2036.42%20310%2081.36C310%20118.41%20285.23%20149.68%20251.34%20159.5C251.12%20159.57%20250.97%20159.77%20250.97%20160C250.97%20160.23%20251.12%20160.43%20251.34%20160.5C285.23%20170.32%20310%20201.59%20310%20238.64C310%20283.58%20273.58%20320%20228.64%20320H81.36C36.42%20320%200%20283.58%200%20238.64C0%20201.83%2024.45%20170.73%2058%20160.69C58.3%20160.6%2058.51%20160.32%2058.51%20160C58.51%20159.68%2058.3%20159.4%2058%20159.31C24.45%20149.27%200%20118.17%200%2081.36Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.burst{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M157.39%202.55C158.13%201.23%20158.49%200.58%20158.94%200.3C159.59%20-0.1%20160.41%20-0.1%20161.06%200.3C161.51%200.58%20161.87%201.23%20162.61%202.55L187.87%2047.6999C188.32%2048.5099%20188.55%2048.92%20188.86%2049.16C189.3%2049.52%20189.87%2049.6699%20190.43%2049.5799C190.82%2049.5199%20191.22%2049.29%20192.01%2048.81L236.47%2022.3399C237.76%2021.5699%20238.41%2021.18%20238.93%2021.17C239.7%2021.14%20240.4%2021.5499%20240.77%2022.2199C241.02%2022.6899%20241.01%2023.4399%20240.99%2024.9499L240.29%2076.68C240.27%2077.61%20240.27%2078.0699%20240.41%2078.4399C240.61%2078.9699%20241.03%2079.3899%20241.56%2079.5899C241.93%2079.7299%20242.39%2079.7299%20243.32%2079.7099L295.05%2079.01C296.56%2078.99%20297.31%2078.9799%20297.78%2079.2299C298.45%2079.5999%20298.86%2080.2999%20298.83%2081.0699C298.82%2081.5899%20298.43%2082.24%20297.66%2083.53L271.19%20127.99C270.71%20128.78%20270.48%20129.18%20270.42%20129.57C270.33%20130.13%20270.48%20130.7%20270.84%20131.14C271.08%20131.45%20271.49%20131.68%20272.3%20132.13L317.45%20157.39C318.77%20158.13%20319.42%20158.49%20319.7%20158.94C320.1%20159.59%20320.1%20160.41%20319.7%20161.06C319.42%20161.51%20318.77%20161.87%20317.45%20162.61L272.3%20187.87C271.49%20188.32%20271.08%20188.55%20270.84%20188.86C270.48%20189.3%20270.33%20189.87%20270.42%20190.43C270.48%20190.82%20270.71%20191.22%20271.19%20192.01L297.66%20236.47C298.43%20237.76%20298.82%20238.41%20298.83%20238.93C298.86%20239.7%20298.45%20240.4%20297.78%20240.77C297.31%20241.02%20296.56%20241.01%20295.05%20240.99L243.32%20240.29C242.39%20240.27%20241.93%20240.27%20241.56%20240.41C241.03%20240.61%20240.61%20241.03%20240.41%20241.56C240.27%20241.93%20240.27%20242.39%20240.29%20243.32L240.99%20295.05C241.01%20296.56%20241.02%20297.31%20240.77%20297.78C240.4%20298.45%20239.7%20298.86%20238.93%20298.83C238.41%20298.82%20237.76%20298.43%20236.47%20297.66L192.01%20271.19C191.22%20270.71%20190.82%20270.48%20190.43%20270.42C189.87%20270.33%20189.3%20270.48%20188.86%20270.84C188.55%20271.08%20188.32%20271.49%20187.87%20272.3L162.61%20317.45C161.87%20318.77%20161.51%20319.42%20161.06%20319.7C160.41%20320.1%20159.59%20320.1%20158.94%20319.7C158.49%20319.42%20158.13%20318.77%20157.39%20317.45L132.13%20272.3C131.68%20271.49%20131.45%20271.08%20131.14%20270.84C130.7%20270.48%20130.13%20270.33%20129.57%20270.42C129.18%20270.48%20128.78%20270.71%20127.99%20271.19L83.53%20297.66C82.24%20298.43%2081.5899%20298.82%2081.0699%20298.83C80.2999%20298.86%2079.5999%20298.45%2079.2299%20297.78C78.9799%20297.31%2078.99%20296.56%2079.01%20295.05L79.7099%20243.32C79.7299%20242.39%2079.7299%20241.93%2079.5899%20241.56C79.3899%20241.03%2078.9699%20240.61%2078.4399%20240.41C78.0699%20240.27%2077.61%20240.27%2076.68%20240.29L24.9499%20240.99C23.4399%20241.01%2022.6899%20241.02%2022.2199%20240.77C21.5499%20240.4%2021.14%20239.7%2021.17%20238.93C21.18%20238.41%2021.5699%20237.76%2022.3399%20236.47L48.81%20192.01C49.29%20191.22%2049.5199%20190.82%2049.5799%20190.43C49.6699%20189.87%2049.52%20189.3%2049.16%20188.86C48.92%20188.55%2048.5099%20188.32%2047.6999%20187.87L2.55%20162.61C1.23%20161.87%200.58%20161.51%200.3%20161.06C-0.1%20160.41%20-0.1%20159.59%200.3%20158.94C0.58%20158.49%201.23%20158.13%202.55%20157.39L47.6999%20132.13C48.5099%20131.68%2048.92%20131.45%2049.16%20131.14C49.52%20130.7%2049.6699%20130.13%2049.5799%20129.57C49.5199%20129.18%2049.29%20128.78%2048.81%20127.99L22.3399%2083.53C21.5699%2082.24%2021.18%2081.5899%2021.17%2081.0699C21.14%2080.2999%2021.5499%2079.5999%2022.2199%2079.2299C22.6899%2078.9799%2023.4399%2078.99%2024.9499%2079.01L76.68%2079.7099C77.61%2079.7299%2078.0699%2079.7299%2078.4399%2079.5899C78.9699%2079.3899%2079.3899%2078.9699%2079.5899%2078.4399C79.7299%2078.0699%2079.7299%2077.61%2079.7099%2076.68L79.01%2024.9499C78.99%2023.4399%2078.9799%2022.6899%2079.2299%2022.2199C79.5999%2021.5499%2080.2999%2021.14%2081.0699%2021.17C81.5899%2021.18%2082.24%2021.5699%2083.53%2022.3399L127.99%2048.81C128.78%2049.29%20129.18%2049.5199%20129.57%2049.5799C130.13%2049.6699%20130.7%2049.52%20131.14%2049.16C131.45%2048.92%20131.68%2048.5099%20132.13%2047.6999L157.39%202.55Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M157.39%202.55C158.13%201.23%20158.49%200.58%20158.94%200.3C159.59%20-0.1%20160.41%20-0.1%20161.06%200.3C161.51%200.58%20161.87%201.23%20162.61%202.55L187.87%2047.6999C188.32%2048.5099%20188.55%2048.92%20188.86%2049.16C189.3%2049.52%20189.87%2049.6699%20190.43%2049.5799C190.82%2049.5199%20191.22%2049.29%20192.01%2048.81L236.47%2022.3399C237.76%2021.5699%20238.41%2021.18%20238.93%2021.17C239.7%2021.14%20240.4%2021.5499%20240.77%2022.2199C241.02%2022.6899%20241.01%2023.4399%20240.99%2024.9499L240.29%2076.68C240.27%2077.61%20240.27%2078.0699%20240.41%2078.4399C240.61%2078.9699%20241.03%2079.3899%20241.56%2079.5899C241.93%2079.7299%20242.39%2079.7299%20243.32%2079.7099L295.05%2079.01C296.56%2078.99%20297.31%2078.9799%20297.78%2079.2299C298.45%2079.5999%20298.86%2080.2999%20298.83%2081.0699C298.82%2081.5899%20298.43%2082.24%20297.66%2083.53L271.19%20127.99C270.71%20128.78%20270.48%20129.18%20270.42%20129.57C270.33%20130.13%20270.48%20130.7%20270.84%20131.14C271.08%20131.45%20271.49%20131.68%20272.3%20132.13L317.45%20157.39C318.77%20158.13%20319.42%20158.49%20319.7%20158.94C320.1%20159.59%20320.1%20160.41%20319.7%20161.06C319.42%20161.51%20318.77%20161.87%20317.45%20162.61L272.3%20187.87C271.49%20188.32%20271.08%20188.55%20270.84%20188.86C270.48%20189.3%20270.33%20189.87%20270.42%20190.43C270.48%20190.82%20270.71%20191.22%20271.19%20192.01L297.66%20236.47C298.43%20237.76%20298.82%20238.41%20298.83%20238.93C298.86%20239.7%20298.45%20240.4%20297.78%20240.77C297.31%20241.02%20296.56%20241.01%20295.05%20240.99L243.32%20240.29C242.39%20240.27%20241.93%20240.27%20241.56%20240.41C241.03%20240.61%20240.61%20241.03%20240.41%20241.56C240.27%20241.93%20240.27%20242.39%20240.29%20243.32L240.99%20295.05C241.01%20296.56%20241.02%20297.31%20240.77%20297.78C240.4%20298.45%20239.7%20298.86%20238.93%20298.83C238.41%20298.82%20237.76%20298.43%20236.47%20297.66L192.01%20271.19C191.22%20270.71%20190.82%20270.48%20190.43%20270.42C189.87%20270.33%20189.3%20270.48%20188.86%20270.84C188.55%20271.08%20188.32%20271.49%20187.87%20272.3L162.61%20317.45C161.87%20318.77%20161.51%20319.42%20161.06%20319.7C160.41%20320.1%20159.59%20320.1%20158.94%20319.7C158.49%20319.42%20158.13%20318.77%20157.39%20317.45L132.13%20272.3C131.68%20271.49%20131.45%20271.08%20131.14%20270.84C130.7%20270.48%20130.13%20270.33%20129.57%20270.42C129.18%20270.48%20128.78%20270.71%20127.99%20271.19L83.53%20297.66C82.24%20298.43%2081.5899%20298.82%2081.0699%20298.83C80.2999%20298.86%2079.5999%20298.45%2079.2299%20297.78C78.9799%20297.31%2078.99%20296.56%2079.01%20295.05L79.7099%20243.32C79.7299%20242.39%2079.7299%20241.93%2079.5899%20241.56C79.3899%20241.03%2078.9699%20240.61%2078.4399%20240.41C78.0699%20240.27%2077.61%20240.27%2076.68%20240.29L24.9499%20240.99C23.4399%20241.01%2022.6899%20241.02%2022.2199%20240.77C21.5499%20240.4%2021.14%20239.7%2021.17%20238.93C21.18%20238.41%2021.5699%20237.76%2022.3399%20236.47L48.81%20192.01C49.29%20191.22%2049.5199%20190.82%2049.5799%20190.43C49.6699%20189.87%2049.52%20189.3%2049.16%20188.86C48.92%20188.55%2048.5099%20188.32%2047.6999%20187.87L2.55%20162.61C1.23%20161.87%200.58%20161.51%200.3%20161.06C-0.1%20160.41%20-0.1%20159.59%200.3%20158.94C0.58%20158.49%201.23%20158.13%202.55%20157.39L47.6999%20132.13C48.5099%20131.68%2048.92%20131.45%2049.16%20131.14C49.52%20130.7%2049.6699%20130.13%2049.5799%20129.57C49.5199%20129.18%2049.29%20128.78%2048.81%20127.99L22.3399%2083.53C21.5699%2082.24%2021.18%2081.5899%2021.17%2081.0699C21.14%2080.2999%2021.5499%2079.5999%2022.2199%2079.2299C22.6899%2078.9799%2023.4399%2078.99%2024.9499%2079.01L76.68%2079.7099C77.61%2079.7299%2078.0699%2079.7299%2078.4399%2079.5899C78.9699%2079.3899%2079.3899%2078.9699%2079.5899%2078.4399C79.7299%2078.0699%2079.7299%2077.61%2079.7099%2076.68L79.01%2024.9499C78.99%2023.4399%2078.9799%2022.6899%2079.2299%2022.2199C79.5999%2021.5499%2080.2999%2021.14%2081.0699%2021.17C81.5899%2021.18%2082.24%2021.5699%2083.53%2022.3399L127.99%2048.81C128.78%2049.29%20129.18%2049.5199%20129.57%2049.5799C130.13%2049.6699%20130.7%2049.52%20131.14%2049.16C131.45%2048.92%20131.68%2048.5099%20132.13%2047.6999L157.39%202.55Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.circle{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M320%20160C320%20248.366%20248.366%20320%20160%20320C71.6344%20320%20-1e-05%20248.366%200%20160C0%2071.6344%2071.6345%20-7.72516e-06%20160%200C248.366%207.72516e-06%20320%2071.6345%20320%20160Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M320%20160C320%20248.366%20248.366%20320%20160%20320C71.6344%20320%20-1e-05%20248.366%200%20160C0%2071.6344%2071.6345%20-7.72516e-06%20160%200C248.366%207.72516e-06%20320%2071.6345%20320%20160Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.clamshell{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='254'%20viewBox='0%200%20320%20254'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M306.405%2084.081C313.114%2097.591%20316.468%20104.346%20318.162%20111.403C320.613%20121.606%20320.613%20132.394%20318.162%20142.597C316.468%20149.654%20313.114%20156.409%20306.405%20169.919L285.967%20211.079C279.258%20224.589%20275.904%20231.344%20271.495%20236.58C265.12%20244.148%20257.084%20249.543%20248.259%20252.177C242.155%20254%20235.446%20254%20222.028%20254H97.972C84.554%20254%2077.845%20254%2071.741%20252.178C62.916%20249.543%2054.88%20244.149%2048.505%20236.58C44.096%20231.345%2040.742%20224.589%2034.033%20211.079L13.595%20169.919C6.88599%20156.409%203.53201%20149.654%201.83801%20142.597C-0.612994%20132.394%20-0.612994%20121.606%201.83801%20111.403C3.53201%20104.346%206.88599%2097.591%2013.595%2084.081L34.033%2042.921C40.742%2029.411%2044.096%2022.655%2048.505%2017.42C54.88%209.85098%2062.916%204.45699%2071.741%201.82199C77.845%20-9.05991e-06%2084.554%200%2097.972%200H222.028C235.446%200%20242.155%20-9.05991e-06%20248.259%201.82199C257.084%204.45699%20265.12%209.85098%20271.495%2017.42C275.904%2022.655%20279.258%2029.41%20285.967%2042.921L306.405%2084.081Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='254'%20viewBox='0%200%20320%20254'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M306.405%2084.081C313.114%2097.591%20316.468%20104.346%20318.162%20111.403C320.613%20121.606%20320.613%20132.394%20318.162%20142.597C316.468%20149.654%20313.114%20156.409%20306.405%20169.919L285.967%20211.079C279.258%20224.589%20275.904%20231.344%20271.495%20236.58C265.12%20244.148%20257.084%20249.543%20248.259%20252.177C242.155%20254%20235.446%20254%20222.028%20254H97.972C84.554%20254%2077.845%20254%2071.741%20252.178C62.916%20249.543%2054.88%20244.149%2048.505%20236.58C44.096%20231.345%2040.742%20224.589%2034.033%20211.079L13.595%20169.919C6.88599%20156.409%203.53201%20149.654%201.83801%20142.597C-0.612994%20132.394%20-0.612994%20121.606%201.83801%20111.403C3.53201%20104.346%206.88599%2097.591%2013.595%2084.081L34.033%2042.921C40.742%2029.411%2044.096%2022.655%2048.505%2017.42C54.88%209.85098%2062.916%204.45699%2071.741%201.82199C77.845%20-9.05991e-06%2084.554%200%2097.972%200H222.028C235.446%200%20242.155%20-9.05991e-06%20248.259%201.82199C257.084%204.45699%20265.12%209.85098%20271.495%2017.42C275.904%2022.655%20279.258%2029.41%20285.967%2042.921L306.405%2084.081Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.diamond{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='268'%20height='320'%20viewBox='0%200%20268%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M191.442%20276.481C174.606%20298.514%20166.188%20309.53%20156.466%20314.548C142.383%20321.817%20125.617%20321.817%20111.534%20314.548C101.812%20309.53%2093.394%20298.514%2076.558%20276.481L20.646%20203.308C10.406%20189.906%205.286%20183.206%202.751%20176.032C-0.917%20165.654%20-0.917%20154.346%202.751%20143.968C5.286%20136.794%2010.406%20130.094%2020.646%20116.692L76.558%2043.5194C93.394%2021.4863%20101.812%2010.4697%20111.534%205.45181C125.617%20-1.81727%20142.383%20-1.81727%20156.466%205.4518C166.188%2010.4697%20174.606%2021.4863%20191.442%2043.5195L247.354%20116.692C257.594%20130.094%20262.714%20136.794%20265.249%20143.968C268.917%20154.346%20268.917%20165.654%20265.249%20176.032C262.714%20183.206%20257.594%20189.906%20247.354%20203.308L191.442%20276.481Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='268'%20height='320'%20viewBox='0%200%20268%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M191.442%20276.481C174.606%20298.514%20166.188%20309.53%20156.466%20314.548C142.383%20321.817%20125.617%20321.817%20111.534%20314.548C101.812%20309.53%2093.394%20298.514%2076.558%20276.481L20.646%20203.308C10.406%20189.906%205.286%20183.206%202.751%20176.032C-0.917%20165.654%20-0.917%20154.346%202.751%20143.968C5.286%20136.794%2010.406%20130.094%2020.646%20116.692L76.558%2043.5194C93.394%2021.4863%20101.812%2010.4697%20111.534%205.45181C125.617%20-1.81727%20142.383%20-1.81727%20156.466%205.4518C166.188%2010.4697%20174.606%2021.4863%20191.442%2043.5195L247.354%20116.692C257.594%20130.094%20262.714%20136.794%20265.249%20143.968C268.917%20154.346%20268.917%20165.654%20265.249%20176.032C262.714%20183.206%20257.594%20189.906%20247.354%20203.308L191.442%20276.481Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.fan{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='280'%20height='280'%20viewBox='0%200%20280%20280'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0%2044.2105C0%2042.6506%201.95317e-05%2041.8706%200.0200195%2041.2111C0.71702%2018.7571%2018.757%200.7174%2041.211%200.0205002C41.871%201.82539e-07%2042.651%200%2044.211%200C52.53%200%2056.69%20-4.76837e-07%2060.208%200.1092C179.96%203.8259%20276.17%20100.038%20279.89%20219.792C280%20223.31%20280%20227.47%20280%20235.789C280%20237.349%20280%20238.129%20279.98%20238.789C279.28%20261.243%20261.24%20279.283%20238.79%20279.98C238.13%20280%20237.35%20280%20235.79%20280H62.945C43.927%20280%2034.417%20280%2026.874%20277.013C15.955%20272.69%207.31%20264.045%202.987%20253.126C-4.76837e-07%20245.583%200%20236.073%200%20217.055V44.2105Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='280'%20height='280'%20viewBox='0%200%20280%20280'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0%2044.2105C0%2042.6506%201.95317e-05%2041.8706%200.0200195%2041.2111C0.71702%2018.7571%2018.757%200.7174%2041.211%200.0205002C41.871%201.82539e-07%2042.651%200%2044.211%200C52.53%200%2056.69%20-4.76837e-07%2060.208%200.1092C179.96%203.8259%20276.17%20100.038%20279.89%20219.792C280%20223.31%20280%20227.47%20280%20235.789C280%20237.349%20280%20238.129%20279.98%20238.789C279.28%20261.243%20261.24%20279.283%20238.79%20279.98C238.13%20280%20237.35%20280%20235.79%20280H62.945C43.927%20280%2034.417%20280%2026.874%20277.013C15.955%20272.69%207.31%20264.045%202.987%20253.126C-4.76837e-07%20245.583%200%20236.073%200%20217.055V44.2105Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.flower{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M273.13%2046.8625C261.25%2034.988%20234.19%2040.8597%20201.55%2059.6813C191.77%2023.2855%20176.79%202.9362e-06%20160%200C143.2%20-2.9362e-06%20128.22%2023.2841%20118.45%2059.6779C85.7999%2040.8581%2058.75%2034.9874%2046.87%2046.8614C35%2058.7367%2040.8699%2085.7963%2059.6899%20118.446C23.2899%20128.222%200%20143.204%200%20160C0%20176.793%2023.2801%20191.773%2059.6801%20201.549C40.8501%20234.2%2034.98%20261.261%2046.85%20273.137C58.73%20285.013%2085.7899%20279.138%20118.44%20260.31C128.22%20296.711%20143.2%20320%20160%20320C176.79%20320%20191.77%20296.709%20201.55%20260.307C234.21%20279.136%20261.27%20285.012%20273.15%20273.136C285.02%20261.26%20279.15%20234.2%20260.32%20201.549C296.72%20191.773%20320%20176.793%20320%20160C320%20143.204%20296.71%20128.222%20260.3%20118.446C279.13%2085.7966%20285%2058.7376%20273.13%2046.8625Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill-rule='evenodd'%20clip-rule='evenodd'%20d='M273.13%2046.8625C261.25%2034.988%20234.19%2040.8597%20201.55%2059.6813C191.77%2023.2855%20176.79%202.9362e-06%20160%200C143.2%20-2.9362e-06%20128.22%2023.2841%20118.45%2059.6779C85.7999%2040.8581%2058.75%2034.9874%2046.87%2046.8614C35%2058.7367%2040.8699%2085.7963%2059.6899%20118.446C23.2899%20128.222%200%20143.204%200%20160C0%20176.793%2023.2801%20191.773%2059.6801%20201.549C40.8501%20234.2%2034.98%20261.261%2046.85%20273.137C58.73%20285.013%2085.7899%20279.138%20118.44%20260.31C128.22%20296.711%20143.2%20320%20160%20320C176.79%20320%20191.77%20296.709%20201.55%20260.307C234.21%20279.136%20261.27%20285.012%20273.15%20273.136C285.02%20261.26%20279.15%20234.2%20260.32%20201.549C296.72%20191.773%20320%20176.793%20320%20160C320%20143.204%20296.71%20128.222%20260.3%20118.446C279.13%2085.7966%20285%2058.7376%20273.13%2046.8625Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.gem{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='302'%20height='312'%20viewBox='0%200%20302%20312'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M92.48%2026.6316C110.64%2013.4359%20119.73%206.838%20129.41%203.55802C143.41%20-1.18601%20158.59%20-1.18601%20172.59%203.55802C182.27%206.838%20191.36%2013.4359%20209.52%2026.6317L250.37%2056.3046C261.16%2064.1409%20266.56%2068.059%20270.95%2072.7627C277.31%2079.5606%20282.18%2087.6027%20285.27%2096.381C287.41%20102.454%20288.38%20109.048%20290.34%20122.236L297.9%20173.237C301.33%20196.373%20303.05%20207.941%20301.32%20218.367C298.81%20233.448%20291.24%20247.227%20279.86%20257.431C271.99%20264.486%20261.3%20269.245%20239.93%20278.763L191.52%20300.326C178.62%20306.07%20172.17%20308.941%20165.55%20310.409C155.96%20312.53%20146.04%20312.53%20136.45%20310.409C129.83%20308.941%20123.38%20306.07%20110.48%20300.326L62.07%20278.763C40.7%20269.245%2030.01%20264.486%2022.14%20257.431C10.76%20247.227%203.19008%20233.448%200.68008%20218.367C-1.04992%20207.941%200.670002%20196.373%204.1%20173.237L11.6601%20122.236C13.6201%20109.048%2014.59%20102.454%2016.73%2096.381C19.82%2087.6027%2024.6901%2079.5606%2031.0501%2072.7627C35.4401%2068.059%2040.84%2064.1409%2051.63%2056.3046L92.48%2026.6316Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='302'%20height='312'%20viewBox='0%200%20302%20312'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M92.48%2026.6316C110.64%2013.4359%20119.73%206.838%20129.41%203.55802C143.41%20-1.18601%20158.59%20-1.18601%20172.59%203.55802C182.27%206.838%20191.36%2013.4359%20209.52%2026.6317L250.37%2056.3046C261.16%2064.1409%20266.56%2068.059%20270.95%2072.7627C277.31%2079.5606%20282.18%2087.6027%20285.27%2096.381C287.41%20102.454%20288.38%20109.048%20290.34%20122.236L297.9%20173.237C301.33%20196.373%20303.05%20207.941%20301.32%20218.367C298.81%20233.448%20291.24%20247.227%20279.86%20257.431C271.99%20264.486%20261.3%20269.245%20239.93%20278.763L191.52%20300.326C178.62%20306.07%20172.17%20308.941%20165.55%20310.409C155.96%20312.53%20146.04%20312.53%20136.45%20310.409C129.83%20308.941%20123.38%20306.07%20110.48%20300.326L62.07%20278.763C40.7%20269.245%2030.01%20264.486%2022.14%20257.431C10.76%20247.227%203.19008%20233.448%200.68008%20218.367C-1.04992%20207.941%200.670002%20196.373%204.1%20173.237L11.6601%20122.236C13.6201%20109.048%2014.59%20102.454%2016.73%2096.381C19.82%2087.6027%2024.6901%2079.5606%2031.0501%2072.7627C35.4401%2068.059%2040.84%2064.1409%2051.63%2056.3046L92.48%2026.6316Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.ghost-ish{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='304'%20height='304'%20viewBox='0%200%20304%20304'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0%20144.762C0%2064.812%2068.0527%200%20152%200C235.947%200%20304%2064.812%20304%20144.762V246.095C304%20278.075%20276.779%20304%20243.2%20304C233.247%20304%20223.853%20301.722%20215.56%20297.685C211.335%20295.627%20207.119%20293.372%20202.885%20291.107C187.986%20283.136%20172.866%20275.048%20156.327%20275.048H147.673C131.134%20275.048%20116.014%20283.136%20101.115%20291.107C96.881%20293.372%2092.665%20295.627%2088.44%20297.685C80.1472%20301.722%2070.7529%20304%2060.8%20304C27.2211%20304%200%20278.075%200%20246.095V144.762Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='304'%20height='304'%20viewBox='0%200%20304%20304'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M0%20144.762C0%2064.812%2068.0527%200%20152%200C235.947%200%20304%2064.812%20304%20144.762V246.095C304%20278.075%20276.779%20304%20243.2%20304C233.247%20304%20223.853%20301.722%20215.56%20297.685C211.335%20295.627%20207.119%20293.372%20202.885%20291.107C187.986%20283.136%20172.866%20275.048%20156.327%20275.048H147.673C131.134%20275.048%20116.014%20283.136%20101.115%20291.107C96.881%20293.372%2092.665%20295.627%2088.44%20297.685C80.1472%20301.722%2070.7529%20304%2060.8%20304C27.2211%20304%200%20278.075%200%20246.095V144.762Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.heart{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='286'%20viewBox='0%200%20320%20286'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M251.1%200.130005C229.439%200.130005%20210.113%2010.3%20197.481%2026.2L160%2067.51V67.38L122.519%2026.0601C109.887%2010.1701%2090.561%200%2068.9%200C30.848%200%200%2031.3701%200%2070.0601C0%20104.06%2028.375%20129.47%2048.919%20153.88C69.389%20178.21%2089.856%20202.52%20110.323%20226.84L156.272%20281.44C157.516%20282.91%20158.756%20284.39%20160%20285.87V286C161.244%20284.52%20162.484%20283.05%20163.728%20281.57C179.043%20263.37%20194.358%20245.18%20209.677%20226.98C230.144%20202.66%20250.614%20178.34%20271.081%20154.02C291.625%20129.61%20320%20104.2%20320%2070.1899C320%2031.4999%20289.152%200.130005%20251.1%200.130005Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='286'%20viewBox='0%200%20320%20286'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M251.1%200.130005C229.439%200.130005%20210.113%2010.3%20197.481%2026.2L160%2067.51V67.38L122.519%2026.0601C109.887%2010.1701%2090.561%200%2068.9%200C30.848%200%200%2031.3701%200%2070.0601C0%20104.06%2028.375%20129.47%2048.919%20153.88C69.389%20178.21%2089.856%20202.52%20110.323%20226.84L156.272%20281.44C157.516%20282.91%20158.756%20284.39%20160%20285.87V286C161.244%20284.52%20162.484%20283.05%20163.728%20281.57C179.043%20263.37%20194.358%20245.18%20209.677%20226.98C230.144%20202.66%20250.614%20178.34%20271.081%20154.02C291.625%20129.61%20320%20104.2%20320%2070.1899C320%2031.4999%20289.152%200.130005%20251.1%200.130005Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.leaf-clover4{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='296'%20height='296'%20viewBox='0%200%20296%20296'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M21%20148C7.9%20132.34%200%20112.13%200%2090.0601C0%2040.3201%2040.11%200%2089.6%200C111.99%200%20132.47%208.25991%20148.17%2021.9099C163.84%208.25991%20184.27%200%20206.61%200C255.98%200%20296%2040.3201%20296%2090.0601C296%20112.13%20288.12%20132.34%20275.05%20148C288.12%20163.66%20296%20183.87%20296%20205.94C296%20255.68%20255.98%20296%20206.61%20296C184.27%20296%20163.84%20287.74%20148.17%20274.09C132.47%20287.74%20111.99%20296%2089.6%20296C40.11%20296%200%20255.68%200%20205.94C0%20183.87%207.9%20163.66%2021%20148Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='296'%20height='296'%20viewBox='0%200%20296%20296'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M21%20148C7.9%20132.34%200%20112.13%200%2090.0601C0%2040.3201%2040.11%200%2089.6%200C111.99%200%20132.47%208.25991%20148.17%2021.9099C163.84%208.25991%20184.27%200%20206.61%200C255.98%200%20296%2040.3201%20296%2090.0601C296%20112.13%20288.12%20132.34%20275.05%20148C288.12%20163.66%20296%20183.87%20296%20205.94C296%20255.68%20255.98%20296%20206.61%20296C184.27%20296%20163.84%20287.74%20148.17%20274.09C132.47%20287.74%20111.99%20296%2089.6%20296C40.11%20296%200%20255.68%200%20205.94C0%20183.87%207.9%20163.66%2021%20148Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.leaft-clover8{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M308.58%20160C334.43%20208.16%20314.9%20251.77%20265.07%20265.06C251.77%20314.9%20208.16%20334.42%20160%20308.58C111.83%20334.43%2068.2201%20314.9%2054.9301%20265.07C5.10006%20251.77%20-14.4299%20208.16%2011.4201%20160C-14.4299%20111.83%205.10006%2068.2198%2054.9301%2054.9298C68.2201%205.09982%20111.83%20-14.4302%20160%2011.4198C208.16%20-14.4302%20251.77%205.09982%20265.06%2054.9298C314.9%2068.2198%20334.42%20111.83%20308.58%20160Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M308.58%20160C334.43%20208.16%20314.9%20251.77%20265.07%20265.06C251.77%20314.9%20208.16%20334.42%20160%20308.58C111.83%20334.43%2068.2201%20314.9%2054.9301%20265.07C5.10006%20251.77%20-14.4299%20208.16%2011.4201%20160C-14.4299%20111.83%205.10006%2068.2198%2054.9301%2054.9298C68.2201%205.09982%20111.83%20-14.4302%20160%2011.4198C208.16%20-14.4302%20251.77%205.09982%20265.06%2054.9298C314.9%2068.2198%20334.42%20111.83%20308.58%20160Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.loading-indicator{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='100%25'%20height='100%25'%20viewBox='4%204%2040%2040'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill='%23D0BCFF'%3e%3canimate%20attributeName='d'%20dur='5s'%20repeatCount='indefinite'%20calcMode='spline'%20keySplines='0.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8'%20keyTimes='0;%200.14;%200.14;%200.29;%200.29;%200.43;%200.43;%200.57;%200.57;%200.71;%200.71;%200.86;%200.86;%201'%20values='M20.9%2010.4%2021.4%209.5%2021.9%208.7%2022.5%207.8%2023.2%207.2%2024.2%207%2025.1%207.4%2025.7%208.1%2026.2%209%2026.8%209.8%2027.3%2010.6%2028.1%2011.2%2029%2011.3%2030%2011%2030.9%2010.6%2031.8%2010.3%2032.8%209.9%2033.7%2010%2034.5%2010.6%2034.9%2011.5%2034.8%2012.5%2034.8%2013.5%2034.7%2014.5%2034.7%2015.5%2035.2%2016.3%2036%2016.8%2037%2017.1%2037.9%2017.3%2038.9%2017.5%2039.8%2017.9%2040.4%2018.7%2040.5%2019.7%2040%2020.5%2039.4%2021.3%2038.7%2022%2038.1%2022.8%2037.6%2023.7%2037.7%2024.6%2038.3%2025.5%2038.9%2026.2%2039.6%2027%2040.2%2027.7%2040.5%2028.7%2040.3%2029.6%2039.5%2030.3%2038.6%2030.6%2037.6%2030.8%2036.7%2031%2035.7%2031.3%2035%2031.9%2034.6%2032.8%2034.7%2033.8%2034.8%2034.8%2034.9%2035.8%2034.8%2036.8%2034.3%2037.6%2033.4%2038.1%2032.4%2038%2031.5%2037.6%2030.6%2037.2%2029.7%2036.9%2028.7%2036.6%2027.8%2036.9%2027.1%2037.6%2026.6%2038.5%2026.1%2039.3%2025.5%2040.2%2024.8%2040.8%2023.8%2041%2022.9%2040.6%2022.3%2039.9%2021.8%2039%2021.2%2038.2%2020.7%2037.4%2019.9%2036.8%2019%2036.7%2018%2037%2017.1%2037.4%2016.2%2037.7%2015.2%2038.1%2014.3%2038%2013.5%2037.4%2013.1%2036.5%2013.2%2035.5%2013.2%2034.5%2013.3%2033.5%2013.3%2032.5%2012.8%2031.7%2012%2031.2%2011%2031%2010.1%2030.7%209.1%2030.5%208.2%2030.1%207.6%2029.3%207.5%2028.3%208%2027.5%208.7%2026.7%209.3%2026%209.9%2025.2%2010.4%2024.3%2010.3%2023.4%209.7%2022.5%209.1%2021.8%208.4%2021%207.8%2020.3%207.5%2019.3%207.7%2018.4%208.5%2017.7%209.4%2017.4%2010.4%2017.2%2011.3%2017%2012.3%2016.7%2013%2016.1%2013.4%2015.2%2013.3%2014.2%2013.2%2013.2%2013.1%2012.2%2013.2%2011.2%2013.7%2010.4%2014.6%209.9%2015.6%2010%2016.5%2010.4%2017.4%2010.8%2018.3%2011.1%2019.3%2011.4%2020.2%2011.1Z;%20M20.3%208.6%2021.1%208%2022%207.6%2023%207.3%2023%207.3%2024%207.2%2025%207.3%2025.9%207.5%2026.8%208%2027.6%208.6%2028.4%209.1%2028.4%209.1%2029.3%209.6%2030.3%209.8%2031.3%209.9%2032.3%2010%2033.3%2010.2%2034.2%2010.6%2034.2%2010.6%2035%2011.2%2035.7%2011.9%2036.3%2012.7%2036.7%2013.6%2036.9%2014.6%2037.2%2015.5%2037.2%2015.5%2037.6%2016.5%2038.2%2017.3%2038.9%2018%2039.6%2018.7%2040.2%2019.5%2040.6%2020.4%2040.6%2020.4%2040.9%2021.3%2041%2022.3%2040.9%2023.3%2040.6%2024.3%2040.2%2025.2%2039.8%2026.1%2039.8%2026.1%2039.5%2027%2039.4%2028%2039.5%2029%2039.6%2030%2039.5%2031%2039.3%2032%2039.3%2032%2038.9%2032.9%2038.3%2033.7%2037.6%2034.4%2036.8%2035%2035.9%2035.4%2035%2035.8%2035%2035.8%2034.1%2036.3%2033.4%2037%2032.9%2037.9%2032.3%2038.7%2031.6%2039.4%2030.8%2040%2030.8%2040%2029.9%2040.4%2028.9%2040.7%2027.9%2040.8%2027%2040.7%2026%2040.4%2025%2040.1%2025%2040.1%2024%2040%2023%2040.1%2022.1%2040.4%2021.1%2040.7%2020.1%2040.8%2019.1%2040.7%2019.1%2040.7%2018.2%2040.5%2017.3%2040%2016.4%2039.5%2015.7%2038.8%2015.2%2037.9%2014.6%2037.1%2014.6%2037.1%2013.9%2036.4%2013.1%2035.8%2012.2%2035.4%2011.3%2035%2010.5%2034.4%209.7%2033.8%209.7%2033.8%209.1%2032.9%208.7%2032%208.5%2031.1%208.4%2030.1%208.5%2029.1%208.6%2028.1%208.6%2028.1%208.5%2027.1%208.3%2026.1%207.8%2025.2%207.4%2024.3%207.1%2023.4%207%2022.4%207%2022.4%207.1%2021.4%207.3%2020.4%207.8%2019.5%208.3%2018.7%209.1%2018%209.8%2017.3%209.8%2017.3%2010.4%2016.5%2010.8%2015.6%2011%2014.6%2011.3%2013.7%2011.7%2012.8%2012.2%2011.9%2012.2%2011.9%2012.9%2011.2%2013.8%2010.7%2014.7%2010.2%2015.6%2010%2016.6%209.9%2017.6%209.8%2017.6%209.8%2018.6%209.6%2019.5%209.2Z;%20M18.6%209.6%2019.5%209.2%2020.3%208.6%2021.1%208%2022%207.6%2023%207.3%2024%207.2%2025%207.3%2025.9%207.5%2026.8%208%2027.6%208.6%2028.4%209.1%2029.3%209.6%2030.3%209.8%2031.3%209.9%2032.3%2010%2033.3%2010.2%2034.2%2010.6%2035%2011.2%2035.7%2011.9%2036.3%2012.7%2036.7%2013.6%2036.9%2014.6%2037.2%2015.5%2037.6%2016.4%2038.2%2017.3%2038.9%2018%2039.6%2018.7%2040.2%2019.5%2040.6%2020.4%2040.9%2021.3%2041%2022.3%2040.9%2023.3%2040.6%2024.3%2040.2%2025.2%2039.8%2026.1%2039.5%2027%2039.4%2028%2039.5%2029%2039.6%2030%2039.5%2031%2039.3%2032%2038.9%2032.9%2038.3%2033.7%2037.6%2034.4%2036.8%2035%2035.9%2035.4%2035%2035.8%2034.1%2036.3%2033.4%2037%2032.9%2037.9%2032.3%2038.7%2031.6%2039.4%2030.8%2040%2029.9%2040.4%2028.9%2040.7%2027.9%2040.8%2027%2040.7%2026%2040.4%2025%2040.1%2024%2040%2023%2040.1%2022.1%2040.4%2021.1%2040.7%2020.1%2040.8%2019.1%2040.7%2018.2%2040.5%2017.3%2040%2016.4%2039.5%2015.7%2038.8%2015.2%2037.9%2014.6%2037.1%2013.9%2036.4%2013.1%2035.8%2012.2%2035.4%2011.3%2035%2010.5%2034.4%209.7%2033.8%209.1%2032.9%208.7%2032%208.5%2031.1%208.4%2030.1%208.5%2029.1%208.6%2028.1%208.5%2027.1%208.3%2026.1%207.8%2025.2%207.4%2024.3%207.1%2023.4%207%2022.4%207.1%2021.4%207.3%2020.4%207.8%2019.5%208.3%2018.7%209.1%2018%209.8%2017.3%2010.4%2016.5%2010.8%2015.6%2011%2014.6%2011.3%2013.7%2011.7%2012.8%2012.2%2011.9%2012.9%2011.2%2013.8%2010.7%2014.7%2010.2%2015.6%2010%2016.6%209.9%2017.6%209.8Z;%20M18.6%209.9%2019.5%209.4%2020.3%208.8%2021.1%208.2%2022%207.8%2023%207.6%2023.9%207.5%2024.9%207.6%2025.9%207.8%2026.8%208.2%2027.6%208.7%2028.5%209.3%2029.3%209.9%2030.1%2010.5%2030.9%2011%2031.7%2011.6%2032.5%2012.2%2033.3%2012.8%2033.7%2013.1%2034.1%2013.3%2034.9%2013.9%2035.7%2014.5%2036.6%2015%2037.4%2015.6%2038.2%2016.2%2039%2016.8%2039.7%2017.5%2040.2%2018.3%2040.7%2019.2%2040.9%2020.1%2041%2021.1%2040.9%2022.1%2040.7%2023.1%2040.3%2024%2040%2024.9%2039.7%2025.9%2039.4%2026.8%2039%2027.8%2038.7%2028.7%2038.4%2029.6%2038.1%2030.6%2037.8%2031.5%2037.5%2032.5%2037.2%2033.4%2036.9%2034.4%2036.6%2035.3%2036.2%2036.2%2035.7%2037.1%2035%2037.8%2034.3%2038.4%2033.4%2038.9%2032.5%2039.3%2031.5%2039.5%2030.5%2039.5%2030%2039.5%2029.5%2039.5%2028.5%2039.5%2027.5%2039.5%2026.5%2039.5%2025.5%2039.4%2024.5%2039.4%2023.6%2039.4%2022.6%2039.4%2021.6%2039.5%2020.6%2039.5%2019.6%2039.5%2018.6%2039.5%2017.6%2039.5%2016.6%2039.5%2015.6%2039.3%2014.7%2039%2013.8%2038.5%2013.1%2037.9%2012.4%2037.2%2011.9%2036.3%2011.5%2035.4%2011.2%2034.5%2010.9%2033.5%2010.6%2032.6%2010.3%2031.6%2010%2030.7%209.7%2029.7%209.3%2028.8%209%2027.9%208.7%2026.9%208.4%2026%208%2025%207.7%2024.1%207.4%2023.2%207.1%2022.2%207.1%2021.7%207%2021.2%207.1%2020.2%207.3%2019.3%207.7%2018.4%208.3%2017.5%208.9%2016.8%209.7%2016.2%2010.5%2015.6%2011.4%2015.1%2012.2%2014.5%2013%2014%2013.8%2013.4%2014.6%2012.8%2015.4%2012.3%2016.2%2011.7%2017%2011.1%2017.8%2010.5Z;%20M15.4%2012.3%2016.2%2011.7%2017%2011.1%2017.8%2010.5%2018.6%209.9%2019.5%209.4%2020.3%208.8%2021.1%208.3%2022%207.8%2023%207.6%2023.9%207.5%2024.9%207.6%2025.9%207.8%2026.8%208.2%2027.6%208.7%2028.5%209.3%2029.3%209.9%2030.1%2010.5%2030.9%2011%2031.7%2011.6%2032.5%2012.2%2033.3%2012.8%2034.1%2013.3%2034.9%2013.9%2035.7%2014.5%2036.6%2015%2037.4%2015.6%2038.2%2016.2%2039%2016.8%2039.7%2017.5%2040.2%2018.3%2040.7%2019.2%2040.9%2020.1%2041%2021.1%2040.9%2022.1%2040.7%2023.1%2040.3%2024%2040%2024.9%2039.7%2025.9%2039.4%2026.8%2039%2027.8%2038.7%2028.7%2038.4%2029.6%2038.1%2030.6%2037.8%2031.5%2037.5%2032.5%2037.2%2033.4%2036.9%2034.4%2036.6%2035.3%2036.2%2036.2%2035.7%2037.1%2035%2037.8%2034.3%2038.4%2033.4%2038.9%2032.5%2039.3%2031.5%2039.4%2030.5%2039.5%2029.5%2039.5%2028.5%2039.5%2027.5%2039.5%2026.5%2039.5%2025.5%2039.4%2024.5%2039.4%2023.6%2039.4%2022.6%2039.4%2021.6%2039.5%2020.6%2039.5%2019.6%2039.5%2018.6%2039.5%2017.6%2039.5%2016.6%2039.5%2015.6%2039.3%2014.7%2039%2013.8%2038.5%2013.1%2037.9%2012.4%2037.2%2011.9%2036.3%2011.5%2035.4%2011.2%2034.5%2010.9%2033.5%2010.6%2032.6%2010.3%2031.6%2010%2030.7%209.7%2029.7%209.3%2028.8%209%2027.9%208.7%2026.9%208.4%2026%208%2025%207.7%2024.1%207.4%2023.2%207.1%2022.2%207%2021.2%207.1%2020.2%207.3%2019.3%207.7%2018.4%208.3%2017.5%208.9%2016.8%209.7%2016.2%2010.5%2015.6%2011.4%2015.1%2012.2%2014.5%2013%2014%2013.8%2013.4%2014.6%2012.8Z;%20M17%2012.8%2017.7%2012.1%2018.5%2011.5%2019.3%2010.9%2020.1%2010.5%2020.2%2010.4%2021.1%2010%2022%209.7%2023%209.4%2024%209.2%2025%209%2026%209%2027%209%2027.6%209.1%2028%209.1%2028.9%209.3%2029.9%209.6%2030.9%209.9%2031.8%2010.3%2032.6%2010.8%2033.5%2011.3%2034.3%2011.9%2034.6%2012.2%2035%2012.6%2035.7%2013.3%2036.4%2014.1%2036.9%2014.9%2037.4%2015.8%2037.9%2016.6%2038.3%2017.6%2038.6%2018.5%2038.6%2018.7%2038.8%2019.5%2038.9%2020.5%2039%2021.5%2039%2022.5%2038.9%2023.5%2038.7%2024.5%2038.5%2025.4%2038.2%2026.3%2038.2%2026.4%2037.8%2027.3%2037.4%2028.2%2036.8%2029.1%2036.2%2029.9%2035.6%2030.6%2034.9%2031.3%2034.2%2032%2033.8%2032.5%2033.5%2032.8%2032.8%2033.5%2032.1%2034.2%2031.4%2034.9%2030.7%2035.6%2029.9%2036.2%2029.1%2036.8%2028.2%2037.3%2027.9%2037.5%2027.4%2037.8%2026.4%2038.2%2025.5%2038.5%2024.5%2038.7%2023.5%2038.9%2022.5%2039%2021.5%2039%2020.5%2038.9%2020.4%2038.9%2019.5%2038.8%2018.6%2038.6%2017.6%2038.3%2016.7%2037.9%2015.8%2037.5%2014.9%2037%2014.1%2036.4%2013.4%2035.8%2013.3%2035.8%2012.6%2035.1%2012%2034.3%2011.3%2033.5%2010.8%2032.7%2010.3%2031.8%209.9%2030.9%209.6%2030%209.4%2029.3%209.3%2029%209.1%2028%209%2027%209%2026%209%2025%209.2%2024%209.4%2023%209.6%2022.1%209.8%2021.7%2010%2021.1%2010.4%2020.2%2010.9%2019.4%2011.4%2018.5%2012.1%2017.8%2012.7%2017%2013.4%2016.3%2014.2%2015.6%2014.2%2015.5%2014.9%2014.9%2015.6%2014.2%2016.3%2013.5Z;%20M33.5%2011.3%2034.3%2011.9%2035%2012.6%2035.3%2012.8%2035.7%2013.3%2036.4%2014.1%2036.9%2014.9%2037.4%2015.8%2037.9%2016.6%2038.3%2017.6%2038.3%2017.7%2038.6%2018.5%2038.8%2019.5%2038.9%2020.5%2039%2021.5%2039%2022.5%2038.9%2023.5%2038.9%2023.5%2038.7%2024.5%2038.5%2025.4%2038.2%2026.4%2037.8%2027.3%2037.4%2028.2%2036.9%2028.9%2036.8%2029.1%2036.2%2029.9%2035.6%2030.6%2034.9%2031.3%2034.2%2032%2033.5%2032.8%2033.1%2033.2%2032.8%2033.5%2032.1%2034.2%2031.4%2034.9%2030.7%2035.6%2029.9%2036.2%2029.1%2036.8%2028.7%2037%2028.2%2037.3%2027.4%2037.8%2026.4%2038.2%2025.5%2038.5%2024.5%2038.7%2023.5%2038.9%2023.3%2038.9%2022.5%2039%2021.5%2039%2020.5%2038.9%2019.5%2038.8%2018.6%2038.6%2017.6%2038.3%2017.6%2038.3%2016.7%2037.9%2015.8%2037.5%2014.9%2037%2014.1%2036.4%2013.3%2035.8%2012.7%2035.2%2012.6%2035.1%2012%2034.3%2011.3%2033.5%2010.8%2032.7%2010.3%2031.8%209.9%2030.9%209.7%2030.3%209.6%2029.9%209.3%2029%209.1%2028%209%2027%209%2026%209%2025%209.1%2024.5%209.2%2024%209.4%2023%209.6%2022.1%2010%2021.1%2010.4%2020.2%2010.9%2019.4%2011.1%2019.1%2011.5%2018.5%2012.1%2017.7%2012.7%2017%2013.5%2016.3%2014.2%2015.6%2014.9%2014.9%2014.9%2014.8%2015.6%2014.2%2016.3%2013.5%2017%2012.8%2017.7%2012.1%2018.5%2011.5%2019.3%2011%2019.3%2010.9%2020.2%2010.4%2021.1%2010%2022%209.7%2023%209.4%2024%209.2%2024.7%209.1%2025%209%2026%209%2027%209%2028%209.1%2028.9%209.3%2029.9%209.6%2030.4%209.7%2030.9%209.9%2031.8%2010.3%2032.6%2010.8Z;%20M33.2%2011.1%2034.2%2011.2%2035.1%2011.4%2036%2011.9%2036.6%2012.7%2036.8%2013.7%2036.9%2014.7%2036.9%2015.7%2037%2016.7%2037.1%2017.7%2037.3%2018.6%2037.9%2019.4%2038.5%2020.2%2039.2%2020.9%2039.8%2021.7%2040.5%2022.4%2040.9%2023.3%2041%2024.3%2040.7%2025.2%2040.1%2026%2039.4%2026.8%2038.8%2027.5%2038.1%2028.3%2037.5%2029.1%2037.1%2030%2037%2031%2037%2031.9%2036.9%2032.9%2036.8%2033.9%2036.7%2034.9%2036.2%2035.8%2035.5%2036.4%2034.5%2036.8%2033.6%2036.8%2032.6%2036.9%2031.6%2037%2030.6%2037.1%2029.6%2037.2%2028.8%2037.7%2028%2038.4%2027.3%2039%2026.5%2039.7%2025.8%2040.3%2024.9%2040.8%2023.9%2041%2023%2040.8%2022.1%2040.2%2021.4%2039.6%2020.6%2038.9%2019.9%2038.3%2019.1%2037.6%2018.3%2037.2%2017.3%2037%2016.3%2037%2015.3%2036.9%2014.3%2036.8%2013.3%2036.7%2012.4%2036.4%2011.7%2035.7%2011.3%2034.8%2011.2%2033.8%2011.1%2032.8%2011%2031.8%2011%2030.8%2010.9%2029.9%2010.4%2029%209.8%2028.2%209.1%2027.5%208.5%2026.7%207.8%2026%207.3%2025.1%207%2024.2%207.1%2023.2%207.6%2022.3%208.2%2021.6%208.9%2020.8%209.5%2020.1%2010.2%2019.3%2010.7%2018.5%2010.9%2017.5%2011%2016.6%2011.1%2015.6%2011.1%2014.6%2011.2%2013.6%2011.5%2012.6%2012.1%2011.9%2013%2011.4%2013.9%2011.2%2014.9%2011.1%2015.9%2011%2016.9%2011%2017.9%2010.9%2018.8%2010.6%2019.6%2010%2020.4%209.3%2021.1%208.6%2021.9%208%2022.6%207.4%2023.6%207%2024.6%207.1%2025.5%207.5%2026.2%208.1%2027%208.7%2027.7%209.4%2028.5%2010%2029.3%2010.6%2030.2%2010.9%2031.2%2011%2032.2%2011.1Z;%20M27.7%209.4%2028.5%2010%2029.3%2010.6%2030.2%2010.9%2031.2%2011%2032.2%2011.1%2033.2%2011.1%2034.2%2011.2%2035.1%2011.4%2036%2011.9%2036.6%2012.7%2036.8%2013.7%2036.9%2014.7%2036.9%2015.7%2037%2016.7%2037.1%2017.7%2037.3%2018.6%2037.9%2019.4%2038.5%2020.2%2039.2%2020.9%2039.8%2021.7%2040.5%2022.4%2040.9%2023.3%2041%2024.3%2040.7%2025.2%2040.1%2026%2039.4%2026.8%2038.8%2027.5%2038.1%2028.3%2037.5%2029.1%2037.1%2030%2037%2031%2037%2031.9%2036.9%2032.9%2036.8%2033.9%2036.7%2034.9%2036.2%2035.8%2035.5%2036.4%2034.5%2036.8%2033.6%2036.9%2032.6%2036.9%2031.6%2037%2030.6%2037.1%2029.6%2037.2%2028.8%2037.7%2028%2038.4%2027.3%2039%2026.5%2039.7%2025.8%2040.3%2024.9%2040.8%2023.9%2041%2023%2040.8%2022.1%2040.2%2021.4%2039.6%2020.6%2038.9%2019.9%2038.3%2019.1%2037.6%2018.3%2037.2%2017.3%2037%2016.3%2037%2015.3%2036.9%2014.3%2036.8%2013.3%2036.7%2012.4%2036.4%2011.7%2035.7%2011.3%2034.8%2011.2%2033.8%2011.1%2032.8%2011%2031.8%2011%2030.8%2010.9%2029.9%2010.4%2029%209.8%2028.2%209.1%2027.5%208.5%2026.7%207.8%2026%207.3%2025.1%207%2024.2%207.1%2023.2%207.6%2022.3%208.2%2021.6%208.9%2020.8%209.5%2020.1%2010.2%2019.3%2010.7%2018.5%2010.9%2017.5%2011%2016.5%2011.1%2015.6%2011.1%2014.6%2011.2%2013.6%2011.5%2012.6%2012.1%2011.9%2013%2011.4%2013.9%2011.2%2014.9%2011.1%2015.9%2011%2016.9%2011%2017.9%2010.9%2018.8%2010.6%2019.6%2010%2020.4%209.3%2021.1%208.6%2021.9%208%2022.6%207.4%2023.6%207%2024.6%207.1%2025.5%207.5%2026.2%208.1%2027%208.7Z;%20M27.9%2010.6%2028.8%2010.3%2029.8%2010.1%2030.8%2010%2031.8%2010.1%2032.7%2010.3%2033.7%2010.6%2034.6%2011.1%2034.8%2011.3%2035.4%2011.7%2036.1%2012.4%2036.7%2013.1%2037.2%2014%2037.6%2014.9%2037.9%2015.9%2038%2016.9%2038%2017.9%2037.8%2018.8%2037.5%2019.8%2037.1%2020.7%2036.8%2021.6%2036.5%2022.6%2036.4%2023.6%2036.4%2024.4%2036.4%2024.6%2036.5%2025.5%2036.8%2026.5%2037.2%2027.4%2037.6%2028.3%2037.8%2029.3%2038%2030.3%2038%2031.3%2037.8%2032.3%2037.6%2033.2%2037.2%2034.1%2036.6%2035%2036%2035.7%2035.3%2036.4%2034.4%2037%2034.1%2037.2%2033.6%2037.4%2032.6%2037.8%2031.6%2037.9%2030.6%2038%2029.7%2037.9%2028.7%2037.7%2027.8%2037.3%2026.8%2036.9%2025.9%2036.6%2024.9%2036.4%2023.9%2036.4%2022.9%2036.4%2022%2036.6%2021%2037%2020.1%2037.4%2020.1%2037.4%2019.2%2037.7%2018.2%2037.9%2017.2%2038%2016.2%2037.9%2015.3%2037.7%2014.3%2037.4%2013.4%2036.9%2012.6%2036.3%2011.9%2035.6%2011.3%2034.9%2010.8%2034%2010.4%2033.1%2010.1%2032.1%2010%2031.1%2010%2030.6%2010%2030.1%2010.2%2029.2%2010.5%2028.2%2010.9%2027.3%2011.2%2026.4%2011.5%2025.4%2011.6%2024.4%2011.6%2023.4%2011.5%2022.5%2011.2%2021.5%2010.8%2020.6%2010.4%2019.7%2010.2%2018.7%2010%2017.7%2010%2016.7%2010%2016.6%2010.2%2015.7%2010.4%2014.8%2010.8%2013.9%2011.4%2013%2012%2012.3%2012.7%2011.6%2013.6%2011%2014.4%2010.6%2015.4%2010.2%2016.4%2010.1%2017.4%2010%2018.3%2010.1%2019.3%2010.3%2020.2%2010.7%2020.9%2011%2021.2%2011.1%2022.1%2011.4%2023.1%2011.6%2024.1%2011.6%2025.1%2011.6%2026%2011.4%2027%2011Z;%20M36%2035.7%2035.3%2036.4%2034.4%2037%2033.6%2037.4%2032.6%2037.8%2031.6%2037.9%2030.6%2038%2029.7%2037.9%2028.7%2037.7%2027.8%2037.3%2026.8%2036.9%2025.9%2036.6%2024.9%2036.4%2023.9%2036.4%2022.9%2036.4%2022%2036.6%2021%2037%2020.1%2037.4%2019.2%2037.7%2018.2%2037.9%2017.2%2038%2016.2%2037.9%2015.3%2037.7%2014.3%2037.4%2013.4%2036.9%2012.6%2036.3%2011.9%2035.6%2011.3%2034.9%2010.8%2034%2010.4%2033.1%2010.1%2032.1%2010%2031.1%2010%2030.2%2010.2%2029.2%2010.5%2028.2%2010.9%2027.3%2011.2%2026.4%2011.5%2025.4%2011.6%2024.4%2011.6%2023.4%2011.5%2022.5%2011.2%2021.5%2010.8%2020.6%2010.4%2019.7%2010.2%2018.7%2010%2017.7%2010%2016.7%2010.2%2015.7%2010.4%2014.8%2010.8%2013.9%2011.4%2013%2012%2012.3%2012.7%2011.6%2013.6%2011%2014.4%2010.6%2015.4%2010.2%2016.4%2010.1%2017.4%2010%2018.3%2010.1%2019.3%2010.3%2020.2%2010.7%2021.2%2011.1%2022.1%2011.4%2023.1%2011.6%2024.1%2011.6%2025.1%2011.6%2026%2011.4%2027%2011%2027.9%2010.6%2028.8%2010.3%2029.8%2010.1%2030.8%2010%2031.8%2010.1%2032.7%2010.3%2033.7%2010.6%2034.6%2011.1%2035.4%2011.7%2036.1%2012.4%2036.7%2013.1%2037.2%2014%2037.6%2014.9%2037.9%2015.9%2038%2016.9%2038%2017.8%2037.8%2018.8%2037.5%2019.8%2037.1%2020.7%2036.8%2021.6%2036.5%2022.6%2036.4%2023.6%2036.4%2024.6%2036.5%2025.5%2036.8%2026.5%2037.2%2027.4%2037.6%2028.3%2037.8%2029.3%2038%2030.3%2038%2031.3%2037.8%2032.3%2037.6%2033.2%2037.2%2034.1%2036.6%2035Z;%20M32.1%2032.1%2031.4%2032.8%2030.7%2033.5%2029.9%2034.1%2029.1%2034.7%2028.3%2035.3%2027.6%2035.8%2027.5%2035.8%2026.6%2036.4%2025.8%2036.8%2024.9%2037.3%2024%2037.7%2023.1%2038%2022.1%2038.3%2021.2%2038.6%2020.2%2038.8%2019.2%2038.9%2018.2%2039%2017.2%2039%2016.6%2038.9%2016.3%2038.9%2015.3%2038.7%2014.3%2038.4%2013.4%2038%2012.5%2037.5%2011.7%2036.9%2011.1%2036.3%2010.5%2035.5%2010%2034.6%209.6%2033.7%209.3%2032.7%209.1%2031.7%209.1%2031.4%209%2030.8%209%2029.8%209.1%2028.8%209.2%2027.8%209.4%2026.8%209.7%2025.9%2010%2024.9%2010.3%2024%2010.7%2023.1%2011.2%2022.2%2011.6%2021.4%2012.2%2020.5%2012.2%2020.4%2012.7%2019.7%2013.3%2018.9%2013.9%2018.1%2014.5%2017.3%2015.2%2016.6%2015.9%2015.9%2016.6%2015.2%2017.3%2014.5%2018.1%2013.9%2018.9%2013.3%2019.7%2012.7%2020.4%2012.2%2020.5%2012.2%2021.4%2011.6%2022.2%2011.2%2023.1%2010.7%2024%2010.3%2024.9%2010%2025.9%209.7%2026.8%209.4%2027.8%209.2%2028.8%209.1%2029.8%209%2030.8%209%2031.4%209.1%2031.7%209.1%2032.7%209.3%2033.7%209.6%2034.6%2010%2035.5%2010.5%2036.3%2011.1%2036.9%2011.7%2037.5%2012.5%2038%2013.4%2038.4%2014.3%2038.7%2015.3%2038.9%2016.3%2038.9%2016.6%2039%2017.2%2039%2018.2%2038.9%2019.2%2038.8%2020.2%2038.6%2021.2%2038.3%2022.1%2038%2023.1%2037.7%2024%2037.3%2024.9%2036.8%2025.8%2036.4%2026.6%2035.8%2027.5%2035.8%2027.6%2035.3%2028.3%2034.7%2029.1%2034.1%2029.9%2033.5%2030.7%2032.8%2031.4Z;%20M24.3%2010.2%2024.9%2010%2025.9%209.7%2026.8%209.4%2027.1%209.4%2027.8%209.2%2028.8%209.1%2029.8%209%2029.9%209%2030.8%209%2031.7%209.1%2032.7%209.3%2032.8%209.3%2033.7%209.6%2034.6%2010%2035.5%2010.5%2035.5%2010.5%2036.3%2011.1%2036.9%2011.7%2037.5%2012.5%2037.5%2012.5%2038%2013.4%2038.4%2014.3%2038.7%2015.2%2038.7%2015.3%2038.9%2016.3%2039%2017.2%2039%2018.1%2039%2018.2%2038.9%2019.2%2038.8%2020.2%2038.6%2020.9%2038.6%2021.2%2038.3%2022.1%2038%2023.1%2037.8%2023.7%2037.7%2024%2037.3%2024.9%2036.8%2025.8%2036.5%2026.4%2036.4%2026.6%2035.8%2027.5%2035.3%2028.3%2035%2028.8%2034.7%2029.1%2034.1%2029.9%2033.5%2030.7%2033.1%2031.1%2032.8%2031.4%2032.1%2032.1%2031.4%2032.8%2031.1%2033.1%2030.7%2033.5%2029.9%2034.1%2029.1%2034.7%2028.8%2035%2028.3%2035.3%2027.5%2035.8%2026.6%2036.4%2026.4%2036.5%2025.8%2036.8%2024.9%2037.3%2024%2037.7%2023.7%2037.8%2023.1%2038%2022.1%2038.3%2021.2%2038.6%2020.9%2038.6%2020.2%2038.8%2019.2%2038.9%2018.2%2039%2018.1%2039%2017.2%2039%2016.3%2038.9%2015.3%2038.7%2015.2%2038.7%2014.3%2038.4%2013.4%2038%2012.5%2037.5%2012.5%2037.5%2011.7%2036.9%2011.1%2036.3%2010.5%2035.5%2010.5%2035.5%2010%2034.6%209.6%2033.7%209.3%2032.8%209.3%2032.7%209.1%2031.7%209%2030.8%209%2029.9%209%2029.8%209.1%2028.8%209.2%2027.8%209.4%2027.1%209.4%2026.8%209.7%2025.9%2010%2024.9%2010.2%2024.3%2010.3%2024%2010.7%2023.1%2011.2%2022.2%2011.5%2021.6%2011.6%2021.4%2012.2%2020.5%2012.7%2019.7%2013%2019.2%2013.3%2018.9%2013.9%2018.1%2014.5%2017.3%2014.9%2016.9%2015.2%2016.6%2015.9%2015.9%2016.6%2015.2%2016.9%2014.9%2017.3%2014.5%2018.1%2013.9%2018.9%2013.3%2019.2%2013%2019.7%2012.7%2020.5%2012.2%2021.4%2011.6%2021.6%2011.5%2022.2%2011.2%2023.1%2010.7%2024%2010.3Z;%20M22.5%207.8%2023.2%207.2%2024.2%207%2025.1%207.4%2025.7%208.1%2026.2%209%2026.8%209.8%2027.3%2010.6%2028.1%2011.2%2029%2011.3%2030%2011%2030.9%2010.6%2031.8%2010.3%2032.8%209.9%2033.7%2010%2034.5%2010.6%2034.9%2011.5%2034.8%2012.5%2034.8%2013.5%2034.7%2014.5%2034.7%2015.5%2035.2%2016.3%2036%2016.8%2037%2017%2037.9%2017.3%2038.9%2017.5%2039.8%2017.9%2040.4%2018.7%2040.5%2019.7%2040%2020.5%2039.3%2021.3%2038.7%2022%2038.1%2022.8%2037.6%2023.7%2037.7%2024.6%2038.3%2025.4%2038.9%2026.2%2039.6%2027%2040.2%2027.7%2040.5%2028.6%2040.3%2029.6%2039.5%2030.3%2038.6%2030.6%2037.6%2030.8%2036.7%2031%2035.7%2031.3%2035%2031.9%2034.6%2032.8%2034.7%2033.8%2034.8%2034.8%2034.8%2035.8%2034.8%2036.8%2034.3%2037.6%2033.4%2038.1%2032.4%2038%2031.5%2037.6%2030.6%2037.2%2029.7%2036.9%2028.7%2036.6%2027.8%2036.9%2027.1%2037.6%2026.6%2038.5%2026.1%2039.3%2025.5%2040.2%2024.8%2040.8%2023.8%2041%2022.9%2040.6%2022.3%2039.9%2021.8%2039%2021.2%2038.2%2020.7%2037.4%2019.9%2036.8%2019%2036.7%2018%2037%2017.1%2037.4%2016.2%2037.7%2015.2%2038.1%2014.3%2038%2013.5%2037.4%2013.1%2036.5%2013.2%2035.5%2013.2%2034.5%2013.3%2033.5%2013.3%2032.5%2012.8%2031.7%2012%2031.2%2011%2031%2010.1%2030.7%209.1%2030.5%208.2%2030.1%207.6%2029.3%207.5%2028.3%208%2027.5%208.7%2026.7%209.3%2026%209.9%2025.2%2010.4%2024.3%2010.3%2023.4%209.7%2022.6%209.1%2021.8%208.4%2021%207.8%2020.3%207.5%2019.4%207.7%2018.4%208.5%2017.7%209.4%2017.4%2010.4%2017.2%2011.3%2017%2012.3%2016.7%2013%2016.1%2013.4%2015.2%2013.3%2014.2%2013.2%2013.2%2013.2%2012.2%2013.2%2011.2%2013.7%2010.4%2014.6%209.9%2015.6%2010%2016.5%2010.4%2017.4%2010.8%2018.3%2011.1%2019.3%2011.4%2020.2%2011.1%2020.9%2010.4%2021.4%209.5%2021.9%208.7Z'%3e%3c/animate%3e%3canimateTransform%20attributeName='transform'%20attributeType='XML'%20type='rotate'%20dur='5s'%20repeatCount='indefinite'%20calcMode='spline'%20keySplines='0.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8'%20keyTimes='0;%200.14;%200.29;%200.43;%200.57;%200.71;%200.86;%201'%20values='0%2024%2024;%20154%2024%2024;%20309%2024%2024;%20463%2024%2024;%20617%2024%2024;%20771%2024%2024;%20926%2024%2024;%201080%2024%2024'%3e%3c/animateTransform%3e%3c/path%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='100%25'%20height='100%25'%20viewBox='4%204%2040%2040'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20fill='%23D0BCFF'%3e%3canimate%20attributeName='d'%20dur='5s'%20repeatCount='indefinite'%20calcMode='spline'%20keySplines='0.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8'%20keyTimes='0;%200.14;%200.14;%200.29;%200.29;%200.43;%200.43;%200.57;%200.57;%200.71;%200.71;%200.86;%200.86;%201'%20values='M20.9%2010.4%2021.4%209.5%2021.9%208.7%2022.5%207.8%2023.2%207.2%2024.2%207%2025.1%207.4%2025.7%208.1%2026.2%209%2026.8%209.8%2027.3%2010.6%2028.1%2011.2%2029%2011.3%2030%2011%2030.9%2010.6%2031.8%2010.3%2032.8%209.9%2033.7%2010%2034.5%2010.6%2034.9%2011.5%2034.8%2012.5%2034.8%2013.5%2034.7%2014.5%2034.7%2015.5%2035.2%2016.3%2036%2016.8%2037%2017.1%2037.9%2017.3%2038.9%2017.5%2039.8%2017.9%2040.4%2018.7%2040.5%2019.7%2040%2020.5%2039.4%2021.3%2038.7%2022%2038.1%2022.8%2037.6%2023.7%2037.7%2024.6%2038.3%2025.5%2038.9%2026.2%2039.6%2027%2040.2%2027.7%2040.5%2028.7%2040.3%2029.6%2039.5%2030.3%2038.6%2030.6%2037.6%2030.8%2036.7%2031%2035.7%2031.3%2035%2031.9%2034.6%2032.8%2034.7%2033.8%2034.8%2034.8%2034.9%2035.8%2034.8%2036.8%2034.3%2037.6%2033.4%2038.1%2032.4%2038%2031.5%2037.6%2030.6%2037.2%2029.7%2036.9%2028.7%2036.6%2027.8%2036.9%2027.1%2037.6%2026.6%2038.5%2026.1%2039.3%2025.5%2040.2%2024.8%2040.8%2023.8%2041%2022.9%2040.6%2022.3%2039.9%2021.8%2039%2021.2%2038.2%2020.7%2037.4%2019.9%2036.8%2019%2036.7%2018%2037%2017.1%2037.4%2016.2%2037.7%2015.2%2038.1%2014.3%2038%2013.5%2037.4%2013.1%2036.5%2013.2%2035.5%2013.2%2034.5%2013.3%2033.5%2013.3%2032.5%2012.8%2031.7%2012%2031.2%2011%2031%2010.1%2030.7%209.1%2030.5%208.2%2030.1%207.6%2029.3%207.5%2028.3%208%2027.5%208.7%2026.7%209.3%2026%209.9%2025.2%2010.4%2024.3%2010.3%2023.4%209.7%2022.5%209.1%2021.8%208.4%2021%207.8%2020.3%207.5%2019.3%207.7%2018.4%208.5%2017.7%209.4%2017.4%2010.4%2017.2%2011.3%2017%2012.3%2016.7%2013%2016.1%2013.4%2015.2%2013.3%2014.2%2013.2%2013.2%2013.1%2012.2%2013.2%2011.2%2013.7%2010.4%2014.6%209.9%2015.6%2010%2016.5%2010.4%2017.4%2010.8%2018.3%2011.1%2019.3%2011.4%2020.2%2011.1Z;%20M20.3%208.6%2021.1%208%2022%207.6%2023%207.3%2023%207.3%2024%207.2%2025%207.3%2025.9%207.5%2026.8%208%2027.6%208.6%2028.4%209.1%2028.4%209.1%2029.3%209.6%2030.3%209.8%2031.3%209.9%2032.3%2010%2033.3%2010.2%2034.2%2010.6%2034.2%2010.6%2035%2011.2%2035.7%2011.9%2036.3%2012.7%2036.7%2013.6%2036.9%2014.6%2037.2%2015.5%2037.2%2015.5%2037.6%2016.5%2038.2%2017.3%2038.9%2018%2039.6%2018.7%2040.2%2019.5%2040.6%2020.4%2040.6%2020.4%2040.9%2021.3%2041%2022.3%2040.9%2023.3%2040.6%2024.3%2040.2%2025.2%2039.8%2026.1%2039.8%2026.1%2039.5%2027%2039.4%2028%2039.5%2029%2039.6%2030%2039.5%2031%2039.3%2032%2039.3%2032%2038.9%2032.9%2038.3%2033.7%2037.6%2034.4%2036.8%2035%2035.9%2035.4%2035%2035.8%2035%2035.8%2034.1%2036.3%2033.4%2037%2032.9%2037.9%2032.3%2038.7%2031.6%2039.4%2030.8%2040%2030.8%2040%2029.9%2040.4%2028.9%2040.7%2027.9%2040.8%2027%2040.7%2026%2040.4%2025%2040.1%2025%2040.1%2024%2040%2023%2040.1%2022.1%2040.4%2021.1%2040.7%2020.1%2040.8%2019.1%2040.7%2019.1%2040.7%2018.2%2040.5%2017.3%2040%2016.4%2039.5%2015.7%2038.8%2015.2%2037.9%2014.6%2037.1%2014.6%2037.1%2013.9%2036.4%2013.1%2035.8%2012.2%2035.4%2011.3%2035%2010.5%2034.4%209.7%2033.8%209.7%2033.8%209.1%2032.9%208.7%2032%208.5%2031.1%208.4%2030.1%208.5%2029.1%208.6%2028.1%208.6%2028.1%208.5%2027.1%208.3%2026.1%207.8%2025.2%207.4%2024.3%207.1%2023.4%207%2022.4%207%2022.4%207.1%2021.4%207.3%2020.4%207.8%2019.5%208.3%2018.7%209.1%2018%209.8%2017.3%209.8%2017.3%2010.4%2016.5%2010.8%2015.6%2011%2014.6%2011.3%2013.7%2011.7%2012.8%2012.2%2011.9%2012.2%2011.9%2012.9%2011.2%2013.8%2010.7%2014.7%2010.2%2015.6%2010%2016.6%209.9%2017.6%209.8%2017.6%209.8%2018.6%209.6%2019.5%209.2Z;%20M18.6%209.6%2019.5%209.2%2020.3%208.6%2021.1%208%2022%207.6%2023%207.3%2024%207.2%2025%207.3%2025.9%207.5%2026.8%208%2027.6%208.6%2028.4%209.1%2029.3%209.6%2030.3%209.8%2031.3%209.9%2032.3%2010%2033.3%2010.2%2034.2%2010.6%2035%2011.2%2035.7%2011.9%2036.3%2012.7%2036.7%2013.6%2036.9%2014.6%2037.2%2015.5%2037.6%2016.4%2038.2%2017.3%2038.9%2018%2039.6%2018.7%2040.2%2019.5%2040.6%2020.4%2040.9%2021.3%2041%2022.3%2040.9%2023.3%2040.6%2024.3%2040.2%2025.2%2039.8%2026.1%2039.5%2027%2039.4%2028%2039.5%2029%2039.6%2030%2039.5%2031%2039.3%2032%2038.9%2032.9%2038.3%2033.7%2037.6%2034.4%2036.8%2035%2035.9%2035.4%2035%2035.8%2034.1%2036.3%2033.4%2037%2032.9%2037.9%2032.3%2038.7%2031.6%2039.4%2030.8%2040%2029.9%2040.4%2028.9%2040.7%2027.9%2040.8%2027%2040.7%2026%2040.4%2025%2040.1%2024%2040%2023%2040.1%2022.1%2040.4%2021.1%2040.7%2020.1%2040.8%2019.1%2040.7%2018.2%2040.5%2017.3%2040%2016.4%2039.5%2015.7%2038.8%2015.2%2037.9%2014.6%2037.1%2013.9%2036.4%2013.1%2035.8%2012.2%2035.4%2011.3%2035%2010.5%2034.4%209.7%2033.8%209.1%2032.9%208.7%2032%208.5%2031.1%208.4%2030.1%208.5%2029.1%208.6%2028.1%208.5%2027.1%208.3%2026.1%207.8%2025.2%207.4%2024.3%207.1%2023.4%207%2022.4%207.1%2021.4%207.3%2020.4%207.8%2019.5%208.3%2018.7%209.1%2018%209.8%2017.3%2010.4%2016.5%2010.8%2015.6%2011%2014.6%2011.3%2013.7%2011.7%2012.8%2012.2%2011.9%2012.9%2011.2%2013.8%2010.7%2014.7%2010.2%2015.6%2010%2016.6%209.9%2017.6%209.8Z;%20M18.6%209.9%2019.5%209.4%2020.3%208.8%2021.1%208.2%2022%207.8%2023%207.6%2023.9%207.5%2024.9%207.6%2025.9%207.8%2026.8%208.2%2027.6%208.7%2028.5%209.3%2029.3%209.9%2030.1%2010.5%2030.9%2011%2031.7%2011.6%2032.5%2012.2%2033.3%2012.8%2033.7%2013.1%2034.1%2013.3%2034.9%2013.9%2035.7%2014.5%2036.6%2015%2037.4%2015.6%2038.2%2016.2%2039%2016.8%2039.7%2017.5%2040.2%2018.3%2040.7%2019.2%2040.9%2020.1%2041%2021.1%2040.9%2022.1%2040.7%2023.1%2040.3%2024%2040%2024.9%2039.7%2025.9%2039.4%2026.8%2039%2027.8%2038.7%2028.7%2038.4%2029.6%2038.1%2030.6%2037.8%2031.5%2037.5%2032.5%2037.2%2033.4%2036.9%2034.4%2036.6%2035.3%2036.2%2036.2%2035.7%2037.1%2035%2037.8%2034.3%2038.4%2033.4%2038.9%2032.5%2039.3%2031.5%2039.5%2030.5%2039.5%2030%2039.5%2029.5%2039.5%2028.5%2039.5%2027.5%2039.5%2026.5%2039.5%2025.5%2039.4%2024.5%2039.4%2023.6%2039.4%2022.6%2039.4%2021.6%2039.5%2020.6%2039.5%2019.6%2039.5%2018.6%2039.5%2017.6%2039.5%2016.6%2039.5%2015.6%2039.3%2014.7%2039%2013.8%2038.5%2013.1%2037.9%2012.4%2037.2%2011.9%2036.3%2011.5%2035.4%2011.2%2034.5%2010.9%2033.5%2010.6%2032.6%2010.3%2031.6%2010%2030.7%209.7%2029.7%209.3%2028.8%209%2027.9%208.7%2026.9%208.4%2026%208%2025%207.7%2024.1%207.4%2023.2%207.1%2022.2%207.1%2021.7%207%2021.2%207.1%2020.2%207.3%2019.3%207.7%2018.4%208.3%2017.5%208.9%2016.8%209.7%2016.2%2010.5%2015.6%2011.4%2015.1%2012.2%2014.5%2013%2014%2013.8%2013.4%2014.6%2012.8%2015.4%2012.3%2016.2%2011.7%2017%2011.1%2017.8%2010.5Z;%20M15.4%2012.3%2016.2%2011.7%2017%2011.1%2017.8%2010.5%2018.6%209.9%2019.5%209.4%2020.3%208.8%2021.1%208.3%2022%207.8%2023%207.6%2023.9%207.5%2024.9%207.6%2025.9%207.8%2026.8%208.2%2027.6%208.7%2028.5%209.3%2029.3%209.9%2030.1%2010.5%2030.9%2011%2031.7%2011.6%2032.5%2012.2%2033.3%2012.8%2034.1%2013.3%2034.9%2013.9%2035.7%2014.5%2036.6%2015%2037.4%2015.6%2038.2%2016.2%2039%2016.8%2039.7%2017.5%2040.2%2018.3%2040.7%2019.2%2040.9%2020.1%2041%2021.1%2040.9%2022.1%2040.7%2023.1%2040.3%2024%2040%2024.9%2039.7%2025.9%2039.4%2026.8%2039%2027.8%2038.7%2028.7%2038.4%2029.6%2038.1%2030.6%2037.8%2031.5%2037.5%2032.5%2037.2%2033.4%2036.9%2034.4%2036.6%2035.3%2036.2%2036.2%2035.7%2037.1%2035%2037.8%2034.3%2038.4%2033.4%2038.9%2032.5%2039.3%2031.5%2039.4%2030.5%2039.5%2029.5%2039.5%2028.5%2039.5%2027.5%2039.5%2026.5%2039.5%2025.5%2039.4%2024.5%2039.4%2023.6%2039.4%2022.6%2039.4%2021.6%2039.5%2020.6%2039.5%2019.6%2039.5%2018.6%2039.5%2017.6%2039.5%2016.6%2039.5%2015.6%2039.3%2014.7%2039%2013.8%2038.5%2013.1%2037.9%2012.4%2037.2%2011.9%2036.3%2011.5%2035.4%2011.2%2034.5%2010.9%2033.5%2010.6%2032.6%2010.3%2031.6%2010%2030.7%209.7%2029.7%209.3%2028.8%209%2027.9%208.7%2026.9%208.4%2026%208%2025%207.7%2024.1%207.4%2023.2%207.1%2022.2%207%2021.2%207.1%2020.2%207.3%2019.3%207.7%2018.4%208.3%2017.5%208.9%2016.8%209.7%2016.2%2010.5%2015.6%2011.4%2015.1%2012.2%2014.5%2013%2014%2013.8%2013.4%2014.6%2012.8Z;%20M17%2012.8%2017.7%2012.1%2018.5%2011.5%2019.3%2010.9%2020.1%2010.5%2020.2%2010.4%2021.1%2010%2022%209.7%2023%209.4%2024%209.2%2025%209%2026%209%2027%209%2027.6%209.1%2028%209.1%2028.9%209.3%2029.9%209.6%2030.9%209.9%2031.8%2010.3%2032.6%2010.8%2033.5%2011.3%2034.3%2011.9%2034.6%2012.2%2035%2012.6%2035.7%2013.3%2036.4%2014.1%2036.9%2014.9%2037.4%2015.8%2037.9%2016.6%2038.3%2017.6%2038.6%2018.5%2038.6%2018.7%2038.8%2019.5%2038.9%2020.5%2039%2021.5%2039%2022.5%2038.9%2023.5%2038.7%2024.5%2038.5%2025.4%2038.2%2026.3%2038.2%2026.4%2037.8%2027.3%2037.4%2028.2%2036.8%2029.1%2036.2%2029.9%2035.6%2030.6%2034.9%2031.3%2034.2%2032%2033.8%2032.5%2033.5%2032.8%2032.8%2033.5%2032.1%2034.2%2031.4%2034.9%2030.7%2035.6%2029.9%2036.2%2029.1%2036.8%2028.2%2037.3%2027.9%2037.5%2027.4%2037.8%2026.4%2038.2%2025.5%2038.5%2024.5%2038.7%2023.5%2038.9%2022.5%2039%2021.5%2039%2020.5%2038.9%2020.4%2038.9%2019.5%2038.8%2018.6%2038.6%2017.6%2038.3%2016.7%2037.9%2015.8%2037.5%2014.9%2037%2014.1%2036.4%2013.4%2035.8%2013.3%2035.8%2012.6%2035.1%2012%2034.3%2011.3%2033.5%2010.8%2032.7%2010.3%2031.8%209.9%2030.9%209.6%2030%209.4%2029.3%209.3%2029%209.1%2028%209%2027%209%2026%209%2025%209.2%2024%209.4%2023%209.6%2022.1%209.8%2021.7%2010%2021.1%2010.4%2020.2%2010.9%2019.4%2011.4%2018.5%2012.1%2017.8%2012.7%2017%2013.4%2016.3%2014.2%2015.6%2014.2%2015.5%2014.9%2014.9%2015.6%2014.2%2016.3%2013.5Z;%20M33.5%2011.3%2034.3%2011.9%2035%2012.6%2035.3%2012.8%2035.7%2013.3%2036.4%2014.1%2036.9%2014.9%2037.4%2015.8%2037.9%2016.6%2038.3%2017.6%2038.3%2017.7%2038.6%2018.5%2038.8%2019.5%2038.9%2020.5%2039%2021.5%2039%2022.5%2038.9%2023.5%2038.9%2023.5%2038.7%2024.5%2038.5%2025.4%2038.2%2026.4%2037.8%2027.3%2037.4%2028.2%2036.9%2028.9%2036.8%2029.1%2036.2%2029.9%2035.6%2030.6%2034.9%2031.3%2034.2%2032%2033.5%2032.8%2033.1%2033.2%2032.8%2033.5%2032.1%2034.2%2031.4%2034.9%2030.7%2035.6%2029.9%2036.2%2029.1%2036.8%2028.7%2037%2028.2%2037.3%2027.4%2037.8%2026.4%2038.2%2025.5%2038.5%2024.5%2038.7%2023.5%2038.9%2023.3%2038.9%2022.5%2039%2021.5%2039%2020.5%2038.9%2019.5%2038.8%2018.6%2038.6%2017.6%2038.3%2017.6%2038.3%2016.7%2037.9%2015.8%2037.5%2014.9%2037%2014.1%2036.4%2013.3%2035.8%2012.7%2035.2%2012.6%2035.1%2012%2034.3%2011.3%2033.5%2010.8%2032.7%2010.3%2031.8%209.9%2030.9%209.7%2030.3%209.6%2029.9%209.3%2029%209.1%2028%209%2027%209%2026%209%2025%209.1%2024.5%209.2%2024%209.4%2023%209.6%2022.1%2010%2021.1%2010.4%2020.2%2010.9%2019.4%2011.1%2019.1%2011.5%2018.5%2012.1%2017.7%2012.7%2017%2013.5%2016.3%2014.2%2015.6%2014.9%2014.9%2014.9%2014.8%2015.6%2014.2%2016.3%2013.5%2017%2012.8%2017.7%2012.1%2018.5%2011.5%2019.3%2011%2019.3%2010.9%2020.2%2010.4%2021.1%2010%2022%209.7%2023%209.4%2024%209.2%2024.7%209.1%2025%209%2026%209%2027%209%2028%209.1%2028.9%209.3%2029.9%209.6%2030.4%209.7%2030.9%209.9%2031.8%2010.3%2032.6%2010.8Z;%20M33.2%2011.1%2034.2%2011.2%2035.1%2011.4%2036%2011.9%2036.6%2012.7%2036.8%2013.7%2036.9%2014.7%2036.9%2015.7%2037%2016.7%2037.1%2017.7%2037.3%2018.6%2037.9%2019.4%2038.5%2020.2%2039.2%2020.9%2039.8%2021.7%2040.5%2022.4%2040.9%2023.3%2041%2024.3%2040.7%2025.2%2040.1%2026%2039.4%2026.8%2038.8%2027.5%2038.1%2028.3%2037.5%2029.1%2037.1%2030%2037%2031%2037%2031.9%2036.9%2032.9%2036.8%2033.9%2036.7%2034.9%2036.2%2035.8%2035.5%2036.4%2034.5%2036.8%2033.6%2036.8%2032.6%2036.9%2031.6%2037%2030.6%2037.1%2029.6%2037.2%2028.8%2037.7%2028%2038.4%2027.3%2039%2026.5%2039.7%2025.8%2040.3%2024.9%2040.8%2023.9%2041%2023%2040.8%2022.1%2040.2%2021.4%2039.6%2020.6%2038.9%2019.9%2038.3%2019.1%2037.6%2018.3%2037.2%2017.3%2037%2016.3%2037%2015.3%2036.9%2014.3%2036.8%2013.3%2036.7%2012.4%2036.4%2011.7%2035.7%2011.3%2034.8%2011.2%2033.8%2011.1%2032.8%2011%2031.8%2011%2030.8%2010.9%2029.9%2010.4%2029%209.8%2028.2%209.1%2027.5%208.5%2026.7%207.8%2026%207.3%2025.1%207%2024.2%207.1%2023.2%207.6%2022.3%208.2%2021.6%208.9%2020.8%209.5%2020.1%2010.2%2019.3%2010.7%2018.5%2010.9%2017.5%2011%2016.6%2011.1%2015.6%2011.1%2014.6%2011.2%2013.6%2011.5%2012.6%2012.1%2011.9%2013%2011.4%2013.9%2011.2%2014.9%2011.1%2015.9%2011%2016.9%2011%2017.9%2010.9%2018.8%2010.6%2019.6%2010%2020.4%209.3%2021.1%208.6%2021.9%208%2022.6%207.4%2023.6%207%2024.6%207.1%2025.5%207.5%2026.2%208.1%2027%208.7%2027.7%209.4%2028.5%2010%2029.3%2010.6%2030.2%2010.9%2031.2%2011%2032.2%2011.1Z;%20M27.7%209.4%2028.5%2010%2029.3%2010.6%2030.2%2010.9%2031.2%2011%2032.2%2011.1%2033.2%2011.1%2034.2%2011.2%2035.1%2011.4%2036%2011.9%2036.6%2012.7%2036.8%2013.7%2036.9%2014.7%2036.9%2015.7%2037%2016.7%2037.1%2017.7%2037.3%2018.6%2037.9%2019.4%2038.5%2020.2%2039.2%2020.9%2039.8%2021.7%2040.5%2022.4%2040.9%2023.3%2041%2024.3%2040.7%2025.2%2040.1%2026%2039.4%2026.8%2038.8%2027.5%2038.1%2028.3%2037.5%2029.1%2037.1%2030%2037%2031%2037%2031.9%2036.9%2032.9%2036.8%2033.9%2036.7%2034.9%2036.2%2035.8%2035.5%2036.4%2034.5%2036.8%2033.6%2036.9%2032.6%2036.9%2031.6%2037%2030.6%2037.1%2029.6%2037.2%2028.8%2037.7%2028%2038.4%2027.3%2039%2026.5%2039.7%2025.8%2040.3%2024.9%2040.8%2023.9%2041%2023%2040.8%2022.1%2040.2%2021.4%2039.6%2020.6%2038.9%2019.9%2038.3%2019.1%2037.6%2018.3%2037.2%2017.3%2037%2016.3%2037%2015.3%2036.9%2014.3%2036.8%2013.3%2036.7%2012.4%2036.4%2011.7%2035.7%2011.3%2034.8%2011.2%2033.8%2011.1%2032.8%2011%2031.8%2011%2030.8%2010.9%2029.9%2010.4%2029%209.8%2028.2%209.1%2027.5%208.5%2026.7%207.8%2026%207.3%2025.1%207%2024.2%207.1%2023.2%207.6%2022.3%208.2%2021.6%208.9%2020.8%209.5%2020.1%2010.2%2019.3%2010.7%2018.5%2010.9%2017.5%2011%2016.5%2011.1%2015.6%2011.1%2014.6%2011.2%2013.6%2011.5%2012.6%2012.1%2011.9%2013%2011.4%2013.9%2011.2%2014.9%2011.1%2015.9%2011%2016.9%2011%2017.9%2010.9%2018.8%2010.6%2019.6%2010%2020.4%209.3%2021.1%208.6%2021.9%208%2022.6%207.4%2023.6%207%2024.6%207.1%2025.5%207.5%2026.2%208.1%2027%208.7Z;%20M27.9%2010.6%2028.8%2010.3%2029.8%2010.1%2030.8%2010%2031.8%2010.1%2032.7%2010.3%2033.7%2010.6%2034.6%2011.1%2034.8%2011.3%2035.4%2011.7%2036.1%2012.4%2036.7%2013.1%2037.2%2014%2037.6%2014.9%2037.9%2015.9%2038%2016.9%2038%2017.9%2037.8%2018.8%2037.5%2019.8%2037.1%2020.7%2036.8%2021.6%2036.5%2022.6%2036.4%2023.6%2036.4%2024.4%2036.4%2024.6%2036.5%2025.5%2036.8%2026.5%2037.2%2027.4%2037.6%2028.3%2037.8%2029.3%2038%2030.3%2038%2031.3%2037.8%2032.3%2037.6%2033.2%2037.2%2034.1%2036.6%2035%2036%2035.7%2035.3%2036.4%2034.4%2037%2034.1%2037.2%2033.6%2037.4%2032.6%2037.8%2031.6%2037.9%2030.6%2038%2029.7%2037.9%2028.7%2037.7%2027.8%2037.3%2026.8%2036.9%2025.9%2036.6%2024.9%2036.4%2023.9%2036.4%2022.9%2036.4%2022%2036.6%2021%2037%2020.1%2037.4%2020.1%2037.4%2019.2%2037.7%2018.2%2037.9%2017.2%2038%2016.2%2037.9%2015.3%2037.7%2014.3%2037.4%2013.4%2036.9%2012.6%2036.3%2011.9%2035.6%2011.3%2034.9%2010.8%2034%2010.4%2033.1%2010.1%2032.1%2010%2031.1%2010%2030.6%2010%2030.1%2010.2%2029.2%2010.5%2028.2%2010.9%2027.3%2011.2%2026.4%2011.5%2025.4%2011.6%2024.4%2011.6%2023.4%2011.5%2022.5%2011.2%2021.5%2010.8%2020.6%2010.4%2019.7%2010.2%2018.7%2010%2017.7%2010%2016.7%2010%2016.6%2010.2%2015.7%2010.4%2014.8%2010.8%2013.9%2011.4%2013%2012%2012.3%2012.7%2011.6%2013.6%2011%2014.4%2010.6%2015.4%2010.2%2016.4%2010.1%2017.4%2010%2018.3%2010.1%2019.3%2010.3%2020.2%2010.7%2020.9%2011%2021.2%2011.1%2022.1%2011.4%2023.1%2011.6%2024.1%2011.6%2025.1%2011.6%2026%2011.4%2027%2011Z;%20M36%2035.7%2035.3%2036.4%2034.4%2037%2033.6%2037.4%2032.6%2037.8%2031.6%2037.9%2030.6%2038%2029.7%2037.9%2028.7%2037.7%2027.8%2037.3%2026.8%2036.9%2025.9%2036.6%2024.9%2036.4%2023.9%2036.4%2022.9%2036.4%2022%2036.6%2021%2037%2020.1%2037.4%2019.2%2037.7%2018.2%2037.9%2017.2%2038%2016.2%2037.9%2015.3%2037.7%2014.3%2037.4%2013.4%2036.9%2012.6%2036.3%2011.9%2035.6%2011.3%2034.9%2010.8%2034%2010.4%2033.1%2010.1%2032.1%2010%2031.1%2010%2030.2%2010.2%2029.2%2010.5%2028.2%2010.9%2027.3%2011.2%2026.4%2011.5%2025.4%2011.6%2024.4%2011.6%2023.4%2011.5%2022.5%2011.2%2021.5%2010.8%2020.6%2010.4%2019.7%2010.2%2018.7%2010%2017.7%2010%2016.7%2010.2%2015.7%2010.4%2014.8%2010.8%2013.9%2011.4%2013%2012%2012.3%2012.7%2011.6%2013.6%2011%2014.4%2010.6%2015.4%2010.2%2016.4%2010.1%2017.4%2010%2018.3%2010.1%2019.3%2010.3%2020.2%2010.7%2021.2%2011.1%2022.1%2011.4%2023.1%2011.6%2024.1%2011.6%2025.1%2011.6%2026%2011.4%2027%2011%2027.9%2010.6%2028.8%2010.3%2029.8%2010.1%2030.8%2010%2031.8%2010.1%2032.7%2010.3%2033.7%2010.6%2034.6%2011.1%2035.4%2011.7%2036.1%2012.4%2036.7%2013.1%2037.2%2014%2037.6%2014.9%2037.9%2015.9%2038%2016.9%2038%2017.8%2037.8%2018.8%2037.5%2019.8%2037.1%2020.7%2036.8%2021.6%2036.5%2022.6%2036.4%2023.6%2036.4%2024.6%2036.5%2025.5%2036.8%2026.5%2037.2%2027.4%2037.6%2028.3%2037.8%2029.3%2038%2030.3%2038%2031.3%2037.8%2032.3%2037.6%2033.2%2037.2%2034.1%2036.6%2035Z;%20M32.1%2032.1%2031.4%2032.8%2030.7%2033.5%2029.9%2034.1%2029.1%2034.7%2028.3%2035.3%2027.6%2035.8%2027.5%2035.8%2026.6%2036.4%2025.8%2036.8%2024.9%2037.3%2024%2037.7%2023.1%2038%2022.1%2038.3%2021.2%2038.6%2020.2%2038.8%2019.2%2038.9%2018.2%2039%2017.2%2039%2016.6%2038.9%2016.3%2038.9%2015.3%2038.7%2014.3%2038.4%2013.4%2038%2012.5%2037.5%2011.7%2036.9%2011.1%2036.3%2010.5%2035.5%2010%2034.6%209.6%2033.7%209.3%2032.7%209.1%2031.7%209.1%2031.4%209%2030.8%209%2029.8%209.1%2028.8%209.2%2027.8%209.4%2026.8%209.7%2025.9%2010%2024.9%2010.3%2024%2010.7%2023.1%2011.2%2022.2%2011.6%2021.4%2012.2%2020.5%2012.2%2020.4%2012.7%2019.7%2013.3%2018.9%2013.9%2018.1%2014.5%2017.3%2015.2%2016.6%2015.9%2015.9%2016.6%2015.2%2017.3%2014.5%2018.1%2013.9%2018.9%2013.3%2019.7%2012.7%2020.4%2012.2%2020.5%2012.2%2021.4%2011.6%2022.2%2011.2%2023.1%2010.7%2024%2010.3%2024.9%2010%2025.9%209.7%2026.8%209.4%2027.8%209.2%2028.8%209.1%2029.8%209%2030.8%209%2031.4%209.1%2031.7%209.1%2032.7%209.3%2033.7%209.6%2034.6%2010%2035.5%2010.5%2036.3%2011.1%2036.9%2011.7%2037.5%2012.5%2038%2013.4%2038.4%2014.3%2038.7%2015.3%2038.9%2016.3%2038.9%2016.6%2039%2017.2%2039%2018.2%2038.9%2019.2%2038.8%2020.2%2038.6%2021.2%2038.3%2022.1%2038%2023.1%2037.7%2024%2037.3%2024.9%2036.8%2025.8%2036.4%2026.6%2035.8%2027.5%2035.8%2027.6%2035.3%2028.3%2034.7%2029.1%2034.1%2029.9%2033.5%2030.7%2032.8%2031.4Z;%20M24.3%2010.2%2024.9%2010%2025.9%209.7%2026.8%209.4%2027.1%209.4%2027.8%209.2%2028.8%209.1%2029.8%209%2029.9%209%2030.8%209%2031.7%209.1%2032.7%209.3%2032.8%209.3%2033.7%209.6%2034.6%2010%2035.5%2010.5%2035.5%2010.5%2036.3%2011.1%2036.9%2011.7%2037.5%2012.5%2037.5%2012.5%2038%2013.4%2038.4%2014.3%2038.7%2015.2%2038.7%2015.3%2038.9%2016.3%2039%2017.2%2039%2018.1%2039%2018.2%2038.9%2019.2%2038.8%2020.2%2038.6%2020.9%2038.6%2021.2%2038.3%2022.1%2038%2023.1%2037.8%2023.7%2037.7%2024%2037.3%2024.9%2036.8%2025.8%2036.5%2026.4%2036.4%2026.6%2035.8%2027.5%2035.3%2028.3%2035%2028.8%2034.7%2029.1%2034.1%2029.9%2033.5%2030.7%2033.1%2031.1%2032.8%2031.4%2032.1%2032.1%2031.4%2032.8%2031.1%2033.1%2030.7%2033.5%2029.9%2034.1%2029.1%2034.7%2028.8%2035%2028.3%2035.3%2027.5%2035.8%2026.6%2036.4%2026.4%2036.5%2025.8%2036.8%2024.9%2037.3%2024%2037.7%2023.7%2037.8%2023.1%2038%2022.1%2038.3%2021.2%2038.6%2020.9%2038.6%2020.2%2038.8%2019.2%2038.9%2018.2%2039%2018.1%2039%2017.2%2039%2016.3%2038.9%2015.3%2038.7%2015.2%2038.7%2014.3%2038.4%2013.4%2038%2012.5%2037.5%2012.5%2037.5%2011.7%2036.9%2011.1%2036.3%2010.5%2035.5%2010.5%2035.5%2010%2034.6%209.6%2033.7%209.3%2032.8%209.3%2032.7%209.1%2031.7%209%2030.8%209%2029.9%209%2029.8%209.1%2028.8%209.2%2027.8%209.4%2027.1%209.4%2026.8%209.7%2025.9%2010%2024.9%2010.2%2024.3%2010.3%2024%2010.7%2023.1%2011.2%2022.2%2011.5%2021.6%2011.6%2021.4%2012.2%2020.5%2012.7%2019.7%2013%2019.2%2013.3%2018.9%2013.9%2018.1%2014.5%2017.3%2014.9%2016.9%2015.2%2016.6%2015.9%2015.9%2016.6%2015.2%2016.9%2014.9%2017.3%2014.5%2018.1%2013.9%2018.9%2013.3%2019.2%2013%2019.7%2012.7%2020.5%2012.2%2021.4%2011.6%2021.6%2011.5%2022.2%2011.2%2023.1%2010.7%2024%2010.3Z;%20M22.5%207.8%2023.2%207.2%2024.2%207%2025.1%207.4%2025.7%208.1%2026.2%209%2026.8%209.8%2027.3%2010.6%2028.1%2011.2%2029%2011.3%2030%2011%2030.9%2010.6%2031.8%2010.3%2032.8%209.9%2033.7%2010%2034.5%2010.6%2034.9%2011.5%2034.8%2012.5%2034.8%2013.5%2034.7%2014.5%2034.7%2015.5%2035.2%2016.3%2036%2016.8%2037%2017%2037.9%2017.3%2038.9%2017.5%2039.8%2017.9%2040.4%2018.7%2040.5%2019.7%2040%2020.5%2039.3%2021.3%2038.7%2022%2038.1%2022.8%2037.6%2023.7%2037.7%2024.6%2038.3%2025.4%2038.9%2026.2%2039.6%2027%2040.2%2027.7%2040.5%2028.6%2040.3%2029.6%2039.5%2030.3%2038.6%2030.6%2037.6%2030.8%2036.7%2031%2035.7%2031.3%2035%2031.9%2034.6%2032.8%2034.7%2033.8%2034.8%2034.8%2034.8%2035.8%2034.8%2036.8%2034.3%2037.6%2033.4%2038.1%2032.4%2038%2031.5%2037.6%2030.6%2037.2%2029.7%2036.9%2028.7%2036.6%2027.8%2036.9%2027.1%2037.6%2026.6%2038.5%2026.1%2039.3%2025.5%2040.2%2024.8%2040.8%2023.8%2041%2022.9%2040.6%2022.3%2039.9%2021.8%2039%2021.2%2038.2%2020.7%2037.4%2019.9%2036.8%2019%2036.7%2018%2037%2017.1%2037.4%2016.2%2037.7%2015.2%2038.1%2014.3%2038%2013.5%2037.4%2013.1%2036.5%2013.2%2035.5%2013.2%2034.5%2013.3%2033.5%2013.3%2032.5%2012.8%2031.7%2012%2031.2%2011%2031%2010.1%2030.7%209.1%2030.5%208.2%2030.1%207.6%2029.3%207.5%2028.3%208%2027.5%208.7%2026.7%209.3%2026%209.9%2025.2%2010.4%2024.3%2010.3%2023.4%209.7%2022.6%209.1%2021.8%208.4%2021%207.8%2020.3%207.5%2019.4%207.7%2018.4%208.5%2017.7%209.4%2017.4%2010.4%2017.2%2011.3%2017%2012.3%2016.7%2013%2016.1%2013.4%2015.2%2013.3%2014.2%2013.2%2013.2%2013.2%2012.2%2013.2%2011.2%2013.7%2010.4%2014.6%209.9%2015.6%2010%2016.5%2010.4%2017.4%2010.8%2018.3%2011.1%2019.3%2011.4%2020.2%2011.1%2020.9%2010.4%2021.4%209.5%2021.9%208.7Z'%3e%3c/animate%3e%3canimateTransform%20attributeName='transform'%20attributeType='XML'%20type='rotate'%20dur='5s'%20repeatCount='indefinite'%20calcMode='spline'%20keySplines='0.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8;%200.5%200.2%200%200.8'%20keyTimes='0;%200.14;%200.29;%200.43;%200.57;%200.71;%200.86;%201'%20values='0%2024%2024;%20154%2024%2024;%20309%2024%2024;%20463%2024%2024;%20617%2024%2024;%20771%2024%2024;%20926%2024%2024;%201080%2024%2024'%3e%3c/animateTransform%3e%3c/path%3e%3c/svg%3e")}.shape.oval{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='300'%20height='300'%20viewBox='0%200%20300%20300'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M231.309%20231.31C161.705%20300.91%2068.8765%20320.94%2023.9707%20276.03C-20.9352%20231.12%20-0.913322%20138.29%2068.6908%2068.6899C138.295%20-0.91011%20231.123%20-20.9401%20276.029%2023.9699C320.935%2068.8799%20300.913%20161.71%20231.309%20231.31Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='300'%20height='300'%20viewBox='0%200%20300%20300'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M231.309%20231.31C161.705%20300.91%2068.8765%20320.94%2023.9707%20276.03C-20.9352%20231.12%20-0.913322%20138.29%2068.6908%2068.6899C138.295%20-0.91011%20231.123%20-20.9401%20276.029%2023.9699C320.935%2068.8799%20300.913%20161.71%20231.309%20231.31Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.pentagon{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M109.63%2024.3699C125.24%2012.2899%20133.04%206.24994%20141.38%203.24994C153.44%20-1.08006%20166.56%20-1.08006%20178.62%203.24994C186.96%206.24994%20194.76%2012.2899%20210.37%2024.3699L244.51%2050.8L278.63%2075.56C294.82%2087.31%20302.92%2093.1899%20308.33%20100.57C316.15%20111.26%20320.27%20124.39%20319.99%20137.82C319.79%20147.11%20316.58%20156.82%20310.14%20176.23L296.74%20216.66L284.38%20258.08C278.57%20277.52%20275.67%20287.24%20270.6%20294.8C263.26%20305.74%20252.59%20313.78%20240.32%20317.63C231.84%20320.3%20222.06%20320.14%20202.5%20319.83L160%20319.16L117.5%20319.83C97.94%20320.14%2088.16%20320.3%2079.68%20317.63C67.41%20313.78%2056.74%20305.74%2049.4%20294.8C44.33%20287.24%2041.43%20277.52%2035.62%20258.08L23.26%20216.66L9.85994%20176.23C3.41994%20156.82%200.209968%20147.11%200.0099682%20137.82C-0.270032%20124.39%203.85%20111.26%2011.67%20100.57C17.08%2093.1899%2025.18%2087.31%2041.37%2075.56L75.49%2050.8L109.63%2024.3699Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M109.63%2024.3699C125.24%2012.2899%20133.04%206.24994%20141.38%203.24994C153.44%20-1.08006%20166.56%20-1.08006%20178.62%203.24994C186.96%206.24994%20194.76%2012.2899%20210.37%2024.3699L244.51%2050.8L278.63%2075.56C294.82%2087.31%20302.92%2093.1899%20308.33%20100.57C316.15%20111.26%20320.27%20124.39%20319.99%20137.82C319.79%20147.11%20316.58%20156.82%20310.14%20176.23L296.74%20216.66L284.38%20258.08C278.57%20277.52%20275.67%20287.24%20270.6%20294.8C263.26%20305.74%20252.59%20313.78%20240.32%20317.63C231.84%20320.3%20222.06%20320.14%20202.5%20319.83L160%20319.16L117.5%20319.83C97.94%20320.14%2088.16%20320.3%2079.68%20317.63C67.41%20313.78%2056.74%20305.74%2049.4%20294.8C44.33%20287.24%2041.43%20277.52%2035.62%20258.08L23.26%20216.66L9.85994%20176.23C3.41994%20156.82%200.209968%20147.11%200.0099682%20137.82C-0.270032%20124.39%203.85%20111.26%2011.67%20100.57C17.08%2093.1899%2025.18%2087.31%2041.37%2075.56L75.49%2050.8L109.63%2024.3699Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.pill{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='300'%20height='300'%20viewBox='0%200%20300%20300'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M79.86%2037.77C130.22%20-12.59%20211.87%20-12.59%20262.23%2037.77C312.59%2088.13%20312.59%20169.78%20262.23%20220.14L220.14%20262.23C169.78%20312.59%2088.13%20312.59%2037.77%20262.23C-12.59%20211.87%20-12.59%20130.22%2037.77%2079.86L79.86%2037.77Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='300'%20height='300'%20viewBox='0%200%20300%20300'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M79.86%2037.77C130.22%20-12.59%20211.87%20-12.59%20262.23%2037.77C312.59%2088.13%20312.59%20169.78%20262.23%20220.14L220.14%20262.23C169.78%20312.59%2088.13%20312.59%2037.77%20262.23C-12.59%20211.87%20-12.59%20130.22%2037.77%2079.86L79.86%2037.77Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.pixel-circle{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M225.19%200H94.81V20.74H50.37V47.41H23.704V94.8101H0V225.19H23.704V272.59H50.37V299.26H94.81V320H225.19V299.26H269.63V272.59H296.3V225.19H320V94.8101H296.3V47.41H269.63V20.74H225.19V0Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M225.19%200H94.81V20.74H50.37V47.41H23.704V94.8101H0V225.19H23.704V272.59H50.37V299.26H94.81V320H225.19V299.26H269.63V272.59H296.3V225.19H320V94.8101H296.3V47.41H269.63V20.74H225.19V0Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.pixel-triangle{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='248'%20height='320'%20viewBox='0%200%20248%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M55.64%200H0V320H55.64V292.174H98.5601V265.739H143.08V235.13H179.64V210.086H216.21V179.478H248V140.522H216.21V109.912H179.64V84.869H143.08V54.261H98.5601V27.826H55.64V0Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='248'%20height='320'%20viewBox='0%200%20248%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M55.64%200H0V320H55.64V292.174H98.5601V265.739H143.08V235.13H179.64V210.086H216.21V179.478H248V140.522H216.21V109.912H179.64V84.869H143.08V54.261H98.5601V27.826H55.64V0Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.puffy{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='280'%20viewBox='0%200%20320%20280'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M319.98%20138.106C319.72%20116.574%20303.73%2099.333%20284.24%2099.621C283.17%2099.621%20282.11%2099.711%20281.06%2099.838C281.88%2099.098%20282.68%2098.341%20283.44%2097.511C297.4%2082.489%20297.69%2057.782%20284.11%2042.344C283.31%2041.443%20282.52%2040.541%20281.7%2039.675C267.74%2024.653%20245.42%2024.977%20231.82%2040.415C231.07%2041.262%20230.39%2042.146%20229.72%2043.048C229.83%2041.894%20229.9%2040.721%20229.92%2039.531C230.19%2017.998%20214.61%200.307%20195.14%200C194.57%200%20194%200%20193.43%200H192.27C177.84%200%20165.46%209.59399%20160%2023.318C154.54%209.59399%20142.15%200%20127.73%200H126.57C126%200%20125.43%200%20124.86%200C105.39%200.289%2089.8099%2017.98%2090.0699%2039.531C90.0699%2040.721%2090.15%2041.894%2090.26%2043.048C89.6%2042.146%2088.91%2041.262%2088.16%2040.415C74.58%2024.977%2052.24%2024.653%2038.28%2039.675C37.47%2040.559%2036.65%2041.443%2035.87%2042.344C22.29%2057.782%2022.58%2082.471%2036.54%2097.511C37.31%2098.341%2038.1%2099.098%2038.92%2099.838C37.88%2099.711%2036.82%2099.639%2035.74%2099.621C16.27%2099.333%200.28%20116.574%200%20138.106C0%20138.738%200%20139.369%200%20140C0%20140.631%200%20141.262%200%20141.894C0.26%20163.427%2016.26%20180.667%2035.74%20180.379C36.82%20180.379%2037.88%20180.289%2038.92%20180.162C38.1%20180.902%2037.31%20181.659%2036.54%20182.489C22.58%20197.511%2022.29%20222.218%2035.87%20237.656C36.67%20238.557%2037.47%20239.459%2038.28%20240.325C52.24%20255.347%2074.56%20255.023%2088.16%20239.585C88.91%20238.738%2089.6%20237.854%2090.26%20236.952C90.15%20238.106%2090.0799%20239.279%2090.0699%20240.469C89.8099%20262.002%20105.38%20279.711%20124.86%20280C125.43%20280%20126%20280%20126.57%20280H127.73C142.16%20280%20154.54%20270.406%20160%20256.682C165.46%20270.406%20177.85%20280%20192.27%20280H193.43C194%20280%20194.57%20280%20195.14%20280C214.61%20279.711%20230.19%20262.02%20229.93%20240.469C229.93%20239.279%20229.85%20238.106%20229.74%20236.952C230.4%20237.854%20231.09%20238.738%20231.84%20239.585C245.42%20255.023%20267.76%20255.347%20281.72%20240.325C282.53%20239.441%20283.35%20238.557%20284.13%20237.656C297.71%20222.218%20297.42%20197.529%20283.46%20182.489C282.69%20181.659%20281.9%20180.902%20281.08%20180.162C282.12%20180.289%20283.18%20180.361%20284.26%20180.379C303.73%20180.667%20319.74%20163.445%20320%20141.894C320%20141.262%20320%20140.631%20320%20140C320%20139.369%20320%20138.738%20320%20138.106H319.98Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='280'%20viewBox='0%200%20320%20280'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M319.98%20138.106C319.72%20116.574%20303.73%2099.333%20284.24%2099.621C283.17%2099.621%20282.11%2099.711%20281.06%2099.838C281.88%2099.098%20282.68%2098.341%20283.44%2097.511C297.4%2082.489%20297.69%2057.782%20284.11%2042.344C283.31%2041.443%20282.52%2040.541%20281.7%2039.675C267.74%2024.653%20245.42%2024.977%20231.82%2040.415C231.07%2041.262%20230.39%2042.146%20229.72%2043.048C229.83%2041.894%20229.9%2040.721%20229.92%2039.531C230.19%2017.998%20214.61%200.307%20195.14%200C194.57%200%20194%200%20193.43%200H192.27C177.84%200%20165.46%209.59399%20160%2023.318C154.54%209.59399%20142.15%200%20127.73%200H126.57C126%200%20125.43%200%20124.86%200C105.39%200.289%2089.8099%2017.98%2090.0699%2039.531C90.0699%2040.721%2090.15%2041.894%2090.26%2043.048C89.6%2042.146%2088.91%2041.262%2088.16%2040.415C74.58%2024.977%2052.24%2024.653%2038.28%2039.675C37.47%2040.559%2036.65%2041.443%2035.87%2042.344C22.29%2057.782%2022.58%2082.471%2036.54%2097.511C37.31%2098.341%2038.1%2099.098%2038.92%2099.838C37.88%2099.711%2036.82%2099.639%2035.74%2099.621C16.27%2099.333%200.28%20116.574%200%20138.106C0%20138.738%200%20139.369%200%20140C0%20140.631%200%20141.262%200%20141.894C0.26%20163.427%2016.26%20180.667%2035.74%20180.379C36.82%20180.379%2037.88%20180.289%2038.92%20180.162C38.1%20180.902%2037.31%20181.659%2036.54%20182.489C22.58%20197.511%2022.29%20222.218%2035.87%20237.656C36.67%20238.557%2037.47%20239.459%2038.28%20240.325C52.24%20255.347%2074.56%20255.023%2088.16%20239.585C88.91%20238.738%2089.6%20237.854%2090.26%20236.952C90.15%20238.106%2090.0799%20239.279%2090.0699%20240.469C89.8099%20262.002%20105.38%20279.711%20124.86%20280C125.43%20280%20126%20280%20126.57%20280H127.73C142.16%20280%20154.54%20270.406%20160%20256.682C165.46%20270.406%20177.85%20280%20192.27%20280H193.43C194%20280%20194.57%20280%20195.14%20280C214.61%20279.711%20230.19%20262.02%20229.93%20240.469C229.93%20239.279%20229.85%20238.106%20229.74%20236.952C230.4%20237.854%20231.09%20238.738%20231.84%20239.585C245.42%20255.023%20267.76%20255.347%20281.72%20240.325C282.53%20239.441%20283.35%20238.557%20284.13%20237.656C297.71%20222.218%20297.42%20197.529%20283.46%20182.489C282.69%20181.659%20281.9%20180.902%20281.08%20180.162C282.12%20180.289%20283.18%20180.361%20284.26%20180.379C303.73%20180.667%20319.74%20163.445%20320%20141.894C320%20141.262%20320%20140.631%20320%20140C320%20139.369%20320%20138.738%20320%20138.106H319.98Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.puffy-diamond{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M249.4%20249.754C261.48%20237.666%20265.57%20220.608%20261.66%20205.157C277.12%20209.086%20294.2%20205.001%20306.3%20192.902C324.57%20174.636%20324.57%20145.02%20306.3%20126.754C294.27%20114.727%20277.32%20110.619%20261.94%20114.43C265.37%2099.286%20261.19%2082.766%20249.4%2070.975C237.28%2058.86%20220.17%2054.78%20204.7%2058.736C208.8%2043.171%20204.75%2025.903%20192.54%2013.7C174.28%20-4.56699%20144.66%20-4.56699%20126.4%2013.7C114.27%2025.83%20110.19%2042.965%20114.17%2058.458C99%2054.986%2082.43%2059.158%2070.62%2070.975C58.83%2082.767%2054.6499%2099.289%2058.0799%20114.434C42.6899%20110.616%2025.7299%20114.723%2013.6999%20126.754C-4.57006%20145.02%20-4.57006%20174.636%2013.6999%20192.902C25.7999%20205.005%2042.89%20209.089%2058.35%20205.153C54.44%20220.605%2058.53%20237.665%2070.62%20249.754C82.38%20261.521%2098.86%20265.708%20113.98%20262.314C110.33%20277.602%20114.47%20294.371%20126.4%20306.3C144.66%20324.567%20174.28%20324.567%20192.54%20306.3C204.54%20294.301%20208.66%20277.403%20204.89%20262.043C220.32%20265.914%20237.33%20261.817%20249.4%20249.754Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M249.4%20249.754C261.48%20237.666%20265.57%20220.608%20261.66%20205.157C277.12%20209.086%20294.2%20205.001%20306.3%20192.902C324.57%20174.636%20324.57%20145.02%20306.3%20126.754C294.27%20114.727%20277.32%20110.619%20261.94%20114.43C265.37%2099.286%20261.19%2082.766%20249.4%2070.975C237.28%2058.86%20220.17%2054.78%20204.7%2058.736C208.8%2043.171%20204.75%2025.903%20192.54%2013.7C174.28%20-4.56699%20144.66%20-4.56699%20126.4%2013.7C114.27%2025.83%20110.19%2042.965%20114.17%2058.458C99%2054.986%2082.43%2059.158%2070.62%2070.975C58.83%2082.767%2054.6499%2099.289%2058.0799%20114.434C42.6899%20110.616%2025.7299%20114.723%2013.6999%20126.754C-4.57006%20145.02%20-4.57006%20174.636%2013.6999%20192.902C25.7999%20205.005%2042.89%20209.089%2058.35%20205.153C54.44%20220.605%2058.53%20237.665%2070.62%20249.754C82.38%20261.521%2098.86%20265.708%20113.98%20262.314C110.33%20277.602%20114.47%20294.371%20126.4%20306.3C144.66%20324.567%20174.28%20324.567%20192.54%20306.3C204.54%20294.301%20208.66%20277.403%20204.89%20262.043C220.32%20265.914%20237.33%20261.817%20249.4%20249.754Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.semicircle{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='200'%20viewBox='0%200%20320%20200'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M320%20166.92C320%20185.19%20305.19%20200%20286.921%20200H33.0794C14.8102%20200%200%20185.19%200%20166.92V160C-1e-05%2071.63%2071.6344%200%20160%200C248.366%200%20320%2071.63%20320%20160V166.92Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='200'%20viewBox='0%200%20320%20200'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M320%20166.92C320%20185.19%20305.19%20200%20286.921%20200H33.0794C14.8102%20200%200%20185.19%200%20166.92V160C-1e-05%2071.63%2071.6344%200%20160%200C248.366%200%20320%2071.63%20320%20160V166.92Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.sided-cookie4{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='280'%20height='280'%20viewBox='0%200%20280%20280'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M178.73%206.20997C238.87%20-19.91%20299.91%2041.13%20273.79%20101.27L269.47%20111.21C261.5%20129.58%20261.5%20150.42%20269.47%20168.79L273.79%20178.73C299.91%20238.87%20238.87%20299.91%20178.73%20273.79L168.79%20269.47C150.42%20261.5%20129.58%20261.5%20111.21%20269.47L101.27%20273.79C41.128%20299.91%20-19.9141%20238.87%206.20694%20178.73L10.526%20168.79C18.501%20150.42%2018.501%20129.58%2010.526%20111.21L6.20694%20101.27C-19.9141%2041.13%2041.128%20-19.91%20101.27%206.20997L111.21%2010.53C129.58%2018.5%20150.42%2018.5%20168.79%2010.53L178.73%206.20997Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='280'%20height='280'%20viewBox='0%200%20280%20280'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M178.73%206.20997C238.87%20-19.91%20299.91%2041.13%20273.79%20101.27L269.47%20111.21C261.5%20129.58%20261.5%20150.42%20269.47%20168.79L273.79%20178.73C299.91%20238.87%20238.87%20299.91%20178.73%20273.79L168.79%20269.47C150.42%20261.5%20129.58%20261.5%20111.21%20269.47L101.27%20273.79C41.128%20299.91%20-19.9141%20238.87%206.20694%20178.73L10.526%20168.79C18.501%20150.42%2018.501%20129.58%2010.526%20111.21L6.20694%20101.27C-19.9141%2041.13%2041.128%20-19.91%20101.27%206.20997L111.21%2010.53C129.58%2018.5%20150.42%2018.5%20168.79%2010.53L178.73%206.20997Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.sided-cookie6{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='296'%20height='316'%20viewBox='0%200%20296%20316'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M92.1859%2022.5702C123.276%20-7.51981%20172.724%20-7.51981%20203.814%2022.5702C213.328%2031.7702%20224.984%2038.4802%20237.738%2042.0902C279.419%2053.8902%20304.142%2096.5901%20293.552%20138.47C290.312%20151.29%20290.312%20164.71%20293.552%20177.53C304.142%20219.41%20279.419%20262.11%20237.738%20273.91C224.984%20277.52%20213.328%20284.23%20203.814%20293.43C172.724%20323.52%20123.276%20323.52%2092.1859%20293.43C82.6719%20284.23%2071.0159%20277.52%2058.2619%20273.91C16.5809%20262.11%20-8.14208%20219.41%202.44792%20177.53C5.68792%20164.71%205.68792%20151.29%202.44792%20138.47C-8.14208%2096.5901%2016.5809%2053.8902%2058.2619%2042.0902C71.0159%2038.4802%2082.6719%2031.7702%2092.1859%2022.5702Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='296'%20height='316'%20viewBox='0%200%20296%20316'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M92.1859%2022.5702C123.276%20-7.51981%20172.724%20-7.51981%20203.814%2022.5702C213.328%2031.7702%20224.984%2038.4802%20237.738%2042.0902C279.419%2053.8902%20304.142%2096.5901%20293.552%20138.47C290.312%20151.29%20290.312%20164.71%20293.552%20177.53C304.142%20219.41%20279.419%20262.11%20237.738%20273.91C224.984%20277.52%20213.328%20284.23%20203.814%20293.43C172.724%20323.52%20123.276%20323.52%2092.1859%20293.43C82.6719%20284.23%2071.0159%20277.52%2058.2619%20273.91C16.5809%20262.11%20-8.14208%20219.41%202.44792%20177.53C5.68792%20164.71%205.68792%20151.29%202.44792%20138.47C-8.14208%2096.5901%2016.5809%2053.8902%2058.2619%2042.0902C71.0159%2038.4802%2082.6719%2031.7702%2092.1859%2022.5702Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.sided-cookie7{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='316'%20viewBox='0%200%20320%20316'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M112.67%2019.78C116.243%2016.64%20118.029%2015.07%20119.671%2013.8C143.425%20-4.6%20176.575%20-4.6%20200.329%2013.8C201.971%2015.07%20203.757%2016.64%20207.33%2019.78C208.526%2020.84%20209.124%2021.3601%20209.724%2021.8701C218.136%2028.9201%20228.171%2033.7699%20238.92%2035.9599C239.688%2036.1199%20240.471%2036.26%20242.038%2036.54C246.719%2037.38%20249.059%2037.79%20251.075%2038.29C280.234%2045.43%20300.902%2071.4099%20301.364%20101.49C301.396%20103.57%20301.283%20105.95%20301.057%20110.71C300.982%20112.31%20300.944%20113.1%20300.925%20113.89C300.665%20124.88%20303.143%20135.76%20308.136%20145.55C308.493%20146.25%20308.872%20146.95%20309.63%20148.36C311.894%20152.55%20313.026%20154.64%20313.897%20156.53C326.503%20183.83%20319.127%20216.23%20295.949%20235.34C294.347%20236.67%20292.42%20238.06%20288.566%20240.85C287.276%20241.79%20286.63%20242.25%20286.007%20242.73C277.27%20249.38%20270.326%20258.11%20265.803%20268.12C265.48%20268.84%20265.169%20269.57%20264.547%20271.04C262.69%20275.43%20261.761%20277.62%20260.832%20279.48C247.393%20306.38%20217.526%20320.8%20188.162%20314.56C186.132%20314.12%20183.842%20313.48%20179.262%20312.2C177.728%20311.78%20176.962%20311.56%20176.203%20311.37C165.569%20308.67%20154.431%20308.67%20143.797%20311.37C143.038%20311.56%20142.272%20311.78%20140.738%20312.2C136.158%20313.48%20133.868%20314.12%20131.838%20314.56C102.474%20320.8%2072.6071%20306.38%2059.168%20279.48C58.2388%20277.62%2057.3102%20275.43%2055.453%20271.04C54.8311%20269.57%2054.5202%20268.84%2054.1975%20268.12C49.6741%20258.11%2042.7297%20249.38%2033.993%20242.73C33.3696%20242.25%2032.7244%20241.79%2031.434%20240.85C27.5801%20238.06%2025.6532%20236.67%2024.0507%20235.34C0.872993%20216.23%20-6.50347%20183.83%206.10269%20156.53C6.97419%20154.64%208.10619%20152.55%2010.3703%20148.36C11.1283%20146.95%2011.5074%20146.25%2011.8636%20145.55C16.8568%20135.76%2019.3353%20124.88%2019.0745%20113.89C19.0559%20113.1%2019.0182%20112.31%2018.9426%20110.71C18.7168%20105.95%2018.6039%20103.57%2018.6359%20101.49C19.0982%2071.4099%2039.7665%2045.43%2068.9252%2038.29C70.9411%2037.79%2073.2814%2037.38%2077.9618%2036.54C79.5289%2036.26%2080.3125%2036.1199%2081.0795%2035.9599C91.829%2033.7699%20101.864%2028.9201%20110.276%2021.8701C110.876%2021.3601%20111.474%2020.84%20112.67%2019.78Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='316'%20viewBox='0%200%20320%20316'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M112.67%2019.78C116.243%2016.64%20118.029%2015.07%20119.671%2013.8C143.425%20-4.6%20176.575%20-4.6%20200.329%2013.8C201.971%2015.07%20203.757%2016.64%20207.33%2019.78C208.526%2020.84%20209.124%2021.3601%20209.724%2021.8701C218.136%2028.9201%20228.171%2033.7699%20238.92%2035.9599C239.688%2036.1199%20240.471%2036.26%20242.038%2036.54C246.719%2037.38%20249.059%2037.79%20251.075%2038.29C280.234%2045.43%20300.902%2071.4099%20301.364%20101.49C301.396%20103.57%20301.283%20105.95%20301.057%20110.71C300.982%20112.31%20300.944%20113.1%20300.925%20113.89C300.665%20124.88%20303.143%20135.76%20308.136%20145.55C308.493%20146.25%20308.872%20146.95%20309.63%20148.36C311.894%20152.55%20313.026%20154.64%20313.897%20156.53C326.503%20183.83%20319.127%20216.23%20295.949%20235.34C294.347%20236.67%20292.42%20238.06%20288.566%20240.85C287.276%20241.79%20286.63%20242.25%20286.007%20242.73C277.27%20249.38%20270.326%20258.11%20265.803%20268.12C265.48%20268.84%20265.169%20269.57%20264.547%20271.04C262.69%20275.43%20261.761%20277.62%20260.832%20279.48C247.393%20306.38%20217.526%20320.8%20188.162%20314.56C186.132%20314.12%20183.842%20313.48%20179.262%20312.2C177.728%20311.78%20176.962%20311.56%20176.203%20311.37C165.569%20308.67%20154.431%20308.67%20143.797%20311.37C143.038%20311.56%20142.272%20311.78%20140.738%20312.2C136.158%20313.48%20133.868%20314.12%20131.838%20314.56C102.474%20320.8%2072.6071%20306.38%2059.168%20279.48C58.2388%20277.62%2057.3102%20275.43%2055.453%20271.04C54.8311%20269.57%2054.5202%20268.84%2054.1975%20268.12C49.6741%20258.11%2042.7297%20249.38%2033.993%20242.73C33.3696%20242.25%2032.7244%20241.79%2031.434%20240.85C27.5801%20238.06%2025.6532%20236.67%2024.0507%20235.34C0.872993%20216.23%20-6.50347%20183.83%206.10269%20156.53C6.97419%20154.64%208.10619%20152.55%2010.3703%20148.36C11.1283%20146.95%2011.5074%20146.25%2011.8636%20145.55C16.8568%20135.76%2019.3353%20124.88%2019.0745%20113.89C19.0559%20113.1%2019.0182%20112.31%2018.9426%20110.71C18.7168%20105.95%2018.6039%20103.57%2018.6359%20101.49C19.0982%2071.4099%2039.7665%2045.43%2068.9252%2038.29C70.9411%2037.79%2073.2814%2037.38%2077.9618%2036.54C79.5289%2036.26%2080.3125%2036.1199%2081.0795%2035.9599C91.829%2033.7699%20101.864%2028.9201%20110.276%2021.8701C110.876%2021.3601%20111.474%2020.84%20112.67%2019.78Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.sided-cookie9{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M125.26%2013.3798C126.99%2011.9498%20127.85%2011.2398%20128.64%2010.6398C147.19%20-3.55019%20172.81%20-3.55019%20191.36%2010.6398C192.15%2011.2398%20193.01%2011.9498%20194.74%2013.3798C195.51%2014.0098%20195.89%2014.3298%20196.27%2014.6398C205%2021.5798%20215.71%2025.52%20226.82%2025.87C227.3%2025.88%20227.8%2025.8898%20228.79%2025.8998C231.02%2025.9298%20232.14%2025.9399%20233.12%2025.9899C256.36%2027.1799%20275.98%2043.8199%20281.17%2066.7299C281.39%2067.6999%20281.6%2068.8099%20282.02%2071.0199C282.2%2072.0099%20282.29%2072.4999%20282.39%2072.9799C284.66%2083.9799%20290.36%2093.9398%20298.64%20101.42C299.01%20101.75%20299.38%20102.08%20300.14%20102.73C301.83%20104.2%20302.67%20104.94%20303.39%20105.62C320.44%20121.61%20324.89%20147.11%20314.29%20168.03C313.84%20168.92%20313.29%20169.9%20312.2%20171.86C311.71%20172.74%20311.47%20173.18%20311.24%20173.61C305.99%20183.5%20304.01%20194.84%20305.6%20205.95C305.67%20206.44%20305.75%20206.93%20305.91%20207.92C306.27%20210.15%20306.45%20211.26%20306.57%20212.25C309.45%20235.57%20296.64%20257.99%20275.21%20267.13C274.3%20267.52%20273.25%20267.92%20271.17%20268.72C270.24%20269.07%20269.77%20269.25%20269.32%20269.43C259%20273.6%20250.28%20281%20244.42%20290.54C244.17%20290.96%20243.92%20291.39%20243.41%20292.25C242.27%20294.19%20241.7%20295.16%20241.16%20296C228.53%20315.73%20204.46%20324.59%20182.22%20317.67C181.28%20317.38%20180.22%20317.01%20178.12%20316.26C177.18%20315.93%20176.71%20315.76%20176.25%20315.61C165.7%20312.1%20154.3%20312.1%20143.75%20315.61C143.29%20315.76%20142.82%20315.93%20141.88%20316.26C139.78%20317.01%20138.72%20317.38%20137.78%20317.67C115.54%20324.59%2091.47%20315.73%2078.84%20296C78.3%20295.16%2077.73%20294.19%2076.59%20292.25C76.08%20291.39%2075.83%20290.96%2075.58%20290.54C69.72%20281%2061.0001%20273.6%2050.6801%20269.43C50.2301%20269.25%2049.76%20269.07%2048.83%20268.72C46.75%20267.92%2045.7001%20267.52%2044.7901%20267.13C23.3601%20257.99%2010.5501%20235.57%2013.4301%20212.25C13.5501%20211.26%2013.73%20210.15%2014.09%20207.92C14.25%20206.93%2014.3301%20206.44%2014.4001%20205.95C15.9901%20194.84%2014.01%20183.5%208.76004%20173.61C8.53004%20173.18%208.29008%20172.74%207.80008%20171.86C6.71008%20169.9%206.15999%20168.92%205.70999%20168.03C-4.89001%20147.11%20-0.439983%20121.61%2016.61%20105.62C17.33%20104.94%2018.17%20104.2%2019.86%20102.73C20.62%20102.08%2020.99%20101.75%2021.36%20101.42C29.64%2093.9398%2035.34%2083.9799%2037.61%2072.9799C37.71%2072.4999%2037.8%2072.0099%2037.98%2071.0199C38.4%2068.8099%2038.61%2067.6999%2038.83%2066.7299C44.02%2043.8199%2063.64%2027.1799%2086.88%2025.9899C87.86%2025.9399%2088.98%2025.9298%2091.21%2025.8998C92.2%2025.8898%2092.7001%2025.88%2093.1801%2025.87C104.29%2025.52%20115%2021.5798%20123.73%2014.6398C124.11%2014.3298%20124.49%2014.0098%20125.26%2013.3798Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M125.26%2013.3798C126.99%2011.9498%20127.85%2011.2398%20128.64%2010.6398C147.19%20-3.55019%20172.81%20-3.55019%20191.36%2010.6398C192.15%2011.2398%20193.01%2011.9498%20194.74%2013.3798C195.51%2014.0098%20195.89%2014.3298%20196.27%2014.6398C205%2021.5798%20215.71%2025.52%20226.82%2025.87C227.3%2025.88%20227.8%2025.8898%20228.79%2025.8998C231.02%2025.9298%20232.14%2025.9399%20233.12%2025.9899C256.36%2027.1799%20275.98%2043.8199%20281.17%2066.7299C281.39%2067.6999%20281.6%2068.8099%20282.02%2071.0199C282.2%2072.0099%20282.29%2072.4999%20282.39%2072.9799C284.66%2083.9799%20290.36%2093.9398%20298.64%20101.42C299.01%20101.75%20299.38%20102.08%20300.14%20102.73C301.83%20104.2%20302.67%20104.94%20303.39%20105.62C320.44%20121.61%20324.89%20147.11%20314.29%20168.03C313.84%20168.92%20313.29%20169.9%20312.2%20171.86C311.71%20172.74%20311.47%20173.18%20311.24%20173.61C305.99%20183.5%20304.01%20194.84%20305.6%20205.95C305.67%20206.44%20305.75%20206.93%20305.91%20207.92C306.27%20210.15%20306.45%20211.26%20306.57%20212.25C309.45%20235.57%20296.64%20257.99%20275.21%20267.13C274.3%20267.52%20273.25%20267.92%20271.17%20268.72C270.24%20269.07%20269.77%20269.25%20269.32%20269.43C259%20273.6%20250.28%20281%20244.42%20290.54C244.17%20290.96%20243.92%20291.39%20243.41%20292.25C242.27%20294.19%20241.7%20295.16%20241.16%20296C228.53%20315.73%20204.46%20324.59%20182.22%20317.67C181.28%20317.38%20180.22%20317.01%20178.12%20316.26C177.18%20315.93%20176.71%20315.76%20176.25%20315.61C165.7%20312.1%20154.3%20312.1%20143.75%20315.61C143.29%20315.76%20142.82%20315.93%20141.88%20316.26C139.78%20317.01%20138.72%20317.38%20137.78%20317.67C115.54%20324.59%2091.47%20315.73%2078.84%20296C78.3%20295.16%2077.73%20294.19%2076.59%20292.25C76.08%20291.39%2075.83%20290.96%2075.58%20290.54C69.72%20281%2061.0001%20273.6%2050.6801%20269.43C50.2301%20269.25%2049.76%20269.07%2048.83%20268.72C46.75%20267.92%2045.7001%20267.52%2044.7901%20267.13C23.3601%20257.99%2010.5501%20235.57%2013.4301%20212.25C13.5501%20211.26%2013.73%20210.15%2014.09%20207.92C14.25%20206.93%2014.3301%20206.44%2014.4001%20205.95C15.9901%20194.84%2014.01%20183.5%208.76004%20173.61C8.53004%20173.18%208.29008%20172.74%207.80008%20171.86C6.71008%20169.9%206.15999%20168.92%205.70999%20168.03C-4.89001%20147.11%20-0.439983%20121.61%2016.61%20105.62C17.33%20104.94%2018.17%20104.2%2019.86%20102.73C20.62%20102.08%2020.99%20101.75%2021.36%20101.42C29.64%2093.9398%2035.34%2083.9799%2037.61%2072.9799C37.71%2072.4999%2037.8%2072.0099%2037.98%2071.0199C38.4%2068.8099%2038.61%2067.6999%2038.83%2066.7299C44.02%2043.8199%2063.64%2027.1799%2086.88%2025.9899C87.86%2025.9399%2088.98%2025.9298%2091.21%2025.8998C92.2%2025.8898%2092.7001%2025.88%2093.1801%2025.87C104.29%2025.52%20115%2021.5798%20123.73%2014.6398C124.11%2014.3298%20124.49%2014.0098%20125.26%2013.3798Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.sided-cookie12{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M136.7%209.85021C137.24%209.32021%20137.51%209.05019%20137.74%208.83019C150.25%20-2.93981%20169.75%20-2.93981%20182.26%208.83019C182.49%209.05019%20182.76%209.32021%20183.3%209.85021C183.63%2010.1602%20183.79%2010.3201%20183.94%2010.4701C191.95%2018.1101%20203.28%2021.1401%20214.03%2018.5301C214.24%2018.4801%20214.46%2018.4202%20214.9%2018.3102C215.63%2018.1202%20216%2018.0301%20216.31%2017.9501C233.02%2014.0101%20249.92%2023.7601%20254.86%2040.2101C254.95%2040.5201%20255.05%2040.8802%20255.26%2041.6102C255.38%2042.0502%20255.44%2042.2701%20255.5%2042.4801C258.61%2053.0901%20266.91%2061.3901%20277.52%2064.5001C277.73%2064.5601%20277.95%2064.6201%20278.39%2064.7401C279.12%2064.9501%20279.48%2065.05%20279.79%2065.14C296.24%2070.08%20305.99%2086.98%20302.05%20103.69C301.97%20104%20301.88%20104.37%20301.69%20105.1C301.58%20105.54%20301.52%20105.76%20301.47%20105.97C298.86%20116.72%20301.89%20128.05%20309.53%20136.06C309.68%20136.21%20309.84%20136.37%20310.15%20136.7C310.68%20137.24%20310.95%20137.51%20311.17%20137.74C322.94%20150.25%20322.94%20169.75%20311.17%20182.26C310.95%20182.49%20310.68%20182.76%20310.15%20183.3C309.84%20183.63%20309.68%20183.79%20309.53%20183.94C301.89%20191.95%20298.86%20203.28%20301.47%20214.03C301.52%20214.24%20301.58%20214.46%20301.69%20214.9C301.88%20215.63%20301.97%20216%20302.05%20216.31C305.99%20233.02%20296.24%20249.92%20279.79%20254.86C279.48%20254.95%20279.12%20255.05%20278.39%20255.26C277.95%20255.38%20277.73%20255.44%20277.52%20255.5C266.91%20258.61%20258.61%20266.91%20255.5%20277.52C255.44%20277.73%20255.38%20277.95%20255.26%20278.39C255.05%20279.12%20254.95%20279.48%20254.86%20279.79C249.92%20296.24%20233.02%20305.99%20216.31%20302.05C216%20301.97%20215.63%20301.88%20214.9%20301.69C214.46%20301.58%20214.24%20301.52%20214.03%20301.47C203.28%20298.86%20191.95%20301.89%20183.94%20309.53C183.79%20309.68%20183.63%20309.84%20183.3%20310.15C182.76%20310.68%20182.49%20310.95%20182.26%20311.17C169.75%20322.94%20150.25%20322.94%20137.74%20311.17C137.51%20310.95%20137.24%20310.68%20136.7%20310.15C136.37%20309.84%20136.21%20309.68%20136.06%20309.53C128.05%20301.89%20116.72%20298.86%20105.97%20301.47C105.76%20301.52%20105.54%20301.58%20105.1%20301.69C104.37%20301.88%20104%20301.97%20103.69%20302.05C86.9799%20305.99%2070.08%20296.24%2065.14%20279.79C65.05%20279.48%2064.95%20279.12%2064.74%20278.39C64.62%20277.95%2064.56%20277.73%2064.5%20277.52C61.39%20266.91%2053.09%20258.61%2042.48%20255.5C42.27%20255.44%2042.05%20255.38%2041.61%20255.26C40.88%20255.05%2040.5199%20254.95%2040.2099%20254.86C23.7599%20249.92%2014.0099%20233.02%2017.9499%20216.31C18.0299%20216%2018.12%20215.63%2018.31%20214.9C18.42%20214.46%2018.48%20214.24%2018.53%20214.03C21.14%20203.28%2018.11%20191.95%2010.47%20183.94C10.32%20183.79%2010.16%20183.63%209.84996%20183.3C9.31996%20182.76%209.04994%20182.49%208.82994%20182.26C-2.94006%20169.75%20-2.94006%20150.25%208.82994%20137.74C9.04994%20137.51%209.31996%20137.24%209.84996%20136.7C10.16%20136.37%2010.32%20136.21%2010.47%20136.06C18.11%20128.05%2021.14%20116.72%2018.53%20105.97C18.48%20105.76%2018.42%20105.54%2018.31%20105.1C18.12%20104.37%2018.0299%20104%2017.9499%20103.69C14.0099%2086.98%2023.7599%2070.08%2040.2099%2065.14C40.5199%2065.05%2040.88%2064.9501%2041.61%2064.7401C42.05%2064.6201%2042.27%2064.5601%2042.48%2064.5001C53.09%2061.3901%2061.39%2053.0901%2064.5%2042.4801C64.56%2042.2701%2064.62%2042.0502%2064.74%2041.6102C64.95%2040.8802%2065.05%2040.5201%2065.14%2040.2101C70.08%2023.7601%2086.9799%2014.0101%20103.69%2017.9501C104%2018.0301%20104.37%2018.1202%20105.1%2018.3102C105.54%2018.4202%20105.76%2018.4801%20105.97%2018.5301C116.72%2021.1401%20128.05%2018.1101%20136.06%2010.4701C136.21%2010.3201%20136.37%2010.1602%20136.7%209.85021Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M136.7%209.85021C137.24%209.32021%20137.51%209.05019%20137.74%208.83019C150.25%20-2.93981%20169.75%20-2.93981%20182.26%208.83019C182.49%209.05019%20182.76%209.32021%20183.3%209.85021C183.63%2010.1602%20183.79%2010.3201%20183.94%2010.4701C191.95%2018.1101%20203.28%2021.1401%20214.03%2018.5301C214.24%2018.4801%20214.46%2018.4202%20214.9%2018.3102C215.63%2018.1202%20216%2018.0301%20216.31%2017.9501C233.02%2014.0101%20249.92%2023.7601%20254.86%2040.2101C254.95%2040.5201%20255.05%2040.8802%20255.26%2041.6102C255.38%2042.0502%20255.44%2042.2701%20255.5%2042.4801C258.61%2053.0901%20266.91%2061.3901%20277.52%2064.5001C277.73%2064.5601%20277.95%2064.6201%20278.39%2064.7401C279.12%2064.9501%20279.48%2065.05%20279.79%2065.14C296.24%2070.08%20305.99%2086.98%20302.05%20103.69C301.97%20104%20301.88%20104.37%20301.69%20105.1C301.58%20105.54%20301.52%20105.76%20301.47%20105.97C298.86%20116.72%20301.89%20128.05%20309.53%20136.06C309.68%20136.21%20309.84%20136.37%20310.15%20136.7C310.68%20137.24%20310.95%20137.51%20311.17%20137.74C322.94%20150.25%20322.94%20169.75%20311.17%20182.26C310.95%20182.49%20310.68%20182.76%20310.15%20183.3C309.84%20183.63%20309.68%20183.79%20309.53%20183.94C301.89%20191.95%20298.86%20203.28%20301.47%20214.03C301.52%20214.24%20301.58%20214.46%20301.69%20214.9C301.88%20215.63%20301.97%20216%20302.05%20216.31C305.99%20233.02%20296.24%20249.92%20279.79%20254.86C279.48%20254.95%20279.12%20255.05%20278.39%20255.26C277.95%20255.38%20277.73%20255.44%20277.52%20255.5C266.91%20258.61%20258.61%20266.91%20255.5%20277.52C255.44%20277.73%20255.38%20277.95%20255.26%20278.39C255.05%20279.12%20254.95%20279.48%20254.86%20279.79C249.92%20296.24%20233.02%20305.99%20216.31%20302.05C216%20301.97%20215.63%20301.88%20214.9%20301.69C214.46%20301.58%20214.24%20301.52%20214.03%20301.47C203.28%20298.86%20191.95%20301.89%20183.94%20309.53C183.79%20309.68%20183.63%20309.84%20183.3%20310.15C182.76%20310.68%20182.49%20310.95%20182.26%20311.17C169.75%20322.94%20150.25%20322.94%20137.74%20311.17C137.51%20310.95%20137.24%20310.68%20136.7%20310.15C136.37%20309.84%20136.21%20309.68%20136.06%20309.53C128.05%20301.89%20116.72%20298.86%20105.97%20301.47C105.76%20301.52%20105.54%20301.58%20105.1%20301.69C104.37%20301.88%20104%20301.97%20103.69%20302.05C86.9799%20305.99%2070.08%20296.24%2065.14%20279.79C65.05%20279.48%2064.95%20279.12%2064.74%20278.39C64.62%20277.95%2064.56%20277.73%2064.5%20277.52C61.39%20266.91%2053.09%20258.61%2042.48%20255.5C42.27%20255.44%2042.05%20255.38%2041.61%20255.26C40.88%20255.05%2040.5199%20254.95%2040.2099%20254.86C23.7599%20249.92%2014.0099%20233.02%2017.9499%20216.31C18.0299%20216%2018.12%20215.63%2018.31%20214.9C18.42%20214.46%2018.48%20214.24%2018.53%20214.03C21.14%20203.28%2018.11%20191.95%2010.47%20183.94C10.32%20183.79%2010.16%20183.63%209.84996%20183.3C9.31996%20182.76%209.04994%20182.49%208.82994%20182.26C-2.94006%20169.75%20-2.94006%20150.25%208.82994%20137.74C9.04994%20137.51%209.31996%20137.24%209.84996%20136.7C10.16%20136.37%2010.32%20136.21%2010.47%20136.06C18.11%20128.05%2021.14%20116.72%2018.53%20105.97C18.48%20105.76%2018.42%20105.54%2018.31%20105.1C18.12%20104.37%2018.0299%20104%2017.9499%20103.69C14.0099%2086.98%2023.7599%2070.08%2040.2099%2065.14C40.5199%2065.05%2040.88%2064.9501%2041.61%2064.7401C42.05%2064.6201%2042.27%2064.5601%2042.48%2064.5001C53.09%2061.3901%2061.39%2053.0901%2064.5%2042.4801C64.56%2042.2701%2064.62%2042.0502%2064.74%2041.6102C64.95%2040.8802%2065.05%2040.5201%2065.14%2040.2101C70.08%2023.7601%2086.9799%2014.0101%20103.69%2017.9501C104%2018.0301%20104.37%2018.1202%20105.1%2018.3102C105.54%2018.4202%20105.76%2018.4801%20105.97%2018.5301C116.72%2021.1401%20128.05%2018.1101%20136.06%2010.4701C136.21%2010.3201%20136.37%2010.1602%20136.7%209.85021Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.slanted{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='300'%20viewBox='0%200%20320%20300'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15.715%2080.54C18.289%2055.96%2019.576%2043.67%2024.303%2033.978C31.142%2019.945%2043.077%209.11002%2057.628%203.72302C67.683%202.24113e-05%2079.933%200%20104.432%200H228.137C257.764%200%20272.578%203.8147e-06%20283.887%204.854C300.261%2011.882%20312.72%2025.849%20317.927%2043.02C321.523%2054.87%20319.967%2069.73%20316.854%2099.46L304.285%20219.46C301.711%20244.04%20300.424%20256.33%20295.697%20266.02C288.858%20280.05%20276.923%20290.89%20262.372%20296.28C252.317%20300%20240.067%20300%20215.568%20300H91.863C62.236%20300%2047.422%20300%2036.113%20295.15C19.739%20288.12%207.28%20274.15%202.073%20256.98C-1.524%20245.13%200.0330019%20230.27%203.146%20200.54L15.715%2080.54Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='300'%20viewBox='0%200%20320%20300'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M15.715%2080.54C18.289%2055.96%2019.576%2043.67%2024.303%2033.978C31.142%2019.945%2043.077%209.11002%2057.628%203.72302C67.683%202.24113e-05%2079.933%200%20104.432%200H228.137C257.764%200%20272.578%203.8147e-06%20283.887%204.854C300.261%2011.882%20312.72%2025.849%20317.927%2043.02C321.523%2054.87%20319.967%2069.73%20316.854%2099.46L304.285%20219.46C301.711%20244.04%20300.424%20256.33%20295.697%20266.02C288.858%20280.05%20276.923%20290.89%20262.372%20296.28C252.317%20300%20240.067%20300%20215.568%20300H91.863C62.236%20300%2047.422%20300%2036.113%20295.15C19.739%20288.12%207.28%20274.15%202.073%20256.98C-1.524%20245.13%200.0330019%20230.27%203.146%20200.54L15.715%2080.54Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.soft-boom{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M174.94%2084.95C197.48%20-28.315%20122.55%20-28.315%20145.08%2084.95C122.55%20-28.315%2053.327%200.35202%20117.49%2096.38C53.327%200.35202%200.35202%2053.33%2096.38%20117.49C0.35202%2053.33%20-28.315%20122.55%2084.95%20145.07C-28.315%20122.54%20-28.315%20197.46%2084.95%20174.93C-28.315%20197.46%200.36602%20266.67%2096.38%20202.51C0.36602%20266.67%2053.34%20319.65%20117.49%20223.62C53.327%20319.63%20122.55%20348.3%20145.07%20235.05C122.54%20348.32%20197.46%20348.32%20174.93%20235.05C197.46%20348.32%20266.67%20319.63%20202.51%20223.62C266.67%20319.63%20319.65%20266.66%20223.62%20202.51C319.63%20266.67%20348.3%20197.45%20235.05%20174.93C348.32%20197.46%20348.32%20122.54%20235.05%20145.07C348.32%20122.54%20319.63%2053.33%20223.62%20117.49C319.63%2053.33%20266.66%200.35202%20202.51%2096.38C266.67%200.36602%20197.45%20-28.302%20174.93%2084.95H174.94Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M174.94%2084.95C197.48%20-28.315%20122.55%20-28.315%20145.08%2084.95C122.55%20-28.315%2053.327%200.35202%20117.49%2096.38C53.327%200.35202%200.35202%2053.33%2096.38%20117.49C0.35202%2053.33%20-28.315%20122.55%2084.95%20145.07C-28.315%20122.54%20-28.315%20197.46%2084.95%20174.93C-28.315%20197.46%200.36602%20266.67%2096.38%20202.51C0.36602%20266.67%2053.34%20319.65%20117.49%20223.62C53.327%20319.63%20122.55%20348.3%20145.07%20235.05C122.54%20348.32%20197.46%20348.32%20174.93%20235.05C197.46%20348.32%20266.67%20319.63%20202.51%20223.62C266.67%20319.63%20319.65%20266.66%20223.62%20202.51C319.63%20266.67%20348.3%20197.45%20235.05%20174.93C348.32%20197.46%20348.32%20122.54%20235.05%20145.07C348.32%20122.54%20319.63%2053.33%20223.62%20117.49C319.63%2053.33%20266.66%200.35202%20202.51%2096.38C266.67%200.36602%20197.45%20-28.302%20174.93%2084.95H174.94Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.soft-burst{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M145.15%207.90401C151.98%20-2.63499%20168.02%20-2.63499%20174.85%207.90401L191.24%2033.165C195.73%2040.093%20204.8%2042.91%20212.69%2039.83L241.47%2028.603C253.48%2023.92%20266.45%2032.932%20265.51%2045.3L263.24%2074.95C262.61%2083.08%20268.21%2090.45%20276.49%2092.4L306.68%2099.49C319.27%20102.45%20324.23%20117.03%20315.86%20126.51L295.8%20149.21C290.3%20155.44%20290.3%20164.56%20295.8%20170.79L315.86%20193.49C324.23%20202.97%20319.27%20217.55%20306.68%20220.51L276.49%20227.6C268.21%20229.55%20262.61%20236.92%20263.24%20245.05L265.51%20274.7C266.45%20287.07%20253.48%20296.08%20241.47%20291.4L212.69%20280.17C204.8%20277.09%20195.73%20279.91%20191.24%20286.84L174.85%20312.1C168.02%20322.63%20151.98%20322.63%20145.15%20312.1L128.76%20286.84C124.27%20279.91%20115.2%20277.09%20107.31%20280.17L78.53%20291.4C66.52%20296.08%2053.55%20287.07%2054.49%20274.7L56.76%20245.05C57.39%20236.92%2051.79%20229.55%2043.51%20227.6L13.32%20220.51C0.729964%20217.55%20-4.22997%20202.97%204.14003%20193.49L24.2%20170.79C29.7%20164.56%2029.7%20155.44%2024.2%20149.21L4.14003%20126.51C-4.22997%20117.03%200.729964%20102.45%2013.32%2099.49L43.51%2092.4C51.79%2090.45%2057.39%2083.08%2056.76%2074.95L54.49%2045.3C53.55%2032.932%2066.52%2023.92%2078.53%2028.603L107.31%2039.83C115.2%2042.91%20124.27%2040.093%20128.76%2033.165L145.15%207.90401Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M145.15%207.90401C151.98%20-2.63499%20168.02%20-2.63499%20174.85%207.90401L191.24%2033.165C195.73%2040.093%20204.8%2042.91%20212.69%2039.83L241.47%2028.603C253.48%2023.92%20266.45%2032.932%20265.51%2045.3L263.24%2074.95C262.61%2083.08%20268.21%2090.45%20276.49%2092.4L306.68%2099.49C319.27%20102.45%20324.23%20117.03%20315.86%20126.51L295.8%20149.21C290.3%20155.44%20290.3%20164.56%20295.8%20170.79L315.86%20193.49C324.23%20202.97%20319.27%20217.55%20306.68%20220.51L276.49%20227.6C268.21%20229.55%20262.61%20236.92%20263.24%20245.05L265.51%20274.7C266.45%20287.07%20253.48%20296.08%20241.47%20291.4L212.69%20280.17C204.8%20277.09%20195.73%20279.91%20191.24%20286.84L174.85%20312.1C168.02%20322.63%20151.98%20322.63%20145.15%20312.1L128.76%20286.84C124.27%20279.91%20115.2%20277.09%20107.31%20280.17L78.53%20291.4C66.52%20296.08%2053.55%20287.07%2054.49%20274.7L56.76%20245.05C57.39%20236.92%2051.79%20229.55%2043.51%20227.6L13.32%20220.51C0.729964%20217.55%20-4.22997%20202.97%204.14003%20193.49L24.2%20170.79C29.7%20164.56%2029.7%20155.44%2024.2%20149.21L4.14003%20126.51C-4.22997%20117.03%200.729964%20102.45%2013.32%2099.49L43.51%2092.4C51.79%2090.45%2057.39%2083.08%2056.76%2074.95L54.49%2045.3C53.55%2032.932%2066.52%2023.92%2078.53%2028.603L107.31%2039.83C115.2%2042.91%20124.27%2040.093%20128.76%2033.165L145.15%207.90401Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.square{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M320%20172C320%20216.72%20320%20239.08%20312.98%20256.81C302.81%20282.49%20282.49%20302.81%20256.81%20312.98C239.08%20320%20216.72%20320%20172%20320H148C103.28%20320%2080.9199%20320%2063.1899%20312.98C37.5099%20302.81%2017.19%20282.49%207.02002%20256.81C1.95503e-05%20239.08%200%20216.72%200%20172V148C0%20103.28%201.95503e-05%2080.92%207.02002%2063.19C17.19%2037.515%2037.5099%2017.187%2063.1899%207.02197C80.9199%20-2.71797e-05%20103.28%200%20148%200H172C216.72%200%20239.08%20-2.71797e-05%20256.81%207.02197C282.49%2017.187%20302.81%2037.515%20312.98%2063.19C320%2080.92%20320%20103.28%20320%20148V172Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M320%20172C320%20216.72%20320%20239.08%20312.98%20256.81C302.81%20282.49%20282.49%20302.81%20256.81%20312.98C239.08%20320%20216.72%20320%20172%20320H148C103.28%20320%2080.9199%20320%2063.1899%20312.98C37.5099%20302.81%2017.19%20282.49%207.02002%20256.81C1.95503e-05%20239.08%200%20216.72%200%20172V148C0%20103.28%201.95503e-05%2080.92%207.02002%2063.19C17.19%2037.515%2037.5099%2017.187%2063.1899%207.02197C80.9199%20-2.71797e-05%20103.28%200%20148%200H172C216.72%200%20239.08%20-2.71797e-05%20256.81%207.02197C282.49%2017.187%20302.81%2037.515%20312.98%2063.19C320%2080.92%20320%20103.28%20320%20148V172Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.sunny{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='340'%20height='340'%20viewBox='0%200%20340%20340'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M261.856%2041.24C272.431%2041.96%20277.718%2042.32%20281.991%2044.18C288.175%2046.89%20293.111%2051.83%20295.816%2058.01C297.685%2062.28%20298.044%2067.57%20298.762%2078.14L300.402%20102.27C300.693%20106.55%20300.838%20108.69%20301.303%20110.73C301.975%20113.68%20303.142%20116.5%20304.754%20119.06C305.869%20120.84%20307.279%20122.45%20310.097%20125.68L326.001%20143.9C332.97%20151.89%20336.455%20155.88%20338.155%20160.22C340.615%20166.51%20340.615%20173.49%20338.155%20179.78C336.455%20184.12%20332.97%20188.11%20326.001%20196.1L310.097%20214.32C307.279%20217.55%20305.869%20219.16%20304.754%20220.94C303.142%20223.5%20301.975%20226.32%20301.303%20229.27C300.838%20231.31%20300.693%20233.45%20300.402%20237.73L298.762%20261.86C298.044%20272.43%20297.685%20277.72%20295.816%20281.99C293.111%20288.17%20288.175%20293.11%20281.991%20295.82C277.718%20297.68%20272.431%20298.04%20261.856%20298.76L237.725%20300.4C233.448%20300.69%20231.31%20300.84%20229.267%20301.3C226.316%20301.97%20223.499%20303.14%20220.937%20304.75C219.164%20305.87%20217.549%20307.28%20214.319%20310.1L196.097%20326C188.111%20332.97%20184.119%20336.45%20179.775%20338.15C173.491%20340.62%20166.509%20340.62%20160.225%20338.15C155.881%20336.45%20151.889%20332.97%20143.903%20326L125.681%20310.1C122.451%20307.28%20120.836%20305.87%20119.063%20304.75C116.501%20303.14%20113.684%20301.97%20110.733%20301.3C108.69%20300.84%20106.552%20300.69%20102.275%20300.4L78.1438%20298.76C67.5694%20298.04%2062.2822%20297.68%2058.0088%20295.82C51.8252%20293.11%2046.8887%20288.17%2044.1844%20281.99C42.3154%20277.72%2041.9561%20272.43%2041.2375%20261.86L39.5977%20237.73C39.3071%20233.45%2039.1618%20231.31%2038.6969%20229.27C38.0251%20226.32%2036.8584%20223.5%2035.2463%20220.94C34.1306%20219.16%2032.7213%20217.55%2029.9027%20214.32L13.999%20196.1C7.02996%20188.11%203.54542%20184.12%201.84516%20179.78C-0.615054%20173.49%20-0.615053%20166.51%201.84516%20160.22C3.54542%20155.88%207.02996%20151.89%2013.999%20143.9L29.9027%20125.68C32.7213%20122.45%2034.1306%20120.84%2035.2463%20119.06C36.8584%20116.5%2038.0251%20113.68%2038.6969%20110.73C39.1618%20108.69%2039.3071%20106.55%2039.5977%20102.27L41.2375%2078.14C41.9561%2067.57%2042.3154%2062.28%2044.1844%2058.01C46.8887%2051.83%2051.8252%2046.89%2058.0088%2044.18C62.2823%2042.32%2067.5694%2041.96%2078.1438%2041.24L102.275%2039.5999C106.552%2039.3099%20108.69%2039.1599%20110.733%2038.6999C113.684%2038.0299%20116.501%2036.86%20119.063%2035.25C120.836%2034.13%20122.451%2032.72%20125.681%2029.9L143.903%2014C151.889%207.02996%20155.881%203.54994%20160.225%201.84994C166.509%20-0.620064%20173.491%20-0.620064%20179.775%201.84994C184.119%203.54994%20188.111%207.02996%20196.097%2014L214.319%2029.9C217.549%2032.72%20219.164%2034.13%20220.937%2035.25C223.499%2036.86%20226.316%2038.0299%20229.267%2038.6999C231.31%2039.1599%20233.448%2039.3099%20237.725%2039.5999L261.856%2041.24Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='340'%20height='340'%20viewBox='0%200%20340%20340'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M261.856%2041.24C272.431%2041.96%20277.718%2042.32%20281.991%2044.18C288.175%2046.89%20293.111%2051.83%20295.816%2058.01C297.685%2062.28%20298.044%2067.57%20298.762%2078.14L300.402%20102.27C300.693%20106.55%20300.838%20108.69%20301.303%20110.73C301.975%20113.68%20303.142%20116.5%20304.754%20119.06C305.869%20120.84%20307.279%20122.45%20310.097%20125.68L326.001%20143.9C332.97%20151.89%20336.455%20155.88%20338.155%20160.22C340.615%20166.51%20340.615%20173.49%20338.155%20179.78C336.455%20184.12%20332.97%20188.11%20326.001%20196.1L310.097%20214.32C307.279%20217.55%20305.869%20219.16%20304.754%20220.94C303.142%20223.5%20301.975%20226.32%20301.303%20229.27C300.838%20231.31%20300.693%20233.45%20300.402%20237.73L298.762%20261.86C298.044%20272.43%20297.685%20277.72%20295.816%20281.99C293.111%20288.17%20288.175%20293.11%20281.991%20295.82C277.718%20297.68%20272.431%20298.04%20261.856%20298.76L237.725%20300.4C233.448%20300.69%20231.31%20300.84%20229.267%20301.3C226.316%20301.97%20223.499%20303.14%20220.937%20304.75C219.164%20305.87%20217.549%20307.28%20214.319%20310.1L196.097%20326C188.111%20332.97%20184.119%20336.45%20179.775%20338.15C173.491%20340.62%20166.509%20340.62%20160.225%20338.15C155.881%20336.45%20151.889%20332.97%20143.903%20326L125.681%20310.1C122.451%20307.28%20120.836%20305.87%20119.063%20304.75C116.501%20303.14%20113.684%20301.97%20110.733%20301.3C108.69%20300.84%20106.552%20300.69%20102.275%20300.4L78.1438%20298.76C67.5694%20298.04%2062.2822%20297.68%2058.0088%20295.82C51.8252%20293.11%2046.8887%20288.17%2044.1844%20281.99C42.3154%20277.72%2041.9561%20272.43%2041.2375%20261.86L39.5977%20237.73C39.3071%20233.45%2039.1618%20231.31%2038.6969%20229.27C38.0251%20226.32%2036.8584%20223.5%2035.2463%20220.94C34.1306%20219.16%2032.7213%20217.55%2029.9027%20214.32L13.999%20196.1C7.02996%20188.11%203.54542%20184.12%201.84516%20179.78C-0.615054%20173.49%20-0.615053%20166.51%201.84516%20160.22C3.54542%20155.88%207.02996%20151.89%2013.999%20143.9L29.9027%20125.68C32.7213%20122.45%2034.1306%20120.84%2035.2463%20119.06C36.8584%20116.5%2038.0251%20113.68%2038.6969%20110.73C39.1618%20108.69%2039.3071%20106.55%2039.5977%20102.27L41.2375%2078.14C41.9561%2067.57%2042.3154%2062.28%2044.1844%2058.01C46.8887%2051.83%2051.8252%2046.89%2058.0088%2044.18C62.2823%2042.32%2067.5694%2041.96%2078.1438%2041.24L102.275%2039.5999C106.552%2039.3099%20108.69%2039.1599%20110.733%2038.6999C113.684%2038.0299%20116.501%2036.86%20119.063%2035.25C120.836%2034.13%20122.451%2032.72%20125.681%2029.9L143.903%2014C151.889%207.02996%20155.881%203.54994%20160.225%201.84994C166.509%20-0.620064%20173.491%20-0.620064%20179.775%201.84994C184.119%203.54994%20188.111%207.02996%20196.097%2014L214.319%2029.9C217.549%2032.72%20219.164%2034.13%20220.937%2035.25C223.499%2036.86%20226.316%2038.0299%20229.267%2038.6999C231.31%2039.1599%20233.448%2039.3099%20237.725%2039.5999L261.856%2041.24Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.triangle{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='316'%20height='286'%20viewBox='0%200%20316%20286'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M104.461%2051.1999C119.597%2024.8199%20127.165%2011.63%20136.342%206.06C149.648%20-2.02%20166.352%20-2.02%20179.658%206.06C188.835%2011.63%20196.403%2024.8199%20211.539%2051.1999L293.309%20193.72C308.3%20219.85%20315.795%20232.91%20315.993%20243.58C316.28%20259.06%20307.949%20273.42%20294.364%20280.86C284.994%20286%20269.919%20286%20239.77%20286H76.2299C46.0809%20286%2031.0059%20286%2021.6359%20280.86C8.04994%20273.42%20-0.280059%20259.06%200.00694063%20243.58C0.204941%20232.91%207.69996%20219.85%2022.691%20193.72L104.461%2051.1999Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='316'%20height='286'%20viewBox='0%200%20316%20286'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M104.461%2051.1999C119.597%2024.8199%20127.165%2011.63%20136.342%206.06C149.648%20-2.02%20166.352%20-2.02%20179.658%206.06C188.835%2011.63%20196.403%2024.8199%20211.539%2051.1999L293.309%20193.72C308.3%20219.85%20315.795%20232.91%20315.993%20243.58C316.28%20259.06%20307.949%20273.42%20294.364%20280.86C284.994%20286%20269.919%20286%20239.77%20286H76.2299C46.0809%20286%2031.0059%20286%2021.6359%20280.86C8.04994%20273.42%20-0.280059%20259.06%200.00694063%20243.58C0.204941%20232.91%207.69996%20219.85%2022.691%20193.72L104.461%2051.1999Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}.shape.very-sunny{-webkit-mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M136.72%2013.1899C147.26%20-4.40006%20172.74%20-4.40006%20183.28%2013.1899L195.12%2032.96C201.27%2043.21%20213.4%2048.24%20224.99%2045.33L247.35%2039.73C267.24%2034.75%20285.25%2052.76%20280.27%2072.65L274.67%2095.01C271.76%20106.6%20276.79%20118.73%20287.04%20124.88L306.81%20136.72C324.4%20147.26%20324.4%20172.74%20306.81%20183.28L287.04%20195.12C276.79%20201.27%20271.76%20213.4%20274.67%20224.99L280.27%20247.35C285.25%20267.24%20267.24%20285.25%20247.35%20280.27L224.99%20274.67C213.4%20271.76%20201.27%20276.79%20195.12%20287.04L183.28%20306.81C172.74%20324.4%20147.26%20324.4%20136.72%20306.81L124.88%20287.04C118.73%20276.79%20106.6%20271.76%2095.01%20274.67L72.646%20280.27C52.763%20285.25%2034.747%20267.24%2039.729%20247.35L45.333%20224.99C48.238%20213.4%2043.214%20201.27%2032.96%20195.12L13.187%20183.28C-4.39599%20172.74%20-4.39599%20147.26%2013.187%20136.72L32.96%20124.88C43.214%20118.73%2048.238%20106.6%2045.333%2095.01L39.729%2072.65C34.747%2052.76%2052.763%2034.75%2072.645%2039.73L95.01%2045.33C106.6%2048.24%20118.73%2043.21%20124.88%2032.96L136.72%2013.1899Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e");mask-image:url("data:image/svg+xml,%3csvg%20width='320'%20height='320'%20viewBox='0%200%20320%20320'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M136.72%2013.1899C147.26%20-4.40006%20172.74%20-4.40006%20183.28%2013.1899L195.12%2032.96C201.27%2043.21%20213.4%2048.24%20224.99%2045.33L247.35%2039.73C267.24%2034.75%20285.25%2052.76%20280.27%2072.65L274.67%2095.01C271.76%20106.6%20276.79%20118.73%20287.04%20124.88L306.81%20136.72C324.4%20147.26%20324.4%20172.74%20306.81%20183.28L287.04%20195.12C276.79%20201.27%20271.76%20213.4%20274.67%20224.99L280.27%20247.35C285.25%20267.24%20267.24%20285.25%20247.35%20280.27L224.99%20274.67C213.4%20271.76%20201.27%20276.79%20195.12%20287.04L183.28%20306.81C172.74%20324.4%20147.26%20324.4%20136.72%20306.81L124.88%20287.04C118.73%20276.79%20106.6%20271.76%2095.01%20274.67L72.646%20280.27C52.763%20285.25%2034.747%20267.24%2039.729%20247.35L45.333%20224.99C48.238%20213.4%2043.214%20201.27%2032.96%20195.12L13.187%20183.28C-4.39599%20172.74%20-4.39599%20147.26%2013.187%20136.72L32.96%20124.88C43.214%20118.73%2048.238%20106.6%2045.333%2095.01L39.729%2072.65C34.747%2052.76%2052.763%2034.75%2072.645%2039.73L95.01%2045.33C106.6%2048.24%20118.73%2043.21%20124.88%2032.96L136.72%2013.1899Z'%20fill='%23D0BCFF'/%3e%3c/svg%3e")}@keyframes to-shape-rotate{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.checkbox,.radio,.switch{--_size: 1.5rem;direction:ltr;inline-size:auto;block-size:auto;line-height:normal;white-space:nowrap;cursor:pointer;display:inline-flex;align-items:center}:is(.checkbox,.radio,.switch).small{--_size: 1rem}:is(.checkbox,.radio,.switch).large{--_size: 2rem}:is(.checkbox,.radio,.switch).extra{--_size: 2.5rem}:is(.checkbox,.radio)>input{inline-size:var(--_size);block-size:var(--_size);opacity:0}.switch>input{inline-size:3.25rem;block-size:2rem;opacity:0}:is(.checkbox,.radio,.switch)>span{display:inline-flex;align-items:center;color:var(--on-surface);font-size:.875rem}:is(.checkbox,.radio)>span:not(:empty){padding-inline-start:.25rem}:is(.checkbox,.radio,.switch)>span:before,:is(.checkbox,.radio,.switch)>span>i,:is(.checkbox,.radio)>span:after{--_size: inherit;content:"";inline-size:var(--_size);block-size:var(--_size);box-sizing:border-box;margin:0 auto;outline:none;color:var(--primary);position:absolute;inset:auto auto auto calc(var(--_size) * -1);border-radius:50%;-webkit-user-select:none;user-select:none;z-index:1}.switch>span:before,.switch.icon>span>i{position:absolute;inset:50% auto auto 0;display:inline-flex;align-items:center;justify-content:center;border-radius:50%;transition:all var(--speed2);font-size:calc(var(--_size) - .5rem);-webkit-user-select:none;user-select:none;min-inline-size:var(--_size);min-block-size:var(--_size);content:"";color:var(--surface-variant);background-color:var(--outline)}.switch>span:before,.switch.icon>span>i{transform:translate(-3rem,-50%) scale(.6)}.switch.icon>span>i{transform:translate(-3rem,-50%) scale(1)}.checkbox>span:before{content:"check_box_outline_blank"}.checkbox>input:checked+span:before{content:"check_box";font-variation-settings:"FILL" 1}.checkbox>input:indeterminate+span:before{content:"indeterminate_check_box"}.radio>span:before{content:"radio_button_unchecked"}.radio>input:checked+span:before{content:"radio_button_checked"}:is(.radio,.checkbox,.switch).icon>span:before{content:""!important;font-variation-settings:unset!important}:is(.checkbox,.radio)>span:after{transition:all var(--speed1);background-color:currentColor;box-shadow:0 0 0 0 currentColor;opacity:0}:is(.checkbox,.radio):is(:hover)>input:not(:disabled)+span:after,:is(.checkbox,.radio)>input:not(:disabled):is(:focus)+span:after{box-shadow:0 0 0 .5rem currentColor;opacity:.1}.switch>input:not(:disabled):is(:focus,:hover)+span:before,.switch.icon>input:not(:disabled):is(:focus,:hover)+span>i{box-shadow:0 0 0 .5rem var(--active)}:is(.checkbox,.radio)>input:checked+span:before,:is(.checkbox,.radio).icon>input:checked+span>i{color:var(--primary)}.icon>input:checked+span>i:first-child,.icon>span>i:last-child{opacity:0}.icon>input:checked+span>i:last-child,.icon>span>i:first-child{opacity:1}.switch>input:checked+span:after{border:none;background-color:var(--primary)}.switch>input:checked+span:before,.switch.icon>input:checked+span>i{content:"check";color:var(--primary);background-color:var(--on-primary);transform:translate(-1.75rem,-50%) scale(1)}.switch>input:active:not(:disabled)+span:before,.switch.icon>input:active:not(:disabled)+span>i{transform:translate(-3rem,-50%) scale(1.2)}.switch>input:active:checked:not(:disabled)+span:before,.switch.icon>input:active:checked:not(:disabled)+span>i{transform:translate(-1.75rem,-50%) scale(1.2)}:is(.checkbox,.radio,.switch)>input:disabled+span{opacity:.5;cursor:not-allowed}.switch>span:after{content:"";position:absolute;inset:50% auto auto 0;background-color:var(--active);border:.125rem solid var(--outline);box-sizing:border-box;inline-size:3.25rem;block-size:2rem;border-radius:2rem;transform:translate(-3.25rem,-50%)}.field>:is(nav,.row){flex-grow:1;padding:0 1rem}.field.round>:is(nav,.row){flex-grow:1;padding:0 1.5rem}[dir=rtl] .switch{transform:scale(-1)}[dir=rtl] .switch>span:before,[dir=rtl] .switch.icon>span>i{transform:translate(-3rem,-50%) scale(-.6)}[dir=rtl] .switch.icon>span>i{transform:translate(-3rem,-50%) scale(-1)}[dir=rtl] .switch>input:checked+span:before,[dir=rtl] .switch.icon>input:checked+span>i{transform:translate(-1.75rem,-50%) scale(-1)}.switch>:focus-visible+span:after{outline:.125rem solid var(--primary);outline-offset:.25rem}:is(.checkbox,.radio)>:focus-visible+span:before{outline:.125rem solid var(--primary);outline-offset:.375rem}.slider{--_start: 0%;--_end: 0%;--_value1: "";--_value2: "";--_track: 1rem;--_thumb: max(2.5rem, calc(var(--_track) + .5rem));display:flex;align-items:center!important;inline-size:auto;block-size:var(--_thumb);flex:none;direction:ltr;margin:0 1.25rem}[dir=rtl] .slider{transform:scaleX(-1)}.slider.vertical{flex-direction:row!important;margin:.5rem auto!important;padding:50% 0;transform:rotate(-90deg);inline-size:100%}.slider.tiny{--_track: 1rem}.slider.small{--_track: 1.5rem}.slider.medium{--_track: 2.5rem}.slider.large{--_track: 3.5rem}.slider.extra{--_track: 6rem}.slider>input{-webkit-appearance:none;-moz-appearance:none;appearance:none;box-shadow:none;border:none;outline:none;pointer-events:none;inline-size:100%;block-size:var(--_track);background:none;z-index:1;padding:0;margin:0;transform:rotate(0)}.slider>input:only-of-type{pointer-events:all}.slider>input+input{position:absolute}.slider>input::-webkit-slider-thumb{-webkit-appearance:none;-moz-appearance:none;appearance:none;box-shadow:none;border:none;outline:none;pointer-events:all;block-size:var(--_thumb);inline-size:.25rem;border-radius:.25rem;background:var(--primary);cursor:grab;margin:0;z-index:1}.slider>input::-webkit-slider-thumb:active{cursor:grabbing}.slider>input::-moz-range-thumb{-webkit-appearance:none;-moz-appearance:none;appearance:none;box-shadow:none;border:none;outline:none;pointer-events:all;block-size:2.75rem;inline-size:.25rem;border-radius:.25rem;background:var(--primary);cursor:grab;margin:0}.slider>input::-moz-range-thumb:active{cursor:grabbing}.slider>input:not(:disabled):is(:focus)::-webkit-slider-thumb{transform:scaleX(.6)}.slider>input:not(:disabled):is(:focus)::-moz-range-thumb{transform:scaleX(.6)}.slider>input:disabled{cursor:not-allowed;opacity:1}.slider>input:disabled::-webkit-slider-thumb{background:var(--outline);cursor:not-allowed}.slider>input:disabled::-moz-range-thumb{background:var(--outline);cursor:not-allowed}.slider>input:disabled~span{background:var(--outline)}.slider>span{position:absolute;block-size:var(--_track);border-radius:1rem 0 0 1rem;background:var(--primary);color:var(--on-primary);z-index:0;inset:calc(50% - (var(--_track) / 2)) var(--_end) auto var(--_start);clip-path:polygon(0 0,calc(100% - .5rem) 0,calc(100% - .5rem) 100%,0 100%)}.slider>input[type=range]+input[type=range]~span{border-radius:0;clip-path:polygon(.5rem 0,max(.5rem,calc(100% - .5rem)) 0,max(.5rem,calc(100% - .5rem)) 100%,.5rem 100%)}.field>.slider{inline-size:100%}.slider:before{content:"";position:absolute;inline-size:100%;block-size:var(--_track);border-radius:1rem;background:var(--secondary-container);clip-path:polygon(calc(var(--_start) - .5rem) 0,0 0,0 100%,calc(var(--_start) - .5rem) 100%,calc(var(--_start) - .5rem) 0,calc(100% - var(--_end) + .5rem) 0,100% 0,100% 100%,calc(100% - var(--_end) + .5rem) 100%,calc(100% - var(--_end) + .5rem) 0)}.slider:has(>[disabled]):before{background:var(--outline-variant)}.slider:has([disabled]){opacity:.62}.slider>span>i{position:absolute;block-size:auto;inset:0 auto 0 .5rem;color:currentColor;z-index:1}.slider:not(.medium,.large,.extra)>span>i{display:none}.slider.vertical>i{transform:rotate(90deg)}.slider>.tooltip{visibility:hidden!important;opacity:0!important;inset:0 auto auto calc(100% - var(--_end));border-radius:2rem;transition:top var(--speed2) ease,opacity var(--speed2) ease;transform:translate(-50%,-25%)!important;padding:.75rem 1rem}.slider>.tooltip.bottom{inset:auto auto 0 calc(100% - var(--_end));transition:bottom var(--speed2) ease,opacity var(--speed2) ease;transform:translate(-50%,25%)!important}[dir=rtl] .slider>.tooltip{transform:translate(-50%,-25%) scaleX(-1)!important}[dir=rtl] .slider>.tooltip.bottom{transform:translate(-50%,25%) scaleX(-1)!important}.slider>.tooltip+.tooltip{inset:.25rem calc(100% - var(--_start)) auto auto;transform:translate(50%,-25%)!important}.slider>.tooltip+.tooltip.bottom{inset:auto calc(100% - var(--_start)) -.25rem auto;transform:translate(50%,25%)!important}[dir=rtl] .slider>.tooltip+.tooltip{transform:translate(50%,-25%) scaleX(-1)!important}[dir=rtl] .slider>.tooltip+.tooltip.bottom{transform:translate(50%,25%) scaleX(-1)!important}.slider>.tooltip:before{content:var(--_value1)}.slider>.tooltip+.tooltip:before{content:var(--_value2)}.slider>:focus~.tooltip{inset-block:-1rem auto;opacity:1!important;visibility:visible!important}.slider>:focus~.tooltip.bottom{inset-block:auto -1rem}.slider.vertical>.tooltip{inset-block:auto;block-size:2.5rem;inline-size:2.5rem;margin-block:calc(-1 * var(--_thumb)) 0!important;transform:rotate(90deg) translate(-75%,50%)!important}.slider.vertical>.tooltip.bottom{inset-block:auto;margin-block:0 calc(-1 * var(--_thumb))!important;transform:rotate(90deg) translate(75%,50%)!important}.slider.vertical>.tooltip+.tooltip{transform:rotate(90deg) translate(-75%,-50%)!important}.slider.vertical>.tooltip+.tooltip.bottom{transform:rotate(90deg) translate(75%,-50%)!important}:is(nav,.row,.field)>.slider:not(.circle,.small,.medium,.large){flex:auto}.slider.max,.slider.max.vertical,.slider.max>input,.slider.max.vertical>input{all:unset;margin:0!important;position:absolute;color:var(--primary);top:0;right:0;bottom:0;left:0;border-radius:inherit;overflow:hidden;z-index:2;cursor:grab;inline-size:100%;block-size:100%}.slider.max:before{display:none}.slider.max.vertical>input{writing-mode:vertical-lr;transform:rotate(-180deg)}.slider.max>input::-webkit-slider-thumb{opacity:0;inline-size:1rem;block-size:100vh;transform:none!important}.slider.max>input::-moz-range-thumb{opacity:0;inline-size:1rem;block-size:100vh;transform:none!important}.slider.max>span{block-size:auto!important;inset:0 var(--_end) 0 var(--_start);clip-path:none;background:currentcolor;color:inherit;border-radius:0}.slider.max.vertical>span{inset:var(--_end) 0 var(--_start) 0}.slider>input:focus-visible::-webkit-slider-thumb{outline:.1875rem solid var(--primary);outline-offset:.25rem}.slider>input:focus-visible::-moz-range-thumb{outline:.1875rem solid var(--primary);outline-offset:.25rem}.slider.max>input:focus-visible{outline:.1875rem solid var(--primary);outline-offset:-.125rem}@media (pointer: coarse){.slider>:hover~.tooltip{inset-block:-1rem auto!important;opacity:1!important;visibility:visible!important}.slider>:hover~.tooltip.bottom{inset-block:auto -1rem!important}}.snackbar{position:fixed;inset:auto auto 6rem 50%;inline-size:80%;block-size:auto;z-index:200;visibility:hidden;display:flex;box-shadow:var(--elevate2);color:var(--inverse-on-surface);background-color:var(--inverse-surface);padding:1rem;cursor:pointer;text-align:start;align-items:center;border-radius:.25rem;gap:.5rem;transition:all var(--speed2);transform:translate(-50%,1rem);opacity:0}.snackbar.top{inset:6rem auto auto 50%}.snackbar:is(.active){visibility:visible;transform:translate(-50%);opacity:1}.snackbar:popover-open{visibility:visible;transform:translate(-50%);opacity:1}.snackbar>.max{flex:auto}@media only screen and (min-width: 993px){.snackbar{inline-size:40%}}table{inline-size:100%;border-spacing:0;font-size:.875rem;text-align:start}.scroll>table,table :is(thead,tbody,tfoot,tr,th,td){background-color:inherit;color:inherit}:is(th,td){inline-size:auto;text-align:inherit;padding:.5rem;border-radius:0}:is(th,td)>*{vertical-align:middle}table.border>tbody>tr:not(:last-child)>td,thead>tr>th{border-block-end:.0625rem solid var(--outline)}tfoot>tr>th{border-block-start:.0625rem solid var(--outline)}table.stripes>tbody>tr:nth-child(odd){background-color:var(--active)}table.no-space :is(th,td){padding:0}table.medium-space :is(th,td){padding:.75rem}table.large-space :is(th,td){padding:1rem}table>.fixed,th.fixed{position:sticky;z-index:1;inset-block-start:0}tfoot.fixed,tfoot th.fixed{inset-block-end:0}:is(td,th).min{inline-size:.1%;white-space:nowrap}.tabs{display:flex;white-space:nowrap;border-block-end:.0625rem solid var(--surface-variant);border-radius:0}.tabs:not(.left-align,.right-align,.center-align){justify-content:space-around}.tabs>a{display:flex;font-size:.875rem;font-weight:500;color:var(--on-surface-variant);padding:.5rem 1rem;text-align:center;min-block-size:3rem;inline-size:100%;gap:.25rem}.tabs.small>a{min-block-size:2rem}.tabs.large>a{min-block-size:4rem}.tabs>a.active,.tabs>a.active>i{color:var(--primary)}.tabs>a.active:before{content:"";position:absolute;inset:auto 0 0 0;block-size:.125rem;background-color:var(--primary)}.tabs.min>a.active:before{margin:0 auto;max-inline-size:min(100%,4rem)}.tabs:is(.left-align,.center-align,.right-align)>a{inline-size:auto}.tooltip{--_space: -.5rem;visibility:hidden;display:flex;align-items:center;justify-content:center;gap:.5rem;background-color:var(--inverse-surface);color:var(--inverse-on-surface);font-size:.75rem;text-align:center;border-radius:.25rem;padding:.5rem;position:absolute;z-index:200;inset:0 auto auto 50%;inline-size:auto;white-space:nowrap;font-weight:500;opacity:0;transition:all var(--speed2);line-height:normal;transform:translate(-50%,-100%) scale(.9)}.tooltip:not(.max):hover{visibility:hidden;opacity:0}.tooltip.left{inset:50% auto auto 0;transform:translate(-100%,-50%) scale(.9)}.tooltip.right{inset:50% 0 auto auto;transform:translate(100%,-50%) scale(.9)}.tooltip.bottom{inset:auto auto 0 50%;transform:translate(-50%,100%) scale(.9)}.tooltip.small{inline-size:8rem;white-space:normal}.tooltip.medium{inline-size:12rem;white-space:normal}.tooltip.large{inline-size:16rem;white-space:normal}:hover>.tooltip{visibility:visible;opacity:1;transform:translate(-50%,-100%) scale(1)}:hover>.tooltip.left{transform:translate(-100%,-50%) scale(1)}:hover>.tooltip.right{transform:translate(100%,-50%) scale(1)}:hover>.tooltip.bottom{transform:translate(-50%,100%) scale(1)}.tooltip.no-space{--_space: 0}.tooltip.medium-space{--_space: -1rem}.tooltip.large-space{--_space: -1.5rem}.tooltip:not(.left,.right,.bottom){margin-block-start:var(--_space)!important}.tooltip.left,.tooltip.right{margin-inline:var(--_space)!important}.tooltip.bottom{margin-block-end:var(--_space)!important}menu:active~.tooltip,:is(button,.button):focus>menu~.tooltip,.field>:focus~menu~.tooltip{visibility:hidden}.slider>.tooltip{--_space: -1.25rem}.slider.vertical>.tooltip{--_space: -.75rem}.slider.vertical>.tooltip:is(.left,.right){--_space: -.5rem}.tooltip.max{display:block;font-size:inherit;white-space:normal;text-align:start;inline-size:20rem;border-radius:.5rem;padding:1rem;box-shadow:var(--elevate2)}:root{--eox-theme-light-background: 237, 237, 242;--eox-theme-light-code: 245, 245, 245;--eox-theme-light-error-container: 255, 218, 214;--eox-theme-light-error: 186, 26, 26;--eox-theme-light-inverse-on-surface: 240, 240, 245;--eox-theme-light-inverse-primary: 158, 202, 255;--eox-theme-light-inverse-surface: 46, 48, 52;--eox-theme-light-kbd: 33, 37, 41;--eox-theme-light-neutral-palette-key-color: 117, 119, 123;--eox-theme-light-neutral-variant-palette-key-color: 114, 119, 128;--eox-theme-light-on-background: 0, 0, 0;--eox-theme-light-on-code: 0, 0, 0;--eox-theme-light-on-error-container: 65, 0, 2;--eox-theme-light-on-error: 255, 255, 255;--eox-theme-light-on-inverse-on-surface: 0, 0, 0;--eox-theme-light-on-inverse-primary: 0, 0, 0;--eox-theme-light-on-inverse-surface: 255, 255, 255;--eox-theme-light-on-kbd: 255, 255, 255;--eox-theme-light-on-neutral-palette-key-color: 255, 255, 255;--eox-theme-light-on-neutral-variant-palette-key-color: 255, 255, 255;--eox-theme-light-on-outline-variant: 0, 0, 0;--eox-theme-light-on-outline: 255, 255, 255;--eox-theme-light-on-primary-container: 0, 29, 54;--eox-theme-light-on-primary-fixed-dim: 0, 0, 0;--eox-theme-light-on-primary-fixed-variant: 16, 73, 120;--eox-theme-light-on-primary-fixed: 0, 29, 54;--eox-theme-light-on-primary-palette-key-color: 255, 255, 255;--eox-theme-light-on-primary: 255, 255, 255;--eox-theme-light-on-scrim: 255, 255, 255;--eox-theme-light-on-secondary-container: 0, 31, 40;--eox-theme-light-on-secondary-fixed-dim: 0, 0, 0;--eox-theme-light-on-secondary-fixed-variant: 15, 77, 95;--eox-theme-light-on-secondary-fixed: 0, 31, 40;--eox-theme-light-on-secondary-palette-key-color: 255, 255, 255;--eox-theme-light-on-secondary: 255, 255, 255;--eox-theme-light-on-shadow: 255, 255, 255;--eox-theme-light-on-surface-bright: 0, 0, 0;--eox-theme-light-on-surface-container-high: 0, 0, 0;--eox-theme-light-on-surface-container-highest: 0, 0, 0;--eox-theme-light-on-surface-container-low: 0, 0, 0;--eox-theme-light-on-surface-container-lowest: 0, 0, 0;--eox-theme-light-on-surface-container: 0, 0, 0;--eox-theme-light-on-surface-dim: 0, 0, 0;--eox-theme-light-on-surface-light: 0, 0, 0;--eox-theme-light-on-surface-tint: 255, 255, 255;--eox-theme-light-on-surface: 26, 28, 31;--eox-theme-light-on-tertiary-container: 17, 19, 79;--eox-theme-light-on-tertiary-fixed-dim: 0, 0, 0;--eox-theme-light-on-tertiary-fixed-variant: 62, 65, 124;--eox-theme-light-on-tertiary-fixed: 17, 19, 79;--eox-theme-light-on-tertiary-palette-key-color: 255, 255, 255;--eox-theme-light-on-tertiary: 255, 255, 255;--eox-theme-light-outline-variant: 194, 199, 208;--eox-theme-light-outline: 114, 119, 128;--eox-theme-light-primary-container: 209, 228, 255;--eox-theme-light-primary-fixed-dim: 158, 202, 255;--eox-theme-light-primary-fixed: 209, 228, 255;--eox-theme-light-primary-palette-key-color: 0, 65, 112;--eox-theme-light-primary: 0, 65, 112;--eox-theme-light-scrim: 0, 0, 0;--eox-theme-light-secondary-container: 184, 234, 255;--eox-theme-light-secondary-fixed-dim: 154, 206, 228;--eox-theme-light-secondary-fixed: 184, 234, 255;--eox-theme-light-secondary-palette-key-color: 0, 69, 87;--eox-theme-light-secondary: 47, 101, 120;--eox-theme-light-shadow: 0, 0, 0;--eox-theme-light-surface-bright: 249, 249, 254;--eox-theme-light-surface-container-high: 231, 232, 236;--eox-theme-light-surface-container-highest: 226, 226, 231;--eox-theme-light-surface-container-low: 243, 243, 248;--eox-theme-light-surface-container-lowest: 255, 255, 255;--eox-theme-light-surface-container: 237, 237, 242;--eox-theme-light-surface-dim: 217, 218, 222;--eox-theme-light-surface-light: 231, 232, 236;--eox-theme-light-surface-tint: 49, 97, 146;--eox-theme-light-surface: 249, 249, 254;--eox-theme-light-tertiary-container: 225, 224, 255;--eox-theme-light-tertiary-fixed-dim: 191, 193, 255;--eox-theme-light-tertiary-fixed: 225, 224, 255;--eox-theme-light-tertiary-palette-key-color: 54, 57, 116;--eox-theme-light-tertiary: 86, 89, 150}:root{--eox-theme-dark-background: 30, 32, 35;--eox-theme-dark-code: 52, 52, 52;--eox-theme-dark-error-container: 147, 0, 10;--eox-theme-dark-error: 255, 180, 171;--eox-theme-dark-inverse-on-surface: 46, 48, 52;--eox-theme-dark-inverse-primary: 49, 97, 146;--eox-theme-dark-inverse-surface: 226, 226, 231;--eox-theme-dark-kbd: 33, 37, 41;--eox-theme-dark-neutral-palette-key-color: 117, 119, 123;--eox-theme-dark-neutral-variant-palette-key-color: 114, 119, 128;--eox-theme-dark-on-background: 255, 255, 255;--eox-theme-dark-on-code: 204, 204, 204;--eox-theme-dark-on-error-container: 255, 180, 171;--eox-theme-dark-on-error: 105, 0, 5;--eox-theme-dark-on-inverse-on-surface: 255, 255, 255;--eox-theme-dark-on-inverse-primary: 158, 202, 255;--eox-theme-dark-on-inverse-surface: 0, 0, 0;--eox-theme-dark-on-kbd: 255, 255, 255;--eox-theme-dark-on-neutral-palette-key-color: 255, 255, 255;--eox-theme-dark-on-neutral-variant-palette-key-color: 255, 255, 255;--eox-theme-dark-on-outline-variant: 255, 255, 255;--eox-theme-dark-on-outline: 255, 255, 255;--eox-theme-dark-on-primary-container: 209, 228, 255;--eox-theme-dark-on-primary-fixed-dim: 0, 0, 0;--eox-theme-dark-on-primary-fixed-variant: 16, 73, 120;--eox-theme-dark-on-primary-fixed: 0, 29, 54;--eox-theme-dark-on-primary-palette-key-color: 255, 255, 255;--eox-theme-dark-on-primary: 0, 50, 88;--eox-theme-dark-on-scrim: 255, 255, 255;--eox-theme-dark-on-secondary-container: 184, 234, 255;--eox-theme-dark-on-secondary-fixed-dim: 0, 0, 0;--eox-theme-dark-on-secondary-fixed-variant: 15, 77, 95;--eox-theme-dark-on-secondary-fixed: 0, 31, 40;--eox-theme-dark-on-secondary-palette-key-color: 255, 255, 255;--eox-theme-dark-on-secondary: 0, 53, 68;--eox-theme-dark-on-shadow: 255, 255, 255;--eox-theme-dark-on-surface-bright: 255, 255, 255;--eox-theme-dark-on-surface-container-high: 255, 255, 255;--eox-theme-dark-on-surface-container-highest: 255, 255, 255;--eox-theme-dark-on-surface-container-low: 255, 255, 255;--eox-theme-dark-on-surface-container-lowest: 255, 255, 255;--eox-theme-dark-on-surface-container: 255, 255, 255;--eox-theme-dark-on-surface-dim: 255, 255, 255;--eox-theme-dark-on-surface-light: 255, 255, 255;--eox-theme-dark-on-surface-tint: 0, 0, 0;--eox-theme-dark-on-surface: 226, 226, 231;--eox-theme-dark-on-tertiary-container: 225, 224, 255;--eox-theme-dark-on-tertiary-fixed-dim: 0, 0, 0;--eox-theme-dark-on-tertiary-fixed-variant: 62, 65, 124;--eox-theme-dark-on-tertiary-fixed: 17, 19, 79;--eox-theme-dark-on-tertiary-palette-key-color: 255, 255, 255;--eox-theme-dark-on-tertiary: 39, 42, 100;--eox-theme-dark-outline-variant: 66, 71, 79;--eox-theme-dark-outline: 140, 145, 154;--eox-theme-dark-primary-container: 16, 73, 120;--eox-theme-dark-primary-fixed-dim: 158, 202, 255;--eox-theme-dark-primary-fixed-variant: 209, 228, 255;--eox-theme-dark-primary-fixed: 209, 228, 255;--eox-theme-dark-primary-palette-key-color: 0, 65, 112;--eox-theme-dark-primary: 158, 202, 255;--eox-theme-dark-scrim: 0, 0, 0;--eox-theme-dark-secondary-container: 15, 77, 95;--eox-theme-dark-secondary-fixed-dim: 154, 206, 228;--eox-theme-dark-secondary-fixed-variant: 184, 234, 255;--eox-theme-dark-secondary-fixed: 184, 234, 255;--eox-theme-dark-secondary-palette-key-color: 0, 69, 87;--eox-theme-dark-secondary: 154, 206, 228;--eox-theme-dark-shadow: 0, 0, 0;--eox-theme-dark-surface-bright: 55, 57, 61;--eox-theme-dark-surface-container-high: 40, 42, 46;--eox-theme-dark-surface-container-highest: 51, 53, 56;--eox-theme-dark-surface-container-low: 26, 28, 31;--eox-theme-dark-surface-container-lowest: 12, 14, 17;--eox-theme-dark-surface-container: 30, 32, 35;--eox-theme-dark-surface-dim: 17, 19, 23;--eox-theme-dark-surface-light: 55, 57, 61;--eox-theme-dark-surface-tint: 158, 202, 255;--eox-theme-dark-surface: 17, 19, 23;--eox-theme-dark-tertiary-container: 62, 65, 124;--eox-theme-dark-tertiary-fixed-dim: 191, 193, 255;--eox-theme-dark-tertiary-fixed-variant: 225, 224, 255;--eox-theme-dark-tertiary-fixed: 225, 224, 255;--eox-theme-dark-tertiary-palette-key-color: 54, 57, 116;--eox-theme-dark-tertiary: 191, 193, 255}:root{--eox-slider-thumb-height: 20px;--eox-slider-thumb-width: 20px;--eox-slider-track-height: 6px;--eox-slider-track-color: var(--outline-variant);--eox-slider-brightness-hover: 100%;--eox-slider-brightness-down: 100%;--eox-slider-clip-edges: 4px;--eox-slider-margin: 1.125rem}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input){font-size:1.5rem;color:var(--primary);width:100%;background:none;overflow:hidden}input[type=range]:not(.slider input[type=range]){margin:var(--eox-slider-margin);width:100%}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input):active{cursor:grabbing}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input):disabled{filter:grayscale(1);opacity:.3;cursor:not-allowed}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input),input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-webkit-slider-runnable-track,input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-webkit-slider-thumb{-webkit-appearance:none;transition:all ease .1s;height:var(--eox-slider-thumb-height)}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-webkit-slider-runnable-track,input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-webkit-slider-thumb{position:relative}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-webkit-slider-runnable-track{border-radius:var(--eox-slider-track-height)}input[type=range]:not(.slider input)::-webkit-slider-thumb{--thumb-radius: calc((var(--eox-slider-thumb-height) * .5) - 1px);--clip-top: calc( (var(--eox-slider-thumb-height) - var(--eox-slider-track-height)) * .5 - .5px );--clip-bottom: calc(var(--eox-slider-thumb-height) - var(--clip-top));--clip-further: calc(100% + 1px) ;--box-fill: calc( -100vmax - var(--eox-slider-thumb-width, var(--eox-slider-thumb-height)) ) 0 0 100vmax currentColor;width:var(--eox-slider-thumb-width, var(--eox-slider-thumb-height));background:linear-gradient(currentColor 0 0) scroll no-repeat left center / 50% calc(var(--eox-slider-track-height) + 1px);background-color:currentColor;box-shadow:var(--box-fill);border-radius:var(--eox-slider-thumb-width, var(--eox-slider-thumb-height));filter:brightness(100%);clip-path:polygon(100% -1px,var(--eox-slider-clip-edges) -1px,0 var(--clip-top),-100vmax var(--clip-top),-100vmax var(--clip-bottom),0 var(--clip-bottom),var(--eox-slider-clip-edges) 100%,var(--clip-further) var(--clip-further))}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input):hover::-webkit-slider-thumb{filter:brightness(var(--eox-slider-brightness-hover));cursor:grab}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input):active::-webkit-slider-thumb{filter:brightness(var(--eox-slider-brightness-down));cursor:grabbing}input[type=range]:not(.slider input)::-webkit-slider-runnable-track{background:linear-gradient(var(--eox-slider-track-color) 0 0) scroll no-repeat center / 100% calc(var(--eox-slider-track-height) + 1px)}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input):disabled::-webkit-slider-thumb{cursor:not-allowed}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input),input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-moz-range-track,input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-moz-range-thumb{-webkit-appearance:none;-moz-appearance:none;appearance:none;transition:all ease .1s;height:var(--eox-slider-thumb-height)}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-moz-range-track,input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-moz-range-thumb,input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-moz-range-progress{background:#fff0}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-moz-range-thumb{background:currentColor;border:0;width:var(--eox-slider-thumb-width, var(--eox-slider-thumb-height));border-radius:var(--eox-slider-thumb-width, var(--eox-slider-thumb-height));cursor:grab}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input):active::-moz-range-thumb{cursor:grabbing}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-moz-range-track{width:100%;background:var(--eox-slider-track-color)}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-moz-range-progress{-webkit-appearance:none;-moz-appearance:none;appearance:none;background:currentColor;transition-delay:30ms}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-moz-range-track,input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-moz-range-progress{height:calc(var(--eox-slider-track-height) + 1px);border-radius:var(--eox-slider-track-height)}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-moz-range-thumb,input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input)::-moz-range-progress{filter:brightness(100%)}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input):hover::-moz-range-thumb,input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input):hover::-moz-range-progress{filter:brightness(var(--eox-slider-brightness-hover))}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input):active::-moz-range-thumb,input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input):active::-moz-range-progress{filter:brightness(var(--eox-slider-brightness-down))}input[type=range]:not(.slider.large input,.slider.small input,.slider.medium input,.slider.extra input):disabled::-moz-range-thumb{cursor:not-allowed}label.slider.tiny:before{height:var(--eox-slider-track-height);background:var(--outline-variant);clip-path:none}label.slider.tiny>span,.slider.tiny>input[type=range]+input[type=range]~span{height:var(--eox-slider-track-height);top:var(--eox-slider-track-height) - 1;clip-path:none}.slider.tiny>input[type=range]::-webkit-slider-thumb{box-shadow:unset;width:var(--eox-slider-thumb-width, var(--eox-slider-thumb-height));border-radius:var(--eox-slider-thumb-width, var(--eox-slider-thumb-height))}.slider.tiny>input[type=range]::-webkit-slider-runnable-track{background:unset}.slider.tiny>input[type=range]:not(:disabled):is(:focus)::-webkit-slider-thumb{transform:scaleX(1)}.slider.tiny>input:not(:disabled):is(:focus)::-moz-range-thumb{transform:scaleX(1)}tc-range-slider{--panel-bg-fill: var(--primary);--pointer-bg: var(--primary);--pointer-bg-focus: var(--primary);--pointer-bg-hover: var(--primary);--pointer-border: 0;--pointer-border-focus: 0;--pointer-border-hover: 0;--pointer-width: var( --eox-slider-thumb-width, var(--eox-slider-thumb-height) );--pointer-height: var( --eox-slider-thumb-width, var(--eox-slider-thumb-height) );--pointer-shadow: 0;--pointer-shadow-hover: 0;--height: var(--eox-slider-track-height);--width: 100%;--panel-bg-border-radius: var(--eox-slider-track-height);--panel-bg: var(--eox-slider-track-color);--panel-bg-hover: var(--eox-slider-track-color);display:block;margin:var(--eox-slider-margin)}:root{--eox-body-font-family: Inter, Roboto, "Helvetica Neue", "Arial Nova", "Nimbus Sans", Noto Sans, Arial, sans-serif;--eox-header-font-family: var(--eox-body-font-family);--size: 1rem;--font: var(--eox-body-font-family);--font-icon: "Material Symbols Subset";--speed1: .1s;--speed2: .2s;--speed3: .3s;--speed4: .4s;--active: rgb(128 128 128 / .192);--overlay: rgb(0 0 0 / .5);--elevate1: 0 .125rem .125rem 0 rgb(0 0 0 / .32);--elevate2: 0 .25rem .5rem 0 rgb(0 0 0 / .4);--elevate3: 0 .375rem .75rem 0 rgb(0 0 0 / .48);--top: env(safe-area-inset-top);--bottom: env(safe-area-inset-bottom);--left: env(safe-area-inset-left);--right: env(safe-area-inset-right)}*{font-family:var(--eox-body-font-family)}h1,h2,h3,h4,h5,h6{font-family:var(--eox-header-font-family)}:root,body.light{--primary: rgb(var(--eox-theme-light-primary));--on-primary: rgb(var(--eox-theme-light-on-primary));--primary-container: rgb(var(--eox-theme-light-primary-container));--on-primary-container: #001d36;--secondary: rgb(var(--eox-theme-light-secondary));--on-secondary: rgb(var(--eox-theme-light-on-secondary));--secondary-container: #d7e3f7;--on-secondary-container: #101c2b;--tertiary: rgb(var(--eox-theme-light-tertiary));--on-tertiary: rgb(var(--eox-theme-light-on-tertiary));--tertiary-container: #f2daff;--on-tertiary-container: #251431;--error: rgb(var(--eox-theme-light-error));--on-error: rgb(var(--eox-theme-light-on-error));--error-container: #ffdad6;--on-error-container: #410002;--background: rgb(var(--eox-theme-light-background));--on-background: #1a1c1e;--surface: rgb(var(--eox-theme-light-surface));--on-surface: rgb(var(--eox-theme-light-on-surface));--surface-variant: #dfe2eb;--on-surface-variant: #43474e;--outline: rgb(var(--eox-theme-light-outline));--outline-variant: rgb(var(--eox-theme-light-outline-variant));--shadow: #000000;--scrim: #000000;--inverse-surface: #2f3033;--inverse-on-surface: #f1f0f4;--inverse-primary: #9ecaff;--surface-dim: rgb(var(--eox-theme-light-surface-dim));--surface-bright: rgb(var(--eox-theme-light-surface-bright));--surface-container-lowest: #ffffff;--surface-container-low: #f4f3f7;--surface-container: #eeedf1;--surface-container-high: #e8e8eb;--surface-container-highest: #e2e2e6}body.dark{--primary: rgb(var(--eox-theme-dark-primary));--on-primary: rgb(var(--eox-theme-dark-on-primary));--primary-container: rgb(var(--eox-theme-dark-primary-container));--on-primary-container: #d1e4ff;--secondary: rgb(var(--eox-theme-dark-secondary));--secondary-container: #3b4858;--on-secondary-container: #d7e3f7;--on-secondary-container: rgb(var(--eox-theme-dark-on-secondary-container));--tertiary: rgb(var(--eox-theme-dark-tertiary));--on-tertiary: rgb(var(--eox-theme-dark-on-tertiary));--tertiary-container: #523f5f;--on-tertiary-container: #f2daff;--error: rgb(var(--eox-theme-dark-error));--on-error: rgb(var(--eox-theme-dark-on-error));--error-container: #93000a;--on-error-container: #ffb4ab;--background: rgb(var(--eox-theme-dark-background));--on-background: #e2e2e6;--surface: rgb(var(--eox-theme-dark-surface));--on-surface: rgb(var(--eox-theme-dark-on-surface));--surface-variant: #43474e;--on-surface-variant: #c3c7cf;--outline: rgb(var(--eox-theme-dark-outline));--outline-variant: rgb(var(--eox-theme-dark-outline-variant));--shadow: #000000;--scrim: #000000;--inverse-surface: #e2e2e6;--inverse-on-surface: #2f3033;--inverse-primary: #0161a3;--surface-dim: rgb(var(--eox-theme-dark-surface-dim));--surface-bright: rgb(var(--eox-theme-dark-surface-bright));--surface-container-lowest: #0d0e11;--surface-container-low: #1a1c1e;--surface-container: #1e2022;--surface-container-high: #282a2d;--surface-container-highest: #333538}.list.no-space>li,.list.no-space>li>details>summary{min-block-size:0rem;padding:0 1rem}:is(.checkbox,.radio,.switch).small{--_size: 1.2rem}:is(.checkbox,.radio):is(:hover)>input:not(:disabled)+span:after,:is(.checkbox,.radio)>input:not(:disabled):is(:focus)+span:after{box-shadow:0 0 0 .4rem currentColor}:is(.checkbox,.radio,.switch):is(.no-round,.square)>span:before,:is(.checkbox,.radio,.switch):is(.no-round,.square)>span>i,:is(.checkbox,.radio):is(.no-round,.square)>span:after{border-radius:.15rem}.scroll::-webkit-scrollbar,.scroll::-webkit-scrollbar-thumb,.scroll::-webkit-scrollbar-button{background:none;inline-size:.4rem;block-size:.4rem}.scroll:is(:hover,:focus)::-webkit-scrollbar-thumb{background:var(--outline);border-radius:1rem}h1.tiny{font-size:2.6875rem}h2.tiny{font-size:1.9375rem}h3.tiny{font-size:1.375rem}h4.tiny{font-size:1.125rem}h5.tiny{font-size:.875rem}h6.tiny{font-size:.625rem}.link{text-decoration:underline}.link:hover{color:var(--on-primary-container)!important}`,addCommonStylesheet=()=>{const a="eox-elements";if(!document.head.querySelector(`style#${a}`)){const e=new CSSStyleSheet;e.replaceSync(eoxStyle);const t=Array.from(e.cssRules).filter(s=>s.cssText.includes(":root")).map(s=>s.cssText).join(" "),i=document.createElement("style");i.setAttribute("id",a),i.innerHTML=`
    @import url("https://eox.at/fonts/inter/inter.css");

    @font-face {
      font-family: "Material Symbols Subset";
      font-style: normal;
      font-weight: 400;
      font-display: block;
      src: url(https://cdn.jsdelivr.net/npm/@eox/ui@0.3.4/dist/material-symbols-subset.woff2) format("woff2");
    }
  
    eox-chart,
    eox-drawtools,
    eox-feedback,
    eox-geosearch,
    eox-itemfilter,
    eox-jsonform,
    eox-layercontrol,
    eox-map,
    eox-stacinfo,
    eox-storytelling,
    eox-timecontrol {
      font-family: var(--font);
      font-size: .875rem;
      line-height: 1.5rem;
      letter-spacing: .0313rem;
    }
    ${t}
  `,document.head.appendChild(i)}},getElement=a=>{let e;if(typeof a=="string"){const t=i=>i.querySelector(a);if(e=t(document),!e){const i=document.querySelectorAll("html *");for(let s=0;s<i.length&&!(i[s].shadowRoot&&(e=t(i[s].shadowRoot),e));s++);}}else e=a;return e};function setCenterMethod(a,e){let t;const i=(a==null?void 0:a.length)&&coordinatesRoughlyEquals(a,e.map.getView().getCenter());return a&&!i&&(!e.projection||e.projection==="EPSG:3857"?t=getCenterFromProperty(a):t=a),t}function setZoomExtentMethod(a,e){if(!a||!a.length)return;const t=e.map.getView();return cancelAnimation(t),setTimeout(()=>t.fit(a,e.animationOptions),0),a}function setControlsMethod(a,e,t){const i=a;if(e){const s=Object.keys(e),n=Object.keys(i);for(let o=0,l=s.length;o<l;o++){const h=s[o];n.includes(h)||t.removeControl(h)}}if(i){const s=Object.keys(a);for(let n=0,o=s.length;n<o;n++){const l=s[n];addOrUpdateControl(t,e,l,a[l])}}return i}function setLayersMethod(layers,oldLayers,EOxMap){const newLayers=eval("("+serialize(layers)+")");oldLayers&&oldLayers.forEach(a=>{var e,t;if(!((e=a.properties)!=null&&e.id)||!newLayers.find(i=>i.properties.id===a.properties.id)){const i=getLayerById(EOxMap,(t=a.properties)==null?void 0:t.id),n=i.get("_jsonDefinition").interactions;n==null||n.forEach(o=>{o.type==="select"?EOxMap.removeSelect(o.options.id):EOxMap.removeInteraction(o.options.id)}),EOxMap.map.removeLayer(i)}}),newLayers.forEach(a=>{EOxMap.addOrUpdateLayer(a)});const sortedIds=newLayers.map(a=>{var e;return(e=a.properties)==null?void 0:e.id});EOxMap.map.getLayers().getArray().sort((a,e)=>sortedIds.indexOf(a.get("id"))-sortedIds.indexOf(e.get("id")));let minMax=EOxMap.map.getLayers().getArray().reduce((a,e)=>{var t,i,s,n,o,l,h,c;return a.maxZoom=(i=(t=EOxMap.config)==null?void 0:t.view)!=null&&i.maxZoom?(n=(s=EOxMap.config)==null?void 0:s.view)==null?void 0:n.maxZoom:a.maxZoom===void 0||e.get("maxZoom")<a.maxZoom?e.get("maxZoom"):a.maxZoom,a.minZoom=(l=(o=EOxMap.config)==null?void 0:o.view)!=null&&l.minZoom?(c=(h=EOxMap.config)==null?void 0:h.view)==null?void 0:c.minZoom:a.minZoom===void 0||e.get("minZoom")>a.minZoom?e.get("minZoom"):a.minZoom,a},{minZoom:0,maxZoom:1/0});EOxMap.map.getLayers().getArray().map(a=>a.setMinZoom(a.get("minZoom")-1e-12));const currentMinZoom=EOxMap.map.getView().getMinZoom(),currentMaxZoom=EOxMap.map.getView().getMaxZoom();return currentMinZoom!==minMax.minZoom&&EOxMap.map.getView().setMinZoom(minMax.minZoom>=0?minMax.minZoom:0),currentMaxZoom!==minMax.maxZoom&&EOxMap.map.getView().setMaxZoom(minMax.maxZoom),EOxMap.map.on("moveend",()=>{var t;if(!((t=EOxMap==null?void 0:EOxMap.controls)!=null&&t.Zoom))return;const a=EOxMap.renderRoot.querySelector("button.ol-zoom-out"),e=EOxMap.renderRoot.querySelector("button.ol-zoom-in");EOxMap.map.getView().getZoom()>=minMax.maxZoom?e==null||e.classList.add("disabled"):e==null||e.classList.remove("disabled"),EOxMap.map.getView().getZoom()-1e-12<=minMax.minZoom?a==null||a.classList.add("disabled"):a==null||a.classList.remove("disabled")}),newLayers}function setPreventScrollMethod(a,e){return a?(removeDefaultScrollInteractions(e.map),addScrollInteractions(e.map,!0)):addScrollInteractions(e.map),a}function setConfigMethod(a,e){var t,i,s,n,o,l,h,c;return Object.assign(e,{...(a==null?void 0:a.animationOptions)!==void 0?{animationOptions:a.animationOptions}:{},projection:((t=a==null?void 0:a.view)==null?void 0:t.projection)||"EPSG:3857",layers:(a==null?void 0:a.layers)||[],controls:(a==null?void 0:a.controls)||{},...(a==null?void 0:a.preventScroll)!==void 0&&e.preventScroll===void 0?{preventScroll:a==null?void 0:a.preventScroll}:{},zoom:((i=a==null?void 0:a.view)==null?void 0:i.zoom)||0,center:((s=a==null?void 0:a.view)==null?void 0:s.center)||[0,0],zoomExtent:(n=a==null?void 0:a.view)==null?void 0:n.zoomExtent}),(o=a==null?void 0:a.view)!=null&&o.minZoom&&e.map.getView().setMinZoom((l=a==null?void 0:a.view)==null?void 0:l.minZoom),(h=a==null?void 0:a.view)!=null&&h.maxZoom&&e.map.getView().setMaxZoom((c=a==null?void 0:a.view)==null?void 0:c.maxZoom),a}function setProjectionMethod(a,e,t){let i=e;const s=t.map.getView();if(a&&get(a)&&a!==s.getProjection().getCode()){const n=transform$1(s.getCenter(),s.getProjection().getCode(),a),o=get(a),l=s.getResolution(),h=s.getProjection().getMetersPerUnit(),c=o.getMetersPerUnit(),d=getPointResolution(s.getProjection(),1/h,s.getCenter(),"m")*h,u=getPointResolution(o,1/c,n,"m")*c,f=l*d/u,_=new View({zoom:s.getZoom(),center:n,resolution:f,rotation:s.getRotation(),projection:a});["change:center","change:resolution","change:rotation","propertychange"].forEach(v=>{const p=s.getListeners(v);if(p!=null&&p.length)for(let y=p.length-1;y>=0;y--){const b=p[y];s.un(v,b),_.on(v,b)}}),t.map.setView(_),t.getFlatLayersArray(t.map.getLayers().getArray()).filter(v=>v instanceof VectorLayer).forEach(v=>v.getSource().refresh()),i=a,t.center=n}return i}function setSyncMethod(a,e){return a&&setTimeout(()=>{const t=getElement(a);t&&(e.clientHeight<1&&!t.zoom?t.map.setView(e.map.getView()):e.map.setView(t.map.getView()))}),a}function getLonLatCenterMethod(a){var e;if(a.projection==="globe"){const t=(e=a.globe)==null?void 0:e.planet.camera.getLonLat();return[(t==null?void 0:t.lon)??0,(t==null?void 0:t.lat)??0]}return a.projection==="EPSG:4326"?a.map.getView().getCenter():transform(a.map.getView().getCenter(),a.projection)}function getLonLatExtentMethod(a){var t;if(a.projection==="globe"){const i=(t=a.globe)==null?void 0:t.planet.camera.getLonLat();if(!i||typeof i.height>"u")return[-180,-90,180,90];const s=Math.log2(2705e4/i.height)+1,n=[i.lon,i.lat],o=new View({zoom:s,center:transform(n,"EPSG:4326",a.projection),projection:a.projection});return o.setCenter(transform(n,"EPSG:4326",a.projection)),transformExtent(o.calculateExtent(a.map.getSize()),a.projection)}const e=a.map.getView().calculateExtent(a.map.getSize());return a.projection==="EPSG:4326"?e:transformExtent(e,a.projection)}function getZoomExtentMethod(a){return a.map.getView().calculateExtent(a.map.getSize())}function addOrUpdateLayerMethod(a,e){var n;a.interactions||(a.interactions=[]);const t=(n=a.properties)==null?void 0:n.id,i=t?getLayerById(e,t):!1;let s;return i?(updateLayer(e,a,i),s=i):(s=createLayer(e,a),e.map.addLayer(s)),s}function removeInteractionMethod(a,e){e.map.removeInteraction(e.interactions[a]),delete e.interactions[a],e.interactions[`${a}_modify`]&&(e.map.removeInteraction(e.interactions[`${a}_modify`]),delete e.interactions[`${a}_modify`])}function removeSelectMethod(a,e){e.selectInteractions[a].remove(),delete e.selectInteractions[a]}function removeControlMethod(a,e){e.map.removeControl(e.mapControls[a]),delete e.mapControls[a]}function firstUpdatedMethod(a,e){e.map.once("change:target",i=>{i.target.getView().setCenter(e.center)});const t=e.renderRoot.querySelector("div#map");e.map.setTarget(t),a?e.map.getView().fit(a,e.animationOptions):animateToStateMethod(e),e.map.on("loadend",()=>{e.dispatchEvent(new CustomEvent("loadend",{detail:e.map}))}),e.dispatchEvent(new CustomEvent("mapmounted",{detail:e.map}))}const $i=2*Math.PI,po=Math.PI/2,rr=Number.MAX_VALUE||17976931348623157e292,fn=Math.log(2),Ee=2147483647,yt=549755748352,Tt=-549755748352,G=Math.PI/180,Q=180/Math.PI,Vr=2*Q,Kt=.5*G,mo=Math.sqrt(.5),vo=1e-5,re=1e-10,nr=1e-12,or=1e-14;function Xi(a,e,t){return Math.max(e,Math.min(a,t))}function Zi(a){return!(a&a-1)}function We(a,e=4096){--a;for(let t=1;t<32;t<<=1)a|=a>>t;return a+1>e?e:a+1}function Oi(a=0,e=1){return Math.floor(Math.random()*(e-a))+a}function yo(a,e){return(a%e+e)%e}function Ve(a){const e=yo(a,$i);return Math.abs(e)<or&&Math.abs(a)>or?$i:e}function ii(a){const e=Math.abs(a);return e-Math.floor(e)}function xo(a,e,t){return t+a*(e-t)}function Ns(a){return a*a*a}function Hs(a){return a*a}function ar(a){return a-360*Math.floor(a/360)}Object.freeze(Object.defineProperty({__proto__:null,ARCSECONDS_TO_RADIANS:484813681109536e-20,DEG2RAD:function(a){return a*G},DEGREES:Q,DEGREES_DOUBLE:Vr,DEGREES_TO_HOURS:1/15,EPS1:.1,EPS10:re,EPS11:1e-11,EPS12:nr,EPS13:1e-13,EPS14:or,EPS15:1e-15,EPS16:1e-16,EPS17:1e-17,EPS18:1e-18,EPS19:1e-19,EPS2:.01,EPS20:1e-20,EPS3:.001,EPS4:1e-4,EPS5:vo,EPS6:1e-6,EPS7:1e-7,EPS8:1e-8,EPS9:1e-9,HOURS_TO_DEGREES:15,HOURS_TO_RADIANS:.26179938779914946,LOG2:fn,MAX:yt,MAX32:Ee,MAX_FLOAT:rr,MIN:Tt,PI_TWO:po,RAD2DEG:function(a){return a*Q},RADIANS:G,RADIANS_HALF:Kt,RADIANS_TO_HOURS:3.819718634205488,SQRT_HALF:mo,TWO_PI:$i,W:3,X:0,Y:1,Z:2,bezier1v:function(a,e,t,i,s){return Ns(1-a)*e+3*Hs(1-a)*a*t+3*(1-a)*Hs(a)*i+Ns(a)*s},bezier3v:function(a,e,t,i,s){let n=1-a,o=a*a,l=n*n,h=l*n,c=o*a;return e.scaleTo(h).addA(t.scaleTo(3*l*a)).addA(i.scaleTo(3*n*o)).addA(s.scaleTo(c))},clamp:Xi,cube:Ns,degToDec:function(a,e,t,i){return i?a+e/60+t/3600:-a-e/60-t/3600},exp2:function(a){return Math.pow(2,a)},frac:ii,getAngleBetweenAzimuths:function(a,e){return(((a=Ve(a))-(e=Ve(e)))%360+360+180)%360-180},isPowerOfTwo:Zi,lerp:xo,log:function(a,e){return Math.log(a)/Math.log(e)},log2:function(a){return Math.log(a)/fn},mod:yo,negativePItoPI:function(a){return Ve(a+Math.PI)-Math.PI},nextHighestPowerOfTwo:We,norm_lon:function(a){return a>180?(a+180)%360-180:a<-180?(a-180)%360+180:a},pow2i:function(a){return 2<<a-1},random:function(a=0,e=1){return Math.random()*(e-a)+a},randomi:Oi,rev:ar,slice:function(a,e,t){return a*(e-t)},solve_iteration:function(a,e,t,i=50){let s=0,n=e;for(let o=0;o<i;o++)if(s=n,n=a(s),Math.abs(n-s)<t)return n;return n},solve_iteration_fixed:function(a,e,t){let i=0,s=e;for(let n=0;n<t;n++)i=s,s=a(i);return s},square:Hs,step:function(a,e){return e<a?0:1},zeroTwoPI:Ve},Symbol.toStringTag,{value:"Module"}));const Ra=.5*Math.PI,bo=180/Math.PI,Ma=2*bo,Vs=Math.PI/360,Ba=bo*Ra;class A{constructor(e=0,t=0,i=0){this.lon=0,this.lat=0,this.height=0,this.lon=e,this.lat=t,this.height=i}isZero(){return this.lon===0&&this.lat===0&&this.height===0}static join(e){let t=[];for(let i=0;i<e.length;i++){let s=e[i];t[i]=new A(s[0],s[1],s[2])}return t}static createFromArray(e){return new A(e[0],e[1],e[2])}static toArray(e){return[e.lon,e.lat,e.height]}toArray(){return A.toArray(this)}static forwardMercator(e,t,i){return new A(e*Ni,Math.log(Math.tan((90+t)*Vs))*Ye,i)}static forwardMercatorRes(e,t){return t.lon=e.lon*Ni,t.lat=Math.log(Math.tan((90+e.lat)*Vs))*Ye,t.height=e.height,t}static inverseMercator(e,t,i=0){return new A(e*wo,Ma*Math.atan(Math.exp(t*Ur))-Ba,i)}set(e=0,t=0,i=0){return this.lon=e,this.lat=t,this.height=i,this}copy(e){return this.lon=e.lon,this.lat=e.lat,this.height=e.height,this}clone(){return new A(this.lon,this.lat,this.height)}forwardMercator(){return A.forwardMercator(this.lon,this.lat,this.height)}forwardMercatorEPS01(){let e=this.lat;return e>89.9?e=89.9:e<-89.9&&(e=-89.9),new A(this.lon*Ni,Math.log(Math.tan((90+e)*Vs))*Ye)}inverseMercator(){return A.inverseMercator(this.lon,this.lat,this.height)}equal(e){return e.height?this.lon===e.lon&&this.lat===e.lat&&this.height===e.height:this.lon===e.lon&&this.lat===e.lat}}const At=2003750834e-2,Ki=2*At,Ur=Math.PI/At,Ye=At/Math.PI,ka=.5*Math.PI,Ni=At/180,wo=180/At,To=Math.PI/360,gn=Math.PI/180,Ia=180/Math.PI,Co=2*At,si=1/Co;function Qi(a){return new A(a.lon*At/180,Math.log(Math.tan((90+a.lat)*To))*Ye,a.height)}function ri(a){return a*At/180}function ni(a){return Math.log(Math.tan((90+a)*To))*Ye}function Eo(a){return Ia*(2*Math.atan(Math.exp(a*Ur))-ka)}function Xe(a,e,t){let i=Ki/(1<<t),s=new A(a*i-2003750834e-2,At-e*i-i);return new V(s,new A(s.lon+i,s.lat+i))}const ht=Eo(At),Ft=-ht;Object.freeze(Object.defineProperty({__proto__:null,INV_POLE_BY_180:wo,MAX_LAT:ht,MIN_LAT:Ft,ONE_BY_POLE_DOUBLE:si,PI_BY_POLE:Ur,POLE:At,POLE2:Ki,POLE_BY_180:Ni,POLE_BY_PI:Ye,POLE_DOUBLE:Co,forward:Qi,forwardArray:function(a){let e=[];for(let t=0;t<a.length;t++)e.push(a[t].forwardMercator());return e},forward_lat:ni,forward_lon:ri,getTileExtent:Xe,getTileX:function(a,e){return Math.floor((a+180)/360*Math.pow(2,e))},getTileY:function(a,e){return Math.floor(.5*(1-Math.log(Math.tan(a*gn)+1/Math.cos(a*gn))/Math.PI)*Math.pow(2,e))},inverse_lat:Eo,inverse_lon:function(a){return 180*a/At}},Symbol.toStringTag,{value:"Module"}));class V{constructor(e=new A,t=new A){this.southWest=e,this.northEast=t}static createFromArray(e){return new V(new A(e[0],e[1]),new A(e[2],e[3]))}static createByCoordinates(e){let t=yt,i=Tt,s=yt,n=Tt;for(let o=0;o<e.length;o++){const l=e[o];l.lon<t&&(t=l.lon),l.lon>i&&(i=l.lon),l.lat<s&&(s=l.lat),l.lat>n&&(n=l.lat)}return new V(new A(t,s),new A(i,n))}static createByCoordinatesArr(e){let t=yt,i=Tt,s=yt,n=Tt;for(let o=0;o<e.length;o++){const l=e[o];l[0]<t&&(t=l[0]),l[0]>i&&(i=l[0]),l[1]<s&&(s=l[1]),l[1]>n&&(n=l[1])}return new V(new A(t,s),new A(i,n))}static fromTile(e,t,i,s=4007501668e-2,n=4007501668e-2){const o=1<<i,l=s/o,h=n/o,c=.5*-s+e*l,d=.5*n-t*h,u=c+l;return new V(new A(c,d-h),new A(u,d))}setByCoordinates(e){let t=yt,i=Tt,s=yt,n=Tt;for(let o=0;o<e.length;o++){const l=e[o];l.lon<t&&(t=l.lon),l.lon>i&&(i=l.lon),l.lat<s&&(s=l.lat),l.lat>n&&(n=l.lat)}return this.southWest.lon=t,this.southWest.lat=s,this.northEast.lon=i,this.northEast.lat=n,this}isInside(e){const t=this.southWest,i=this.northEast;return e.lon>=t.lon&&e.lon<=i.lon&&e.lat>=t.lat&&e.lat<=i.lat}overlaps(e){const t=this.southWest,i=this.northEast;return t.lon<=e.northEast.lon&&i.lon>=e.southWest.lon&&t.lat<=e.northEast.lat&&i.lat>=e.southWest.lat}getWidth(){return this.northEast.lon-this.southWest.lon}getHeight(){return this.northEast.lat-this.southWest.lat}clone(){return new V(this.southWest.clone(),this.northEast.clone())}getCenter(){const e=this.southWest,t=this.northEast;return new A(e.lon+.5*(t.lon-e.lon),e.lat+.5*(t.lat-e.lat))}getNorthWest(){return new A(this.southWest.lon,this.northEast.lat)}getNorthEast(){return new A(this.northEast.lon,this.northEast.lat)}getSouthWest(){return new A(this.southWest.lon,this.southWest.lat)}getSouthEast(){return new A(this.northEast.lon,this.southWest.lat)}getNorth(){return this.northEast.lat}getEast(){return this.northEast.lon}getWest(){return this.southWest.lon}getSouth(){return this.southWest.lat}equals(e){return this.southWest.lon===e.southWest.lon&&this.southWest.lat===e.southWest.lat&&this.northEast.lon===e.northEast.lon&&this.northEast.lat===e.northEast.lat}forwardMercator(){return new V(this.southWest.forwardMercator(),this.northEast.forwardMercator())}inverseMercator(){return new V(this.southWest.inverseMercator(),this.northEast.inverseMercator())}getCartesianBounds(e){let t=yt,i=Tt,s=yt,n=Tt,o=yt,l=Tt;const h=[new A(this.southWest.lon,this.southWest.lat),new A(this.southWest.lon,this.northEast.lat),new A(this.northEast.lon,this.northEast.lat),new A(this.northEast.lon,this.southWest.lat)];for(let c=0;c<h.length;c++){const d=e.lonLatToCartesian(h[c]),u=d.x,f=d.y,_=d.z;u<t&&(t=u),u>i&&(i=u),f<s&&(s=f),f>n&&(n=f),_<o&&(o=_),_>l&&(l=_)}return[t,s,o,i,n,l]}toString(){return`[${this.southWest.lon.toFixed(5)}, ${this.southWest.lat.toFixed(5)}, ${this.northEast.lon.toFixed(5)}, ${this.northEast.lat.toFixed(5)}]`}}class Pe{constructor(){this._m=[0,0,0,0,0,0,0,0,0]}set(e){return this._m[0]=e[0],this._m[1]=e[1],this._m[2]=e[2],this._m[3]=e[3],this._m[4]=e[4],this._m[5]=e[5],this._m[6]=e[6],this._m[7]=e[7],this._m[8]=e[8],this}clone(){let e=new Pe;return e.set(this._m),e}copy(e){return this.set(e._m)}transposeTo(){let e=new Pe,t=this._m;return e._m[0]=t[0],e._m[1]=t[3],e._m[2]=t[6],e._m[3]=t[1],e._m[4]=t[4],e._m[5]=t[7],e._m[6]=t[2],e._m[7]=t[5],e._m[8]=t[8],e}setIdentity(){return this._m[0]=1,this._m[1]=0,this._m[2]=0,this._m[3]=0,this._m[4]=1,this._m[5]=0,this._m[6]=0,this._m[7]=0,this._m[8]=1,this}mulVec(e){let t=e.x,i=e.y,s=e.z,n=this._m;return new m(n[0]*t+n[3]*i+n[6]*s,n[1]*t+n[4]*i+n[7]*s,n[2]*t+n[5]*i+n[8]*s)}getMat4(){let e=new J,t=e._m,i=this._m;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=0,t[4]=i[3],t[5]=i[4],t[6]=i[5],t[7]=0,t[8]=i[6],t[9]=i[7],t[10]=i[8],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,e}}class tt{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}static get identity(){return new tt(0,0,0,1)}static fromVec(e){return new tt(e[0],e[1],e[2],e[3])}toVec3(){return new m(this.x,this.y,this.z)}clone(){return new tt(this.x,this.y,this.z,this.w)}equal(e){return this.x===e.x&&this.y===e.y&&this.z===e.z&&this.w===e.w}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toArray(){return[this.x,this.y,this.z,this.w]}toArray3(){return[this.x,this.y,this.z]}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}addA(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}subA(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}scale(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}affinity(){let e=1/this.w;return this.x*=e,this.y*=e,this.z*=e,this.w=1,this}scaleTo(e){return new tt(this.x*e,this.y*e,this.z*e,this.w*e)}getStep(e){return new tt(this.x<e?0:1,this.y<e?0:1,this.z<e?0:1,this.w<e?0:1)}getFrac(e){return new tt(ii(e.x),ii(e.y),ii(e.z),ii(e.w))}dot(e){return e.x*this.x+e.y*this.y+e.z*this.z+e.w*this.w}isZero(){return!(this.x||this.y||this.z||this.w)}}class J{constructor(){this._m=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}static identity(){let e=new J;return e._m[0]=1,e._m[1]=0,e._m[2]=0,e._m[3]=0,e._m[4]=0,e._m[5]=1,e._m[6]=0,e._m[7]=0,e._m[8]=0,e._m[9]=0,e._m[10]=1,e._m[11]=0,e._m[12]=0,e._m[13]=0,e._m[14]=0,e._m[15]=1,e}static getRotationAroundPoint(e,t=m.ZERO,i=m.UP){let s=J.getRotation(e,i),n=new J().setIdentity().translate(t),o=new J().setIdentity().translate(t.negateTo());return n.mul(s).mul(o)}static getRotation(e,t=m.UP){return new J().setRotation(t,e)}getPosition(){return new m(this._m[12],this._m[13],this._m[14])}getScaling(){let e=this._m[0],t=this._m[1],i=this._m[2],s=this._m[4],n=this._m[5],o=this._m[6],l=this._m[8],h=this._m[9],c=this._m[10];return new m(Math.sqrt(e*e+t*t+i*i),Math.sqrt(s*s+n*n+o*o),Math.sqrt(l*l+h*h+c*c))}getQuat(){let e=this.getScaling();const t=[0,0,0,1];let i=1/e.x,s=1/e.y,n=1/e.z,o=this._m[0]*i,l=this._m[1]*s,h=this._m[2]*n,c=this._m[4]*i,d=this._m[5]*s,u=this._m[6]*n,f=this._m[8]*i,_=this._m[9]*s,g=this._m[10]*n,v=o+d+g,p=0;return v>0?(p=2*Math.sqrt(v+1),t[3]=.25*p,t[0]=(u-_)/p,t[1]=(f-h)/p,t[2]=(l-c)/p):o>d&&o>g?(p=2*Math.sqrt(1+o-d-g),t[3]=(u-_)/p,t[0]=.25*p,t[1]=(l+c)/p,t[2]=(f+h)/p):d>g?(p=2*Math.sqrt(1+d-o-g),t[3]=(f-h)/p,t[0]=(l+c)/p,t[1]=.25*p,t[2]=(u+_)/p):(p=2*Math.sqrt(1+g-o-d),t[3]=(l-c)/p,t[0]=(f+h)/p,t[1]=(u+_)/p,t[2]=.25*p),new D(...t)}set(e){return this._m[0]=e[0],this._m[1]=e[1],this._m[2]=e[2],this._m[3]=e[3],this._m[4]=e[4],this._m[5]=e[5],this._m[6]=e[6],this._m[7]=e[7],this._m[8]=e[8],this._m[9]=e[9],this._m[10]=e[10],this._m[11]=e[11],this._m[12]=e[12],this._m[13]=e[13],this._m[14]=e[14],this._m[15]=e[15],this}clone(){let e=new J;return e.set(this._m),e}copy(e){return this.set(e._m)}getMat3(){let e=new Pe,t=this._m,i=e._m;return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[4],i[4]=t[5],i[5]=t[6],i[6]=t[8],i[7]=t[9],i[8]=t[10],e}mulVec3(e){let t=e.x,i=e.y,s=e.z;return new m(this._m[0]*t+this._m[4]*i+this._m[8]*s+this._m[12],this._m[1]*t+this._m[5]*i+this._m[9]*s+this._m[13],this._m[2]*t+this._m[6]*i+this._m[10]*s+this._m[14])}mulVec4(e){let t=e.x,i=e.y,s=e.z,n=e.w;return new tt(this._m[0]*t+this._m[4]*i+this._m[8]*s+this._m[12]*n,this._m[1]*t+this._m[5]*i+this._m[9]*s+this._m[13]*n,this._m[2]*t+this._m[6]*i+this._m[10]*s+this._m[14]*n,this._m[3]*t+this._m[7]*i+this._m[11]*s+this._m[15]*n)}toInverseMatrix3(){let e=this._m,t=e[0],i=e[1],s=e[2],n=e[4],o=e[5],l=e[6],h=e[8],c=e[9],d=e[10],u=d*o-l*c,f=-d*n+l*h,_=c*n-o*h,g=t*u+i*f+s*_;if(!g)return;g=1/g;let v=new Pe;return v._m[0]=u*g,v._m[1]=(-d*i+s*c)*g,v._m[2]=(l*i-s*o)*g,v._m[3]=f*g,v._m[4]=(d*t-s*h)*g,v._m[5]=(-l*t+s*n)*g,v._m[6]=_*g,v._m[7]=(-c*t+i*h)*g,v._m[8]=(o*t-i*n)*g,v}inverseTo(e=new J){let t=this._m[0],i=this._m[1],s=this._m[2],n=this._m[3],o=this._m[4],l=this._m[5],h=this._m[6],c=this._m[7],d=this._m[8],u=this._m[9],f=this._m[10],_=this._m[11],g=this._m[12],v=this._m[13],p=this._m[14],y=this._m[15],b=t*l-i*o,C=t*h-s*o,T=t*c-n*o,w=i*h-s*l,L=i*c-n*l,S=s*c-n*h,P=d*v-u*g,B=d*p-f*g,k=d*y-_*g,I=u*p-f*v,z=u*y-_*v,Ce=f*y-_*p,R=1/(b*Ce-C*z+T*I+w*k-L*B+S*P);return e._m[0]=(l*Ce-h*z+c*I)*R,e._m[1]=(-i*Ce+s*z-n*I)*R,e._m[2]=(v*S-p*L+y*w)*R,e._m[3]=(-u*S+f*L-_*w)*R,e._m[4]=(-o*Ce+h*k-c*B)*R,e._m[5]=(t*Ce-s*k+n*B)*R,e._m[6]=(-g*S+p*T-y*C)*R,e._m[7]=(d*S-f*T+_*C)*R,e._m[8]=(o*z-l*k+c*P)*R,e._m[9]=(-t*z+i*k-n*P)*R,e._m[10]=(g*L-v*T+y*b)*R,e._m[11]=(-d*L+u*T-_*b)*R,e._m[12]=(-o*I+l*B-h*P)*R,e._m[13]=(t*I-i*B+s*P)*R,e._m[14]=(-g*w+v*C-p*b)*R,e._m[15]=(d*w-u*C+f*b)*R,e}transposeTo(){let e=new J;return e._m[0]=this._m[0],e._m[1]=this._m[4],e._m[2]=this._m[8],e._m[3]=this._m[12],e._m[4]=this._m[1],e._m[5]=this._m[5],e._m[6]=this._m[9],e._m[7]=this._m[13],e._m[8]=this._m[2],e._m[9]=this._m[6],e._m[10]=this._m[10],e._m[11]=this._m[14],e._m[12]=this._m[3],e._m[13]=this._m[7],e._m[14]=this._m[11],e._m[15]=this._m[15],e}setIdentity(){return this._m[0]=1,this._m[1]=0,this._m[2]=0,this._m[3]=0,this._m[4]=0,this._m[5]=1,this._m[6]=0,this._m[7]=0,this._m[8]=0,this._m[9]=0,this._m[10]=1,this._m[11]=0,this._m[12]=0,this._m[13]=0,this._m[14]=0,this._m[15]=1,this}mul(e){let t=this._m[0],i=this._m[1],s=this._m[2],n=this._m[3],o=this._m[4],l=this._m[5],h=this._m[6],c=this._m[7],d=this._m[8],u=this._m[9],f=this._m[10],_=this._m[11],g=this._m[12],v=this._m[13],p=this._m[14],y=this._m[15],b=e._m[0],C=e._m[1],T=e._m[2],w=e._m[3],L=e._m[4],S=e._m[5],P=e._m[6],B=e._m[7],k=e._m[8],I=e._m[9],z=e._m[10],Ce=e._m[11],R=e._m[12],O=e._m[13],se=e._m[14],M=e._m[15],F=new J;return F._m[0]=b*t+C*o+T*d+w*g,F._m[1]=b*i+C*l+T*u+w*v,F._m[2]=b*s+C*h+T*f+w*p,F._m[3]=b*n+C*c+T*_+w*y,F._m[4]=L*t+S*o+P*d+B*g,F._m[5]=L*i+S*l+P*u+B*v,F._m[6]=L*s+S*h+P*f+B*p,F._m[7]=L*n+S*c+P*_+B*y,F._m[8]=k*t+I*o+z*d+Ce*g,F._m[9]=k*i+I*l+z*u+Ce*v,F._m[10]=k*s+I*h+z*f+Ce*p,F._m[11]=k*n+I*c+z*_+Ce*y,F._m[12]=R*t+O*o+se*d+M*g,F._m[13]=R*i+O*l+se*u+M*v,F._m[14]=R*s+O*h+se*f+M*p,F._m[15]=R*n+O*c+se*_+M*y,F}translate(e){let t=e.x,i=e.y,s=e.z,n=this._m;return n[12]=n[0]*t+n[4]*i+n[8]*s+n[12],n[13]=n[1]*t+n[5]*i+n[9]*s+n[13],n[14]=n[2]*t+n[6]*i+n[10]*s+n[14],n[15]=n[3]*t+n[7]*i+n[11]*s+n[15],this}translateToPosition(e){let t=this._m;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this}rotate(e,t){let i=Math.cos(t),s=Math.sin(t),n=new J,o=n._m;return o[0]=i+(1-i)*e.x*e.x,o[1]=(1-i)*e.y*e.x-s*e.z,o[2]=(1-i)*e.z*e.x+s*e.y,o[3]=0,o[4]=(1-i)*e.x*e.y+s*e.z,o[5]=i+(1-i)*e.y*e.y,o[6]=(1-i)*e.z*e.y-s*e.x,o[7]=0,o[8]=(1-i)*e.x*e.z-s*e.y,o[9]=(1-i)*e.y*e.z+s*e.x,o[10]=i+(1-i)*e.z*e.z,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,this.mul(n)}setRotation(e,t){let i=Math.cos(t),s=Math.sin(t),n=this._m;return n[0]=i+(1-i)*e.x*e.x,n[1]=(1-i)*e.y*e.x-s*e.z,n[2]=(1-i)*e.z*e.x+s*e.y,n[3]=0,n[4]=(1-i)*e.x*e.y+s*e.z,n[5]=i+(1-i)*e.y*e.y,n[6]=(1-i)*e.z*e.y-s*e.x,n[7]=0,n[8]=(1-i)*e.x*e.z-s*e.y,n[9]=(1-i)*e.y*e.z+s*e.x,n[10]=i+(1-i)*e.z*e.z,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}rotateBetweenVectors(e,t){return D.getRotationBetweenVectors(e,t).getMat4()}scale(e){let t=this._m;return t[0]=t[0]*e.x,t[1]=t[1]*e.x,t[2]=t[2]*e.x,t[3]=t[3]*e.x,t[4]=t[4]*e.y,t[5]=t[5]*e.y,t[6]=t[6]*e.y,t[7]=t[7]*e.y,t[8]=t[8]*e.z,t[9]=t[9]*e.z,t[10]=t[10]*e.z,t[11]=t[11]*e.z,this}setPerspective(e,t,i,s,n,o){let l=t-e,h=s-i,c=n-o,d=2*n,u=this._m;return u[0]=d/l,u[1]=0,u[2]=0,u[3]=0,u[4]=0,u[5]=d/h,u[6]=0,u[7]=0,u[8]=(t+e)/l,u[9]=(s+i)/h,u[10]=(o+n)/c,u[11]=-1,u[12]=0,u[13]=0,u[14]=d*o/c,u[15]=0,this}setOrthographic(e,t,i,s,n,o){let l=1/(e-t),h=1/(i-s),c=1/(n-o),d=this._m;return d[0]=-2*l,d[1]=0,d[2]=0,d[3]=0,d[4]=0,d[5]=-2*h,d[6]=0,d[7]=0,d[8]=0,d[9]=0,d[10]=2*c,d[11]=0,d[12]=(e+t)*l,d[13]=(s+i)*h,d[14]=(o+n)*c,d[15]=1,this}eulerToMatrix(e,t,i){let s=Math.cos(e),n=Math.sin(e),o=Math.cos(t),l=Math.sin(t),h=Math.cos(i),c=Math.sin(i),d=s*l,u=n*l,f=this._m;return f[0]=o*h,f[1]=-o*c,f[2]=-l,f[4]=-u*h+s*c,f[5]=u*c+s*h,f[6]=-n*o,f[8]=d*h+n*c,f[9]=-d*c+n*h,f[10]=s*o,f[3]=f[7]=f[11]=f[12]=f[13]=f[14]=0,f[15]=1,this}}class D{constructor(e=0,t=0,i=0,s=0){this.x=e,this.y=t,this.z=i,this.w=s}static get IDENTITY(){return new D(0,0,0,1)}static xRotation(e){return e*=.5,new D(Math.sin(e),0,0,Math.cos(e))}static yRotation(e){return e*=.5,new D(0,Math.sin(e),0,Math.cos(e))}static zRotation(e){return e*=.5,new D(0,0,Math.sin(e),Math.cos(e))}static axisAngleToQuat(e,t=0){let i=e.getNormal(),s=.5*t,n=Math.sin(s);return new D(i.x*n,i.y*n,i.z*n,Math.cos(s))}static getLookRotation(e,t){let i=e.getNormal().negate(),s=t.cross(i).normalize(),n=i.cross(s),o=1+s.x+n.y+i.z;if(o>1e-6){let h=1/(2*Math.sqrt(o));return new D((i.y-n.z)*h,(s.z-i.x)*h,(n.x-s.y)*h,.25/h)}if(s.x>n.y&&s.x>i.z){let h=1/(2*Math.sqrt(1+s.x-n.y-i.z));return new D(.25/h,(n.x+s.y)*h,(s.z+i.x)*h,(i.y-n.z)*h)}if(n.y>i.z){let h=1/(2*Math.sqrt(1+n.y-s.x-i.z));return new D((n.x+s.y)*h,.25/h,(i.y+n.z)*h,(s.z-i.x)*h)}let l=1/(2*Math.sqrt(1+i.z-s.x-n.y));return new D((s.z+i.x)*l,(i.y+n.z)*l,.25/l,(n.x-s.y)*l)}static getLookAtSourceDest(e,t){let i=t.subA(e).normalize(),s=m.FORWARD.dot(i);if(Math.abs(s- -1)<1e-6)return D.axisAngleToQuat(m.UP,Math.PI);if(Math.abs(s-1)<1e-6)return new D(0,0,0,1);let n=Math.acos(s),o=m.FORWARD.cross(i).normalize();return D.axisAngleToQuat(o,n)}static getRotationBetweenVectors(e,t){let i=e.cross(t);return new D(i.x,i.y,i.z,1+e.dot(t)).normalize()}static getRotationBetweenVectorsRes(e,t,i){let s=e.cross(t);return i.set(s.x,s.y,s.z,1+e.dot(t)),i.normalize()}static getRotationBetweenVectorsUp(e,t,i){let s=e.dot(t);if(Math.abs(s+1)<1e-6)return D.axisAngleToQuat(i,Math.PI);if(Math.abs(s-1)<1e-6)return new D(0,0,0,1);let n=Math.acos(s),o=e.cross(t).normalize();return D.axisAngleToQuat(o,n)}isZero(){return this.x===0&&this.y===0&&this.z===0&&this.w===0}isNaN(){return isNaN(this.x)||isNaN(this.y)||isNaN(this.z)||isNaN(this.w)}clear(){return this.x=this.y=this.z=this.w=0,this}set(e,t,i,s){return this.x=e,this.y=t,this.z=i,this.w=s,this}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}setIdentity(){return this.x=0,this.y=0,this.z=0,this.w=1,this}clone(){return new D(this.x,this.y,this.z,this.w)}add(e){return new D(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)}addRes(e,t){return t.set(this.x+e.x,this.y+e.y,this.z+e.z,this.w+e.w)}sub(e){return new D(this.x-e.x,this.y-e.y,this.z-e.z,this.w-e.w)}scaleTo(e){return new D(this.x*e,this.y*e,this.z*e,this.w*e)}scale(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}toVec(){return[this.x,this.y,this.z,this.w]}get xyz(){return new m(this.x,this.y,this.z)}setLookRotation(e,t){let i=e.getNormal().negate(),s=t.cross(i).normalize(),n=i.cross(s),o=1+s.x+n.y+i.z;if(o>1e-6){let l=1/(2*Math.sqrt(o));this.x=(i.y-n.z)*l,this.y=(s.z-i.x)*l,this.z=(n.x-s.y)*l,this.w=.25/l}else if(s.x>n.y&&s.x>i.z){let l=1/(2*Math.sqrt(1+s.x-n.y-i.z));this.x=.25/l,this.y=(n.x+s.y)*l,this.z=(s.z+i.x)*l,this.w=(i.y-n.z)*l}else if(n.y>i.z){let l=1/(2*Math.sqrt(1+n.y-s.x-i.z));this.x=(n.x+s.y)*l,this.y=.25/l,this.z=(i.y+n.z)*l,this.w=(s.z-i.x)*l}else{let l=1/(2*Math.sqrt(1+i.z-s.x-n.y));this.x=(s.z+i.x)*l,this.y=(i.y+n.z)*l,this.z=.25/l,this.w=(n.x-s.y)*l}return this}setFromSphericalCoords(e,t,i){let s=Math.sin(i/2),n=Math.cos(i/2),o=Math.sin(e),l=Math.cos(e),h=Math.sin(t),c=Math.cos(t);return this.x=s*l*h,this.y=s*o,this.z=s*o*c,this.w=n,this}getSphericalCoords(){let e=this.w,t=Math.sqrt(1-e*e);Math.abs(t)<5e-4&&(t=1);let i,s=this.x/t,n=this.y/t,o=this.z/t,l=-Math.asin(n);return i=s*s+o*o<5e-4?0:Math.atan2(s,o),i<0&&(i+=360),{lat:l,lon:i,alpha:Math.acos(e)}}setFromAxisAngle(e,t){let i=e.getNormal(),s=.5*t,n=Math.sin(s);return this.set(i.x*n,i.y*n,i.z*n,Math.cos(s)),this}getAxisAngle(){let e,t,i=this.x,s=this.y,n=this.z,o=this.w,l=Math.sqrt(i*i+s*s+n*n);if(l>1e-7){let h=1/l;e=new m(i*h,s*h,n*h),t=o<0?2*Math.atan2(-l,-o):2*Math.atan2(l,o)}else e=new m(0,0,0),t=0;return{axis:e,angle:t}}getPitch(){let e=-2*(this.y*this.z-this.w*this.x);return Math.abs(e)>=1?Math.sign(e)*po:Math.asin(e)}getYaw(){return-Math.atan2(2*(this.x*this.z+this.w*this.y),1-2*(this.y*this.y+this.x*this.x))}getRoll(){return Math.atan2(2*(this.x*this.y+this.w*this.z),1-2*(this.z*this.z+this.x*this.x))}setPitchYawRoll(e,t,i,s=D.IDENTITY){let n=D.xRotation(-e),o=D.yRotation(t),l=D.zRotation(-i);return this.copy(l.mul(n).mul(o).mul(s).conjugate())}setFromEulerAngles(e,t,i){let s=e*Kt,n=t*Kt,o=i*Kt,l=Math.cos(s),h=Math.cos(n),c=Math.cos(o),d=Math.sin(s),u=Math.sin(n),f=Math.sin(o),_=h*c,g=u*f;return this.w=l*_+d*g,this.x=d*_-l*g,this.y=l*u*c+d*h*f,this.z=l*h*f-d*u*c,this.normalize()}getEulerAngles(){let e=this.x,t=this.y,i=this.z,s=this.w,n=t*t,o=s*t-i*e;return o<-1?o=-1:o>1&&(o=1),{roll:Math.atan2(2*(s*e+t*i),1-2*(e*e+n)),pitch:Math.asin(2*o),yaw:Math.atan2(2*(s*i+e*t),1-2*(n+i*i))}}setFromMatrix4(e){let t,i,s,n,o,l=[],h=e._m,c=[1,2,0];return t=h[0]+h[5]+h[10],t>0?(i=Math.sqrt(t+1),this.w=i/2,i=.5/i,this.x=(h[6]-h[9])*i,this.y=(h[8]-h[2])*i,this.z=(h[1]-h[4])*i):(s=0,h[5]>h[0]&&(s=1),h[10]>h[5*s]&&(s=2),n=c[s],o=c[n],i=Math.sqrt(h[5*s]-(h[5*n]+h[5*o])+1),l[s]=.5*i,i!==0&&(i=.5/i),l[3]=(h[4*n+o]-h[4*o+n])*i,l[n]=(h[4*s+n]+h[4*n+s])*i,l[o]=(h[4*s+o]+h[4*o+s])*i,this.x=l[0],this.y=l[1],this.z=l[2],this.w=l[3]),this}getMat4(e=new J){let t=this.x+this.x,i=this.y+this.y,s=this.z+this.z,n=this.w*t,o=this.w*i,l=this.w*s,h=this.x*t,c=this.x*i,d=this.x*s,u=this.y*i,f=this.y*s,_=this.z*s;return e.set([1-(u+_),c-l,d+o,0,c+l,1-(h+_),f-n,0,d-o,f+n,1-(h+u),0,0,0,0,1])}getMat3(){let e=new Pe,t=e._m,i=this.x,s=this.y,n=this.z,o=this.w,l=i+i,h=s+s,c=n+n,d=i*l,u=i*h;i*=c;let f=s*h;return s*=c,n*=c,l*=o,h*=o,o*=c,t[0]=1-(f+n),t[1]=u-o,t[2]=i+h,t[3]=u+o,t[4]=1-(d+n),t[5]=s-l,t[6]=i-h,t[7]=s+l,t[8]=1-(d+f),e}mulVec3(e){let t=e.x,i=e.y,s=e.z,n=this.x,o=this.y,l=this.z,h=this.w,c=h*t+o*s-l*i,d=h*i+l*t-n*s,u=h*s+n*i-o*t;return t=-n*t-o*i-l*s,new m(c*h+t*-n+d*-l-u*-o,d*h+t*-o+u*-n-c*-l,u*h+t*-l+c*-o-d*-n)}mulVec3Res(e,t){let i=e.x,s=e.y,n=e.z,o=this.x,l=this.y,h=this.z,c=this.w,d=c*i+l*n-h*s,u=c*s+h*i-o*n,f=c*n+o*s-l*i;return i=-o*i-l*s-h*n,t.set(d*c+i*-o+u*-h-f*-l,u*c+i*-l+f*-o-d*-h,f*c+i*-h+d*-l-u*-o)}mul(e){let t=this.x,i=this.y,s=this.z,n=this.w,o=e.x,l=e.y,h=e.z,c=e.w;return new D(t*c+n*o+i*h-s*l,i*c+n*l+s*o-t*h,s*c+n*h+t*l-i*o,n*c-t*o-i*l-s*h)}mulRes(e,t){let i=this.x,s=this.y,n=this.z,o=this.w,l=e.x,h=e.y,c=e.z,d=e.w;return t.set(i*d+o*l+s*c-n*h,s*d+o*h+n*l-i*c,n*d+o*c+i*h-s*l,o*d-i*l-s*h-n*c)}mulA(e){let t=this.x,i=this.y,s=this.z,n=this.w,o=e.x,l=e.y,h=e.z,c=e.w;return this.x=t*c+n*o+i*h-s*l,this.y=i*c+n*l+s*o-t*h,this.z=s*c+n*h+t*l-i*o,this.w=n*c-t*o-i*l-s*h,this}conjugate(){return new D(-this.x,-this.y,-this.z,this.w)}inverse(){let e=1/this.magnitude2();return new D(-this.x*e,-this.y*e,-this.z*e,this.w*e)}magnitude(){let e=this.x,t=this.y,i=this.z,s=this.w;return Math.sqrt(e*e+t*t+i*i+s*s)}magnitude2(){let e=this.x,t=this.y,i=this.z,s=this.w;return e*e+t*t+i*i+s*s}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}normalize(){let e=this.x,t=this.y,i=this.z,s=this.w,n=Math.sqrt(e*e+t*t+i*i+s*s);return n===0?(this.x=0,this.y=0,this.z=0,this.w=0,this):(n=1/n,this.x=e*n,this.y=t*n,this.z=i*n,this.w=s*n,this)}isEqual(e){let t=this.dot(e);return Math.abs(t-1)<.001}slerp(e,t){let i,s,n,o,l,h=this.x,c=this.y,d=this.z,u=this.w,f=e.x,_=e.y,g=e.z,v=e.w;return s=h*f+c*_+d*g+u*v,s<0&&(s=-s,f=-f,_=-_,g=-g,v=-v),1-s>1e-6?(i=Math.acos(s),n=Math.sin(i),o=Math.sin((1-t)*i)/n,l=Math.sin(t*i)/n):(o=1-t,l=t),new D(o*h+l*f,o*c+l*_,o*d+l*g,o*u+l*v)}}class m{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}static get UP(){return new m(0,1,0)}static get DOWN(){return new m(0,-1,0)}static get RIGHT(){return new m(1,0,0)}static get LEFT(){return new m(-1,0,0)}static get FORWARD(){return new m(0,0,-1)}static get BACKWARD(){return new m(0,0,1)}static get ZERO(){return new m}static get UNIT_X(){return new m(1,0,0)}static get UNIT_Y(){return new m(0,1,0)}static get UNIT_Z(){return new m(0,0,1)}static get NORTH(){return m.UNIT_Z}static doubleToTwoFloats(e,t,i){let s=e.x,n=e.y,o=e.z;if(s>=0){let l=65536*Math.floor(s/65536);t.x=Math.fround(l),i.x=Math.fround(s-l)}else{let l=65536*Math.floor(-s/65536);t.x=Math.fround(-l),i.x=Math.fround(s+l)}if(n>=0){let l=65536*Math.floor(n/65536);t.y=Math.fround(l),i.y=Math.fround(n-l)}else{let l=65536*Math.floor(-n/65536);t.y=Math.fround(-l),i.y=Math.fround(n+l)}if(o>=0){let l=65536*Math.floor(o/65536);t.z=Math.fround(l),i.z=Math.fround(o-l)}else{let l=65536*Math.floor(-o/65536);t.z=Math.fround(-l),i.z=Math.fround(o+l)}}static doubleToTwoFloat32Array(e,t,i){let s=e.x,n=e.y,o=e.z;if(s>=0){let l=65536*Math.floor(s/65536);t[0]=Math.fround(l),i[0]=Math.fround(s-l)}else{let l=65536*Math.floor(-s/65536);t[0]=Math.fround(-l),i[0]=Math.fround(s+l)}if(n>=0){let l=65536*Math.floor(n/65536);t[1]=Math.fround(l),i[1]=Math.fround(n-l)}else{let l=65536*Math.floor(-n/65536);t[1]=Math.fround(-l),i[1]=Math.fround(n+l)}if(o>=0){let l=65536*Math.floor(o/65536);t[2]=Math.fround(l),i[2]=Math.fround(o-l)}else{let l=65536*Math.floor(-o/65536);t[2]=Math.fround(-l),i[2]=Math.fround(o+l)}}static fromVec(e){return new m(e[0],e[1],e[2])}static angle(e,t){let i=e.dot(t),s=e.cross(t).length();return Math.atan2(s,i)}static lerp(e,t,i){return new m(e.x+(t.x-e.x)*i,e.y+(t.y-e.y)*i,e.z+(t.z-e.z)*i)}static add(e,t){let i=new m(e.x,e.y,e.z);return i.addA(t),i}static sub(e,t){let i=new m(e.x,e.y,e.z);return i.subA(t),i}static scale(e,t){return e.scaleTo(t)}static mul(e,t){let i=new m(e.x,e.y,e.z);return i.mulA(t),i}static noncollinear(e,t){return!!(e.y*t.z-e.z*t.y||e.z*t.x-e.x*t.z||e.x*t.y-e.y*t.z)}static proj_b_to_plane(e,t,i){let s=e.sub(t.scaleTo(t.dot(e)/t.dot(t)));return i&&s.isZero()?new m(i.x,i.y,i.z):s}static proj_b_to_a(e,t){return t.scaleTo(t.dot(e)/t.dot(t))}static orthoNormalize(e,t){return(e=e.getNormal()).scale(t.dot(e)),t.subA(e).normalize()}static isOrthogonal(e,t,i=1e-6){const s=e.x*t.x+e.y*t.y+e.z*t.z;return Math.abs(s)<i}isOrthogonal(e,t=1e-6){const i=this.x*e.x+this.y*e.y+this.z*e.z;return Math.abs(i)<t}static div(e,t){let i=new m(e.x,e.y,e.z);return i.divA(t),i}static length2(e){return e.length2()}static dot(e,t){return e.dot(t)}toVec4(){return new tt(this.x,this.y,this.z,1)}clone(){return new m(this.x,this.y,this.z)}toString(){return`(${this.x},${this.y},${this.z})`}isZero(){return!(this.x||this.y||this.z)}projToVec(e){return e.scaleTo(e.dot(this)/e.dot(e))}equal(e){return this.x===e.x&&this.y===e.y&&this.z===e.z}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}length2(){return this.x*this.x+this.y*this.y+this.z*this.z}getQuat(){return new D(this.x,this.y,this.z)}addA(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}add(e){return new m(this.x+e.x,this.y+e.y,this.z+e.z)}addRes(e,t){return t.set(this.x+e.x,this.y+e.y,this.z+e.z)}subA(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}sub(e){return new m(this.x-e.x,this.y-e.y,this.z-e.z)}scale(e){return this.x*=e,this.y*=e,this.z*=e,this}scaleTo(e){return new m(this.x*e,this.y*e,this.z*e)}mulA(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}mul(e){return new m(this.x*e.x,this.y*e.y,this.z*e.z)}mulRes(e,t){return t.set(this.x*e.x,this.y*e.y,this.z*e.z)}divA(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}div(e){return new m(this.x/e.x,this.y/e.y,this.z/e.z)}dot(e){return e.x*this.x+e.y*this.y+e.z*this.z}dotArr(e){return e[0]*this.x+e[1]*this.y+e[2]*this.z}cross(e){return new m(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}clear(){return this.x=this.y=this.z=0,this}getNormal(){let e=new m;e.copy(this);let t=1/e.length();return e.x*=t,e.y*=t,e.z*=t,e}normal(){let e=new m;e.copy(this);let t=1/e.length();return e.x*=t,e.y*=t,e.z*=t,e}normalNegate(){let e=new m;e.copy(this);let t=-1/e.length();return e.x*=t,e.y*=t,e.z*=t,e}normalNegateScale(e){let t=new m;t.copy(this);let i=-e/t.length();return t.x*=i,t.y*=i,t.z*=i,t}normalScale(e){let t=new m;t.copy(this);let i=e/t.length();return t.x*=i,t.y*=i,t.z*=i,t}normalize(){let e=1/this.length();return this.x*=e,this.y*=e,this.z*=e,this}toVec(){return[this.x,this.y,this.z]}toArray(){return[this.x,this.y,this.z]}distance(e){let t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return Math.sqrt(t*t+i*i+s*s)}distance2(e){let t=this.x-e.x,i=this.y-e.y,s=this.z-e.z;return t*t+i*i+s*s}set(e,t,i){return this.x=e,this.y=t,this.z=i,this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}negateTo(){return new m(-this.x,-this.y,-this.z)}projToRay(e,t){let i=m.proj_b_to_a(m.sub(this,e),t);return i.addA(e),i}angle(e){return m.angle(this,e)}lerp(e,t){return new m(this.x+(e.x-this.x)*t,this.y+(e.y-this.y)*t,this.z+(e.z-this.z)*t)}smerp(e,t){let i=1-t;return new m(this.x*t+e.x*i,this.y*t+e.y*i,this.z*t+e.z*i)}static get LERP_DELTA(){return 1e-6}slerp(e,t){let i,s,n,o,l=new m;if(t<=0)return l.copy(this),l;if(t>=1)return l.copy(e),l;let h=this.dot(e);return 1-h>m.LERP_DELTA?(i=Math.acos(h),s=Math.sin(i),n=Math.sin((1-t)*i)/s,o=Math.sin(t*i)/s):(n=1-t,o=t),m.add(this.scaleTo(n),e.scale(o))}mulVecA(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}getRotationTo(e,t){let i=this.clone(),s=e.clone();i.normalize(),s.normalize();let n=i.dot(s);if(n>=1)return D.IDENTITY.clone();if(n<-.999999){if(t.equal(m.ZERO)){let o=m.UNIT_X.cross(i);return o.isZero()&&(o=m.UNIT_Y.cross(i)),o.normalize(),D.axisAngleToQuat(o,Math.PI)}return D.axisAngleToQuat(t,Math.PI)}{let o=Math.sqrt(2*(1+n)),l=1/o,h=i.cross(s),c=new D(h.x*l,h.y*l,h.z*l,.5*o);return c.normalize(),c}}}class N{constructor(e=0,t=0){this.x=e,this.y=t}static get UP(){return new N(0,1)}static get DOWN(){return new N(0,-1)}static get RIGHT(){return new N(1,0)}static get LEFT(){return new N(-1,0)}static get ZERO(){return new N}static add(e,t){const i=new N(e.x,e.y);return i.addA(t),i}static sub(e,t){var i=new N(e.x,e.y);return i.subA(t),i}static scale(e,t){let i=new N(e.x,e.y);return i.scale(t),i}static mul(e,t){let i=new N(e.x,e.y);return i.mulA(t),i}static div(e,t){let i=new N(e.x,e.y);return i.divA(t),i}static proj_b_to_a(e,t){return t.scaleTo(t.dot(e)/t.dot(t))}static angle(e,t){return Math.acos(e.dot(t)/Math.sqrt(e.length2()*t.length2()))}static orthoNormalize(e,t){return(e=e.normal()).scale(t.dot(e)),t.sub(e).normalize()}static proj_b_to_plane(e,t,i){let s=e.sub(t.scaleTo(t.dot(e)/t.dot(t)));return i&&s.isZero()?new N(i.x,i.y):s}toVector3(){return new m(this.x,this.y,0)}clone(){return new N(this.x,this.y)}equal(e){return this.x===e.x&&this.y===e.y}copy(e){return this.x=e.x,this.y=e.y,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}length2(){return this.x*this.x+this.y*this.y}addA(e){return this.x+=e.x,this.y+=e.y,this}add(e){return new N(this.x+e.x,this.y+e.y)}subA(e){return this.x-=e.x,this.y-=e.y,this}sub(e){return new N(this.x-e.x,this.y-e.y)}scale(e){return this.x*=e,this.y*=e,this}scaleTo(e){return new N(this.x*e,this.y*e)}mulA(e){return this.x*=e.x,this.y*=e.y,this}mul(e){return new N(this.x*e.x,this.y*e.y)}divA(e){return this.x/=e.x,this.y/=e.y,this}dot(e){return e.x*this.x+e.y*this.y}dotArr(e){return e[0]*this.x+e[1]*this.y}cross(e){return this.x*e.y-this.y*e.x}clear(){return this.x=this.y=0,this}normal(){return this.getNormal()}getNormal(){let e=new N;e.copy(this);let t=1/e.length();return e.x*=t,e.y*=t,e}normalize(){let e=1/this.length();return this.x*=e,this.y*=e,this}toVec(){return[this.x,this.y]}distance(e){return N.sub(this,e).length()}set(e,t){return this.x=e,this.y=t,this}negate(){return this.x=-this.x,this.y=-this.y,this}negateTo(){return new N(-this.x,-this.y)}projToRay(e,t){let i=N.proj_b_to_a(N.sub(this,e),t);return i.add(e),i}angle(e){return N.angle(this,e)}lerp(e,t,i){let s=this.clone();return i<=0?s.copy(e):i>=1?s.copy(t):s=N.add(e,N.sub(t,e).scale(i)),s}static get LERP_DELTA(){return 1e-6}slerp(e,t){let i,s,n,o,l=new N;if(t<=0)return l.copy(this),l;if(t>=1)return l.copy(e),l;let h=this.dot(e);return 1-h>N.LERP_DELTA?(i=Math.acos(h),s=Math.sin(i),n=Math.sin((1-t)*i)/s,o=Math.sin(t*i)/s):(n=1-t,o=t),N.add(this.scale(n),e.scale(o))}isZero(){return!(this.x||this.y)}}const Ao={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};class Gr{constructor(e=1,t=1){this._a=e,this._b=t,this._flattening=(e-t)/e,this._f=1/this._flattening,this._a2=e*e,this._b2=t*t;const i=Math.sqrt(this._a2-this._b2);this._e=i/e,this._e2=this._e*this._e,this._e22=this._e2*this._e2,this._k=i/t,this._k2=this._k*this._k,this._radii=new m(e,e,t),this._radii2=new m(this._a2,this._a2,this._b2),this._invRadii=new m(1/e,1/e,1/t),this._invRadii2=new m(1/this._a2,1/this._a2,1/this._b2)}rhumbDistanceTo(e,t){const i=e.lat*G,s=t.lat*G,n=s-i;let o=Math.abs(t.lon-e.lon)*G;Math.abs(o)>Math.PI&&(o=o>0?-(2*Math.PI-o):2*Math.PI+o);const l=Math.log(Math.tan(s/2+Math.PI/4)/Math.tan(i/2+Math.PI/4)),h=Math.abs(l)>1e-11?n/l:Math.cos(i);return Math.sqrt(n*n+h*h*o*o)*this._a}getIntermediatePointOnGreatCircle(e,t,i){if(i==0)return e.clone();if(i==1)return t.clone();const s=this.inverse(e,t),n=s.distance,o=s.initialAzimuth;return isNaN(o)?e:this.getGreatCircleDestination(e,o,n*i)}static getBearing(e,t){let i=e.lat*G,s=e.lon*G,n=t.lat*G,o=t.lon*G,l=Math.sin(o-s)*Math.cos(n),h=Math.cos(i)*Math.sin(n)-Math.sin(i)*Math.cos(n)*Math.cos(o-s);return Math.atan2(l,h)*Q}getFlattening(){return this._flattening}getEquatorialSize(){return this._a}get equatorialSize(){return this._a}get equatorialSizeSqr(){return this._a2}getPolarSize(){return this._b}get polarSize(){return this._b}get polarSizeSqr(){return this._b2}lonLatToCartesian(e){return this.geodeticToCartesian(e.lon,e.lat,e.height)}lonLatToCartesianRes(e,t){return this.geodeticToCartesian(e.lon,e.lat,e.height,t)}geodeticToCartesian(e,t,i=0,s=new m){let n=G*t,o=G*e,l=Math.sin(n),h=this._a/Math.sqrt(1-this._e2*l*l),c=(h+i)*Math.cos(n);return s.x=c*Math.cos(o),s.y=c*Math.sin(o),s.z=(h*(1-this._e2)+i)*l,s}projToSurface(e){let t=e.x||0,i=e.y||0,s=e.z||0,n=Math.sqrt(t*t+i*i+s*s);if(n===0)return this.lonLatToCartesian(new A);let o=this._invRadii2.x,l=this._invRadii2.y,h=this._invRadii2.z,c=t*t*o,d=i*i*l,u=s*s*h,f=c+d+u,_=Math.sqrt(1/f),g=e.scaleTo(_);if(f<.1)return Number.isFinite(_)?g:new m;let v=(1-_)*n/g.mulA(this._invRadii2).length(),p=0,y=0,b=0;for(;;){p=1/(1+v*o),y=1/(1+v*l),b=1/(1+v*h);let C=p*p,T=y*y,w=b*b,L=c*C+d*T+u*w-1;if(Math.abs(L)<nr)break;v+=.5*L/(c*(C*p)*o+d*(T*y)*l+u*(w*b)*h)}return new m(t*p,i*y,s*b)}cartesianToLonLat(e){return this.cartesianToLonLatRes(e)}cartesianToLonLatRes(e,t=new A){let i=this.projToSurface(e),s=this.getSurfaceNormal3v(i),n=e.sub(i);return t.lon=Math.atan2(s.y,s.x)*Q,t.lat=Math.asin(s.z)*Q,t.height=Math.sign(n.dot(e))*n.length(),t}getSurfaceNormal3v(e){let t=this._invRadii2,i=e.x*t.x,s=e.y*t.y,n=e.z*t.z,o=1/Math.sqrt(i*i+s*s+n*n);return new m(i*o,s*o,n*o)}getGreatCircleDistance(e,t){return this.inverse(e,t).distance}getGreatCircleDestination(e,t,i){return this.direct(e,t,i).destination}inverse(e,t){let i=this._a,s=this._b,n=this._flattening;const o=e.lat*G,l=e.lon*G,h=t.lat*G,c=t.lon*G-l,d=(1-n)*Math.tan(o),u=1/Math.sqrt(1+d*d),f=d*u,_=(1-n)*Math.tan(h),g=1/Math.sqrt(1+_*_),v=_*g,p=Math.abs(c)>Math.PI/2||Math.abs(h-o)>Math.PI/2;let y=c,b=null,C=null,T=p?Math.PI:0,w=0,L=p?-1:1,S=null,P=1,B=1,k=null,I=0;do{if(b=Math.sin(y),C=Math.cos(y),S=(g*b)**2+(u*v-f*g*C)**2,Math.abs(S)<1e-24)break;w=Math.sqrt(S),L=f*v+u*g*C,T=Math.atan2(w,L);const M=u*g*b/w;B=1-M*M,P=B!=0?L-2*f*v/B:0;const F=n/16*B*(4+n*(4-3*B));k=y,y=c+(1-F)*n*M*(T+F*w*(P+F*L*(2*P*P-1)))}while(Math.abs(y-k)>nr&&++I<1e3);const z=B*(i*i-s*s)/(s*s),Ce=z/1024*(256+z*(z*(74-47*z)-128)),R=s*(1+z/16384*(4096+z*(z*(320-175*z)-768)))*(T-Ce*w*(P+Ce/4*(L*(2*P*P-1)-Ce/6*P*(4*w*w-3)*(4*P*P-3)))),O=Math.abs(S)<Number.EPSILON?0:Math.atan2(g*b,u*v-f*g*C),se=Math.abs(S)<Number.EPSILON?Math.PI:Math.atan2(u*b,-f*g+u*v*C);return{distance:R,initialAzimuth:Math.abs(R)<Number.EPSILON?NaN:Ve(O)*Q,finalAzimuth:Math.abs(R)<Number.EPSILON?NaN:Ve(se)*Q}}direct(e,t,i){let s=e.lon,n=e.lat,o=this._a,l=this._b,h=this._flattening,c=i,d=t*G,u=Math.sin(d),f=Math.cos(d),_=(1-h)*Math.tan(n*G),g=1/Math.sqrt(1+_*_),v=_*g,p=Math.atan2(_,f),y=g*u,b=1-y*y,C=b*(o*o-l*l)/(l*l),T=1+C/16384*(4096+C*(C*(320-175*C)-768)),w=C/1024*(256+C*(C*(74-47*C)-128)),L=c/(l*T),S=2*Math.PI,P=0,B=0,k=0,I=0;for(;Math.abs(L-S)>1e-12;)P=Math.cos(2*p+L),B=Math.sin(L),k=Math.cos(L),I=w*B*(P+w/4*(k*(2*P*P-1)-w/6*P*(4*B*B-3)*(4*P*P-3))),S=L,L=c/(l*T)+I;let z=v*B-g*k*f,Ce=Math.atan2(v*k+g*B*f,(1-h)*Math.sqrt(y*y+z*z)),R=h/16*b*(4+h*(4-3*b)),O=Math.atan2(B*u,g*k-v*B*f)-(1-R)*h*y*(L+R*B*(P+R*k*(2*P*P-1))),se=Math.atan2(y,-z);return{destination:new A(s+O*Q,Ce*Q),finalAzimuth:se*Q}}hitRay(e,t){let i,s,n,o,l,h=this._invRadii.mul(e),c=this._invRadii.mul(t),d=h.dot(h),u=h.dot(c);if(d>1){if(u>=0)return;var f=u*u;if(i=d-1,s=c.dot(c),n=s*i,Math.abs(f-n)>1e-15&&f<n)return;if(f>n){o=u*u-n,l=-u+Math.sqrt(o);var _=l/s,g=i/l;return _<g?e.add(t.scaleTo(_)):e.add(t.scaleTo(g))}var v=Math.sqrt(i/s);return e.add(t.scaleTo(v))}return d<1?(i=d-1,s=c.dot(c),n=s*i,o=u*u-n,l=-u+Math.sqrt(o),e.add(t.scaleTo(l/s))):u<0?(s=c.dot(c),e.add(t.scaleTo(-u/s))):void 0}getNorthFrameRotation(e){let t=this.getSurfaceNormal3v(e),i=m.proj_b_to_plane(m.NORTH,t);return D.getLookRotation(i,t)}getBearingDestination(e,t=0,i=0){t*=G;var s=(e.lon+540)%360-180,n=e.lat*G,o=s*G,l=i/this._a,h=Math.asin(Math.sin(n)*Math.cos(l)+Math.cos(n)*Math.sin(l)*Math.cos(t));return new A((o+Math.atan2(Math.sin(t)*Math.sin(l)*Math.cos(n),Math.cos(l)-Math.sin(n)*Math.sin(h)))*Q,h*Q)}static getIntermediatePointOnGreatCircle(e,t,i){var s=e.lat*G,n=e.lon*G,o=t.lat*G,l=t.lon*G,h=Math.sin(s),c=Math.cos(s),d=Math.sin(n),u=Math.cos(n),f=Math.sin(o),_=Math.cos(o),g=Math.sin(l),v=Math.cos(l),p=o-s,y=l-n,b=Math.sin(p/2)*Math.sin(p/2)+Math.cos(s)*Math.cos(o)*Math.sin(y/2)*Math.sin(y/2),C=2*Math.atan2(Math.sqrt(b),Math.sqrt(1-b)),T=Math.sin((1-i)*C)/Math.sin(C),w=Math.sin(i*C)/Math.sin(C),L=T*c*u+w*_*v,S=T*c*d+w*_*g,P=T*h+w*f,B=Math.atan2(P,Math.sqrt(L*L+S*S)),k=Math.atan2(S,L);return new A((k*Q+540)%360-180,B*Q)}static getRhumbBearing(e,t){var i=(t.lon-e.lon)*G,s=Math.log(Math.tan(t.lat*G/2+Math.PI/4)/Math.tan(e.lat*G/2+Math.PI/4));return Math.abs(i)>Math.PI&&(i=i>0?-1*(2*Math.PI-i):2*Math.PI+i),(Math.atan2(i,s)*Q+360)%360}getLonLatVisibilitySimple(e,t,i){const s=this.lonLatToCartesian(t),n=t.height,o=this.polarSize+n,l=Math.max(e.length()-this.polarSize,0),h=s.sub(e);let c;return c=l>0?Math.sqrt((o+l)**2-o**2):o,c>h.length()&&(!i||i.dot(h.normalize())>0)}}const Lo=new Gr(6378137,6356752314245179e-9);function Hi(a,e){return a??e}function Ut(a){return a==null}function pn(a){return a===void 0}let za=0;function jr(a){let e=a._openglobus_id;return e||(e=a._openglobus_id=++za),e}function Bs(a){return typeof a=="string"||a instanceof String}function Be(a){return a.toString(16).padStart(2,"0")}function lr(a){let e,t,i;return a instanceof Array?(e=Be(a[0]),t=Be(a[1]),i=Be(a[2])):(e=Be(a.x),t=Be(a.y),i=Be(a.z)),`#${e}${t}${i}`}function le(a,e){let t=Ao[a];if(t&&(a=t),a[0]==="#"){let i=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,s=a.replace(i,function(o,l,h,c){return l+l+h+h+c+c}),n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(s);return n?new tt(parseInt(n[1],16)/255,parseInt(n[2],16)/255,parseInt(n[3],16)/255,Ut(e)?1:e):new tt}{Ut(e)&&(e=1);let i=a.split(",");return new tt(parseInt(i[0].split("(")[1])/255,parseInt(i[1])/255,parseInt(i[2])/255,Ut(i[3])?e:parseFloat(i[3]))}}function me(a,e){let t=le(a,e);return new Float32Array([t.x,t.y,t.z,t.w])}function Ji(a){let e=Ao[a];if(e&&(a=e),a[0]==="#"){let t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i=a.replace(t,function(n,o,l,h){return o+o+l+l+h+h}),s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);return s?new m(parseInt(s[1],16)/255,parseInt(s[2],16)/255,parseInt(s[3],16)/255):new m}{let t=a.split(",");return new m(parseInt(t[0].split("(")[1])/255,parseInt(t[1])/255,parseInt(t[2])/255)}}function zt(a,e){return a.replace(/{[^{}]+}/g,function(t){return e[t.replace(/[{}]+/g,"")]||""})}function ci(a,e){return a.replace(/\$\{([^}]+)\}/g,(t,i)=>(e==null?void 0:e[i.trim()])??"")}function qr(a){let e=document.createElement("div");e.innerHTML=a;let t=[];for(let i=0;i<e.childNodes.length;i++)t.push(e.childNodes[i]),e.removeChild(e.childNodes[i]);return t}function Po(a,e,t,i){let s=document.getElementById(a);s||(s=document.createElement("div"),s.id=a,s.classList.add("defaultText"),document.body.appendChild(s)),s.innerHTML=e,s.style.left=`${t}px`,s.style.top=`${i}px`}function So(a){return typeof a=="number"}function Ro(a,e=""){return a?a.trim():e}function qt(a,e){if(a){if(So(a))return new m(a,a,a);if(a instanceof m)return a.clone();if(a instanceof Array)return m.fromVec(a);if(a instanceof N)return new m(a.x,a.y,0)}else if(e)return e;return new m}function ae(a,e){if(a){if(Bs(a))return le(a);if(a instanceof Array)return tt.fromVec(a);if(a instanceof tt)return a.clone()}else if(e)return e;return new tt(1,1,1,1)}function Gt(a,e){if(a){if(Bs(a))return Ji(a);if(a instanceof Array)return m.fromVec(a);if(a instanceof m)return a.clone()}else if(e)return e;return new m(1,1,1)}function Yr(a,e){if(a){if(a instanceof Array)return new V(mi(a[0]),mi(a[1]));if(a instanceof V)return a.clone()}else if(e)return e;return new V}function mi(a,e){if(a){if(a instanceof Array)return new A(a[0],a[1],a[2]);if(a instanceof A)return a.clone()}else if(e)return e;return new A}function Wr(a,e){let t=0,i=a.length-1;for(;t<=i;){let s=Math.floor(.5*(t+i));if(Math.abs(a[s]-e)<.001)return s;a[s]<e?t=s+1:i=s-1}return-1}function Se(a,e,t){let i=0,s=a.length-1;for(;i<=s;){let n=s+i>>1,o=t(e,a[n],n);if(o>0)i=n+1;else{if(!(o<0))return n;s=n-1}}return-i-1}function $r(a,e,t){let i=Se(a,e,t);return i<0&&(i=~i),a.splice(i,0,e),i}function Mo(a,e,t,i,s=!1){let n=new A(e.lon-a.lon,e.lat-a.lat),o=new A(i.lon-t.lon,i.lat-t.lat),l=-n.lat,h=+n.lon,c=-(l*a.lon+h*a.lat),d=-o.lat,u=+o.lon,f=-(d*t.lon+u*t.lat),_=d*a.lon+u*a.lat+f,g=d*e.lon+u*e.lat+f,v=l*t.lon+h*t.lat+c,p=l*i.lon+h*i.lat+c;if(s&&(_*g>0||v*p>0))return;let y=_/(_-g);return new A(a.lon+y*n.lon,a.lat+y*n.lat)}const Da={string:function(a){return Ut(a)?a:a.toString()},date:function(a){return Ut(a)?a:new Date(1e3*a)},datetime:function(a){return Ut(a)?a:new Date(1e3*a)},time:function(a){return Ut(a)?a:parseInt(a)},integer:function(a){return Ut(a)?a:parseInt(a)},float:function(a){return Ut(a)?a:parseFloat(a)},boolean:function(a){if(a===null)return a;if(typeof a=="boolean")return a===!0;if(typeof a=="string"){if(a==="")return!1;if((a=a.replace(/^\s+|\s+$/g,"")).toLowerCase()==="true"||a.toLowerCase()==="yes")return!0;a=(a=a.replace(/,/g,".")).replace(/^\s*\-\s*/g,"-")}return!isNaN(a)&&parseFloat(a)!==0}};function mn(a,e=""){let t=1024,i=atob(a),s=i.length,n=Math.ceil(s/t),o=new Array(n);for(let l=0;l<n;++l){let h=l*t,c=Math.min(h+t,s),d=new Array(c-h);for(let u=h,f=0;u<c;++f,++u)d[f]=i[u].charCodeAt(0);o[l]=new Uint8Array(d)}return new Blob(o,{type:e})}function vi(a,e,t=!1){let i,s=0;return function(){const n=arguments;s?(t&&clearTimeout(i),i=setTimeout(()=>{Date.now()-s>=e&&(a.apply(null,n),s=Date.now())},e-(Date.now()-s))):(a.apply(null,n),s=Date.now())}}function et(a,e){let t=new a.constructor(a.length+e.length);return t.set(a,0),t.set(e,a.length),t}function xt(a=[],e=[]){if(ArrayBuffer.isView(a))return et(a,e);for(let t=0;t<e.length;t++)a.push(e[t]);return a}function it(a,e=Float32Array){if(ArrayBuffer.isView(a))return a;{const t=new e(a.length);return t.set(a,0),t}}function He(a){return ArrayBuffer.isView(a)?Array.from(a):a}function Ct(a,e,t,i){if(ArrayBuffer.isView(a))return e<0&&(t=Math.abs(e),e+=a.length),nt(a,e,t,i);{let s;return s=e<0?a.splice(e):a.splice(e,t),i&&(i.result=s),a}}function nt(a,e,t,i){if(a.length===0)return a;const s=a.length-t,n=new a.constructor(s);return n.set(a.subarray(0,e)),n.set(a.subarray(e+t),e),i&&(i.result=a.subarray(e,e+t)),n}function Xr(a,e,t,i,s){const n=s+1,o=t+n,l=i+n;let h=new Float64Array(n*n*3),c=0;for(let d=t;d<o;d++)for(let u=i;u<l;u++){let f=3*(d*(e+1)+u);h[c++]=a[f],h[c++]=a[f+1],h[c++]=a[f+2]}return h}function Bo(a,e,t,i,s){const n=s+1,o=t+n,l=i+n;let h=new Float32Array(n*n*3),c=0;for(let d=t;d<o;d++)for(let u=i;u<l;u++){let f=3*(d*(e+1)+u);h[c++]=a[f],h[c++]=a[f+1],h[c++]=a[f+2]}return h}function hr(a,e,t,i,s,n,o,l,h,c,d,u,f){const _=n+l+1,g=o+l+1;s+=1;let v=0,p=0;for(let y=n;y<_;y++)for(let b=o;b<g;b++){let C=y*s+b,T=3*C,w=a[T],L=a[T+1],S=a[T+2];i&&i[C]!==0?f[p]=1:(w<u.xmin&&(u.xmin=w),w>u.xmax&&(u.xmax=w),L<u.ymin&&(u.ymin=L),L>u.ymax&&(u.ymax=L),S<u.zmin&&(u.zmin=S),S>u.zmax&&(u.zmax=S)),p++,h[v]=w,d[v]=t[T],c[v++]=e[T],h[v]=L,d[v]=t[T+1],c[v++]=e[T+1],h[v]=S,d[v]=t[T+2],c[v++]=e[T+2]}}function Zr(a){return a.map(e=>Array.isArray(e)?Zr(e):e)}async function Vi(a){return new Promise(e=>{const t=new Image;return t.addEventListener("load",()=>{e(t)}),t.src=a,t.crossOrigin="",t})}function cr(a){return a.complete&&a.naturalHeight!==0}function Ue(a){return a>1e3?a-Math.floor(a)!=0?[(a/1e3).toFixed(2),"km"]:[(a/1e3).toFixed(0),"km"]:a>9?[Math.round(a).toString(),"m"]:a<=.01?["0","m"]:[a.toFixed(1),"m"]}function ko(a){let e=new URLSearchParams(location.search).get(a);if(e)return Number(e)}function dr(a,e=-1){if(e<0)return a.toString();const t=Math.pow(10,e);return(Math.round(a*t)/t).toString()}Object.freeze(Object.defineProperty({__proto__:null,base64StringToBlog:function(a){let e=a.split(";"),t=e[0].split(":")[1];return mn(e[1].split(",")[1],t)},base64toBlob:mn,binaryInsert:$r,binarySearch:Se,binarySearchFast:Wr,blerp:function(a,e,t,i,s,n,o=0,l=1,h=0,c=1){return(t*(l-a)*(c-e)+i*(a-o)*(c-e)+s*(l-a)*(e-h)+n*(a-o)*(e-h))/((l-o)*(c-h))},blerp2:function(a,e,t,i,s,n){return t*(1-a)*(1-e)+i*a*(1-e)+s*(1-a)*e+n*a*e},castType:Da,cloneArray:Zr,concatArrays:xt,concatTypedArrays:et,createColorRGB:Gt,createColorRGBA:ae,createExtent:Yr,createLonLat:mi,createVector3:qt,createVector4:function(a,e){if(a){if(a instanceof tt)return a.clone();if(a instanceof Array)return tt.fromVec(a)}else if(e)return e;return new tt},defaultString:Ro,distanceFormat:function(a){return a>1e3?`${(a/1e3).toFixed(2)} km`:a>9?`${Math.round(a)} m`:`${a.toFixed(1)} m`},distanceFormatExt:Ue,extractElevationTiles:function(a,e,t){let i=Math.sqrt(e.length)-1,s=i+1,n=Math.sqrt(a.length/4),o=n/i,l=0,h=0;for(let c=0,d=0,u=a.length/4;c<u;c++){let f=a[4*c],_=Math.floor(c/n),g=c%n,v=Math.floor(g/i),p=Math.floor(_/i),y=t[p][v],b=_%i,C=g%i,T=(b+p)*s+C+v;if(y[T]=f,(_+p)%o==0&&(g+v)%o==0&&(e[d++]=f),(g+1)%i==0&&g!==n-1){l=a[4*(c+1)];let w=.5*(f+l);T=(b+p)*s+C+1,y[T]=w,(_+p)%o==0&&(e[d++]=w);let L=(b+p)*s+(C+1)%i;t[p][v+1][L]=w}if((_+1)%i==0&&_!==n-1){h=a[4*(c+n)];let w=.5*(f+h);T=(b+1)*s+C+v,y[T]=w,(g+v)%o==0&&(e[d++]=w);let L=(b+1)%i*s+C+v;t[p+1][v][L]=w}if((g+1)%i==0&&g!==n-1&&(_+1)%i==0&&_!==n-1){let w=.25*(f+l+h+a[4*(c+n+1)]);T=(b+1)*s+(C+1),y[T]=w,e[d++]=w;let L=(b+1)*s;t[p][v+1][L]=w;let S=i;t[p+1][v][S]=w;let P=0;t[p+1][v+1][P]=w}}},getDefault:Hi,getHTML:function(a,e){return zt(a,e)},getLinesIntersection2v:function(a,e,t,i,s){let n=e.sub(a),o=i.sub(t),l=-n.y,h=+n.x,c=-(l*a.x+h*a.y),d=-o.y,u=+o.x,f=-(d*t.x+u*t.y),_=d*a.x+u*a.y+f,g=d*e.x+u*e.y+f,v=l*t.x+h*t.y+c,p=l*i.x+h*i.y+c;if(s&&(_*g>0||v*p>0))return;let y=_/(_-g);return new N(a.x+y*n.x,a.y+y*n.y)},getLinesIntersectionLonLat:Mo,getMatrixSubArray32:Bo,getMatrixSubArray64:Xr,getMatrixSubArrayBoundsExt:hr,getTileImageResolution:function(a,e,t,i=256,s=Lo){let n=Xe(a,e,t),o=n.getSouthWest().inverseMercator(),l=n.getNorthEast().inverseMercator();return[s.getGreatCircleDistance(o,new A(l.lon,o.lat))/i,s.getGreatCircleDistance(o,new A(o.lon,l.lat))/i]},getUrlParam:ko,htmlColorToFloat32Array:me,htmlColorToRgb:Ji,htmlColorToRgba:le,isEmpty:Ut,isImageLoaded:cr,isNumber:So,isString:Bs,isUndef:pn,isUndefExt:function(a,e){return pn(a)?e:a},loadImage:Vi,makeArray:He,makeArrayTyped:it,parseHTML:qr,print2d:Po,rgbToStringHTML:lr,spliceArray:Ct,spliceTypedArray:nt,stamp:jr,stringTemplate:zt,stringTemplate2:ci,throttle:vi,toFixedMax:dr,xmlToJson:function a(e){let t={};if(e.nodeType===1){if(e.attributes.length>0){t["@attributes"]={};for(let i=0;i<e.attributes.length;i++){let s=e.attributes.item(i);t["@attributes"][s.nodeName]=s.nodeValue}}}else e.nodeType===3&&(t=e.nodeValue);if(e.hasChildNodes())for(let i=0;i<e.childNodes.length;i++){let s=e.childNodes.item(i),n=s.nodeName;if(t[n]===void 0)t[n]=a(s);else{if(t[n].push===void 0){let o=t[n];t[n]=[],t[n].push(o)}t[n].push(a(s))}}return t}},Symbol.toStringTag,{value:"Module"}));const Ui=1e3,ur=1/60,vn=1/24,yi=3600,_r=1/yi,Kr=43200,Gi=1440,Fa=1/Gi,te=86400,Oa=864e5,Qr=11574074074074074e-24,ne=1/te,ts=2451545;function Io(a,e,t){let i=(e-14)/12|0,s=a+4800+i;return(1461*s/4|0)+(367*(e-2-12*i)/12|0)-(3*((s+100)/100|0)/4|0)+t-32075}function es(a){let e=Io(a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate()),t=a.getUTCHours()-12;t<0&&(t+=24);let i=a.getUTCSeconds()+t*yi+60*a.getUTCMinutes()+.001*a.getUTCMilliseconds();i>=Kr&&e--;let s=i*ne|0;return e+=s,i-=te*s,i<0&&(e--,i+=te),e+i*ne}function fr(a){let e=Do,t=Se(e,a,function(s,n){return s-n.jd});t<0&&(t=~t),t>=e.length&&(t=e.length-1);let i=e[t].leapSeconds;return t!==0&&(e[t].jd-a)*te>i&&(i=e[t-1].leapSeconds),a+i*ne}function Us(a){let e=Do,t=Se(e,a,function(s,n){return s-n.jd});if(t<0&&(t=~t),t>=e.length)return a-e[t-1].leapSeconds*ne;if(t===0)return a-e[0].leapSeconds*ne;let i=(e[t].jd-a)*te;return i===0?a-e[t].leapSeconds*ne:i<=1?void 0:a-e[t-1].leapSeconds*ne}function gr(a){let e=0|a,t=(a-e)*te;t>=Kr&&e++;let i=e+68569|0,s=4*i/146097|0;i=i-((146097*s+3)/4|0)|0;let n=4e3*(i+1)/1461001|0;i=i-(1461*n/4|0)+31|0;let o=80*i/2447|0,l=i-(2447*o/80|0)|0;i=o/11|0;let h=o+2-12*i|0,c=100*(s-49)+n+i|0,d=t*_r|0,u=t-d*yi,f=u*ur|0;u-=60*f;let _=0|u,g=(u-_)*Ui|0;return d+=12,d>23&&(d-=24),new Date(Date.UTC(c,h-1,l,d,f,_,g))}function zo(a,e){return a+e*Qr}function yn(a,e){return a+e*ne}function rt(a,e){return{jd:a,leapSeconds:e}}const Do=[rt(24413175e-1,10),rt(24414995e-1,11),rt(24416835e-1,12),rt(24420485e-1,13),rt(24424135e-1,14),rt(24427785e-1,15),rt(24431445e-1,16),rt(24435095e-1,17),rt(24438745e-1,18),rt(24442395e-1,19),rt(24447865e-1,20),rt(24451515e-1,21),rt(24455165e-1,22),rt(24462475e-1,23),rt(24471615e-1,24),rt(24478925e-1,25),rt(24482575e-1,26),rt(24488045e-1,27),rt(24491695e-1,28),rt(24495345e-1,29),rt(24500835e-1,30),rt(24506305e-1,31),rt(24511795e-1,32),rt(24537365e-1,33),rt(24548325e-1,34),rt(24561095e-1,35),rt(24572045e-1,36)],Na=fr(ts);Object.freeze(Object.defineProperty({__proto__:null,DAYS_PER_JULIAN_CENTURY:36525,DAYS_PER_JULIAN_YEAR:365.25,DateToTAI:function(a){return fr(es(a))},DateToUTC:es,HOURS_PER_DAY:24,J2000:ts,J2000TAI:Na,MILLISECONDS_PER_DAY:Oa,MILLISECONDS_PER_SECOND:Ui,MINUTES_PER_DAY:Gi,MINUTES_PER_HOUR:60,MODIFIED_JULIAN_DATE_DIFFERENCE:24000005e-1,ONE_BY_HOURS_PER_DAY:vn,ONE_BY_MILLISECONDS_PER_DAY:Qr,ONE_BY_MINUTES_PER_DAY:Fa,ONE_BY_SECONDS_PER_DAY:ne,ONE_BY_SECONDS_PER_HOUR:_r,ONE_BY_SECONDS_PER_MINUTE:ur,PICOSECOND:1e-9,SECONDS_PER_12_HOURS:Kr,SECONDS_PER_DAY:te,SECONDS_PER_HOUR:yi,SECONDS_PER_MILLISECOND:.001,SECONDS_PER_MINUTE:60,T:function(a){return(a-ts)/36525},TAItoDate:function(a){let e=Us(a);return e||(e=Us(yn(a,-1)),console.trace(`TAItoDate - can't convert ${a.toString()} to utc.`)),gr(e)},TAItoUTC:Us,UTCtoDate:gr,UTCtoTAI:fr,addDays:function(a,e){return a+e},addHours:function(a,e){return a+e*vn},addMilliseconds:zo,addMinutes:function(a,e){return a+e*Gi},addSeconds:yn,daysToSeconds:function(a){return a*te},getDayNumber:Io,getDays:function(a){return 0|a},getHours:function(a){let e=(a-(0|a))*te,t=e*_r|0,i=e-t*yi,s=i*ur|0;i-=60*s;let n=0|i;return t+=12+s/60+n/3600+((i-n)*Ui|0)/1e3,t>23&&(t-=24),t},getMilliseconds:function(a){let e=a-(0|a);return e*=te,(e-(0|e))*Ui|0},getMinutes:function(a){return(a-(0|a))*Gi|0},getSeconds:function(a){return(a-(0|a))*te},secondsToDays:function(a){return a*ne}},Symbol.toStringTag,{value:"Module"}));class Fo{constructor(e){this.vertices=[new m,new m,new m,new m,new m,new m,new m,new m],e&&this.setFromBoundsArr(e)}copy(e){for(let t=0,i=this.vertices.length;t<i;t++)this.vertices[t].copy(e.vertices[t])}setFromBoundsArr(e){let t=e[0],i=e[3],s=e[1],n=e[4],o=e[2],l=e[5],h=this.vertices;h[0].set(t,s,o),h[1].set(i,s,o),h[2].set(i,s,l),h[3].set(t,s,l),h[4].set(t,n,o),h[5].set(i,n,o),h[6].set(i,n,l),h[7].set(t,n,l)}setFromExtent(e,t){this.setFromBoundsArr(t.getCartesianBounds(e))}}class Dt{constructor(e=0,t){this.radius=e,this.center=t?t.clone():new m}setFromBounds(e){let t=new m(e[0],e[1],e[2]);this.center.set(t.x+.5*(e[3]-t.x),t.y+.5*(e[3]-t.y),t.z+.5*(e[5]-t.z)),this.radius=this.center.distance(t)}setFromExtent(e,t){this.setFromBounds(t.getCartesianBounds(e))}}Object.freeze(Object.defineProperty({__proto__:null,Box:Fo,Sphere:Dt},Symbol.toStringTag,{value:"Module"}));function at(a,e){return new xi(a,e)}const hs=class k0{constructor(e,t){this.__id=k0.__counter__++,this._eventNames=[],e&&this.registerNames(e),this._sender=t||this,this._stopPropagation=!1,this._stampCache={}}bindSender(e){this._sender=e||this}registerNames(e){for(let t=0;t<e.length;t++)this[e[t]]={active:!0,handlers:[]},this._eventNames.push(e[t]);return this}_getStamp(e,t,i){return`${e}_${t}_${i}`}_stamp(e,t){let i=jr(t),s=this._getStamp(e,this.__id,i);return!this._stampCache[s]&&(this._stampCache[s]=i,!0)}on(e,t,i,s=0){if(this._stamp(e,t)&&this[e]){let n=t.bind(i||this._sender);n._openglobus_id=t._openglobus_id,n._openglobus_priority=s,$r(this[e].handlers,n,(o,l)=>(l._openglobus_priority||0)-(o._openglobus_priority||0))}}off(e,t){if(t){let i=this._getStamp(e,this.__id,t._openglobus_id);if(t._openglobus_id&&this._stampCache[i]){let s=this[e].handlers,n=s.length,o=-1;for(;n--;)if(s[n]._openglobus_id===t._openglobus_id){o=n;break}o!==-1&&(s.splice(o,1),this._stampCache[i]=void 0,delete this._stampCache[i])}}}dispatch(e,...t){let i=!0;if(e&&e.active&&!this._stopPropagation){let s=e.handlers.slice(0),n=s.length;for(;n--;)s[n](...t)===!1&&(i=!1)}return this._stopPropagation=!1,i}stopPropagation(){this._stopPropagation=!0}clear(){for(let e=0;e<this._eventNames.length;e++){let t=this[this._eventNames[e]];t.handlers.length=0,t.handlers=[]}this._eventNames.length=0,this._eventNames=[]}};hs.__counter__=0;let xi=hs;const Ha=["render"],Ht=class Fs{constructor(e={}){this.__id=Fs.__counter__++,this.events=at(Ha),this.model=e.model||null,this.template=e.template||"",this.parent=e.parent||null,this._classList=e.classList||[],this.el=null,e.initRender&&this.render()}on(e,t,i,s){this.events.on(e,t,i,s)}off(e,t){this.events.off(e,t)}static getHTML(e,t){return zt(e,t)}static parseHTML(e){return qr(e)}static insertAfter(e,t){Array.isArray(e)||(e=[e]);for(let i=0;i<e.length;i++)t.parentNode&&t.parentNode.insertBefore(e[i],t.nextSibling);return e}static insertBefore(e,t){Array.isArray(e)||(e=[e]);for(let i=0;i<e.length;i++)t.parentNode&&t.parentNode.insertBefore(e[i],t);return e}insertBefore(e){this.el||this.render(),this.el&&(e instanceof HTMLElement&&e.parentNode&&Fs.insertBefore(this.el,e),e instanceof Fs&&e.el&&e.el.parentNode&&Fs.insertBefore(this.el,e.el))}insertAfter(e){this.el||this.render(),this.el&&(e instanceof HTMLElement&&e.parentNode&&Fs.insertAfter(this.el,e),e instanceof Fs&&e.el&&e.el.parentNode&&Fs.insertAfter(this.el,e.el))}isEqual(e){return e.__id===this.__id}appendTo(e,t=!1,i=!1){return e&&(this.el||(this.beforeRender(e),this.render()),this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el),t&&(e.innerHTML=""),this.el&&(i&&e.childNodes[0]?Fs.insertBefore(this.el,e.childNodes[0]):e.appendChild(this.el)),this.afterRender(e)),this}afterRender(e){}beforeRender(e){}stopPropagation(){this.events.stopPropagation()}renderTemplate(e){return Fs.parseHTML(Fs.getHTML(this.template,e||{}))[0]}render(e){this.el=this.renderTemplate(e);for(let t=0,i=this._classList.length;t<i;t++)this.el.classList.add(this._classList[t]);return this.events.dispatch(this.events.render,this),this}select(e){return this.el?this.el.querySelector(e):null}selectRemove(e){if(this.el){let t=this.select(e);if(t&&t.parentNode)return t.parentNode.removeChild(t),t}}selectAll(e,t){if(this.el){const i=this.el.querySelectorAll(e);if(t)for(let s=0,n=i.length;s<n;s++)t(i[s],s);return i}}remove(){this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el)}};Ht.__counter__=0;let dt=Ht;const Va=["click","mousedown","mouseup","touchstart","touchend","touchcancel"];class he extends dt{constructor(e={}){super({template:zt(`<div class="og-button" title="{title}">
       <div class="og-button-icon">{icon}</div>
       <div class="og-button-text">{text}</div>
    </div>`,{icon:e.icon||"",text:e.text||"",title:e.title||""}),...e}),this._onMouseDown=t=>{t.preventDefault(),this.events.dispatch(this.events.mousedown,this,t)},this._onMouseUp=t=>{t.preventDefault(),this.events.dispatch(this.events.mouseup,this,t)},this._onTouchStart=t=>{t.preventDefault(),this.events.dispatch(this.events.touchstart,this,t)},this._onTouchEnd=t=>{t.preventDefault(),this.events.dispatch(this.events.touchend,this,t)},this._onTouchCancel=t=>{t.preventDefault(),this.events.dispatch(this.events.touchcancel,this,t)},this._onMouseClick=t=>{this._mouseClickHandler(t)},this.events=this.events.registerNames(Va),this.el=null,this.name=e.name||"",this.$icon=null,this.$text=null}render(e){return super.render(e),this.$icon=this.select(".og-button-icon"),this.$text=this.select(".og-button-text"),this.el.__og_button__=this,this._initEvents(),this}_initEvents(){this.el&&(this.el.addEventListener("click",this._onMouseClick),this.el.addEventListener("mousedown",this._onMouseDown),this.el.addEventListener("mouseup",this._onMouseUp),this.el.addEventListener("touchstart",this._onTouchStart),this.el.addEventListener("touchend",this._onTouchEnd),this.el.addEventListener("touchcancel",this._onTouchCancel))}_mouseClickHandler(e){e.preventDefault(),this.events.dispatch(this.events.click,this,e)}remove(){this._clearEvents(),super.remove()}_clearEvents(){this.el&&this.el.removeEventListener("click",this._onMouseClick)}}const cs=class M0{constructor(e={}){this.__id=M0.__counter__++,this._name=e.name||`_control_${this.__id.toString()}`,this.planet=null,this._initialized=!1,this.renderer=null,this.autoActivate=e.autoActivate||!1,this._active=!1,this._deferredActive=!0}get name(){return this._name}oninit(){}onadd(){}onremove(){}onactivate(){}ondeactivate(){}addTo(e){e&&(this.renderer=e,e.controls[this.name]=this,this.onadd&&this.onadd(),e.isInitialized()&&!this._initialized&&(this._initialized=!0,this.oninit&&this.oninit(),this.autoActivate&&this.activate()))}remove(){this.deactivate(),this.onremove&&this.onremove();let e=this.renderer,t=this.name;if(!e)return;let i=e.controls[t];i&&this.isEqual(i)&&delete e.controls[t],this.renderer=null,this._active=!1,this._initialized=!1}activate(){this._active||(this._initialized||(this._initialized=!0,this.oninit&&this.oninit()),this._deferredActive?(this._active=!0,this.onactivate&&this.onactivate()):this._deferredActive=!0)}deactivate(){this._active?(this._active=!1,this.ondeactivate&&this.ondeactivate()):this._initialized||(this._deferredActive=!1)}isActive(){return this._active}isEqual(e){return e.__id===this.__id}};cs.__counter__=0;let Z=cs;class Oo extends Z{constructor(e={}){super(e),this._heading=0,this._svg=null}oninit(){let e=new he({classList:["og-map-button","og-compass-button"],icon:`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   viewBox="0 0 110.6 110.3"
   version="1.1"
   id="svg21"
   sodipodi:docname="aaa.svg"
   inkscape:version="0.92.3 (2405546, 2018-03-11)">
  <metadata
     id="metadata11">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <defs
     id="defs25" />
  <sodipodi:namedview
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1"
     objecttolerance="10"
     gridtolerance="10"
     guidetolerance="10"
     inkscape:pageopacity="0"
     inkscape:pageshadow="2"
     inkscape:window-width="1920"
     inkscape:window-height="1001"
     id="namedview23"
     showgrid="false"
     inkscape:zoom="9.4900968"
     inkscape:cx="28.376998"
     inkscape:cy="60.17054"
     inkscape:window-x="-9"
     inkscape:window-y="-9"
     inkscape:window-maximized="1"
     inkscape:current-layer="svg21" />
  <g
     id="Layer_2"
     data-name="Layer 2"
     transform="matrix(1,0,0,-1,0,110.3)">
    <g
       id="_1"
       data-name=" 1">
      <g
         id="_Group_"
         data-name="&lt;Group&gt;">
        <g
           id="_Group_7"
           data-name="&lt;Group&gt;">
          <polygon
             id="_Path_7"
             data-name="&lt;Path&gt;"
             points="55.2,97.6 55.3,97.4 55.3,97.6 55.3,97.2 65.3,55.1 55.3,55.1 55.2,55.1 45.3,55.1 55.2,97.2 "
             style="fill:#ff2b45" />
          <polygon
             id="_Path_8"
             data-name="&lt;Path&gt;"
             points="55.3,12.7 55.3,12.9 55.2,12.7 55.2,13.1 45.3,55.1 55.2,55.1 55.3,55.1 65.3,55.1 55.3,13.1 "
             style="fill:#cecece;" />
        </g>
      </g>
    </g>
  </g>
</svg>`});e.appendTo(this.renderer.div),e.events.on("click",this._onClick,this),e.events.on("touchstart",this._onClick,this),this._svg=e.select("svg"),this.renderer.events.on("draw",this._draw,this)}_onClick(){const e=this.planet;let t=e.getCartesianFromPixelTerrain(this.renderer.handler.getCenter());t?e.flyCartesian(t.normal().scaleTo(t.length()+t.distance(e.camera.eye)),{amplitude:0,completeCallback:()=>{e.camera.look(t)}}):e.flyCartesian(e.camera.eye)}_draw(){this.setHeading(this.planet.camera.getHeading())}setHeading(e){this._heading!==e&&(this._heading=e,this._svg.style.transform=`rotateZ(${-e}deg)`)}}const No=`<svg className="svg-icon" style="width: 1em; height: 1em;vertical-align: middle;fill: currentColor; overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <path d="M777.856 280.192l-33.92-33.952-231.872 231.872-231.84-231.872-33.984 33.888 231.872 231.904-231.84 231.84 33.888 33.984 231.904-231.904 231.84 231.872 33.952-33.888-231.872-231.904z"/>
</svg>`,Ua=["resize","focus","visibility","dragstart","dragend"],ds=class R0 extends dt{constructor(e={}){super({template:zt(`<div class="og-ddialog" 
        style="display:{display}; resize:{resize}; width: {width}px; {height}; top: {top}px; left: {left}px; min-height: {minHeight}; max-height: {maxHeight}; min-width: {minWidth}; max-width: {maxWidth};">
       <div class="og-ddialog-header">
         <div class="og-ddialog-header__title">{title}</div>      
         <div class="og-ddialog-header__buttons"></div>      
        </div>
       <div class="og-ddialog-container"></div>
    </div>>`,{title:e.title||"",display:Hi(e.visible,!0)?"flex":"none",resize:Hi(e.resizable,!0)?"both":"none",width:e.width||300,height:e.height?`height: ${e.height||200}px`:"",left:e.left||0,top:e.top||0,minHeight:e.minHeight?`${e.minHeight}px`:"unset",maxHeight:e.maxHeight?`${e.maxHeight}px`:"unset",minWidth:e.minWidth?`${e.minWidth}px`:"unset",maxWidth:e.maxWidth?`${e.maxWidth}px`:"unset"}),...e}),this._onCloseBtnClick=()=>{this.close()},this._onMouseDownAll=()=>{this.bringToFront()},this._onMouseDown=t=>{t.preventDefault(),this._startDragging(),this._startPosX=t.clientX,this._startPosY=t.clientY,document.addEventListener("mousemove",this._onMouseMove),document.addEventListener("mouseup",this._onMouseUp)},this._onMouseMove=t=>{t.preventDefault();let i=this._startPosX-t.clientX,s=this._startPosY-t.clientY;this._startPosX=t.clientX,this._startPosY=t.clientY,this.setPosition(this.el.offsetLeft-i,this.el.offsetTop-s)},this._onMouseUp=()=>{this._clearDragging(),document.removeEventListener("mouseup",this._onMouseUp),document.removeEventListener("mousemove",this._onMouseMove)},this.events=this.events.registerNames(Ua),this._width=e.width||300,this._height=e.height||200,this._startPosX=0,this._startPosY=0,this.$header=null,this.$title=null,this.$container=null,this.$buttons=null,this._closeBtn=new he({icon:No,classList:["og-button-size__20"]}),this.useHide=e.useHide||!1,this._visibility=Hi(e.visible,!0),this._right=e.right!=null?e.right:null}setContainer(e){this.$container.innerHTML=e}get container(){return this.$container}get width(){return this.el?parseFloat(this.el.style.width):this._width}get height(){return this.el?parseFloat(this.el.style.height):this._height}bringToFront(){this.el.style.zIndex=String(R0.__zIndex__++)}render(e){return super.render(e),this.bringToFront(),this.$header=this.select(".og-ddialog-header"),this.$title=this.select(".og-ddialog-header__title"),this.$container=this.select(".og-ddialog-container"),this.$buttons=this.select(".og-ddialog-header__buttons"),this._initEvents(),this._initButtons(),this._right!=null&&(this.el.style.visibility="hidden",new IntersectionObserver((t,i)=>{t.forEach(s=>{s.isIntersecting&&(this.el.style.visibility="visible",this.el.parentNode&&(this.setPosition(this.el.parentNode.clientWidth-this.el.clientWidth-this._right),i.disconnect()))})}).observe(this.el)),this}show(){this._visibility||(this._visibility=!0,this.el.style.display="flex",this.bringToFront(),this.events.dispatch(this.events.visibility,!0,this))}hide(){this._visibility&&(this._visibility=!1,this.el.style.display="none",this.events.dispatch(this.events.visibility,!1,this))}close(){this.useHide?this.hide():this.remove()}setVisibility(e){e?this.show():this.hide()}getVisibility(){return this._visibility}_initButtons(){this._closeBtn.events.on("click",this._onCloseBtnClick),this._closeBtn.appendTo(this.$buttons)}_initEvents(){this.$header.addEventListener("mousedown",this._onMouseDown),this.el.addEventListener("mousedown",this._onMouseDownAll)}setPosition(e,t){e!=null&&(this.el.style.left=`${e}px`),t!=null&&(this.el.style.top=`${t}px`)}_startDragging(){this.el.classList.contains("dragging")||(this.el.classList.add("dragging"),this.events.dispatch(this.events.dragstart,this))}_clearDragging(){this.el.classList.contains("dragging")&&(this.events.dispatch(this.events.dragend,this),this.el.classList.remove("dragging"))}remove(){this._clearDragging(),this._clearEvents(),super.remove()}_clearEvents(){this._closeBtn.events.off("click",this._onCloseBtnClick),document.removeEventListener("mouseup",this._onMouseUp),document.removeEventListener("mousemove",this._onMouseMove),this.$header.removeEventListener("mousedown",this._onMouseDown),this.el.removeEventListener("mousedown",this._onMouseDownAll)}};ds.__zIndex__=0;let Zt=ds;const Ga=["change"];class ct extends he{constructor(e){super({...e}),this._onMouseClick=t=>{this.preventClick||(this._mouseClickHandler(t),this.setActive(!this.isActive))},this.events=this.events.registerNames(Ga),this._isActive=e.isActive||!1,this.preventClick=e.preventClick||!1}setActive(e,t=!1){e!==this._isActive&&(this._isActive=e,this._toggle(),t||this.events.dispatch(this.events.change,e,this))}_toggle(){this.el&&this.el.classList.toggle("og-button__active")}get isActive(){return this._isActive}render(e){return super.render(e),this._isActive&&this._toggle(),this}}const di=[2,3,0,1],xn=[[-1,-1,0,1],[1,-1,3,-1],[2,3,-1,-1],[-1,0,-1,2]],ja=[[2,3,0,1],[1,0,3,2],[2,3,0,1],[1,0,3,2]],qa=[[0,1,0,0],[1,0,0,0],[0,1,0,1],[1,1,1,1]];class Ho{constructor(e,t){this.segment=e,this.layer=t,this.isReady=!1,this.isLoading=!1,this.texture=null,this.pickingMask=null,this.textureExists=!1,this.appliedNodeId=0,this.appliedNode=null,this.texOffset=[0,0,1,1],this.loadingAttempts=0,this._updateTexture=null,this._updatePickingMask=null,this.pickingReady=!1}abortLoading(){this.layer.abortMaterialLoading(this)}_createTexture(e){return this.layer._planet&&this.layer.createTexture(e,this.layer._internalFormat,this.isReady?this.texture:null)}applyImage(e){this.segment.initialized&&(this._updateTexture=null,this.texture=this._createTexture(e),this.isReady=!0,this.pickingReady=!0,this.textureExists=!0,this.isLoading=!1,this.appliedNodeId=this.segment.node.nodeId,this.texOffset=[0,0,1,1])}applyTexture(e,t){this.segment.initialized&&(this.texture=e,this._updateTexture=null,this.pickingMask=t||null,this._updatePickingMask=null,this.isReady=!0,this.pickingReady=!0,this.textureExists=!0,this.isLoading=!1,this.appliedNodeId=this.segment.node.nodeId,this.texOffset=[0,0,1,1])}textureNotExists(){this.segment.initialized&&(this.pickingReady=!0,this.isLoading=!1,this.isReady=!0,this.textureExists=!1)}clear(){this.loadingAttempts=0,this.layer.clearMaterial(this)}}const us=class B0{constructor(e,t={}){if(this.isVector=!1,this.__id=B0.__counter__++,this._iconSrc=t.iconSrc||null,this.events=at(Vo,this),this.name=e||"noname",this.properties=t.properties||{},this.hideInLayerSwitcher=t.hideInLayerSwitcher||!1,this._hasImageryTiles=!0,this._opacity=t.opacity!=null?t.opacity:1,this.minZoom=t.minZoom||0,this.maxZoom=t.maxZoom!=null?t.maxZoom:50,this._planet=null,this.isVector=!1,this._attribution=t.attribution||"",this._zIndex=t.zIndex||0,this._isBaseLayer=t.isBaseLayer||!1,this._defaultTextures=t.defaultTextures||[null,null],this._visibility=t.visibility===void 0||t.visibility,this._fading=t.fading||!1,this._fadingFactor=this._opacity/30,this._fading?this._fadingOpacity=0:this._fadingOpacity=this._opacity,this._height=t.height||0,this._extent=new V,this.createTexture=null,this._textureFilter=t.textureFilter?t.textureFilter.trim().toUpperCase():"MIPMAP",this._isSRGB=t.isSRGB!=null&&t.isSRGB,this._internalFormat=null,this._extentMerc=new V,this.setExtent(Yr(t.extent,new V(new A(-180,-90),new A(180,90)))),this._pickingColor=new m,this._pickingEnabled=t.pickingEnabled===void 0||t.pickingEnabled,this._isPreloadDone=!1,this._preLoadZoomLevels=t.preLoadZoomLevels||[0,1],this._ambient=null,this._diffuse=null,this._specular=null,t.ambient){let i=Gt(t.ambient,new m(.2,.2,.2));this._ambient=new Float32Array([i.x,i.y,i.z])}if(t.diffuse){let i=Gt(t.diffuse,new m(.8,.8,.8));this._diffuse=new Float32Array([i.x,i.y,i.z])}if(t.specular){let i=Gt(t.specular,new m(3e-4,3e-4,3e-4)),s=t.shininess||20;this._specular=new Float32Array([i.x,i.y,i.z,s])}this.nightTextureCoefficient=t.nightTextureCoefficient||1}get iconSrc(){return this._iconSrc}set iconSrc(e){this._iconSrc=e}set diffuse(e){if(e){let t=Gt(e);this._diffuse=new Float32Array(t.toArray())}else this._diffuse=null}set ambient(e){if(e){let t=Gt(e);this._ambient=new Float32Array(t.toArray())}else this._ambient=null}set specular(e){if(e){let t=Gt(e);this._specular=new Float32Array([t.x,t.y,t.y,this._specular?this._specular[3]:0])}else this._specular=null}set shininess(e){this._specular&&(this._specular[3]=e)}static getTMS(e,t,i){return{x:e,y:(1<<i)-t-1,z:i}}static getTileIndex(e,t,i,s){return`${s}::${e}_${t}_${i}`}get instanceName(){return"Layer"}get rendererEvents(){return this.events}set opacity(e){e!==this._opacity&&(this._fading?e>this._opacity?this._fadingFactor=(e-this._opacity)/30:e<this._opacity&&(this._fadingFactor=(this._opacity-e)/30):this._fadingOpacity=e,this._opacity=e)}set pickingEnabled(e){this._pickingEnabled=e}get pickingEnabled(){return this._pickingEnabled}hasImageryTiles(){return this._hasImageryTiles}getID(){return this.__id}get id(){return this.__id}get _id(){return this.__id}isEqual(e){return e.__id===this.__id}_assignPlanet(e){this._planet=e,e._layers.push(this),e.renderer&&e.renderer.isInitialized()&&(this._isSRGB?this._internalFormat=e.renderer.handler.gl.SRGB8_ALPHA8:this._internalFormat=e.renderer.handler.gl.RGBA8,this.createTexture=e.renderer.handler.createTexture[this._textureFilter],this.events.on("visibilitychange",e._onLayerVisibilityChanged,e),this._isBaseLayer&&this._visibility&&e.setBaseLayer(this),e.events.dispatch(e.events.layeradd,this),this.events.dispatch(this.events.add,e),e.updateVisibleLayers(),this._bindPicking(),this._visibility&&this.hasImageryTiles()&&this._preLoad())}get isIdle(){return this._planet&&this._planet.quadTreeStrategy._terrainCompletedActivated||!1}_bindPicking(){this._planet&&this._planet.renderer&&this._planet.renderer.assignPickingColor(this)}addTo(e){this._planet||this._assignPlanet(e)}remove(){let e=this._planet;if(e){for(let t=0;t<e._layers.length;t++)if(this.isEqual(e._layers[t]))return e.renderer&&e.renderer.clearPickingColor(this),e._layers.splice(t,1),e.updateVisibleLayers(),this.clear(),e.events.dispatch(e.events.layerremove,this),this.events.dispatch(this.events.remove,e),this._planet=null,this._internalFormat=null,this.createTexture=null,this}return this}clear(){this._planet&&this._planet._clearLayerMaterial(this)}get planet(){return this._planet}setAttribution(e){this._attribution!==e&&(this._attribution=e,this._planet&&this._planet.updateAttributionsList())}getAttribution(){return this._attribution}setHeight(e){this._height=e,this._planet&&this._planet.updateVisibleLayers()}getHeight(){return this._height}setZIndex(e){this._zIndex=e,this._planet&&this._planet.updateVisibleLayers()}getZIndex(){return this._zIndex}bringToFront(){if(this._planet){let e=this._planet.visibleTileLayers,t=e[e.length-1];t.isEqual(this)||this.setZIndex(t.getZIndex()+1)}}isBaseLayer(){return this._isBaseLayer}setBaseLayer(e){this._isBaseLayer=e,this._planet&&(!e&&this._planet.baseLayer&&this.isEqual(this._planet.baseLayer)&&(this._planet.baseLayer=null),this._planet.updateVisibleLayers())}setVisibility(e){e!==this._visibility&&(this._visibility=e,this._planet&&(this._isBaseLayer&&e&&this._planet.setBaseLayer(this),this._planet.updateVisibleLayers(),!e||this._isPreloadDone||this.isVector||(this._isPreloadDone=!0,this._preLoad())),this.events.dispatch(this.events.visibilitychange,this))}_forceMaterialApply(e){let t=e.materials,i=t[this.__id];i||(i=t[this.__id]=this.createMaterial(e)),i.isReady||(e.quadTreeStrategy._renderCompleted=!1),this.applyMaterial(i,!0)}clearMaterial(e){}loadMaterial(e,t=!1){}applyMaterial(e,t=!1){return[0,0,1,1]}_preLoadRecursive(e,t){if(!(e.segment.tileZoom>t)){this._preLoadZoomLevels.includes(e.segment.tileZoom)&&this._forceMaterialApply(e.segment);for(let i=0,s=e.nodes.length;i<s;i++)e.nodes[i]&&this._preLoadRecursive(e.nodes[i],t)}}_preLoad(){if(this._planet&&this._preLoadZoomLevels.length){let e=this._planet,t=Math.max(...this._preLoadZoomLevels);for(let i=0,s=e.quadTreeStrategy.quadTreeList.length;i<s;i++)this._preLoadRecursive(e.quadTreeStrategy.quadTreeList[i],t)}}getVisibility(){return this._visibility}setExtent(e){let t=e.southWest.clone(),i=e.northEast.clone();t.lat<Ft&&(t.lat=Ft),i.lat>ht&&(i.lat=ht),this._extent=e.clone(),this._extentMerc=new V(t.forwardMercator(),i.forwardMercator()),this._correctFullExtent()}getExtent(){return this._extent}getExtentMerc(){return this._extentMerc}flyExtent(){var e;(e=this._planet)==null||e.flyExtent(this.getExtent())}viewExtent(){var e;(e=this._planet)==null||e.viewExtent(this.getExtent())}_correctFullExtent(){}get opacity(){return this._opacity}get screenOpacity(){return this._fading?this._fadingOpacity:this._opacity}_refreshFadingOpacity(e,t){let i=this._planet;return this._visibility&&i.getViewExtent().overlaps(this._extent)&&t>=this.minZoom&&e<=this.maxZoom?(this._fadingOpacity+=this._fadingFactor,(this._fadingFactor>0&&this._fadingOpacity>this._opacity||this._fadingFactor<0&&this._fadingOpacity<this._opacity)&&(this._fadingOpacity=this._opacity),!1):(this._fadingOpacity-=this._fadingFactor,this._fadingOpacity<=0&&(this._fadingOpacity=0),!1)}createMaterial(e){return new Ho(e,this)}redraw(){var e;(e=this._planet)==null||e.quadTreeStrategy.clearLayerMaterial(this)}abortMaterialLoading(e){}abortLoading(){}};us.__counter__=0;let It=us;const Vo=["visibilitychange","add","remove","mousemove","mouseenter","mouseleave","lclick","rclick","mclick","ldblclick","rdblclick","mdblclick","lup","rup","mup","ldown","rdown","mdown","lhold","rhold","mhold","mousewheel","touchmove","touchstart","touchend","doubletouch","touchleave","touchenter"],Ya=["load","loadend"],Vt=class Os extends It{constructor(e,t){super(e,t),this.events=this.events.registerNames(Ya),this.animated=t.animated||!1,this.minNativeZoom=t.minNativeZoom||0,this.maxNativeZoom=t.maxNativeZoom||100,this._counter=0,this._pendingsQueue=[],this.drawTile=t.drawTile,this._onLoadend_=null}addTo(e){return this._onLoadend_=this._onLoadend.bind(this),this.events.on("loadend",this._onLoadend_,this),super.addTo(e)}remove(){return this.events.off("loadend",this._onLoadend_),this._onLoadend_=null,super.remove()}_onLoadend(){this._planet&&this._planet.quadTreeStrategy._terrainCompletedActivated&&this._planet.events.dispatch(this._planet.events.layerloadend,this)}get instanceName(){return"CanvasTiles"}get isIdle(){return super.isIdle&&this._counter===0}abortLoading(){this._pendingsQueue.forEach(e=>{this.abortMaterialLoading(e)}),this._pendingsQueue=[]}setVisibility(e){e!==this._visibility&&(super.setVisibility(e),e||this.abortLoading())}loadMaterial(e){let t=e.segment;this._isBaseLayer?e.texture=t.getDefaultTexture():e.texture=t.planet.transparentTexture,(this._planet.layerLock.isFree()||e.segment.tileZoom<2)&&(e.isReady=!1,e.isLoading=!0,Os.__requestsCounter>=Os.MAX_REQUESTS&&this._counter?this._pendingsQueue.push(e):this._exec(e))}_exec(e){Os.__requestsCounter++,this._counter++;const t=this.events.load;t.handlers.length&&this.events.dispatch(t,e),requestAnimationFrame(()=>{this.drawTile(e,i=>{this._counter--,Os.__requestsCounter--,this._correctCounter(),e.isLoading&&e.applyImage(i),this._dequeueRequest()})})}_correctCounter(){this._counter<0&&(this._counter=0),Os.__requestsCounter<0&&(Os.__requestsCounter=0)}abortMaterialLoading(e){e.isLoading&&(this._counter--,Os.__requestsCounter--,this._correctCounter(),this._dequeueRequest()),e.isLoading=!1,e.isReady=!1}_dequeueRequest(){if(this._pendingsQueue.length){if(Os.__requestsCounter<Os.MAX_REQUESTS){const e=this._whilePendings();e&&this._exec(e)}}else this._counter===0&&this._planet&&this._planet.quadTreeStrategy._terrainCompletedActivated&&this.events.dispatch(this.events.loadend)}_whilePendings(){for(;this._pendingsQueue.length;){const e=this._pendingsQueue.pop();if(e&&e.segment&&e.segment.node){if(e.segment.initialized&&e.segment.node.getState()===1)return e;e.isLoading=!1}}return null}applyMaterial(e){if(e.isReady)return e.layer.animated&&requestAnimationFrame(()=>{this.drawTile(e,function(t){e.applyImage(t)})}),e.texOffset;if(e.segment.tileZoom<this.minNativeZoom)e.textureNotExists();else{let t=e.segment,i=t.node,s=!1,n=e.layer.maxNativeZoom;t.passReady&&!e.isLoading&&t.tileZoom<=n&&this.loadMaterial(e);let o=this._id,l=e;for(;i.parentNode;)if(i=i.parentNode,l=i.segment.materials[o],l&&l.textureExists){s=!0;break}if(t.passReady){if(i.segment.tileZoom===n)t.tileZoom>n&&e.textureNotExists();else if(i.segment.tileZoom<n){let h=t.node;for(;h.segment.tileZoom>n;)h=h.parentNode;let c=h.segment.materials[o];c?!c.isLoading&&!c.isReady&&this.loadMaterial(c):(c=h.segment.materials[e.layer._id]=e.layer.createMaterial(h.segment),this.loadMaterial(c))}}if(s){e.layer.animated&&requestAnimationFrame(()=>{e.segment&&this.drawTile(e,function(c){e.applyImage(c)})}),e.appliedNodeId=i.nodeId,e.texture=l.texture;let h=1/(2<<t.tileZoom-i.segment.tileZoom-1);e.texOffset[0]=t.tileX*h-i.segment.tileX,e.texOffset[1]=t.tileY*h-i.segment.tileY,e.texOffset[2]=h,e.texOffset[3]=h}else e.texture=t.planet.transparentTexture,e.texOffset[0]=0,e.texOffset[1]=0,e.texOffset[2]=1,e.texOffset[3]=1}return e.texOffset}clearMaterial(e){e.isReady&&(e.isReady=!1,e.textureExists&&e.texture&&!e.texture.default&&(e.segment.handler.gl.deleteTexture(e.texture),e.texture=null)),this.abortMaterialLoading(e),e.isLoading=!1,e.textureExists=!1,e.layer=null,e.segment=null}};Vt.MAX_REQUESTS=20,Vt.__requestsCounter=0;let is=Vt;const Wa=["change"];class Uo{constructor(e={}){this._onChange=(t,i)=>{if(t){i.preventClick=!0;for(let s=0;s<this._buttons.length;s++){let n=this._buttons[s];n.isEqual(i)||(n.setActive(!1),n.preventClick=!1)}this.events.dispatch(this.events.change,i)}},this.events=at(Wa),this._buttons=e.buttons||[];for(let t=0;t<this._buttons.length;t++)this._bindButton(this._buttons[t])}_bindButton(e){e.events.on("change",this._onChange)}add(e){this._buttons.push(e),this._bindButton(e)}remove(e){for(let t=0;t<this._buttons.length;t++)if(this._buttons[t].isEqual(e))return this._buttons.splice(t),void e.events.off("change",this._onChange)}}class Jr{constructor(e=2,t){this._sourceId=0,this._source=new Map,this._pendingQueue=[],this._numWorkers=e,this._workerQueue=[],t&&this.setProgram(t)}check(){this._pendingQueue.length&&this.make(this._pendingQueue.pop())}setProgram(e){if(Bs(e)){let t=new Blob([e],{type:"application/javascript"});for(let i=0;i<this._numWorkers;i++){let s=new Worker(URL.createObjectURL(t));s.onmessage=n=>{this._onMessage(n),this._workerQueue&&this._workerQueue.unshift(n.target),this.check()},this._workerQueue.push(s)}}else for(let t=0;t<this._numWorkers;t++){let i=new e;i.onmessage=s=>{this._onMessage(s),this._workerQueue&&this._workerQueue.unshift(s.target),this.check()},this._workerQueue.push(i)}}make(e){}_onMessage(e){}destroy(){for(let e=0;e<this._workerQueue.length;e++){const t=this._workerQueue[e];t.onmessage=null,t.terminate()}this._pendingQueue=[],this._workerQueue=[]}get pendingQueue(){return this._pendingQueue}}const Go=`(function(){"use strict";function n(i,f,u){let o=u.length,b=f*o;for(let A=0;A<o;A++)i[b+A]=u[A]}self.onmessage=function(i){var f=i.data.labelData,u=f[0],o=f[1],b=f[2],A=f[3],z=f[4],D=f[5],H=f[6],I=f[7],L=f[8],M=f[9],P=f[10],j=f[11],q=f[12],B=f[13],E=f[14],G=f[15],J=f[16],K=f[17],N=f[18],O=f[19],Q=f[20],R=f[21],S=f[22],T=f[23],U=f[24],Z=f[25],_=f[26],$=f[27],V=f[28],X=f[29];let w=new Float32Array(12*o),s=new Float32Array(24*o),y=new Float32Array(24*o),F=new Float32Array(18*o),g=new Float32Array(18*o),c=new Float32Array(6*o),d=new Float32Array(18*o),p=new Float32Array(24*o),x=new Float32Array(6*o),h=new Float32Array(18*o),v=new Float32Array(6*o),C=new Float32Array(6*o),m=new Float32Array(24*o),k=new Float32Array(18*o);for(let t=0;t<o;t++){n(w,t,b!==0?[0,0,0,-1,1,-1,1,-1,1,0,0,0]:[0,0,0,0,0,0,0,0,0,0,0,0]),n(s,t,[0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0,0,0,-1,0]),n(y,t,[1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0]);var l,r=A,e=z,a=D;n(F,t,[r,e,a,r,e,a,r,e,a,r,e,a,r,e,a,r,e,a]),n(g,t,[r=H,e=I,a=L,r,e,a,r,e,a,r,e,a,r,e,a,r,e,a]),n(c,t,[r=M,r,r,r,r,r]),n(d,t,[r=P,e=j,a=q,r,e,a,r,e,a,r,e,a,r,e,a,r,e,a]),n(p,t,[r=B,e=E,a=G,l=J,r,e,a,l,r,e,a,l,r,e,a,l,r,e,a,l,r,e,a,l]),n(x,t,[r=K,r,r,r,r,r]),n(h,t,[r=N,e=O,a=Q,r,e,a,r,e,a,r,e,a,r,e,a,r,e,a]),n(v,t,[r=R,r,r,r,r,r]),n(C,t,[r=S,r,r,r,r,r]),n(m,t,[r=T,e=U,a=Z,l=_,r,e,a,l,r,e,a,l,r,e,a,l,r,e,a,l,r,e,a,l]),n(k,t,[r=$/255,e=V/255,a=X/255,r,e,a,r,e,a,r,e,a,r,e,a,r,e,a])}self.postMessage({id:u,vertexArr:w,texCoordArr:s,gliphParamArr:y,positionHighArr:F,positionLowArr:g,sizeArr:c,offsetArr:d,rgbaArr:p,rotationArr:x,alignedAxisArr:h,fontIndexArr:v,outlineArr:C,outlineColorArr:m,pickingColorArr:k},[w.buffer,s.buffer,y.buffer,F.buffer,g.buffer,c.buffer,d.buffer,p.buffer,x.buffer,h.buffer,v.buffer,C.buffer,m.buffer,k.buffer])}})();
//# sourceMappingURL=LabelWorker.worker-BT1uJgYn.js.map
`,bn=typeof self<"u"&&self.Blob&&new Blob([Go],{type:"text/javascript;charset=utf-8"});function $a(a){let e;try{if(e=bn&&(self.URL||self.webkitURL).createObjectURL(bn),!e)throw"";const t=new Worker(e,{name:a==null?void 0:a.name});return t.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(e)}),t}catch{return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(Go),{name:a==null?void 0:a.name})}finally{e&&(self.URL||self.webkitURL).revokeObjectURL(e)}}class Xa extends Jr{constructor(e=4){super(e,$a)}_onMessage(e){let t=this._source.get(e.data.id);t.label._lockId===-2?requestAnimationFrame(()=>{this.make({handler:t.handler,label:t.label})}):t.handler.workerCallback(e.data,t.label),this._source.delete(e.data.id)}make(e){let t=e.label;if(e.handler._entityCollection){let i=t.serializeWorkerData(this._sourceId);if(i)if(this._workerQueue.length){let s=this._workerQueue.pop();this._source.set(this._sourceId,e),t._lockId=this._sourceId,this._sourceId++,s.postMessage({labelData:i},[i.buffer])}else this._pendingQueue.push(e)}}}const _s=class z0{constructor(e={}){this.__id=z0.__counter__++,this._position=qt(e.position),this._positionHigh=new m,this._positionLow=new m,m.doubleToTwoFloats(this._position,this._positionHigh,this._positionLow),this._rotation=e.rotation||0,this._color=ae(e.color),this._alignedAxis=qt(e.alignedAxis),this._offset=qt(e.offset),this._visibility=e.visibility==null||e.visibility,this._entity=null,this._handler=null,this._handlerIndex=-1,this._isReady=!1,this._lockId=-1}setPosition(e,t,i){this._position.x=e,this._position.y=t,this._position.z=i,m.doubleToTwoFloats(this._position,this._positionHigh,this._positionLow),this._isReady&&this._handler?this._handler.setPositionArr(this._handlerIndex,this._positionHigh,this._positionLow):this._lockId!==-1&&(this._lockId=-2)}setPosition3v(e){this._position.x=e.x,this._position.y=e.y,this._position.z=e.z,m.doubleToTwoFloats(e,this._positionHigh,this._positionLow),this._isReady&&this._handler?this._handler.setPositionArr(this._handlerIndex,this._positionHigh,this._positionLow):this._lockId!==-1&&(this._lockId=-2)}getPosition(){return this._position}setOffset(e,t,i){this._offset.x=e,this._offset.y=t,i!=null&&(this._offset.z=i),this._isReady&&this._handler?this._handler.setOffsetArr(this._handlerIndex,this._offset):this._lockId!==-1&&(this._lockId=-2)}setOffset3v(e){this.setOffset(e.x,e.y,e.z)}getOffset(){return this._offset}setRotation(e){e!==this._rotation&&(this._rotation=e,this._isReady&&this._handler?this._handler.setRotationArr(this._handlerIndex,e):this._lockId!==-1&&(this._lockId=-2))}getRotation(){return this._rotation}setOpacity(e){e!==this._color.w&&(e!=null&&(this._color.w=e),this._isReady&&this._handler?this._handler.setRgbaArr(this._handlerIndex,this._color):this._lockId!==-1&&(this._lockId=-2))}setColor(e,t,i,s){s===this._color.w&&e===this._color.x&&t===this._color.y&&this._color.z===i||(this._color.x=e,this._color.y=t,this._color.z=i,s!=null&&(this._color.w=s),this._isReady&&this._handler?this._handler.setRgbaArr(this._handlerIndex,this._color):this._lockId!==-1&&(this._lockId=-2))}setColor4v(e){this.setColor(e.x,e.y,e.z,e.w)}setColorHTML(e){this.setColor4v(le(e))}getColor(){return this._color}setVisibility(e){e!==this._visibility&&(this._visibility=e,this._isReady&&this._handler?this._handler.setVisibility(this._handlerIndex,e):this._lockId!==-1&&(this._lockId=-2))}getVisibility(){return this._visibility}setAlignedAxis(e,t,i){this._alignedAxis.x=e,this._alignedAxis.y=t,this._alignedAxis.z=i,this._isReady&&this._handler?this._handler.setAlignedAxisArr(this._handlerIndex,this._alignedAxis):this._lockId!==-1&&(this._lockId=-2)}setAlignedAxis3v(e){this.setAlignedAxis(e.x,e.y,e.z)}getAlignedAxis(){return this._alignedAxis}remove(){this._entity=null,this._handler&&this._handler.remove(this)}setPickingColor3v(e){this._isReady&&this._handler?this._handler.setPickingColorArr(this._handlerIndex,e):this._lockId!==-1&&(this._lockId=-2)}serializeWorkerData(e){return this._handler?new Float32Array([]):null}};_s.__counter__=0;let ss=_s;class Za extends ss{constructor(e={}){super(e),this._handler=null,this._src=e.src||null,this._image=e.image||null,this._scale=1,this._width=e.width||(e.size?e.size[0]:30),this._height=e.height||(e.size?e.size[1]:30)}setSrc(e){this._src=e;let t=this._handler;if(t&&e&&e.length){let i=t._entityCollection.renderNode;if(i&&i.renderer){let s=i.renderer.billboardsTextureAtlas,n=this;s.loadImage(e,function(o){o.__nodeIndex!=null&&s.get(o.__nodeIndex)?(n._image=o,t.setTexCoordArr(n._handlerIndex,s.get(n._image.__nodeIndex).texCoords)):(s.addImage(o),s.createTexture(),n._image=o,i.updateBillboardsTexCoords())})}}}getSrc(){return this._src}setImage(e){this.setSrc(e.src)}getImage(){return this._image}setSize(e,t){this._width=e,this._height=t,this._handler&&this._handler.setSizeArr(this._handlerIndex,e*this._scale,t*this._scale)}getSize(){return{width:this._width,height:this._height}}setWidth(e){this.setSize(e,this._height)}getWidth(){return this._width}setHeight(e){this.setSize(this._width,e)}getHeight(){return this._height}}var oi=(a=>(a[a.POINT=1]="POINT",a[a.LINESTRING=2]="LINESTRING",a[a.POLYGON=3]="POLYGON",a[a.MULTIPOLYGON=4]="MULTIPOLYGON",a[a.MULTILINESTRING=5]="MULTILINESTRING",a))(oi||{});const Ka={POINT:1,LINESTRING:2,POLYGON:3,MULTIPOLYGON:4,MULTILINESTRING:5},de=class t0{constructor(e={}){this.__id=t0.__counter__++,this._entity=null,this._handler=null,this._handlerIndex=-1,this._polyVerticesHighMerc=[],this._polyVerticesLowMerc=[],this._polyVerticesLength=-1,this._polyIndexesLength=-1,this._polyVerticesHandlerIndex=-1,this._polyIndexesHandlerIndex=-1,this._lineVerticesHighMerc=[],this._lineVerticesLowMerc=[],this._lineVerticesLength=-1,this._lineOrdersLength=-1,this._lineIndexesLength=-1,this._lineColorsLength=-1,this._lineThicknessLength=-1,this._lineVerticesHandlerIndex=-1,this._lineOrdersHandlerIndex=-1,this._lineIndexesHandlerIndex=-1,this._lineThicknessHandlerIndex=-1,this._lineColorsHandlerIndex=-1,this._type=e.type&&t0.getType(e.type)||1,this._coordinates=e.coordinates||[],this._extent=t0.getExtent({type:e.type||"POINT",coordinates:e.coordinates||[]},this._coordinates),e.style=e.style||{},this._style={fillColor:ae(e.style.fillColor,new tt(.19,.62,.85,.4)),lineColor:ae(e.style.lineColor,new tt(.19,.62,.85,1)),strokeColor:ae(e.style.strokeColor,new tt(1,1,1,.95)),lineWidth:e.style.lineWidth||3,strokeWidth:e.style.strokeWidth||0},this._visibility=e.visibility||!0,this._pickingReady=!1}get id(){return this.__id}get type(){return this._type}static getType(e){return Ka[e.toUpperCase()]}static getExtent(e,t){let i=new V(new A(180,90),new A(-180,-90)),s=t0.getType(e.type);if(s===1){let n=e.coordinates[0],o=e.coordinates[1];i.southWest.lon=n,i.southWest.lat=o,i.northEast.lon=n,i.northEast.lat=o,t&&(t[0]=n)&&(t[1]=o)}else if(s===2){let n=e.coordinates;for(let o=0;o<n.length;o++){let l=n[o][0],h=n[o][1];l<i.southWest.lon&&(i.southWest.lon=l),h<i.southWest.lat&&(i.southWest.lat=h),l>i.northEast.lon&&(i.northEast.lon=l),h>i.northEast.lat&&(i.northEast.lat=h),t&&(t[o]=[l,h])}}else if(s===3){let n=e.coordinates;for(let o=0;o<n.length;o++){let l=n[o];t&&(t[o]=[]);for(let h=0;h<l.length;h++){let c=l[h],d=c[0],u=c[1];d<i.southWest.lon&&(i.southWest.lon=d),u<i.southWest.lat&&(i.southWest.lat=u),d>i.northEast.lon&&(i.northEast.lon=d),u>i.northEast.lat&&(i.northEast.lat=u),t&&(t[o][h]=[d,u])}}}else if(s===4){let n=e.coordinates;for(let o=0;o<n.length;o++){let l=n[o];t&&(t[o]=[]);for(let h=0;h<l.length;h++){let c=l[h];t&&(t[o][h]=[]);for(let d=0;d<c.length;d++){let u=c[d],f=u[0],_=u[1];f<i.southWest.lon&&(i.southWest.lon=f),_<i.southWest.lat&&(i.southWest.lat=_),f>i.northEast.lon&&(i.northEast.lon=f),_>i.northEast.lat&&(i.northEast.lat=_),t&&(t[o][h][d]=[f,_])}}}}else if(s===5){let n=e.coordinates;for(let o=0;o<n.length;o++){let l=n[o];t&&(t[o]=[]);for(let h=0;h<l.length;h++){let c=l[h],d=c[0],u=c[1];d<i.southWest.lon&&(i.southWest.lon=d),u<i.southWest.lat&&(i.southWest.lat=u),d>i.northEast.lon&&(i.northEast.lon=d),u>i.northEast.lat&&(i.northEast.lat=u),t&&(t[o][h]=[d,u])}}}else i.southWest.lon=i.southWest.lat=i.northEast.lon=i.northEast.lat=0,t&&(t[0]=0)&&(t[1]=0);return i}setGeometry(e){let t=this._handler;return t&&(this.remove(),this._type=t0.getType(e.type||"Point"),this._extent=t0.getExtent(e,this._coordinates),t.add(this)),this}setFillColor(e,t,i,s=1){let n=this._style.fillColor;return(n.w===0&&s!==0||n.w!==0&&s===0)&&(this._pickingReady=!1),n.x=e,n.y=t,n.z=i,n.w=s,this._handler&&this._handler.setPolyColorArr(this,n),this}overlaps(e){return this._extent.overlaps(e)}setFillColor4v(e){return this.setFillColor(e.x,e.y,e.z,e.w)}setStrokeColor(e,t,i,s=1){let n=this._style.strokeColor;return(n.w===0&&s!==0||n.w!==0&&s===0)&&(this._pickingReady=!1),n.x=e,n.y=t,n.z=i,n.w=s,this._handler&&this._handler.setLineStrokeColorArr(this,n),this}setLineColor(e,t,i,s=1){let n=this._style.lineColor;return(n.w===0&&s!==0||n.w!==0&&s===0)&&(this._pickingReady=!1),n.x=e,n.y=t,n.z=i,n.w=s,this._handler&&this._handler.setLineColorArr(this,n),this}setStrokeColor4v(e){return this.setStrokeColor(e.x,e.y,e.z,e.w)}setLineColor4v(e){return this.setLineColor(e.x,e.y,e.z,e.w)}setStrokeOpacity(e){let t=this._style.strokeColor;return t.w=e,this.setStrokeColor(t.x,t.y,t.z,e)}setLineOpacity(e){let t=this._style.lineColor;return t.w=e,this.setLineColor(t.x,t.y,t.z,e)}setStrokeWidth(e){return this._style.strokeWidth=e,this._pickingReady=!1,this._handler&&this._handler.setLineStrokeArr(this,e),this}bringToFront(){return this._handler&&this._handler.bringToFront(this),this}setLineWidth(e){return this._style.lineWidth=e,this._pickingReady=!1,this._handler&&this._handler.setLineThicknessArr(this,e),this}setFillOpacity(e){let t=this._style.fillColor;return(t.w===0&&e!==0||t.w!==0&&e===0)&&(this._pickingReady=!1),t.w=e,this._handler&&this._handler.setPolyColorArr(this,t),this}setVisibility(e){return this._visibility=e,this._handler&&this._handler.setGeometryVisibility(this),this}getVisibility(){return this._visibility}remove(){this._handler&&this._handler.remove(this)}getExtent(){return this._extent.clone()}getType(){return this._type}};de.__counter__=0;let pr=de;class Qt{constructor(e,t){this.p0=e||new m,this.p1=t||new m}getMagnitude(){return this.p0.distance(this.p1)}getSphereIntersection(e){let t=this.p0,i=this.p1,s=e.center.x,n=e.center.y,o=e.center.z,l=t.x,h=t.y,c=t.z,d=i.x-l,u=i.y-h,f=i.z-c,_=d*d+u*u+f*f,g=2*(l*d+h*u+c*f-d*s-u*n-f*o),v=g*g-4*_*(l*l-2*l*s+s*s+h*h-2*h*n+n*n+c*c-2*c*o+o*o-e.radius*e.radius);if(v<0)return[];let p=(-g-Math.sqrt(v))/(2*_),y=new m(t.x*(1-p)+p*i.x,t.y*(1-p)+p*i.y,t.z*(1-p)+p*i.z);if(v==0)return[y];let b=(-g+Math.sqrt(v))/(2*_),C=new m(t.x*(1-b)+b*i.x,t.y*(1-b)+b*i.y,t.z*(1-b)+b*i.z);return Math.abs(p-.5)<Math.abs(b-.5)?[y,C]:[C,y]}intersects(e,t,i){let s=this.p0.sub(e.p0),n=e.p1.sub(e.p0);if(Math.abs(n.x)<re&&Math.abs(n.y)<re&&Math.abs(n.z)<re)return!1;let o=this.p1.sub(this.p0);if(Math.abs(o.x)<re&&Math.abs(o.y)<re&&Math.abs(o.z)<re)return!1;let l=s.x*n.x+s.y*n.y+s.z*n.z,h=n.x*o.x+n.y*o.y+n.z*o.z,c=s.x*o.x+s.y*o.y+s.z*o.z,d=n.x*n.x+n.y*n.y+n.z*n.z,u=(o.x*o.x+o.y*o.y+o.z*o.z)*d-h*h;if(Math.abs(u)<re)return!1;let f=(l*h-c*d)/u;if(t.x=this.p0.x+f*o.x,t.y=this.p0.y+f*o.y,t.z=this.p0.z+f*o.z,i){let _=(l+h*f)/d;i.x=e.p0.x+_*n.x,i.y=e.p0.y+_*n.y,i.z=e.p0.z+_*n.z}return!0}getNearestDistancePoint(e,t){let i=this.p0,s=this.p1,n=this.getMagnitude(),o=((e.x-i.x)*(s.x-i.x)+(e.y-i.y)*(s.y-i.y)+(e.z-i.z)*(s.z-i.z))/(n*n);return t.x=i.x+o*(s.x-i.x),t.y=i.y+o*(s.y-i.y),t.z=i.z+o*(s.z-i.z),!(o<0||o>1)}}class mt{constructor(e,t){this.p=e?e.clone():new m,this.n=t?t.clone():this.p.isZero()?m.UP:this.p.getNormal()}setByPoints(e,t,i){let s=m.sub(t,e),n=m.sub(i,e);return this.n=s.cross(n),this.p.copy(e),this}static fromPoints(e,t,i){return new mt().setByPoints(e,t,i)}set(e,t){this.p.copy(e),this.n.copy(t)}getNormal(){return this.n.clone()}distance(e){let t=this.getProjection(e);return e.distance(t)}getProjection(e,t){return m.proj_b_to_plane(e,this.n,t)}getProjectionPoint(e,t){let i=e.sub(this.p),s=this.n,n=i.dot(s);return t?t.copy(s.scale(n)):t=s.scale(n),e.sub(t)}getIntersection(e,t,i){let s,n=e.n.cross(t.n),o=n.x>=0?n.x:-n.x,l=n.y>=0?n.y:-n.y,h=n.z>=0?n.z:-n.z;if(o+l+h<vo){let f=t.p.sub(e.p);return e.n.dot(f)==0?1:0}s=o>l?o>h?1:3:l>h?2:3;let c,d,u=new m;return c=-e.n.dot(e.p),d=-t.n.dot(t.p),s===1?(u.x=0,u.y=(d*e.n.z-c*t.n.z)/n.x,u.z=(c*t.n.y-d*e.n.y)/n.x):s===2?(u.x=(c*t.n.z-d*e.n.z)/n.y,u.y=0,u.z=(d*e.n.x-c*t.n.x)/n.y):s===3&&(u.x=(d*e.n.y-c*t.n.y)/n.z,u.y=(c*t.n.x-d*e.n.x)/n.z,u.z=0),i.p0.copy(u),i.p1.copy(u.add(n)),2}}let H=class fo{constructor(e=m.ZERO,t=m.ZERO){this.origin=e,this.direction=t}static get OUTSIDE(){return 0}static get INSIDE(){return 1}static get INPLANE(){return 2}static get AWAY(){return 3}set(e,t){return this.origin=e,this.direction=t,this}getPoint(e){return m.add(this.origin,this.direction.scaleTo(e))}hitTriangleRes(e,t,i,s){let n=t.sub(e),o=i.sub(e),l=n.cross(o),h=this.origin.sub(e),c=-l.dot(h),d=l.dot(this.direction);if(Math.abs(d)<re)return c===0?(s.copy(this.origin),fo.INPLANE):fo.OUTSIDE;let u=c/d;if(s.copy(this.origin.add(this.direction.scaleTo(u))),u<0)return fo.AWAY;let f=n.dot(n),_=n.dot(o),g=o.dot(o),v=s.sub(e),p=v.dot(n),y=v.dot(o),b=_*_-f*g,C=(_*y-g*p)/b;if(C<0||C>1)return fo.OUTSIDE;let T=(_*p-f*y)/b;return T<0||C+T>1?fo.OUTSIDE:fo.INSIDE}hitPlaneRes(e,t){const i=this.direction.dot(e.n);if(Math.abs(i)<re)return fo.OUTSIDE;const s=e.p.sub(this.origin).dot(e.n)/i;return s<0?fo.AWAY:(t.copy(this.getPoint(s)),fo.INSIDE)}hitSphere(e){const t=m.sub(this.origin,e.center),i=this.direction.dot(this.direction),s=2*t.dot(this.direction),n=s*s-4*i*(t.dot(t)-e.radius*e.radius);if(n<0)return null;const o=Math.sqrt(n);let l=(-s-o)/(2*i);return l<0&&(l=(-s+o)/(2*i)),l<0?null:m.add(this.origin,this.direction.scaleTo(l))}hitBox(e){}};function Gs(a){let e=a.split("/"),t=e[e.length-1],i=e[e.length-2];return`${i?i+"/":""}${t}`}class wn{constructor(){this.objPositions=[],this.objTexcoords=[],this.objNormals=[],this.objVertexData=[this.objPositions,this.objTexcoords,this.objNormals],this.vertexData=[[],[],[]],this._materialLibs=[],this.geometries=[],this.geometry=null,this.materials={},this.material={},this.object="default",this.groups=["default"],this._path="",this.keywords={v:e=>{this.objPositions.push(e.map(parseFloat))},vn:e=>{this.objNormals.push(e.map(parseFloat))},vt:e=>{this.objTexcoords.push([parseFloat(e[0]),1-parseFloat(e[1])])},f:e=>{this.setGeometry();const t=e.length-2;for(let i=0;i<t;++i)this.addVertex(e[0]),this.addVertex(e[i+1]),this.addVertex(e[i+2])},s:()=>{},mtllib:(e,t)=>{this._materialLibs.push(t)},usemtl:(e,t)=>{this.newGeometry(),this.setGeometry(),this.geometry&&(this.geometry.material=t)},g:e=>{this.groups=e,this.newGeometry()},o:(e,t)=>{this.object=t,this.newGeometry()},newmtl:(e,t)=>{const i={};this.material=i,this.materials[t]=i},Ns:(e,t)=>{this.material.shininess=parseFloat(t)},Ni:(e,t)=>{},Ka:(e,t)=>{this.material.ambient=e.map(i=>parseFloat(i))},Kd:(e,t)=>{this.material.diffuse=e.map(i=>parseFloat(i))},Ks:(e,t)=>{this.material.specular=e.map(i=>parseFloat(i))},Ke:(e,t)=>{this.material.color=e.map(i=>parseFloat(i))},illum:(e,t)=>{this.material.illum=parseFloat(t)},d:(e,t)=>{this.material.opacity=parseFloat(t)},Tr:(e,t)=>{this.material.opacity=parseFloat(t)},Tf:(e,t)=>{},map_Ka:(e,t)=>{},map_Kd:(e,t)=>{this.material.colorTexture=`${this._path}/${Gs(t)}`},map_Bump:(e,t)=>{this.material.normalTexture=`${this._path}/${Gs(t)}`},map_Ns:(e,t)=>{this.material.metallicRoughnessTexture=`${this._path}/${Gs(t)}`}}}newGeometry(){this.geometry&&this.geometry.data.vertices.length&&(this.geometry=null)}setGeometry(){if(!this.geometry){const e=[],t=[],i=[];this.vertexData=[e,t,i],this.geometry={object:this.object,groups:this.groups,material:"",data:{vertices:e,texCoords:t,normals:i}},this.geometries.push(this.geometry)}}addVertex(e){let t=e.split("/");for(let i=0;i<t.length;i++){let s=t[i];if(!s)continue;let n=parseInt(s)-1,o=this.vertexData[i],l=o.length,h=this.objVertexData[i][n],c=h.length;this.vertexData[i].length=l+c;for(let d=0;d<c;d++)o[l+d]=h[d]}}_innerParser(e,t){const i=/(\w*)(?: )*(.*)/,s=e.split(`
`);for(let n=0;n<s.length;++n){const o=s[n].trim();if(o===""||o.startsWith("#"))continue;const l=i.exec(o);if(!l)continue;const[,h,c]=l,d=o.split(/\s+/).slice(1),u=this.keywords[h];u?u(d,c):console.warn(`Unknown keyword '${h}' in '${t}:${n}'`)}}get data(){return{geometries:this.geometries,materials:this.materials}}async load(e){this._path=e.substring(0,e.lastIndexOf("/"));const t=await fetch(e);if(!t.ok)throw new Error(`Unable to load '${e}'`);const i=t.body.getReader(),s=new TextDecoder;let{value:n,done:o}=await i.read(),l="";for(;!o;){const c=(l+s.decode(n,{stream:!0})).split(`
`);l=c.pop();for(const d of c)this._innerParser(d,e);({value:n,done:o}=await i.read())}l&&this._innerParser(l,e),this._cleanupGeometryArrays();let h=this._materialLibs.map(c=>(c=`${this._path}/${c}`,fetch(c).then(d=>d.text()).then(d=>({text:d,filename:c}))));return await Promise.all(h).then(c=>{c.forEach(d=>this._innerParser(d.text,d.filename))}),this.data}async _readAndParse(e){const t=e.stream().getReader(),i=new TextDecoder;let{value:s,done:n}=await t.read(),o="";for(;!n;){const l=(o+i.decode(s,{stream:!0})).split(`
`);o=l.pop();for(const h of l)this._innerParser(h,e.name);({value:s,done:n}=await t.read())}o&&this._innerParser(o,e.name)}async readFile(e,t){return this._path="",await this._readAndParse(e),this._cleanupGeometryArrays(),t&&await this._readAndParse(t),this.data}_cleanupGeometryArrays(){for(const e of this.geometries)e.data=Object.fromEntries(Object.entries(e.data).filter(([t,i])=>i.length>0))}}function ke(a){let e=new Float32Array([1,1,1]);if(a instanceof Array)e[0]=a[0],e[1]=a[1],e[2]=a[2];else if(typeof a=="string"){let t=me(a);e[0]=t[0],e[1]=t[1],e[2]=t[2]}return e}class W{constructor(e={}){var t;if(this._name=e.name||"noname",this._vertices=e.vertices||[],this._numVertices=this._vertices.length/3,this._texCoords=e.texCoords||new Array(2*this._numVertices),this.color=(t=e.color)instanceof Array?new Float32Array(t):typeof t=="string"?me(t):new Float32Array([.5,.5,.5,1]),this.ambient=ke(e.ambient),this.diffuse=ke(e.diffuse),this.specular=ke(e.specular),this.shininess=e.shininess||100,this.colorTextureSrc=e.colorTextureSrc||null,this.colorTextureImage=e.colorTextureImage||null,this.normalTextureSrc=e.normalTextureSrc||null,this.normalTextureImage=e.normalTextureImage||null,this.metallicRoughnessTextureSrc=e.metallicRoughnessTextureSrc||null,this.metallicRoughnessTextureImage=e.metallicRoughnessTextureImage||null,e.scale){let i,s=e.scale;i=typeof s=="number"?new m(s,s,s):s,W.scale(this._vertices,i)}if(e.center&&W.centering(this._vertices),this.center=W.getCenter(this._vertices),e.indices)this._indices=e.indices,this._normals=e.normals||[];else{this._normals=e.normals||W.getNormals(this._vertices),this._indices=new Array(this._vertices.length/3);for(let i=0,s=this._indices.length;i<s;i++)this._indices[i]=i}}static getCenter(e){let t=yt,i=yt,s=yt,n=Tt,o=Tt,l=Tt;for(let h=0,c=e.length;h<c;h+=3){let d=e[h],u=e[h+1],f=e[h+2];d<t&&(t=d),u<i&&(i=u),f<s&&(s=f),d>n&&(n=d),u>o&&(o=u),f>l&&(l=f)}return new m(t+.5*(n-t),i+.5*(o-i),s+.5*(l-s))}static centering(e){let t=W.getCenter(e);for(let i=0,s=e.length;i<s;i+=3)e[i]-=t.x,e[i+1]-=t.y,e[i+2]-=t.z}setMaterial(e){return e.ambient&&(this.ambient=ke(e.ambient)),e.diffuse&&(this.diffuse=ke(e.diffuse)),e.specular&&(this.specular=ke(e.specular)),e.shininess!==void 0&&(this.shininess=e.shininess),this}centering(){return W.centering(this._vertices),this}applyMat4(e){for(let t=0,i=this._vertices.length;t<i;t+=3){let s=new m(this._vertices[t],this._vertices[t+1],this._vertices[t+2]),n=new m(this._normals[t],this._normals[t+1],this._normals[t+2]);s=e.mulVec3(s),n=e.mulVec3(n),this._vertices[t]=s.x,this._vertices[t+1]=s.y,this._vertices[t+2]=s.z,this._normals[t]=n.x,this._normals[t+1]=n.y,this._normals[t+2]=n.z}return this}scale(e){return W.scale(this._vertices,e),this}translate(e){for(let t=0,i=this._vertices.length;t<i;t+=3)this._vertices[t]+=e.x,this._vertices[t+1]+=e.y,this._vertices[t+2]+=e.z;return this}get name(){return this._name}get vertices(){return this._vertices}get normals(){return this._normals}get indices(){return this._indices}get texCoords(){return this._texCoords}get numVertices(){return this._numVertices}static scale(e,t){for(let i=0;i<e.length;i+=3)e[i]*=t.x,e[i+1]*=t.y,e[i+2]*=t.z}static centroid(e){let t=1e3,i=1e3,s=1e3,n=-1e3,o=-1e3,l=-1e3;for(let h=0;h<e.length;h+=3){let c=e[h],d=e[h+1],u=e[h+2];c<t&&(t=c),d<i&&(i=d),u<s&&(s=u),c>n&&(n=c),d>o&&(o=d),u>l&&(l=u)}return[t+.5*(n-t),i+.5*(o-i),s+.5*(l-s)]}static translate(e,t){for(let i=0;i<e.length;i+=3)e[i]+=t[0],e[i+1]+=t[1],e[i+2]+=t[2]}static getNormals(e){let t=new Array(e.length);for(let i=0;i<e.length;i+=9){let s=i,n=i+3,o=i+6,l=e[s],h=e[s+1],c=e[s+2],d=e[n]-l,u=e[n+1]-h,f=e[n+2]-c,_=e[o]-l,g=e[o+1]-h,v=e[o+2]-c,p=u*v-f*g,y=f*_-d*v,b=d*g-u*_,C=Math.sqrt(p*p+y*y+b*b);p/=C,y/=C,b/=C,t[s]=p,t[s+1]=y,t[s+2]=b,t[n]=p,t[n+1]=y,t[n+2]=b,t[o]=p,t[o+1]=y,t[o+2]=b}return t}static createSphere(e=16,t=16,i=1,s=0,n=0,o=0){let l=[],h=[],c=[];for(let d=0;d<=t;d++){let u=d*Math.PI/t,f=Math.sin(u),_=Math.cos(u);for(let g=0;g<=e;g++){let v=2*g*Math.PI/e,p=Math.sin(v),y=Math.cos(v)*f+s,b=_+n,C=p*f+o;c.push(y),c.push(b),c.push(C),l.push(i*y),l.push(i*b),l.push(i*C)}}for(let d=0;d<t;d++)for(let u=0;u<e;u++){let f=d*(e+1)+u,_=f+e+1;h.push(f),h.push(f+1),h.push(_),h.push(_),h.push(f+1),h.push(_+1)}return new W({vertices:l,normals:c,indices:h})}static createDisc(e=1,t=0,i=8,s=!0,n=0,o=0,l=0,h=0){let c=[],d=[],u=[],f=2*Math.PI,_=s?1:-1,g=n;for(let p=1;p<=i;p++)c.push(o,t*_+l,h),u.push(0,_,0),n++;let v=n;for(let p=0;p<=i;p++){let y=p/i*f+0,b=Math.cos(y),C=Math.sin(y);c.push(e*C+o,t*_+l,e*b+h),u.push(0,_,0),n++}for(let p=0;p<i;p++){let y=g+p,b=v+p;s?d.push(b,b+1,y):d.push(b+1,b,y)}return new W({vertices:c,normals:u,indices:d})}static getFrustumScaleByCameraAngles(e,t,i){return new m(2*e*Math.tan(Kt*t),2*e*Math.tan(Kt*i),e)}static getFrustumScaleByCameraAspectRatio(e,t,i){let s=Vr*Math.atan(Math.tan(Kt*t)/i);return W.getFrustumScaleByCameraAngles(e,t,s)}static createFrustum(e=1,t=1,i=1,s=0,n=0,o=0){return new W({vertices:[0+s,0+n,0+o,-1*(t*=.5)+s,1*(i*=.5)+n,-1*e+o,1*t+s,1*i+n,-1*e+o,0+s,0+n,0+o,1*t+s,-1*i+n,-1*e+o,-1*t+s,-1*i+n,-1*e+o,0+s,0+n,0+o,1*t+s,1*i+n,-1*e+o,1*t+s,-1*i+n,-1*e+o,0+s,0+n,0+o,-1*t+s,-1*i+n,-1*e+o,-1*t+s,1*i+n,-1*e+o,0+s,0+n,0+o,1*t+s,1*i+n,-1*e+o,-1*t+s,1*i+n,-1*e+o,0+s,0+n,0+o,-1*t+s,-1*i+n,-1*e+o,1*t+s,-1*i+n,-1*e+o,0+s,0+n,0+o,1*t+s,-1*i+n,-1*e+o,1*t+s,1*i+n,-1*e+o,0+s,0+n,0+o,-1*t+s,1*i+n,-1*e+o,-1*t+s,-1*i+n,-1*e+o]})}static createCylinder(e=1,t=1,i=1,s=32,n=1,o=!0,l=!0,h=0,c=0,d=0){let u=[],f=[],_=[],g=2*Math.PI,v=0,p=[],y=new m,b=(t-e)/i;for(let C=0;C<=n;C++){let T=[],w=C/n,L=w*(t-e)+e;for(let S=0;S<=s;S++){let P=S/s*g+0,B=Math.sin(P),k=Math.cos(P);u.push(L*B+h,-w*i+i+c,L*k+d),y.set(B,b,k).normalize(),_.push(y.x,y.y,y.z),T.push(v++)}p.push(T)}for(let C=0;C<s;C++)for(let T=0;T<n;T++){let w=p[T][C],L=p[T+1][C],S=p[T+1][C+1],P=p[T][C+1];f.push(w,L,P),f.push(L,S,P)}if(e!==0&&o){let C=W.createDisc(e,i,s,!0,v,h,c,d);u.push(...C.vertices),_.push(...C.normals),f.push(...C.indices)}if(t!==0&&l){let C=W.createDisc(t,0,s,!1,v+(o?1+2*s:0),h,c,d);u.push(...C.vertices),_.push(...C.normals),f.push(...C.indices)}return new W({vertices:u,normals:_,indices:f})}static createCube(e=1,t=1,i=1,s=0,n=0,o=0){let l=.5*e+s,h=.5*t+n,c=.5*i+o;return new W({vertices:[-l,-h,c,l,-h,-c,l,-h,c,-l,-h,c,-l,-h,-c,l,-h,-c,-l,h,c,l,h,c,l,h,-c,-l,h,c,l,h,-c,-l,h,-c,-l,-h,c,l,-h,c,-l,h,c,-l,h,c,l,-h,c,l,h,c,-l,-h,-c,-l,h,-c,l,-h,-c,-l,h,-c,l,h,-c,l,-h,-c,l,-h,c,l,-h,-c,l,h,c,l,h,c,l,-h,-c,l,h,-c,-l,-h,c,-l,h,c,-l,-h,-c,-l,h,c,-l,h,-c,-l,-h,-c]})}static createPlane(e=1,t=1,i=0,s=0,n=0){let o=.5*e,l=.5*t;return new W({vertices:[-o+i,s,l+n,o+i,s,-l+n,o+i,s,l+n,-o+i,s,l+n,-o+i,s,-l+n,o+i,s,-l+n,-o+i,s,l+n,o+i,s,l+n,o+i,s,-l+n,-o+i,s,l+n,o+i,s,-l+n,-o+i,s,-l+n]})}static createArrow(e=0,t=2.1,i=-15){return new W({vertices:[0,t,0,7,0,6,0,0,i,0,0,e,7,0,6,0,t,0,-7,0,6,0,0,e,0,t,0,-7,0,6,0,t,0,0,0,i,-7,0,6,0,0,i,0,0,e,0,0,e,0,0,i,7,0,6]})}static async readFileObj(e,t,i){const s=await new wn().readFile(e,t);let n=s.materials;return s.geometries.map(o=>{let l=n[o.material]||{};return new W({name:o.object,vertices:o.data.vertices,normals:o.data.normals,texCoords:o.data.texCoords,ambient:l.ambient,diffuse:l.diffuse,specular:l.specular,shininess:l.shininess,color:l.color,colorTextureSrc:i?`${i}/${l.colorTexture}`:l.colorTexture,normalTextureSrc:i?`${i}/${l.normalTexture}`:l.normalTexture,metallicRoughnessTextureSrc:i?`${i}/${l.metallicRoughnessTexture}`:l.metallicRoughnessTexture})})}static async loadObj(e){const t=await new wn().load(e);let i=t.materials;return t.geometries.map(s=>{let n=i[s.material]||{};return new W({name:s.object,vertices:s.data.vertices,normals:s.data.normals,texCoords:s.data.texCoords,ambient:n.ambient,diffuse:n.diffuse,specular:n.specular,shininess:n.shininess,color:n.color,colorTextureSrc:n.colorTexture,normalTextureSrc:n.normalTexture,metallicRoughnessTextureSrc:n.metallicRoughnessTexture})})}merge(e){const t=this._vertices.length/3;let i=this._vertices.length;this._vertices.length=i+e._vertices.length;for(let s=0;s<e._vertices.length;s++)this._vertices[i+s]=e._vertices[s];i=this._normals.length,this._normals.length=i+e._normals.length;for(let s=0;s<e._normals.length;s++)this._normals[i+s]=e._normals[s];i=this._texCoords.length,this._texCoords.length=i+e._texCoords.length;for(let s=0;s<e._texCoords.length;s++)this._texCoords[i+s]=e._texCoords[s];i=this._indices.length,this._indices.length=i+e._indices.length;for(let s=0;s<e._indices.length;s++)this._indices[i+s]=e._indices[s]+t;return this._numVertices=this._vertices.length/3,this}static merge(e,t){let i=new W,s=t||e.length;for(let n=0;n<s;n++)i.merge(e[n]);return i}}const Qa=new m(0,0,-1),fs=class I0{constructor(e){var t,i;this._handlerIndex=-1,this._tag=e.tag||"tag_"+I0.__counter__++,this._entity=null,this._position=qt(e.position),this._rtcPositionHigh=new m,this._rtcPositionLow=new m,this._scale=qt(e.scale,new m(1,1,1)),this._translate=qt(e.translate,new m),this._localPosition=new m;const[s=.15,n=.15,o=.15,l=1]=(t=e.object3d)!=null&&t.color?Array.from(e.object3d.color):[];this._color=ae(e.color,new tt(s,n,o,l)),this._handler=null,this._handlerIndex=-1,this._tagData=null,this._tagDataIndex=-1;let h=e.object3d;e.object3d&&((i=e.object3d)==null?void 0:i.vertices.length)!==0||(h=new W),e.objSrc&&(this.setObjectSrc(e.objSrc),this._objectSrc=e.objSrc),this._object3d=h,this._visibility=e.visibility==null||e.visibility,this._children=[],this._direction=new m,this._qFrame=new D,this._qRot=D.IDENTITY}get tag(){return this._tag}getPosition(){return this._position}get object3d(){return this._object3d}get vertices(){return this._object3d.vertices}get normals(){return this._object3d.normals}get texCoords(){return this._object3d.texCoords}get indices(){return this._object3d.indices}setOpacity(e){this._color.w=e,this.setColor(this._color.x,this._color.y,this._color.z,e)}getOpacity(){return this._color.w}setColor(e,t,i,s){this._color.x=e,this._color.y=t,this._color.z=i,s!=null&&(this._color.w=s),this._handler&&this._handler.setRgbaArr(this._tagData,this._tagDataIndex,this._color)}setColor4v(e){this._color.x=e.x,this._color.y=e.y,this._color.z=e.z,e.w!=null&&(this._color.w=e.w),this._handler&&this._handler.setRgbaArr(this._tagData,this._tagDataIndex,this._color)}setVisibility(e){this._visibility=e,this._handler&&this._handler.setVisibility(this._tagData,this._tagDataIndex,e)}getVisibility(){return this._visibility}setPosition(e,t,i){this._position.x=e,this._position.y=t,this._position.z=i,this.updateRTCPosition(),this.updateRotation()}updateRTCPosition(){this._handler&&(this._handler.getRTCPosition(this._position,this._rtcPositionHigh,this._rtcPositionLow),this._handler.setRTCPositionArr(this._tagData,this._tagDataIndex,this._rtcPositionHigh,this._rtcPositionLow))}setPosition3v(e){this.setPosition(e.x,e.y,e.z)}setObject(e){this._object3d=e}setObjectSrc(e){this._objectSrc=e,this._handler&&this._handler.setObjectSrc(e,this.tag)}setColorHTML(e){this.setColor4v(le(e))}setScale(e){this._scale.x=this._scale.y=this._scale.z=e,this._handler&&this._handler.setScaleArr(this._tagData,this._tagDataIndex,this._scale)}setScale3v(e){this._scale.copy(e),this._handler&&this._handler.setScaleArr(this._tagData,this._tagDataIndex,e)}getScale(){return this._scale}setTranslate3v(e){this._translate.copy(e),this._handler&&this._handler.setTranslateArr(this._tagData,this._tagDataIndex,e)}getTranslate(){return this._translate.clone()}setLocalPosition3v(e){this._localPosition.copy(e),this._handler&&this._handler.setLocalPositionArr(this._tagData,this._tagDataIndex,e)}getLocalPosition(){return this._localPosition.clone()}remove(){this._entity=null,this._handler&&this._handler.remove(this)}setPickingColor3v(e){this._handler&&this._handler.setPickingColorArr(this._tagData,this._tagDataIndex,e)}setRotation(e){this._qRot.copy(e),this._qRot.mulVec3Res(Qa,this._direction).normalize(),this.updateRotation()}getRotation(){return this._qRot}updateRotation(){this._handler&&this._handler.setQRotArr(this._tagData,this._tagDataIndex,this._qRot)}getDirection(){return this._direction.clone()}};fs.__counter__=0;let mr=fs;const ui={RIGHT:0,LEFT:1,CENTER:2},Tn={left:ui.LEFT,right:ui.RIGHT,center:ui.CENTER};class Ja extends ss{constructor(e={}){super(e),this._handler=null,this._text=e.text||"",this._face=Ro(e.face,"arial"),this._size=e.size||24,this._outline=e.outline!=null?e.outline:0,this._outlineColor=ae(e.outlineColor,new tt(0,0,0,1)),this._align=e.align&&Tn[e.align.trim().toLowerCase()]||ui.RIGHT,this._fontIndex=0,this._fontAtlas=null,this._isRTL=e.isRTL||!1,this._letterSpacing=e.letterSpacing||0}setText(e){this._text=e.toString(),this._isReady&&this._handler&&this._handler.setText(this._handlerIndex,e,this._fontIndex,this._align,this._letterSpacing,this._isRTL)}setLetterSpacing(e){this._letterSpacing=e,this._isReady&&this._handler&&this._handler.setText(this._handlerIndex,this._text,this._fontIndex,this._align,e,this._isRTL)}getLetterSpacing(){return this._letterSpacing}setRtl(e){this._isRTL=e,this._isReady&&this._handler&&this._handler.setText(this._handlerIndex,this._text,this._fontIndex,this._align,this._letterSpacing,this._isRTL)}getText(){return this._text}setAlign(e){this._align=Tn[e.trim().toLowerCase()],this._isReady&&this._handler?this._handler.setText(this._handlerIndex,this._text,this._fontIndex,this._align,this._letterSpacing,this._isRTL):this._lockId!==-1&&(this._lockId=-2)}getAlign(){return this._align}setFace(e){this._face=e.trim(),this.update()}getFace(){return this._face}setSize(e){e!==this._size&&(this._size=e,this._isReady&&this._handler?this._handler.setSizeArr(this._handlerIndex,e):this._lockId!==-1&&(this._lockId=-2))}getSize(){return this._size}setOutline(e){this._outline=e,this._isReady&&this._handler?this._handler.setOutlineArr(this._handlerIndex,e):this._lockId!==-1&&(this._lockId=-2)}getOutline(){return this._outline}setOpacity(e){super.setOpacity(e),this.setOutlineOpacity(e)}setOutlineColor(e,t,i,s){s===this._outlineColor.w&&e===this._outlineColor.x&&t===this._outlineColor.y&&i===this._outlineColor.z||(this._outlineColor.x=e,this._outlineColor.y=t,this._outlineColor.z=i,this._outlineColor.w=s,this._isReady&&this._handler?this._handler.setOutlineColorArr(this._handlerIndex,this._outlineColor):this._lockId!==-1&&(this._lockId=-2))}setOutlineColor4v(e){this.setOutlineColor(e.x,e.y,e.z,e.w)}setOutlineColorHTML(e){this.setOutlineColor4v(le(e))}getOutlineColor(){return this._outlineColor}setOutlineOpacity(e){e!==this._outlineColor.w&&(this._outlineColor.w=e,this._isReady&&this._handler?this._handler.setOutlineColorArr(this._handlerIndex,this._outlineColor):this._lockId!==-1&&(this._lockId=-2))}getOutlineOpacity(){return this._outlineColor.w}async update(){if(this._fontAtlas){const e=await this._fontAtlas.getFontIndex(this._face);this._applyFontIndex(e)}}_applyFontIndex(e){this._fontIndex=e,this._isReady&&this._handler?(this._handler.setFontIndexArr(this._handlerIndex,this._fontIndex),this._handler.setText(this._handlerIndex,this._text,this._fontIndex,this._align,this._letterSpacing,this._isRTL)):this._lockId!==-1&&(this._lockId=-2)}assignFontAtlas(e){this._fontAtlas||(this._fontAtlas=e),this.update()}serializeWorkerData(e){return this._handler?new Float32Array([e,this._handler._maxLetters,this.getVisibility()?1:0,this._positionHigh.x,this._positionHigh.y,this._positionHigh.z,this._positionLow.x,this._positionLow.y,this._positionLow.z,this._size,this._offset.x,this._offset.y,this._offset.z,this._color.x,this._color.y,this._color.z,this._color.w,this._rotation,this._alignedAxis.x,this._alignedAxis.y,this._alignedAxis.z,this._fontIndex,this._outline,this._outlineColor.x,this._outlineColor.y,this._outlineColor.z,this._outlineColor.w,this._entity._pickingColor.x,this._entity._pickingColor.y,this._entity._pickingColor.z]):null}}const gs=class F0{constructor(e={}){this.__id=F0.__counter__++,this.visibility=e.visibility==null||e.visibility,this.pointSize=e.pointSize||3,this.pickingScale=e.pickingScale||0,this._renderNode=null,this._entity=null,this._points=[],this._coordinatesData=[],this._colorData=[],this._pickingColorData=[],this._coordinatesBuffer=null,this._colorBuffer=null,this._pickingColorBuffer=null,this._handler=null,this._handlerIndex=-1,this._buffersUpdateCallbacks=[],this._buffersUpdateCallbacks[0]=this._createCoordinatesBuffer,this._buffersUpdateCallbacks[1]=this._createColorBuffer,this._buffersUpdateCallbacks[2]=this._createPickingColorBuffer,this._changedBuffers=new Array(this._buffersUpdateCallbacks.length),e.points&&this.setPoints(e.points)}clear(){this._points.length=0,this._points=[],this._coordinatesData.length=0,this._coordinatesData=[],this._colorData.length=0,this._colorData=[],this._pickingColorData.length=0,this._pickingColorData=[],this._deleteBuffers()}setVisibility(e){this.visibility=e}getVisibility(){return this.visibility}setRenderNode(e){this._renderNode=e,this._setPickingColors()}remove(){this._entity=null,this._handler&&this._handler.remove(this)}setPoints(e){this.clear();for(let t=0;t<e.length;t++){let i=e[t],s=new m(i[0],i[1],i[2]),n=new tt(i[3],i[4],i[5],i[6]==null?255:i[6]);this._coordinatesData.push(s.x,s.y,s.z),this._colorData.push(n.x/255,n.y/255,n.z/255,n.w/255);let o={_entity:this._entity,_pickingColor:new m,_entityCollection:this._entity?this._entity._entityCollection:null,index:t,position:s,color:n,pointCloud:this,properties:i[7]||{}};this._points.push(o),this._renderNode&&this._renderNode.renderer&&(this._renderNode.renderer.assignPickingColor(o),this._pickingColorData.push(o._pickingColor.x/255,o._pickingColor.y/255,o._pickingColor.z/255,1))}this._changedBuffers[0]=!0,this._changedBuffers[1]=!0,this._changedBuffers[2]=!0}setPointPosition(e,t,i,s){this._changedBuffers[0]=!0}setPointColor(e,t,i,s,n){this._changedBuffers[1]=!0}addPoints(e){this._changedBuffers[0]=!0,this._changedBuffers[1]=!0,this._changedBuffers[2]=!0}addPoint(e,t){this._changedBuffers[0]=!0,this._changedBuffers[1]=!0,this._changedBuffers[2]=!0}getPoint(e){return this._points[e]}removePoint(e){this._changedBuffers[0]=!0,this._changedBuffers[1]=!0,this._changedBuffers[2]=!0}insertPoint(e,t){this._changedBuffers[0]=!0,this._changedBuffers[1]=!0,this._changedBuffers[2]=!0}draw(){if(this.visibility&&this._coordinatesData.length){this._update();let e=this._renderNode.renderer,t=e.handler.programs.pointCloud,i=t._program,s=e.handler.gl,n=i.attributes,o=i.uniforms;t.activate(),s.uniformMatrix4fv(o.projectionViewMatrix,!1,e.activeCamera.getProjectionViewMatrix()),s.uniform1f(o.opacity,this._handler._entityCollection._fadingOpacity),s.uniform1f(o.pointSize,this.pointSize),s.bindBuffer(s.ARRAY_BUFFER,this._coordinatesBuffer),s.vertexAttribPointer(n.coordinates,this._coordinatesBuffer.itemSize,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this._colorBuffer),s.vertexAttribPointer(n.colors,this._colorBuffer.itemSize,s.FLOAT,!1,0,0),s.drawArrays(s.POINTS,0,this._coordinatesBuffer.numItems)}}drawPicking(){if(this.visibility&&this._coordinatesData.length){let e=this._renderNode.renderer,t=e.handler.programs.pointCloud,i=t._program,s=e.handler.gl,n=i.attributes,o=i.uniforms;t.activate(),s.uniformMatrix4fv(o.projectionViewMatrix,!1,e.activeCamera.getProjectionViewMatrix()),s.uniform1f(o.opacity,this._handler._entityCollection._fadingOpacity),s.uniform1f(o.pointSize,this.pointSize+this.pickingScale),s.bindBuffer(s.ARRAY_BUFFER,this._coordinatesBuffer),s.vertexAttribPointer(n.coordinates,this._coordinatesBuffer.itemSize,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this._pickingColorBuffer),s.vertexAttribPointer(n.colors,this._pickingColorBuffer.itemSize,s.FLOAT,!1,0,0),s.drawArrays(s.POINTS,0,this._coordinatesBuffer.numItems)}}_update(){if(this._renderNode){let e=this._changedBuffers.length;for(;e--;)this._changedBuffers[e]&&(this._buffersUpdateCallbacks[e].call(this),this._changedBuffers[e]=!1)}}_deleteBuffers(){if(this._renderNode){let e=this._renderNode.renderer.handler.gl;e.deleteBuffer(this._coordinatesBuffer),e.deleteBuffer(this._colorBuffer),e.deleteBuffer(this._pickingColorBuffer)}this._coordinatesBuffer=null,this._colorBuffer=null,this._pickingColorBuffer=null}_createCoordinatesBuffer(){let e=this._renderNode.renderer.handler;e.gl.deleteBuffer(this._coordinatesBuffer),this._coordinatesBuffer=e.createArrayBuffer(new Float32Array(this._coordinatesData),3,this._coordinatesData.length/3)}_createColorBuffer(){let e=this._renderNode.renderer.handler;e.gl.deleteBuffer(this._colorBuffer),this._colorBuffer=e.createArrayBuffer(new Float32Array(this._colorData),4,this._colorData.length/4)}_createPickingColorBuffer(){let e=this._renderNode.renderer.handler;e.gl.deleteBuffer(this._pickingColorBuffer),this._pickingColorBuffer=e.createArrayBuffer(new Float32Array(this._pickingColorData),4,this._pickingColorData.length/4)}_setPickingColors(){if(this._renderNode&&this._renderNode.renderer){for(let e=0;e<this._points.length;e++){let t=this._points[e];t._entity=this._entity,t._entityCollection=this._entity._entityCollection,this._renderNode.renderer.assignPickingColor(t),this._pickingColorData.push(t._pickingColor.x/255,t._pickingColor.y/255,t._pickingColor.z/255,1)}this._changedBuffers[2]=!0}}};gs.__counter__=0;let vr=gs;const je=class m0{constructor(e={}){this.__id=m0.__counter__++,this.__doubleToTwoFloats=m.doubleToTwoFloats,this.altitude=e.altitude||0,this.thickness=e.thickness||1.5,this._opacity=e.opacity!=null?e.opacity:1,this._defaultColor=me(e.color||"#0000FF",e.opacity),this.visibility=e.visibility==null||e.visibility,this._closedLine=e.isClosed||!1,this._path3v=[],this._pathLengths=[],this._pathLonLat=[],this._pathLonLatMerc=[],this._pathColors=e.pathColors?Zr(e.pathColors):[],this._extent=new V,this._verticesHigh=[],this._verticesLow=[],this._orders=[],this._indexes=[],this._colors=[],this._texCoordArr=[],this._atlasTexCoords=[],this._verticesHighBuffer=null,this._verticesLowBuffer=null,this._ordersBuffer=null,this._indexesBuffer=null,this._colorsBuffer=null,this._texCoordBuffer=null,this._pickingColor=[0,0,0],this._renderNode=null,this._entity=null,this._handler=null,this._handlerIndex=-1,this._image=e.image||null,this._src=e.src||null,this._texOffset=e.texOffset||0,this._strokeSize=e.strokeSize!=null?e.strokeSize:32,this._buffersUpdateCallbacks=[],this._buffersUpdateCallbacks[0]=this._createVerticesBuffer,this._buffersUpdateCallbacks[1]=this._createIndexBuffer,this._buffersUpdateCallbacks[2]=this._createColorsBuffer,this._buffersUpdateCallbacks[3]=this._createTexCoordBuffer,this._changedBuffers=new Array(this._buffersUpdateCallbacks.length);let t=qt(e.visibleSpherePosition).toArray(),i=e.visibleSphereRadius||0;this._visibleSphere=new Float32Array([...t,i]),e.pathLonLat?this.setPathLonLat(e.pathLonLat):e.path3v&&this.setPath3v(e.path3v),this._refresh()}get texOffset(){return this._texOffset}set texOffset(e){this._texOffset=e}get strokeSize(){return this._strokeSize}set strokeSize(e){this._strokeSize=e}setSrc(e){this._src=e;let t=this._handler;if(t){let i=t._entityCollection.renderNode;if(i&&i.renderer){let s=i.renderer.strokeTextureAtlas;e&&e.length?s.loadImage(e,n=>{if(n.__nodeIndex!=null&&s.get(n.__nodeIndex)){this._image=n;let o=s.get(n.__nodeIndex);this._setTexCoordArr(o.texCoords)}else s.addImage(n),s.createTexture(),this._image=n,i.updateStrokeTexCoords()}):(this.setTextureDisabled(),i.updateStrokeTexCoords())}}}getSrc(){return this._src}setImage(e){this.setSrc(e.src)}getImage(){return this._image}_setTexCoordArr(e){this._texCoordArr=[],this._atlasTexCoords=e,m0.setPathTexCoords(this._path3v,e,this._texCoordArr),this._changedBuffers[3]=!0}setTextureDisabled(){this._strokeSize=0}__appendLineData3v(e,t,i,s,n,o,l,h,c,d,u,f,_,g){var v=0,p=new m,y=new m;_&&(_.southWest.set(180,90),_.northEast.set(-180,-90)),h.length>0?(v=h[h.length-5]+9,h.push(v,v)):h.push(0,0);for(let I=0,z=e.length;I<z;I++){var b=e[I],C=t[I];if(d[I]=[],f[I]=[],u[I]=[],b.length===0)continue;var T,w=v;if(s)(T=b[b.length-1])instanceof Array&&(T=new m(T[0],T[1],T[2]));else{var L=b[0],S=b[1]||L;L instanceof Array&&(L=new m(L[0],L[1],L[2])),S instanceof Array&&(S=new m(S[0],S[1],S[2])),T=new m(L.x+L.x-S.x,L.y+L.y-S.y,L.z+L.z-S.z)}let Ce=i;C&&C[0]&&(Ce=C[0]),this.__doubleToTwoFloats(T,p,y),n.push(p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z),o.push(y.x,y.y,y.z,y.x,y.y,y.z,y.x,y.y,y.z,y.x,y.y,y.z);let R=Ce[0],O=Ce[1],se=Ce[2],M=Ce[3]!=null?Ce[3]:1;I>0&&g.push(R,O,se,M,R,O,se,M,R,O,se,M,R,O,se,M),l.push(1,-1,2,-2);for(let F=0,Ie=b.length;F<Ie;F++){var P=b[F];if(P instanceof Array&&(P=new m(P[0],P[1],P[2])),u[I].push(P),c){var B=c.cartesianToLonLat(P);d[I].push(B),f[I].push(B.forwardMercator()),B.lon<_.southWest.lon&&(_.southWest.lon=B.lon),B.lat<_.southWest.lat&&(_.southWest.lat=B.lat),B.lon>_.northEast.lon&&(_.northEast.lon=B.lon),B.lat>_.northEast.lat&&(_.northEast.lat=B.lat)}C&&C[F]&&(Ce=C[F]),R=Ce[0],O=Ce[1],se=Ce[2],M=Ce[3]!=null?Ce[3]:1,this.__doubleToTwoFloats(P,p,y),n.push(p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z),o.push(y.x,y.y,y.z,y.x,y.y,y.z,y.x,y.y,y.z,y.x,y.y,y.z),g.push(R,O,se,M,R,O,se,M,R,O,se,M,R,O,se,M),l.push(1,-1,2,-2),h.push(v++,v++,v++,v++)}var k;if(s)(k=b[0])instanceof Array&&(k=new m(k[0],k[1],k[2])),h.push(w,w+1,w+1,w+1);else{let F=b[b.length-1],Ie=b[b.length-2]||F;F instanceof Array&&(F=new m(F[0],F[1],F[2])),Ie instanceof Array&&(Ie=new m(Ie[0],Ie[1],Ie[2])),k=new m(F.x+F.x-Ie.x,F.y+F.y-Ie.y,F.z+F.z-Ie.z),h.push(v-1,v-1,v-1,v-1)}C&&C[b.length-1]&&(Ce=C[b.length-1]),R=Ce[0],O=Ce[1],se=Ce[2],M=Ce[3]!=null?Ce[3]:1,this.__doubleToTwoFloats(k,p,y),n.push(p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z),o.push(y.x,y.y,y.z,y.x,y.y,y.z,y.x,y.y,y.z,y.x,y.y,y.z),g.push(R,O,se,M,R,O,se,M,R,O,se,M,R,O,se,M),l.push(1,-1,2,-2),I<e.length-1&&e[I+1].length!==0&&(v+=8,h.push(v,v))}}__appendPoint3v(e,t,i,s,n,o,l,h,c,d,u,f,_,g){var v=new m,p=new m,y=d.length-4,b=d[y-1]+1;e.length===0?(e.push([]),i[0]||(i[0]=[])):i[e.length-1]||(i[e.length-1]=[]);var C=e[e.length-1],T=C.length;C.push(t);let w=s[0],L=s[1],S=s[2],P=s[3]!=null?s[3]:1,B=i[e.length-1];if(B[T]?(B[T][0]=w,B[T][1]=L,B[T][2]=S,B[T][3]=P):B.push(s),T===1){var k;if(n)(k=C[T-1])instanceof Array&&(k=new m(k[0],k[1],k[2]));else{let F=C[0],Ie=C[1]||F;F instanceof Array&&(F=new m(F[0],F[1],F[2])),Ie instanceof Array&&(Ie=new m(Ie[0],Ie[1],Ie[2])),k=new m(F.x+F.x-Ie.x,F.y+F.y-Ie.y,F.z+F.z-Ie.z)}this.__doubleToTwoFloats(k,v,p);let M=o.length-36;o[M]=v.x,o[M+1]=v.y,o[M+2]=v.z,o[M+3]=v.x,o[M+4]=v.y,o[M+5]=v.z,o[M+6]=v.x,o[M+7]=v.y,o[M+8]=v.z,o[M+9]=v.x,o[M+10]=v.y,o[M+11]=v.z,l[M]=p.x,l[M+1]=p.y,l[M+2]=p.z,l[M+3]=p.x,l[M+4]=p.y,l[M+5]=p.z,l[M+6]=p.x,l[M+7]=p.y,l[M+8]=p.z,l[M+9]=p.x,l[M+10]=p.y,l[M+11]=p.z}var I=b;if(u){f.length===0&&f.push([]),_.length===0&&_.push([]);var z=f[f.length-1],Ce=_[_.length-1];let M=u.cartesianToLonLat(t);z.push(M),Ce.push(M.forwardMercator()),M.lon<g.southWest.lon&&(g.southWest.lon=M.lon),M.lat<g.southWest.lat&&(g.southWest.lat=M.lat),M.lon>g.northEast.lon&&(g.northEast.lon=M.lon),M.lat>g.northEast.lat&&(g.northEast.lat=M.lat)}this.__doubleToTwoFloats(t,v,p);let R=o.length-12;o[R]=v.x,o[R+1]=v.y,o[R+2]=v.z,o[R+3]=v.x,o[R+4]=v.y,o[R+5]=v.z,o[R+6]=v.x,o[R+7]=v.y,o[R+8]=v.z,o[R+9]=v.x,o[R+10]=v.y,o[R+11]=v.z,l[R]=p.x,l[R+1]=p.y,l[R+2]=p.z,l[R+3]=p.x,l[R+4]=p.y,l[R+5]=p.z,l[R+6]=p.x,l[R+7]=p.y,l[R+8]=p.z,l[R+9]=p.x,l[R+10]=p.y,l[R+11]=p.z;let O=h.length-16;var se;if(h[O]=w,h[O+1]=L,h[O+2]=S,h[O+3]=P,h[O+4]=w,h[O+5]=L,h[O+6]=S,h[O+7]=P,h[O+8]=w,h[O+9]=L,h[O+10]=S,h[O+11]=P,h[O+12]=w,h[O+13]=L,h[O+14]=S,h[O+15]=P,d[y]=b++,d[y+1]=b++,d[y+2]=b++,d[y+3]=b++,n)se=C[0],d.push(I,I+1,I+1,I+1);else{let M=C[C.length-1],F=C[C.length-2]||M;se=new m(M.x+M.x-F.x,M.y+M.y-F.y,M.z+M.z-F.z),d.push(b-1,b-1,b-1,b-1)}this.__doubleToTwoFloats(se,v,p),o.push(v.x,v.y,v.z,v.x,v.y,v.z,v.x,v.y,v.z,v.x,v.y,v.z),l.push(p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z,p.x,p.y,p.z),h.push(w,L,S,P,w,L,S,P,w,L,S,P,w,L,S,P),c.push(1,-1,2,-2)}static setPathTexCoords(e,t,i){let s=t[1],n=t[3]-s,o=new N(t[4],t[5]),l=new N(t[2],t[3]),h=new N(t[8],t[9]),c=new N(t[0],t[1]);for(let u=0,f=e.length;u<f;u++){var d=e[u];if(d.length!==0){u>0&&i.push(o.x,o.y,s,n,l.x,l.y,s,n,h.x,h.y,s,n,c.x,c.y,s,n);for(let _=0,g=d.length;_<g;_++)i.push(o.x,o.y,s,n,l.x,l.y,s,n,h.x,h.y,s,n,c.x,c.y,s,n);i.push(o.x,o.y,s,n,l.x,l.y,s,n,h.x,h.y,s,n,c.x,c.y,s,n)}}}static setPathColors(e,t,i,s){for(let l=0,h=e.length;l<h;l++){var n=e[l],o=t[l];if(n.length===0)continue;let c=i;o&&o[0]&&(c=o[0]);let d=c[0],u=c[1],f=c[2],_=c[3]!=null?c[3]:1;l>0&&s.push(d,u,f,_,d,u,f,_,d,u,f,_,d,u,f,_);for(let g=0,v=n.length;g<v;g++)o&&o[g]&&(c=o[g]),d=c[0],u=c[1],f=c[2],_=c[3]!=null?c[3]:1,s.push(d,u,f,_,d,u,f,_,d,u,f,_,d,u,f,_);o&&o[n.length-1]&&(c=o[n.length-1]),d=c[0],u=c[1],f=c[2],_=c[3]!=null?c[3]:1,s.push(d,u,f,_,d,u,f,_,d,u,f,_,d,u,f,_)}}__appendLineDataLonLat(e,t,i,s,n,o,l,h,c,d,u,f,_,g,v){var p=0,y=new m,b=new m;g&&(g.southWest.set(180,90),g.northEast.set(-180,-90)),h.length>0?(p=h[h.length-5]+9,h.push(p)):h.push(0);for(let k=0,I=e.length;k<I;k++){var C=e[k],T=t[k];if(u[k]=[],_[k]=[],f[k]=[],C.length===0)continue;var w,L=p;if(s){let M=C[C.length-1];w=M instanceof Array?d.lonLatToCartesian(new A(M[0],M[1],M[2])):d.lonLatToCartesian(M)}else{let M,F,Ie=C[0];M=Ie instanceof Array?d.lonLatToCartesian(new A(Ie[0],Ie[1],Ie[2])):d.lonLatToCartesian(Ie),Ie=C[1],Ie||(Ie=C[0]),F=Ie instanceof Array?d.lonLatToCartesian(new A(Ie[0],Ie[1],Ie[2])):d.lonLatToCartesian(Ie),w=new m(M.x+M.x-F.x,M.y+M.y-F.y,M.z+M.z-F.z)}let z=i;T&&T[0]&&(z=T[0]),this.__doubleToTwoFloats(w,y,b),n.push(y.x,y.y,y.z,y.x,y.y,y.z,y.x,y.y,y.z,y.x,y.y,y.z),o.push(b.x,b.y,b.z,b.x,b.y,b.z,b.x,b.y,b.z,b.x,b.y,b.z);let Ce=z[0],R=z[1],O=z[2],se=z[3]!=null?z[3]:1;k>0&&v.push(Ce,R,O,se,Ce,R,O,se,Ce,R,O,se,Ce,R,O,se),l.push(1,-1,2,-2),c.push(0,0,0,0,1,0,0,0,1,0,0,0,1,1,0,0);for(let M=0,F=C.length;M<F;M++){var S=C[M];S instanceof Array&&(S=new A(S[0],S[1],S[2])),T&&T[M]&&(z=T[M]),Ce=z[0],R=z[1],O=z[2],se=z[3]!=null?z[3]:1;var P=d.lonLatToCartesian(S);u[k].push(P),f[k].push(S),_[k].push(S.forwardMercator()),this.__doubleToTwoFloats(P,y,b),n.push(y.x,y.y,y.z,y.x,y.y,y.z,y.x,y.y,y.z,y.x,y.y,y.z),o.push(b.x,b.y,b.z,b.x,b.y,b.z,b.x,b.y,b.z,b.x,b.y,b.z),v.push(Ce,R,O,se,Ce,R,O,se,Ce,R,O,se,Ce,R,O,se),l.push(1,-1,2,-2),h.push(p++,p++,p++,p++),c.push(0,0,0,0,1,0,0,0,1,0,0,0,1,1,0,0),S.lon<g.southWest.lon&&(g.southWest.lon=S.lon),S.lat<g.southWest.lat&&(g.southWest.lat=S.lat),S.lon>g.northEast.lon&&(g.northEast.lon=S.lon),S.lat>g.northEast.lat&&(g.northEast.lat=S.lat)}var B;if(s){let M=C[0];B=M instanceof Array?d.lonLatToCartesian(new A(M[0],M[1],M[2])):d.lonLatToCartesian(M),h.push(L,L+1,L+1,L+1)}else{let M,F,Ie=C[C.length-1];M=Ie instanceof Array?d.lonLatToCartesian(new A(Ie[0],Ie[1],Ie[2])):d.lonLatToCartesian(Ie),Ie=C[C.length-2],Ie||(Ie=C[0]),F=Ie instanceof Array?d.lonLatToCartesian(new A(Ie[0],Ie[1],Ie[2])):d.lonLatToCartesian(Ie),B=new m(M.x+M.x-F.x,M.y+M.y-F.y,M.z+M.z-F.z),h.push(p-1,p-1,p-1,p-1)}T&&T[C.length-1]&&(z=T[C.length-1]),Ce=z[0],R=z[1],O=z[2],se=z[3]!=null?z[3]:1,this.__doubleToTwoFloats(B,y,b),n.push(y.x,y.y,y.z,y.x,y.y,y.z,y.x,y.y,y.z,y.x,y.y,y.z),o.push(b.x,b.y,b.z,b.x,b.y,b.z,b.x,b.y,b.z,b.x,b.y,b.z),v.push(Ce,R,O,se,Ce,R,O,se,Ce,R,O,se,Ce,R,O,se),l.push(1,-1,2,-2),c.push(0,0,0,0,1,0,0,0,1,0,0,0,1,1,0,0),k<e.length-1&&e[k+1].length!==0&&(p+=8,h.push(p,p))}}_setEqualPath3v(e){var t=this._extent;t.southWest.set(180,90),t.northEast.set(-180,-90);var i=new m,s=new m,n=this._verticesHigh,o=this._verticesLow,l=this._pathLonLat,h=this._pathLonLatMerc,c=0,d=this._renderNode.ellipsoid;for(let b=0;b<e.length;b++){var u,f,_=e[b];u=this._closedLine?_[_.length-1]:new m(_[0].x+_[0].x-_[1].x,_[0].y+_[0].y-_[1].y,_[0].z+_[0].z-_[1].z),this.__doubleToTwoFloats(u,i,s),n[c]=i.x,o[c++]=s.x,n[c]=i.y,o[c++]=s.y,n[c]=i.z,o[c++]=s.z,n[c]=i.x,o[c++]=s.x,n[c]=i.y,o[c++]=s.y,n[c]=i.z,o[c++]=s.z,n[c]=i.x,o[c++]=s.x,n[c]=i.y,o[c++]=s.y,n[c]=i.z,o[c++]=s.z,n[c]=i.x,o[c++]=s.x,n[c]=i.y,o[c++]=s.y,n[c]=i.z,o[c++]=s.z;for(let C=0;C<_.length;C++){var g=_[C],v=this._path3v[b][C];if(v.x=g.x,v.y=g.y,v.z=g.z,d){var p=d.cartesianToLonLat(g);this._pathLonLat[b][C]=p,l[b][C]=p,h[b][C]=p.forwardMercator(),p.lon<t.southWest.lon&&(t.southWest.lon=p.lon),p.lat<t.southWest.lat&&(t.southWest.lat=p.lat),p.lon>t.northEast.lon&&(t.northEast.lon=p.lon),p.lat>t.northEast.lat&&(t.northEast.lat=p.lat)}this.__doubleToTwoFloats(g,i,s),n[c]=i.x,o[c++]=s.x,n[c]=i.y,o[c++]=s.y,n[c]=i.z,o[c++]=s.z,n[c]=i.x,o[c++]=s.x,n[c]=i.y,o[c++]=s.y,n[c]=i.z,o[c++]=s.z,n[c]=i.x,o[c++]=s.x,n[c]=i.y,o[c++]=s.y,n[c]=i.z,o[c++]=s.z,n[c]=i.x,o[c++]=s.x,n[c]=i.y,o[c++]=s.y,n[c]=i.z,o[c++]=s.z}if(this._closedLine)f=_[0];else{var y=_.length-1;f=new m(_[y].x+_[y].x-_[y-1].x,_[y].y+_[y].y-_[y-1].y,_[y].z+_[y].z-_[y-1].z)}this.__doubleToTwoFloats(f,i,s),n[c]=i.x,o[c++]=s.x,n[c]=i.y,o[c++]=s.y,n[c]=i.z,o[c++]=s.z,n[c]=i.x,o[c++]=s.x,n[c]=i.y,o[c++]=s.y,n[c]=i.z,o[c++]=s.z,n[c]=i.x,o[c++]=s.x,n[c]=i.y,o[c++]=s.y,n[c]=i.z,o[c++]=s.z,n[c]=i.x,o[c++]=s.x,n[c]=i.y,o[c++]=s.y,n[c]=i.z,o[c++]=s.z}}_setEqualPathLonLat(e){var t=this._extent;t.southWest.set(180,90),t.northEast.set(-180,-90);var i=new m,s=new m,n=this._verticesHigh,o=this._verticesLow,l=this._pathLonLat,h=this._pathLonLatMerc,c=this._path3v,d=0,u=this._renderNode.ellipsoid;for(let y=0;y<e.length;y++){var f,_,g=e[y];if(this._closedLine)f=u.lonLatToCartesian(g[g.length-1]);else{let b=u.lonLatToCartesian(g[0]),C=u.lonLatToCartesian(g[1]);f=new m(b.x+b.x-C.x,b.y+b.y-C.y,b.z+b.z-C.z)}this.__doubleToTwoFloats(f,i,s),n[d]=i.x,o[d++]=s.x,n[d]=i.y,o[d++]=s.y,n[d]=i.z,o[d++]=s.z,n[d]=i.x,o[d++]=s.x,n[d]=i.y,o[d++]=s.y,n[d]=i.z,o[d++]=s.z,n[d]=i.x,o[d++]=s.x,n[d]=i.y,o[d++]=s.y,n[d]=i.z,o[d++]=s.z,n[d]=i.x,o[d++]=s.x,n[d]=i.y,o[d++]=s.y,n[d]=i.z,o[d++]=s.z;for(let b=0;b<g.length;b++){var v=g[b],p=u.lonLatToCartesian(v);c[y][b]=p,h[y][b]=v.forwardMercator(),l[y][b]=v,this.__doubleToTwoFloats(p,i,s),n[d]=i.x,o[d++]=s.x,n[d]=i.y,o[d++]=s.y,n[d]=i.z,o[d++]=s.z,n[d]=i.x,o[d++]=s.x,n[d]=i.y,o[d++]=s.y,n[d]=i.z,o[d++]=s.z,n[d]=i.x,o[d++]=s.x,n[d]=i.y,o[d++]=s.y,n[d]=i.z,o[d++]=s.z,n[d]=i.x,o[d++]=s.x,n[d]=i.y,o[d++]=s.y,n[d]=i.z,o[d++]=s.z,v.lon<t.southWest.lon&&(t.southWest.lon=v.lon),v.lat<t.southWest.lat&&(t.southWest.lat=v.lat),v.lon>t.northEast.lon&&(t.northEast.lon=v.lon),v.lat>t.northEast.lat&&(t.northEast.lat=v.lat)}if(this._closedLine)_=u.lonLatToCartesian(g[0]);else{let b=u.lonLatToCartesian(g[g.length-1]),C=u.lonLatToCartesian(g[g.length-2]);_=new m(b.x+b.x-C.x,b.y+b.y-C.y,b.z+b.z-C.z)}this.__doubleToTwoFloats(_,i,s),n[d]=i.x,o[d++]=s.x,n[d]=i.y,o[d++]=s.y,n[d]=i.z,o[d++]=s.z,n[d]=i.x,o[d++]=s.x,n[d]=i.y,o[d++]=s.y,n[d]=i.z,o[d++]=s.z,n[d]=i.x,o[d++]=s.x,n[d]=i.y,o[d++]=s.y,n[d]=i.z,o[d++]=s.z,n[d]=i.x,o[d++]=s.x,n[d]=i.y,o[d++]=s.y,n[d]=i.z,o[d++]=s.z}}setPointLonLat(e,t,i){if(this._renderNode&&this._renderNode.ellipsoid){let h=this._pathLonLat,c=this._pathLonLatMerc;h[i][t]=e,c[i][t]=e.forwardMercator();var s=this._extent;s.southWest.set(180,90),s.northEast.set(-180,-90);for(let d=0;d<h.length;d++){var n=h[d];for(let u=0;u<n.length;u++){var o=n[u].lon,l=n[u].lat;o>s.northEast.lon&&(s.northEast.lon=o),l>s.northEast.lat&&(s.northEast.lat=l),o<s.southWest.lon&&(s.southWest.lon=o),l<s.southWest.lat&&(s.southWest.lat=l)}}this.setPoint3v(this._renderNode.ellipsoid.lonLatToCartesian(e),t,i,!0)}else{let h=this._pathLonLat[i];h[t].lon=e.lon,h[t].lat=e.lat,h[t].height=e.height}}setPoint3v(e,t=0,i=0,s=!1){if(this._renderNode){var n,o=new m,l=new m,h=this._verticesHigh,c=this._verticesLow,d=this._pathLonLat,u=this._pathLonLatMerc,f=0;n=12*this._pathLengths[i]+24*i;let w=this._path3v[i];w[t].x=e.x,w[t].y=e.y,w[t].z=e.z;let L=this._closedLine||w.length===1;var _;if((t===0||t===1)&&(_=L?w[w.length-1]:new m(w[0].x+w[0].x-w[1].x,w[0].y+w[0].y-w[1].y,w[0].z+w[0].z-w[1].z),f=n,this.__doubleToTwoFloats(_,o,l),h[f]=o.x,h[f+1]=o.y,h[f+2]=o.z,h[f+3]=o.x,h[f+4]=o.y,h[f+5]=o.z,h[f+6]=o.x,h[f+7]=o.y,h[f+8]=o.z,h[f+9]=o.x,h[f+10]=o.y,h[f+11]=o.z,c[f]=l.x,c[f+1]=l.y,c[f+2]=l.z,c[f+3]=l.x,c[f+4]=l.y,c[f+5]=l.z,c[f+6]=l.x,c[f+7]=l.y,c[f+8]=l.z,c[f+9]=l.x,c[f+10]=l.y,c[f+11]=l.z),!s&&this._renderNode.ellipsoid){var g=this._renderNode.ellipsoid.cartesianToLonLat(e);d[i][t]=g,u[i][t]=g.forwardMercator();var v=this._extent;v.southWest.set(180,90),v.northEast.set(-180,-90);for(let S=0;S<d.length;S++){var p=d[S];for(let P=0;P<p.length;P++){var y=p[P].lon,b=p[P].lat;y>v.northEast.lon&&(v.northEast.lon=y),b>v.northEast.lat&&(v.northEast.lat=b),y<v.southWest.lon&&(v.southWest.lon=y),b<v.southWest.lat&&(v.southWest.lat=b)}}}if(f=n+12*t+12,this.__doubleToTwoFloats(e,o,l),h[f]=o.x,h[f+1]=o.y,h[f+2]=o.z,h[f+3]=o.x,h[f+4]=o.y,h[f+5]=o.z,h[f+6]=o.x,h[f+7]=o.y,h[f+8]=o.z,h[f+9]=o.x,h[f+10]=o.y,h[f+11]=o.z,c[f]=l.x,c[f+1]=l.y,c[f+2]=l.z,c[f+3]=l.x,c[f+4]=l.y,c[f+5]=l.z,c[f+6]=l.x,c[f+7]=l.y,c[f+8]=l.z,c[f+9]=l.x,c[f+10]=l.y,c[f+11]=l.z,t===w.length-1||t===w.length-2){var C;if(L)C=w[0];else{var T=w.length-1;C=new m(w[T].x+w[T].x-w[T-1].x,w[T].y+w[T].y-w[T-1].y,w[T].z+w[T].z-w[T-1].z)}f=n+12*w.length+12,this.__doubleToTwoFloats(C,o,l),h[f]=o.x,h[f+1]=o.y,h[f+2]=o.z,h[f+3]=o.x,h[f+4]=o.y,h[f+5]=o.z,h[f+6]=o.x,h[f+7]=o.y,h[f+8]=o.z,h[f+9]=o.x,h[f+10]=o.y,h[f+11]=o.z,c[f]=l.x,c[f+1]=l.y,c[f+2]=l.z,c[f+3]=l.x,c[f+4]=l.y,c[f+5]=l.z,c[f+6]=l.x,c[f+7]=l.y,c[f+8]=l.z,c[f+9]=l.x,c[f+10]=l.y,c[f+11]=l.z}this._changedBuffers[0]=!0}else{let w=this._path3v[i];w[t].x=e.x,w[t].y=e.y,w[t].z=e.z}}_resizePathLengths(e=0){this._pathLengths[0]=0;for(let t=e+1,i=this._path3v.length;t<=i;t++)this._pathLengths[t]=this._pathLengths[t-1]+this._path3v[t-1].length}removeSegment(e){this._path3v.splice(e,1),this.setPath3v([].concat(this._path3v))}removePoint(e,t=0){this._path3v[t].splice(e,1),this._path3v[t].length===0&&this._path3v.splice(t,1),this.setPath3v([].concat(this._path3v))}insertPoint3v(e,t=0,i,s=0){let n=[].concat(this._path3v),o=n[s];if(o){let l=[].concat(this._pathColors);if(o.splice(t,0,e),i){let h=l[s];h||(h=new Array(o.length)),h.splice(t,0,i)}this.setPath3v(n,l)}else this.addPoint3v(e,s)}appendPoint3v(e,t,i){this._path3v.length!==0&&this._renderNode?(this._verticesHigh=He(this._verticesHigh),this._verticesLow=He(this._verticesLow),this._colors=He(this._colors),this._orders=He(this._orders),this._indexes=He(this._indexes),this.__appendPoint3v(this._path3v,e,this._pathColors,t||this._defaultColor,this._closedLine,this._verticesHigh,this._verticesLow,this._colors,this._orders,this._indexes,i?null:this._renderNode.ellipsoid,this._pathLonLat,this._pathLonLatMerc,this._extent),this._pathLengths[this._path3v.length]+=1,this._changedBuffers[0]=!0,this._changedBuffers[2]=!0,this._changedBuffers[1]=!0):(this._pathColors.push([t||this._defaultColor]),this.addPoint3v(e))}addPoint3v(e,t=0){t>=this._path3v.length&&this._path3v.push([]),this._path3v[t].push(e),this.setPath3v([].concat(this._path3v))}addPointLonLat(e,t=0){t>=this._pathLonLat.length&&this._pathLonLat.push([]),this._pathLonLat[t].push(e),this.setPathLonLat([].concat(this._pathLonLat))}clear(){this._clearData()}setPointColor(e,t=0,i=0){if(this._renderNode&&t<this._path3v[i].length){let s=this._pathColors[i];if(!s){if(!(this._path3v[i]&&t<this._path3v[i].length))return;this._pathColors[i]=new Array(this._path3v[i].length)}s[t]?(s[t][0]=e[0],s[t][1]=e[1],s[t][2]=e[2],s[t][3]=e[3]||1):s[t]=[e[0],e[1],e[2],e[3]||1];let n=this._colors,o=16*t+16*this._pathLengths[i]+32*i;n[o]=n[o+4]=n[o+8]=n[o+12]=e[0],n[o+1]=n[o+5]=n[o+9]=n[o+13]=e[1],n[o+2]=n[o+6]=n[o+10]=n[o+14]=e[2],n[o+3]=n[o+7]=n[o+11]=n[o+15]=e[3]||1,this._changedBuffers[2]=!0}else this._pathColors[i][t]=e}setOpacity(e){this._opacity=e}getOpacity(){return this._opacity}setAltitude(e){this.altitude=e}setThickness(e){this.thickness=e}getThickness(){return this.thickness}setVisibility(e){this.visibility=e}getVisibility(){return this.visibility}setRenderNode(e){e&&(this._renderNode=e,this._pathLonLat.length?this._createDataLonLat([].concat(this._pathLonLat)):this._createData3v([].concat(this._path3v)),this._refresh(),e.renderer&&e.renderer.isInitialized()&&this._update())}_clearData(){this._verticesHigh=null,this._verticesLow=null,this._orders=null,this._indexes=null,this._colors=null,this._texCoordArr=null,this._verticesHigh=[],this._verticesLow=[],this._orders=[],this._indexes=[],this._colors=[],this._texCoordArr=[],this._path3v.length=0,this._pathLonLat.length=0,this._pathLonLatMerc.length=0,this._path3v=[],this._pathLonLat=[],this._pathLonLatMerc=[]}_createData3v(e){this._clearData(),this.__appendLineData3v(e,this._pathColors,this._defaultColor,this._closedLine,this._verticesHigh,this._verticesLow,this._orders,this._indexes,this._renderNode.ellipsoid,this._pathLonLat,this._path3v,this._pathLonLatMerc,this._extent,this._colors),this._resizePathLengths(0)}_createDataLonLat(e){this._clearData(),this.__appendLineDataLonLat(e,this._pathColors,this._defaultColor,this._closedLine,this._verticesHigh,this._verticesLow,this._orders,this._indexes,this._texCoordArr,this._renderNode.ellipsoid,this._path3v,this._pathLonLat,this._pathLonLatMerc,this._extent,this._colors),this._resizePathLengths(0)}remove(){this._entity=null,this._pathColors.length=0,this._pathColors=[],this._verticesHigh=null,this._verticesLow=null,this._orders=null,this._indexes=null,this._colors=null,this._texCoordArr=null,this._verticesHigh=[],this._verticesLow=[],this._orders=[],this._indexes=[],this._colors=[],this._texCoordArr=[],this._deleteBuffers(),this._handler&&this._handler.remove(this)}setPickingColor3v(e){this._pickingColor[0]=e.x/255,this._pickingColor[1]=e.y/255,this._pickingColor[2]=e.z/255}getExtent(){return this._extent.clone()}getPath3v(){return this._path3v}getPathLonLat(){return this._pathLonLat}getPathColors(){return this._pathColors}setPathColors(e){e&&(this._colors=[],this._pathColors=[].concat(e),m0.setPathColors(this._pathLonLat,e,this._defaultColor,this._colors),this._changedBuffers[2]=!0)}setColorHTML(e){this._defaultColor=me(e);let t=le(e),i=this._pathColors;for(let n=0,o=i.length;n<o;n++){let l=i[n];for(let h=0,c=l.length;h<c;h++)l[h][0]=t.x,l[h][1]=t.y,l[h][2]=t.z,l[h][3]=t.w}let s=this._colors;for(let n=0,o=s.length;n<o;n+=4)s[n]=t.x,s[n+1]=t.y,s[n+2]=t.z,s[n+3]=t.w;this._changedBuffers[2]=!0}setPathLonLatFast(e,t){this.setPathLonLat(e,t,!0)}setPath3vFast(e,t){this.setPath3v(e,t,!0)}setPathLonLat(e,t,i=!1){t&&(this._pathColors=[].concat(t)),this._renderNode&&this._renderNode.ellipsoid?i?(this._setEqualPathLonLat(e),this._changedBuffers[0]=!0,this._changedBuffers[2]=!0):(this._createDataLonLat(e),this._changedBuffers[0]=!0,this._changedBuffers[1]=!0,this._changedBuffers[2]=!0):this._pathLonLat=[].concat(e)}getSize(e=0){return this._path3v[e].length}setPath3v(e,t,i=!1){t&&(this._pathColors=[].concat(t)),this._renderNode?i?(this._setEqualPath3v(e),this._changedBuffers[0]=!0,this._changedBuffers[2]=!0):(this._createData3v(e),this._changedBuffers[0]=!0,this._changedBuffers[1]=!0,this._changedBuffers[2]=!0):this._path3v=[].concat(e)}draw(){if(this.visibility&&this._path3v.length){this._update();let e=this._renderNode.renderer,t=e.handler.programs.polyline_screen,i=t._program,s=e.handler.gl,n=i.attributes,o=i.uniforms,l=this._handler._entityCollection;t.activate(),s.disable(s.CULL_FACE),s.uniform1f(o.depthOffset,l.polygonOffsetUnits),s.uniformMatrix4fv(o.proj,!1,e.activeCamera.getProjectionMatrix()),s.uniformMatrix4fv(o.view,!1,e.activeCamera.getViewMatrix()),s.uniform3fv(o.rtcEyePositionHigh,this._handler._rtcEyePositionHigh),s.uniform3fv(o.rtcEyePositionLow,this._handler._rtcEyePositionLow),s.uniform4fv(o.visibleSphere,this._visibleSphere),s.uniform2fv(o.viewport,[e.handler.canvas.width,e.handler.canvas.height]),s.uniform1f(o.thickness,.5*this.thickness),s.uniform1f(o.opacity,this._opacity*l._fadingOpacity),s.uniform1f(o.texOffset,this._texOffset),s.uniform1f(o.strokeSize,this._strokeSize),s.bindBuffer(s.ARRAY_BUFFER,this._colorsBuffer),s.vertexAttribPointer(n.color,this._colorsBuffer.itemSize,s.FLOAT,!1,0,0),s.bindBuffer(s.ARRAY_BUFFER,this._texCoordBuffer),s.vertexAttribPointer(n.texCoord,this._texCoordBuffer.itemSize,s.FLOAT,!1,0,0);let h=this._verticesHighBuffer;s.bindBuffer(s.ARRAY_BUFFER,h),s.vertexAttribPointer(n.prevHigh,h.itemSize,s.FLOAT,!1,12,0),s.vertexAttribPointer(n.currentHigh,h.itemSize,s.FLOAT,!1,12,48),s.vertexAttribPointer(n.nextHigh,h.itemSize,s.FLOAT,!1,12,96),h=this._verticesLowBuffer,s.bindBuffer(s.ARRAY_BUFFER,h),s.vertexAttribPointer(n.prevLow,h.itemSize,s.FLOAT,!1,12,0),s.vertexAttribPointer(n.currentLow,h.itemSize,s.FLOAT,!1,12,48),s.vertexAttribPointer(n.nextLow,h.itemSize,s.FLOAT,!1,12,96),s.bindBuffer(s.ARRAY_BUFFER,this._ordersBuffer),s.vertexAttribPointer(n.order,this._ordersBuffer.itemSize,s.FLOAT,!1,4,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this._indexesBuffer),s.drawElements(s.TRIANGLE_STRIP,this._indexesBuffer.numItems,s.UNSIGNED_INT,0),s.enable(s.CULL_FACE)}}drawPicking(){if(this.visibility&&this._path3v.length){let e=this._renderNode.renderer,t=e.handler.programs.polyline_picking,i=t._program,s=e.handler.gl,n=i.attributes,o=i.uniforms,l=this._handler._entityCollection;t.activate(),s.disable(s.CULL_FACE),s.uniform1f(o.depthOffset,l.polygonOffsetUnits),s.uniformMatrix4fv(o.proj,!1,e.activeCamera.getProjectionMatrix()),s.uniformMatrix4fv(o.view,!1,e.activeCamera.getViewMatrix()),s.uniform4fv(o.color,[this._pickingColor[0],this._pickingColor[1],this._pickingColor[2],1]),s.uniform3fv(o.rtcEyePositionHigh,this._handler._rtcEyePositionHigh),s.uniform3fv(o.rtcEyePositionLow,this._handler._rtcEyePositionLow),s.uniform4fv(o.visibleSphere,this._visibleSphere),s.uniform2fv(o.viewport,[e.handler.canvas.width,e.handler.canvas.height]),s.uniform1f(o.thickness,.5*this.thickness*l.pickingScale[0]);let h=this._verticesHighBuffer;s.bindBuffer(s.ARRAY_BUFFER,h),s.vertexAttribPointer(n.prevHigh,h.itemSize,s.FLOAT,!1,12,0),s.vertexAttribPointer(n.currentHigh,h.itemSize,s.FLOAT,!1,12,48),s.vertexAttribPointer(n.nextHigh,h.itemSize,s.FLOAT,!1,12,96),h=this._verticesLowBuffer,s.bindBuffer(s.ARRAY_BUFFER,h),s.vertexAttribPointer(n.prevLow,h.itemSize,s.FLOAT,!1,12,0),s.vertexAttribPointer(n.currentLow,h.itemSize,s.FLOAT,!1,12,48),s.vertexAttribPointer(n.nextLow,h.itemSize,s.FLOAT,!1,12,96),s.bindBuffer(s.ARRAY_BUFFER,this._ordersBuffer),s.vertexAttribPointer(n.order,this._ordersBuffer.itemSize,s.FLOAT,!1,4,0),s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,this._indexesBuffer),s.drawElements(s.TRIANGLE_STRIP,this._indexesBuffer.numItems,s.UNSIGNED_INT,0),s.enable(s.CULL_FACE)}}_refresh(){let e=this._changedBuffers.length;for(;e--;)this._changedBuffers[e]=!0}_update(){if(this._renderNode){let e=this._changedBuffers.length;for(;e--;)this._changedBuffers[e]&&(this._buffersUpdateCallbacks[e].call(this),this._changedBuffers[e]=!1)}}_deleteBuffers(){if(this._renderNode){let e=this._renderNode.renderer.handler.gl;e.deleteBuffer(this._verticesHighBuffer),e.deleteBuffer(this._verticesLowBuffer),e.deleteBuffer(this._ordersBuffer),e.deleteBuffer(this._indexesBuffer),e.deleteBuffer(this._colorsBuffer),e.deleteBuffer(this._texCoordBuffer),this._verticesHighBuffer=null,this._verticesLowBuffer=null,this._ordersBuffer=null,this._indexesBuffer=null,this._colorsBuffer=null,this._texCoordBuffer=null}}_createVerticesBuffer(){let e=this._renderNode.renderer.handler,t=this._verticesHigh.length/3;this._verticesHighBuffer&&this._verticesHighBuffer.numItems===t||(e.gl.deleteBuffer(this._verticesHighBuffer),e.gl.deleteBuffer(this._verticesLowBuffer),this._verticesHighBuffer=e.createStreamArrayBuffer(3,t),this._verticesLowBuffer=e.createStreamArrayBuffer(3,t)),this._verticesHigh=it(this._verticesHigh),this._verticesLow=it(this._verticesLow),e.setStreamArrayBuffer(this._verticesHighBuffer,this._verticesHigh),e.setStreamArrayBuffer(this._verticesLowBuffer,this._verticesLow)}_createIndexBuffer(){let e=this._renderNode.renderer.handler;e.gl.deleteBuffer(this._ordersBuffer),e.gl.deleteBuffer(this._indexesBuffer),this._orders=it(this._orders),this._ordersBuffer=e.createArrayBuffer(this._orders,1,this._orders.length/2),this._indexes=it(this._indexes,Uint32Array),this._indexesBuffer=e.createElementArrayBuffer(this._indexes,1,this._indexes.length)}_createColorsBuffer(){let e=this._renderNode.renderer.handler;e.gl.deleteBuffer(this._colorsBuffer),this._colors=it(this._colors),this._colorsBuffer=e.createArrayBuffer(this._colors,4,this._colors.length/4)}_createTexCoordBuffer(){let e=this._renderNode.renderer.handler;e.gl.deleteBuffer(this._texCoordBuffer),this._texCoordArr=it(this._texCoordArr),this._texCoordBuffer=e.createArrayBuffer(this._texCoordArr,4,this._texCoordArr.length/4)}setVisibleSphere(e,t){this._handler&&(this._visibleSphere[0]=e.x-this._handler._relativeCenter.x,this._visibleSphere[1]=e.y-this._handler._relativeCenter.y,this._visibleSphere[2]=e.z-this._handler._relativeCenter.z),this._visibleSphere[3]=t}updateRTCPosition(){this._handler&&this._renderNode&&(this._visibleSphere[0]=this._visibleSphere[0]-this._handler._relativeCenter.x,this._visibleSphere[1]=this._visibleSphere[1]-this._handler._relativeCenter.y,this._visibleSphere[2]=this._visibleSphere[2]-this._handler._relativeCenter.z,this._setEqualPath3v(this._path3v)),this._changedBuffers[0]=!0}};je.__counter__=0;let yr=je;const ps=class D0{constructor(e={}){this.__id=D0.__counter__++,this._thickness=e.thickness||2,this._startPosition=qt(e.startPosition),this._startPositionHigh=new m,this._startPositionLow=new m,m.doubleToTwoFloats(this._startPosition,this._startPositionHigh,this._startPositionLow),this._endPosition=qt(e.endPosition),this._endPositionHigh=new m,this._endPositionLow=new m,m.doubleToTwoFloats(this._endPosition,this._endPositionHigh,this._endPositionLow),this._startColor=ae(e.startColor),this._endColor=ae(e.endColor),this._visibility=e.visibility==null||e.visibility,this._entity=null,this._handler=null,this._handlerIndex=-1,this._image=e.image||null,this._src=e.src||null,this._texOffset=e.texOffset||0,this._strokeSize=e.strokeSize!=null?e.strokeSize:32}setStartPosition(e,t,i){this._startPosition.x=e,this._startPosition.y=t,this._startPosition.z=i,m.doubleToTwoFloats(this._startPosition,this._startPositionHigh,this._startPositionLow),this._handler&&this._handler.setStartPositionArr(this._handlerIndex,this._startPositionHigh,this._startPositionLow)}getLength(){return this._startPosition.distance(this._endPosition)}setSrc(e){this._src=e;let t=this._handler;if(t){let i=t._entityCollection.renderNode;if(i&&i.renderer){let s=i.renderer.strokeTextureAtlas;e&&e.length?s.loadImage(e,n=>{if(n.__nodeIndex!=null&&s.get(n.__nodeIndex)){this._image=n;let o=s.get(n.__nodeIndex);t.setTexCoordArr(this._handlerIndex,o.texCoords)}else s.addImage(n),s.createTexture(),this._image=n,i.updateStrokeTexCoords()}):(t.setTextureDisabled(this._handlerIndex),i.updateStrokeTexCoords())}}}getSrc(){return this._src}setImage(e){this.setSrc(e.src)}getImage(){return this._image}setStartPosition3v(e){this._startPosition.x=e.x,this._startPosition.y=e.y,this._startPosition.z=e.z,m.doubleToTwoFloats(this._startPosition,this._startPositionHigh,this._startPositionLow),this._handler&&this._handler.setStartPositionArr(this._handlerIndex,this._startPositionHigh,this._startPositionLow)}setEndPosition(e,t,i){this._endPosition.x=e,this._endPosition.y=t,this._endPosition.z=i,m.doubleToTwoFloats(this._endPosition,this._endPositionHigh,this._endPositionLow),this._handler&&this._handler.setEndPositionArr(this._handlerIndex,this._endPositionHigh,this._endPositionLow)}setEndPosition3v(e){this._endPosition.x=e.x,this._endPosition.y=e.y,this._endPosition.z=e.z,m.doubleToTwoFloats(this._endPosition,this._endPositionHigh,this._endPositionLow),this._handler&&this._handler.setEndPositionArr(this._handlerIndex,this._endPositionHigh,this._endPositionLow)}setThickness(e){this._thickness=e,this._handler&&this._handler.setThicknessArr(this._handlerIndex,e)}setColors4v(e,t){e&&(this._startColor.x=e.x,this._startColor.y=e.y,this._startColor.z=e.z,this._startColor.w=e.w),t&&(this._endColor.x=t.x,this._endColor.y=t.y,this._endColor.z=t.z,this._endColor.w=t.w),this._handler&&this._handler.setRgbaArr(this._handlerIndex,this._startColor,this._endColor)}setColorsHTML(e,t){e&&(this._startColor=le(e)),t&&(this._endColor=le(t)),this._handler&&this._handler.setRgbaArr(this._handlerIndex,this._startColor,this._endColor)}get texOffset(){return this._texOffset}set texOffset(e){this._texOffset=e,this._handler&&this._handler.setTexOffsetArr(this._handlerIndex,e)}get strokeSize(){return this._strokeSize}set strokeSize(e){this._strokeSize=e,this._handler&&this._handler.setStrokeSizeArr(this._handlerIndex,e)}getStartPosition(){return this._startPosition}getEndPosition(){return this._endPosition}setVisibility(e){this._visibility=e,this._handler&&this._handler.setVisibility(this._handlerIndex,e)}getVisibility(){return this._visibility}remove(){this._entity=null,this._handler&&this._handler.remove(this)}setPickingColor3v(e){this._handler&&this._handler.setPickingColorArr(this._handlerIndex,e)}};ps.__counter__=0;let xr=ps,_t=new m,ft=new m;const ms=class O0{constructor(e={}){if(this.__id=O0.__counter__++,this.visibility=e.visibility==null||e.visibility,this.color=new Float32Array([1,1,1,.5]),e.color){let t=ae(e.color);this.setColor(t.x,t.y,t.z,t.w)}e.opacity&&this.setOpacity(e.opacity),this._renderNode=null,this._entity=null,this._verticesHighBuffer=null,this._verticesLowBuffer=null,this._indexBuffer=null,this._verticesHigh=[],this._verticesLow=[],this._indexes=[],this._path=[],this._pickingColor=new Float32Array(4),this._gridSize=1,this._handler=null,this._handlerIndex=-1,e.path&&this.setPath(e.path)}setPickingColor3v(e){this._pickingColor[0]=e.x/255,this._pickingColor[1]=e.y/255,this._pickingColor[2]=e.z/255,this._pickingColor[3]=1}clear(){this._path.length=0,this._path=[],this._verticesHigh.length=0,this._verticesHigh=[],this._verticesLow.length=0,this._verticesLow=[],this._indexes.length=0,this._indexes=[],this._deleteBuffers()}setColor4v(e){this.setColor(e.x,e.y,e.z,e.w)}setColorHTML(e){this.setColor4v(le(e))}setColor(e,t,i,s){s=s||this.color[3],this.color[0]=e,this.color[1]=t,this.color[2]=i,this.color[3]=s}setOpacity(e){this.color[3]=e||0}setVisibility(e){this.visibility=e}getVisibility(){return this.visibility}setRenderNode(e){this._renderNode=e,this._createBuffers()}remove(){this._entity=null,this._handler&&this._handler.remove(this)}draw(){if(this.visibility&&this._verticesHigh.length){let e=this._renderNode.renderer,t=e.handler.gl,i=e.handler.programs.strip,s=i._program,n=s.attributes,o=s.uniforms;i.activate(),t.disable(t.CULL_FACE),t.uniformMatrix4fv(o.viewMatrix,!1,e.activeCamera.getViewMatrix()),t.uniformMatrix4fv(o.projectionMatrix,!1,e.activeCamera.getProjectionMatrix()),t.uniform3fv(o.eyePositionHigh,e.activeCamera.eyeHigh),t.uniform3fv(o.eyePositionLow,e.activeCamera.eyeLow),t.uniform4fv(o.uColor,this.color),t.uniform1f(o.uOpacity,this._entity._entityCollection._fadingOpacity),t.bindBuffer(t.ARRAY_BUFFER,this._verticesHighBuffer),t.vertexAttribPointer(n.aVertexPositionHigh,this._verticesHighBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._verticesLowBuffer),t.vertexAttribPointer(n.aVertexPositionLow,this._verticesLowBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.drawElements(e.handler.gl.TRIANGLE_STRIP,this._indexBuffer.numItems,t.UNSIGNED_INT,0),t.enable(t.CULL_FACE)}}drawPicking(){if(this.visibility&&this._verticesHigh.length){let e=this._renderNode.renderer,t=e.handler.gl,i=e.handler.programs.strip,s=i._program,n=s.attributes,o=s.uniforms;i.activate(),t.disable(t.CULL_FACE),t.uniformMatrix4fv(o.viewMatrix,!1,e.activeCamera.getViewMatrix()),t.uniformMatrix4fv(o.projectionMatrix,!1,e.activeCamera.getProjectionMatrix()),t.uniform3fv(o.eyePositionHigh,e.activeCamera.eyeHigh),t.uniform3fv(o.eyePositionLow,e.activeCamera.eyeLow),t.uniform1f(o.uOpacity,this._entity._entityCollection._fadingOpacity!=0?1:0),t.uniform4fv(o.uColor,this._pickingColor),t.bindBuffer(t.ARRAY_BUFFER,this._verticesHighBuffer),t.vertexAttribPointer(n.aVertexPositionHigh,this._verticesHighBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._verticesLowBuffer),t.vertexAttribPointer(n.aVertexPositionLow,this._verticesLowBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indexBuffer),t.drawElements(e.handler.gl.TRIANGLE_STRIP,this._indexBuffer.numItems,t.UNSIGNED_INT,0),t.enable(t.CULL_FACE)}}_deleteBuffers(){if(this._renderNode&&this._renderNode.renderer){let e=this._renderNode.renderer.handler.gl;e.deleteBuffer(this._indexBuffer),e.deleteBuffer(this._verticesHighBuffer),e.deleteBuffer(this._verticesLowBuffer)}this._verticesHighBuffer=null,this._verticesLowBuffer=null,this._indexBuffer=null}_createBuffers(){if(this._renderNode&&this._renderNode.renderer&&this._renderNode.renderer.isInitialized()){let e=this._renderNode.renderer.handler.gl;e.deleteBuffer(this._indexBuffer),e.deleteBuffer(this._verticesHighBuffer),e.deleteBuffer(this._verticesLowBuffer),this._verticesHighBuffer=this._renderNode.renderer.handler.createArrayBuffer(new Float32Array(this._verticesHigh),3,this._verticesHigh.length/3),this._verticesLowBuffer=this._renderNode.renderer.handler.createArrayBuffer(new Float32Array(this._verticesLow),3,this._verticesLow.length/3),this._indexBuffer=this._renderNode.renderer.handler.createElementArrayBuffer(new Uint32Array(this._indexes),1,this._indexes.length)}}addEdge3v(e,t){let i=this._path.length;if(i===0)this._path.push([e.clone(),t.clone()]);else{let s=this._path[i-1][0],n=this._path[i-1][1];this._path.push([e.clone(),t.clone()]);let o=this._verticesHigh,l=this._verticesLow,h=this._gridSize,c=h+1,d=new m,u=this._verticesHigh.length/3,f=u,_=Math.abs(s.sub(n).normal().dot(e.sub(s).normal()));for(let g=0;g<c;g++){let v=g/h,p=s.lerp(e,v),y=n.lerp(t,v);for(let b=0;b<c;b++){let C=b/h,T=s.lerp(n,C),w=e.lerp(t,C);_!==1?new Qt(p,y).intersects(new Qt(T,w),d):d=w,f=u+g*c+b,m.doubleToTwoFloats(d,_t,ft);let L=3*f;o[L]=_t.x,o[L+1]=_t.y,o[L+2]=_t.z,l[L]=ft.x,l[L+1]=ft.y,l[L+2]=ft.z,g<h&&this._indexes.push(f,f+c)}g<h&&this._indexes.push(f+c,f+1)}this._createBuffers()}}setEdge3v(e,t,i){if(i!==this._path.length)if(this._path[i]){if(this._path[i][0]=e,this._path[i][1]=t,this._path.length>1){let s=this._gridSize,n=s+1,o=n*n,l=new m,h=this._verticesHigh,c=this._verticesLow;if(i===this._path.length-1){let d=this._path[i-1][0],u=this._path[i-1][1],f=this._verticesHigh.length/3-o,_=f,g=Math.abs(d.sub(u).normal().dot(e.sub(d).normal()));for(let v=0;v<n;v++){let p=v/s,y=d.lerp(e,p),b=u.lerp(t,p);for(let C=0;C<n;C++){let T=C/s,w=d.lerp(u,T),L=e.lerp(t,T);g!==1?new Qt(y,b).intersects(new Qt(w,L),l):l=L,_=f+v*n+C,m.doubleToTwoFloats(l,_t,ft);let S=3*_;h[S]=_t.x,h[S+1]=_t.y,h[S+2]=_t.z,c[S]=ft.x,c[S+1]=ft.y,c[S+2]=ft.z}}}else if(i===0){let d=0,u=e,f=t;e=this._path[1][0],t=this._path[1][1];for(let _=0;_<n;_++){let g=_/s,v=u.lerp(e,g),p=f.lerp(t,g);for(let y=0;y<n;y++){let b=y/s,C=u.lerp(f,b),T=e.lerp(t,b);new Qt(v,p).intersects(new Qt(C,T),l),d=_*n+y,m.doubleToTwoFloats(l,_t,ft);let w=3*d;h[w]=_t.x,h[w+1]=_t.y,h[w+2]=_t.z,c[w]=ft.x,c[w+1]=ft.y,c[w+2]=ft.z}}}else if(i>0&&i<this._path.length){let d=this._path[i-1][0],u=this._path[i-1][1],f=this._path[i+1][0],_=this._path[i+1][1],g=i*o,v=(i-1)*o,p=v;for(let y=0;y<n;y++){let b=y/s,C=d.lerp(e,b),T=t.lerp(_,b),w=e.lerp(f,b),L=u.lerp(t,b);for(let S=0;S<n;S++){let P=S/s,B=d.lerp(u,P),k=e.lerp(t,P);new Qt(C,L).intersects(new Qt(B,k),l);let I=y*n+S;p=v+I,m.doubleToTwoFloats(l,_t,ft);let z=3*p;h[z]=_t.x,h[z+1]=_t.y,h[z+2]=_t.z,c[z]=ft.x,c[z+1]=ft.y,c[z+2]=ft.z;let Ce=f.lerp(_,P);k=e.lerp(t,P),new Qt(w,T).intersects(new Qt(k,Ce),l),p=g+I,m.doubleToTwoFloats(l,_t,ft),z=3*p,h[z]=_t.x,h[z+1]=_t.y,h[z+2]=_t.z,c[z]=ft.x,c[z+1]=ft.y,c[z+2]=ft.z}}}this._createBuffers()}}else console.warn(`strip index ${i} is out of range`);else this.addEdge3v(e,t)}removeEdge(e){this._path.splice(e,1),this.setPath([].concat(this._path))}setGridSize(e){this._gridSize=e,this.setPath([].concat(this._path))}getPath(){return this._path}setPath(e){this._verticesHigh=[],this._verticesLow=[],this._indexes=[],this._path=[];for(let t=0;t<e.length;t++){let i=e[t][0],s=e[t][1];i instanceof Array&&(i=new m(i[0],i[1],i[2])),s instanceof Array&&(s=new m(s[0],s[1],s[2])),this.addEdge3v(i,s)}}insertEdge3v(e,t,i){if(i<this._path.length){let s=[].concat(this._path);s.splice(i,0,[e,t]),this.setPath(s)}else i===this._path.length&&this.addEdge3v(e,t)}};ms.__counter__=0;let br=ms;const vs=class N0{constructor(e={}){e.properties=e.properties||{},this.__id=N0.__counter__++,this._name=e.name||`entity:${this.__id}`,this.properties=e.properties||{},this.childEntities=[],this.parent=null,this.forceGlobalPosition=e.forceGlobalPosition||!1,this.forceGlobalRotation=e.forceGlobalRotation||!1,this.forceGlobalScale=e.forceGlobalScale||!1,this._cartesian=qt(e.cartesian),this._rootCartesian=new m,this._localPosition=qt(e.localPosition),this._absoluteLocalPosition=new m,this._lonLat=mi(e.lonlat),this._lonLatMerc=new A,this._altitude=e.altitude||0,this._visibility=e.visibility==null||e.visibility,this._entityCollection=null,this._entityCollectionIndex=-1,this._layer=null,this._layerIndex=-1,this._pickingColor=new m(0,0,0),this._independentPicking=e.independentPicking||!1,this._relativePosition=e.relativePosition||!1,this._pitchRad=e.pitch||0,this._yawRad=e.yaw||0,this._rollRad=e.roll||0,this._scale=qt(e.scale,new m(1,1,1)),this._absoluteScale=new m,this._qFrame=D.IDENTITY,this._qRot=D.IDENTITY,this._absoluteQRot=D.IDENTITY,this._useDirectQuaternion=!1,this._featureConstructorArray={billboard:[Za,this.setBillboard],label:[Ja,this.setLabel],polyline:[yr,this.setPolyline],pointCloud:[vr,this.setPointCloud],geometry:[pr,this.setGeometry],geoObject:[mr,this.setGeoObject],strip:[br,this.setStrip],ray:[xr,this.setRay]},this.billboard=this._createOptionFeature("billboard",e.billboard),this.label=this._createOptionFeature("label",e.label),this.polyline=this._createOptionFeature("polyline",e.polyline),this.ray=this._createOptionFeature("ray",e.ray),this.pointCloud=this._createOptionFeature("pointCloud",e.pointCloud),this.geometry=this._createOptionFeature("geometry",e.geometry),this.geoObject=this._createOptionFeature("geoObject",e.geoObject),this.strip=this._createOptionFeature("strip",e.strip)}get name(){return this._name}set name(e){e!==this._name&&(this._name=e)}get isEmpty(){return!(this.strip||this.polyline||this.ray||this.geoObject||this.geometry||this.billboard||this.label||this.pointCloud)}get rootEntity(){let e=this;for(;e;){if(!e.parent)return e;e=e.parent}return this}set relativePosition(e){if(e!==this._relativePosition){let t=this.getAbsoluteCartesian(),i=this.getAbsolutePitch(),s=this.getAbsoluteYaw(),n=this.getAbsoluteRoll();this._relativePosition=e,this.parent&&this._rootCartesian.copy(this.parent._rootCartesian),e?this.parent&&(this.setAbsoluteCartesian3v(t),this.setAbsolutePitch(i),this.setAbsoluteYaw(s),this.setAbsoluteRoll(n)):(this.setCartesian3v(t),this.setPitch(i),this.setYaw(s),this.setRoll(n))}}get relativePosition(){return this._relativePosition}get entityCollection(){return this._entityCollection}get id(){return this.__id}isEqual(e){return this.__id===e.__id}get layerIndex(){return this._layerIndex}get instanceName(){return"Entity"}_createOptionFeature(e,t){if(t){let i=this._featureConstructorArray[e];return i[1].call(this,new i[0](t))}return null}getCollectionIndex(){return this._entityCollectionIndex}addTo(e){return e.add(this),this}remove(){return this._layer&&this._layer.removeEntity(this),this._entityCollection&&this._entityCollection.removeEntity(this),this}setVisibility(e){this._visibility=e,this.billboard&&this.billboard.setVisibility(e),this.geoObject&&this.geoObject.setVisibility(e),this.label&&this.label.setVisibility(e),this.polyline&&this.polyline.setVisibility(e),this.ray&&this.ray.setVisibility(e),this.geometry&&this.geometry.setVisibility(e);for(let t=0;t<this.childEntities.length;t++)this.childEntities[t].setVisibility(e)}getVisibility(){return this._visibility}setCartesian3v(e){this.setCartesian(e.x,e.y,e.z)}getScale(){return this._scale}setScale3v(e){this._scale.copy(e),this._updateAbsolutePosition();for(let t=0;t<this.childEntities.length;t++){let i=this.childEntities[t];i.forceGlobalScale?i.setScale3v(this._scale):i.setScale3v(this.childEntities[t].getScale())}}setScale(e){this.setScale3v(new m(e,e,e))}getAbsoluteRotation(){return this._absoluteQRot.clone()}getRotation(){return this._qRot}setLook3v(e){let t,i=new D,s=this.getAbsoluteCartesian();if(this._entityCollection){let n=this._entityCollection.renderNode.ellipsoid.getSurfaceNormal3v(s);t=i.setLookRotation(e.sub(s),n).conjugate()}else t=i.setLookRotation(e.sub(s),m.UP).conjugate();this.setAbsoluteRotation(t)}setLookLonLat(e){if(this._entityCollection){let t=this._entityCollection.renderNode.ellipsoid.lonLatToCartesian(e);this.setLook3v(t)}}setAbsoluteRotation(e){this._absoluteQRot.copy(e),this._updatePitchYawRoll()}setRotation(e){this._useDirectQuaternion=!1,this._pitchRad=e.getPitch(),this._yawRad=e.getYaw(),this._rollRad=e.getRoll(),this._updateAbsolutePosition()}setDirectQuaternionRotation(e){this._qRot.copy(e),this._useDirectQuaternion=!0,this._pitchRad=this._qRot.getPitch(),this._yawRad=this._qRot.getYaw(),this._rollRad=this._qRot.getRoll(),this._updateAbsolutePosition()}setPitch(e){this._useDirectQuaternion=!1,this._pitchRad=e,this._updateAbsolutePosition()}setYaw(e){this._useDirectQuaternion=!1,this._yawRad=e,this._updateAbsolutePosition()}setRoll(e){this._useDirectQuaternion=!1,this._rollRad=e,this._updateAbsolutePosition()}getPitch(){return this._pitchRad}getYaw(){return this._yawRad}getRoll(){return this._rollRad}setAbsolutePitch(e){this._relativePosition?(this._absoluteQRot.setPitchYawRoll(e,this.getAbsoluteYaw(),this.getAbsoluteRoll(),this._qFrame),this._updatePitchYawRoll()):this.setPitch(e)}setAbsoluteYaw(e){this._relativePosition?(this._absoluteQRot.setPitchYawRoll(this.getAbsolutePitch(),e,this.getAbsoluteRoll(),this._qFrame),this._updatePitchYawRoll()):this.setYaw(e)}setAbsoluteRoll(e){this._relativePosition?(this._absoluteQRot.setPitchYawRoll(this.getAbsolutePitch(),this.getAbsoluteYaw(),e,this._qFrame),this._updatePitchYawRoll()):this.setRoll(e)}getAbsolutePitch(){return this.parent&&this._relativePosition?this._qFrame.conjugate().inverse().mul(this._absoluteQRot).getPitch():this._pitchRad}getAbsoluteYaw(){return this.parent&&this._relativePosition?this._qFrame.conjugate().inverse().mul(this._absoluteQRot).getYaw():this._yawRad}getAbsoluteRoll(){return this.parent&&this._relativePosition?this._qFrame.conjugate().inverse().mul(this._absoluteQRot).getRoll():this._rollRad}_getScaleByDistance(){let e=1;if(this._entityCollection){let t=this._entityCollection.scaleByDistance,i=1;this._entityCollection.renderNode&&this._entityCollection.renderNode.renderer&&(i=this._entityCollection.renderNode.renderer.activeCamera.eye.distance(this._rootCartesian)),e=t[2]*Xi(i,t[0],t[1])/t[0]}return e}setAbsoluteCartesian(e,t,i){this.setAbsoluteCartesian3v(new m(e,t,i))}setAbsoluteCartesian3v(e){let t=e;if(this.parent&&this._relativePosition){let i=this._getScaleByDistance();t=e.sub(this.parent.getAbsoluteCartesian()).scale(1/i).divA(this.parent._absoluteScale),t=this.parent._absoluteQRot.conjugate().mulVec3(t)}this.setCartesian3v(t)}getAbsoluteCartesian(){if(this.parent&&this._relativePosition){let e=this._getScaleByDistance();return this._rootCartesian.add(this._absoluteLocalPosition.scaleTo(e))}return this._cartesian.clone()}setCartesian(e,t,i){this._cartesian.set(e,t,i),this._updateAbsolutePosition();for(let s=0;s<this.childEntities.length;s++){let n=this.childEntities[s];n._relativePosition?n.setCartesian3v(n.getCartesian()):n.forceGlobalPosition&&n.setCartesian(e,t,i)}this._updateLonLat()}_updatePitchYawRoll(){if(this.parent){this._qRot=this.parent._absoluteQRot.conjugate().mul(this._absoluteQRot),this._pitchRad=this._qRot.getPitch(),this._yawRad=this._qRot.getYaw(),this._rollRad=this._qRot.getRoll(),this.geoObject&&this.geoObject.setRotation(this._absoluteQRot);for(let e=0;e<this.childEntities.length;e++)this.childEntities[e]._updateAbsolutePosition()}}_updateAbsolutePosition(){let e=this.parent;if(e&&this._relativePosition){this._scale.mulRes(e._absoluteScale,this._absoluteScale),this._qFrame.copy(e._qFrame),this._rootCartesian.copy(e._rootCartesian),this._useDirectQuaternion||(e&&this.forceGlobalRotation?this._qRot.setPitchYawRoll(e._pitchRad,e._yawRad,e._rollRad):this._qRot.setPitchYawRoll(this._pitchRad,this._yawRad,this._rollRad)),e._absoluteQRot.mulRes(this._qRot,this._absoluteQRot);let t=e._absoluteQRot.mulVec3(this._cartesian.add(this._localPosition)).mulA(e._absoluteScale);e._absoluteLocalPosition.addRes(t,this._absoluteLocalPosition)}else this._qFrame=D.IDENTITY,this._entityCollection&&this._entityCollection.renderNode&&(this._qFrame=this._entityCollection.renderNode.getFrameRotation(this._cartesian)),this._useDirectQuaternion?this._qFrame.isEqual(D.IDENTITY)||(this._qRot=this._qRot.mul(this._qFrame)):e&&this.forceGlobalRotation?this._qRot.setPitchYawRoll(e._pitchRad,e._yawRad,e._rollRad,this._qFrame):this._qRot.setPitchYawRoll(this._pitchRad,this._yawRad,this._rollRad,this._qFrame),this._absoluteScale.copy(this._scale),this._absoluteQRot.copy(this._qRot),this._rootCartesian.copy(this._cartesian),this._absoluteLocalPosition.copy(this._localPosition);this.geoObject&&(this.geoObject.setScale3v(this._absoluteScale),this.geoObject.setRotation(this._absoluteQRot),this.geoObject.setPosition3v(this._rootCartesian),this.geoObject.setLocalPosition3v(this._absoluteLocalPosition)),this.billboard&&this.billboard.setPosition3v(this._rootCartesian),this.label&&this.label.setPosition3v(this._rootCartesian);for(let t=0,i=this.childEntities.length;t<i;t++)this.childEntities[t]._updateAbsolutePosition();this._updateLonLat()}_setCartesian3vSilent(e,t=!1){this._cartesian.copy(e),this._updateAbsolutePosition();for(let i=0;i<this.childEntities.length;i++)this.childEntities[i].setCartesian(this._cartesian.x,this._cartesian.y,this._cartesian.z);t||this._updateLonLat()}_updateLonLat(){let e=this._entityCollection;e&&e.renderNode&&e.renderNode.ellipsoid&&(this._lonLat=e.renderNode.ellipsoid.cartesianToLonLat(this.getAbsoluteCartesian()),Math.abs(this._lonLat.lat)<ht?this._lonLatMerc=this._lonLat.forwardMercator():this._lonLatMerc.lon=this._lonLatMerc.lat=0)}getLonLat(){return this._lonLat.clone()}setLonLat(e){let t=this._lonLat;t.lon=e.lon,t.lat=e.lat,t.height=e.height;let i=this._entityCollection;if(i&&i.renderNode&&i.renderNode.ellipsoid){Math.abs(t.lat)<ht&&(this._lonLatMerc=t.forwardMercator());let s=new m;i.renderNode.ellipsoid.lonLatToCartesianRes(t,s),this.setAbsoluteCartesian3v(s)}}setLonLat2(e,t,i){let s=this._lonLat;s.lon=e,s.lat=t,s.height=i??s.height;let n=this._entityCollection;if(n&&n.renderNode&&n.renderNode.ellipsoid){Math.abs(s.lat)<ht?this._lonLatMerc=s.forwardMercator():this._lonLatMerc.lon=this._lonLatMerc.lat=this._lonLatMerc.height=0;let o=new m;n.renderNode.ellipsoid.lonLatToCartesianRes(s,o),this.setAbsoluteCartesian3v(o)}}setAltitude(e){this._altitude=e}getAltitude(){return this._altitude}getCartesian(){return this._cartesian.clone()}setBillboard(e){return this.billboard&&this.billboard.remove(),this.billboard=e,this.billboard._entity=this,this.billboard.setPosition3v(this._cartesian),this.billboard.setVisibility(this._visibility),this._entityCollection&&this._entityCollection.billboardHandler.add(e),e}setLabel(e){return this.label&&this.label.remove(),this.label=e,this.label._entity=this,this.label.setPosition3v(this._cartesian),this.label.setVisibility(this._visibility),this._entityCollection&&this._entityCollection.labelHandler.add(e),e}setRay(e){return this.ray&&this.ray.remove(),this.ray=e,this.ray._entity=this,this.ray.setVisibility(this._visibility),this._entityCollection&&this._entityCollection.rayHandler.add(e),e}setPolyline(e){return this.polyline&&this.polyline.remove(),this.polyline=e,this.polyline._entity=this,this.polyline.setVisibility(this._visibility),this._entityCollection&&this._entityCollection.polylineHandler.add(e),e}setPointCloud(e){return this.pointCloud&&this.pointCloud.remove(),this.pointCloud=e,this.pointCloud._entity=this,this.pointCloud.setVisibility(this._visibility),this._entityCollection&&this._entityCollection.pointCloudHandler.add(e),e}setGeometry(e){this.geometry&&this.geometry.remove(),this.geometry=e,this.geometry._entity=this,this.geometry.setVisibility(this._visibility);let t=this._layer;return this._layer&&this._layer.removeEntity(this),t&&t.add(this),e}setGeoObject(e){return this.geoObject&&this.geoObject.remove(),this.geoObject=e,this.geoObject._entity=this,this.geoObject.setPosition3v(this._cartesian),this.geoObject.setVisibility(this._visibility),this._entityCollection&&this._entityCollection.geoObjectHandler.add(e),e}setStrip(e){return this.strip&&this.strip.remove(),this.strip=e,this.strip._entity=this,this.strip.setVisibility(this._visibility),this._entityCollection&&this._entityCollection.stripHandler.add(e),e}get layer(){return this._layer}get rendererEvents(){return this._layer?this._layer.events:this._entityCollection?this._entityCollection.events:null}appendChildren(e,t){for(let i=0;i<e.length;i++)t!==void 0&&(e[i].relativePosition=t),this.appendChild(e[i])}appendChild(e){e._entityCollection=this._entityCollection,e._independentPicking||(e._pickingColor=this._pickingColor),e.parent=this,this.childEntities.push(e),this._entityCollection&&this._entityCollection.appendChildEntity(e)}setPickingColor(){let e=this._pickingColor;this.billboard&&this.billboard.setPickingColor3v(e),this.label&&this.label.setPickingColor3v(e),this.polyline&&this.polyline.setPickingColor3v(e),this.ray&&this.ray.setPickingColor3v(e),this.strip&&this.strip.setPickingColor3v(e),this.geoObject&&this.geoObject.setPickingColor3v(e);for(let t=0;t<this.childEntities.length;t++)this.childEntities[t].setPickingColor()}getExtent(){let e,t=this._lonLat;e=this.billboard||this.label?new V(new A(t.lon,t.lat),new A(t.lon,t.lat)):new V(new A(180,90),new A(-180,-90));let i=e.southWest,s=e.northEast;if(this.polyline){let n=this.polyline.getExtent();n.southWest.lon<i.lon&&(i.lon=n.southWest.lon),n.southWest.lat<i.lat&&(i.lat=n.southWest.lat),n.northEast.lon>s.lon&&(s.lon=n.northEast.lon),n.northEast.lat>s.lat&&(s.lat=n.northEast.lat)}if(this.geometry){let n=this.geometry.getExtent();n.southWest.lon<i.lon&&(i.lon=n.southWest.lon),n.southWest.lat<i.lat&&(i.lat=n.southWest.lat),n.northEast.lon>s.lon&&(s.lon=n.northEast.lon),n.northEast.lat>s.lat&&(s.lat=n.northEast.lat)}for(let n=0;n<this.childEntities.length;n++){let o=this.childEntities[n].getExtent();o.southWest.lon<i.lon&&(i.lon=o.southWest.lon),o.southWest.lat<i.lat&&(i.lat=o.southWest.lat),o.northEast.lon>s.lon&&(s.lon=o.northEast.lon),o.northEast.lat>s.lat&&(s.lat=o.northEast.lat)}return e}};vs.__counter__=0;let U=vs;const ys=class H0{constructor(e){this.__id=H0.__counter__++,this._name=e||`nonameNode:${this.__id}`,this.topNode=this,this._dictionary={},this._dictionary[this._name]=this,this.childNodes=[],this.parentNode=null}get name(){return this._name}addNode(e){this.parentNode==null?e.topNode=this:e.topNode=this.topNode,e.parentNode=this,e._dictionary=this.topNode._dictionary,this.childNodes.push(e),this.topNode._dictionary[e.name]=e}destroy(){for(let e=0;e<this.childNodes.length;e++)this.childNodes[e].destroy();this._clear()}getNodeByName(e){return this._dictionary[e]}_clear(){this.parentNode=null,this.topNode=this,this.childNodes.length=0}isEqual(e){return e.__id===this.__id}};ys.__counter__=0;let wr=ys;class ce extends wr{constructor(e){super(e),this.childNodes=[],this.renderer=null,this.drawMode=0,this.show=!0,this._isActive=!0,this.lightEnabled=!1,this._lightPosition=new Float32Array([100,100,100]),this._lightParams=new Float32Array(9),this._lightShininess=100,this.entityCollections=[],this._entityCollectionsByDepthOrder=[],this._pickingId=-1}getFrameRotation(e){return D.IDENTITY}addNode(e){super.addNode(e),this.renderer&&e.assign(this.renderer)}assign(e){this.renderer=e,this._pickingId=e.addPickingCallback(this,this._entityCollectionPickingCallback),this.initialize()}initialize(){if(this.renderer&&this.renderer.isInitialized()){for(let e=0;e<this.entityCollections.length;e++)this.entityCollections[e].bindRenderNode(this);this.init()}}init(){}onremove(){}remove(){let e=this.renderer,t=this.name;if(e){e.renderNodes[t]&&e.renderNodes[t].isEqual(this)&&(e.renderNodes[t]=null,delete e.renderNodes[t]);for(let i=0;i<e._renderNodesArr.length;i++)if(e._renderNodesArr[i].isEqual(this)){e._renderNodesArr.splice(i,1);break}e.removePickingCallback(this._pickingId),this._pickingId=-1,this.onremove&&this.onremove()}}addEntityCollection(e,t){e.renderNode||(e.renderNode=this,t||(this.entityCollections.push(e),this.updateEntityCollectionsDepthOrder()),this.ellipsoid&&e._updateGeodeticCoordinates(this.ellipsoid),e.bindRenderNode(this),e.events.dispatch(e.events.add,this))}removeEntityCollection(e){for(let t=0;t<this.entityCollections.length;t++)if(this.entityCollections[t].isEqual(e))return this.entityCollections.splice(t,1),void this.updateEntityCollectionsDepthOrder()}updateEntityCollectionsDepthOrder(){let e={0:[]};for(const t of this.entityCollections)t.getVisibility()&&(e[t.depthOrder]||(e[t.depthOrder]=[]),e[t.depthOrder].push(t));this._entityCollectionsByDepthOrder.length=0,this._entityCollectionsByDepthOrder=[],this._entityCollectionsByDepthOrder=Object.keys(e).sort((t,i)=>Number(t)-Number(i)).map(t=>e[Number(t)])}addLight(e){return e.addTo(this),this}preDrawNode(){this._isActive&&this._preDrawNodes()}drawNode(){this._isActive&&this._drawNodes()}isActive(){return this._isActive}setActive(e){this._isActive=e,this.renderer&&(this._isActive&&this._pickingId===-1?this._pickingId=this.renderer.addPickingCallback(this,this._entityCollectionPickingCallback):this._isActive||this._pickingId===-1||(this.renderer.removePickingCallback(this._pickingId),this._pickingId=-1));for(let t=0;t<this.childNodes.length;t++)this.childNodes[t].setActive(e)}setDrawMode(e){this.drawMode=e;for(let t=0;t<this.childNodes.length;t++)this.childNodes[t].setDrawMode(e)}updateBillboardsTexCoords(){for(let e=0;e<this.entityCollections.length;e++)this.entityCollections[e].billboardHandler.refreshTexCoordsArr()}updateStrokeTexCoords(){for(let e=0;e<this.entityCollections.length;e++){let t=this.entityCollections[e];t.rayHandler.refreshTexCoordsArr(),t.polylineHandler.refreshTexCoordsArr()}}frame(){}preFrame(){}_preDrawNodes(){for(let e=0;e<this.childNodes.length;e++)this.childNodes[e]._isActive&&this.childNodes[e]._preDrawNodes();if(this.show){this.preFrame();for(let e=0;e<this._entityCollectionsByDepthOrder.length;e++)this.drawEntityCollections(this._entityCollectionsByDepthOrder[e],e)}}_drawNodes(){for(let e=0;e<this.childNodes.length;e++)this.childNodes[e]._isActive&&this.childNodes[e]._drawNodes();this.show&&this.frame()}drawEntityCollections(e,t=0){this.renderer.enqueueEntityCollectionsToDraw(e,t)}drawPickingEntityCollections(e){if(e.length){let t=e.length;for(;t--;)e[t]._fadingOpacity&&e[t].billboardHandler.drawPicking();for(t=e.length;t--;)e[t]._fadingOpacity&&e[t].geoObjectHandler.drawPicking();for(t=e.length;t--;)e[t]._fadingOpacity&&e[t].labelHandler.drawPicking();for(t=e.length;t--;)e[t]._fadingOpacity&&e[t].rayHandler.drawPicking();for(t=e.length;t--;)e[t]._visibility&&e[t].polylineHandler.drawPicking();for(t=e.length;t--;)e[t]._visibility&&e[t].stripHandler.drawPicking()}}_entityCollectionPickingCallback(){}}const ee=new class{constructor(){this._container=document.createElement("div"),this._container.classList.add("ogConsole"),this._container.style.display="none",document.body&&document.body.appendChild(this._container),this._visibility=!1}getVisibility(){return this._visibility}setVisibility(a){this._visibility!=a&&(this._visibility=a,this._visibility?this.show():this.hide())}show(){this._container.parentNode||document.body&&document.body.appendChild(this._container),this._container.style.display="block",this._visibility=!0}hide(){this._container.style.display="none",this._visibility=!1}logErr(a){let e=document.createElement("div");e.classList.add("ogConsole-text"),e.classList.add("ogConsole-error"),e.innerHTML="error: "+a,console.trace(e.innerHTML),this._container.appendChild(e),this.show()}logWrn(a){let e=document.createElement("div");e.classList.add("ogConsole-text"),e.classList.add("ogConsole-warning"),e.innerHTML="warning: "+a,console.trace(e.innerHTML),this._container.appendChild(e),this.show()}log(a){let e=document.createElement("div");e.classList.add("ogConsole-text"),e.innerHTML=a,console.trace(a),this._container.appendChild(e),this.show()}};let _i=["FLOAT","DOUBLE","BOOL","INT","UINT","VEC2","VEC3","VEC4","DVEC2","DVEC3","DVEC4","BVEC2","BVEC3","BVEC4","IVEC2","IVEC3","IVEC4","UVEC2","UVEC3","UVEC4","MAT2","DMAT2","MAT3","DMAT3","MAT4","DMAT4","MAT2X3","MAT2X4","MAT3X2","MAT3X4","MAT4X2","MAT4X3","DMAT2X3","DMAT2X4","DMAT3X2","DMAT3X4","DMAT4X2","DMAT4X3","SAMPLER1D","SAMPLER2D","SAMPLER3D","SAMPLERCUBE","SAMPLER2DSHADOW","SAMPLER2DARRAY","INTXX","FLOATXX"];const lt={};for(let a=0;a<_i.length;a++)lt[_i[a]]=a;const Tr={};for(let a=0;a<_i.length;a++)Tr[_i[a].toLowerCase()]=lt[_i[a]];const Lt={u:[],a:[]};Lt.u[lt.MAT4]=function(a,e){a.gl.uniformMatrix4fv(e._pName,!1,e.value)},Lt.u[lt.MAT3]=function(a,e){a.gl.uniformMatrix3fv(e._pName,!1,e.value)},Lt.u[lt.FLOAT]=function(a,e){a.gl.uniform1f(e._pName,e.value)},Lt.u[lt.INT]=function(a,e){a.gl.uniform1i(e._pName,e.value)},Lt.u[lt.VEC2]=function(a,e){a.gl.uniform2fv(e._pName,e.value)},Lt.u[lt.VEC3]=function(a,e){a.gl.uniform3fv(e._pName,e.value)},Lt.u[lt.VEC4]=function(a,e){a.gl.uniform4fv(e._pName,e.value)},Lt.u[lt.SAMPLER2D]=function(a,e){let t=a.gl;t.activeTexture(t.TEXTURE0+a._textureID),t.bindTexture(t.TEXTURE_2D,e.value),t.uniform1i(e._pName,a._textureID),a._textureID++},Lt.u[lt.SAMPLERCUBE]=function(a,e){let t=a.gl;t.activeTexture(t.TEXTURE0+a._textureID),t.bindTexture(t.TEXTURE_CUBE_MAP,e.value),t.uniform1i(e._pName,a._textureID),a._textureID++},Lt.u[lt.SAMPLER2DARRAY]=function(a,e){let t=e.value,i=a.gl,s=t.length,n=new Int32Array(s);for(let o=0;o<s;o++)i.activeTexture(i.TEXTURE0+a._textureID+o),i.bindTexture(i.TEXTURE_2D,t[o]),n[o]=o;i.uniform1iv(e._pName,n)},Lt.u[lt.INTXX]=function(a,e){a.gl.uniform1iv(e._pName,e.value)},Lt.u[lt.FLOATXX]=function(a,e){a.gl.uniform1fv(e._pName,e.value)},Lt.a[lt.FLOAT]=function(a,e){a.gl.vertexAttrib1f(e._pName,e.value)},Lt.a[lt.VEC2]=function(a,e){a.gl.vertexAttrib2fv(e._pName,e.value)},Lt.a[lt.VEC3]=function(a,e){a.gl.vertexAttrib3fv(e._pName,e.value)};const tl=["BYTE","SHORT","UNSIGNED_BYTE","UNSIGNED_SHORT","FLOAT","HALF_FLOAT"];class ${constructor(e,t){this.name=e,this._programController=null,this._attributes={};for(let i in t.attributes)typeof t.attributes[i]=="string"||typeof t.attributes[i]=="number"?this._attributes[i]={type:t.attributes[i]}:this._attributes[i]=t.attributes[i];this._uniforms={};for(let i in t.uniforms)typeof t.uniforms[i]=="string"||typeof t.uniforms[i]=="number"?this._uniforms[i]={type:t.uniforms[i]}:this._uniforms[i]=t.uniforms[i];this.vertexShader=t.vertexShader,this.fragmentShader=t.fragmentShader,this.gl=null,this._variables={},this._p=null,this._textureID=0,this._attribArrays=[],this._attribDivisor=[],this.attributes={},this.uniforms={},this.vertexAttribDivisor=null,this.drawElementsInstanced=null}static bindBuffer(e,t){let i=e.gl;i&&(i.bindBuffer(i.ARRAY_BUFFER,t.value),i.vertexAttribPointer(t._pName,t.value.itemSize,t.itemType,t.normalized,0,0))}use(){this.gl&&this.gl.useProgram(this._p)}set(e){this._textureID=0;for(let t in e)this._variables[t].value=e[t],this._variables[t].func(this,this._variables[t])}apply(){this._textureID=0;let e=this._variables;for(let t in e)e[t].func(this,e[t])}drawIndexBuffer(e,t){let i=this.gl;i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,t),i.drawElements(e,t.numItems,i.UNSIGNED_SHORT,0)}drawArrays(e,t){this.gl.drawArrays(e,0,t)}_getShaderCompileStatus(e,t){if(!this.gl)return!1;const i=this.gl instanceof WebGL2RenderingContext;return this.gl.shaderSource(e,function(s,n){if(!n)return s;const o=s.split(`
`),l=o.findIndex(h=>h.startsWith("#version"));return l!==-1?(o.splice(l+1,0,"#define WEBGL2"),o.join(`
`)):s}(t,i)),this.gl.compileShader(e),!!this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS)||(ee.logErr(`Shader program "${this.name}":${this.gl.getShaderInfoLog(e)}.`),!1)}_createVertexShader(e){if(!this.gl)return;let t=this.gl.createShader(this.gl.VERTEX_SHADER);return t&&this._getShaderCompileStatus(t,e)?t:void 0}_createFragmentShader(e){if(!this.gl)return;let t=this.gl.createShader(this.gl.FRAGMENT_SHADER);return t&&this._getShaderCompileStatus(t,e)?t:void 0}disableAttribArrays(){let e=this.gl,t=this._attribArrays;for(let i=0,s=t.length;i<s;i++)e.disableVertexAttribArray(t[i]),this.vertexAttribDivisor(t[i],0)}enableAttribArrays(){let e=this.gl,t=this._attribArrays,i=this._attribDivisor;for(let s=0,n=t.length;s<n;s++)e.enableVertexAttribArray(t[s]),this.vertexAttribDivisor(t[s],i[s])}delete(){this.gl&&this.gl.deleteProgram(this._p)}createProgram(e){if(this.gl=e,this._p=this.gl.createProgram(),!this._p)return;let t=this._createFragmentShader(this.fragmentShader),i=this._createVertexShader(this.vertexShader);if(t&&i){if(e.attachShader(this._p,t),e.attachShader(this._p,i),e.linkProgram(this._p),!this.drawElementsInstanced)if(e.drawElementsInstanced)this.drawElementsInstanced=e.drawElementsInstanced.bind(e);else{let s=e.getExtension("ANGLE_instanced_arrays");s&&(this.drawElementsInstanced=s.drawElementsInstancedANGLE.bind(s))}if(!this.vertexAttribDivisor)if(e.vertexAttribDivisor)this.vertexAttribDivisor=e.vertexAttribDivisor.bind(e);else{let s=e.getExtension("ANGLE_instanced_arrays");s&&(this.vertexAttribDivisor=s.vertexAttribDivisorANGLE.bind(s))}if(!e.getProgramParameter(this._p,e.LINK_STATUS))return ee.logErr(`Shader program "${this.name}": initialization failed. ${e.getProgramInfoLog(this._p)}.`),void e.deleteProgram(this._p);this.use();for(let s in this._attributes){this._variables[s]=this._attributes[s],this._attributes[s].func=$.bindBuffer;let n=this._attributes[s].itemType,o=n?n.trim().toUpperCase():"FLOAT";if(tl.indexOf(o)==-1?(ee.logErr(`Shader program "${this.name}": attribute '${s}', item type '${this._attributes[s].itemType}' not exists.`),this._attributes[s].itemType=e.FLOAT):this._attributes[s].itemType=e[o],this._attributes[s].normalized=this._attributes[s].normalized||!1,this._attributes[s].divisor=this._attributes[s].divisor||0,this._p[s]=e.getAttribLocation(this._p,s),this._p[s]==null)return ee.logErr(`Shader program "${this.name}":  attribute '${s}' not exists.`),void e.deleteProgram(this._p);let l=this._attributes[s].type;typeof l=="string"&&(l=Tr[l.trim().toLowerCase()]);let h=this._attributes[s].divisor;if(l===lt.MAT4){let c=this._p[s];this._attribArrays.push(c,c+1,c+2,c+3),this._attribDivisor.push(h,h,h,h)}else this._attribArrays.push(this._p[s]),this._attribDivisor.push(h);e.enableVertexAttribArray(this._p[s]),this._attributes[s]._pName=this._p[s],this.attributes[s]=this._p[s]}for(let s in this._uniforms){if(typeof this._uniforms[s].type=="string"){let n=this._uniforms[s].type;this._uniforms[s].func=Lt.u[Tr[n.trim().toLowerCase()]]}else this._uniforms[s].func=Lt.u[this._uniforms[s].type];if(this._variables[s]=this._uniforms[s],this._p[s]=e.getUniformLocation(this._p,s),this._p[s]==null)return ee.logErr(`Shader program "${this.name}": uniform '${s}' not exists.`),void e.deleteProgram(this._p);this._uniforms[s]._pName=this._p[s],this.uniforms[s]=this._p[s]}e.detachShader(this._p,t),e.detachShader(this._p,i),e.deleteShader(t),e.deleteShader(i)}}}const xs=class V0{constructor(e){this.__id=V0.__counter__++,this.pickingEnabled=!0,this._entityCollection=e,this._renderer=null,this._billboards=[],this._positionHighBuffer=null,this._positionLowBuffer=null,this._sizeBuffer=null,this._offsetBuffer=null,this._rgbaBuffer=null,this._rotationBuffer=null,this._texCoordBuffer=null,this._vertexBuffer=null,this._pickingColorBuffer=null,this._texCoordArr=new Float32Array([]),this._vertexArr=new Float32Array([]),this._positionHighArr=new Float32Array([]),this._positionLowArr=new Float32Array([]),this._sizeArr=new Float32Array([]),this._offsetArr=new Float32Array([]),this._rgbaArr=new Float32Array([]),this._rotationArr=new Float32Array([]),this._pickingColorArr=new Float32Array([]),this._buffersUpdateCallbacks=[],this._buffersUpdateCallbacks[0]=this.createPickingColorBuffer,this._buffersUpdateCallbacks[1]=this.createPositionBuffer,this._buffersUpdateCallbacks[2]=this.createSizeBuffer,this._buffersUpdateCallbacks[3]=this.createOffsetBuffer,this._buffersUpdateCallbacks[4]=this.createRgbaBuffer,this._buffersUpdateCallbacks[5]=this.createRotationBuffer,this._buffersUpdateCallbacks[6]=this.createTexCoordBuffer,this._buffersUpdateCallbacks[7]=this.createVertexBuffer,this._changedBuffers=new Array(this._buffersUpdateCallbacks.length)}isEqual(e){return e&&e.__id===this.__id}static concArr(e,t){for(let i=0;i<t.length;i++)e.push(t[i])}initProgram(){this._renderer&&this._renderer.handler&&(this._renderer.handler.programs.billboard||this._renderer.handler.addProgram(new $("billboard",{uniforms:{viewport:"vec2",u_texture:"sampler2d",projectionMatrix:"mat4",viewMatrix:"mat4",eyePositionHigh:"vec3",eyePositionLow:"vec3",planetRadius:"float",uScaleByDistance:"vec3",opacity:"float",depthOffset:"float"},attributes:{a_vertices:"vec2",a_texCoord:"vec2",a_positionsHigh:"vec3",a_positionsLow:"vec3",a_offset:"vec3",a_size:"vec2",a_rotation:"float",a_rgba:"vec4"},vertexShader:`precision highp float;
#define EMPTY - 1.0
#define RTL 1.0
vec2 project(vec4 p,vec2 viewport){return(0.5*p.xyz/p.w+0.5).xy*viewport;}mat2 rotate2d(float angle){return mat2(cos(angle),-sin(angle),sin(angle),cos(angle));}attribute vec2 a_vertices;attribute vec2 a_texCoord;attribute vec3 a_positionsHigh;attribute vec3 a_positionsLow;attribute vec3 a_offset;attribute vec2 a_size;attribute float a_rotation;attribute vec4 a_rgba;varying vec2 v_texCoords;varying vec4 v_rgba;uniform mat4 viewMatrix;uniform mat4 projectionMatrix;uniform vec3 eyePositionHigh;uniform vec3 eyePositionLow;uniform vec3 uScaleByDistance;uniform float opacity;uniform float planetRadius;uniform vec2 viewport;uniform float depthOffset;const vec3 ZERO3=vec3(0.0);void main(){vec3 a_positions=a_positionsHigh+a_positionsLow;vec3 cameraPos=eyePositionHigh+eyePositionLow;v_texCoords=a_texCoord;vec3 look=a_positions-cameraPos;float lookDist=length(look);v_rgba=a_rgba;if(opacity*step(lookDist,sqrt(dot(cameraPos,cameraPos)-planetRadius)+sqrt(dot(a_positions,a_positions)-planetRadius))==0.0){return;}float scd=(1.0-smoothstep(uScaleByDistance[0],uScaleByDistance[1],lookDist))*(1.0-step(uScaleByDistance[2],lookDist));mat4 viewMatrixRTE=viewMatrix;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);vec3 highDiff=a_positionsHigh-eyePositionHigh;vec3 lowDiff=a_positionsLow-eyePositionLow;vec4 posRTE=viewMatrixRTE*vec4(highDiff+lowDiff,1.0);vec4 projPos=projectionMatrix*posRTE;float camSlope=dot(vec3(viewMatrix[0][2],viewMatrix[1][2],viewMatrix[2][2]),normalize(cameraPos));if(camSlope>0.5){float dist=dot(look,normalize(cameraPos));projPos.z+=dist*0.02;}else{projPos.z+=-(abs(projPos.z))*0.002;}projPos.z+=depthOffset+a_offset.z;vec2 screenPos=project(projPos,viewport);vec2 v=screenPos+rotate2d(a_rotation)*(a_vertices*a_size*scd+a_offset.xy);gl_Position=vec4((2.0*v/viewport-1.0)*projPos.w,projPos.z,projPos.w);}`,fragmentShader:"precision highp float;uniform sampler2D u_texture;varying vec2 v_texCoords;varying vec4 v_rgba;void main(){vec4 color=texture2D(u_texture,v_texCoords);if(color.a<0.1)discard;gl_FragColor=color*v_rgba;}"})),this._renderer.handler.programs.billboardPicking||this._renderer.handler.addProgram(new $("billboardPicking",{uniforms:{viewport:"vec2",projectionMatrix:"mat4",viewMatrix:"mat4",eyePositionHigh:"vec3",eyePositionLow:"vec3",planetRadius:"float",uScaleByDistance:"vec3",opacity:"float",depthOffset:"float"},attributes:{a_vertices:"vec2",a_positionsHigh:"vec3",a_positionsLow:"vec3",a_offset:"vec3",a_size:"vec2",a_rotation:"float",a_rgba:"vec4"},vertexShader:`precision highp float;
#define EMPTY - 1.0
#define RTL 1.0
vec2 project(vec4 p,vec2 viewport){return(0.5*p.xyz/p.w+0.5).xy*viewport;}mat2 rotate2d(float angle){return mat2(cos(angle),-sin(angle),sin(angle),cos(angle));}attribute vec2 a_vertices;attribute vec3 a_positionsHigh;attribute vec3 a_positionsLow;attribute vec3 a_offset;attribute vec2 a_size;attribute float a_rotation;attribute vec4 a_rgba;varying vec3 v_rgb;uniform mat4 viewMatrix;uniform mat4 projectionMatrix;uniform vec3 eyePositionHigh;uniform vec3 eyePositionLow;uniform vec3 uScaleByDistance;uniform float opacity;uniform float planetRadius;uniform vec2 viewport;uniform float depthOffset;const vec3 ZERO3=vec3(0.0);void main(){vec3 a_positions=a_positionsHigh+a_positionsLow;vec3 cameraPos=eyePositionHigh+eyePositionLow;vec3 look=a_positions-cameraPos;float lookDist=length(look);v_rgb=a_rgba.rgb;if(opacity*step(lookDist,sqrt(dot(cameraPos,cameraPos)-planetRadius)+sqrt(dot(a_positions,a_positions)-planetRadius))==0.0){return;}float scd=(1.0-smoothstep(uScaleByDistance[0],uScaleByDistance[1],lookDist))*(1.0-step(uScaleByDistance[2],lookDist));mat4 viewMatrixRTE=viewMatrix;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);vec3 highDiff=a_positionsHigh-eyePositionHigh;vec3 lowDiff=a_positionsLow-eyePositionLow;vec4 posRTE=viewMatrixRTE*vec4(highDiff+lowDiff,1.0);vec4 projPos=projectionMatrix*posRTE;float camSlope=dot(vec3(viewMatrix[0][2],viewMatrix[1][2],viewMatrix[2][2]),normalize(cameraPos));if(camSlope>0.5){float dist=dot(look,normalize(cameraPos));projPos.z+=dist*0.02;}else{projPos.z+=-(abs(projPos.z))*0.002;}projPos.z+=depthOffset+a_offset.z;vec2 screenPos=project(projPos,viewport);vec2 v=screenPos+rotate2d(a_rotation)*(a_vertices*a_size*scd+a_offset.xy);gl_Position=vec4((2.0*v/viewport-1.0)*projPos.w,projPos.z,projPos.w);}`,fragmentShader:"precision highp float;varying vec3 v_rgb;void main(){gl_FragColor=vec4(v_rgb,1.0);}"})))}setRenderer(e){this._renderer=e,this.initProgram()}refresh(){let e=this._changedBuffers.length;for(;e--;)this._changedBuffers[e]=!0}_removeBillboards(){let e=this._billboards.length;for(;e--;){let t=this._billboards[e];t._handlerIndex=-1,t._handler=null,t._isReady=!1,t._lockId=-1}this._billboards.length=0,this._billboards=[]}clear(){this._texCoordArr=null,this._vertexArr=null,this._positionHighArr=null,this._positionLowArr=null,this._sizeArr=null,this._offsetArr=null,this._rgbaArr=null,this._rotationArr=null,this._pickingColorArr=null,this._texCoordArr=new Float32Array([]),this._vertexArr=new Float32Array([]),this._positionHighArr=new Float32Array([]),this._positionLowArr=new Float32Array([]),this._sizeArr=new Float32Array([]),this._offsetArr=new Float32Array([]),this._rgbaArr=new Float32Array([]),this._rotationArr=new Float32Array([]),this._pickingColorArr=new Float32Array([]),this._removeBillboards(),this._deleteBuffers(),this.refresh()}_deleteBuffers(){if(this._renderer){let e=this._renderer.handler.gl;e.deleteBuffer(this._positionHighBuffer),e.deleteBuffer(this._positionLowBuffer),e.deleteBuffer(this._sizeBuffer),e.deleteBuffer(this._offsetBuffer),e.deleteBuffer(this._rgbaBuffer),e.deleteBuffer(this._rotationBuffer),e.deleteBuffer(this._vertexBuffer),e.deleteBuffer(this._texCoordBuffer),e.deleteBuffer(this._pickingColorBuffer)}this._positionHighBuffer=null,this._positionLowBuffer=null,this._sizeBuffer=null,this._offsetBuffer=null,this._rgbaBuffer=null,this._rotationBuffer=null,this._vertexBuffer=null,this._texCoordBuffer=null,this._pickingColorBuffer=null}update(){if(this._renderer){let e=this._changedBuffers.length;for(;e--;)this._changedBuffers[e]&&(this._buffersUpdateCallbacks[e].call(this),this._changedBuffers[e]=!1)}}add(e){e._handlerIndex==-1&&(e._isReady=!0,e._handler=this,e._handlerIndex=this._billboards.length,this._billboards.push(e))}_displayPASS(){let e=this._renderer,t=e.handler;t.programs.billboard.activate();let i=t.programs.billboard._program,s=i.attributes,n=i.uniforms,o=t.gl,l=this._entityCollection;o.disable(o.CULL_FACE),o.uniform1f(n.depthOffset,l.polygonOffsetUnits),o.uniform1i(n.u_texture,0),o.uniformMatrix4fv(n.viewMatrix,!1,e.activeCamera.getViewMatrix()),o.uniformMatrix4fv(n.projectionMatrix,!1,e.activeCamera.getProjectionMatrix()),o.uniform3fv(n.eyePositionHigh,e.activeCamera.eyeHigh),o.uniform3fv(n.eyePositionLow,e.activeCamera.eyeLow),o.uniform3fv(n.uScaleByDistance,l.scaleByDistance),o.uniform1f(n.opacity,l._fadingOpacity),o.bindBuffer(o.ARRAY_BUFFER,this._texCoordBuffer),o.vertexAttribPointer(s.a_texCoord,this._texCoordBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._vertexBuffer),o.vertexAttribPointer(s.a_vertices,this._vertexBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._positionHighBuffer),o.vertexAttribPointer(s.a_positionsHigh,this._positionHighBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._positionLowBuffer),o.vertexAttribPointer(s.a_positionsLow,this._positionLowBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._rgbaBuffer),o.vertexAttribPointer(s.a_rgba,this._rgbaBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._sizeBuffer),o.vertexAttribPointer(s.a_size,this._sizeBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._offsetBuffer),o.vertexAttribPointer(s.a_offset,this._offsetBuffer.itemSize,o.FLOAT,!1,0,0),o.uniform1f(n.planetRadius,l.renderNode._planetRadius2||0),o.uniform2fv(n.viewport,[t.canvas.clientWidth,t.canvas.clientHeight]),o.bindBuffer(o.ARRAY_BUFFER,this._rotationBuffer),o.vertexAttribPointer(s.a_rotation,this._rotationBuffer.itemSize,o.FLOAT,!1,0,0),o.drawArrays(o.TRIANGLES,0,this._vertexBuffer.numItems),o.enable(o.CULL_FACE)}_pickingPASS(){let e=this._renderer,t=e.handler;t.programs.billboardPicking.activate();let i=t.programs.billboardPicking._program,s=i.attributes,n=i.uniforms,o=t.gl,l=this._entityCollection;o.disable(o.CULL_FACE),o.uniform1f(n.depthOffset,l.polygonOffsetUnits),o.uniformMatrix4fv(n.viewMatrix,!1,e.activeCamera.getViewMatrix()),o.uniformMatrix4fv(n.projectionMatrix,!1,e.activeCamera.getProjectionMatrix()),o.uniform3fv(n.eyePositionHigh,e.activeCamera.eyeHigh),o.uniform3fv(n.eyePositionLow,e.activeCamera.eyeLow),o.uniform3fv(n.uScaleByDistance,l.scaleByDistance),o.uniform1f(n.opacity,l._fadingOpacity),o.bindBuffer(o.ARRAY_BUFFER,this._vertexBuffer),o.vertexAttribPointer(s.a_vertices,this._vertexBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._positionHighBuffer),o.vertexAttribPointer(s.a_positionsHigh,this._positionHighBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._positionLowBuffer),o.vertexAttribPointer(s.a_positionsLow,this._positionLowBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._pickingColorBuffer),o.vertexAttribPointer(s.a_rgba,this._pickingColorBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._sizeBuffer),o.vertexAttribPointer(s.a_size,this._sizeBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._offsetBuffer),o.vertexAttribPointer(s.a_offset,this._offsetBuffer.itemSize,o.FLOAT,!1,0,0),o.uniform1f(n.planetRadius,l.renderNode._planetRadius2||0),o.uniform2fv(n.viewport,[t.canvas.clientWidth,t.canvas.clientHeight]),o.bindBuffer(o.ARRAY_BUFFER,this._rotationBuffer),o.vertexAttribPointer(s.a_rotation,this._rotationBuffer.itemSize,o.FLOAT,!1,0,0),o.drawArrays(o.TRIANGLES,0,this._vertexBuffer.numItems),o.enable(o.CULL_FACE)}draw(){this._billboards.length&&(this.update(),this._displayPASS())}drawPicking(){this._billboards.length&&this.pickingEnabled&&this._pickingPASS()}reindexBillboardsArray(e){let t=this._billboards;for(let i=e;i<t.length;i++)t[i]._handlerIndex=i}_removeBillboard(e){let t=e._handlerIndex;this._billboards.splice(t,1);let i=24*t;this._rgbaArr=nt(this._rgbaArr,i,24),i=18*t,this._positionHighArr=nt(this._positionHighArr,i,18),this._positionLowArr=nt(this._positionLowArr,i,18),this._offsetArr=nt(this._offsetArr,i,18),this._pickingColorArr=nt(this._pickingColorArr,i,18),i=12*t,this._vertexArr=nt(this._vertexArr,i,12),this._sizeArr=nt(this._sizeArr,i,12),this._texCoordArr=nt(this._texCoordArr,i,12),i=6*t,this._rotationArr=nt(this._rotationArr,i,6),this.reindexBillboardsArray(t),this.refresh(),e._handlerIndex=-1,e._handler=null,e._isReady=!1,e._lockId=-1}setAlignedAxisArr(e,t){}remove(e){e._handler&&(e._isReady&&this.__id===e._handler.__id?this._removeBillboard(e):e._handler=null)}setPositionArr(e,t,i){let s=18*e,n=this._positionHighArr,o=t.x,l=t.y,h=t.z;n[s]=o,n[s+1]=l,n[s+2]=h,n[s+3]=o,n[s+4]=l,n[s+5]=h,n[s+6]=o,n[s+7]=l,n[s+8]=h,n[s+9]=o,n[s+10]=l,n[s+11]=h,n[s+12]=o,n[s+13]=l,n[s+14]=h,n[s+15]=o,n[s+16]=l,n[s+17]=h,n=this._positionLowArr,o=i.x,l=i.y,h=i.z,n[s]=o,n[s+1]=l,n[s+2]=h,n[s+3]=o,n[s+4]=l,n[s+5]=h,n[s+6]=o,n[s+7]=l,n[s+8]=h,n[s+9]=o,n[s+10]=l,n[s+11]=h,n[s+12]=o,n[s+13]=l,n[s+14]=h,n[s+15]=o,n[s+16]=l,n[s+17]=h,this._changedBuffers[1]=!0}setPickingColorArr(e,t){let i=18*e,s=this._pickingColorArr,n=t.x/255,o=t.y/255,l=t.z/255;s[i]=n,s[i+1]=o,s[i+2]=l,s[i+3]=n,s[i+4]=o,s[i+5]=l,s[i+6]=n,s[i+7]=o,s[i+8]=l,s[i+9]=n,s[i+10]=o,s[i+11]=l,s[i+12]=n,s[i+13]=o,s[i+14]=l,s[i+15]=n,s[i+16]=o,s[i+17]=l,this._changedBuffers[0]=!0}setSizeArr(e,t,i){let s=12*e,n=this._sizeArr,o=t,l=i;n[s]=o,n[s+1]=l,n[s+2]=o,n[s+3]=l,n[s+4]=o,n[s+5]=l,n[s+6]=o,n[s+7]=l,n[s+8]=o,n[s+9]=l,n[s+10]=o,n[s+11]=l,this._changedBuffers[2]=!0}setOffsetArr(e,t){let i=18*e,s=this._offsetArr,n=t.x,o=t.y,l=t.z;s[i]=n,s[i+1]=o,s[i+2]=l,s[i+3]=n,s[i+4]=o,s[i+5]=l,s[i+6]=n,s[i+7]=o,s[i+8]=l,s[i+9]=n,s[i+10]=o,s[i+11]=l,s[i+12]=n,s[i+13]=o,s[i+14]=l,s[i+15]=n,s[i+16]=o,s[i+17]=l,this._changedBuffers[3]=!0}setRgbaArr(e,t){let i=24*e,s=this._rgbaArr,n=t.x,o=t.y,l=t.z,h=t.w;s[i]=n,s[i+1]=o,s[i+2]=l,s[i+3]=h,s[i+4]=n,s[i+5]=o,s[i+6]=l,s[i+7]=h,s[i+8]=n,s[i+9]=o,s[i+10]=l,s[i+11]=h,s[i+12]=n,s[i+13]=o,s[i+14]=l,s[i+15]=h,s[i+16]=n,s[i+17]=o,s[i+18]=l,s[i+19]=h,s[i+20]=n,s[i+21]=o,s[i+22]=l,s[i+23]=h,this._changedBuffers[4]=!0}setRotationArr(e,t){let i=6*e,s=this._rotationArr;s[i]=t,s[i+1]=t,s[i+2]=t,s[i+3]=t,s[i+4]=t,s[i+5]=t,this._changedBuffers[5]=!0}setTexCoordArr(e,t){let i=12*e,s=this._texCoordArr;s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],s[i+4]=t[4],s[i+5]=t[5],s[i+6]=t[6],s[i+7]=t[7],s[i+8]=t[8],s[i+9]=t[9],s[i+10]=t[10],s[i+11]=t[11],this._changedBuffers[6]=!0}setVisibility(e,t){let i;i=t?[-.5,.5,-.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,.5]:[0,0,0,0,0,0,0,0,0,0,0,0],this.setVertexArr(e,i)}setVertexArr(e,t){let i=12*e,s=this._vertexArr;s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],s[i+4]=t[4],s[i+5]=t[5],s[i+6]=t[6],s[i+7]=t[7],s[i+8]=t[8],s[i+9]=t[9],s[i+10]=t[10],s[i+11]=t[11],this._changedBuffers[7]=!0}createPositionBuffer(){let e=this._renderer.handler,t=this._positionHighArr.length/3;this._positionHighBuffer&&this._positionHighBuffer.numItems===t||(e.gl.deleteBuffer(this._positionHighBuffer),e.gl.deleteBuffer(this._positionLowBuffer),this._positionHighBuffer=e.createStreamArrayBuffer(3,t),this._positionLowBuffer=e.createStreamArrayBuffer(3,t)),e.setStreamArrayBuffer(this._positionHighBuffer,this._positionHighArr),e.setStreamArrayBuffer(this._positionLowBuffer,this._positionLowArr)}createSizeBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._sizeBuffer),this._sizeBuffer=e.createArrayBuffer(this._sizeArr,2,this._sizeArr.length/2)}createOffsetBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._offsetBuffer),this._offsetBuffer=e.createArrayBuffer(this._offsetArr,3,this._offsetArr.length/3)}createRgbaBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._rgbaBuffer),this._rgbaBuffer=e.createArrayBuffer(this._rgbaArr,4,this._rgbaArr.length/4)}createRotationBuffer(){let e=this._renderer.handler;this._rotationBuffer&&this._rotationBuffer.numItems===this._rotationArr.length||(e.gl.deleteBuffer(this._rotationBuffer),this._rotationBuffer=e.createStreamArrayBuffer(1,this._rotationArr.length)),e.setStreamArrayBuffer(this._rotationBuffer,this._rotationArr)}createVertexBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._vertexBuffer),this._vertexBuffer=e.createArrayBuffer(this._vertexArr,2,this._vertexArr.length/2)}createTexCoordBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._texCoordBuffer),this._texCoordBuffer=e.createArrayBuffer(this._texCoordArr,2,this._texCoordArr.length/2)}createPickingColorBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._pickingColorBuffer),this._pickingColorBuffer=e.createArrayBuffer(this._pickingColorArr,3,this._pickingColorArr.length/3)}refreshTexCoordsArr(){}};xs.__counter__=0;let rs=xs;class el extends rs{constructor(e){super(e),this._billboards=[]}add(e){if(e._handlerIndex==-1){super.add(e),this._addBillboardToArrays(e),this.refresh();let t=e.getSrc()||e.getImage()&&e.getImage().src;t&&e.setSrc(t)}}_addBillboardToArrays(e){e.getVisibility()?this._vertexArr=et(this._vertexArr,[-.5,.5,-.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,.5]):this._vertexArr=et(this._vertexArr,[0,0,0,0,0,0,0,0,0,0,0,0]),this._texCoordArr=et(this._texCoordArr,[0,0,0,0,0,0,0,0,0,0,0,0]);let t,i=e._positionHigh.x,s=e._positionHigh.y,n=e._positionHigh.z;this._positionHighArr=et(this._positionHighArr,[i,s,n,i,s,n,i,s,n,i,s,n,i,s,n,i,s,n]),i=e._positionLow.x,s=e._positionLow.y,n=e._positionLow.z,this._positionLowArr=et(this._positionLowArr,[i,s,n,i,s,n,i,s,n,i,s,n,i,s,n,i,s,n]),i=e._width,s=e._height,this._sizeArr=et(this._sizeArr,[i,s,i,s,i,s,i,s,i,s,i,s]),i=e._offset.x,s=e._offset.y,n=e._offset.z,this._offsetArr=et(this._offsetArr,[i,s,n,i,s,n,i,s,n,i,s,n,i,s,n,i,s,n]),i=e._color.x,s=e._color.y,n=e._color.z,t=e._color.w,this._rgbaArr=et(this._rgbaArr,[i,s,n,t,i,s,n,t,i,s,n,t,i,s,n,t,i,s,n,t,i,s,n,t]),i=e._rotation,this._rotationArr=et(this._rotationArr,[i,i,i,i,i,i]),i=e._entity._pickingColor.x/255,s=e._entity._pickingColor.y/255,n=e._entity._pickingColor.z/255,this._pickingColorArr=et(this._pickingColorArr,[i,s,n,i,s,n,i,s,n,i,s,n,i,s,n,i,s,n])}get billboards(){return this._billboards}refreshTexCoordsArr(){if(this._entityCollection&&this._renderer){let e=this._renderer.billboardsTextureAtlas;for(let t=0;t<this._billboards.length;t++){let i=this._billboards[t],s=i.getImage();if(s){let n=e.get(s.__nodeIndex);n&&this.setTexCoordArr(i._handlerIndex,n.texCoords)}}}}}class il{constructor(e){this.isFree=!0,this._geoObjectHandler=e,this.geoObjects=[],this.numInstances=0,this._colorTexture=null,this._colorTextureSrc=null,this._colorTextureImage=null,this._normalTexture=null,this._normalTextureSrc=null,this._normalTextureImage=null,this._metallicRoughnessTexture=null,this._metallicRoughnessTextureSrc=null,this._metallicRoughnessTextureImage=null,this._sizeArr=[],this._translateArr=[],this._vertexArr=[],this._rtcPositionHighArr=[],this._rtcPositionLowArr=[],this._qRotArr=[],this._rgbaArr=[],this._normalsArr=[],this._indicesArr=[],this._pickingColorArr=[],this._visibleArr=[],this._texCoordArr=[],this._localPositionArr=[],this._sizeBuffer=null,this._translateBuffer=null,this._vertexBuffer=null,this._rtcPositionHighBuffer=null,this._rtcPositionLowBuffer=null,this._qRotBuffer=null,this._rgbaBuffer=null,this._normalsBuffer=null,this._indicesBuffer=null,this._pickingColorBuffer=null,this._visibleBuffer=null,this._texCoordBuffer=null,this._localPositionBuffer=null,this._materialParams=new Float32Array(9),this._materialShininess=0,this._buffersUpdateCallbacks=[],this._buffersUpdateCallbacks[Ko]=this.createPickingColorBuffer,this._buffersUpdateCallbacks[Wo]=this.createNormalsBuffer,this._buffersUpdateCallbacks[Yo]=this.createRgbaBuffer,this._buffersUpdateCallbacks[$o]=this.createIndicesBuffer,this._buffersUpdateCallbacks[jo]=this.createVertexBuffer,this._buffersUpdateCallbacks[Zo]=this.createSizeBuffer,this._buffersUpdateCallbacks[Qo]=this.createVisibleBuffer,this._buffersUpdateCallbacks[Jo]=this.createTexCoordBuffer,this._buffersUpdateCallbacks[Xo]=this.createQRotBuffer,this._buffersUpdateCallbacks[ta]=this.createTranslateBuffer,this._buffersUpdateCallbacks[qo]=this.createRTCPositionBuffer,this._buffersUpdateCallbacks[ea]=this.createLocalPositionBuffer,this._changedBuffers=new Array(this._buffersUpdateCallbacks.length)}setMaterialAmbient(e,t,i){this._materialParams[0]=e,this._materialParams[1]=t,this._materialParams[2]=i}setMaterialDiffuse(e,t,i){this._materialParams[3]=e,this._materialParams[4]=t,this._materialParams[5]=i}setMaterialSpecular(e,t,i){this._materialParams[6]=e,this._materialParams[7]=t,this._materialParams[8]=i}setMaterialShininess(e){this._materialShininess=e}setMaterialParams(e,t,i,s){this.setMaterialAmbient(e[0],e[1],e[2]),this.setMaterialDiffuse(t[0],t[1],t[2]),this.setMaterialSpecular(i[0],i[1],i[2]),this.setMaterialShininess(s)}drawOpaque(e){let t=e.gl,i=e.uniforms,s=e.attributes;t.bindBuffer(t.ARRAY_BUFFER,this._qRotBuffer),t.vertexAttribPointer(s.qRot,this._qRotBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._sizeBuffer),t.vertexAttribPointer(s.aScale,this._sizeBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._translateBuffer),t.vertexAttribPointer(s.aTranslate,this._translateBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._localPositionBuffer),t.vertexAttribPointer(s.aLocalPosition,this._localPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._visibleBuffer),t.vertexAttribPointer(s.aDispose,this._visibleBuffer.itemSize,t.FLOAT,!1,0,0),t.uniform1f(i.uUseTexture,this._colorTexture?1:0),t.bindBuffer(t.ARRAY_BUFFER,this._rgbaBuffer),t.vertexAttribPointer(s.aColor,this._rgbaBuffer.itemSize,t.FLOAT,!1,0,0),t.uniform3fv(i.materialParams,this._materialParams),t.uniform1f(i.materialShininess,this._materialShininess),this._drawElementsInstanced(e)}drawTransparent(e){let t=e.gl,i=e.uniforms,s=e.attributes;t.bindBuffer(t.ARRAY_BUFFER,this._qRotBuffer),t.vertexAttribPointer(s.qRot,this._qRotBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._sizeBuffer),t.vertexAttribPointer(s.aScale,this._sizeBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._translateBuffer),t.vertexAttribPointer(s.aTranslate,this._translateBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._localPositionBuffer),t.vertexAttribPointer(s.aLocalPosition,this._localPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._visibleBuffer),t.vertexAttribPointer(s.aDispose,this._visibleBuffer.itemSize,t.FLOAT,!1,0,0),t.uniform1f(i.uUseTexture,this._colorTexture?1:0),t.uniform3fv(i.materialParams,this._materialParams),t.uniform1f(i.materialShininess,this._materialShininess),t.bindBuffer(t.ARRAY_BUFFER,this._rgbaBuffer),t.vertexAttribPointer(s.aColor,this._rgbaBuffer.itemSize,t.FLOAT,!1,0,0),this._drawElementsInstanced(e)}_drawElementsInstanced(e){let t=e.gl,i=e.uniforms,s=e.attributes,n=this._geoObjectHandler._renderer;t.bindBuffer(t.ARRAY_BUFFER,this._rtcPositionHighBuffer),t.vertexAttribPointer(s.aRTCPositionHigh,this._rtcPositionHighBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._rtcPositionLowBuffer),t.vertexAttribPointer(s.aRTCPositionLow,this._rtcPositionLowBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._normalsBuffer),t.vertexAttribPointer(s.aVertexNormal,this._normalsBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this._vertexBuffer),t.vertexAttribPointer(s.aVertexPosition,this._vertexBuffer.itemSize,t.FLOAT,!1,0,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._colorTexture||n.handler.defaultTexture),t.uniform1i(i.uTexture,0),t.bindBuffer(t.ARRAY_BUFFER,this._texCoordBuffer),t.vertexAttribPointer(s.aTexCoord,this._texCoordBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this._indicesBuffer),e.drawElementsInstanced(t.TRIANGLES,this._indicesBuffer.numItems,t.UNSIGNED_INT,0,this.numInstances)}async loadColorTexture(){if(this._geoObjectHandler._renderer){if(!this._colorTextureSrc)return this._colorTextureImage?(await this._colorTextureImage.decode(),void this._createColorTexture(this._colorTextureImage)):void 0;{const e=await Vi(this._colorTextureSrc);this._createColorTexture(e)}}}async loadNormalTexture(){if(this._geoObjectHandler._renderer){if(!this._normalTextureSrc)return this._normalTextureImage?(await this._normalTextureImage.decode(),void this._createNormalTexture(this._normalTextureImage)):void 0;{const e=await Vi(this._normalTextureSrc);this._createNormalTexture(e)}}}async loadMetallicRoughnessTexture(){if(this._geoObjectHandler._renderer){if(!this._metallicRoughnessTextureSrc)return this._metallicRoughnessTextureImage?(await this._metallicRoughnessTextureImage.decode(),void this._createMetallicRoughnessTexture(this._metallicRoughnessTextureImage)):void 0;{const e=await Vi(this._metallicRoughnessTextureSrc);this._createMetallicRoughnessTexture(e)}}}clear(){this.numInstances=0,this.geoObjects=[],this._sizeArr=[],this._translateArr=[],this._vertexArr=[],this._rtcPositionHighArr=[],this._rtcPositionLowArr=[],this._qRotArr=[],this._rgbaArr=[],this._normalsArr=[],this._indicesArr=[],this._pickingColorArr=[],this._visibleArr=[],this._texCoordArr=[],this._localPositionArr=[],this._deleteBuffers(),this.isFree=!1}_deleteBuffers(){if(this._geoObjectHandler&&this._geoObjectHandler._renderer){let e=this._geoObjectHandler._renderer.handler;if(e){e.deleteTexture(this._colorTexture),e.deleteTexture(this._normalTexture),e.deleteTexture(this._metallicRoughnessTexture);let t=e.gl;t&&(t.deleteBuffer(this._sizeBuffer),t.deleteBuffer(this._translateBuffer),t.deleteBuffer(this._vertexBuffer),t.deleteBuffer(this._rtcPositionHighBuffer),t.deleteBuffer(this._rtcPositionLowBuffer),t.deleteBuffer(this._qRotBuffer),t.deleteBuffer(this._rgbaBuffer),t.deleteBuffer(this._normalsBuffer),t.deleteBuffer(this._indicesBuffer),t.deleteBuffer(this._pickingColorBuffer),t.deleteBuffer(this._visibleBuffer),t.deleteBuffer(this._texCoordBuffer),t.deleteBuffer(this._localPositionBuffer))}this._colorTexture=null,this._normalTexture=null,this._metallicRoughnessTexture=null}this._sizeBuffer=null,this._translateBuffer=null,this._vertexBuffer=null,this._rtcPositionHighBuffer=null,this._rtcPositionLowBuffer=null,this._qRotBuffer=null,this._rgbaBuffer=null,this._normalsBuffer=null,this._indicesBuffer=null,this._pickingColorBuffer=null,this._visibleBuffer=null,this._texCoordBuffer=null,this._localPositionBuffer=null}createVertexBuffer(){const e=this._geoObjectHandler._renderer.handler;e.gl.deleteBuffer(this._vertexBuffer),this._vertexArr=it(this._vertexArr),this._vertexBuffer=e.createArrayBuffer(this._vertexArr,3,this._vertexArr.length/3)}createVisibleBuffer(){const e=this._geoObjectHandler._renderer.handler,t=this._visibleArr.length;this._visibleBuffer&&this._visibleBuffer.numItems===t||(e.gl.deleteBuffer(this._visibleBuffer),this._visibleBuffer=e.createStreamArrayBuffer(1,t)),this._visibleArr=it(this._visibleArr),e.setStreamArrayBuffer(this._visibleBuffer,this._visibleArr)}createSizeBuffer(){let e=this._geoObjectHandler._renderer.handler,t=this._sizeArr.length/3;this._sizeBuffer&&this._sizeBuffer.numItems===t||(e.gl.deleteBuffer(this._sizeBuffer),this._sizeBuffer=e.createStreamArrayBuffer(3,t)),this._sizeArr=it(this._sizeArr),e.setStreamArrayBuffer(this._sizeBuffer,this._sizeArr)}createTranslateBuffer(){let e=this._geoObjectHandler._renderer.handler,t=this._translateArr.length/3;this._translateBuffer&&this._translateBuffer.numItems===t||(e.gl.deleteBuffer(this._translateBuffer),this._translateBuffer=e.createStreamArrayBuffer(3,t)),this._translateArr=it(this._translateArr),e.setStreamArrayBuffer(this._translateBuffer,this._translateArr)}createLocalPositionBuffer(){let e=this._geoObjectHandler._renderer.handler,t=this._localPositionArr.length/3;this._localPositionBuffer&&this._localPositionBuffer.numItems===t||(e.gl.deleteBuffer(this._localPositionBuffer),this._localPositionBuffer=e.createStreamArrayBuffer(3,t)),this._localPositionArr=it(this._localPositionArr),e.setStreamArrayBuffer(this._localPositionBuffer,this._localPositionArr)}createTexCoordBuffer(){const e=this._geoObjectHandler._renderer.handler;e.gl.deleteBuffer(this._texCoordBuffer),this._texCoordArr=it(this._texCoordArr),this._texCoordBuffer=e.createArrayBuffer(this._texCoordArr,2,this._texCoordArr.length/2)}createRTCPositionBuffer(){let e=this._geoObjectHandler._renderer.handler,t=this._rtcPositionHighArr.length/3;this._rtcPositionHighBuffer&&this._rtcPositionHighBuffer.numItems===t||(e.gl.deleteBuffer(this._rtcPositionHighBuffer),e.gl.deleteBuffer(this._rtcPositionLowBuffer),this._rtcPositionHighBuffer=e.createStreamArrayBuffer(3,t),this._rtcPositionLowBuffer=e.createStreamArrayBuffer(3,t)),this._rtcPositionHighArr=it(this._rtcPositionHighArr),this._rtcPositionLowArr=it(this._rtcPositionLowArr),e.setStreamArrayBuffer(this._rtcPositionHighBuffer,this._rtcPositionHighArr),e.setStreamArrayBuffer(this._rtcPositionLowBuffer,this._rtcPositionLowArr)}createRgbaBuffer(){let e=this._geoObjectHandler._renderer.handler,t=this._rgbaArr.length/4;this._rgbaBuffer&&this._rgbaBuffer.numItems===t||(e.gl.deleteBuffer(this._rgbaBuffer),this._rgbaBuffer=e.createStreamArrayBuffer(4,t)),this._rgbaArr=it(this._rgbaArr),e.setStreamArrayBuffer(this._rgbaBuffer,this._rgbaArr)}createQRotBuffer(){let e=this._geoObjectHandler._renderer.handler,t=this._qRotArr.length/4;this._qRotBuffer&&this._qRotBuffer.numItems===t||(e.gl.deleteBuffer(this._qRotBuffer),this._qRotBuffer=e.createStreamArrayBuffer(4,t)),this._qRotArr=it(this._qRotArr),e.setStreamArrayBuffer(this._qRotBuffer,this._qRotArr)}createNormalsBuffer(){const e=this._geoObjectHandler._renderer.handler;e.gl.deleteBuffer(this._normalsBuffer),this._normalsArr=it(this._normalsArr),this._normalsBuffer=e.createArrayBuffer(this._normalsArr,3,this._normalsArr.length/3)}createIndicesBuffer(){const e=this._geoObjectHandler._renderer.handler;e.gl.deleteBuffer(this._indicesBuffer),this._indicesArr=it(this._indicesArr,Uint32Array),this._indicesBuffer=e.createElementArrayBuffer(this._indicesArr,1,this._indicesArr.length)}createPickingColorBuffer(){const e=this._geoObjectHandler._renderer.handler;e.gl.deleteBuffer(this._pickingColorBuffer),this._pickingColorArr=it(this._pickingColorArr),this._pickingColorBuffer=e.createArrayBuffer(this._pickingColorArr,3,this._pickingColorArr.length/3)}refresh(){let e=this._changedBuffers.length;for(;e--;)this._changedBuffers[e]=!0}update(){if(this._geoObjectHandler._renderer){let e=this._changedBuffers.length;for(;e--;)this._changedBuffers[e]&&(this._buffersUpdateCallbacks[e].call(this),this._changedBuffers[e]=!1);this.isFree=!0}}_createColorTexture(e){if(this._geoObjectHandler&&this._geoObjectHandler._renderer){let t=this._geoObjectHandler._renderer.handler;this._colorTexture=t.createTextureDefault(e,null,t.gl.REPEAT)}}_createNormalTexture(e){if(this._geoObjectHandler&&this._geoObjectHandler._renderer){let t=this._geoObjectHandler._renderer.handler;this._normalTexture=t.createTextureDefault(e,null,t.gl.REPEAT)}}_createMetallicRoughnessTexture(e){if(this._geoObjectHandler&&this._geoObjectHandler._renderer){let t=this._geoObjectHandler._renderer.handler;this._metallicRoughnessTexture=t.createTextureDefault(e,null,t.gl.REPEAT)}}}const jo=0,qo=1,Yo=2,Wo=3,$o=4,Xo=5,Zo=6,Ko=7,Qo=8,Jo=9,ta=10,ea=11;function wt(a,e=0,t=0,i=1,...s){const n=e*t;for(let o=n,l=n+t;o<l;o++)a[o]=s[o%i];return a}const bs=class U0{constructor(e){this.__id=U0.__counter__++,this.pickingEnabled=!0,this._entityCollection=e,this._renderNode=null,this._renderer=null,this._geoObjects=[],this._instanceDataMap=new Map,this._instanceDataMapValues=[],this._dataTagUpdateQueue=[],this._relativeCenter=new m,this._rtcEyePositionHigh=new Float32Array([0,0,0]),this._rtcEyePositionLow=new Float32Array([0,0,0])}initProgram(){this._renderer&&(this._renderer.handler.programs.geo_object||this._renderer.handler.addProgram(new $("geo_object",{uniforms:{viewMatrix:"mat4",projectionMatrix:"mat4",uScaleByDistance:"vec3",eyePositionHigh:"vec3",eyePositionLow:"vec3",rtcEyePositionHigh:"vec3",rtcEyePositionLow:"vec3",sunPosition:"vec3",materialParams:"vec3",materialShininess:"float",uTexture:"sampler2d",uUseTexture:"float",useLighting:"float"},attributes:{aVertexPosition:"vec3",aVertexNormal:"vec3",aTexCoord:"vec2",aLocalPosition:{type:"vec3",divisor:1},aRTCPositionHigh:{type:"vec3",divisor:1},aRTCPositionLow:{type:"vec3",divisor:1},aColor:{type:"vec4",divisor:1},aScale:{type:"vec3",divisor:1},aTranslate:{type:"vec3",divisor:1},aDispose:{type:"float",divisor:1},qRot:{type:"vec4",divisor:1}},vertexShader:"precision highp float;vec3 qRotate(vec4 q,vec3 v){return v+2.0*cross(q.xyz,cross(q.xyz,v)+q.w*v);}attribute vec3 aVertexPosition;attribute vec3 aVertexNormal;attribute vec3 aRTCPositionHigh;attribute vec3 aRTCPositionLow;attribute vec4 aColor;attribute vec3 aScale;attribute vec3 aTranslate;attribute float aDispose;attribute float aUseTexture;attribute vec2 aTexCoord;attribute vec4 qRot;attribute vec3 aLocalPosition;uniform vec3 uScaleByDistance;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform vec3 eyePositionHigh;uniform vec3 eyePositionLow;uniform vec3 rtcEyePositionHigh;uniform vec3 rtcEyePositionLow;varying vec3 cameraPosition;varying vec3 vNormal;varying vec3 v_vertex;varying vec4 vColor;varying float vDispose;varying vec2 vTexCoords;void main(void){if(aDispose==0.0){return;}vColor=aColor;vTexCoords=aTexCoord;mat4 viewMatrixRTE=viewMatrix;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);vec3 highDiff=aRTCPositionHigh-rtcEyePositionHigh;vec3 lowDiff=aRTCPositionLow-rtcEyePositionLow;cameraPosition=eyePositionHigh+eyePositionLow;highDiff=highDiff*step(1.0,length(highDiff));vec4 positionInViewSpace=viewMatrixRTE*vec4(highDiff+lowDiff,1.0);float lookLength=length(positionInViewSpace.xyz);vNormal=normalize(qRotate(qRot,aVertexNormal));float scd=uScaleByDistance[2]*clamp(lookLength,uScaleByDistance[0],uScaleByDistance[1])/uScaleByDistance[0];vec3 vert=qRotate(qRot,scd*(aVertexPosition*aScale+aTranslate))+scd*aLocalPosition;gl_Position=projectionMatrix*viewMatrixRTE*vec4(highDiff+lowDiff+vert,1.0);v_vertex=positionInViewSpace.xyz+vert;}",fragmentShader:"precision highp float;uniform vec3 sunPosition;uniform vec3 materialParams[3];uniform float materialShininess;uniform sampler2D uTexture;uniform float uUseTexture;uniform float useLighting;varying vec3 cameraPosition;varying vec3 v_vertex;varying vec4 vColor;varying vec3 vNormal;varying vec2 vTexCoords;void main(void){vec3 lightWeighting=vec3(1.0);if(useLighting!=0.0){vec3 normal=normalize(vNormal);vec3 light_dir=normalize(sunPosition);vec3 look_dir=normalize(cameraPosition-v_vertex);float diffuse=max(dot(normal,light_dir),0.0);vec3 refl_dir=reflect(-light_dir,normal);float refl=max(dot(refl_dir,look_dir),0.0);float specular=pow(refl,materialShininess)*step(1e-4,diffuse);lightWeighting=vColor.rgb*materialParams[0]+materialParams[1]*diffuse+materialParams[2]*specular;}else{lightWeighting=vColor.rgb;}if(uUseTexture>0.0){vec4 texColor=texture2D(uTexture,vTexCoords);gl_FragColor=vec4(texColor.rgb*lightWeighting,texColor.a);}else{gl_FragColor=vec4(lightWeighting,vColor.a);}}"})),this._renderer.handler.programs.geo_object_picking||this._renderer.handler.addProgram(new $("geo_object_picking",{uniforms:{viewMatrix:"mat4",projectionMatrix:"mat4",uScaleByDistance:"vec3",pickingScale:"vec3",rtcEyePositionHigh:"vec3",rtcEyePositionLow:"vec3"},attributes:{aVertexPosition:"vec3",aRTCPositionHigh:{type:"vec3",divisor:1},aRTCPositionLow:{type:"vec3",divisor:1},aPickingColor:{type:"vec3",divisor:1},aScale:{type:"vec3",divisor:1},aTranslate:{type:"vec3",divisor:1},aLocalPosition:{type:"vec3",divisor:1},aDispose:{type:"float",divisor:1},qRot:{type:"vec4",divisor:1}},vertexShader:"precision highp float;vec3 qRotate(vec4 q,vec3 v){return v+2.0*cross(q.xyz,cross(q.xyz,v)+q.w*v);}attribute vec3 aVertexPosition;attribute vec3 aRTCPositionHigh;attribute vec3 aRTCPositionLow;attribute vec3 aPickingColor;attribute vec3 aScale;attribute vec3 aTranslate;attribute float aDispose;attribute vec4 qRot;attribute vec3 aLocalPosition;uniform vec3 rtcEyePositionHigh;uniform vec3 rtcEyePositionLow;uniform vec3 uScaleByDistance;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform vec3 pickingScale;varying vec3 vColor;void main(void){if(aDispose==0.0){return;}vColor=aPickingColor;mat4 viewMatrixRTE=viewMatrix;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);vec3 highDiff=aRTCPositionHigh-rtcEyePositionHigh;vec3 lowDiff=aRTCPositionLow-rtcEyePositionLow;highDiff=highDiff*step(1.0,length(highDiff));vec4 positionInViewSpace=viewMatrixRTE*vec4(highDiff+lowDiff,1.0);float lookLength=length(positionInViewSpace.xyz);float scd=uScaleByDistance[2]*clamp(lookLength,uScaleByDistance[0],uScaleByDistance[1])/uScaleByDistance[0];vec3 vert=qRotate(qRot,scd*pickingScale*(aVertexPosition*aScale+aTranslate))+scd*aLocalPosition;gl_Position=projectionMatrix*viewMatrixRTE*vec4(highDiff+lowDiff+vert,1.0);}",fragmentShader:"precision highp float;varying vec3 vColor;void main(){gl_FragColor=vec4(vColor,1.0);}"})),this._renderer.handler.programs.geo_object_depth||this._renderer.handler.addProgram(new $("geo_object_depth",{uniforms:{viewMatrix:"mat4",projectionMatrix:"mat4",uScaleByDistance:"vec3",rtcEyePositionHigh:"vec3",rtcEyePositionLow:"vec3",frustumPickingColor:"float"},attributes:{aVertexPosition:"vec3",aRTCPositionHigh:{type:"vec3",divisor:1},aRTCPositionLow:{type:"vec3",divisor:1},aScale:{type:"vec3",divisor:1},aTranslate:{type:"vec3",divisor:1},aDispose:{type:"float",divisor:1},qRot:{type:"vec4",divisor:1},aLocalPosition:{type:"vec3",divisor:1}},vertexShader:`#version 300 es
precision highp float;vec3 qRotate(vec4 q,vec3 v){return v+2.0*cross(q.xyz,cross(q.xyz,v)+q.w*v);}in vec3 aVertexPosition;in vec3 aRTCPositionHigh;in vec3 aRTCPositionLow;in vec3 aScale;in vec3 aTranslate;in float aDispose;in vec4 qRot;in vec3 aLocalPosition;uniform vec3 rtcEyePositionHigh;uniform vec3 rtcEyePositionLow;uniform vec3 uScaleByDistance;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;void main(void){if(aDispose==0.0){return;}mat4 viewMatrixRTE=viewMatrix;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);vec3 highDiff=aRTCPositionHigh-rtcEyePositionHigh;vec3 lowDiff=aRTCPositionLow-rtcEyePositionLow;highDiff=highDiff*step(1.0,length(highDiff));vec4 positionInViewSpace=viewMatrixRTE*vec4(highDiff+lowDiff,1.0);float lookLength=length(positionInViewSpace.xyz);float scd=uScaleByDistance[2]*clamp(lookLength,uScaleByDistance[0],uScaleByDistance[1])/uScaleByDistance[0];vec3 vert=qRotate(qRot,scd*(aVertexPosition*aScale+aTranslate))+scd*aLocalPosition;gl_Position=projectionMatrix*viewMatrixRTE*vec4(highDiff+lowDiff+vert,1.0);}`,fragmentShader:`#version 300 es
precision highp float;uniform float frustumPickingColor;layout(location=0)out vec4 frustumColor;layout(location=1)out vec4 depthColor;void main(){frustumColor=vec4(frustumPickingColor,frustumPickingColor,frustumPickingColor,1.0);depthColor=vec4(gl_FragCoord.z,gl_FragCoord.z,gl_FragCoord.z,1.0);}`})))}setRenderNode(e){this._renderNode=e,this._renderer=e.renderer,this.initProgram();for(let t=0;t<this._instanceDataMapValues.length;t++)this._instanceDataMapValues[t].loadColorTexture(),this._instanceDataMapValues[t].loadNormalTexture(),this._instanceDataMapValues[t].loadMetallicRoughnessTexture();for(let t=0;t<this._geoObjects.length;t++)this._geoObjects[t].updateRotation();this.update()}setColorTextureTag(e,t){const i=this._instanceDataMap.get(t);i&&(typeof e=="string"&&(i._colorTextureSrc=e,i._colorTextureImage=null),e instanceof HTMLImageElement&&(i._colorTextureSrc=null,i._colorTextureImage=e),this._instanceDataMap.set(t,i),i.loadColorTexture())}setNormalTextureTag(e,t){const i=this._instanceDataMap.get(t);i&&(typeof e=="string"&&(i._normalTextureSrc=e,i._normalTextureImage=null),e instanceof HTMLImageElement&&(i._normalTextureSrc=null,i._normalTextureImage=e),this._instanceDataMap.set(t,i),i.loadNormalTexture())}setMetallicRoughnessTextureTag(e,t){const i=this._instanceDataMap.get(t);i&&(typeof e=="string"&&(i._metallicRoughnessTextureSrc=e,i._metallicRoughnessTextureImage=null),e instanceof HTMLImageElement&&(i._metallicRoughnessTextureSrc=null,i._metallicRoughnessTextureImage=e),this._instanceDataMap.set(t,i),i.loadMetallicRoughnessTexture())}setObjectSrc(e,t){const i=this._instanceDataMap.get(t);e&&i&&i._objectSrc!==e&&(i._objectSrc=e,W.loadObj(e).then(s=>{this._updateInstanceData(s[0],t)}))}_updateInstanceData(e,t){const i=this._instanceDataMap.get(t);i&&(e.vertices.length!==i._vertexArr.length&&(i._vertexArr=e.vertices,i._changedBuffers[jo]=!0),e.normals.length!==i._normalsArr.length&&(i._normalsArr=e.normals,i._changedBuffers[Wo]=!0),e.indices.length!==i._indicesArr.length&&(i._indicesArr=e.indices,i._changedBuffers[$o]=!0),e.texCoords.length!==i._texCoordArr.length&&(i._texCoordArr=e.texCoords,i._changedBuffers[Jo]=!0),i._colorTextureSrc=e.colorTextureSrc,i._normalTextureSrc=e.normalTextureSrc,i._metallicRoughnessTexture=e.metallicRoughnessTextureSrc,i._colorTextureImage=e.colorTextureImage,i._normalTextureImage=e.normalTextureImage,i._metallicRoughnessTextureImage=e.metallicRoughnessTextureImage,i.loadColorTexture(),i.loadNormalTexture(),i.loadMetallicRoughnessTexture(),this._updateTag(i),this._instanceDataMapValues=Array.from(this._instanceDataMap.values()))}_addGeoObjectToArray(e){const t=e.tag;let i=this._instanceDataMap.get(t);i||(i=new il(this),this._instanceDataMap.set(t,i),this._instanceDataMapValues=Array.from(this._instanceDataMap.values()),i._vertexArr=e.vertices,i._normalsArr=e.normals,i._indicesArr=e.indices,i._texCoordArr=e.texCoords,i._colorTextureSrc=e.object3d.colorTextureSrc,i._normalTextureSrc=e.object3d.normalTextureSrc,i._metallicRoughnessTextureSrc=e.object3d.metallicRoughnessTextureSrc,i._colorTextureImage=e.object3d.colorTextureImage,i._normalTextureImage=e.object3d.normalTextureImage,i._metallicRoughnessTextureImage=e.object3d.metallicRoughnessTextureImage,i.setMaterialParams(e.object3d.ambient,e.object3d.diffuse,e.object3d.specular,e.object3d.shininess),i.loadColorTexture(),i.loadNormalTexture(),i.loadMetallicRoughnessTexture()),e._tagDataIndex=i.numInstances++,e._tagData=i,i.geoObjects.push(e);let s=3;i._visibleArr=xt(i._visibleArr,wt([],0,1,1,e.getVisibility()?1:0)),this.getRTCPosition(e.getPosition(),e._rtcPositionHigh,e._rtcPositionLow);let n,o=e._rtcPositionHigh.x,l=e._rtcPositionHigh.y,h=e._rtcPositionHigh.z;i._rtcPositionHighArr=xt(i._rtcPositionHighArr,wt([],0,s,s,o,l,h)),o=e._rtcPositionLow.x,l=e._rtcPositionLow.y,h=e._rtcPositionLow.z,i._rtcPositionLowArr=xt(i._rtcPositionLowArr,wt([],0,s,s,o,l,h)),o=e._entity._pickingColor.x/255,l=e._entity._pickingColor.y/255,h=e._entity._pickingColor.z/255,i._pickingColorArr=xt(i._pickingColorArr,wt([],0,s,s,o,l,h)),s=4,o=e._qRot.x,l=e._qRot.y,h=e._qRot.z,n=e._qRot.w,i._qRotArr=xt(i._qRotArr,wt([],0,s,s,o,l,h,n)),o=e._color.x,l=e._color.y,h=e._color.z,n=e._color.w,i._rgbaArr=xt(i._rgbaArr,wt([],0,s,s,o,l,h,n)),s=3;let c=e.getScale();o=c.x,l=c.y,h=c.z,i._sizeArr=xt(i._sizeArr,wt([],0,s,s,o,l,h));let d=e.getTranslate();o=d.x,l=d.y,h=d.z,i._translateArr=xt(i._translateArr,wt([],0,s,s,o,l,h));let u=e.getLocalPosition();o=u.x,l=u.y,h=u.z,i._localPositionArr=xt(i._localPositionArr,wt([],0,s,s,o,l,h))}_bindCommon(){let e=this._renderer,t=e.handler.programs.geo_object._program.uniforms,i=e.handler.gl,s=this._entityCollection;i.uniform3fv(t.uScaleByDistance,s.scaleByDistance),i.uniform1f(t.useLighting,s._useLighting),i.uniform3fv(t.eyePositionHigh,e.activeCamera.eyeHigh),i.uniform3fv(t.eyePositionLow,e.activeCamera.eyeLow),i.uniform3fv(t.rtcEyePositionHigh,this._rtcEyePositionHigh),i.uniform3fv(t.rtcEyePositionLow,this._rtcEyePositionLow),i.uniformMatrix4fv(t.projectionMatrix,!1,e.activeCamera.getProjectionMatrix()),i.uniformMatrix4fv(t.viewMatrix,!1,e.activeCamera.getViewMatrix()),i.uniform3fv(t.sunPosition,this._renderNode._lightPosition)}_displayOpaquePASS(){let e=this._renderer.handler.programs.geo_object,t=e._program;e.activate(),this._bindCommon();for(let i=0;i<this._instanceDataMapValues.length;i++)this._instanceDataMapValues[i].drawOpaque(t)}_displayTransparentPASS(){let e=this._renderer.handler.programs.geo_object,t=e._program;e.activate(),this._bindCommon();for(let i=0;i<this._instanceDataMapValues.length;i++)this._instanceDataMapValues[i].drawTransparent(t)}_depthPASS(){let e=this._renderer,t=e.handler.programs.geo_object_depth,i=t._program,s=i.uniforms,n=i.attributes,o=e.handler.gl,l=this._entityCollection,h=e.activeCamera;t.activate(),o.uniform3fv(s.uScaleByDistance,l.scaleByDistance),o.uniform3fv(s.rtcEyePositionHigh,this._rtcEyePositionHigh),o.uniform3fv(s.rtcEyePositionLow,this._rtcEyePositionLow),o.uniformMatrix4fv(s.projectionMatrix,!1,e.activeCamera.getProjectionMatrix()),o.uniformMatrix4fv(s.viewMatrix,!1,e.activeCamera.getViewMatrix()),o.uniform1f(s.frustumPickingColor,h.frustumColorIndex);for(let c=0;c<this._instanceDataMapValues.length;c++){let d=this._instanceDataMapValues[c];o.bindBuffer(o.ARRAY_BUFFER,d._qRotBuffer),o.vertexAttribPointer(n.qRot,d._qRotBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,d._sizeBuffer),o.vertexAttribPointer(n.aScale,d._sizeBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,d._translateBuffer),o.vertexAttribPointer(n.aTranslate,d._translateBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,d._localPositionBuffer),o.vertexAttribPointer(n.aLocalPosition,d._localPositionBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,d._rtcPositionHighBuffer),o.vertexAttribPointer(n.aRTCPositionHigh,d._rtcPositionHighBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,d._rtcPositionLowBuffer),o.vertexAttribPointer(n.aRTCPositionLow,d._rtcPositionLowBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,d._visibleBuffer),o.vertexAttribPointer(n.aDispose,d._visibleBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,d._vertexBuffer),o.vertexAttribPointer(n.aVertexPosition,d._vertexBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,d._indicesBuffer),i.drawElementsInstanced(o.TRIANGLES,d._indicesBuffer.numItems,o.UNSIGNED_INT,0,d.numInstances)}}drawDepth(){this._geoObjects.length&&this._depthPASS()}drawPicking(){this._geoObjects.length&&this.pickingEnabled&&this._pickingPASS()}_pickingPASS(){let e=this._renderer,t=e.handler.programs.geo_object_picking,i=t._program,s=i.uniforms,n=i.attributes,o=e.handler.gl,l=this._entityCollection;t.activate(),o.uniform3fv(s.uScaleByDistance,l.scaleByDistance),o.uniform3fv(s.pickingScale,l.pickingScale),o.uniform3fv(s.rtcEyePositionHigh,this._rtcEyePositionHigh),o.uniform3fv(s.rtcEyePositionLow,this._rtcEyePositionLow),o.uniformMatrix4fv(s.projectionMatrix,!1,e.activeCamera.getProjectionMatrix()),o.uniformMatrix4fv(s.viewMatrix,!1,e.activeCamera.getViewMatrix());for(let h=0;h<this._instanceDataMapValues.length;h++){let c=this._instanceDataMapValues[h];o.bindBuffer(o.ARRAY_BUFFER,c._qRotBuffer),o.vertexAttribPointer(n.qRot,c._qRotBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,c._sizeBuffer),o.vertexAttribPointer(n.aScale,c._sizeBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,c._translateBuffer),o.vertexAttribPointer(n.aTranslate,c._translateBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,c._localPositionBuffer),o.vertexAttribPointer(n.aLocalPosition,c._localPositionBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,c._pickingColorBuffer),o.vertexAttribPointer(n.aPickingColor,c._pickingColorBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,c._rtcPositionHighBuffer),o.vertexAttribPointer(n.aRTCPositionHigh,c._rtcPositionHighBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,c._rtcPositionLowBuffer),o.vertexAttribPointer(n.aRTCPositionLow,c._rtcPositionLowBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,c._visibleBuffer),o.vertexAttribPointer(n.aDispose,c._visibleBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,c._vertexBuffer),o.vertexAttribPointer(n.aVertexPosition,c._vertexBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,c._indicesBuffer),i.drawElementsInstanced(o.TRIANGLES,c._indicesBuffer.numItems,o.UNSIGNED_INT,0,c.numInstances)}}setQRotArr(e,t,i){wt(e._qRotArr,t,4,4,i.x,i.y,i.z,i.w),e._changedBuffers[Xo]=!0,this._updateTag(e)}setVisibility(e,t,i){wt(e._visibleArr,t,1,1,i?1:0),e._changedBuffers[Qo]=!0,this._updateTag(e)}setRTCPositionArr(e,t,i,s){wt(e._rtcPositionHighArr,t,3,3,i.x,i.y,i.z),wt(e._rtcPositionLowArr,t,3,3,s.x,s.y,s.z),e._changedBuffers[qo]=!0,this._updateTag(e)}setRgbaArr(e,t,i){wt(e._rgbaArr,t,4,4,i.x,i.y,i.z,i.w),e._changedBuffers[Yo]=!0,this._updateTag(e)}setPickingColorArr(e,t,i){wt(e._pickingColorArr,t,3,3,i.x/255,i.y/255,i.z/255),e._changedBuffers[Ko]=!0,this._updateTag(e)}setScaleArr(e,t,i){wt(e._sizeArr,t,3,3,i.x,i.y,i.z),e._changedBuffers[Zo]=!0,this._updateTag(e)}setTranslateArr(e,t,i){wt(e._translateArr,t,3,3,i.x,i.y,i.z),e._changedBuffers[ta]=!0,this._updateTag(e)}setLocalPositionArr(e,t,i){wt(e._localPositionArr,t,3,3,i.x,i.y,i.z),e._changedBuffers[ea]=!0,this._updateTag(e)}_updateTag(e){e.isFree&&(e.isFree=!1,this._dataTagUpdateQueue.push(e))}update(){for(let e=0,t=this._dataTagUpdateQueue.length;e<t;e++)this._dataTagUpdateQueue[e].update();this._dataTagUpdateQueue=[]}_removeAll(){let e=this._geoObjects.length;for(;e--;){const t=this._geoObjects[e];t._tagDataIndex=-1,t._tagData=null,t._handlerIndex=-1,t._handler=null}this._geoObjects.length=0,this._geoObjects=[];for(let t=0;t<this._instanceDataMapValues.length;t++)this._instanceDataMapValues[t].clear();this._instanceDataMap.clear(),this._instanceDataMapValues=[]}clear(){this._removeAll()}getRTCPosition(e,t,i){let s=e.sub(this._relativeCenter);m.doubleToTwoFloats(s,t,i)}setRelativeCenter(e){this._relativeCenter.copy(e);for(let t=0;t<this._instanceDataMapValues.length;t++){let i=this._instanceDataMapValues[t].geoObjects;for(let s=0;s<i.length;s++)i[s].updateRTCPosition()}}_updateRTCEyePosition(){let e=this._renderer;if(e.activeCamera.isFirstPass){let t=e.activeCamera.eye.sub(this._relativeCenter);m.doubleToTwoFloat32Array(t,this._rtcEyePositionHigh,this._rtcEyePositionLow)}}draw(){this._geoObjects.length&&(this._updateRTCEyePosition(),this.update(),this._displayOpaquePASS())}drawTransparent(){this._geoObjects.length&&this._displayTransparentPASS()}add(e){e._handlerIndex===-1&&(e._handler=this,e._handlerIndex=this._geoObjects.length,this._geoObjects.push(e),this._addGeoObjectToArray(e),e.updateRotation(),e._tagData.refresh(),this._updateTag(e._tagData),e.setObjectSrc(e._objectSrc))}remove(e){e._handler&&this.__id==e._handler.__id&&this._removeGeoObject(e)}_clearDataTagQueue(){this._dataTagUpdateQueue=[]}_removeGeoObject(e){let t=e._tagData,i=e.tag;t.numInstances--;let s=!1;if(t.numInstances===0){t.clear(),this._instanceDataMap.delete(i);for(let o=0;this._instanceDataMapValues.length;o++)if(this._instanceDataMapValues[o].numInstances===0){this._instanceDataMapValues.splice(o,1);break}this._clearDataTagQueue(),s=!0}this._geoObjects.splice(e._handlerIndex,1);for(let o=e._handlerIndex,l=this._geoObjects.length;o<l;o++){let h=this._geoObjects[o];h._handlerIndex=h._handlerIndex-1}let n=e._tagDataIndex;t.geoObjects.splice(n,1);for(let o=e._tagDataIndex,l=t.geoObjects.length;o<l;o++){let h=t.geoObjects[o];h._tagDataIndex=h._tagDataIndex-1}t._rgbaArr=Ct(t._rgbaArr,4*n,4),t._rtcPositionHighArr=Ct(t._rtcPositionHighArr,3*n,3),t._rtcPositionLowArr=Ct(t._rtcPositionLowArr,3*n,3),t._qRotArr=Ct(t._qRotArr,4*n,4),t._pickingColorArr=Ct(t._pickingColorArr,3*n,3),t._sizeArr=Ct(t._sizeArr,3*n,3),t._translateArr=Ct(t._translateArr,3*n,3),t._localPositionArr=Ct(t._localPositionArr,3*n,3),t._visibleArr=Ct(t._visibleArr,n,1),e._handlerIndex=-1,e._handler=null,e._tagDataIndex=-1,e._tagData=null,s||(t.refresh(),this._updateTag(t))}};bs.__counter__=0;let Cr=bs;class sl extends rs{constructor(e,t=21){super(e),this._billboards=[],this._gliphParamBuffer=null,this._fontIndexBuffer=null,this._outlineBuffer=null,this._outlineColorBuffer=null,this._gliphParamArr=new Float32Array([]),this._fontIndexArr=new Float32Array([]),this._outlineArr=new Float32Array([]),this._outlineColorArr=new Float32Array([]),this._buffersUpdateCallbacks[8]=this.createFontIndexBuffer,this._buffersUpdateCallbacks[9]=this.createOutlineBuffer,this._buffersUpdateCallbacks[10]=this.createOutlineColorBuffer,this._changedBuffers=new Array(this._buffersUpdateCallbacks.length),this._maxLetters=t}initProgram(){this._renderer&&this._renderer.handler&&this._renderer.handler.gl&&(this._renderer.handler.programs.label||(this._renderer.handler.gl.type==="webgl2"?this._renderer.handler.addProgram(new $("label",{uniforms:{viewport:"vec2",fontTextureArr:"sampler2darray",sdfParamsArr:"vec4",projectionMatrix:"mat4",viewMatrix:"mat4",eyePositionHigh:"vec3",eyePositionLow:"vec3",planetRadius:"float",scaleByDistance:"vec3",opacity:"float",isOutlinePass:"int",depthOffset:"float"},attributes:{a_outline:"float",a_gliphParam:"vec4",a_vertices:"vec2",a_texCoord:"vec4",a_positionsHigh:"vec3",a_positionsLow:"vec3",a_size:"float",a_rotation:"float",a_rgba:"vec4",a_offset:"vec3",a_fontIndex:"float"},vertexShader:`#version 300 es
#define EMPTY - 1.0
#define RTL 1.0
vec2 project(vec4 p,vec2 viewport){return(0.5*p.xyz/p.w+0.5).xy*viewport;}mat2 rotate2d(float angle){return mat2(cos(angle),-sin(angle),sin(angle),cos(angle));}in float a_outline;in vec4 a_gliphParam;in vec2 a_vertices;in vec4 a_texCoord;in vec3 a_positionsHigh;in vec3 a_positionsLow;in vec3 a_offset;in float a_size;in float a_rotation;in vec4 a_rgba;in float a_fontIndex;out vec2 v_uv;out vec4 v_rgba;flat out int v_fontIndex;out vec4 v_outlineColor;flat out float v_outline;uniform vec2 viewport;uniform mat4 viewMatrix;uniform mat4 projectionMatrix;uniform vec3 eyePositionHigh;uniform vec3 eyePositionLow;uniform float planetRadius;uniform vec3 scaleByDistance;uniform float opacity;uniform float depthOffset;const vec3 ZERO3=vec3(0.0);void main(){if(a_texCoord.w==EMPTY){gl_Position=vec4(0.0);v_fontIndex=-1;return;}vec3 a_positions=a_positionsHigh+a_positionsLow;vec3 cameraPos=eyePositionHigh+eyePositionLow;v_outline=a_outline;v_fontIndex=int(a_fontIndex);v_uv=a_texCoord.xy;vec3 look=a_positions-cameraPos;float lookDist=length(look);v_rgba=a_rgba;if(opacity*step(lookDist,sqrt(dot(cameraPos,cameraPos)-planetRadius)+sqrt(dot(a_positions,a_positions)-planetRadius))==0.0){return;}float scd=(1.0-smoothstep(scaleByDistance[0],scaleByDistance[1],lookDist))*(1.0-step(scaleByDistance[2],lookDist));v_rgba.a*=opacity;mat4 viewMatrixRTE=viewMatrix;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);vec3 highDiff=a_positionsHigh-eyePositionHigh;vec3 lowDiff=a_positionsLow-eyePositionLow;vec4 posRTE=viewMatrixRTE*vec4(highDiff+lowDiff,1.0);vec4 projPos=projectionMatrix*posRTE;float camSlope=dot(vec3(viewMatrix[0][2],viewMatrix[1][2],viewMatrix[2][2]),normalize(cameraPos));if(camSlope>0.5){float dist=dot(look,normalize(cameraPos));projPos.z+=dist*0.02;}else{projPos.z+=-(abs(projPos.z))*0.002;}projPos.z+=depthOffset+a_offset.z;vec2 screenPos=project(projPos,viewport);vec2 vert=a_vertices;vec4 gp=a_gliphParam;if(a_texCoord.w==RTL){vert.x=step(vert.x*0.5+1.0,1.0);gp.x=-a_gliphParam.x;gp.z=-(a_gliphParam.z+a_texCoord.z);}else{gp.z=a_gliphParam.z+a_texCoord.z;}vec2 v=screenPos+rotate2d(a_rotation)*((vert*gp.xy+gp.zw)*a_size*scd+a_offset.xy);gl_Position=vec4((2.0*v/viewport-1.0)*projPos.w,projPos.z,projPos.w);}`,fragmentShader:`#version 300 es
uniform int isOutlinePass;precision highp float;const int MAX_SIZE=11;uniform sampler2D fontTextureArr[MAX_SIZE];uniform vec4 sdfParamsArr[MAX_SIZE];flat in int v_fontIndex;in vec2 v_uv;in vec4 v_rgba;flat in float v_outline;in vec3 v_pickingColor;layout(location=0)out vec4 outScreen;float median(float r,float g,float b){return max(min(r,g),min(max(r,g),b));}float getDistance(){vec3 msdf;if(v_fontIndex==0){msdf=texture(fontTextureArr[0],v_uv).rgb;}else if(v_fontIndex==1){msdf=texture(fontTextureArr[1],v_uv).rgb;}else if(v_fontIndex==2){msdf=texture(fontTextureArr[2],v_uv).rgb;}else if(v_fontIndex==3){msdf=texture(fontTextureArr[3],v_uv).rgb;}else if(v_fontIndex==4){msdf=texture(fontTextureArr[4],v_uv).rgb;}else if(v_fontIndex==5){msdf=texture(fontTextureArr[5],v_uv).rgb;}else if(v_fontIndex==6){msdf=texture(fontTextureArr[6],v_uv).rgb;}else if(v_fontIndex==7){msdf=texture(fontTextureArr[7],v_uv).rgb;}else if(v_fontIndex==8){msdf=texture(fontTextureArr[8],v_uv).rgb;}else if(v_fontIndex==9){msdf=texture(fontTextureArr[9],v_uv).rgb;}else if(v_fontIndex==10){msdf=texture(fontTextureArr[10],v_uv).rgb;}return median(msdf.r,msdf.g,msdf.b);}void main(){if(v_fontIndex==-1){return;}vec4 sdfParams=sdfParamsArr[v_fontIndex];float sd=getDistance();vec2 dxdy=fwidth(v_uv)*sdfParams.xy;if(isOutlinePass==0){float dist=sd+min(0.001,0.5-1.0/sdfParams.w)-0.5;float opacity=clamp(dist*sdfParams.w/length(dxdy)+0.5,0.0,1.0);if(opacity<=0.1){discard;}outScreen=vec4(v_rgba.rgb,opacity*v_rgba.a);}else{float dist=sd+min(v_outline,0.5-1.0/sdfParams.w)-0.5;float opacity=clamp(dist*sdfParams.w/length(dxdy)+0.5,0.0,1.0);if(opacity<=0.1){discard;}outScreen=vec4(v_rgba.rgb,opacity*v_rgba.a);}}`})):this._renderer.handler.addProgram(new $("label",{uniforms:{viewport:"vec2",fontTextureArr:"sampler2darray",sdfParamsArr:"vec4",projectionMatrix:"mat4",viewMatrix:"mat4",eyePositionHigh:"vec3",eyePositionLow:"vec3",planetRadius:"float",scaleByDistance:"vec3",opacity:"float",isOutlinePass:"int",depthOffset:"float"},attributes:{a_outline:"float",a_gliphParam:"vec4",a_vertices:"vec2",a_texCoord:"vec4",a_positionsHigh:"vec3",a_positionsLow:"vec3",a_size:"float",a_rotation:"float",a_rgba:"vec4",a_offset:"vec3",a_fontIndex:"float"},vertexShader:`#define EMPTY - 1.0
#define RTL 1.0
vec2 project(vec4 p,vec2 viewport){return(0.5*p.xyz/p.w+0.5).xy*viewport;}mat2 rotate2d(float angle){return mat2(cos(angle),-sin(angle),sin(angle),cos(angle));}attribute float a_outline;attribute vec4 a_gliphParam;attribute vec2 a_vertices;attribute vec4 a_texCoord;attribute vec3 a_positionsHigh;attribute vec3 a_positionsLow;attribute vec3 a_offset;attribute float a_size;attribute float a_rotation;attribute vec4 a_rgba;attribute float a_fontIndex;varying float v_outline;varying vec2 v_uv;varying vec4 v_rgba;varying float v_fontIndex;uniform vec2 viewport;uniform mat4 viewMatrix;uniform mat4 projectionMatrix;uniform vec3 eyePositionHigh;uniform vec3 eyePositionLow;uniform float planetRadius;uniform vec3 scaleByDistance;uniform float opacity;uniform float depthOffset;const vec3 ZERO3=vec3(0.0);void main(){if(a_texCoord.w==EMPTY){gl_Position=vec4(0.0);v_fontIndex=-1.0;return;}vec3 a_positions=a_positionsHigh+a_positionsLow;vec3 cameraPos=eyePositionHigh+eyePositionLow;v_outline=a_outline;v_uv=vec2(a_texCoord.xy);v_rgba=a_rgba;v_fontIndex=a_fontIndex;vec3 look=a_positions-cameraPos;float lookDist=length(look);if(opacity*step(lookDist,sqrt(dot(cameraPos,cameraPos)-planetRadius)+sqrt(dot(a_positions,a_positions)-planetRadius))==0.0){return;}float scd=(1.0-smoothstep(scaleByDistance[0],scaleByDistance[1],lookDist))*(1.0-step(scaleByDistance[2],lookDist));v_rgba.a*=opacity;mat4 viewMatrixRTE=viewMatrix;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);vec3 highDiff=a_positionsHigh-eyePositionHigh;vec3 lowDiff=a_positionsLow-eyePositionLow;vec4 posRTE=viewMatrixRTE*vec4(highDiff+lowDiff,1.0);vec4 projPos=projectionMatrix*posRTE;float camSlope=dot(vec3(viewMatrix[0][2],viewMatrix[1][2],viewMatrix[2][2]),normalize(cameraPos));if(camSlope>0.5){float dist=dot(look,normalize(cameraPos));projPos.z+=dist*0.02;}else{projPos.z+=-(abs(projPos.z))*0.002;}projPos.z+=depthOffset+a_offset.z;vec2 screenPos=project(projPos,viewport);vec2 vert=a_vertices;vec4 gp=a_gliphParam;if(a_texCoord.w==RTL){vert.x=step(vert.x*0.5+1.0,1.0);gp.x=-a_gliphParam.x;gp.z=-(a_gliphParam.z+a_texCoord.z);}else{gp.z=a_gliphParam.z+a_texCoord.z;}vec2 v=screenPos+rotate2d(a_rotation)*((vert*gp.xy+gp.zw)*a_size*scd+a_offset.xy);gl_Position=vec4((2.0*v/viewport-1.0)*projPos.w,projPos.z,projPos.w);}`,fragmentShader:`#extension GL_OES_standard_derivatives: enable
precision highp float;precision highp int;const int MAX_SIZE=11;uniform sampler2D fontTextureArr[MAX_SIZE];uniform vec4 sdfParamsArr[MAX_SIZE];uniform int isOutlinePass;varying float v_outline;varying vec2 v_uv;varying vec4 v_rgba;varying float v_fontIndex;float fontIndex;float median(float r,float g,float b){return max(min(r,g),min(max(r,g),b));}float getDistance(){vec3 msdf;if(fontIndex>=0.0&&fontIndex<1.0){msdf=texture2D(fontTextureArr[0],v_uv).rgb;}else if(fontIndex>=1.0&&fontIndex<2.0){msdf=texture2D(fontTextureArr[1],v_uv).rgb;}else if(fontIndex>=2.0&&fontIndex<3.0){msdf=texture2D(fontTextureArr[2],v_uv).rgb;}else if(fontIndex>=3.0&&fontIndex<4.0){msdf=texture2D(fontTextureArr[3],v_uv).rgb;}else if(fontIndex>=4.0&&fontIndex<5.0){msdf=texture2D(fontTextureArr[4],v_uv).rgb;}else if(fontIndex>=5.0&&fontIndex<6.0){msdf=texture2D(fontTextureArr[5],v_uv).rgb;}else if(fontIndex>=6.0&&fontIndex<7.0){msdf=texture2D(fontTextureArr[6],v_uv).rgb;}else if(fontIndex>=7.0&&fontIndex<8.0){msdf=texture2D(fontTextureArr[7],v_uv).rgb;}else if(fontIndex>=8.0&&fontIndex<9.0){msdf=texture2D(fontTextureArr[8],v_uv).rgb;}else if(fontIndex>=9.0&&fontIndex<10.0){msdf=texture2D(fontTextureArr[9],v_uv).rgb;}else if(fontIndex>=10.0&&fontIndex<11.0){msdf=texture2D(fontTextureArr[10],v_uv).rgb;}return median(msdf.r,msdf.g,msdf.b);}vec4 getSDFParams(){if(fontIndex>=0.0&&fontIndex<1.0){return sdfParamsArr[0];}else if(fontIndex>=1.0&&fontIndex<2.0){return sdfParamsArr[1];}else if(fontIndex>=2.0&&fontIndex<3.0){return sdfParamsArr[2];}else if(fontIndex>=3.0&&fontIndex<4.0){return sdfParamsArr[3];}else if(fontIndex>=4.0&&fontIndex<5.0){return sdfParamsArr[4];}else if(fontIndex>=5.0&&fontIndex<6.0){return sdfParamsArr[5];}else if(fontIndex>=6.0&&fontIndex<7.0){return sdfParamsArr[6];}else if(fontIndex>=7.0&&fontIndex<8.0){return sdfParamsArr[7];}else if(fontIndex>=8.0&&fontIndex<9.0){return sdfParamsArr[8];}else if(fontIndex>=9.0&&fontIndex<10.0){return sdfParamsArr[9];}else if(fontIndex>=10.0&&fontIndex<11.0){return sdfParamsArr[10];}}void main(){fontIndex=v_fontIndex+0.1;if(v_fontIndex<0.0){return;}vec4 sdfParams=getSDFParams();float sd=getDistance();vec2 dxdy=fwidth(v_uv)*sdfParams.xy;float dist=sd+min(0.001,0.5-1.0/sdfParams.w)-0.5;float opacity=clamp(dist*sdfParams.w/length(dxdy)+0.5,0.0,1.0);if(isOutlinePass==0){}else{float strokeDist=sd+min(v_outline,0.5-1.0/sdfParams.w)-0.5;float strokeAlpha=v_rgba.a*clamp(strokeDist*sdfParams.w/length(dxdy)+0.5,0.0,1.0);if(strokeAlpha<0.1){discard;}}}`}))),this._renderer.handler.programs.labelPicking||this._renderer.handler.addProgram(new $("labelPicking",{uniforms:{viewport:"vec2",projectionMatrix:"mat4",viewMatrix:"mat4",eyePositionHigh:"vec3",eyePositionLow:"vec3",planetRadius:"float",scaleByDistance:"vec3",opacity:"float",depthOffset:"float"},attributes:{a_gliphParam:"vec4",a_vertices:"vec2",a_texCoord:"vec4",a_positionsHigh:"vec3",a_positionsLow:"vec3",a_offset:"vec3",a_size:"float",a_rotation:"float",a_rgba:"vec4"},vertexShader:`#define EMPTY - 1.0
#define RTL 1.0
vec2 project(vec4 p,vec2 viewport){return(0.5*p.xyz/p.w+0.5).xy*viewport;}mat2 rotate2d(float angle){return mat2(cos(angle),-sin(angle),sin(angle),cos(angle));}attribute vec4 a_gliphParam;attribute vec2 a_vertices;attribute vec4 a_texCoord;attribute vec3 a_positionsHigh;attribute vec3 a_positionsLow;attribute vec3 a_offset;attribute float a_size;attribute float a_rotation;attribute vec4 a_rgba;varying vec4 v_rgba;uniform vec2 viewport;uniform mat4 viewMatrix;uniform mat4 projectionMatrix;uniform vec3 eyePositionHigh;uniform vec3 eyePositionLow;uniform float planetRadius;uniform vec3 scaleByDistance;uniform float opacity;uniform float depthOffset;const vec3 ZERO3=vec3(0.0);void main(){vec3 a_positions=a_positionsHigh+a_positionsLow;vec3 cameraPos=eyePositionHigh+eyePositionLow;v_rgba=a_rgba;if(a_texCoord.w==EMPTY){v_rgba.a=0.0;gl_Position=vec4(0.0);return;}vec3 look=a_positions-cameraPos;float lookDist=length(look);if(opacity*step(lookDist,sqrt(dot(cameraPos,cameraPos)-planetRadius)+sqrt(dot(a_positions,a_positions)-planetRadius))==0.0){return;}float scd=(1.0-smoothstep(scaleByDistance[0],scaleByDistance[1],lookDist))*(1.0-step(scaleByDistance[2],lookDist));v_rgba.a*=opacity;mat4 viewMatrixRTE=viewMatrix;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);vec3 highDiff=a_positionsHigh-eyePositionHigh;vec3 lowDiff=a_positionsLow-eyePositionLow;vec4 posRTE=viewMatrixRTE*vec4(highDiff+lowDiff,1.0);vec4 projPos=projectionMatrix*posRTE;float camSlope=dot(vec3(viewMatrix[0][2],viewMatrix[1][2],viewMatrix[2][2]),normalize(cameraPos));if(camSlope>0.5){float dist=dot(look,normalize(cameraPos));projPos.z+=dist*0.02;}else{projPos.z+=-(abs(projPos.z))*0.002;}projPos.z+=depthOffset+a_offset.z;vec2 screenPos=project(projPos,viewport);vec2 vert=a_vertices;vec4 gp=a_gliphParam;if(a_texCoord.w==RTL){vert.x=step(vert.x*0.5+1.0,1.0);gp.x=-a_gliphParam.x;gp.z=-(a_gliphParam.z+a_texCoord.z);}else{gp.z=a_gliphParam.z+a_texCoord.z;}vec2 v=screenPos+rotate2d(a_rotation)*((vert*gp.xy+gp.zw)*a_size*scd+a_offset.xy);gl_Position=vec4((2.0*v/viewport-1.0)*projPos.w,projPos.z,projPos.w);}`,fragmentShader:"precision highp float;varying vec4 v_rgba;varying vec3 v_pickingColor;void main(){vec4 color=v_rgba;if(color.a<0.05){return;}gl_FragColor=vec4(v_rgba.rgb,v_rgba.a);}"})))}get labels(){return this._billboards}add(e){e._handler||(e._handler=this,this.assignFontAtlas(e),this.refresh())}updateFonts(){let e=[...this._billboards];this._billboards=[];for(let t=0;t<e.length;t++)this.assignFontAtlas(e[t])}_addLabelToArrays(e){this._renderer&&this._renderer.labelWorker.make({handler:this,label:e})}assignFontAtlas(e){this._entityCollection&&this._renderer?(e.assignFontAtlas(this._renderer.fontAtlas),this._addLabelToArrays(e)):this._billboards.push(e)}workerCallback(e,t){t._lockId!==-1&&t._handler&&this.isEqual(t._handler)&&(t._isReady=!0,t._lockId=-1,t._handlerIndex=this._billboards.length,this._billboards.push(t),this._vertexArr=et(this._vertexArr,e.vertexArr),this._texCoordArr=et(this._texCoordArr,e.texCoordArr),this._gliphParamArr=et(this._gliphParamArr,e.gliphParamArr),this._positionHighArr=et(this._positionHighArr,e.positionHighArr),this._positionLowArr=et(this._positionLowArr,e.positionLowArr),this._sizeArr=et(this._sizeArr,e.sizeArr),this._offsetArr=et(this._offsetArr,e.offsetArr),this._rgbaArr=et(this._rgbaArr,e.rgbaArr),this._rotationArr=et(this._rotationArr,e.rotationArr),this._fontIndexArr=et(this._fontIndexArr,e.fontIndexArr),this._outlineArr=et(this._outlineArr,e.outlineArr),this._outlineColorArr=et(this._outlineColorArr,e.outlineColorArr),this._pickingColorArr=et(this._pickingColorArr,e.pickingColorArr),t.update(),this.refresh())}clear(){this._texCoordArr=null,this._gliphParamArr=null,this._vertexArr=null,this._positionHighArr=null,this._positionLowArr=null,this._sizeArr=null,this._offsetArr=null,this._rgbaArr=null,this._rotationArr=null,this._fontIndexArr=null,this._outlineArr=null,this._outlineColorArr=null,this._texCoordArr=new Float32Array([]),this._gliphParamArr=new Float32Array([]),this._vertexArr=new Float32Array([]),this._positionHighArr=new Float32Array([]),this._positionLowArr=new Float32Array([]),this._sizeArr=new Float32Array([]),this._offsetArr=new Float32Array([]),this._rgbaArr=new Float32Array([]),this._rotationArr=new Float32Array([]),this._fontIndexArr=new Float32Array([]),this._outlineArr=new Float32Array([]),this._outlineColorArr=new Float32Array([]),this._removeBillboards(),this._deleteBuffers(),this.refresh()}_deleteBuffers(){if(this._renderer){let e=this._renderer.handler.gl;e.deleteBuffer(this._gliphParamBuffer),e.deleteBuffer(this._sizeBuffer),e.deleteBuffer(this._fontIndexBuffer),e.deleteBuffer(this._texCoordBuffer),e.deleteBuffer(this._outlineBuffer),e.deleteBuffer(this._outlineColorBuffer),e.deleteBuffer(this._positionHighBuffer),e.deleteBuffer(this._positionLowBuffer),e.deleteBuffer(this._sizeBuffer),e.deleteBuffer(this._offsetBuffer),e.deleteBuffer(this._rgbaBuffer),e.deleteBuffer(this._rotationBuffer),e.deleteBuffer(this._vertexBuffer),e.deleteBuffer(this._texCoordBuffer),e.deleteBuffer(this._pickingColorBuffer),this._gliphParamBuffer=null,this._sizeBuffer=null,this._fontIndexBuffer=null,this._texCoordBuffer=null,this._outlineBuffer=null,this._outlineColorBuffer=null,this._positionHighBuffer=null,this._positionLowBuffer=null,this._sizeBuffer=null,this._offsetBuffer=null,this._rgbaBuffer=null,this._rotationBuffer=null,this._vertexBuffer=null,this._texCoordBuffer=null,this._pickingColorBuffer=null}}_displayPASS(){let e=this._renderer,t=e.handler;t.programs.label.activate();let i=t.programs.label._program,s=i.attributes,n=i.uniforms,o=t.gl,l=this._entityCollection;o.disable(o.CULL_FACE),o.uniform1iv(n.fontTextureArr,e.fontAtlas.samplerArr),o.uniform4fv(n.sdfParamsArr,e.fontAtlas.sdfParamsArr),o.uniformMatrix4fv(n.viewMatrix,!1,e.activeCamera.getViewMatrix()),o.uniformMatrix4fv(n.projectionMatrix,!1,e.activeCamera.getProjectionMatrix()),o.uniform3fv(n.eyePositionHigh,e.activeCamera.eyeHigh),o.uniform3fv(n.eyePositionLow,e.activeCamera.eyeLow),o.uniform3fv(n.scaleByDistance,l.scaleByDistance),o.uniform1f(n.opacity,l._fadingOpacity),o.uniform1f(n.planetRadius,l.renderNode._planetRadius2||0),o.uniform2fv(n.viewport,[t.canvas.clientWidth,t.canvas.clientHeight]),o.bindBuffer(o.ARRAY_BUFFER,this._texCoordBuffer),o.vertexAttribPointer(s.a_texCoord,this._texCoordBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._gliphParamBuffer),o.vertexAttribPointer(s.a_gliphParam,this._gliphParamBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._vertexBuffer),o.vertexAttribPointer(s.a_vertices,this._vertexBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._positionHighBuffer),o.vertexAttribPointer(s.a_positionsHigh,this._positionHighBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._positionLowBuffer),o.vertexAttribPointer(s.a_positionsLow,this._positionLowBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._sizeBuffer),o.vertexAttribPointer(s.a_size,this._sizeBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._rotationBuffer),o.vertexAttribPointer(s.a_rotation,this._rotationBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._offsetBuffer),o.vertexAttribPointer(s.a_offset,this._offsetBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._fontIndexBuffer),o.vertexAttribPointer(s.a_fontIndex,this._fontIndexBuffer.itemSize,o.FLOAT,!1,0,0),o.uniform1i(n.isOutlinePass,1),o.uniform1f(n.depthOffset,l.polygonOffsetUnits),o.bindBuffer(o.ARRAY_BUFFER,this._outlineColorBuffer),o.vertexAttribPointer(s.a_rgba,this._outlineColorBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._outlineBuffer),o.vertexAttribPointer(s.a_outline,this._outlineBuffer.itemSize,o.FLOAT,!1,0,0),o.drawArrays(o.TRIANGLES,0,this._vertexBuffer.numItems),o.depthFunc(o.EQUAL),o.uniform1i(n.isOutlinePass,0),o.uniform1f(n.depthOffset,l.polygonOffsetUnits),o.bindBuffer(o.ARRAY_BUFFER,this._rgbaBuffer),o.vertexAttribPointer(s.a_rgba,this._rgbaBuffer.itemSize,o.FLOAT,!1,0,0),o.drawArrays(o.TRIANGLES,0,this._vertexBuffer.numItems),o.depthFunc(o.LESS),o.enable(o.CULL_FACE)}_pickingPASS(){let e=this._renderer,t=e.handler;t.programs.labelPicking.activate();let i=t.programs.labelPicking._program,s=i.attributes,n=i.uniforms,o=t.gl,l=this._entityCollection,h=l.renderNode;o.disable(o.CULL_FACE),o.uniformMatrix4fv(n.viewMatrix,!1,e.activeCamera.getViewMatrix()),o.uniformMatrix4fv(n.projectionMatrix,!1,e.activeCamera.getProjectionMatrix()),o.uniform3fv(n.eyePositionHigh,e.activeCamera.eyeHigh),o.uniform3fv(n.eyePositionLow,e.activeCamera.eyeLow),o.uniform3fv(n.scaleByDistance,l.scaleByDistance),o.uniform1f(n.opacity,l._fadingOpacity),o.uniform1f(n.planetRadius,h._planetRadius2||0),o.uniform2fv(n.viewport,[t.canvas.clientWidth,t.canvas.clientHeight]),o.bindBuffer(o.ARRAY_BUFFER,this._texCoordBuffer),o.vertexAttribPointer(s.a_texCoord,this._texCoordBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._gliphParamBuffer),o.vertexAttribPointer(s.a_gliphParam,this._gliphParamBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._vertexBuffer),o.vertexAttribPointer(s.a_vertices,this._vertexBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._positionHighBuffer),o.vertexAttribPointer(s.a_positionsHigh,this._positionHighBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._positionLowBuffer),o.vertexAttribPointer(s.a_positionsLow,this._positionLowBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._sizeBuffer),o.vertexAttribPointer(s.a_size,this._sizeBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._rotationBuffer),o.vertexAttribPointer(s.a_rotation,this._rotationBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._offsetBuffer),o.vertexAttribPointer(s.a_offset,this._offsetBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._pickingColorBuffer),o.vertexAttribPointer(s.a_rgba,this._pickingColorBuffer.itemSize,o.FLOAT,!1,0,0),o.uniform1f(n.depthOffset,l.polygonOffsetUnits),o.drawArrays(o.TRIANGLES,0,this._vertexBuffer.numItems),o.enable(o.CULL_FACE)}_removeBillboard(e){let t=e._handlerIndex;this._billboards.splice(t,1);let i=24*this._maxLetters,s=t*i;this._rgbaArr=nt(this._rgbaArr,s,i),this._outlineColorArr=nt(this._outlineColorArr,s,i),this._texCoordArr=nt(this._texCoordArr,s,i),this._gliphParamArr=nt(this._gliphParamArr,s,i),i=18*this._maxLetters,s=t*i,this._positionHighArr=nt(this._positionHighArr,s,i),this._positionLowArr=nt(this._positionLowArr,s,i),this._offsetArr=nt(this._offsetArr,s,i),this._pickingColorArr=nt(this._pickingColorArr,s,i),i=12*this._maxLetters,s=t*i,this._vertexArr=nt(this._vertexArr,s,i),i=6*this._maxLetters,s=t*i,this._sizeArr=nt(this._sizeArr,s,i),this._rotationArr=nt(this._rotationArr,s,i),this._fontIndexArr=nt(this._fontIndexArr,s,i),this._outlineArr=nt(this._outlineArr,s,i),this.reindexBillboardsArray(t),this.refresh(),e._handlerIndex=-1,e._handler=null,e._isReady=!1}setText(e,t,i,s,n=0,o=!1){t=t.normalize("NFKC");let l=this._renderer.fontAtlas.atlasesArr[i];if(!l)return;let h=24*e*this._maxLetters,c=this._texCoordArr,d=this._gliphParamArr,u=0,f=Math.min(this._maxLetters,t.length),_=0;o&&(_=1);let g=0,v=l.kernings;for(u=0;u<f;u++){let p=h+24*u,y=t[u],b=l.get(y.charCodeAt(0))||l.get(32);if(!b)continue;let C=b.texCoords,T=b.metrics;c[p]=C[0],c[p+1]=C[1],c[p+2]=g,c[p+3]=_,c[p+4]=C[2],c[p+5]=C[3],c[p+6]=g,c[p+7]=_,c[p+8]=C[4],c[p+9]=C[5],c[p+10]=g,c[p+11]=_,c[p+12]=C[6],c[p+13]=C[7],c[p+14]=g,c[p+15]=_,c[p+16]=C[8],c[p+17]=C[9],c[p+18]=g,c[p+19]=_,c[p+20]=C[10],c[p+21]=C[11],c[p+22]=g,c[p+23]=_,d[p]=T.nWidth,d[p+1]=T.nHeight,d[p+2]=T.nXOffset,d[p+3]=T.nYOffset,d[p+4]=T.nWidth,d[p+5]=T.nHeight,d[p+6]=T.nXOffset,d[p+7]=T.nYOffset,d[p+8]=T.nWidth,d[p+9]=T.nHeight,d[p+10]=T.nXOffset,d[p+11]=T.nYOffset,d[p+12]=T.nWidth,d[p+13]=T.nHeight,d[p+14]=T.nXOffset,d[p+15]=T.nYOffset,d[p+16]=T.nWidth,d[p+17]=T.nHeight,d[p+18]=T.nXOffset,d[p+19]=T.nYOffset,d[p+20]=T.nWidth,d[p+21]=T.nHeight,d[p+22]=T.nXOffset,d[p+23]=T.nYOffset;let w=v[y.charCodeAt(0)];if(w&&t[u+1]){let L=w[t[u+1].charCodeAt(0)];g+=L?T.nAdvance+L+n:T.nAdvance+n}else g+=T.nAdvance+n}if(s===ui.CENTER)for(g*=-.5,u=0;u<f;u++){let p=h+24*u;c[p+2]+=g,c[p+6]+=g,c[p+10]+=g,c[p+14]+=g,c[p+18]+=g,c[p+22]+=g}for(;u<this._maxLetters;u++){let p=h+24*u;c[p+3]=-1,c[p+7]=-1,c[p+11]=-1,c[p+15]=-1,c[p+19]=-1,c[p+23]=-1}this._changedBuffers[6]=!0}setPositionArr(e,t,i){let s=18*e*this._maxLetters,n=this._positionHighArr,o=t.x,l=t.y,h=t.z,c=this._positionLowArr,d=i.x,u=i.y,f=i.z;for(let _=0;_<this._maxLetters;_++){let g=s+18*_;n[g]=o,n[g+1]=l,n[g+2]=h,n[g+3]=o,n[g+4]=l,n[g+5]=h,n[g+6]=o,n[g+7]=l,n[g+8]=h,n[g+9]=o,n[g+10]=l,n[g+11]=h,n[g+12]=o,n[g+13]=l,n[g+14]=h,n[g+15]=o,n[g+16]=l,n[g+17]=h,c[g]=d,c[g+1]=u,c[g+2]=f,c[g+3]=d,c[g+4]=u,c[g+5]=f,c[g+6]=d,c[g+7]=u,c[g+8]=f,c[g+9]=d,c[g+10]=u,c[g+11]=f,c[g+12]=d,c[g+13]=u,c[g+14]=f,c[g+15]=d,c[g+16]=u,c[g+17]=f}this._changedBuffers[1]=!0}setPickingColorArr(e,t){let i=18*e*this._maxLetters,s=this._pickingColorArr,n=t.x/255,o=t.y/255,l=t.z/255;for(let h=0;h<this._maxLetters;h++){let c=i+18*h;s[c]=n,s[c+1]=o,s[c+2]=l,s[c+3]=n,s[c+4]=o,s[c+5]=l,s[c+6]=n,s[c+7]=o,s[c+8]=l,s[c+9]=n,s[c+10]=o,s[c+11]=l,s[c+12]=n,s[c+13]=o,s[c+14]=l,s[c+15]=n,s[c+16]=o,s[c+17]=l}this._changedBuffers[0]=!0}setSizeArr(e,t){let i=6*e*this._maxLetters,s=this._sizeArr;for(let n=0;n<this._maxLetters;n++){let o=i+6*n;s[o]=t,s[o+1]=t,s[o+2]=t,s[o+3]=t,s[o+4]=t,s[o+5]=t}this._changedBuffers[2]=!0}setOffsetArr(e,t){let i=18*e*this._maxLetters,s=this._offsetArr,n=t.x,o=t.y,l=t.z;for(let h=0;h<this._maxLetters;h++){let c=i+18*h;s[c]=n,s[c+1]=o,s[c+2]=l,s[c+3]=n,s[c+4]=o,s[c+5]=l,s[c+6]=n,s[c+7]=o,s[c+8]=l,s[c+9]=n,s[c+10]=o,s[c+11]=l,s[c+12]=n,s[c+13]=o,s[c+14]=l,s[c+15]=n,s[c+16]=o,s[c+17]=l}this._changedBuffers[3]=!0}setRgbaArr(e,t){let i=24*e*this._maxLetters,s=this._rgbaArr,n=t.x,o=t.y,l=t.z,h=t.w;for(let c=0;c<this._maxLetters;c++){let d=i+24*c;s[d]=n,s[d+1]=o,s[d+2]=l,s[d+3]=h,s[d+4]=n,s[d+5]=o,s[d+6]=l,s[d+7]=h,s[d+8]=n,s[d+9]=o,s[d+10]=l,s[d+11]=h,s[d+12]=n,s[d+13]=o,s[d+14]=l,s[d+15]=h,s[d+16]=n,s[d+17]=o,s[d+18]=l,s[d+19]=h,s[d+20]=n,s[d+21]=o,s[d+22]=l,s[d+23]=h}this._changedBuffers[4]=!0}setOutlineColorArr(e,t){let i=24*e*this._maxLetters,s=this._outlineColorArr,n=t.x,o=t.y,l=t.z,h=t.w;for(let c=0;c<this._maxLetters;c++){let d=i+24*c;s[d]=n,s[d+1]=o,s[d+2]=l,s[d+3]=h,s[d+4]=n,s[d+5]=o,s[d+6]=l,s[d+7]=h,s[d+8]=n,s[d+9]=o,s[d+10]=l,s[d+11]=h,s[d+12]=n,s[d+13]=o,s[d+14]=l,s[d+15]=h,s[d+16]=n,s[d+17]=o,s[d+18]=l,s[d+19]=h,s[d+20]=n,s[d+21]=o,s[d+22]=l,s[d+23]=h}this._changedBuffers[10]=!0}setOutlineArr(e,t){let i=6*e*this._maxLetters,s=this._outlineArr;for(let n=0;n<this._maxLetters;n++){let o=i+6*n;s[o]=t,s[o+1]=t,s[o+2]=t,s[o+3]=t,s[o+4]=t,s[o+5]=t}this._changedBuffers[9]=!0}setRotationArr(e,t){let i=6*e*this._maxLetters,s=this._rotationArr;for(let n=0;n<this._maxLetters;n++){let o=i+6*n;s[o]=t,s[o+1]=t,s[o+2]=t,s[o+3]=t,s[o+4]=t,s[o+5]=t}this._changedBuffers[5]=!0}setVisibility(e,t){let i;i=t?[0,0,0,-1,1,-1,1,-1,1,0,0,0]:[0,0,0,0,0,0,0,0,0,0,0,0],this.setVertexArr(e,i)}setVertexArr(e,t){let i=12*e*this._maxLetters,s=this._vertexArr;for(let n=0;n<this._maxLetters;n++){let o=i+12*n;s[o]=t[0],s[o+1]=t[1],s[o+2]=t[2],s[o+3]=t[3],s[o+4]=t[4],s[o+5]=t[5],s[o+6]=t[6],s[o+7]=t[7],s[o+8]=t[8],s[o+9]=t[9],s[o+10]=t[10],s[o+11]=t[11]}this._changedBuffers[7]=!0}setFontIndexArr(e,t){let i=6*e*this._maxLetters,s=this._fontIndexArr;for(let n=0;n<this._maxLetters;n++){let o=i+6*n;s[o]=t,s[o+1]=t,s[o+2]=t,s[o+3]=t,s[o+4]=t,s[o+5]=t}this._changedBuffers[8]=!0}createSizeBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._sizeBuffer),this._sizeBuffer=e.createArrayBuffer(this._sizeArr,1,this._sizeArr.length)}createFontIndexBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._fontIndexBuffer),this._fontIndexBuffer=e.createArrayBuffer(this._fontIndexArr,1,this._fontIndexArr.length)}createTexCoordBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._texCoordBuffer),this._texCoordBuffer=e.createArrayBuffer(this._texCoordArr,4,this._texCoordArr.length/4),e.gl.deleteBuffer(this._gliphParamBuffer),this._gliphParamBuffer=e.createArrayBuffer(this._gliphParamArr,4,this._gliphParamArr.length/4)}createOutlineBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._outlineBuffer),this._outlineBuffer=e.createArrayBuffer(this._outlineArr,1,this._outlineArr.length)}createOutlineColorBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._outlineColorBuffer),this._outlineColorBuffer=e.createArrayBuffer(this._outlineColorArr,4,this._outlineColorArr.length/4)}setMaxLetters(e){this._maxLetters=e}}const ws=class G0{constructor(e){this.pickingEnabled=!0,this.__id=G0.__counter__++,this.pickingEnabled=!0,this._entityCollection=e,this._renderer=null,this._pointClouds=[]}_initProgram(){this._renderer&&this._renderer.handler&&(this._renderer.handler.programs.pointCloud||this._renderer.handler.addProgram(new $("pointCloud",{uniforms:{projectionViewMatrix:"mat4",opacity:"float",pointSize:"float"},attributes:{coordinates:"vec3",colors:"vec3"},vertexShader:`attribute vec3 coordinates;
            attribute vec4 colors;
            uniform mat4 projectionViewMatrix;
            uniform float opacity;
            uniform float pointSize;
            varying vec4 color;
            void main() {
                color = colors;
                color.a *= opacity;
                gl_Position = projectionViewMatrix * vec4(coordinates, 1.0);
                gl_PointSize = pointSize;
            }`,fragmentShader:`precision highp float;
            varying vec4 color;
            void main(void) {
                gl_FragColor = color;
            }`})))}setRenderNode(e){this._renderer=e.renderer,this._initProgram();for(let t=0;t<this._pointClouds.length;t++)this._pointClouds[t].setRenderNode(e)}add(e){e._handlerIndex===-1&&(e._handler=this,e._handlerIndex=this._pointClouds.length,this._pointClouds.push(e),this._entityCollection&&this._entityCollection.renderNode&&e.setRenderNode(this._entityCollection.renderNode))}remove(e){let t=e._handlerIndex;t!==-1&&(e._deleteBuffers(),e._handlerIndex=-1,e._handler=null,this._pointClouds.splice(t,1),this._reindexPointCloudArray(t))}_reindexPointCloudArray(e){let t=this._pointClouds;for(let i=e;i<t.length;i++)t[i]._handlerIndex=i}draw(){let e=this._pointClouds.length;for(;e--;)this._pointClouds[e].draw()}drawPicking(){if(this.pickingEnabled){let e=this._pointClouds.length;for(;e--;)this._pointClouds[e].drawPicking()}}clear(){let e=this._pointClouds.length;for(;e--;)this._pointClouds[e]._deleteBuffers(),this._pointClouds[e]._handler=null,this._pointClouds[e]._handlerIndex=-1;this._pointClouds.length=0,this._pointClouds=[]}};ws.__counter__=0;let Er=ws;const Ts=class j0{constructor(e){this.__id=j0.__counter__++,this._entityCollection=e,this._renderer=null,this._polylines=[],this.pickingEnabled=!0,this._relativeCenter=new m,this._rtcEyePositionHigh=new Float32Array([0,0,0]),this._rtcEyePositionLow=new Float32Array([0,0,0])}_initProgram(){this._renderer&&this._renderer.handler&&(this._renderer.handler.programs.polyline_screen||this._renderer.handler.addProgram(new $("polyline_screen",{uniforms:{viewport:"vec2",proj:"mat4",view:"mat4",rtcEyePositionHigh:"vec3",rtcEyePositionLow:"vec3",thickness:"float",opacity:"float",depthOffset:"float",visibleSphere:"vec4",texAtlas:"sampler2d",strokeSize:"float",texOffset:"float"},attributes:{prevHigh:"vec3",currentHigh:"vec3",nextHigh:"vec3",prevLow:"vec3",currentLow:"vec3",nextLow:"vec3",order:"float",color:"vec4",texCoord:"vec4"},vertexShader:`#version 300 es
precision highp float;in vec3 prevHigh;in vec3 currentHigh;in vec3 nextHigh;in vec3 prevLow;in vec3 currentLow;in vec3 nextLow;in vec4 texCoord;in float order;in vec4 color;uniform float thickness;uniform mat4 proj;uniform mat4 view;uniform vec2 viewport;uniform vec3 rtcEyePositionHigh;uniform vec3 rtcEyePositionLow;uniform float opacity;uniform float depthOffset;uniform float strokeSize;uniform float texOffset;out vec4 v_rgba;out vec3 vPos;out vec3 uCamPos;out vec4 vTexCoord;flat out float repeat;flat out float v_texOffset;const float NEAR=-1.0;vec2 getIntersection(vec2 start1,vec2 end1,vec2 start2,vec2 end2){vec2 dir=end2-start2;vec2 perp=vec2(-dir.y,dir.x);float d2=dot(perp,start2);float seg=dot(perp,start1)-d2;float prl=seg-dot(perp,end1)+d2;if(prl>-1.0&&prl<1.0){return start1;}float u=seg/prl;return start1+u*(end1-start1);}vec2 project(vec4 p){return(0.5*p.xyz/p.w+0.5).xy*viewport;}void main(){uCamPos=rtcEyePositionHigh+rtcEyePositionLow;vPos=currentHigh+currentLow;v_rgba=vec4(color.rgb,color.a*opacity);mat4 viewMatrixRTE=view;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);vec3 highDiff,lowDiff;highDiff=currentHigh-rtcEyePositionHigh;highDiff=highDiff*step(1.0,length(highDiff));lowDiff=currentLow-rtcEyePositionLow;vec4 vCurrent=viewMatrixRTE*vec4(highDiff+lowDiff,1.0);highDiff=prevHigh-rtcEyePositionHigh;highDiff=highDiff*step(1.0,length(highDiff));lowDiff=prevLow-rtcEyePositionLow;vec4 vPrev=viewMatrixRTE*vec4(highDiff+lowDiff,1.0);highDiff=nextHigh-rtcEyePositionHigh;highDiff=highDiff*step(1.0,length(highDiff));lowDiff=nextLow-rtcEyePositionLow;vec4 vNext=viewMatrixRTE*vec4(highDiff+lowDiff,1.0);if(vCurrent.z>NEAR){if(vPrev.z<NEAR&&abs(order)==1.0){vCurrent=vPrev+(vCurrent-vPrev)*(NEAR-vPrev.z)/(vCurrent.z-vPrev.z);}else if(vNext.z<NEAR&&abs(order)==2.0){vCurrent=vNext+(vCurrent-vNext)*(NEAR-vNext.z)/(vCurrent.z-vNext.z);}}vec4 dCurrent=proj*vCurrent;vec2 _next=project(proj*vNext);vec2 _prev=project(proj*vPrev);vec2 _current=project(dCurrent);if(_prev==_current){if(_next==_current){_next=_current+vec2(1.0,0.0);_prev=_current-_next;}else{_prev=_current+normalize(_current-_next);}}if(_next==_current){_next=_current+normalize(_current-_prev);}vec2 sNext=_next,sCurrent=_current,sPrev=_prev;vec2 dirNext=normalize(sNext-sCurrent);vec2 dirPrev=normalize(sPrev-sCurrent);float dotNP=dot(dirNext,dirPrev);vec2 normalNext=normalize(vec2(-dirNext.y,dirNext.x));vec2 normalPrev=normalize(vec2(dirPrev.y,-dirPrev.x));float d=thickness*sign(order);vTexCoord=texCoord;vec2 m;if(dotNP>=0.99991){m=sCurrent-normalPrev*d;}else{m=getIntersection(sCurrent+normalPrev*d,sPrev+normalPrev*d,sCurrent+normalNext*d,sNext+normalNext*d);if(dotNP>0.5&&dot(dirNext+dirPrev,m-sCurrent)<0.0){float occw=order*sign(dirNext.x*dirPrev.y-dirNext.y*dirPrev.x);if(occw==-1.0){m=sCurrent+normalPrev*d;}else if(occw==1.0){m=sCurrent+normalNext*d;}else if(occw==-2.0){m=sCurrent+normalNext*d;}else if(occw==2.0){m=sCurrent+normalPrev*d;}}else if(distance(sCurrent,m)>min(distance(sCurrent,sNext),distance(sCurrent,sPrev))){m=sCurrent+normalNext*d;}}repeat=min(distance(sCurrent,sPrev),viewport.y)/strokeSize;v_texOffset=texOffset;gl_Position=vec4((2.0*m/viewport-1.0)*dCurrent.w,dCurrent.z+depthOffset,dCurrent.w);}`,fragmentShader:`#version 300 es
precision highp float;uniform sampler2D texAtlas;uniform vec4 visibleSphere;in vec3 uCamPos;in vec4 v_rgba;in vec3 vPos;in vec4 vTexCoord;flat in float repeat;flat in float v_texOffset;out vec4 fragColor;void main(){if(visibleSphere.w!=0.0){vec3 cam_dir=normalize(vPos-uCamPos);vec3 sph_dir=normalize(vPos-visibleSphere.xyz);if(dot(cam_dir,sph_dir)>0.11){discard;}}float height=vTexCoord.w;if(height==0.0){fragColor=vec4(v_rgba.rgb,v_rgba.a);}else{vec2 uv=vTexCoord.xy;float min=vTexCoord.z;float EPS=0.5/1024.0;float localY=fract((uv.y+v_texOffset-min)/height*repeat);uv.y=clamp(min+localY*height,min+EPS,min+height-EPS);vec4 color=texture(texAtlas,uv);color.a*=v_rgba.a;fragColor=color;}}`})),this._renderer.handler.programs.polyline_picking||this._renderer.handler.addProgram(new $("polyline_picking",{uniforms:{viewport:"vec2",proj:"mat4",view:"mat4",rtcEyePositionHigh:"vec3",rtcEyePositionLow:"vec3",color:"vec4",thickness:"float",depthOffset:"float",visibleSphere:"vec4"},attributes:{prevHigh:"vec3",currentHigh:"vec3",nextHigh:"vec3",prevLow:"vec3",currentLow:"vec3",nextLow:"vec3",order:"float"},vertexShader:"precision highp float;attribute vec3 prevHigh;attribute vec3 currentHigh;attribute vec3 nextHigh;attribute vec3 prevLow;attribute vec3 currentLow;attribute vec3 nextLow;attribute float order;uniform float thickness;uniform vec4 color;uniform mat4 proj;uniform mat4 view;uniform vec2 viewport;uniform vec3 rtcEyePositionHigh;uniform vec3 rtcEyePositionLow;uniform float depthOffset;varying vec4 vColor;varying vec3 vPos;varying vec3 uCamPos;const float NEAR=-1.0;vec2 getIntersection(vec2 start1,vec2 end1,vec2 start2,vec2 end2){vec2 dir=end2-start2;vec2 perp=vec2(-dir.y,dir.x);float d2=dot(perp,start2);float seg=dot(perp,start1)-d2;float prl=seg-dot(perp,end1)+d2;if(prl>-1.0&&prl<1.0){return start1;}float u=seg/prl;return start1+u*(end1-start1);}vec2 project(vec4 p){return(0.5*p.xyz/p.w+0.5).xy*viewport;}void main(){uCamPos=rtcEyePositionHigh+rtcEyePositionLow;vPos=currentHigh+currentLow;vColor=color;vec3 highDiff,lowDiff;mat4 viewMatrixRTE=view;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);highDiff=currentHigh-rtcEyePositionHigh;highDiff=highDiff*step(1.0,length(highDiff));lowDiff=currentLow-rtcEyePositionLow;vec4 vCurrent=viewMatrixRTE*vec4(highDiff+lowDiff,1.0);highDiff=prevHigh-rtcEyePositionHigh;highDiff=highDiff*step(1.0,length(highDiff));lowDiff=prevLow-rtcEyePositionLow;vec4 vPrev=viewMatrixRTE*vec4(highDiff+lowDiff,1.0);highDiff=nextHigh-rtcEyePositionHigh;highDiff=highDiff*step(1.0,length(highDiff));lowDiff=nextLow-rtcEyePositionLow;vec4 vNext=viewMatrixRTE*vec4(highDiff+lowDiff,1.0);if(vCurrent.z>NEAR){if(vPrev.z<NEAR&&abs(order)==1.0){vCurrent=vPrev+(vCurrent-vPrev)*(NEAR-vPrev.z)/(vCurrent.z-vPrev.z);}else if(vNext.z<NEAR&&abs(order)==2.0){vCurrent=vNext+(vCurrent-vNext)*(NEAR-vNext.z)/(vCurrent.z-vNext.z);}}vec4 dCurrent=proj*vCurrent;vec2 _next=project(proj*vNext);vec2 _prev=project(proj*vPrev);vec2 _current=project(dCurrent);if(_prev==_current){if(_next==_current){_next=_current+vec2(1.0,0.0);_prev=_current-_next;}else{_prev=_current+normalize(_current-_next);}}if(_next==_current){_next=_current+normalize(_current-_prev);}vec2 sNext=_next,sCurrent=_current,sPrev=_prev;vec2 dirNext=normalize(sNext-sCurrent);vec2 dirPrev=normalize(sPrev-sCurrent);float dotNP=dot(dirNext,dirPrev);vec2 normalNext=normalize(vec2(-dirNext.y,dirNext.x));vec2 normalPrev=normalize(vec2(dirPrev.y,-dirPrev.x));float d=thickness*sign(order);vec2 m;if(dotNP>=0.99991){m=sCurrent-normalPrev*d;}else{m=getIntersection(sCurrent+normalPrev*d,sPrev+normalPrev*d,sCurrent+normalNext*d,sNext+normalNext*d);if(dotNP>0.5&&dot(dirNext+dirPrev,m-sCurrent)<0.0){float occw=order*sign(dirNext.x*dirPrev.y-dirNext.y*dirPrev.x);if(occw==-1.0){m=sCurrent+normalPrev*d;}else if(occw==1.0){m=sCurrent+normalNext*d;}else if(occw==-2.0){m=sCurrent+normalNext*d;}else if(occw==2.0){m=sCurrent+normalPrev*d;}}else if(distance(sCurrent,m)>min(distance(sCurrent,sNext),distance(sCurrent,sPrev))){m=sCurrent+normalNext*d;}}gl_Position=vec4((2.0*m/viewport-1.0)*dCurrent.w,dCurrent.z+depthOffset,dCurrent.w);}",fragmentShader:"precision highp float;uniform vec4 visibleSphere;varying vec3 uCamPos;varying vec4 vColor;varying vec3 vPos;void main(){if(visibleSphere.w!=0.0){vec3 cam_dir=normalize(vPos-uCamPos);vec3 sph_dir=normalize(vPos-visibleSphere.xyz);if(dot(cam_dir,sph_dir)>0.11){discard;}}gl_FragColor=vec4(vColor.rgb,vColor.a);}"})))}setRenderNode(e){this._renderer=e.renderer,this._initProgram();for(let t=0;t<this._polylines.length;t++)this._polylines[t].setRenderNode(e)}add(e){e._handlerIndex===-1&&(e._handler=this,e._handlerIndex=this._polylines.length,e.__doubleToTwoFloats=this.getRTCPosition.bind(this),this._polylines.push(e),this._entityCollection&&this._entityCollection.renderNode&&(e.setRenderNode(this._entityCollection.renderNode),e.updateRTCPosition()))}remove(e){let t=e._handlerIndex;t!==-1&&(e._deleteBuffers(),e._handlerIndex=-1,e._handler=null,this._polylines.splice(t,1),this.reindexPolylineArray(t))}reindexPolylineArray(e){let t=this._polylines;for(let i=e;i<t.length;i++)t[i]._handlerIndex=i}draw(){this._updateRTCEyePosition();let e=this._polylines.length;for(;e--;)this._polylines[e].draw()}drawPicking(){if(this.pickingEnabled){let e=this._polylines.length;for(;e--;)this._polylines[e].drawPicking()}}clear(){let e=this._polylines.length;for(;e--;)this._polylines[e]._deleteBuffers(),this._polylines[e]._handler=null,this._polylines[e]._handlerIndex=-1;this._polylines.length=0,this._polylines=[]}getRTCPosition(e,t,i){let s=e.sub(this._relativeCenter);m.doubleToTwoFloats(s,t,i)}setRelativeCenter(e){this._relativeCenter.copy(e);for(let t=0;t<this._polylines.length;t++)this._polylines[t].updateRTCPosition()}_updateRTCEyePosition(){let e=this._renderer;if(e.activeCamera.isFirstPass){let t=e.activeCamera.eye.sub(this._relativeCenter);m.doubleToTwoFloat32Array(t,this._rtcEyePositionHigh,this._rtcEyePositionLow)}}reloadTextures(){for(let e=0;e<this._polylines.length;e++){let t=this._polylines[e];t.setSrc(t.getSrc())}}get polylines(){return[...this._polylines]}refreshTexCoordsArr(){if(this._entityCollection&&this._renderer){let e=this._renderer.strokeTextureAtlas;for(let t=0;t<this._polylines.length;t++){let i=this._polylines[t],s=i.getImage();if(s){let n=e.get(s.__nodeIndex);n&&i._setTexCoordArr(n.texCoords)}}}}};Ts.__counter__=0;let Ar=Ts;const Cs=class q0{constructor(e){this.__id=q0.__counter__++,this.pickingEnabled=!0,this._entityCollection=e,this._renderer=null,this._rays=[],this._vertexBuffer=null,this._startPositionHighBuffer=null,this._startPositionLowBuffer=null,this._endPositionHighBuffer=null,this._endPositionLowBuffer=null,this._thicknessBuffer=null,this._rgbaBuffer=null,this._pickingColorBuffer=null,this._texCoordBuffer=null,this._texOffsetBuffer=null,this._strokeSizeBuffer=null,this._vertexArr=[],this._startPositionHighArr=[],this._startPositionLowArr=[],this._endPositionHighArr=[],this._endPositionLowArr=[],this._thicknessArr=[],this._rgbaArr=[],this._pickingColorArr=[],this._texCoordArr=new Float32Array([]),this._texOffsetArr=new Float32Array([]),this._strokeSizeArr=new Float32Array([]),this._buffersUpdateCallbacks=[],this._buffersUpdateCallbacks[5]=this.createVertexBuffer,this._buffersUpdateCallbacks[1]=this.createStartPositionBuffer,this._buffersUpdateCallbacks[2]=this.createEndPositionBuffer,this._buffersUpdateCallbacks[4]=this.createThicknessBuffer,this._buffersUpdateCallbacks[3]=this.createRgbaBuffer,this._buffersUpdateCallbacks[0]=this.createPickingColorBuffer,this._buffersUpdateCallbacks[6]=this.createTexCoordBuffer,this._buffersUpdateCallbacks[7]=this.createTexOffsetBuffer,this._buffersUpdateCallbacks[8]=this.createStrokeSizeBuffer,this._changedBuffers=new Array(this._buffersUpdateCallbacks.length)}static concArr(e,t){for(let i=0;i<t.length;i++)e.push(t[i])}reloadTextures(){for(let e=0;e<this._rays.length;e++){let t=this._rays[e];t.setSrc(t.getSrc())}}get rays(){return[...this._rays]}initProgram(){this._renderer&&this._renderer.handler&&(this._renderer.handler.programs.rayScreen||this._renderer.handler.addProgram(new $("rayScreen",{uniforms:{projectionMatrix:"mat4",viewMatrix:"mat4",eyePositionHigh:"vec3",eyePositionLow:"vec3",resolution:"float",uOpacity:"float",texAtlas:"sampler2d",viewport:"vec2"},attributes:{a_vertices:"vec2",a_texCoord:"vec4",a_startPosHigh:"vec3",a_startPosLow:"vec3",a_endPosHigh:"vec3",a_endPosLow:"vec3",a_thickness:"float",a_rgba:"vec4",a_texOffset:"float",a_strokeSize:"float"},vertexShader:`#version 300 es
precision highp float;in vec4 a_rgba;in vec3 a_startPosHigh;in vec3 a_startPosLow;in vec3 a_endPosHigh;in vec3 a_endPosLow;in vec2 a_vertices;in float a_thickness;in vec4 a_texCoord;in float a_texOffset;in float a_strokeSize;out vec4 v_rgba;out vec4 v_texCoord;out float v_texOffset;flat out float repeat;uniform mat4 viewMatrix;uniform mat4 projectionMatrix;uniform vec3 eyePositionHigh;uniform vec3 eyePositionLow;uniform float resolution;uniform float uOpacity;uniform vec2 viewport;vec2 project(vec4 p){return(0.5*p.xyz/p.w+0.5).xy*viewport;}void main(){v_texOffset=a_texOffset;v_rgba=vec4(a_rgba.rgb,a_rgba.a*uOpacity);v_texCoord=a_texCoord;vec3 v=(a_endPosHigh-a_startPosHigh)+(a_endPosLow-a_startPosLow);vec3 look=(a_startPosHigh-eyePositionHigh)+(a_startPosLow-eyePositionLow)+v*a_vertices.y;vec3 up=normalize(v);vec3 right=normalize(cross(look,up));float dist=abs(dot(look,vec3(viewMatrix[0][2],viewMatrix[1][2],viewMatrix[2][2])));float focalSize=2.0*dist*resolution;vec3 vert=right*a_thickness*focalSize*a_vertices.x;vec3 highDiff;if(a_vertices.y==0.0){highDiff=a_startPosHigh-eyePositionHigh;vert+=a_startPosLow-eyePositionLow;}else{highDiff=a_endPosHigh-eyePositionHigh;vert+=a_endPosLow-eyePositionLow;}mat4 viewMatrixRTE=viewMatrix;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);gl_Position=projectionMatrix*viewMatrixRTE*vec4(highDiff*step(1.0,length(highDiff))+vert,1.0);highDiff=a_startPosHigh-eyePositionHigh;highDiff=highDiff*step(1.0,length(highDiff));vec3 lowDiff=a_startPosLow-eyePositionLow;vec4 vStart=viewMatrixRTE*vec4(highDiff+lowDiff,1.0);highDiff=a_endPosHigh-eyePositionHigh;highDiff=highDiff*step(1.0,length(highDiff));lowDiff=a_endPosLow-eyePositionLow;vec4 vEnd=viewMatrixRTE*vec4(highDiff+lowDiff,1.0);vec2 nStart=project(projectionMatrix*vStart);vec2 nEnd=project(projectionMatrix*vEnd);repeat=min(distance(nStart,nEnd),viewport.y)/a_strokeSize;}`,fragmentShader:`#version 300 es
precision highp float;uniform sampler2D texAtlas;in vec4 v_rgba;in vec4 v_texCoord;in float v_texOffset;flat in float repeat;out vec4 fragColor;void main(){float height=v_texCoord.w;if(height==0.0){fragColor=v_rgba;}else{vec2 uv=v_texCoord.xy;float min=v_texCoord.z;float EPS=0.5/1024.0;float localY=fract((uv.y+v_texOffset-min)/height*repeat);uv.y=clamp(min+localY*height,min+EPS,min+height-EPS);vec4 color=texture(texAtlas,uv);fragColor=v_rgba*color;}}`})))}setRenderer(e){this._renderer=e,this.initProgram()}refresh(){let e=this._changedBuffers.length;for(;e--;)this._changedBuffers[e]=!0}_removeRays(){let e=this._rays.length;for(;e--;){let t=this._rays[e];t._handlerIndex=-1,t._handler=null}this._rays.length=0,this._rays=[]}clear(){this._vertexArr=null,this._startPositionHighArr=null,this._startPositionLowArr=null,this._endPositionHighArr=null,this._endPositionLowArr=null,this._thicknessArr=null,this._rgbaArr=null,this._texCoordArr=null,this._texOffsetArr=null,this._strokeSizeArr=null,this._vertexArr=new Float32Array([]),this._texCoordArr=new Float32Array([]),this._startPositionHighArr=new Float32Array([]),this._startPositionLowArr=new Float32Array([]),this._endPositionHighArr=new Float32Array([]),this._endPositionLowArr=new Float32Array([]),this._thicknessArr=new Float32Array([]),this._rgbaArr=new Float32Array([]),this._texOffsetArr=new Float32Array([]),this._strokeSizeArr=new Float32Array([]),this._removeRays(),this._deleteBuffers(),this.refresh()}_deleteBuffers(){if(this._renderer){let e=this._renderer.handler.gl;e&&(e.deleteBuffer(this._startPositionHighBuffer),e.deleteBuffer(this._startPositionLowBuffer),e.deleteBuffer(this._endPositionHighBuffer),e.deleteBuffer(this._endPositionLowBuffer),e.deleteBuffer(this._thicknessBuffer),e.deleteBuffer(this._rgbaBuffer),e.deleteBuffer(this._vertexBuffer),e.deleteBuffer(this._texCoordBuffer),e.deleteBuffer(this._texOffsetBuffer),e.deleteBuffer(this._strokeSizeBuffer)),this._startPositionHighBuffer=null,this._startPositionLowBuffer=null,this._endPositionHighBuffer=null,this._endPositionLowBuffer=null,this._thicknessBuffer=null,this._rgbaBuffer=null,this._vertexBuffer=null,this._texCoordBuffer=null,this._texOffsetBuffer=null,this._strokeSizeBuffer=null}}update(){if(this._renderer){let e=this._changedBuffers.length;for(;e--;)this._changedBuffers[e]&&(this._buffersUpdateCallbacks[e].call(this),this._changedBuffers[e]=!1)}}add(e){e._handlerIndex==-1&&(e._handler=this,e._handlerIndex=this._rays.length,this._rays.push(e),this._addRayToArrays(e),this.refresh())}_addRayToArrays(e){e.getVisibility()?this._vertexArr=xt(this._vertexArr,[-.5,1,-.5,0,.5,0,.5,0,.5,1,-.5,1]):this._vertexArr=xt(this._vertexArr,[0,0,0,0,0,0,0,0,0,0,0,0]);let t=e.texOffset;this._texOffsetArr=et(this._texOffsetArr,[t,t,t,t,t,t]),t=e.strokeSize,this._strokeSizeArr=et(this._strokeSizeArr,[t,t,t,t,t,t]),this._texCoordArr=et(this._texCoordArr,[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),t=e._startPositionHigh.x;let i=e._startPositionHigh.y,s=e._startPositionHigh.z;this._startPositionHighArr=xt(this._startPositionHighArr,[t,i,s,t,i,s,t,i,s,t,i,s,t,i,s,t,i,s]),t=e._startPositionLow.x,i=e._startPositionLow.y,s=e._startPositionLow.z,this._startPositionLowArr=xt(this._startPositionLowArr,[t,i,s,t,i,s,t,i,s,t,i,s,t,i,s,t,i,s]),t=e._endPositionHigh.x,i=e._endPositionHigh.y,s=e._endPositionHigh.z,this._endPositionHighArr=xt(this._endPositionHighArr,[t,i,s,t,i,s,t,i,s,t,i,s,t,i,s,t,i,s]),t=e._endPositionLow.x,i=e._endPositionLow.y,s=e._endPositionLow.z,this._endPositionLowArr=xt(this._endPositionLowArr,[t,i,s,t,i,s,t,i,s,t,i,s,t,i,s,t,i,s]),t=e._thickness,this._thicknessArr=xt(this._thicknessArr,[t,t,t,t,t,t]);let n=e._startColor.x,o=e._startColor.y,l=e._startColor.z,h=e._startColor.w,c=e._endColor.x,d=e._endColor.y,u=e._endColor.z,f=e._endColor.w;this._rgbaArr=xt(this._rgbaArr,[c,d,u,f,n,o,l,h,n,o,l,h,n,o,l,h,c,d,u,f,c,d,u,f]),t=e._entity._pickingColor.x/255,i=e._entity._pickingColor.y/255,s=e._entity._pickingColor.z/255,this._pickingColorArr=xt(this._pickingColorArr,[t,i,s,t,i,s,t,i,s,t,i,s,t,i,s,t,i,s])}_displayPASS(){let e=this._renderer,t=e.handler;t.programs.rayScreen.activate();let i=t.programs.rayScreen._program,s=i.attributes,n=i.uniforms,o=t.gl,l=this._entityCollection;o.disable(o.CULL_FACE),o.uniform1f(n.uOpacity,l._fadingOpacity),o.uniform1i(n.u_texAtlas,0),o.uniformMatrix4fv(n.viewMatrix,!1,e.activeCamera.getViewMatrix()),o.uniformMatrix4fv(n.projectionMatrix,!1,e.activeCamera.getProjectionMatrix()),o.uniform3fv(n.eyePositionHigh,e.activeCamera.eyeHigh),o.uniform3fv(n.eyePositionLow,e.activeCamera.eyeLow),o.uniform1f(n.resolution,e.activeCamera._tanViewAngle_hradOneByHeight),o.uniform2fv(n.viewport,[e.handler.canvas.width,e.handler.canvas.height]),o.bindBuffer(o.ARRAY_BUFFER,this._startPositionHighBuffer),o.vertexAttribPointer(s.a_startPosHigh,this._startPositionHighBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._startPositionLowBuffer),o.vertexAttribPointer(s.a_startPosLow,this._startPositionLowBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._endPositionHighBuffer),o.vertexAttribPointer(s.a_endPosHigh,this._endPositionHighBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._endPositionLowBuffer),o.vertexAttribPointer(s.a_endPosLow,this._endPositionLowBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._rgbaBuffer),o.vertexAttribPointer(s.a_rgba,this._rgbaBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._thicknessBuffer),o.vertexAttribPointer(s.a_thickness,this._thicknessBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._vertexBuffer),o.vertexAttribPointer(s.a_vertices,this._vertexBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._texCoordBuffer),o.vertexAttribPointer(s.a_texCoord,this._texCoordBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._texOffsetBuffer),o.vertexAttribPointer(s.a_texOffset,this._texOffsetBuffer.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this._strokeSizeBuffer),o.vertexAttribPointer(s.a_strokeSize,this._strokeSizeBuffer.itemSize,o.FLOAT,!1,0,0),o.drawArrays(o.TRIANGLES,0,this._vertexBuffer.numItems),o.enable(o.CULL_FACE)}_pickingPASS(){}draw(){this._rays.length&&(this.update(),this._displayPASS())}drawPicking(){this._rays.length&&this.pickingEnabled&&this._pickingPASS()}reindexRaysArray(e){let t=this._rays;for(let i=e;i<t.length;i++)t[i]._handlerIndex=i}_removeRay(e){let t=e._handlerIndex;this._rays.splice(t,1);let i=24*t;this._rgbaArr=Ct(this._rgbaArr,i,24),this._texCoordArr=nt(this._texCoordArr,i,24),i=18*t,this._startPositionHighArr=Ct(this._startPositionHighArr,i,18),this._startPositionLowArr=Ct(this._startPositionLowArr,i,18),this._endPositionHighArr=Ct(this._endPositionHighArr,i,18),this._endPositionLowArr=Ct(this._endPositionLowArr,i,18),this._pickingColorArr=Ct(this._pickingColorArr,i,18),i=12*t,this._vertexArr=Ct(this._vertexArr,i,12),i=6*t,this._thicknessArr=Ct(this._thicknessArr,i,6),this._texOffsetArr=nt(this._texOffsetArr,i,6),this._strokeSizeArr=nt(this._strokeSizeArr,i,6),this.reindexRaysArray(t),this.refresh(),e._handlerIndex=-1,e._handler=null}remove(e){e._handler&&this.__id===e._handler.__id&&this._removeRay(e)}setStartPositionArr(e,t,i){let s=18*e,n=this._startPositionHighArr,o=t.x,l=t.y,h=t.z;n[s]=o,n[s+1]=l,n[s+2]=h,n[s+3]=o,n[s+4]=l,n[s+5]=h,n[s+6]=o,n[s+7]=l,n[s+8]=h,n[s+9]=o,n[s+10]=l,n[s+11]=h,n[s+12]=o,n[s+13]=l,n[s+14]=h,n[s+15]=o,n[s+16]=l,n[s+17]=h,n=this._startPositionLowArr,o=i.x,l=i.y,h=i.z,n[s]=o,n[s+1]=l,n[s+2]=h,n[s+3]=o,n[s+4]=l,n[s+5]=h,n[s+6]=o,n[s+7]=l,n[s+8]=h,n[s+9]=o,n[s+10]=l,n[s+11]=h,n[s+12]=o,n[s+13]=l,n[s+14]=h,n[s+15]=o,n[s+16]=l,n[s+17]=h,this._changedBuffers[1]=!0}setEndPositionArr(e,t,i){let s=18*e,n=this._endPositionHighArr,o=t.x,l=t.y,h=t.z;n[s]=o,n[s+1]=l,n[s+2]=h,n[s+3]=o,n[s+4]=l,n[s+5]=h,n[s+6]=o,n[s+7]=l,n[s+8]=h,n[s+9]=o,n[s+10]=l,n[s+11]=h,n[s+12]=o,n[s+13]=l,n[s+14]=h,n[s+15]=o,n[s+16]=l,n[s+17]=h,n=this._endPositionLowArr,o=i.x,l=i.y,h=i.z,n[s]=o,n[s+1]=l,n[s+2]=h,n[s+3]=o,n[s+4]=l,n[s+5]=h,n[s+6]=o,n[s+7]=l,n[s+8]=h,n[s+9]=o,n[s+10]=l,n[s+11]=h,n[s+12]=o,n[s+13]=l,n[s+14]=h,n[s+15]=o,n[s+16]=l,n[s+17]=h,this._changedBuffers[2]=!0}setPickingColorArr(e,t){let i=18*e,s=this._pickingColorArr,n=t.x/255,o=t.y/255,l=t.z/255;s[i]=n,s[i+1]=o,s[i+2]=l,s[i+3]=n,s[i+4]=o,s[i+5]=l,s[i+6]=n,s[i+7]=o,s[i+8]=l,s[i+9]=n,s[i+10]=o,s[i+11]=l,s[i+12]=n,s[i+13]=o,s[i+14]=l,s[i+15]=n,s[i+16]=o,s[i+17]=l,this._changedBuffers[0]=!0}setRgbaArr(e,t,i){let s=24*e,n=this._rgbaArr,o=t.x,l=t.y,h=t.z,c=t.w,d=i.x,u=i.y,f=i.z,_=i.w;n[s]=d,n[s+1]=u,n[s+2]=f,n[s+3]=_,n[s+4]=o,n[s+5]=l,n[s+6]=h,n[s+7]=c,n[s+8]=o,n[s+9]=l,n[s+10]=h,n[s+11]=c,n[s+12]=o,n[s+13]=l,n[s+14]=h,n[s+15]=c,n[s+16]=d,n[s+17]=u,n[s+18]=f,n[s+19]=_,n[s+20]=d,n[s+21]=u,n[s+22]=f,n[s+23]=_,this._changedBuffers[3]=!0}setThicknessArr(e,t){let i=6*e,s=this._thicknessArr;s[i]=t,s[i+1]=t,s[i+2]=t,s[i+3]=t,s[i+4]=t,s[i+5]=t,this._changedBuffers[4]=!0}setVisibility(e,t){let i;i=t?[-.5,1,-.5,0,.5,0,.5,0,.5,1,-.5,1]:[0,0,0,0,0,0,0,0,0,0,0,0],this.setVertexArr(e,i)}setVertexArr(e,t){let i=12*e,s=this._vertexArr;s[i]=t[0],s[i+1]=t[1],s[i+2]=t[2],s[i+3]=t[3],s[i+4]=t[4],s[i+5]=t[5],s[i+6]=t[6],s[i+7]=t[7],s[i+8]=t[8],s[i+9]=t[9],s[i+10]=t[10],s[i+11]=t[11],this._changedBuffers[5]=!0}createStartPositionBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._startPositionHighBuffer),this._startPositionHighArr=it(this._startPositionHighArr),this._startPositionHighBuffer=e.createArrayBuffer(this._startPositionHighArr,3,this._startPositionHighArr.length/3,e.gl.DYNAMIC_DRAW),e.gl.deleteBuffer(this._startPositionLowBuffer),this._startPositionLowArr=it(this._startPositionLowArr),this._startPositionLowBuffer=e.createArrayBuffer(this._startPositionLowArr,3,this._startPositionLowArr.length/3,e.gl.DYNAMIC_DRAW)}createEndPositionBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._endPositionHighBuffer),this._endPositionHighArr=it(this._endPositionHighArr),this._endPositionHighBuffer=e.createArrayBuffer(this._endPositionHighArr,3,this._endPositionHighArr.length/3,e.gl.DYNAMIC_DRAW),e.gl.deleteBuffer(this._endPositionLowBuffer),this._endPositionLowArr=it(this._endPositionLowArr),this._endPositionLowBuffer=e.createArrayBuffer(this._endPositionLowArr,3,this._endPositionLowArr.length/3,e.gl.DYNAMIC_DRAW)}createRgbaBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._rgbaBuffer),this._rgbaArr=it(this._rgbaArr),this._rgbaBuffer=e.createArrayBuffer(this._rgbaArr,4,this._rgbaArr.length/4)}createThicknessBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._thicknessBuffer),this._thicknessArr=it(this._thicknessArr),this._thicknessBuffer=e.createArrayBuffer(this._thicknessArr,1,this._thicknessArr.length,e.gl.DYNAMIC_DRAW)}createVertexBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._vertexBuffer),this._vertexArr=it(this._vertexArr),this._vertexBuffer=e.createArrayBuffer(this._vertexArr,2,this._vertexArr.length/2,e.gl.DYNAMIC_DRAW)}createTexCoordBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._texCoordBuffer),this._texCoordBuffer=e.createArrayBuffer(this._texCoordArr,4,this._texCoordArr.length/4)}createTexOffsetBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._texOffsetBuffer),this._texOffsetBuffer=e.createArrayBuffer(this._texOffsetArr,1,this._texOffsetArr.length)}createStrokeSizeBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._strokeSizeBuffer),this._strokeSizeBuffer=e.createArrayBuffer(this._strokeSizeArr,1,this._strokeSizeArr.length)}createPickingColorBuffer(){let e=this._renderer.handler;e.gl.deleteBuffer(this._pickingColorBuffer),this._pickingColorArr=it(this._pickingColorArr),this._pickingColorBuffer=e.createArrayBuffer(this._pickingColorArr,3,this._pickingColorArr.length/3)}setTexCoordArr(e,t){let i=t[1],s=t[3]-i,n=24*e,o=this._texCoordArr;o[n]=t[0],o[n+1]=t[1],o[n+2]=i,o[n+3]=s,o[n+4]=t[2],o[n+5]=t[3],o[n+6]=i,o[n+7]=s,o[n+8]=t[4],o[n+9]=t[5],o[n+10]=i,o[n+11]=s,o[n+12]=t[6],o[n+13]=t[7],o[n+14]=i,o[n+15]=s,o[n+16]=t[8],o[n+17]=t[9],o[n+18]=i,o[n+19]=s,o[n+20]=t[10],o[n+21]=t[11],o[n+22]=i,o[n+23]=s,this._changedBuffers[6]=!0}setTextureDisabled(e){let t=24*e,i=this._texCoordArr;i[t+3]=0,i[t+7]=0,i[t+11]=0,i[t+15]=0,i[t+19]=0,i[t+23]=0,this._changedBuffers[6]=!0}setTexOffsetArr(e,t){let i=6*e,s=this._texOffsetArr;s[i]=t,s[i+1]=t,s[i+2]=t,s[i+3]=t,s[i+4]=t,s[i+5]=t,this._changedBuffers[7]=!0}setStrokeSizeArr(e,t){let i=6*e,s=this._strokeSizeArr;s[i]=t,s[i+1]=t,s[i+2]=t,s[i+3]=t,s[i+4]=t,s[i+5]=t,this._changedBuffers[8]=!0}refreshTexCoordsArr(){if(this._entityCollection&&this._renderer){let e=this._renderer.strokeTextureAtlas;for(let t=0;t<this._rays.length;t++){let i=this._rays[t],s=i.getImage();if(s){let n=e.get(s.__nodeIndex);n&&this.setTexCoordArr(i._handlerIndex,n.texCoords)}}}}};Cs.__counter__=0;let Lr=Cs;const Es=class Y0{constructor(e){this.__id=Y0.__counter__++,this.pickingEnabled=!0,this._entityCollection=e,this._renderer=null,this._strips=[]}_initProgram(){this._renderer&&this._renderer.handler&&!this._renderer.handler.programs.strip&&this._renderer.handler.addProgram(new $("strip",{uniforms:{projectionMatrix:{type:"mat4"},viewMatrix:{type:"mat4"},eyePositionHigh:"vec3",eyePositionLow:"vec3",uColor:{type:"vec4"},uOpacity:{type:"float"}},attributes:{aVertexPositionHigh:{type:"vec3"},aVertexPositionLow:{type:"vec3"}},vertexShader:`attribute vec3 aVertexPositionHigh;
                        attribute vec3 aVertexPositionLow;
                        uniform mat4 projectionMatrix;
                        uniform mat4 viewMatrix;
                        uniform vec3 eyePositionHigh;
                        uniform vec3 eyePositionLow;
                        void main(void) {

                            vec3 highDiff = aVertexPositionHigh - eyePositionHigh;
                            vec3 lowDiff = aVertexPositionLow - eyePositionLow;

                            mat4 viewMatrixRTE = viewMatrix;
                            viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);

                            gl_Position = projectionMatrix * viewMatrixRTE * vec4(highDiff * step(1.0, length(highDiff)) + lowDiff, 1.0);
                        }`,fragmentShader:`precision highp float;
                        uniform vec4 uColor;
                        uniform float uOpacity;
                        void main(void) {
                            gl_FragColor = vec4(uColor.rgb, uColor.a * uOpacity);
                        }`}))}setRenderNode(e){this._renderer=e.renderer,this._initProgram();for(let t=0;t<this._strips.length;t++)this._strips[t].setRenderNode(e)}add(e){e._handlerIndex===-1&&(e._handler=this,e._handlerIndex=this._strips.length,this._strips.push(e),this._entityCollection&&this._entityCollection.renderNode&&e.setRenderNode(this._entityCollection.renderNode))}remove(e){let t=e._handlerIndex;t!==-1&&(e._deleteBuffers(),e._handlerIndex=-1,e._handler=null,this._strips.splice(t,1),this.reindexStripArray(t))}reindexStripArray(e){let t=this._strips;for(let i=e;i<t.length;i++)t[i]._handlerIndex=i}draw(){let e=this._strips.length;for(;e--;)this._strips[e].draw()}drawPicking(){if(this.pickingEnabled){let e=this._strips.length;for(;e--;)this._strips[e].drawPicking()}}clear(){let e=this._strips.length;for(;e--;)this._strips[e]._deleteBuffers(),this._strips[e]._handler=null,this._strips[e]._handlerIndex=-1;this._strips.length=0,this._strips=[]}};Es.__counter__=0;let Pr=Es;const As=class W0{constructor(e={}){this._onChangeRelativeCenter=i=>{this.geoObjectHandler.setRelativeCenter(i),this.polylineHandler.setRelativeCenter(i)},this.__id=W0.__counter__++,this.renderNode=null,this._visibility=e.visibility==null||e.visibility,this.polygonOffsetUnits=e.polygonOffsetUnits!=null?e.polygonOffsetUnits:0,this.billboardHandler=new el(this),this.labelHandler=new sl(this,e.labelMaxLetters),this.polylineHandler=new Ar(this),this.rayHandler=new Lr(this),this.pointCloudHandler=new Er(this),this.stripHandler=new Pr(this),this.geoObjectHandler=new Cr(this),e.pickingEnabled!=null&&this.setPickingEnabled(e.pickingEnabled),this._entities=[],this.scaleByDistance=e.scaleByDistance||[1,1,1];let t=new Float32Array([1,1,1]);e.pickingScale!==void 0&&(e.pickingScale instanceof Array?(t[0]=e.pickingScale[0]||t[0],t[1]=e.pickingScale[1]||t[1],t[2]=e.pickingScale[2]||t[2]):typeof e.pickingScale=="number"&&(t[0]=e.pickingScale,t[1]=e.pickingScale,t[2]=e.pickingScale)),this._depthOrder=e.depthOrder||0,this.pickingScale=t,this._opacity=e.opacity==null?1:e.opacity,this._fadingOpacity=this._opacity,this.events=this.rendererEvents=at(rl,this),this._useLighting=e.useLighting!=null?e.useLighting?1:0:1,e.entities&&this.addEntities(e.entities)}get depthOrder(){return this._depthOrder}set depthOrder(e){this._depthOrder=e,this.renderNode&&this.renderNode.updateEntityCollectionsDepthOrder()}isEmpty(){return this._entities.length==0}get id(){return this.__id}get useLighting(){return!!this._useLighting}set useLighting(e){this._useLighting=Number(e)}isEqual(e){return e!==null&&this.__id===e.__id}setVisibility(e){var t;this._visibility=e,this._fadingOpacity=this._opacity*(e?1:0),(t=this.renderNode)==null||t.updateEntityCollectionsDepthOrder(),this.events.dispatch(this.events.visibilitychange,this)}getVisibility(){return this._visibility}setOpacity(e){this._opacity=e}setPickingEnabled(e){this.billboardHandler.pickingEnabled=e,this.labelHandler.pickingEnabled=e,this.polylineHandler.pickingEnabled=e,this.rayHandler.pickingEnabled=e,this.pointCloudHandler.pickingEnabled=e,this.stripHandler.pickingEnabled=e,this.geoObjectHandler.pickingEnabled=e}getOpacity(){return this._opacity}setScaleByDistance(e,t,i){this.scaleByDistance[0]=e,this.scaleByDistance[1]=t,this.scaleByDistance[2]=i||Ee}appendChildEntity(e){this._addRecursively(e)}_addRecursively(e){let t=this.renderNode;t&&t.ellipsoid&&e._cartesian.isZero()&&!e.relativePosition&&e.setCartesian3v(t.ellipsoid.lonLatToCartesian(e._lonLat)),this._setPickingColor(e),e._updateAbsolutePosition(),e.setScale3v(e.getScale()),e.billboard&&this.billboardHandler.add(e.billboard),e.label&&this.labelHandler.add(e.label),e.polyline&&this.polylineHandler.add(e.polyline),e.ray&&this.rayHandler.add(e.ray),e.pointCloud&&this.pointCloudHandler.add(e.pointCloud),e.strip&&this.stripHandler.add(e.strip),e.geoObject&&this.geoObjectHandler.add(e.geoObject),this.events.dispatch(this.events.entityadd,e);for(let i=0;i<e.childEntities.length;i++)e.childEntities[i]._entityCollection=this,this._addRecursively(e.childEntities[i])}add(e){return e._entityCollection||(e._entityCollection=this,e._entityCollectionIndex=this._entities.length,this._entities.push(e),this._addRecursively(e)),this}addEntities(e){for(let t=0,i=e.length;t<i;t++)this.add(e[t]);return this}belongs(e){return this.isEqual(e._entityCollection)}_removeRecursively(e){e._entityCollection=null,e._entityCollectionIndex=-1,e.billboard&&this.billboardHandler.remove(e.billboard),e.label&&this.labelHandler.remove(e.label),e.polyline&&this.polylineHandler.remove(e.polyline),e.ray&&this.rayHandler.remove(e.ray),e.pointCloud&&this.pointCloudHandler.remove(e.pointCloud),e.strip&&this.stripHandler.remove(e.strip),e.geoObject&&this.geoObjectHandler.remove(e.geoObject);for(let t=0;t<e.childEntities.length;t++)this._removeRecursively(e.childEntities[t])}_removeEntity(e){if(e.parent){let t=e.parent.childEntities;for(let i=0,s=t.length;i<s;i++)if(t[i].isEqual(e)){t.splice(i,1);break}e.parent=null}else this._entities.splice(e._entityCollectionIndex,1),this.reindexEntitiesArray(e._entityCollectionIndex);this.renderNode&&this.renderNode.renderer&&(this.renderNode.renderer.clearPickingColor(e),e._pickingColor.clear()),this._removeRecursively(e)}removeEntity(e){this.belongs(e)&&(this._removeEntity(e),this.events.dispatch(this.events.entityremove,e))}_removeEntitySilent(e){this.belongs(e)&&this._removeEntity(e)}createPickingColors(e=this._entities){if(this.renderNode&&this.renderNode.renderer)for(let t=0;t<e.length;t++){let i=e[t];this._setPickingColor(i),this.createPickingColors(i.childEntities)}}_setPickingColor(e){this.renderNode&&this.renderNode.renderer&&(e._independentPicking||!e.parent?this.renderNode.renderer.assignPickingColor(e):e._pickingColor=e.parent._pickingColor,this.renderNode.renderer.assignPickingColor(e),e.setPickingColor())}reindexEntitiesArray(e){let t=this._entities;for(let i=e;i<t.length;i++)t[i]._entityCollectionIndex=i}addTo(e,t=!1){return this.renderNode||e.addEntityCollection(this,t),this}bindRenderNode(e){e.renderer&&e.renderer.isInitialized()&&(this.billboardHandler.setRenderer(e.renderer),this.labelHandler.setRenderer(e.renderer),this.rayHandler.setRenderer(e.renderer),this.geoObjectHandler.setRenderNode(e),this.polylineHandler.setRenderNode(e),this.pointCloudHandler.setRenderNode(e),this.stripHandler.setRenderNode(e),e.renderer.events.on("changerelativecenter",this._onChangeRelativeCenter),this.updateBillboardsTextureAtlas(),this.updateLabelsFontAtlas(),this.updateStrokeTextureAtlas(),this.createPickingColors())}_updateGeodeticCoordinates(e){let t=this._entities,i=t.length;for(;i--;){let s=t[i];s._lonLat&&s.setCartesian3v(e.lonLatToCartesian(s._lonLat))}}updateBillboardsTextureAtlas(){let e=this.billboardHandler.billboards;for(let t=0;t<e.length;t++)e[t].setSrc(e[t].getSrc())}updateLabelsFontAtlas(){this.renderNode&&this.labelHandler.updateFonts()}updateStrokeTextureAtlas(){this.rayHandler.reloadTextures(),this.polylineHandler.reloadTextures()}remove(){var e;this.renderNode&&(this.renderNode.removeEntityCollection(this),(e=this.renderNode.renderer)==null||e.events.off("changerelativecenter",this._onChangeRelativeCenter),this.renderNode=null,this.events.dispatch(this.events.remove,this))}getEntities(){return[].concat(this._entities)}each(e){let t=this._entities.length;for(;t--;){let i=this._entities[t];i&&e(i)}}clear(){this.billboardHandler.clear(),this.labelHandler.clear(),this.polylineHandler.clear(),this.rayHandler.clear(),this.pointCloudHandler.clear(),this.stripHandler.clear(),this.geoObjectHandler.clear();let e=this._entities.length;for(;e--;){let t=this._entities[e];this.renderNode&&this.renderNode.renderer&&(this.renderNode.renderer.clearPickingColor(t),t._pickingColor.clear()),this._clearEntity(t)}this._entities.length=0,this._entities=[]}_clearEntity(e){e._entityCollection=null,e._entityCollectionIndex=-1;for(let t=0;t<e.childEntities.length;t++)this._clearEntity(e.childEntities[t])}};As.__counter__=0;let ie=As;const rl=["draw","drawend","add","remove","entityadd","entityremove","visibilitychange","mousemove","mouseenter","mouseleave","lclick","rclick","mclick","ldblclick","rdblclick","mdblclick","lup","rup","mup","ldown","rdown","mdown","lhold","rhold","mhold","mousewheel","touchmove","touchstart","touchend","doubletouch","touchleave","touchenter"];function oe(a,e){if(a>=0){let t=65536*Math.floor(a/65536);e[0]=Math.fround(t),e[1]=Math.fround(a-t)}else{let t=65536*Math.floor(-a/65536);e[0]=Math.fround(-t),e[1]=Math.fround(a+t)}return e}function Cn(a,e){if(a>=0){let t=65536*Math.floor(a/65536);e.x=Math.fround(t),e.y=Math.fround(a-t)}else{let t=65536*Math.floor(-a/65536);e.x=Math.fround(-t),e.y=Math.fround(a+t)}return e}function En(a,e,t){t=t||2;var i,s,n,o,l,h,c,d=e&&e.length,u=d?e[0]*t:a.length,f=An(a,0,u,t,!0),_=[];if(!f)return _;if(d&&(f=function(g,v,p,y){var b,C,T,w=[];for(b=0,C=v.length;b<C;b++)(T=An(g,v[b]*y,b<C-1?v[b+1]*y:g.length,y,!1))===T.next&&(T.steiner=!0),w.push(dl(T));for(w.sort(hl),b=0;b<w.length;b++)cl(w[b],p),p=bi(p,p.next);return p}(a,e,f,t)),a.length>80*t){i=n=a[0],s=o=a[1];for(let g=t;g<u;g+=t)(l=a[g])<i&&(i=l),(h=a[g+1])<s&&(s=h),l>n&&(n=l),h>o&&(o=h);c=Math.max(n-i,o-s)}return wi(f,_,t,i,s,c),_}function An(a,e,t,i,s){var n,o;if(s===function(l,h,c,d){var u=0;for(let f=h,_=c-d;f<c;f+=d)u+=(l[_]-l[f])*(l[f+1]+l[_+1]),_=f;return u}(a,e,t,i)>0)for(n=e;n<t;n+=i)o=Ln(n,a[n],a[n+1],o);else for(n=t-i;n>=e;n-=i)o=Ln(n,a[n],a[n+1],o);return o&&we(o,o.next)&&(Ci(o),o=o.next),o}function bi(a,e){if(!a)return a;e||(e=a);var t,i=a;do if(t=!1,i.steiner||!we(i,i.next)&&kt(i.prev,i,i.next)!==0)i=i.next;else{if(Ci(i),(i=e=i.prev)===i.next)return null;t=!0}while(t||i!==e);return e}function wi(a,e,t,i,s,n,o){if(a){!o&&n&&function(d,u,f,_){var g=d;do g.z===null&&(g.z=Sr(g.x,g.y,u,f,_)),g.prevZ=g.prev,g.nextZ=g.next,g=g.next;while(g!==d);g.prevZ.nextZ=null,g.prevZ=null,function(v){var p,y,b,C,T,w,L,S,P=1;do{for(y=v,v=null,T=null,w=0;y;){for(w++,b=y,L=0,p=0;p<P&&(L++,b=b.nextZ);p++);for(S=P;L>0||S>0&&b;)L!==0&&(S===0||!b||y.z<=b.z)?(C=y,y=y.nextZ,L--):(C=b,b=b.nextZ,S--),T?T.nextZ=C:v=C,C.prevZ=T,T=C;y=b}T.nextZ=null,P*=2}while(w>1)}(g)}(a,i,s,n);for(var l,h,c=a;a.prev!==a.next;)if(l=a.prev,h=a.next,n?ol(a,i,s,n):nl(a))e.push(l.i/t),e.push(a.i/t),e.push(h.i/t),Ci(a),a=h.next,c=h.next;else if((a=h)===c){o?o===1?wi(a=al(a,e,t),e,t,i,s,n,2):o===2&&ll(a,e,t,i,s,n):wi(bi(a),e,t,i,s,n,1);break}}}function nl(a){var e=a.prev,t=a,i=a.next;if(kt(e,t,i)>=0)return!1;for(var s=a.next.next;s!==a.prev;){if(ns(e.x,e.y,t.x,t.y,i.x,i.y,s.x,s.y)&&kt(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function ol(a,e,t,i){var s=a.prev,n=a,o=a.next;if(kt(s,n,o)>=0)return!1;for(var l=s.x<n.x?s.x<o.x?s.x:o.x:n.x<o.x?n.x:o.x,h=s.y<n.y?s.y<o.y?s.y:o.y:n.y<o.y?n.y:o.y,c=s.x>n.x?s.x>o.x?s.x:o.x:n.x>o.x?n.x:o.x,d=s.y>n.y?s.y>o.y?s.y:o.y:n.y>o.y?n.y:o.y,u=Sr(l,h,e,t,i),f=Sr(c,d,e,t,i),_=a.nextZ;_&&_.z<=f;){if(_!==a.prev&&_!==a.next&&ns(s.x,s.y,n.x,n.y,o.x,o.y,_.x,_.y)&&kt(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(_=a.prevZ;_&&_.z>=u;){if(_!==a.prev&&_!==a.next&&ns(s.x,s.y,n.x,n.y,o.x,o.y,_.x,_.y)&&kt(_.prev,_,_.next)>=0)return!1;_=_.prevZ}return!0}function al(a,e,t){var i=a;do{var s=i.prev,n=i.next.next;!we(s,n)&&ia(s,i,i.next,n)&&Ti(s,n)&&Ti(n,s)&&(e.push(s.i/t),e.push(i.i/t),e.push(n.i/t),Ci(i),Ci(i.next),i=a=n),i=i.next}while(i!==a);return i}function ll(a,e,t,i,s,n){var o=a;do{for(var l=o.next.next;l!==o.prev;){if(o.i!==l.i&&ul(o,l)){var h=sa(o,l);return o=bi(o,o.next),h=bi(h,h.next),wi(o,e,t,i,s,n),void wi(h,e,t,i,s,n)}l=l.next}o=o.next}while(o!==a)}function hl(a,e){return a.x-e.x}function cl(a,e){if(e=function(i,s){var n,o=s,l=i.x,h=i.y,c=-1/0;do{if(h<=o.y&&h>=o.next.y&&o.next.y!==o.y){var d=o.x+(h-o.y)*(o.next.x-o.x)/(o.next.y-o.y);if(d<=l&&d>c){if(c=d,d===l){if(h===o.y)return o;if(h===o.next.y)return o.next}n=o.x<o.next.x?o:o.next}}o=o.next}while(o!==s);if(!n)return null;if(l===c)return n.prev;var u,f=n,_=n.x,g=n.y,v=1/0;for(o=n.next;o!==f;)l>=o.x&&o.x>=_&&l!==o.x&&ns(h<g?l:c,h,_,g,h<g?c:l,h,o.x,o.y)&&((u=Math.abs(h-o.y)/(l-o.x))<v||u===v&&o.x>n.x)&&Ti(o,i)&&(n=o,v=u),o=o.next;return n}(a,e)){var t=sa(e,a);bi(t,t.next)}}function Sr(a,e,t,i,s){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-t)/s)|a<<8))|a<<4))|a<<2))|a<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)/s)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function dl(a){var e=a,t=a;do e.x<t.x&&(t=e),e=e.next;while(e!==a);return t}function ns(a,e,t,i,s,n,o,l){return(s-o)*(e-l)-(a-o)*(n-l)>=0&&(a-o)*(i-l)-(t-o)*(e-l)>=0&&(t-o)*(n-l)-(s-o)*(i-l)>=0}function ul(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!function(t,i){var s=t;do{if(s.i!==t.i&&s.next.i!==t.i&&s.i!==i.i&&s.next.i!==i.i&&ia(s,s.next,t,i))return!0;s=s.next}while(s!==t);return!1}(a,e)&&Ti(a,e)&&Ti(e,a)&&function(t,i){var s=t,n=!1,o=(t.x+i.x)/2,l=(t.y+i.y)/2;do s.y>l!=s.next.y>l&&s.next.y!==s.y&&o<(s.next.x-s.x)*(l-s.y)/(s.next.y-s.y)+s.x&&(n=!n),s=s.next;while(s!==t);return n}(a,e)}function kt(a,e,t){return(e.y-a.y)*(t.x-e.x)-(e.x-a.x)*(t.y-e.y)}function we(a,e){return a.x===e.x&&a.y===e.y}function ia(a,e,t,i){return!!(we(a,e)&&we(t,i)||we(a,i)&&we(t,e))||kt(a,e,t)>0!=kt(a,e,i)>0&&kt(t,i,a)>0!=kt(t,i,e)>0}function Ti(a,e){return kt(a.prev,a,a.next)<0?kt(a,e,a.next)>=0&&kt(a,a.prev,e)>=0:kt(a,e,a.prev)<0||kt(a,a.next,e)<0}function sa(a,e){var t=new Rr(a.i,a.x,a.y),i=new Rr(e.i,e.x,e.y),s=a.next,n=e.prev;return a.next=e,e.prev=a,t.next=s,s.prev=t,i.next=t,t.prev=i,n.next=i,i.prev=n,i}function Ln(a,e,t,i){var s=new Rr(a,e,t);return i?(s.next=i.next,s.prev=i,i.next.prev=s,i.next=s):(s.prev=s,s.next=s),s}function Ci(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function Rr(a,e,t){this.i=a,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Pn(a){var e=a[0][0].length,t={vertices:[],holes:[],dimensions:e},i=0;for(let s=0;s<a.length;s++){for(let n=0;n<a[s].length;n++)for(let o=0;o<e;o++)t.vertices.push(a[s][n][o]);s>0&&(i+=a[s-1].length,t.holes.push(i))}return t}function js(a,e,t){let i=a[0],s=a[1];if(i>=0){let n=65536*Math.floor(i/65536);e.x=Math.fround(n),t.x=Math.fround(i-n)}else{let n=65536*Math.floor(-i/65536);e.x=Math.fround(-n),t.x=Math.fround(i+n)}if(s>=0){let n=65536*Math.floor(s/65536);e.y=Math.fround(n),t.y=Math.fround(s-n)}else{let n=65536*Math.floor(-s/65536);e.y=Math.fround(-n),t.y=Math.fround(s+n)}}let j=new N,q=new N,ze=new N;const fe=class n0{constructor(e){this.__id=n0.__counter__++,this._layer=e,this._handler=null,this._geometries=[],this._updatedGeometryArr=[],this._updatedGeometry={},this._removeGeometryExtentArr=[],this._removeGeometryExtents={},this._polyVerticesHighMerc=[],this._polyVerticesLowMerc=[],this._polyColors=[],this._polyPickingColors=[],this._polyIndexes=[],this._lineVerticesHighMerc=[],this._lineVerticesLowMerc=[],this._lineOrders=[],this._lineIndexes=[],this._lineColors=[],this._linePickingColors=[],this._lineThickness=[],this._lineStrokes=[],this._lineStrokeColors=[],this._polyVerticesHighBufferMerc=null,this._polyVerticesLowBufferMerc=null,this._polyColorsBuffer=null,this._polyPickingColorsBuffer=null,this._polyIndexesBuffer=null,this._lineVerticesHighBufferMerc=null,this._lineVerticesLowBufferMerc=null,this._lineColorsBuffer=null,this._linePickingColorsBuffer=null,this._lineThicknessBuffer=null,this._lineStrokesBuffer=null,this._lineStrokeColorsBuffer=null,this._lineOrdersBuffer=null,this._lineIndexesBuffer=null,this._buffersUpdateCallbacks=[],this._buffersUpdateCallbacks[0]=this.createPolyVerticesBuffer,this._buffersUpdateCallbacks[1]=this.createPolyIndexesBuffer,this._buffersUpdateCallbacks[2]=this.createPolyColorsBuffer,this._buffersUpdateCallbacks[3]=this.createLineVerticesBuffer,this._buffersUpdateCallbacks[4]=this.createLineIndexesBuffer,this._buffersUpdateCallbacks[5]=this.createLineOrdersBuffer,this._buffersUpdateCallbacks[6]=this.createLineColorsBuffer,this._buffersUpdateCallbacks[7]=this.createLineThicknessBuffer,this._buffersUpdateCallbacks[8]=this.createLineStrokesBuffer,this._buffersUpdateCallbacks[9]=this.createLineStrokeColorsBuffer,this._buffersUpdateCallbacks[10]=this.createPolyPickingColorsBuffer,this._buffersUpdateCallbacks[11]=this.createLinePickingColorsBuffer,this._changedBuffers=new Array(this._buffersUpdateCallbacks.length)}static appendLineData(e,t,i,s,n,o,l,h,c,d,u,f,_,g,v,p,y,b){var C=0;u.length>0?(C=u[u.length-5]+9,u.push(C,C)):u.push(0,0);var T=n,w=[i.x,i.y,i.z,i.w],L=l,S=[o.x,o.y,o.z,o.w],P=[s.x,s.y,s.z,1];for(let k=0;k<e.length;k++){var B=e[k];if(B.length===0)continue;let I,z,Ce=C;if(t)I=B[B.length-1];else{let R=B[0],O=B[1];O||(O=R),I=[R[0]+R[0]-O[0],R[1]+R[1]-O[1]]}js(I,j,q),h.push(j.x,j.y,j.x,j.y,j.x,j.y,j.x,j.y),c.push(q.x,q.y,q.x,q.y,q.x,q.y,q.x,q.y),y.push(j.x,j.y,j.x,j.y,j.x,j.y,j.x,j.y),b.push(q.x,q.y,q.x,q.y,q.x,q.y,q.x,q.y),d.push(1,-1,2,-2),g.push(T,T,T,T),p.push(L,L,L,L),f.push(w[0],w[1],w[2],w[3],w[0],w[1],w[2],w[3],w[0],w[1],w[2],w[3],w[0],w[1],w[2],w[3]),v.push(S[0],S[1],S[2],S[3],S[0],S[1],S[2],S[3],S[0],S[1],S[2],S[3],S[0],S[1],S[2],S[3]),_.push(P[0],P[1],P[2],P[3],P[0],P[1],P[2],P[3],P[0],P[1],P[2],P[3],P[0],P[1],P[2],P[3]);for(let R=0;R<B.length;R++)js(B[R],j,q),h.push(j.x,j.y,j.x,j.y,j.x,j.y,j.x,j.y),c.push(q.x,q.y,q.x,q.y,q.x,q.y,q.x,q.y),y.push(j.x,j.y,j.x,j.y,j.x,j.y,j.x,j.y),b.push(q.x,q.y,q.x,q.y,q.x,q.y,q.x,q.y),d.push(1,-1,2,-2),g.push(T,T,T,T),p.push(L,L,L,L),f.push(w[0],w[1],w[2],w[3],w[0],w[1],w[2],w[3],w[0],w[1],w[2],w[3],w[0],w[1],w[2],w[3]),v.push(S[0],S[1],S[2],S[3],S[0],S[1],S[2],S[3],S[0],S[1],S[2],S[3],S[0],S[1],S[2],S[3]),_.push(P[0],P[1],P[2],P[3],P[0],P[1],P[2],P[3],P[0],P[1],P[2],P[3],P[0],P[1],P[2],P[3]),u.push(C++,C++,C++,C++);if(t)z=B[0],u.push(Ce,Ce+1,Ce+1,Ce+1);else{let R=B[B.length-1],O=B[B.length-2];O||(O=R),z=[R[0]+R[0]-O[0],R[1]+R[1]-O[1]],u.push(C-1,C-1,C-1,C-1)}js(z,j,q),h.push(j.x,j.y,j.x,j.y,j.x,j.y,j.x,j.y),c.push(q.x,q.y,q.x,q.y,q.x,q.y,q.x,q.y),y.push(j.x,j.y,j.x,j.y,j.x,j.y,j.x,j.y),b.push(q.x,q.y,q.x,q.y,q.x,q.y,q.x,q.y),d.push(1,-1,2,-2),g.push(T,T,T,T),p.push(L,L,L,L),f.push(w[0],w[1],w[2],w[3],w[0],w[1],w[2],w[3],w[0],w[1],w[2],w[3],w[0],w[1],w[2],w[3]),v.push(S[0],S[1],S[2],S[3],S[0],S[1],S[2],S[3],S[0],S[1],S[2],S[3],S[0],S[1],S[2],S[3]),_.push(P[0],P[1],P[2],P[3],P[0],P[1],P[2],P[3],P[0],P[1],P[2],P[3],P[0],P[1],P[2],P[3]),k<e.length-1&&(C+=8,u.push(C,C))}}assignHandler(e){this._handler=e,this.refresh(),e.isInitialized()&&this.update()}add(e){if(e._handlerIndex===-1){e._handler=this,e._handlerIndex=this._geometries.length,this._geometries.push(e);let t=e._entity._pickingColor.scaleTo(1/255);if(e._polyVerticesHighMerc=[],e._polyVerticesLowMerc=[],e._lineVerticesHighMerc=[],e._lineVerticesLowMerc=[],e._coordinates[0].length){if(e.type===oi.POLYGON){let i=e._coordinates,s=[];for(let d=0;d<i.length;d++){s[d]=[];for(let u=0;u<i[d].length;u++)s[d][u]=[ri(i[d][u][0]),ni(i[d][u][1])]}let n=Pn(s),o=En(n.vertices,n.holes,2);e._polyVerticesHandlerIndex=this._polyVerticesHighMerc.length,e._polyIndexesHandlerIndex=this._polyIndexes.length;for(let d=0;d<o.length;d++)this._polyIndexes.push(o[d]+.5*e._polyVerticesHandlerIndex);let l=e._style.fillColor,h=[],c=[];for(let d=0;d<.5*n.vertices.length;d++)this._polyColors.push(l.x,l.y,l.z,l.w),this._polyPickingColors.push(t.x,t.y,t.z,1);for(let d=0;d<n.vertices.length;d++)Cn(n.vertices[d],ze),h[d]=ze.x,c[d]=ze.y;e._polyVerticesHighMerc=h,e._polyVerticesLowMerc=c,this._polyVerticesHighMerc.push.apply(this._polyVerticesHighMerc,h),this._polyVerticesLowMerc.push.apply(this._polyVerticesLowMerc,c),e._polyVerticesLength=n.vertices.length,e._polyIndexesLength=o.length,e._lineVerticesHandlerIndex=this._lineVerticesHighMerc.length,e._lineOrdersHandlerIndex=this._lineOrders.length,e._lineIndexesHandlerIndex=this._lineIndexes.length,e._lineColorsHandlerIndex=this._lineColors.length,e._lineThicknessHandlerIndex=this._lineThickness.length,n0.appendLineData(s,!0,e._style.lineColor,t,e._style.lineWidth,e._style.strokeColor,e._style.strokeWidth,this._lineVerticesHighMerc,this._lineVerticesLowMerc,this._lineOrders,this._lineIndexes,this._lineColors,this._linePickingColors,this._lineThickness,this._lineStrokeColors,this._lineStrokes,e._lineVerticesHighMerc,e._lineVerticesLowMerc),e._lineVerticesLength=this._lineVerticesHighMerc.length-e._lineVerticesHandlerIndex,e._lineOrdersLength=this._lineOrders.length-e._lineOrdersHandlerIndex,e._lineIndexesLength=this._lineIndexes.length-e._lineIndexesHandlerIndex,e._lineColorsLength=this._lineColors.length-e._lineColorsHandlerIndex,e._lineThicknessLength=this._lineThickness.length-e._lineThicknessHandlerIndex}else if(e.type===oi.MULTIPOLYGON){let i=e._coordinates,s=[],n=[];e._lineVerticesHandlerIndex=this._lineVerticesHighMerc.length,e._lineOrdersHandlerIndex=this._lineOrders.length,e._lineIndexesHandlerIndex=this._lineIndexes.length,e._lineColorsHandlerIndex=this._lineColors.length,e._lineThicknessHandlerIndex=this._lineThickness.length;for(let c=0;c<i.length;c++){let d=i[c],u=[];for(let g=0;g<d.length;g++){u[g]=[];for(let v=0;v<i[c][g].length;v++)u[g][v]=[ri(d[g][v][0]),ni(d[g][v][1])]}let f=Pn(u),_=En(f.vertices,f.holes,2);for(let g=0;g<_.length;g++)n.push(_[g]+.5*s.length);s.push.apply(s,f.vertices),n0.appendLineData(u,!0,e._style.lineColor,t,e._style.lineWidth,e._style.strokeColor,e._style.strokeWidth,this._lineVerticesHighMerc,this._lineVerticesLowMerc,this._lineOrders,this._lineIndexes,this._lineColors,this._linePickingColors,this._lineThickness,this._lineStrokeColors,this._lineStrokes,e._lineVerticesHighMerc,e._lineVerticesLowMerc)}e._polyVerticesHandlerIndex=this._polyVerticesHighMerc.length,e._polyIndexesHandlerIndex=this._polyIndexes.length;for(let c=0;c<n.length;c++)this._polyIndexes.push(n[c]+.5*e._polyVerticesHandlerIndex);let o=e._style.fillColor,l=[],h=[];for(let c=0;c<.5*s.length;c++)this._polyColors.push(o.x,o.y,o.z,o.w),this._polyPickingColors.push(t.x,t.y,t.z,1);for(let c=0;c<s.length;c++)Cn(s[c],ze),l[c]=ze.x,h[c]=ze.y;e._polyVerticesHighMerc=l,e._polyVerticesLowMerc=h,this._polyVerticesHighMerc.push.apply(this._polyVerticesHighMerc,l),this._polyVerticesLowMerc.push.apply(this._polyVerticesLowMerc,h),e._polyVerticesLength=s.length,e._polyIndexesLength=n.length,e._lineVerticesLength=this._lineVerticesHighMerc.length-e._lineVerticesHandlerIndex,e._lineOrdersLength=this._lineOrders.length-e._lineOrdersHandlerIndex,e._lineIndexesLength=this._lineIndexes.length-e._lineIndexesHandlerIndex,e._lineColorsLength=this._lineColors.length-e._lineColorsHandlerIndex,e._lineThicknessLength=this._lineThickness.length-e._lineThicknessHandlerIndex}else if(e.type===oi.LINESTRING){let i=e._coordinates,s=new Array(i.length);for(let n=0;n<i.length;n++)s[n]=[ri(i[n][0]),ni(i[n][1])];e._lineVerticesHandlerIndex=this._lineVerticesHighMerc.length,e._lineOrdersHandlerIndex=this._lineOrders.length,e._lineIndexesHandlerIndex=this._lineIndexes.length,e._lineColorsHandlerIndex=this._lineColors.length,e._lineThicknessHandlerIndex=this._lineThickness.length,n0.appendLineData([s],!1,e._style.lineColor,t,e._style.lineWidth,e._style.strokeColor,e._style.strokeWidth,this._lineVerticesHighMerc,this._lineVerticesLowMerc,this._lineOrders,this._lineIndexes,this._lineColors,this._linePickingColors,this._lineThickness,this._lineStrokeColors,this._lineStrokes,e._lineVerticesHighMerc,e._lineVerticesLowMerc),e._lineVerticesLength=this._lineVerticesHighMerc.length-e._lineVerticesHandlerIndex,e._lineOrdersLength=this._lineOrders.length-e._lineOrdersHandlerIndex,e._lineIndexesLength=this._lineIndexes.length-e._lineIndexesHandlerIndex,e._lineColorsLength=this._lineColors.length-e._lineColorsHandlerIndex,e._lineThicknessLength=this._lineThickness.length-e._lineThicknessHandlerIndex}else if(e.type===oi.MULTILINESTRING){let i=e._coordinates,s=[];for(let n=0;n<i.length;n++){s[n]=[];for(let o=0;o<i[n].length;o++)s[n][o]=[ri(i[n][o][0]),ni(i[n][o][1])]}e._lineVerticesHandlerIndex=this._lineVerticesHighMerc.length,e._lineOrdersHandlerIndex=this._lineOrders.length,e._lineIndexesHandlerIndex=this._lineIndexes.length,e._lineColorsHandlerIndex=this._lineColors.length,e._lineThicknessHandlerIndex=this._lineThickness.length,n0.appendLineData(s,!1,e._style.lineColor,t,e._style.lineWidth,e._style.strokeColor,e._style.strokeWidth,this._lineVerticesHighMerc,this._lineVerticesLowMerc,this._lineOrders,this._lineIndexes,this._lineColors,this._linePickingColors,this._lineThickness,this._lineStrokeColors,this._lineStrokes,e._lineVerticesHighMerc,e._lineVerticesLowMerc),e._lineVerticesLength=this._lineVerticesHighMerc.length-e._lineVerticesHandlerIndex,e._lineOrdersLength=this._lineOrders.length-e._lineOrdersHandlerIndex,e._lineIndexesLength=this._lineIndexes.length-e._lineIndexesHandlerIndex,e._lineColorsLength=this._lineColors.length-e._lineColorsHandlerIndex,e._lineThicknessLength=this._lineThickness.length-e._lineThicknessHandlerIndex}}this.setGeometryVisibility(e),!this._updatedGeometry[e.__id]&&this._updatedGeometryArr.push(e),this._updatedGeometry[e.__id]=!0,this.refresh()}}remove(e){const t=e._handlerIndex;if(t!==-1){this._geometries.splice(t,1),this._polyVerticesHighMerc.splice(e._polyVerticesHandlerIndex,e._polyVerticesLength),this._polyVerticesLowMerc.splice(e._polyVerticesHandlerIndex,e._polyVerticesLength),this._polyColors.splice(2*e._polyVerticesHandlerIndex,2*e._polyVerticesLength),this._polyPickingColors.splice(2*e._polyVerticesHandlerIndex,2*e._polyVerticesLength),this._polyIndexes.splice(e._polyIndexesHandlerIndex,e._polyIndexesLength);let i=.5*e._polyVerticesLength;for(let n=e._polyIndexesHandlerIndex;n<this._polyIndexes.length;n++)this._polyIndexes[n]-=i;this._lineVerticesHighMerc.splice(e._lineVerticesHandlerIndex,e._lineVerticesLength),this._lineVerticesLowMerc.splice(e._lineVerticesHandlerIndex,e._lineVerticesLength),this._lineOrders.splice(e._lineOrdersHandlerIndex,e._lineOrdersLength),this._lineColors.splice(e._lineColorsHandlerIndex,e._lineColorsLength),this._linePickingColors.splice(e._lineColorsHandlerIndex,e._lineColorsLength),this._lineStrokeColors.splice(e._lineColorsHandlerIndex,e._lineColorsLength),this._lineThickness.splice(e._lineThicknessHandlerIndex,e._lineThicknessLength),this._lineStrokes.splice(e._lineThicknessHandlerIndex,e._lineThicknessLength),this._lineIndexes.splice(e._lineIndexesHandlerIndex,e._lineIndexesLength),i=.5*e._lineVerticesLength;for(let n=e._lineIndexesHandlerIndex;n<this._lineIndexes.length;n++)this._lineIndexes[n]-=i;let s=this._geometries;for(let n=t;n<s.length;n++){let o=s[n];o._handlerIndex=n,o._polyVerticesHandlerIndex-=e._polyVerticesLength,o._polyIndexesHandlerIndex-=e._polyIndexesLength,o._lineVerticesHandlerIndex-=e._lineVerticesLength,o._lineOrdersHandlerIndex-=e._lineOrdersLength,o._lineColorsHandlerIndex-=e._lineColorsLength,o._lineThicknessHandlerIndex-=e._lineThicknessLength,o._lineIndexesHandlerIndex-=e._lineIndexesLength}e._pickingReady=!1,e._handler=null,e._handlerIndex=-1,e._polyVerticesHighMerc=[],e._polyVerticesLowMerc=[],e._polyVerticesLength=-1,e._polyIndexesLength=-1,e._polyVerticesHandlerIndex=-1,e._polyIndexesHandlerIndex=-1,e._lineVerticesHighMerc=[],e._lineVerticesLowMerc=[],e._lineVerticesLength=-1,e._lineOrdersLength=-1,e._lineIndexesLength=-1,e._lineColorsLength=-1,e._lineThicknessLength=-1,e._lineVerticesHandlerIndex=-1,e._lineOrdersHandlerIndex=-1,e._lineIndexesHandlerIndex=-1,e._lineThicknessHandlerIndex=-1,e._lineColorsHandlerIndex=-1,!this._removeGeometryExtents[e.__id]&&this._removeGeometryExtentArr.push(e.getExtent()),this._removeGeometryExtents[e.__id]=!0,this.refresh()}}_refreshRecursevely(e,t){if(t.ready){let i=this._layer._id;for(let s=0;s<t.nodes.length;s++){let n=t.nodes[s];if(e.overlaps(n.segment.getExtentLonLat())){this._refreshRecursevely(e,n);let o=n.segment.materials[i];o&&o.isReady&&(o.segment.node.getState()!==1?o.layer.clearMaterial(o):(o.pickingReady=o.pickingReady&&e._pickingReady,o.isReady=!1,o._updateTexture=o.texture,o._updatePickingMask=o.pickingMask),e._pickingReady=!0)}}}}_refreshRecursevelyExt(e,t){if(t.ready){let i=this._layer.__id;for(let s=0;s<t.nodes.length;s++){let n=t.nodes[s];if(e.overlaps(n.segment.getExtentLonLat())){this._refreshRecursevelyExt(e,n);let o=n.segment.materials[i];o&&o.isReady&&o.layer.clearMaterial(o)}}}}_refreshPlanetNode(e){let t,i=this._removeGeometryExtentArr;for(t=0;t<i.length;t++)this._refreshRecursevelyExt(i[t],e);let s=this._updatedGeometryArr;for(t=0;t<s.length;t++)this._refreshRecursevely(s[t],e)}_updatePlanet(){let e=this._layer._planet;if(e){let t=e.quadTreeStrategy.quadTreeList;for(let i=0;i<t.length;i++)this._refreshPlanetNode(t[i])}this._updatedGeometryArr.length=0,this._updatedGeometryArr=[],this._updatedGeometry={},this._removeGeometryExtentArr.length=0,this._removeGeometryExtentArr=[],this._removeGeometryExtents={}}refresh(){let e=this._changedBuffers.length;for(;e--;)this._changedBuffers[e]=!0}update(){if(this._handler){let e=!1,t=this._changedBuffers.length;for(;t--;)this._changedBuffers[t]&&(e=!0,this._buffersUpdateCallbacks[t].call(this),this._changedBuffers[t]=!1);e&&this._updatePlanet()}}setGeometryVisibility(e){let t=e.getVisibility()?1:0,i=this._polyVerticesHighMerc,s=this._polyVerticesLowMerc,n=e._polyVerticesLength,o=e._polyVerticesHandlerIndex;for(let l=0;l<n;l++)i[o+l]=e._polyVerticesHighMerc[l]*t,s[o+l]=e._polyVerticesLowMerc[l]*t;i=this._lineVerticesHighMerc,s=this._lineVerticesLowMerc,n=e._lineVerticesLength,o=e._lineVerticesHandlerIndex;for(let l=0;l<n;l++)i[o+l]=e._lineVerticesHighMerc[l]*t,s[o+l]=e._lineVerticesLowMerc[l]*t;this._changedBuffers[0]=!0,this._changedBuffers[3]=!0,!this._updatedGeometry[e.__id]&&this._updatedGeometryArr.push(e),this._updatedGeometry[e.__id]=!0}setPolyColorArr(e,t){let i=2*e._polyVerticesHandlerIndex,s=i+2*e._polyVerticesLength,n=this._polyColors;for(let o=i;o<s;o+=4)n[o]=t.x,n[o+1]=t.y,n[o+2]=t.z,n[o+3]=t.w;this._changedBuffers[2]=!0,!this._updatedGeometry[e.__id]&&this._updatedGeometryArr.push(e),this._updatedGeometry[e.__id]=!0}setLineStrokeColorArr(e,t){let i=e._lineColorsHandlerIndex,s=i+e._lineColorsLength,n=this._lineStrokeColors;for(let o=i;o<s;o+=4)n[o]=t.x,n[o+1]=t.y,n[o+2]=t.z,n[o+3]=t.w;this._changedBuffers[9]=!0,!this._updatedGeometry[e.__id]&&this._updatedGeometryArr.push(e),this._updatedGeometry[e.__id]=!0}setLineColorArr(e,t){let i=e._lineColorsHandlerIndex,s=i+e._lineColorsLength,n=this._lineColors;for(let o=i;o<s;o+=4)n[o]=t.x,n[o+1]=t.y,n[o+2]=t.z,n[o+3]=t.w;this._changedBuffers[6]=!0,!this._updatedGeometry[e.__id]&&this._updatedGeometryArr.push(e),this._updatedGeometry[e.__id]=!0}setLineStrokeArr(e,t){}setLineThicknessArr(e,t){let i=e._lineThicknessHandlerIndex,s=i+e._lineThicknessLength,n=this._lineThickness;for(let o=i;o<s;o++)n[o]=t;this._changedBuffers[7]=!0,!this._updatedGeometry[e.__id]&&this._updatedGeometryArr.push(e),this._updatedGeometry[e.__id]=!0}bringToFront(e){let t=this._polyIndexes.splice(e._polyIndexesHandlerIndex,e._polyIndexesLength),i=this._lineIndexes.splice(e._lineIndexesHandlerIndex,e._lineIndexesLength);this._geometries.splice(e._handlerIndex,1);let s=this._geometries;for(let n=e._handlerIndex;n<s.length;n++){let o=s[n];o._handlerIndex=n,o._polyIndexesHandlerIndex-=e._polyIndexesLength,o._lineIndexesHandlerIndex-=e._lineIndexesLength}e._polyIndexesHandlerIndex=this._polyIndexes.length,e._lineIndexesHandlerIndex=this._lineIndexes.length,e._handlerIndex=this._geometries.length,this._geometries.push(e),this._polyIndexes.push.apply(this._polyIndexes,t),this._lineIndexes.push.apply(this._lineIndexes,i),this._changedBuffers[1]=!0,this._changedBuffers[4]=!0,!this._updatedGeometry[e.__id]&&this._updatedGeometryArr.push(e),this._updatedGeometry[e.__id]=!0}createPolyVerticesBuffer(){let e=this._handler;e.gl.deleteBuffer(this._polyVerticesHighBufferMerc),this._polyVerticesHighBufferMerc=e.createArrayBuffer(new Float32Array(this._polyVerticesHighMerc),2,this._polyVerticesHighMerc.length/2),e.gl.deleteBuffer(this._polyVerticesLowBufferMerc),this._polyVerticesLowBufferMerc=e.createArrayBuffer(new Float32Array(this._polyVerticesLowMerc),2,this._polyVerticesLowMerc.length/2)}createPolyIndexesBuffer(){let e=this._handler;e.gl.deleteBuffer(this._polyIndexesBuffer),this._polyIndexesBuffer=e.createElementArrayBuffer(new Uint32Array(this._polyIndexes),1,this._polyIndexes.length)}createPolyColorsBuffer(){let e=this._handler;e.gl.deleteBuffer(this._polyColorsBuffer),this._polyColorsBuffer=e.createArrayBuffer(new Float32Array(this._polyColors),4,this._polyColors.length/4)}createPolyPickingColorsBuffer(){let e=this._handler;e.gl.deleteBuffer(this._polyPickingColorsBuffer),this._polyPickingColorsBuffer=e.createArrayBuffer(new Float32Array(this._polyPickingColors),4,this._polyPickingColors.length/4)}createLineVerticesBuffer(){let e=this._handler;e.gl.deleteBuffer(this._lineVerticesHighBufferMerc),this._lineVerticesHighBufferMerc=e.createArrayBuffer(new Float32Array(this._lineVerticesHighMerc),2,this._lineVerticesHighMerc.length/2),e.gl.deleteBuffer(this._lineVerticesLowBufferMerc),this._lineVerticesLowBufferMerc=e.createArrayBuffer(new Float32Array(this._lineVerticesLowMerc),2,this._lineVerticesLowMerc.length/2)}createLineIndexesBuffer(){let e=this._handler;e.gl.deleteBuffer(this._lineIndexesBuffer),this._lineIndexesBuffer=e.createElementArrayBuffer(new Uint32Array(this._lineIndexes),1,this._lineIndexes.length)}createLineOrdersBuffer(){let e=this._handler;e.gl.deleteBuffer(this._lineOrdersBuffer),this._lineOrdersBuffer=e.createArrayBuffer(new Float32Array(this._lineOrders),1,this._lineOrders.length/2)}createLineColorsBuffer(){let e=this._handler;e.gl.deleteBuffer(this._lineColorsBuffer),this._lineColorsBuffer=e.createArrayBuffer(new Float32Array(this._lineColors),4,this._lineColors.length/4)}createLinePickingColorsBuffer(){let e=this._handler;e.gl.deleteBuffer(this._linePickingColorsBuffer),this._linePickingColorsBuffer=e.createArrayBuffer(new Float32Array(this._linePickingColors),4,this._linePickingColors.length/4)}createLineThicknessBuffer(){let e=this._handler;e.gl.deleteBuffer(this._lineThicknessBuffer),this._lineThicknessBuffer=e.createArrayBuffer(new Float32Array(this._lineThickness),1,this._lineThickness.length)}createLineStrokesBuffer(){let e=this._handler;e.gl.deleteBuffer(this._lineStrokesBuffer),this._lineStrokesBuffer=e.createArrayBuffer(new Float32Array(this._lineStrokes),1,this._lineStrokes.length)}createLineStrokeColorsBuffer(){let e=this._handler;e.gl.deleteBuffer(this._lineStrokeColorsBuffer),this._lineStrokeColorsBuffer=e.createArrayBuffer(new Float32Array(this._lineStrokeColors),4,this._lineStrokeColors.length/4)}clear(){this._geometries=[],this._polyVerticesHighMerc=[],this._polyVerticesLowMerc=[],this._polyIndexes=[],this._polyColors=[],this._polyPickingColors=[],this._lineVerticesHighMerc=[],this._lineVerticesLowMerc=[],this._lineOrders=[],this._lineIndexes=[],this._lineColors=[],this._linePickingColors=[],this._lineThickness=[],this._lineStrokeColors=[],this._lineStrokes=[],this._deleteBuffers(),this._polyVerticesHighBufferMerc=null,this._polyVerticesLowBufferMerc=null,this._polyIndexesBuffer=null,this._polyColorsBuffer=null,this._polyPickingColorsBuffer=null,this._lineVerticesHighBufferMerc=null,this._lineVerticesLowBufferMerc=null,this._lineIndexesBuffer=null,this._lineOrdersBuffer=null,this._lineColorsBuffer=null,this._linePickingColorsBuffer=null,this._lineThicknessBuffer=null,this._lineStrokeColorsBuffer=null,this._lineStrokesBuffer=null,this._updatedGeometryArr=[],this._updatedGeometry={},this._removeGeometryExtentArr=[],this._removeGeometryExtents={},this.refresh()}_deleteBuffers(){if(this._layer._planet&&this._layer._planet.renderer){let e=this._layer._planet.renderer.handler.gl;e&&(e.deleteBuffer(this._polyVerticesHighBufferMerc),e.deleteBuffer(this._polyVerticesLowBufferMerc),e.deleteBuffer(this._polyIndexesBuffer),e.deleteBuffer(this._polyColorsBuffer),e.deleteBuffer(this._polyPickingColorsBuffer),e.deleteBuffer(this._lineVerticesHighBufferMerc),e.deleteBuffer(this._lineVerticesLowBufferMerc),e.deleteBuffer(this._lineIndexesBuffer),e.deleteBuffer(this._lineOrdersBuffer),e.deleteBuffer(this._lineColorsBuffer),e.deleteBuffer(this._linePickingColorsBuffer),e.deleteBuffer(this._lineThicknessBuffer),e.deleteBuffer(this._lineStrokeColorsBuffer),e.deleteBuffer(this._lineStrokesBuffer))}}};fe.__counter__=0;let Mr=fe;class ut extends It{constructor(e,t={}){super(e,t),this.events=this.events.registerNames(_l),this.isVector=!0,this._hasImageryTiles=!1,this.scaleByDistance=t.scaleByDistance||[Ee,Ee,Ee],this._useLighting=t.useLighting===void 0||t.useLighting;let i=new Float32Array([1,1,1]);t.pickingScale!==void 0&&(t.pickingScale instanceof Array?(i[0]=t.pickingScale[0]||i[0],i[1]=t.pickingScale[1]||i[1],i[2]=t.pickingScale[2]||i[2]):typeof t.pickingScale=="number"&&(i[0]=t.pickingScale,i[1]=t.pickingScale,i[2]=t.pickingScale)),this.pickingScale=i,this.async=t.async===void 0||t.async,this.clampToGround=t.clampToGround||!1,this.relativeToGround=t.relativeToGround||!1,this._entities=function(s){let n=[];for(let o=0;o<s.length;o++){let l=s[o];l.instanceName==="Entity"?n.push(l):n.push(new U(l))}return n}(t.entities||[]),this._labelMaxLetters=t.labelMaxLetters||24,this._stripEntityCollection=new ie({pickingEnabled:this.pickingEnabled}),this._bindEventsDefault(this._stripEntityCollection),this._polylineEntityCollection=new ie({pickingEnabled:this.pickingEnabled}),this._bindEventsDefault(this._polylineEntityCollection),this._geoObjectEntityCollection=new ie({pickingEnabled:this.pickingEnabled,useLighting:this._useLighting}),this._bindEventsDefault(this._geoObjectEntityCollection),this._geometryHandler=new Mr(this),this._nodeCapacity=t.nodeCapacity||60,this._entityCollectionsTreeStrategy=null,this.setEntities(this._entities),this.polygonOffsetUnits=t.polygonOffsetUnits!=null?t.polygonOffsetUnits:0,this.pickingEnabled=this._pickingEnabled,this._depthOrder=t.depthOrder||0}get depthOrder(){return this._depthOrder}set depthOrder(e){e!==this._depthOrder&&(this._depthOrder=e,this._planet&&this._planet.updateVisibleLayers())}get useLighting(){return this._useLighting}set useLighting(e){e!==this._useLighting&&(this._geoObjectEntityCollection.useLighting=e,this._useLighting=e)}get labelMaxLetters(){return this._labelMaxLetters}get instanceName(){return"Vector"}_bindPicking(){this._pickingColor.clear()}addTo(e){this._planet||(this._assignPlanet(e),this._geometryHandler.assignHandler(e.renderer.handler),this._polylineEntityCollection.addTo(e,!0),this._stripEntityCollection.addTo(e,!0),this._geoObjectEntityCollection.addTo(e,!0),this._polylineEntityCollection._layer=this,this._stripEntityCollection._layer=this,this._geoObjectEntityCollection._layer=this,this.setEntities(this._entities))}remove(){return super.remove(),this._polylineEntityCollection.remove(),this._stripEntityCollection.remove(),this._geoObjectEntityCollection.remove(),this._polylineEntityCollection._layer=void 0,this._stripEntityCollection._layer=void 0,this._geoObjectEntityCollection._layer=void 0,this}getEntities(){return[].concat(this._entities)}add(e){return e._layer||e._entityCollection||(e._layer=this,e._layerIndex=this._entities.length,this._entities.push(e),this._proceedEntity(e)),this}insert(e,t){if(!e._layer&&!e._entityCollection){e._layer=this,e._layerIndex=t,this._entities.splice(t,0,e);for(let i=t+1,s=this._entities.length;i<s;i++)this._entities[i]._layerIndex=i;this._proceedEntity(e)}return this}_proceedEntity(e){var t;let i=this._hasImageryTiles;e.strip&&this._stripEntityCollection.add(e),(e.polyline||e.ray)&&this._polylineEntityCollection.add(e),(e.geoObject||e.isEmpty)&&this._geoObjectEntityCollection.add(e),e.geometry&&(this._hasImageryTiles=!0,this._planet&&(this._planet.renderer.assignPickingColor(e),this._geometryHandler.add(e.geometry))),this._planet&&((e.billboard||e.label||e.geoObject||e.isEmpty)&&(e._cartesian.isZero()&&!e._lonLat.isZero()?e._setCartesian3vSilent(this._planet.ellipsoid.lonLatToCartesian(e._lonLat)):(e._lonLat=this._planet.ellipsoid.cartesianToLonLat(e._cartesian),Math.abs(e._lonLat.lat)<ht?e._lonLatMerc=e._lonLat.forwardMercator():e._lonLatMerc.lon=e._lonLatMerc.lat=e._lonLatMerc.height=0)),(e.billboard||e.label)&&((t=this._entityCollectionsTreeStrategy)==null||t.insertEntity(e))),this._planet&&this._hasImageryTiles!==i&&this._planet.updateVisibleLayers(),this.events.dispatch(this.events.entityadd,e)}addEntities(e){let t=e.length;for(;t--;)this.add(e[t]);return this}removeEntity(e){if(e._layer&&this.isEqual(e._layer)){if(e.parent||(this._entities.splice(e._layerIndex,1),this._reindexEntitiesArray(e._layerIndex)),e._layer=null,e._layerIndex=-1,e._entityCollection){e._entityCollection._removeEntitySilent(e);let t=e._nodePtr;for(;t;)t.count--,t=t.parentNode;e._nodePtr&&e._nodePtr.count===0&&e._nodePtr.deferredEntities.length===0&&(e._nodePtr.entityCollection=null)}else if(e._nodePtr&&e._nodePtr.deferredEntities.length){let t=e._nodePtr.deferredEntities,i=t.length;for(;i--;)if(t[i].id===e.id){t.splice(i,1);let s=e._nodePtr;for(;s;)s.count--,s=s.parentNode;break}}this._planet&&e.geometry&&(this._geometryHandler.remove(e.geometry),this._planet.renderer.clearPickingColor(e)),e._nodePtr=void 0,this.events.dispatch(this.events.entityremove,e)}return this}set pickingEnabled(e){var t;this._pickingEnabled=e,this._stripEntityCollection.setPickingEnabled(e),this._polylineEntityCollection.setPickingEnabled(e),this._geoObjectEntityCollection.setPickingEnabled(e),(t=this._entityCollectionsTreeStrategy)==null||t.setPickingEnabled(e)}_reindexEntitiesArray(e){const t=this._entities;for(let i=e;i<t.length;i++)t[i]._layerIndex=i}removeEntities(e){let t=e.length;for(;t--;)this.removeEntity(e[t]);return this}clear(){var e;super.clear();let t=new Array(this._entities.length);for(let s=0;s<t.length;s++)t[s]=this._entities[s];let i=this._entities.length;for(;i--;)this._entities[i].remove();this._entities.length=0,this._entities=[];for(let s=0;s<t.length;s++)this._entities[s]=t[s];(e=this._entityCollectionsTreeStrategy)==null||e.dispose(),this._entityCollectionsTreeStrategy=null,this._geometryHandler.clear()}each(e){let t=this._entities,i=t.length;for(;i--;)e(t[i],i)}setEntities(e){let t=new Array(e.length);for(let s=0,n=e.length;s<n;s++)t[s]=e[s];this.clear(),this._entities=new Array(t.length);let i=[];for(let s=0;s<t.length;s++){let n=t[s];n._layer=this,n._layerIndex=s;let o=!(n.strip||n.polyline||n.ray||n.geoObject||n.billboard||n.label);n.strip?this._stripEntityCollection.add(n):n.polyline||n.ray?this._polylineEntityCollection.add(n):n.geoObject||o?this._geoObjectEntityCollection.add(n):(n.billboard||n.label)&&i.push(n),n.geometry&&(this._hasImageryTiles=!0,this._planet&&(this._planet.renderer.assignPickingColor(n),this._geometryHandler.add(n.geometry))),this._entities[s]=n}return this._createEntityCollectionsTree(i),this}_createEntityCollectionsTree(e){this._planet&&(this._entityCollectionsTreeStrategy=this._planet.quadTreeStrategy.createEntityCollectionsTreeStrategy(this,this._nodeCapacity),this._entityCollectionsTreeStrategy.insertEntities(e))}_bindEventsDefault(e){let t=this.events;e.events.on("mousemove",i=>{t.dispatch(t.mousemove,i)}),e.events.on("mouseenter",i=>{t.dispatch(t.mouseenter,i)}),e.events.on("mouseleave",i=>{t.dispatch(t.mouseleave,i)}),e.events.on("lclick",i=>{t.dispatch(t.lclick,i)}),e.events.on("rclick",i=>{t.dispatch(t.rclick,i)}),e.events.on("mclick",i=>{t.dispatch(t.mclick,i)}),e.events.on("ldblclick",i=>{t.dispatch(t.ldblclick,i)}),e.events.on("rdblclick",i=>{t.dispatch(t.rdblclick,i)}),e.events.on("mdblclick",i=>{t.dispatch(t.mdblclick,i)}),e.events.on("lup",i=>{t.dispatch(t.lup,i)}),e.events.on("rup",i=>{t.dispatch(t.rup,i)}),e.events.on("mup",i=>{t.dispatch(t.mup,i)}),e.events.on("ldown",i=>{t.dispatch(t.ldown,i)}),e.events.on("rdown",i=>{t.dispatch(t.rdown,i)}),e.events.on("mdown",i=>{t.dispatch(t.mdown,i)}),e.events.on("lhold",i=>{t.dispatch(t.lhold,i)}),e.events.on("rhold",i=>{t.dispatch(t.rhold,i)}),e.events.on("mhold",i=>{t.dispatch(t.mhold,i)}),e.events.on("mousewheel",i=>{t.dispatch(t.mousewheel,i)}),e.events.on("touchmove",i=>{t.dispatch(t.touchmove,i)}),e.events.on("touchstart",i=>{t.dispatch(t.touchstart,i)}),e.events.on("touchend",i=>{t.dispatch(t.touchend,i)}),e.events.on("doubletouch",i=>{t.dispatch(t.doubletouch,i)}),e.events.on("touchleave",i=>{t.dispatch(t.touchleave,i)}),e.events.on("touchenter",i=>{t.dispatch(t.touchenter,i)})}_collectStripCollectionPASS(e){let t=this._stripEntityCollection;t._fadingOpacity=this._fadingOpacity,t.scaleByDistance=this.scaleByDistance,t.pickingScale=this.pickingScale,t.polygonOffsetUnits=this.polygonOffsetUnits,e.push(t)}_collectPolylineCollectionPASS(e){let t=this._polylineEntityCollection;if(t._fadingOpacity=this._fadingOpacity,t.scaleByDistance=this.scaleByDistance,t.pickingScale=this.pickingScale,t.polygonOffsetUnits=this.polygonOffsetUnits,e.push(t),this.clampToGround||this.relativeToGround){let i=Number(this.relativeToGround);const s=this._planet.quadTreeStrategy._renderedNodes,n=this._planet.getViewExtent();let o=t._entities,l=o.length,h=new m;for(;l--;){let c=o[l]._altitude||0,d=o[l].polyline;if(d&&n.overlaps(d._extent)){let u=d._pathLonLatMerc,f=u.length;for(;f--;){let _=u[f].length;for(;_--;){let g=u[f][_],v=s.length;for(;v--;){let p=s[v].segment;if(p._extent.isInside(g)){let y=d._path3v[f][_];p.getTerrainPoint(y,g,h);let b=i&&d.altitude||c;if(b){let C=this._planet.ellipsoid.getSurfaceNormal3v(h);d.setPoint3v(h.addA(C.scale(b)),_,f,!0)}else d.setPoint3v(h,_,f,!0);break}}}}}}}}_collectGeoObjectCollectionPASS(e){let t=this._geoObjectEntityCollection;t._fadingOpacity=this._fadingOpacity,t.scaleByDistance=this.scaleByDistance,t.pickingScale=this.pickingScale,t.polygonOffsetUnits=this.polygonOffsetUnits,e.push(t)}collectVisibleCollections(e){let t=this._planet;(this._fading&&this._fadingOpacity>0||this.minZoom<=t.quadTreeStrategy.maxCurrZoom&&this.maxZoom>=t.quadTreeStrategy.maxCurrZoom)&&(this._collectStripCollectionPASS(e),this._collectPolylineCollectionPASS(e),this._collectGeoObjectCollectionPASS(e),this._entityCollectionsTreeStrategy&&this._entityCollectionsTreeStrategy.collectVisibleEntityCollections(e))}loadMaterial(e){const t=e.segment;this._isBaseLayer?e.texture=t._isNorth?t.planet.solidTextureOne:t.planet.solidTextureTwo:e.texture=t.planet.transparentTexture,this._planet.layerLock.isFree()&&(e.isReady=!1,e.isLoading=!0,this._planet._vectorTileCreator.add(e))}abortMaterialLoading(e){e.isLoading=!1,e.isReady=!1}applyMaterial(e){if(e.isReady)return[0,0,1,1];{!e.isLoading&&this.loadMaterial(e);const t=e.segment;let i=t.node,s=!1,n=this.__id,o=e;for(;i.parentNode;){if(o&&o.isReady){s=!0;break}i=i.parentNode,o=i.segment.materials[n]}if(s){e.appliedNodeId=i.nodeId,e.texture=o.texture,e.pickingMask=o.pickingMask;const l=1/(2<<t.tileZoom-i.segment.tileZoom-1);return[t.tileX*l-i.segment.tileX,t.tileY*l-i.segment.tileY,l,l]}return e.textureExists&&e._updateTexture?(e.texture=e._updateTexture,e.pickingMask=e._updatePickingMask):(e.texture=t.planet.transparentTexture,e.pickingMask=t.planet.transparentTexture),e.pickingReady=!0,[0,0,1,1]}}clearMaterial(e){if(e.isReady){const t=e.segment.handler.gl;e.isReady=!1,e.pickingReady=!1;let i=e.texture;e.texture=null,i&&!i.default&&t.deleteTexture(i),i=e.pickingMask,e.pickingMask=null,i&&!i.default&&t.deleteTexture(i),i=e._updateTexture,e._updateTexture=null,i&&!i.default&&t.deleteTexture(i),i=e._updatePickingMask,e._updatePickingMask=null,i&&!i.default&&t.deleteTexture(i)}this.abortMaterialLoading(e),e.isLoading=!1,e.textureExists=!1}update(){this._geometryHandler.update(),this.events.dispatch(this.events.draw,this)}}const _l=["draw","entityadd","entityremove"],fl=["change","startpoint"],Sn=W.createCylinder(1,1,2,20,1,!0,!1,0,-.5,0),Bt=200,fi=.3;class ra extends ce{constructor(e){super(e.name),this._cornerDblClick=!1,this._onChange=t=>{if(t.geometryType==="POLYGON"){let i=this.getCoordinates(),s=new U({geometry:{type:t.geometryType,coordinates:[i],style:this._fillStyle}});this._geometryLayer.clear(),this._geometryLayer.add(s)}},this._onCornerMouseEnter=t=>{t.renderer.handler.canvas.style.cursor="pointer",this.hideGhostPointer()},this._onCornerMouseLeave=t=>{t.renderer.handler.canvas.style.cursor="default",this.showGhostPointer()},this._onCenterMouseEnter=t=>{t.renderer.handler.canvas.style.cursor="pointer",this.hideGhostPointer()},this._onCenterMouseLeave=t=>{t.renderer.handler.canvas.style.cursor="default",this._pickedCenter||this._pickedCorner||this.showGhostPointer()},this._onLup=t=>{this._planet.renderer.controls.mouseNavigation.activate(),(this._pickedCorner||this._pickedCenter)&&(this.events.dispatch(this.events.change,this),this.setGhostPointerPosition(this._planet.getCartesianFromPixelTerrain(t)),this.showGhostPointer(),this._pickedCorner=null,this._pickedCenter=null)},this._onCornerLdown=t=>{this._pickedCorner=this._getLdown(t)},this._onCenterLdown=t=>{this._pickedCenter=this._getLdown(t)},this._onMouseMove=t=>{this._pickedCenter?this._moveCenterPoint():this._pickedCorner?this._moveCornerPoint(t.pos):this.setGhostPointerPosition(this._planet.getCartesianFromPixelTerrain(t.pos))},this._onCornerLdblclick=t=>{this._cornerDblClick=!0;let i=this.getCoordinates();i.splice(t.pickingObject.layerIndex,1),this.setCoordinates(i)},this._onMouseDblClick=t=>{if(this._cornerDblClick)return void(this._cornerDblClick=!1);if(!this._showGhostPointer)return;let i=this._planet.getCartesianFromPixelTerrain(t);i&&(this._addNew(i),!this._isStartPoint&&this._cornerLayer.getEntities().length>2&&(this._isStartPoint=!0,this.events.dispatch(this.events.startpoint,this)),this.events.dispatch(this.events.change,this))},this.events=at(fl),this._planet=null,this._initCoordinates=e.coordinates||[],this._pickedCorner=null,this._pickedCenter=null,this._startPos=null,this._startClick=new N,this._geometryLayer=new ut,this._cornerStyle={scale:.5,tag:"corners",color:"rgb(350, 350, 0)",object3d:Sn,...e.cornerStyle||{}},this._centerStyle={scale:.4,tag:"centers",color:"rgb(0, 350, 50)",object3d:Sn,...e.centerStyle||{}},this._outlineStyle={thickness:3.5,color:"rgb(0, 350, 50)",...e.outlineStyle||{}},this._fillStyle={fillColor:"rgba(0,146,247,0.2)",...e.fillStyle||{}},this._cornerLayer=new ut("corners",{pickingScale:3,pickingEnabled:!0,polygonOffsetUnits:-5,relativeToGround:!0,scaleByDistance:[100,4e6,1]}),this._centerLayer=new ut("centers",{pickingScale:3,pickingEnabled:!0,polygonOffsetUnits:-5,relativeToGround:!0,scaleByDistance:[100,4e6,1]}),this._outlineLayer=new ut("outline",{entities:[new U({polyline:{path3v:[],isClosed:!1,...this._outlineStyle}})],pickingEnabled:!1,polygonOffsetUnits:-5,relativeToGround:!0}),this._outlineLayer.getEntities()[0].polyline.altitude=fi,this._ghostCorner=new U({geoObject:this._cornerStyle}),this._ghostOutlineLayer=new ut("ghost-pointer",{pickingEnabled:!1,polygonOffsetUnits:-5,relativeToGround:!0,scaleByDistance:[100,4e6,1],opacity:.5}),this._showGhostPointer=!1,this._isStartPoint=!1,this._insertCornerIndex=-1}get geometryType(){return"POLYGON"}getCoordinates(){let e=this._cornerLayer.getEntities();return e.length>0?e.map(t=>{let i=t.getLonLat();return[i.lon,i.lat,i.height]}):this._initCoordinates}bindPlanet(e){this._planet=e}init(){this._initEvents(),this._initGhostLayerPointer(),this._initCoordinates.length&&this.setCoordinates(this._initCoordinates),this._planet.addLayer(this._outlineLayer),this._planet.addLayer(this._cornerLayer),this._planet.addLayer(this._centerLayer),this.showGhostPointer(),this.startNewPoint(),this._geometryLayer.addTo(this._planet),this.events.on("change",this._onChange,this)}onremove(){this._clearEvents(),this.hideGhostPointer(),this.stopNewPoint(),this.clear(),this._geometryLayer.remove()}clear(){this._geometryLayer.clear();let e=this._cornerLayer.getEntities(),t=e.length;for(;t--;)e[t].remove();let i=this._centerLayer.getEntities();for(t=i.length;t--;)i[t].remove();let s=this._outlineLayer.getEntities();for(t=s.length;t--;)s[t].polyline.clear(),t>0&&s[t].remove();this._clearGhostPointer()}setCoordinates(e){this.clear();for(let t=0;t<e.length;t++){let i=e[t],s=this._planet.ellipsoid.lonLatToCartesian(new A(i[0],i[1],i[2]));this._appendCart(s)}this.events.dispatch(this.events.change,this)}stopNewPoint(){this.renderer&&this.renderer.events.off("ldblclick",this._onMouseDblClick)}startNewPoint(){this.renderer.events.on("ldblclick",this._onMouseDblClick,this)}showGhostPointer(){this._showGhostPointer=!0,this._planet.addLayer(this._ghostOutlineLayer),this._insertCornerIndex=this._cornerLayer.getEntities().length}hideGhostPointer(){this._showGhostPointer=!1,this._ghostOutlineLayer.remove(),this._insertCornerIndex=-1}setGhostPointerPosition(e){e&&(this._ghostCorner.setCartesian3v(e),this._updateGhostOutlinePointer(e))}_getLdown(e){this._planet.renderer.controls.mouseNavigation.deactivate(),this._startClick.set(e.x,e.y);let t=e.pickingObject.getCartesian();return this._startPos=this._planet.getPixelFromCartesian(t),e.pickingObject}_initEvents(){this._cornerLayer.events.on("ldblclick",this._onCornerLdblclick,this),this._cornerLayer.events.on("ldown",this._onCornerLdown,this),this._centerLayer.events.on("ldown",this._onCenterLdown,this),this.renderer.events.on("lup",this._onLup,this),this.renderer.events.on("mousemove",this._onMouseMove,this),this._cornerLayer.events.on("mouseenter",this._onCornerMouseEnter,this),this._cornerLayer.events.on("mouseleave",this._onCornerMouseLeave,this),this._centerLayer.events.on("mouseenter",this._onCenterMouseEnter,this),this._centerLayer.events.on("mouseleave",this._onCenterMouseLeave,this)}_clearEvents(){this._cornerLayer.events.off("ldblclick",this._onCornerLdblclick),this._cornerLayer.events.off("ldown",this._onCornerLdown),this._centerLayer.events.off("ldown",this._onCenterLdown),this.renderer.events.off("lup",this._onLup),this.renderer.events.off("mousemove",this._onMouseMove),this._cornerLayer.events.off("mouseenter",this._onCornerMouseEnter),this._cornerLayer.events.off("mouseleave",this._onCornerMouseLeave),this._centerLayer.events.off("mouseenter",this._onCenterMouseEnter),this._centerLayer.events.off("mouseleave",this._onCenterMouseLeave)}_drawCorners(){let e=this._cornerLayer.getEntities();for(let t=0;t<e.length;t++){let i=e[t];this._checkTerrainCollision(i)}}_drawCenters(){let e=this._centerLayer.getEntities();for(let t=0;t<e.length;t++){let i=e[t];this._checkTerrainCollision(i)}}_drawGhostCorner(){this._showGhostPointer&&this._checkTerrainCollision(this._ghostCorner)}frame(){this._drawCorners(),this._drawCenters(),this._drawGhostCorner()}_checkTerrainCollision(e){let t=new m,i=this._planet.quadTreeStrategy._renderedNodes;for(let s=0;s<i.length;s++){let n=i[s].segment;if(n&&n._extentLonLat.isInside(e.getLonLat())){n.getEntityTerrainPoint(e,t),e.setCartesian3v(t);break}}}_moveCenterPoint(){let e=this.getCoordinates(),t=this._pickedCenter.layerIndex+1,i=this._pickedCenter.getLonLat(),s=[i.lon,i.lat,i.height];e.splice(t,0,s),this.setCoordinates(e),this._pickedCenter=null,this._pickedCorner=this._cornerLayer.getEntities()[t]}_addNew(e){if(this._insertCornerIndex===-1||this._cornerLayer.getEntities().length<2)this._appendCart(e);else{let t=this.getCoordinates(),i=this._insertCornerIndex,s=this._planet.ellipsoid.cartesianToLonLat(e),n=[s.lon,s.lat,s.height];t.splice(i,0,n),this.clear(),this.setCoordinates(t)}}_appendCart(e){let t=this._cornerLayer.getEntities(),i=t[t.length-1],s=new U({geoObject:this._cornerStyle});if(s.setCartesian3v(e),s.addTo(this._cornerLayer),this._checkTerrainCollision(s),i){let n=t[0].getCartesian(),o=i.getCartesian(),l=s.getCartesian().sub(o),h=s.getCartesian().sub(n),c=l.length(),d=h.length();l.normalize(),h.normalize();let u=[],f=[];for(let C=0;C<=Bt;C++){let T=l.scaleTo(C*c/Bt).addA(o);u.push(T);let w=h.scaleTo(C*d/Bt).addA(n);f.push(w)}this._outlineLayer.getEntities()[0].polyline.setPath3v([f]);let _=new U({polyline:{path3v:[u],isClosed:!1,...this._outlineStyle}});_.polyline.altitude=fi,this._outlineLayer.add(_);let g=this._centerLayer.getEntities(),v=g[g.length-1],p=l.scaleTo(.5*c).addA(o),y=h.scaleTo(.5*d).addA(n),b=new U({geoObject:this._centerStyle});b.setCartesian3v(p),b.addTo(this._centerLayer),this._checkTerrainCollision(b),v.remove(),v.addTo(this._centerLayer),v.setCartesian3v(y)}else new U({geoObject:this._centerStyle}).addTo(this._centerLayer)}_clearGhostPointer(){const e=this._ghostOutlineLayer;e.getEntities()[0].polyline.clear(),e.getEntities()[1].polyline.clear()}_moveCornerPoint(e){let t=new N(e.x,e.y).sub(this._startClick),i=this._startPos.add(t),s=this._planet.getCartesianFromPixelTerrain(i);if(s){this._pickedCorner.setCartesian3v(s);let n=this._cornerLayer.getEntities();if(n.length){let o=this._pickedCorner.layerIndex,l=n.length,h=n[o===0?l-1:o-1].getCartesian(),c=n[(o+1)%l].getCartesian(),d=this._pickedCorner.getCartesian().sub(h),u=this._pickedCorner.getCartesian().sub(c),f=d.length(),_=u.length();d.normalize(),u.normalize();let g=[],v=[];for(let P=0;P<=Bt;P++){let B=d.scaleTo(P*f/Bt).addA(h);g.push(B);let k=u.scaleTo(P*_/Bt).addA(c);v.push(k)}let p=this._outlineLayer.getEntities(),y=p[o].polyline,b=p[(o+1)%l].polyline;y==null||y.setPath3v([g]),b==null||b.setPath3v([v]);let C=this._centerLayer.getEntities(),T=C[o===0?l-1:o-1],w=C[o],L=d.scaleTo(.5*f).addA(h),S=u.scaleTo(.5*_).addA(c);T.setCartesian3v(L),this._checkTerrainCollision(T),w.setCartesian3v(S),this._checkTerrainCollision(w)}}}_updateGhostOutlinePointer(e){let t=this._cornerLayer.getEntities(),i=t.length;if(i>0){let s=0,n=yt;for(let k=0;k<i;k++){let I=t[k].getCartesian().distance(e);I<n&&(n=I,s=k)}let o=t[s].getCartesian(),l=t[(s+1)%i].getCartesian(),h=t[s===0?i-1:s-1].getCartesian().sub(o).normalize(),c=l.sub(o).normalize(),d=e.sub(o).normalize(),u=h.add(c).normalize(),f=d.cross(u),_=h.cross(c);f.dot(_)>0&&(s--,s<0&&(s=i-1));let g=new m;for(let k=0;k<i;k++)if(new Qt(t[k].getCartesian(),t[(k+1)%i].getCartesian()).getNearestDistancePoint(e,g)){let I=g.distance(e);I<n&&(n=I,s=k)}this._insertCornerIndex=(s+1)%i;let v=t[s%i].getCartesian(),p=t[(s+1)%i].getCartesian(),y=this._ghostCorner.getCartesian().sub(v),b=this._ghostCorner.getCartesian().sub(p),C=y.length(),T=b.length();y.normalize(),b.normalize();let w=[],L=[];for(let k=0;k<=Bt;k++){let I=y.scaleTo(k*C/Bt).addA(v);w.push(I);let z=b.scaleTo(k*T/Bt).addA(p);L.push(z)}let S=this._ghostOutlineLayer.getEntities(),P=S[0].polyline,B=S[1].polyline;P==null||P.setPath3v([w]),B==null||B.setPath3v([L])}}_initGhostLayerPointer(){this._ghostOutlineLayer.setEntities([new U({polyline:{path3v:[],isClosed:!1,...this._outlineStyle}}),new U({polyline:{path3v:[],isClosed:!1,...this._outlineStyle}}),this._ghostCorner]);const e=this._ghostOutlineLayer;e.getEntities()[0].polyline.altitude=e.getEntities()[1].polyline.altitude=fi}}class Rn extends ra{constructor(e){super(e)}get geometryType(){return"LineString"}_addNew(e){this._appendCart(e)}_appendCart(e){let t=this._cornerLayer.getEntities(),i=t[t.length-1],s=new U({geoObject:this._cornerStyle});if(s.setCartesian3v(e),s.addTo(this._cornerLayer),this._checkTerrainCollision(s),i){let n=i.getCartesian(),o=s.getCartesian().sub(n),l=o.length();o.normalize();let h=[];for(let f=0;f<=Bt;f++){let _=o.scaleTo(f*l/Bt).addA(n);h.push(_)}let c=new U({polyline:{path3v:[h],isClosed:!1,...this._outlineStyle}});c.polyline.altitude=fi,this._outlineLayer.add(c);let d=o.scaleTo(.5*l).addA(n),u=new U({geoObject:this._centerStyle});u.setCartesian3v(d),u.addTo(this._centerLayer),this._checkTerrainCollision(u)}}_clearGhostPointer(){this._ghostOutlineLayer.getEntities()[0].polyline.clear()}_moveCorner(e,t,i){let s=this._cornerLayer.getEntities();if(s.length==0)return;s.length==1&&(e=t=i=0);let n=s[e].getCartesian(),o=this._pickedCorner.getCartesian().sub(n),l=o.length();o.normalize();let h=[];for(let u=0;u<=Bt;u++){let f=o.scaleTo(u*l/Bt).addA(n);h.push(f)}let c=this._outlineLayer.getEntities()[t].polyline;c==null||c.setPath3v([h]);let d=this._centerLayer.getEntities()[i];if(d){let u=o.scaleTo(.5*l).addA(n);d.setCartesian3v(u),this._checkTerrainCollision(d)}}_moveCornerPoint(e){let t=new N(e.x,e.y).sub(this._startClick),i=this._startPos.add(t),s=this._planet.getCartesianFromPixelTerrain(i);if(s){this._pickedCorner.setCartesian3v(s);let n=this._cornerLayer.getEntities();if(n.length){let o=this._pickedCorner.layerIndex;o===0?this._moveCorner(o+1,o+1,o):(o===n.length-1||this._moveCorner(o+1,o+1,o),this._moveCorner(o-1,o,o-1))}}}_updateGhostOutlinePointer(e){let t=this._cornerLayer.getEntities(),i=t.length;if(i>0){let s=i-1;this._insertCornerIndex=s;let n=t[s].getCartesian(),o=this._ghostCorner.getCartesian().sub(n),l=o.length();o.normalize();let h=[];for(let c=0;c<=Bt;c++){let d=o.scaleTo(c*l/Bt).addA(n);h.push(d)}this._ghostOutlineLayer.getEntities()[0].polyline.setPath3v([h])}}_initGhostLayerPointer(){this._ghostOutlineLayer.setEntities([new U({polyline:{path3v:[],isClosed:!1,...this._outlineStyle}}),this._ghostCorner]),this._ghostOutlineLayer.getEntities()[0].polyline.altitude=fi}}class Mn extends Z{constructor(e={}){super(e),this._drawingScene=new Rn({name:`drawingScene:${this.__id}`,cornerStyle:e.cornerStyle||{},centerStyle:e.centerStyle||{},outlineStyle:e.outlineStyle||{},fillStyle:e.fillStyle||{}})}activatePolygonDrawing(){this.deactivate(),this._drawingScene=new ra({name:`polygonDrawingScene:${this.__id}`,cornerStyle:this._drawingScene._cornerStyle,centerStyle:this._drawingScene._centerStyle,outlineStyle:this._drawingScene._outlineStyle,fillStyle:this._drawingScene._fillStyle}),this.activate()}activateLineStringDrawing(){this.deactivate(),this._drawingScene=new Rn({name:`linestringDrawingScene:${this.__id}`,cornerStyle:this._drawingScene._cornerStyle,centerStyle:this._drawingScene._centerStyle,outlineStyle:this._drawingScene._outlineStyle,fillStyle:this._drawingScene._fillStyle}),this.activate()}oninit(){}onactivate(){this.planet&&this._drawingScene.bindPlanet(this.planet),this.renderer&&this.renderer.addNode(this._drawingScene)}ondeactivate(){this.renderer&&this.renderer.removeNode(this._drawingScene)}}const ai={ell:0,msl:1,gnd:2},tn=.3048,gl=1/tn,pl=1/3.6,na=.001*tn,ml=1/na,vl=["m","km","ft","s","h","m/s","km/h","ft/s"],oa=[0,2,0,0,0,0,0,0];let gt=[];function aa(a,e,t){return gt[a][e](t)}function Br(a,e,t,i,s){return a?aa(e,t,i).toFixed(s||oa[t]):"--"}function la(a){return vl[a]}gt[0]=[],gt[0][0]=a=>a,gt[0][1]=a=>.001*a,gt[0][2]=a=>a*gl,gt[2]=[],gt[2][0]=a=>a*tn,gt[2][1]=a=>a*na,gt[2][2]=a=>a,gt[1]=[],gt[1][0]=a=>1e3*a,gt[1][1]=a=>a,gt[1][2]=a=>a*ml,gt[5]=[],gt[5][5]=a=>a,gt[5][6]=a=>3.6*a,gt[5][7]=a=>3.28084*a,gt[6]=[],gt[6][5]=a=>a*pl,gt[6][6]=a=>a;const Bn=Object.freeze(Object.defineProperty({__proto__:null,ELL:0,GND:2,MSL:1,_tenth:oa,convert:aa,convertExt:Br,ft:2,fts:7,h:4,heightMode:ai,km:1,kmh:6,m:0,ms:5,s:3,toString:la},Symbol.toStringTag,{value:"Module"})),yl=[`<div class="og-lat-side"></div><div class="og-lat-val"></div>
    <div class="og-lon-side"></div><div class="og-lon-val"></div>
    <div class="og-height"></div>
    <div class="og-units-height"></div>`,`<div class="og-lat-side"></div><div class="og-lat-val"></div>
    <div class="og-lon-side"></div><div class="og-lon-val"></div>
    <div class="og-height"></div>
    <div class="og-units-height"></div>`];class ha extends Z{constructor(e={}){super(e),this._type=e.type||0,this._TYPE_FUNC=[this._SHOW_DECIMAL,this._SHOW_DEGREE],this._showFn=null,this._el=null,this._latSideEl=null,this._lonSideEl=null,this._latValEl=null,this._lonValEl=null,this._heightEl=null,this._altUnitVal=e.altitudeUnit||"m",this._heightModeVal=e.heightMode||"ell",this._altUnit=Bn[this._altUnitVal],this._heightMode=ai[this._heightModeVal],this._lonLat=null,this._centerMode=!1}_SHOW_DECIMAL(e){if(e){let t=e.lat,i=e.lon;this._latSideEl.innerHTML=t>=0?"N":"S",this._lonSideEl.innerHTML=i>=0?"E":"W",this._latValEl.innerHTML=Math.abs(t).toFixed(7)+"",this._lonValEl.innerHTML=Math.abs(i).toFixed(7)+""}}_SHOW_DEGREE(e){if(e){let t=e.lat,i=e.lon;this._latSideEl.innerHTML=t>=0?"N":"S",this._lonSideEl.innerHTML=i>=0?"E":"W";let s=0,n=t<0?Math.ceil(t):Math.floor(t),o=Math.floor(s=60*Math.abs(t-n)),l=Math.floor(6e3*(s-o))/100;this._latValEl.innerHTML=Math.abs(n)+""+o+"'"+l.toFixed(0)+'"',n=i<0?Math.ceil(i):Math.floor(i),o=Math.floor(s=60*Math.abs(i-n)),l=Math.floor(6e3*(s-o))/100,this._lonValEl.innerHTML=Math.abs(n)+""+o+"'"+l.toFixed(0)+'"'}}_createCenterEl(){let e=document.createElement("div");return e.className="og-center-icon",e.innerHTML='<svg width="12" height="12"><g><path stroke-width="1" stroke-opacity="1" d="M6 0L6 12M0 6L12 6" stroke="#337ab7"></path></g></svg>',e}_updateUnits(){this._heightMode=ai[this._heightModeVal],this._altUnit=Bn[this._altUnitVal],this._el.querySelector(".og-units-height").innerHTML=la(this._altUnit),this._showHeight()}_refreshCoordinates(){this._type>=this._TYPE_FUNC.length&&(this._type=0);let e=this._el;e.innerHTML=yl[this._type],this._latSideEl=e.querySelector(".og-lat-side"),this._lonSideEl=e.querySelector(".og-lon-side"),this._latValEl=e.querySelector(".og-lat-val"),this._lonValEl=e.querySelector(".og-lon-val"),this._heightEl=e.querySelector(".og-height"),this._showFn=this._TYPE_FUNC[this._type],this._showFn(this._lonLat)}oninit(){this._el=document.createElement("div"),this._el.classList.add("og-coordinates"),this.renderer.div.appendChild(this._el),this._el.addEventListener("click",()=>{this._type++,this._refreshCoordinates(),this._updateUnits(),this._showHeight()}),this._centerMode?(this.renderer.div.appendChild(this._createCenterEl()),this.planet.camera.events.on("moveend",this._grabCoordinates,this),this.planet.camera.events.on("moveend",vi(()=>this._showHeight(),400,!0),this)):(this.renderer.events.on("mousemove",this._grabCoordinates,this),this.renderer.events.on("mousestop",vi(()=>this._showHeight(),400,!0),this)),this._refreshCoordinates(),this._updateUnits()}_grabCoordinates(e){let t,i=e.pos,s=this.renderer;t=this._centerMode?s.handler.getCenter():i,this._lonLat=this.planet.getLonLatFromPixelTerrain(t)||null,this._showFn(this._lonLat)}async _showHeight(){if(this._lonLat&&this.planet){let e=0;this._heightEl.style.opacity="0.7",this._heightMode===ai.ell?(e=await this.planet.getHeightAboveELL(this._lonLat),e=Number(Br(!0,0,this._altUnit,e))):this._heightMode===ai.msl&&(e=await this.planet.getHeightDefault(this._lonLat),e=Number(Br(!0,0,this._altUnit,e))),this._heightEl.style.opacity="1.0",this._heightEl.innerHTML=e.toString()}}}const xl=["loadend"];class Ei extends It{constructor(e,t={}){super(e,t),this.events=this.events.registerNames(xl),this._projType=0,this._frameWidth=256,this._frameHeight=256,this._sourceReady=!1,this._sourceTexture=null,this._materialTexture=null,this._gridBufferLow=null,this._gridBufferHigh=null,this._extentWgs84ParamsHigh=new Float32Array(4),this._extentWgs84ParamsLow=new Float32Array(4),this._extentMercParamsHigh=new Float32Array(4),this._extentMercParamsLow=new Float32Array(4),this._refreshFrame=!0,this._frameCreated=!1,this._sourceCreated=!1,this._animate=!1,this._ready=!1,this._creationProceeding=!1,this._isRendering=!1,this._extentWgs84=new V,this._cornersWgs84=[],this._cornersMerc=[],this._isFullExtent=t.fullExtent?1:0,this.rendering=this._renderingProjType0.bind(this),this._onLoadend_=null,t.corners&&this.setCorners(t.corners)}get isIdle(){return super.isIdle&&this._ready}addTo(e){return this._onLoadend_=this._onLoadend.bind(this),this.events.on("loadend",this._onLoadend_,this),super.addTo(e)}_onLoadend(){this._planet&&this._planet.events.dispatch(this._planet.events.layerloadend,this)}remove(){return this.events.off("loadend",this._onLoadend_),this._onLoadend_=null,super.remove()}get instanceName(){return"BaseGeoImage"}getCornersLonLat(){let e=this._cornersWgs84;return[new A(e[0].lon,e[0].lat),new A(e[1].lon,e[1].lat),new A(e[2].lon,e[2].lat),new A(e[3].lon,e[3].lat)]}getCorners(){let e=this._cornersWgs84;return[[e[0].lon,e[0].lat],[e[1].lon,e[1].lat],[e[2].lon,e[2].lat],[e[3].lon,e[3].lat]]}setCorners(e){this.setCornersLonLat(A.join(e))}setCornersLonLat(e){this._refreshFrame=!0,this._cornersWgs84=[e[0].clone(),e[1].clone(),e[2].clone(),e[3].clone()];for(let i=0;i<this._cornersWgs84.length;i++)this._cornersWgs84[i].lat>=89.9&&(this._cornersWgs84[i].lat=89.9),this._cornersWgs84[i].lat<=-89.9&&(this._cornersWgs84[i].lat=-89.9);this._extent.setByCoordinates(this._cornersWgs84);let t=this._extent;t.southWest.lat>ht||t.northEast.lat<Ft?(this._projType=0,this.rendering=this._renderingProjType0):(this._projType=1,this.rendering=this._renderingProjType1),this._ready&&!this._creationProceeding&&this._planet._geoImageCreator.add(this)}_createFrame(){this._extentWgs84=this._extent.clone(),this._cornersMerc=[this._cornersWgs84[0].forwardMercatorEPS01(),this._cornersWgs84[1].forwardMercatorEPS01(),this._cornersWgs84[2].forwardMercatorEPS01(),this._cornersWgs84[3].forwardMercatorEPS01()],this._extentMerc=new V(this._extentWgs84.southWest.forwardMercatorEPS01(),this._extentWgs84.northEast.forwardMercatorEPS01());let e=new Float32Array(2);if(this._projType===0?(oe(this._extentWgs84.southWest.lon,e),this._extentWgs84ParamsHigh[0]=e[0],this._extentWgs84ParamsLow[0]=e[1],oe(this._extentWgs84.southWest.lat,e),this._extentWgs84ParamsHigh[1]=e[0],this._extentWgs84ParamsLow[1]=e[1],this._extentWgs84ParamsHigh[2]=2/this._extentWgs84.getWidth(),this._extentWgs84ParamsHigh[3]=2/this._extentWgs84.getHeight()):(oe(this._extentMerc.southWest.lon,e),this._extentMercParamsHigh[0]=e[0],this._extentMercParamsLow[0]=e[1],oe(this._extentMerc.southWest.lat,e),this._extentMercParamsHigh[1]=e[0],this._extentMercParamsLow[1]=e[1],this._extentMercParamsHigh[2]=2/this._extentMerc.getWidth(),this._extentMercParamsHigh[3]=2/this._extentMerc.getHeight()),this._planet){let t=this._planet.renderer.handler;t.gl.deleteTexture(this._materialTexture),this._materialTexture=t.createEmptyTexture_l(this._frameWidth,this._frameHeight);let i=this._planet._geoImageCreator.createGridBuffer(this._cornersWgs84,this._projType===1);this._gridBufferHigh=i[0],this._gridBufferLow=i[1],this._refreshFrame=!1}}abortMaterialLoading(e){this._creationProceeding=!1,e.isLoading=!1,e.isReady=!1}clear(){let e=this._planet;if(e){let t=e.renderer.handler.gl;this._creationProceeding&&e._geoImageCreator.remove(this),e._clearLayerMaterial(this),t&&(t.deleteBuffer(this._gridBufferHigh),t.deleteBuffer(this._gridBufferLow),t.deleteTexture(this._sourceTexture),this._materialTexture&&!this._materialTexture.default&&t.deleteTexture(this._materialTexture))}this._sourceTexture=null,this._materialTexture=null,this._gridBufferHigh=null,this._gridBufferLow=null,this._refreshFrame=!0,this._sourceCreated=!1,this._ready=!1,this._creationProceeding=!1}setVisibility(e){e!==this._visibility&&(super.setVisibility(e),this._planet&&this._sourceReady&&(e?this._planet._geoImageCreator.add(this):this._planet._geoImageCreator.remove(this)))}clearMaterial(e){e.texture=null,e.isLoading=!1,e.isReady=!1}applyMaterial(e){let t,i,s=e.segment;this._ready?e.applyTexture(this._materialTexture):(e.texture=this._planet.transparentTexture,!this._creationProceeding&&this.loadMaterial(e)),this._projType===0?(t=this._extentWgs84,i=s._extent):(t=this._extentMerc,i=s.getExtentMerc());let n=t.northEast.lon-t.southWest.lon,o=t.northEast.lat-t.southWest.lat;return[(i.southWest.lon-t.southWest.lon)/n,(t.northEast.lat-i.northEast.lat)/o,(i.northEast.lon-i.southWest.lon)/n,(i.northEast.lat-i.southWest.lat)/o]}get getFrameWidth(){return this._frameWidth}get getFrameHeight(){return this._frameHeight}_createSourceTexture(){}_renderingProjType1(){let e=this._planet,t=e.renderer.handler,i=t.gl,s=e._geoImageCreator;this._refreshFrame&&this._createFrame(),this._createSourceTexture();let n=s._framebuffer;n.setSize(this._frameWidth,this._frameHeight),n.activate(),t.programs.geoImageTransform.activate();let o=t.programs.geoImageTransform._program,l=o.attributes,h=o.uniforms;i.disable(i.CULL_FACE),n.bindOutputTexture(this._materialTexture),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.uniform1i(h.isFullExtent,this._isFullExtent),i.bindBuffer(i.ARRAY_BUFFER,s._texCoordsBuffer),i.vertexAttribPointer(l.texCoords,2,i.UNSIGNED_SHORT,!0,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._gridBufferHigh),i.vertexAttribPointer(l.cornersHigh,this._gridBufferHigh.itemSize,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._gridBufferLow),i.vertexAttribPointer(l.cornersLow,this._gridBufferLow.itemSize,i.FLOAT,!1,0,0),i.uniform4fv(h.extentParamsHigh,this._extentMercParamsHigh),i.uniform4fv(h.extentParamsLow,this._extentMercParamsLow),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this._sourceTexture),i.uniform1i(h.sourceTexture,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,s._indexBuffer),i.drawElements(i.TRIANGLE_STRIP,s._indexBuffer.numItems,i.UNSIGNED_INT,0),n.deactivate(),i.enable(i.CULL_FACE),this._ready=!0,this._creationProceeding=!1}_renderingProjType0(){let e=this._planet,t=e.renderer.handler,i=t.gl,s=e._geoImageCreator;this._refreshFrame&&this._createFrame(),this._createSourceTexture();let n=s._framebuffer;n.setSize(this._frameWidth,this._frameHeight),n.activate(),t.programs.geoImageTransform.activate();let o=t.programs.geoImageTransform._program,l=o.attributes,h=o.uniforms;i.disable(i.CULL_FACE),n.bindOutputTexture(this._materialTexture),i.clearColor(0,0,0,0),i.clear(i.COLOR_BUFFER_BIT),i.bindBuffer(i.ARRAY_BUFFER,s._texCoordsBuffer),i.vertexAttribPointer(l.texCoords,2,i.UNSIGNED_SHORT,!0,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._gridBufferHigh),i.vertexAttribPointer(l.cornersHigh,this._gridBufferHigh.itemSize,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this._gridBufferLow),i.vertexAttribPointer(l.cornersLow,this._gridBufferLow.itemSize,i.FLOAT,!1,0,0),i.uniform4fv(h.extentParamsHigh,this._extentWgs84ParamsHigh),i.uniform4fv(h.extentParamsLow,this._extentWgs84ParamsLow),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this._sourceTexture),i.uniform1i(h.sourceTexture,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,s._indexBuffer),i.drawElements(i.TRIANGLE_STRIP,s._indexBuffer.numItems,i.UNSIGNED_INT,0),n.deactivate(),i.enable(i.CULL_FACE),this._ready=!0,this._creationProceeding=!1}}const Y={MB_LEFT:0,MB_RIGHT:2,MB_MIDDLE:1,KEY_CTRL:17,KEY_ALT:18,KEY_SHIFT:16,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_PRINTSCREEN:44,KEY_A:65,KEY_D:68,KEY_E:69,KEY_Q:81,KEY_S:83,KEY_W:87,KEY_X:88,KEY_APOSTROPHE:192},bl=["change","idle","play","pause","stop"];class wl extends dt{constructor(e){super({template:zt('<button title={title} class="og-layerSwitcher__layerButton">{icon}<div class="og-layerSwitcher__name">{name}</div></button>',{title:e.model.name,name:e.model.name,icon:e.model.iconSrc?`<img src="${e.model.iconSrc}" />`:""}),...e}),this._onVisibilityChange=t=>{this.el&&(this.model.getVisibility()?this.el.classList.add("og-layerSwitcher__visible"):this.el.classList.remove("og-layerSwitcher__visible"))},this._onClick=()=>{this.model.isBaseLayer()?this.model.setVisibility(!0):this.model.setVisibility(!this.model.getVisibility())},this._onDblClick=()=>{this.model.flyExtent()}}render(e){return super.render(e),this.model.events.on("visibilitychange",this._onVisibilityChange),this._onVisibilityChange(this.model),this.el.addEventListener("click",this._onClick),this.el.addEventListener("dblclick",this._onDblClick),this}remove(){super.remove(),this.model.events.off("visibilitychange",this._onVisibilityChange)}}const Tl=["change"];class K extends dt{constructor(e={}){super({template:zt(`<div class="og-slider">
      <div class="og-slider-label">{label}</div>
      <div class="og-slider-panel">
        <div class="og-slider-progress"></div>      
        <div class="og-slider-pointer"></div>
      </div>
      <input type="number"/>
    </div>`,{label:e.label||""})}),this._onResize=()=>{this._setOffset((this._value-this._min)*this.$panel.clientWidth/(this._max-this._min))},this._onMouseWheel=t=>{(t=t||window.event).preventDefault(),t.stopPropagation(),this.value=this._value+Math.sign(t.wheelDelta)*(this._max-this._min)/100},this._onMouseWheelFF=t=>{this._onMouseWheel(t)},this._onInput=t=>{(t=t||window.event).preventDefault(),t.stopPropagation(),this.value=parseFloat(t.target.value)},this._onMouseDown=t=>{(t=t||window.event).preventDefault(),this._startPosX=t.clientX,this.value=this._min+(this._max-this._min)*(t.offsetX/this.$panel.clientWidth),document.addEventListener("mousemove",this._onMouseMove),document.addEventListener("mouseup",this._onMouseUp)},this._onMouseMove=t=>{(t=t||window.event).preventDefault(),t.stopPropagation();let i=this.$panel.getBoundingClientRect(),s=Xi(t.clientX,i.left,i.right),n=this._startPosX-s;this._startPosX=s,this.value=this._value-n*(this._max-this._min)/this.$panel.clientWidth},this._onMouseUp=()=>{document.removeEventListener("mouseup",this._onMouseUp),document.removeEventListener("mousemove",this._onMouseMove)},this.events=this.events.registerNames(Tl),this._value=e.value||0,this._min=e.min||0,this._max=e.max||1,this._resizeObserver=new ResizeObserver(this._onResize),this._startPosX=0,this.$label=null,this.$pointer=null,this.$progress=null,this.$input=null,this.$panel=null}render(e){return super.render(e),this.$label=this.select(".og-slider-label"),this.$label.innerHTML===""&&(this.$label.style.display="none"),this.$pointer=this.select(".og-slider-pointer"),this.$progress=this.select(".og-slider-progress"),this.$panel=this.select(".og-slider-panel"),this.$input=this.select("input"),this._resizeObserver.observe(this.el),this._initEvents(),this}set value(e){e!==this._value&&(this._value=Xi(e,this._min,this._max),this.$input.value=this._value.toString(),this._setOffset((this._value-this._min)*this.$panel.clientWidth/(this._max-this._min)),this.events.dispatch(this.events.change,this._value,this))}get value(){return this._value}_initEvents(){this.$panel.addEventListener("mousedown",this._onMouseDown),this.$panel.addEventListener("mousewheel",this._onMouseWheel),this.$panel.addEventListener("wheel",this._onMouseWheelFF),this.$input.addEventListener("input",this._onInput)}_clearEvents(){this.$panel.removeEventListener("mousedown",this._onMouseDown),this.$panel.removeEventListener("mousewheel",this._onMouseWheel),this.$panel.removeEventListener("wheel",this._onMouseWheelFF),this.$input.removeEventListener("input",this._onInput)}_setOffset(e){e>=0&&e<=this.$panel.clientWidth&&(this.$pointer.style.left=this.$progress.style.width=100*e/this.$panel.clientWidth+"%")}remove(){this._clearEvents(),super.remove()}}const Cl=["input"];let El=0;class kn extends dt{constructor(e={}){super({template:zt(`<div class="og-color">
      <label for="{id}" class="og-color-label">{label}</label>
      <input type="color" name="{id}" value="{value}"/>
    </div>`,{id:"color-"+El++,label:e.label||"",value:e.value||"#000000"})}),this._onInput=t=>{this.value=t.target.value},this.events=this.events.registerNames(Cl),this._value=e.value||"blue",this.$label=null,this.$input=null}render(e){return super.render(e),this.$label=this.select(".og-color-label"),this.$label.innerHTML===""&&(this.$label.style.display="none"),this.$input=this.select("input"),this._initEvents(),this}set value(e){e!==this._value&&(this._value=e,this.$input.value=this._value,this.events.dispatch(this.events.input,this._value,this))}get value(){return this._value}_initEvents(){this.$input.addEventListener("input",this._onInput)}_clearEvents(){this.$input.removeEventListener("input",this._onInput)}remove(){this._clearEvents(),super.remove()}}class kr{constructor(){this._lock=0}lock(e){this._lock|=1<<e.id}free(e){this._lock&=~(1<<e.id)}isFree(){return this._lock===0}isLocked(){return this._lock!==0}}const Ls=class Z0{constructor(){this.__id=Z0.__counter__++}get id(){return this.__id}};Ls.__counter__=0;let Re=Ls;class en extends Z{constructor(e={}){super(e),this._deactivate=!1,this._shiftBusy=!1,this._name="mouseNavigation",this.grabbedPoint=new m,this._eye0=new m,this.pointOnEarth=new m,this.earthUp=new m,this.inertia=.007,this.grabbedSpheroid=new Dt,this.qRot=new D,this.scaleRot=0,this.distDiff=.3,this.stepsCount=8,this.stepsForward=null,this.stepIndex=0,this._lmbDoubleClickActive=!0,this.minSlope=e.minSlope||.1,this._wheelDirection=1,this._keyLock=new Re}static getMovePointsFromPixelTerrain(e,t,i,s,n,o,l){const h=[];let c=e.eye.clone(),d=e.getBackward(),u=e.getRight(),f=e.getUp(),_=t.getCartesianFromPixelTerrain(n);if(_||(_=t.getCartesianFromPixelTerrain(t.renderer.handler.getCenter())),_){l||(l=m.sub(_,e.eye).normalize());let g=s*e.eye.distance(_)/i;g*=o?-1.25:2;const v=d.scaleTo(g);if(l.dot(e.eye.normal().negate())>=.1){const p=new Dt;p.radius=_.length();let y=[],b=[],C=!1;for(let T=0;T<i;T++){c.addA(v);const w=new H(c,l).hitSphere(p);if(b[T]=c.clone(),!w){C=!0;break}y[T]=new J().rotateBetweenVectors(_.normal(),w.normal())}if(C){c=e.eye.clone();for(let T=0;T<i;T++)h[T]={eye:c.addA(v).clone(),v:f,u,n:d}}else for(let T=0;T<i;T++){let w=y[T];h[T]={eye:w.mulVec3(b[T]),v:w.mulVec3(f),u:w.mulVec3(u),n:w.mulVec3(d)}}}else for(let p=0;p<i;p++)h[p]={eye:c.addA(l.scaleTo(-g)).clone(),v:f,u,n:d};return h}}onactivate(){this.renderer&&(this.renderer.events.on("mousewheel",this.onMouseWheel,this),this.renderer.events.on("lhold",this.onMouseLeftButtonDown,this),this.renderer.events.on("rhold",this.onMouseRightButtonDown,this),this.renderer.events.on("ldown",this.onMouseLeftButtonClick,this),this.renderer.events.on("lup",this.onMouseLeftButtonUp,this),this.renderer.events.on("rdown",this.onMouseRightButtonClick,this),this.renderer.events.on("draw",this.onDraw,this,-1e3),this.renderer.events.on("mousemove",this.onMouseMove,this),this.renderer.events.on("mouseleave",this.onMouseLeave,this),this.renderer.events.on("mouseenter",this.onMouseEnter,this),this._lmbDoubleClickActive&&this.renderer.events.on("ldblclick",this.onMouseLeftButtonDoubleClick,this))}ondeactivate(){this.renderer&&(this.renderer.events.off("mousewheel",this.onMouseWheel),this.renderer.events.off("lhold",this.onMouseLeftButtonDown),this.renderer.events.off("rhold",this.onMouseRightButtonDown),this.renderer.events.off("ldown",this.onMouseLeftButtonClick),this.renderer.events.off("lup",this.onMouseLeftButtonUp),this.renderer.events.off("rdown",this.onMouseRightButtonClick),this.renderer.events.off("draw",this.onDraw),this.renderer.events.off("ldblclick",this.onMouseLeftButtonDoubleClick),this.renderer.events.off("mouseleave",this.onMouseLeave),this.renderer.events.off("mouseenter",this.onMouseEnter))}activateDoubleClickZoom(){this._lmbDoubleClickActive||(this._lmbDoubleClickActive=!0,this.renderer&&this.renderer.events.on("ldblclick",this.onMouseLeftButtonDoubleClick,this))}deactivateDoubleClickZoom(){this._lmbDoubleClickActive&&(this._lmbDoubleClickActive=!1,this.renderer&&this.renderer.events.off("ldblclick",this.onMouseLeftButtonDoubleClick))}onMouseEnter(e){const t=this.renderer.events;t.isKeyPressed(Y.KEY_ALT)&&t.releaseKeys(),t.updateButtonsStates(e.sys.buttons),t.mouseState.leftButtonDown?this.renderer.handler.canvas.classList.add("ogGrabbingPoiner"):this.renderer.handler.canvas.classList.remove("ogGrabbingPoiner")}onMouseLeave(){this.renderer.events.mouseState.leftButtonDown&&(this.scaleRot=0),this.renderer.handler.canvas.classList.remove("ogGrabbingPoiner")}onMouseWheel(e){this.stepIndex||(this.planet.stopFlying(),this.stopRotation(),this._deactivate=!0,this.lockPlanet(!0),this.stepsForward=en.getMovePointsFromPixelTerrain(this.planet.camera,this.planet,this.stepsCount,this.distDiff,e.pos,e.wheelDelta>0,e.direction)||null,this._wheelDirection=e.wheelDelta,this.stepsForward&&(this.stepIndex=this.stepsCount))}oninit(){this.activate(),this.renderer&&(this.renderer.events.on("keyfree",Y.KEY_ALT,this.onShiftFree,this),this.renderer.events.on("keyfree",Y.KEY_PRINTSCREEN,this.onShiftFree,this))}onMouseLeftButtonDoubleClick(e){this.planet.stopFlying(),this.stopRotation();const t=this.planet.getCartesianFromPixelTerrain(e.pos);if(t){const i=this.planet.camera;let s=i.maxAltitude+this.planet.ellipsoid.polarSize,n=i.minAltitude+this.planet.ellipsoid.polarSize;const o=i.eye.length(),l=this.planet.ellipsoid.cartesianToLonLat(t);if(o>s||o<n)return void this.planet.flyLonLat(new A(l.lon,l.lat));this.renderer.events.isKeyPressed(Y.KEY_ALT)?this.planet.flyLonLat(new A(l.lon,l.lat,2*i.eye.distance(t))):this.planet.flyLonLat(new A(l.lon,l.lat,.57*i.eye.distance(t)))}}onMouseLeftButtonClick(){this._active&&(this.renderer.handler.canvas.classList.add("ogGrabbingPoiner"),this.grabbedPoint=this.planet.getCartesianFromMouseTerrain(),this.grabbedPoint&&(this._eye0.copy(this.planet.camera.eye),this.grabbedSpheroid.radius=this.grabbedPoint.length(),this.stopRotation()))}stopRotation(){this.qRot.clear(),this.freePlanet()}onMouseLeftButtonUp(e){this.renderer.handler.canvas.classList.remove("ogGrabbingPoiner"),e.x===e.prev_x&&e.y===e.prev_y&&(this.scaleRot=0)}onMouseLeftButtonDown(e){if(this._active){if(!this.grabbedPoint)return;if(this.planet.stopFlying(),e.moving){let t=this.planet.camera;if(t.slope>.2){const i=new H(t.eye,e.direction).hitSphere(this.grabbedSpheroid);if(i){this.scaleRot=1,this.qRot=D.getRotationBetweenVectors(i.normal(),this.grabbedPoint.normal());let s=this.qRot;t.eye=s.mulVec3(t.eye),t.rotate(s)}}else{let i=this.grabbedPoint,s=m.add(i,t.getRight()),n=m.add(i,i.normal()),o=new m;new H(t.eye,e.direction).hitPlaneRes(mt.fromPoints(i,s,n),o)===H.INSIDE&&(t.eye=this._eye0.addA(o.subA(i).negate()))}}}}onMouseRightButtonClick(e){this.stopRotation(),this.planet.stopFlying(),this.pointOnEarth=this.planet.getCartesianFromPixelTerrain(e.pos),this.pointOnEarth&&(this.earthUp=this.pointOnEarth.normal())}onMouseRightButtonDown(e){const t=this.planet.camera;if(this.pointOnEarth&&e.moving){this.renderer.controlsBag.scaleRot=1;let i=.5/t.eye.distance(this.pointOnEarth)*t._lonLat.height*G;i>.007?i=.007:i<.003&&(i=.003),t.rotateHorizontal(i*(e.x-e.prev_x),!1,this.pointOnEarth,this.earthUp),t.rotateVertical(i*(e.y-e.prev_y),this.pointOnEarth,this.minSlope)}}onShiftFree(){this._shiftBusy=!1}onMouseMove(e){this._active&&this.renderer.events.isKeyPressed(Y.KEY_ALT)&&(this._shiftBusy||(this._shiftBusy=!0,this.onMouseRightButtonClick(e)),this.onMouseRightButtonDown(e))}onDraw(){if(this._active){const e=this.renderer,t=this.planet.camera;let i=t.eye.clone();if(this.stepIndex){e.controlsBag.scaleRot=1;const s=this.stepsForward[this.stepsCount-this.stepIndex--];t.eye=s.eye,t._u=s.v,t._r=s.u,t._b=s.n,t._f.set(-t._b.x,-t._b.y,-t._b.z)}else this._deactivate&&(this._deactivate=!1,this.freePlanet());if(e.events.mouseState.leftButtonDown||!this.scaleRot)return;if(this.scaleRot-=this.inertia,this.scaleRot<=0)this.scaleRot=0;else{e.controlsBag.scaleRot=this.scaleRot;let s=this.qRot.slerp(D.IDENTITY,1-this.scaleRot*this.scaleRot*this.scaleRot).normalize();s.x||s.y||s.z||(this.scaleRot=0),t.eye=s.mulVec3(t.eye),t.rotate(s)}t.eye.distance(i)/t.getAltitude()>.01?this.lockPlanet():this.freePlanet()}}lockPlanet(e){this.planet.layerLock.lock(this._keyLock),!e&&this.planet.terrainLock.lock(this._keyLock),this.planet._normalMapCreator.lock(this._keyLock)}freePlanet(){this.planet.layerLock.free(this._keyLock),this.planet.terrainLock.free(this._keyLock),this.planet._normalMapCreator.free(this._keyLock)}}const Al=["drag","zoom","rotate"],Ii=.96;class qi extends Z{constructor(e={}){super({name:"navigation",autoActivate:!0,...e}),this._freeMode=!1,this._shiftBusy=!1,this._hold=!1,this._onShiftFree=()=>{this._shiftBusy=!1},this._onCameraFly=()=>{this.stop()},this._onMouseMove=t=>{this._active&&this.renderer.events.isKeyPressed(Y.KEY_ALT)&&(this._shiftBusy||(this._shiftBusy=!0,this._onRHold(t)),this._onRDown(t))},this._onMouseEnter=t=>{const i=this.renderer.events;i.isKeyPressed(Y.KEY_ALT)&&i.releaseKeys(),i.updateButtonsStates(t.sys.buttons),i.mouseState.leftButtonDown?this.renderer.handler.canvas.classList.add("ogGrabbingPoiner"):this.renderer.handler.canvas.classList.remove("ogGrabbingPoiner")},this._onMouseLeave=()=>{this.renderer.events.mouseState.leftButtonDown&&this.vel.scale(0),this.renderer.handler.canvas.classList.remove("ogGrabbingPoiner")},this._onRHold=t=>{if((!this.disableRotation||!this.disableTilt)&&this._targetRotationPoint){this._velInertia=.6,this.disableRotation||(this.force_h=.5*(t.x-t.prev_x)),this.disableTilt||(this.force_v=.5*(t.y-t.prev_y));let i=this.planet.camera.getHeading();this._freeMode=!1,!isNaN(i)&&i>45&&i<340&&(this._freeMode=!0)}},this._onRDown=t=>{if((!this.disableRotation||!this.disableTilt)&&this.planet){this.planet.stopFlying();const i=this._getTargetPoint(t.pos);this._targetRotationPoint=i||null,i&&(this._targetZoomPoint=null,this._targetDragPoint=null,this.vel.set(0,0,0),this._tUp=i.getNormal(),this._tRad=this.planet.camera.eye.distance(i))}},this._onMouseWheel=t=>{if(this.planet){this._targetRotationPoint=null,this._targetDragPoint=null;let i=t.x,s=t.y,n=this.planet.camera;if(n.isOrthographic){i=.5*this.renderer.handler.getWidth(),s=.5*this.renderer.handler.getHeight();let c=this._getTargetPoint(new N(i,s));if(!c)return;this._targetZoomPoint=c,this._grabbedSphere.radius=this._targetZoomPoint.length();let d=n.eye.distance(c),u=new m,f=n.unproject(i,s,d,u);const _=u.sub(f.scaleTo(d));if(c=new H(_,f).hitSphere(this._grabbedSphere),!c)return;this._targetZoomPoint=c}else{let c=this._getTargetPoint(new N(i,s));if(!c)return;this._targetZoomPoint=c,this._grabbedSphere.radius=this._targetZoomPoint.length()}if(this._curPitch=n.getPitch(),this._curYaw=n.getYaw(),this._curRoll=n.getRoll(),Math.sign(t.wheelDelta)!==this._wheelDirection)return this.vel.scale(.3),this._currScreenPos.set(i,s),void(this._wheelDirection=Math.sign(t.wheelDelta));this._currScreenPos.set(i,s),this._wheelDirection=Math.sign(t.wheelDelta);let o=20;this._velInertia=.83,this._isTouchPad=t.isTouchPad,t.isTouchPad&&(this._velInertia=.63,o=17);let l=this._targetZoomPoint.sub(n.eye);l.length()>6e3&&this._wheelDirection>0&&n.eye.getNormal().negate().dot(l.normalize())<.3&&(o=4.3);let h=this.planet.camera.eye.distance(this._targetZoomPoint)*o;this.force=t.direction.scale(this._wheelDirection).normalize().scale(this._wheelDirection<0?1.3*h:h).scale(this.zoomSpeed),this.vel.set(0,0,0),this.force_roll=this._curRoll}},this._onLDown=t=>{this.stop(),this._targetRotationPoint=null,this._targetZoomPoint=null,this.planet&&(this.planet.stopFlying(),this._grabbedPoint=this._getTargetPoint(t.pos),this._grabbedPoint&&(this._targetDragPoint=this._grabbedPoint,this.planet.camera.isOrthographic?this._grabbedDist=this.renderer.getDistanceFromPixel(t.pos):this._grabbedDist=this.renderer.activeCamera.eye.distance(this._grabbedPoint),this.renderer.handler.canvas.classList.add("ogGrabbingPoiner"),this._grabbedSphere.radius=this._grabbedPoint.length(),this._eye0=this.planet.camera.eye.clone(),this._grabbedCameraHeight=this._eye0.length(),this._curPitch=this.planet.camera.getPitch(),this._curYaw=this.planet.camera.getYaw(),this._curRoll=this.planet.camera.getRoll(),this._currScreenPos.copy(t.pos)))},this._onLHold=t=>{if(this._grabbedPoint&&this.planet){let i=this.planet.camera;if(i.isOrthographic){const s=this._grabbedDist,n=new m,o=i.unproject(t.x,t.y,s,n),l=n.sub(o.scaleTo(s)),h=new H(l,o).hitSphere(this._grabbedSphere);if(!h)return;this._targetDragPoint=h;let c=D.getRotationBetweenVectors(this._targetDragPoint.getNormal(),this._grabbedPoint.getNormal()).mulVec3(i.eye);this.force=c.sub(i.eye).scale(this.dragInertia)}else if(i.slope>this.minSlope){this._grabbedDist=i.eye.distance(this._grabbedPoint);let s,n=i.unproject(t.x,t.y,this._grabbedDist),o=new H(i.eye,n).hitSphere(this._grabbedSphere);if(!o)return;if(this._targetDragPoint=o,this.freeMode)s=D.getRotationBetweenVectors(this._targetDragPoint.getNormal(),this._grabbedPoint.getNormal());else{let h=m.NORTH,c=Math.acos(o.dot(h)/this._grabbedSphere.radius)-Math.acos(this._grabbedPoint.dot(h)/this._grabbedSphere.radius),d=i.eyeNorm.dot(m.NORTH);(c>0&&d>=this.poleThreshold||c<0&&d<=-this.poleThreshold)&&(c=0);let u=D.axisAngleToQuat(h.cross(i.eyeNorm).normalize(),-c),f=m.proj_b_to_plane(o,h),_=m.proj_b_to_plane(this._grabbedPoint,h);s=D.getRotationBetweenVectors(f.getNormal(),_.getNormal()).mul(u)}let l=s.mulVec3(i.eye);this.force=l.sub(i.eye).scale(this.dragInertia)}else{let s=this._grabbedPoint,n=m.add(s,i.getRight()),o=m.add(s,s.getNormal()),l=new m;new H(i.eye,t.direction).hitPlaneRes(mt.fromPoints(s,n,o),l);let h=i.eye.add(l.subA(s).negate());this.force=h.sub(i.eye).scale(this.dragInertia),this._targetDragPoint=l}this.vel.set(0,0,0),this._currScreenPos.equal(t.pos)||this._currScreenPos.copy(t.pos),this._hold=!0}},this._onLUp=t=>{this._hold=!1,this.renderer.handler.canvas.classList.remove("ogGrabbingPoiner")},this.events=at(Al,this),this.force=new m,this.force_h=0,this.force_v=0,this.vel=new m,this.vel_h=0,this.vel_v=0,this.vel_roll=0,this.force_roll=0,this.mass=e.mass!=null?e.mass:1,this.inertia=e.inertia!=null?e.inertia:1,this._velInertia=Ii,this.minSlope=e.minSlope!=null?e.minSlope:.35,this.dragInertia=e.dragInertia!=null?e.dragInertia:170,this.zoomSpeed=e.zoomSpeed!=null?e.zoomSpeed:1,this.poleThreshold=e.poleThreshold!=null?e.poleThreshold:.999,this.disableRotation=e.disableRotation!=null&&e.disableRotation,this.disableTilt=e.disableTilt!=null&&e.disableTilt,this._lookPos=void 0,this._grabbedPoint=null,this._grabbedDist=0,this._targetZoomPoint=null,this._targetDragPoint=null,this._targetRotationPoint=null,this._tUp=new m,this._tRad=0,this._rotHDir=0,this._rotVDir=0,this._wheelDirection=1,this._currScreenPos=new N,this._grabbedSphere=new Dt,this._rot=new D,this._curPitch=0,this._curYaw=0,this._curRoll=0,this._eye0=new m,this._newEye=new m,this._grabbedCameraHeight=0,this._isTouchPad=!1,this._freeMode=!1,this.mode=this._modeToNumber(e.mode||"adaptive")}oninit(){this.renderer&&(this.renderer.events.on("keyfree",Y.KEY_ALT,this._onShiftFree),this.renderer.events.on("keyfree",Y.KEY_PRINTSCREEN,this._onShiftFree))}onadd(){var e;(e=this.planet)!=null&&e.camera&&this.planet.camera.events.on("flystart",this._onCameraFly)}onremove(){var e;(e=this.planet)!=null&&e.camera&&this.planet.camera.events.off("flystart",this._onCameraFly)}onactivate(){super.onactivate();let e=this.renderer;e.events.on("mousewheel",this._onMouseWheel),e.events.on("rhold",this._onRHold),e.events.on("rdown",this._onRDown),e.events.on("lhold",this._onLHold),e.events.on("ldown",this._onLDown),e.events.on("lup",this._onLUp),e.events.on("draw",this.onDraw,this,-1e3),e.events.on("mousemove",this._onMouseMove),e.events.on("mouseleave",this._onMouseLeave),e.events.on("mouseenter",this._onMouseEnter)}ondeactivate(){super.ondeactivate();let e=this.renderer;e.events.off("mousewheel",this._onMouseWheel),e.events.off("rhold",this._onRHold),e.events.off("rdown",this._onRDown),e.events.off("lhold",this._onLHold),e.events.off("ldown",this._onLDown),e.events.off("lup",this._onLUp),e.events.off("draw",this.onDraw),e.events.off("mousemove",this._onMouseMove),e.events.off("mouseleave",this._onMouseLeave),e.events.off("mouseenter",this._onMouseEnter)}onDraw(){this._updateVel(),this._handleZoom(),this._handleDrag(),this._handleRotation()}_handleRotation(){if((!this.disableRotation||!this.disableTilt)&&this.planet&&this._targetRotationPoint){let e=this.planet.camera;if((this.disableRotation||this.vel_h===0)&&(this.disableTilt||this.vel_v===0))return;if(!this.disableRotation){let t=this.vel_h*this.dt;e.rotateHorizontal(t,!1,this._targetRotationPoint,this._tUp)}if(!this.disableTilt){let t=this.vel_v*this.dt;e.rotateVertical(t,this._targetRotationPoint,.1)}this.events.dispatch(this.events.rotate,this),this._curPitch=e.getPitch(),this._curYaw=e.getYaw(),this._curRoll=e.getRoll(),this._velInertia=Ii}}_getTargetPoint(e){return this.planet?this.planet.camera.isOrthographic?this.renderer.getCartesianFromPixel(e)||null:this.planet.camera.getAltitude()>8e4?this.planet.getCartesianFromPixelEllipsoid(e)||null:this.planet.getCartesianFromPixelTerrain(e)||null:null}get freeMode(){return this.mode!==1&&(this.mode===0||this._freeMode)}setMode(e){this.mode=this._modeToNumber(e)}_modeToNumber(e){switch(e){case"lockNorth":return 1;case"free":return 0;default:return 2}}_handleDrag(){if(this.planet&&this._targetDragPoint&&this._grabbedPoint&&this.vel.length()>.1){this._velInertia=Ii;let e=this.planet.camera;if(e.slope>this.minSlope){let t=this.vel.scaleTo(this.dt),i=m.proj_b_to_plane(t,e.eyeNorm),s=e.eye.add(i).normalize().scale(this._grabbedCameraHeight);if(this.freeMode){let n=D.getRotationBetweenVectors(e.eye.getNormal(),s.getNormal());e.rotate(n),e.eye.copy(s)}else{let n=s.getNormal().dot(m.NORTH),o=e.eyeNorm.dot(m.NORTH);(n>o&&n>=this.poleThreshold||n<o&&n<=-this.poleThreshold)&&this.vel.scale(.8),e.eye.copy(s),this._corrRoll(),e.setPitchYawRoll(this._curPitch,this._curYaw,this._curRoll)}}else{let t=this.vel.scaleTo(this.dt),i=e.eye.add(t);e.eye.copy(i),e.checkTerrainCollision(),this._corrRoll(),e.setPitchYawRoll(this._curPitch,this._curYaw,this._curRoll)}this.events.dispatch(this.events.drag,this)}}_corrRoll(){this.planet.camera.slope<.5&&(this._curRoll-=this.vel_roll*this.dt,this._curRoll<.01*Math.PI/180&&(this._curRoll=.01*Math.PI/180))}_handleZoom(){if(this._targetZoomPoint&&this.vel.length()>.1){let e=this.planet.camera,t=this._targetZoomPoint,i=e.eye.clone(),s=t.sub(e.eye).normalize(),n=this.vel.getNormal(),o=Math.sign(n.dot(e.getForward())),l=this.vel.scaleTo(this.dt);this._grabbedSphere.radius>i.length()&&(o*=-1);let h=e.getForward().scaleTo(o*l.length());i.addA(h),this.events.dispatch(this.events.zoom,this);let c=e.maxAltitude+this.planet.ellipsoid.getEquatorialSize();if(i.length()>c)return void i.copy(i.getNormal().scale(c));let d=new H(i,s).hitSphere(this._grabbedSphere);if(!d)return void this.vel.set(0,0,0);let u=D.getRotationBetweenVectors(d.getNormal(),t.getNormal());if(e.eye=u.mulVec3(i),e.rotate(u),!this.freeMode){this._corrRoll(),e.setPitchYawRoll(this._curPitch,this._curYaw,this._curRoll),e.update();let f=e.unproject2v(this._currScreenPos,e.eye.distance(this._targetZoomPoint)),_=t.sub(e.eye).normalize(),g=new m,v=new m,p=mt.fromPoints(t,t.add(e.getUp()),t.add(e.getRight()));new H(e.eye,f).hitPlaneRes(p,g),new H(e.eye,_).hitPlaneRes(p,v);let y=v.sub(g);e.eye=e.eye.add(y),this._corrRoll(),e.setPitchYawRoll(this._curPitch,this._curYaw,this._curRoll)}if(e.checkTerrainCollision(),e.isOrthographic){let f=e.getAltitude();f&&(e.focusDistance=Math.abs(f))}}}_updateVel(){let e=this.force.scale(1/this.mass);this.vel.addA(e),this.vel.scale(this.velocityInertia),this.vel.length()<.001&&this.vel.set(0,0,0),this.force.set(0,0,0),this._updateVel_h(),this._updateVel_v(),this._updateVel_roll()}_updateVel_h(){let e=this.force_h/this.mass;this.vel_h+=e,this.vel_h*=this.velocityInertia,Math.abs(this.vel_h)<.001&&(this.vel_h=0),this.force_h=0}_updateVel_v(){let e=this.force_v/this.mass;this.vel_v+=e,this.vel_v*=this.velocityInertia,Math.abs(this.vel_v)<.001&&(this.vel_v=0),this.force_v=0}_updateVel_roll(){let e=this.force_roll/this.mass;this.vel_roll+=e,this.vel_roll*=this.velocityInertia,this.force_roll=0}get dt(){return .001*this.renderer.handler.deltaTime}get velocityInertia(){return this._velInertia*this.inertia}stop(){this.vel.set(0,0,0),this.vel_h=0,this.vel_v=0,this._velInertia=Ii,this._targetZoomPoint=null,this._grabbedPoint=null,this._targetRotationPoint=null,this._targetDragPoint=null}}const In=a=>a>1e3?`${(a/1e3).toFixed(1)} km`:a>9?`${Math.round(a)} m`:`${a.toFixed(1)} m`;let Ll=W.createCylinder(1.1,0,2.7,20,1,!0,!1,0,0,0);const Pl={text:"",size:11,color:"rgba(455,455,455,1.0)",outlineColor:"rgba(0,0,0,0.34)",outline:.23,align:"center",offset:[0,20,0]},zn={scale:1,instanced:!0,tag:"ruler",color:"rgb(0,305,0)",object3d:Ll};class ca extends ce{constructor(e={}){super(e.name),this._onCornerLdown=t=>{var i,s;if(!this._startLonLat){(s=(i=this.renderer)==null?void 0:i.controls.navigation)==null||s.deactivate(),this._startClick.set(t.x,t.y);let n=t.pickingObject.getCartesian();this._startPos=this._planet.getPixelFromCartesian(n),this._pickedCorner=t.pickingObject,t.pickingObject.properties.name=="start"?this._anchorLonLat=this._cornerEntity[1].getLonLat().clone():this._anchorLonLat=this._cornerEntity[0].getLonLat().clone()}},this._onLUp=()=>{var t;this._pickedCorner&&((t=this.renderer.controls.navigation)==null||t.activate(),this._pickedCorner=null,this._anchorLonLat=null)},this._onCornerLup=()=>{this._onLUp()},this._onCornerEnter=t=>{t.renderer.handler.canvas.style.cursor="pointer"},this._onCornerLeave=t=>{t.renderer.handler.canvas.style.cursor="default"},this._onLdblclick=()=>{this._preventClick=!0},this._onLclick=t=>{let i=this._planet.getLonLatFromPixelTerrain(t.pos);i&&(this._timeout=setTimeout(()=>{this._preventClick||(this._startLonLat?this._startLonLat=null:(this.setVisibility(!0),this._stopDrawing=!1,this._startLonLat=i)),this._preventClick=!1,this._stopDrawing=!1,clearTimeout(this._timeout)},200),this._startLonLat&&(this._stopDrawing=!0))},this._onMouseMove=t=>{if(this._startLonLat&&!this._stopDrawing){this._propsLabel.label.setVisibility(!0);let i=this._planet.getLonLatFromPixelTerrain(t.pos);if(!i)return;this._drawLine(this._startLonLat,i)}else if(this._pickedCorner){let i=this._planet.getLonLatFromPixelTerrain(t.pos);i&&(this._pickedCorner.properties.name==="start"?this._drawLine(i,this._anchorLonLat):this._drawLine(this._anchorLonLat,i))}},this.events=at(Sl),this._ignoreTerrain=e.ignoreTerrain==null||e.ignoreTerrain,this._planet=e.planet||null,this._startLonLat=null,this._preventClick=!1,this._stopDrawing=!1,this._pickedCorner=null,this._startPos=null,this._startClick=new N,this._anchorLonLat=null,this._heading=0,this._trackLayer=new ut("track",{entities:[],pickingEnabled:!1,polygonOffsetUnits:-1,relativeToGround:!0,hideInLayerSwitcher:!0}),this._labelLayer=new ut("ruler-label",{entities:[],pickingEnabled:!1,polygonOffsetUnits:-100,relativeToGround:!0,hideInLayerSwitcher:!0}),this._cornersLayer=new ut("corners",{entities:[],pickingEnabled:!0,hideInLayerSwitcher:!0,scaleByDistance:[100,4e6,1],pickingScale:2}),this._propsLabel=new U({name:"propsLabel",label:Pl}),this._trackEntity=new U({polyline:{path3v:[],thickness:4.8,color:"rgb(255,131,0)",isClosed:!1}}),this._trackEntity.polyline.altitude=.01,this._cornerEntity=[new U({geoObject:zn,properties:{name:"start"}}),new U({geoObject:zn,properties:{name:"end"}})]}set ignoreTerrain(e){this._ignoreTerrain=e}bindPlanet(e){this._planet=e}_createCorners(){this._cornersLayer.addEntities(this._cornerEntity)}init(){this._createCorners(),this._trackLayer.addEntities([this._trackEntity]),this._labelLayer.addEntities([this._propsLabel]),this._planet.addLayer(this._labelLayer),this._planet.addLayer(this._trackLayer),this._planet.addLayer(this._cornersLayer),this._activate()}onremove(){this._deactivate()}_activate(){this._propsLabel.label.setVisibility(!1),this.setVisibility(!1),this.renderer.events.on("lclick",this._onLclick,this),this.renderer.events.on("mousemove",this._onMouseMove,this),this.renderer.events.on("ldblclick",this._onLdblclick,this),this.renderer.events.on("lup",this._onLUp,this),this._cornersLayer.events.on("mouseenter",this._onCornerEnter,this),this._cornersLayer.events.on("mouseleave",this._onCornerLeave,this),this._cornersLayer.events.on("ldown",this._onCornerLdown,this),this._cornersLayer.events.on("lup",this._onCornerLup,this)}_deactivate(){this._startLonLat=null,this._preventClick=!1,this._stopDrawing=!1,this._pickedCorner=null,this.renderer.events.off("lclick",this._onLclick),this.renderer.events.off("mousemove",this._onMouseMove),this.renderer.events.off("lup",this._onLUp),this._cornersLayer.events.off("mouseenter",this._onCornerEnter),this._cornersLayer.events.off("mouseleave",this._onCornerLeave),this._cornersLayer.events.off("ldown",this._onCornerLdown),this._cornersLayer.events.off("lup",this._onCornerLup),this.clear()}setVisibility(e){this._cornersLayer.setVisibility(e),this._trackLayer.setVisibility(e),this._labelLayer.setVisibility(e)}_drawLine(e,t,i){i||(i=this._planet.ellipsoid.lonLatToCartesian(e));let s=this._planet.ellipsoid.lonLatToCartesian(t),n=this._planet.ellipsoid.inverse(e,t),o=n.distance;this._heading=n.initialAzimuth;let l=[],h=s.sub(i),c=h.length();h.normalize();for(let d=0;d<120;d++){let u=h.scaleTo(d*c/120).addA(i);l.push(u)}l.push(s),this._trackEntity.polyline.setPath3v([l]),this._ignoreTerrain&&(this._propsLabel.setCartesian3v(l[Math.floor(l.length/2)]),this._propsLabel.label.setText(`${In(o)}, ${Math.round(this._heading)} deg`))}clear(){this._trackEntity.remove(),this._cornerEntity[0].remove(),this._cornerEntity[1].remove(),this._propsLabel.remove(),this._planet.removeLayer(this._trackLayer),this._planet.removeLayer(this._cornersLayer)}isCornersPositionChanged(){let e=this._trackEntity.polyline.getPath3v()[0];if(e){const t=e[0].clone(),i=e[e.length-1].clone();return this._cornerEntity[0].getCartesian().equal(t)&&this._cornerEntity[1].getCartesian().equal(i)}return!1}frame(){let e=this._trackEntity.polyline.getPath3v()[0];if(e){const t=e[0].clone(),i=e[e.length-1].clone();if(!this.isCornersPositionChanged()&&(this._cornerEntity[0].setCartesian3v(t),this._cornerEntity[1].setCartesian3v(i),!this._ignoreTerrain)){let s=0;for(let n=0,o=e.length-1;n<o;n++)s+=e[n+1].distance(e[n]);this._propsLabel.setCartesian3v(e[Math.floor(e.length/2)]),this._propsLabel.label.setText(`${In(s)}, ${Math.round(this._heading)} deg`)}}}get ellipsoid(){return this._planet?this._planet.ellipsoid:null}}const Sl=["add","remove","mousemove","mouseenter","mouseleave","lclick","rclick","mclick","ldblclick","rdblclick","mdblclick","lup","rup","mup","ldown","rdown","mdown","lhold","rhold","mhold","mousewheel","touchmove","touchstart","touchend","doubletouch","touchleave","touchenter"];class da extends Z{constructor(e={}){super(e),this._rulerScene=new ca({name:`rulerScene:${this.__id}`,ignoreTerrain:e.ignoreTerrain})}set ignoreTerrain(e){this._rulerScene.ignoreTerrain=e}oninit(){this._rulerScene.bindPlanet(this.planet)}onactivate(){this.renderer&&this.renderer.addNode(this._rulerScene)}ondeactivate(){this.renderer&&this.renderer.removeNode(this._rulerScene)}}let Rl=W.createCylinder(1.1,0,2,6,1,!0,!0,0,0,0);const Dn={startColor:"rgb(255,131,0)",endColor:"rgb(255,131,0)",thickness:5},qs={text:"",size:11,color:"rgba(455,455,455,1.0)",outlineColor:"rgba(0,0,0,0.34)",outline:.23,align:"center",offset:[0,18,0]},Fn={scale:1,instanced:!0,tag:"height-ruler",color:"rgb(255,131,0)",object3d:Rl};class Ml extends ca{constructor(e={}){super(e),this._geoRulerLayer=new ut("rayHeightRuler",{entities:[],pickingEnabled:!1,polygonOffsetUnits:-2,relativeToGround:!1,hideInLayerSwitcher:!0}),this._rayV=new U({name:"verticalRay",ray:Dn}),this._rayH=new U({name:"heightRay",ray:Dn}),this._heightLabels=[new U({name:"startCornerLabel",label:{...qs}}),new U({name:"endCornerLabel",label:{...qs}}),new U({name:"deltaLabel",label:{...qs}})]}setVisibility(e){super.setVisibility(e),this._geoRulerLayer.setVisibility(e)}get deltaLabel(){return this._heightLabels[2]}get startLabel(){return this._heightLabels[0]}get endLabel(){return this._heightLabels[1]}get corners(){return this._cornerEntity}get startCorner(){return this.corners[0]}get endCorner(){return this.corners[1]}get startCornerLonLat(){return this.startCorner.getLonLat()}get startCornerHeight(){return this.startCornerLonLat.height}get endCornerLonLat(){return this.endCorner.getLonLat()}get endCornerHeight(){return this.endCornerLonLat.height}get maxHeightCornerLonLat(){return this.startCornerHeight<=this.endCornerHeight?this.endCornerLonLat:this.startCornerLonLat}get minHeightCornerLonLat(){return this.startCornerHeight>this.endCornerHeight?this.endCornerLonLat:this.startCornerLonLat}get deltaHeight(){return Math.abs(this.startCornerHeight-this.endCornerHeight)}_drawLine(e,t,i){super._drawLine(e,t,i),this._updateHeightRaysAndLabels()}async _updateHeightRaysAndLabels(){const e=this.minHeightCornerLonLat.clone();e.height=this.maxHeightCornerLonLat.height,this._rayH.ray.setStartPosition3v(this._planet.ellipsoid.lonLatToCartesian(this.maxHeightCornerLonLat)),this._rayH.ray.setEndPosition3v(this._planet.ellipsoid.lonLatToCartesian(e)),this._rayV.ray.setStartPosition3v(this._planet.ellipsoid.lonLatToCartesian(this.minHeightCornerLonLat)),this._rayV.ray.setEndPosition3v(this._planet.ellipsoid.lonLatToCartesian(e)),e.height=this.minHeightCornerLonLat.height+this.deltaHeight/2,this.deltaLabel.setLonLat(e),this.startLabel.setLonLat(this.startCornerLonLat),this.endLabel.setLonLat(this.endCornerLonLat);const t=await this._planet.getHeightDefault(this.startCornerLonLat),i=await this._planet.getHeightDefault(this.endCornerLonLat);this.deltaLabel.label.setText(` ${Math.abs(t-i).toFixed(1)} m`),this.startLabel.label.setText(`P1 ${t.toFixed(1)} m`),this.endLabel.label.setText(`P2 ${i.toFixed(1)} m`)}clear(){this._rayH.remove(),this._rayV.remove(),this.startCorner.remove(),this.endCorner.remove(),this.startLabel.remove(),this.endLabel.remove(),this.deltaLabel.remove(),super.clear(),this._planet.removeLayer(this._geoRulerLayer)}_createCorners(){this._cornerEntity=[new U({geoObject:Fn,properties:{name:"start"}}),new U({geoObject:Fn,properties:{name:"end"}})],this._cornersLayer.setEntities(this._cornerEntity)}init(){super.init(),this._createCorners(),this._labelLayer.addEntities(this._heightLabels),this._geoRulerLayer.addEntities([this._rayH,this._rayV]),this._planet.addLayer(this._geoRulerLayer)}frame(){super.frame(),this._updateHeightRaysAndLabels()}}class On extends da{constructor(e={}){super(e),this._rulerScene=new Ml({name:`heightRulerScene:${this.__id}`,ignoreTerrain:!1})}}const Ys=[.001,.005,.01,.05,.1,.2,.5,1,2,3,5,10,20,30,50,100,200,300,500,1e3,2e3,3e3,5e3,1e4,2e4,3e4,5e4,1e5,2e5,3e5,5e5,1e6,2e6,3e6,5e6,1e7];class ua extends Z{constructor(e={}){e.name&&e.name!==""||(e.name="scaleControl"),super(e),this._template=`<div class="og-scale-container">
      <div class="og-scale-label"></div>
      <div class="og-scale-ruler"></div>
    </div>`,this._minWidth=100,this._maxWidth=150,this._isCenter=e.isCenter==null||e.isCenter,this._mPx=0,this.currWidth=0,this._metersInMinSize=0,this.el=null,this._scaleLabelEl=null}_renderTemplate(){return qr(this._template)[0]}oninit(){this.el=this._renderTemplate(),this._scaleLabelEl=this.el.querySelector(".og-scale-label"),this.renderer.div.appendChild(this.el),this._isCenter?(this.planet.camera.events.on("moveend",()=>{this._drawScreen(this.planet.renderer.handler.getCenter())}),!this.planet.terrain.isEmpty&&this.planet.terrain.events.on("loadend",()=>{this._drawScreen(this.planet.renderer.handler.getCenter())})):(this.renderer.events.on("mousemove",e=>{e.leftButtonHold||e.rightButtonHold||this._drawScreen(e.pos)}),this.planet.camera.events.on("moveend",()=>{let e=this.renderer.events.mouseState;e.leftButtonHold||e.rightButtonHold||this._drawScreen(e.pos)}))}_drawScreen(e){let t=this.planet.camera,i=e,s=this.planet.getDistanceFromPixel(i)||0;s===0&&(i=t.project3v(m.ZERO),s=this.planet.getDistanceFromPixel(i)||0);let n=t.getForward().scaleTo(s).addA(t.eye),o=s*Math.tan(t.viewAngle*G),l=n.add(t.getRight().scaleTo(o)),h=t.project3v(l);this._mPx=o/h.distance(i);let c=this._mPx*this._minWidth,d=Se(Ys,c,(_,g)=>_-g);d<0&&(d=~d);let u=Ys[d],f=(u-c)/(Ys[d+1]-u);this.currWidth=this._minWidth+f*(this._maxWidth-this._minWidth),this._scaleLabelEl.innerText=u>=1e3?u/1e3+" km":u>=1?`${u} m`:u>=.01?100*u+" cm":1e3*u+" mm",this._metersInMinSize=c,this.el.style.width=this.currWidth+"px"}}class _a extends Z{constructor(e={}){super({name:"SimpleSkyBackground",...e}),this._colorOne=new Float32Array([128/255,223/255,1]),this._colorTwo=new Float32Array([10/255,15/255,56/255])}get colorOne(){let e=this._colorOne;return lr([Math.round(255*e[0]),Math.round(255*e[1]),Math.round(255*e[2])])}get colorTwo(){let e=this._colorTwo;return lr([Math.round(255*e[0]),Math.round(255*e[1]),Math.round(255*e[2])])}set colorOne(e){let t=Ji(e);this._colorOne[0]=t.x,this._colorOne[1]=t.y,this._colorOne[2]=t.z}set colorTwo(e){let t=Ji(e);this._colorTwo[0]=t.x,this._colorTwo[1]=t.y,this._colorTwo[2]=t.z}oninit(){this.renderer.handler.addProgram(new $("simpleSkyBackground",{uniforms:{iResolution:"vec2",fov:"float",camPos:"vec3",earthRadius:"float",viewMatrix:"mat4",colorOne:"vec3",colorTwo:"vec3"},attributes:{corners:"vec3"},vertexShader:`attribute vec2 corners;
                        
            varying vec2 tc;
            
            void main(void) {
                gl_Position = vec4(corners, 0.0, 1.0);
                tc = corners * 0.5 + 0.5;
            }`,fragmentShader:`precision highp float;
            
            #define MAX 10e10
            #define PI 3.14159265359
            #define rad(x) x * PI / 180.
            #define ZERO vec3(0.0)          
           
            #define RED vec4(1.0, 0.0, 0.0, 1.0)
            #define GREEN vec4(0.0, 1.0, 0.0, 1.0)         
            
            uniform vec3 camPos;            
            uniform vec2 iResolution;
            uniform float fov;
            uniform float earthRadius;
            uniform mat4 viewMatrix;
            
            uniform vec3 colorOne;
            uniform vec3 colorTwo;
                         
            varying vec2 tc;
                        
            // compute the view ray in the camera coordinate
            vec3 computeView(vec2 uv){
                float w_h_ratio = iResolution.x / iResolution.y;   
                float h = tan(rad(fov/2.));
                return normalize(vec3(-w_h_ratio * h, -h, -1.) + vec3(uv.x * 2. * h * w_h_ratio, uv.y*2.*h, 0.));
            }

            // sphere of size ra centered at point ce
            vec2 sphIntersect( in vec3 ro, in vec3 rd, in vec3 ce, float ra )
            {
                vec3 oc = ro - ce;
                float b = dot( oc, rd );
                float c = dot( oc, oc ) - ra * ra;
                float h = b * b - c;
                if( h < 0.0 ) return vec2(MAX); // no intersection
                h = sqrt( h );
                return vec2( -b-h, -b+h );
            }
            
            mat3 transpose(mat3 matrix) {
                vec3 row0 = matrix[0];
                vec3 row1 = matrix[1];
                vec3 row2 = matrix[2];
                mat3 result = mat3(
                    vec3(row0.x, row1.x, row2.x),
                    vec3(row0.y, row1.y, row2.y),
                    vec3(row0.z, row1.z, row2.z)
                );
                return result;
            }
            
            float det(mat2 matrix) {
                return matrix[0].x * matrix[1].y - matrix[0].y * matrix[1].x;
            }
            
            mat3 inverse(mat3 matrix) {
                vec3 row0 = matrix[0];
                vec3 row1 = matrix[1];
                vec3 row2 = matrix[2];
            
                vec3 minors0 = vec3(
                    det(mat2(row1.y, row1.z, row2.y, row2.z)),
                    det(mat2(row1.z, row1.x, row2.z, row2.x)),
                    det(mat2(row1.x, row1.y, row2.x, row2.y))
                );
                vec3 minors1 = vec3(
                    det(mat2(row2.y, row2.z, row0.y, row0.z)),
                    det(mat2(row2.z, row2.x, row0.z, row0.x)),
                    det(mat2(row2.x, row2.y, row0.x, row0.y))
                );
                vec3 minors2 = vec3(
                    det(mat2(row0.y, row0.z, row1.y, row1.z)),
                    det(mat2(row0.z, row0.x, row1.z, row1.x)),
                    det(mat2(row0.x, row0.y, row1.x, row1.y))
                );
            
                mat3 adj = transpose(mat3(minors0, minors1, minors2));
            
                return (1.0 / dot(row0, minors0)) * adj;
            }
            
            void main(void) {
            
                vec3 dir = computeView(tc);
                dir = inverse(mat3(viewMatrix)) * dir;
                
                vec2 ER = sphIntersect(camPos, dir, vec3(0.0), earthRadius);
                
                float bigRadius = earthRadius * 2.5;
                vec3 bigCenter = normalize(camPos) * bigRadius * 1.3;                
                               
                vec2 BIG = sphIntersect(camPos, dir, bigCenter, bigRadius);
                
                float Ix = distance(camPos + dir * BIG.y, ZERO);               
                
                float maxI = sqrt(bigRadius * bigRadius + bigRadius * bigRadius);
                                   
                gl_FragColor = vec4(mix(colorOne, colorTwo, Ix / maxI), 1.0);
            }`})),this.activate()}onactivate(){super.onactivate(),this.planet.events.on("draw",this._drawBackground,this)}ondeactivate(){super.ondeactivate(),this.planet.events.off("draw",this._drawBackground)}_drawBackground(){let e=this.renderer.handler,t=e.programs.simpleSkyBackground,i=t._program,s=i.uniforms,n=e.gl,o=this.planet.camera;n.disable(n.DEPTH_TEST),t.activate(),n.bindBuffer(n.ARRAY_BUFFER,this.renderer.screenFramePositionBuffer),n.vertexAttribPointer(i.attributes.corners,2,n.FLOAT,!1,0,0),n.uniform3fv(s.camPos,[o.eye.x,o.eye.y,o.eye.z]),n.uniform2fv(s.iResolution,[e.getWidth(),e.getHeight()]),n.uniform1f(s.fov,o.getViewAngle()),n.uniform1f(s.earthRadius,this.planet.ellipsoid.getPolarSize()+1),n.uniform3fv(s.colorOne,this._colorOne),n.uniform3fv(s.colorTwo,this._colorTwo),n.uniformMatrix4fv(s.viewMatrix,!1,o.getViewMatrix()),n.drawArrays(n.TRIANGLE_STRIP,0,4),n.enable(n.DEPTH_TEST)}}const Ws=14959787e4;function $s(a){var e=a-ts,t=282.9404+470935e-10*e,i=.016709-1151e-12*e,s=ar(356.047+.9856002585*e),n=23.4392911-3563e-10*e,o=s+Q*i*Math.sin(s*G)*(1+i*Math.cos(s*G)),l=Math.cos(o*G)-i,h=Math.sin(o*G)*Math.sqrt(1-i*i),c=Math.sqrt(l*l+h*h),d=ar(Math.atan2(h,l)*Q+t),u=l=c*Math.cos(d*G),f=(h=c*Math.sin(d*G))*Math.cos(n*G),_=h*Math.sin(n*G),g=$i*(24*e/23.9344694-259.853/360);return D.zRotation(-g).mulVec3(new m(-u*Ws,-f*Ws,_*Ws))}class Bl{constructor(e){this._renderNode=null,this._position=e.position||new m,this._ambient=e.ambient||new m,this._diffuse=e.diffuse||new m(.8,.8,.8),this._specular=e.specular||new m(.18,.18,.18),this._shininess=e.shininess!=null?e.shininess:3.3,this._active=!0,this._tempAmbient=this._ambient.clone(),this._tempDiffuse=this._diffuse.clone(),this._tempSpecular=this._specular.clone(),this._tempShininess=this._shininess}isActive(){return this._active}setPosition3v(e){this.setPosition(e.x,e.y,e.z)}setPosition(e,t,i){this._position.x=e,this._position.y=t,this._position.z=i,this._renderNode&&(this._renderNode._lightPosition[0]=e,this._renderNode._lightPosition[1]=t,this._renderNode._lightPosition[2]=i)}getPosition(){return this._position.clone()}setAmbient3v(e){this.setAmbient(e.x,e.y,e.z)}setDiffuse3v(e){this.setDiffuse(e.x,e.y,e.z)}setSpecular3v(e){this.setSpecular(e.x,e.y,e.z)}setAmbient(e,t,i){this._ambient.set(e,t,i);const s=this._renderNode;s&&(s._lightParams[0]=e,s._lightParams[1]=t,s._lightParams[2]=i)}setDiffuse(e,t,i){this._diffuse.set(e,t,i);const s=this._renderNode;s&&(s._lightParams[3]=e,s._lightParams[4]=t,s._lightParams[5]=i)}setSpecular(e,t,i){this._specular.set(e,t,i);const s=this._renderNode;s&&(s._lightParams[6]=e,s._lightParams[7]=t,s._lightParams[8]=i)}setShininess(e){this._shininess=e;const t=this._renderNode;t&&(t._lightShininess=e)}addTo(e){this._renderNode=e,this.setShininess(this._shininess),this.setAmbient3v(this._ambient),this.setDiffuse3v(this._diffuse),this.setSpecular3v(this._specular)}}class Ir extends Z{constructor(e={}){super({autoActivate:!0,...e}),this._name="sun",this.activationHeight=e.activationHeight||12079e3,this.offsetVertical=e.offsetVertical||-5e6,this.offsetHorizontal=e.offsetHorizontal||5e6,this.sunlight=new Bl({ambient:new m(.15,.15,.25),diffuse:new m(.9,.9,.8),specular:new m(.1,.1,.06),shininess:110}),this._currDate=0,this._prevDate=0,this._clockPtr=null,this._lightOn=!1,this._f=0,this._k=0,this._stopped=e.stopped||!1}oninit(){this.planet.lightEnabled=!0,this.sunlight.addTo(this.planet),this.renderer.events.on("draw",this._draw,this),this._clockPtr||(this._clockPtr=this.renderer.handler.defaultClock)}stop(){this._stopped=!0,this.deactivate()}start(){this._stopped=!1,this.activate()}onactivate(){super.onactivate(),this._stopped=!1}bindClock(e){this._clockPtr=e}_draw(){if(this._clockPtr)if(this._currDate=this._clockPtr.currentDate,this._stopped)this.sunlight.setPosition3v($s(this._currDate));else{let e=this.planet.camera;if(e.getHeight()<this.activationHeight||!this._active){this._lightOn=!0,this._f=1;let t=e.eye.normal(),i=e.getForward();i.scale(Math.sign(e.getUp().dot(t))),e.slope>.99&&(i=e.getUp());let s=m.proj_b_to_plane(i,t,i).normalize().scale(this.offsetVertical),n=m.proj_b_to_plane(e.getRight(),t,e.getRight()).normalize().scale(this.offsetHorizontal),o=s.add(n),l=e.eye.add(o);if(this._k>0){this._k-=.001;let h=D.getRotationBetweenVectors(this.sunlight._position.normal(),l.normal()).slerp(D.IDENTITY,this._k).normalize();this.sunlight.setPosition3v(h.mulVec3(this.sunlight._position))}else this.sunlight.setPosition3v(l)}else if(this._k=1,this._f>0){this._f-=.001;let t=D.getRotationBetweenVectors(this.sunlight._position.normal(),$s(this._currDate).normal()).slerp(D.IDENTITY,this._f).normalize();this.sunlight.setPosition3v(t.mulVec3(this.sunlight._position))}else(Math.abs(this._currDate-this._prevDate)>34e-5&&this._active||this._lightOn)&&(this._lightOn=!1,this._prevDate=this._currDate,this.sunlight.setPosition3v($s(this._currDate)),this._f=0)}}}const kl=["inertiamove","drag","doubletapzoom"];class Nn{constructor(){this.x=0,this.y=0,this.prev_x=0,this.prev_y=0,this.grabbedPoint=null,this.grabbedSpheroid=new Dt,this._vec=new N,this._vecPrev=new N}get dY(){return this.y-this.prev_y}get dX(){return this.x-this.prev_x}get vec(){return this._vec.set(this.x,this.y)}get vecPrev(){return this._vecPrev.set(this.prev_x,this.prev_y)}}class fa extends Z{constructor(e={}){super(e),this._onCameraFly=()=>{this.stopRotation()},this._name="touchNavigation",this.events=at(kl,this),this.grabbedPoint=new m,this.inertia=e.inertia!=null?e.inertia:.007,this.minSlope=e.minSlope!=null?e.minSlope:.1,this.jerkLimit=e.jerkLimit!=null?e.jerkLimit:.3,this.grabbedSpheroid=new Dt,this.planet=null,this.qRot=new D,this.scaleRot=0,this.rot=1,this._eye0=new m,this.pointOnEarth=null,this.earthUp=null,this.touches=[new Nn,new Nn],this._keyLock=new Re,this._touching=!1}oninit(){this.renderer&&(this.renderer.events.on("touchstart",this.onTouchStart,this),this.renderer.events.on("touchend",this.onTouchEnd,this),this.renderer.events.on("doubletouch",this.onDoubleTouch,this),this.renderer.events.on("touchcancel",this.onTouchCancel,this),this.renderer.events.on("touchmove",this.onTouchMove,this),this.renderer.events.on("draw",this.onDraw,this))}onadd(){var e;(e=this.planet)!=null&&e.camera&&this.planet.camera.events.on("flystart",this._onCameraFly)}onremove(){var e;(e=this.planet)!=null&&e.camera&&this.planet.camera.events.off("flystart",this._onCameraFly)}onTouchStart(e){const t=this.renderer.handler;if(this._touching=!0,e.sys.touches.length===2){const i=this.touches[0],s=this.touches[1];i.x=(e.sys.touches.item(0).clientX-e.sys.offsetLeft)*t.pixelRatio,i.y=(e.sys.touches.item(0).clientY-e.sys.offsetTop)*t.pixelRatio,i.prev_x=i.x,i.prev_y=i.y,i.grabbedPoint=this.planet.getCartesianFromPixelTerrain(new N(i.x,i.y))||null,s.x=(e.sys.touches.item(1).clientX-e.sys.offsetLeft)*t.pixelRatio,s.y=(e.sys.touches.item(1).clientY-e.sys.offsetTop)*t.pixelRatio,s.prev_x=s.x,s.prev_y=s.y,s.grabbedPoint=this.planet.getCartesianFromPixelTerrain(new N(s.x,s.y))||null,this.pointOnEarth=this.planet.getCartesianFromPixelTerrain(this.renderer.handler.getCenter())||null,this.pointOnEarth&&(this.earthUp=this.pointOnEarth.normal()),i.grabbedPoint&&s.grabbedPoint&&(i.grabbedSpheroid.radius=i.grabbedPoint.length(),s.grabbedSpheroid.radius=s.grabbedPoint.length(),this.stopRotation())}else e.sys.touches.length===1&&this._startTouchOne(e)}_startTouchOne(e){const t=this.touches[0],i=this.renderer.handler;t.x=(e.sys.touches.item(0).clientX-e.sys.offsetLeft)*i.pixelRatio,t.y=(e.sys.touches.item(0).clientY-e.sys.offsetTop)*i.pixelRatio,t.prev_x=t.x,t.prev_y=t.y,t.grabbedPoint=this.planet.getCartesianFromPixelTerrain(e)||null,this._eye0.copy(this.planet.camera.eye),t.grabbedPoint&&(t.grabbedSpheroid.radius=t.grabbedPoint.length(),this.stopRotation())}stopRotation(){this.qRot.clear(),this.planet.layerLock.free(this._keyLock),this.planet.terrainLock.free(this._keyLock),this.planet._normalMapCreator.free(this._keyLock)}onDoubleTouch(e){this.planet.stopFlying(),this.stopRotation();const t=this.planet.getCartesianFromPixelTerrain(e);if(t){const i=this.planet.ellipsoid.cartesianToLonLat(t);this.planet.flyLonLat(new A(i.lon,i.lat,.57*this.planet.camera.eye.distance(t))),this.events.dispatch(this.events.doubletapzoom,this)}}onTouchEnd(e){e.sys.touches.length===0&&(this._touching=!1),e.sys.touches.length===1&&this._startTouchOne(e),Math.abs(this.touches[0].x-this.touches[0].prev_x)<3&&Math.abs(this.touches[0].y-this.touches[0].prev_y)<3&&(this.scaleRot=0)}onTouchCancel(e){}onTouchMove(e){let t=this.planet.camera;const i=this.renderer.handler;if(e.sys.touches.length===2){this.renderer.controlsBag.scaleRot=1;let n=this.touches[0],o=this.touches[1];if(!n.grabbedPoint||!o.grabbedPoint)return;this.planet.stopFlying(),n.prev_x=n.x,n.prev_y=n.y,n.x=(e.sys.touches.item(0).clientX-e.sys.offsetLeft)*i.pixelRatio,n.y=(e.sys.touches.item(0).clientY-e.sys.offsetTop)*i.pixelRatio,o.prev_x=o.x,o.prev_y=o.y,o.x=(e.sys.touches.item(1).clientX-e.sys.offsetLeft)*i.pixelRatio,o.y=(e.sys.touches.item(1).clientY-e.sys.offsetTop)*i.pixelRatio;const l=n.vec.add(o.vec).scale(.5),h=this.planet.getCartesianFromPixelEllipsoid(l);if(h){this.pointOnEarth=h;const c=Math.atan2(n.prev_y-o.prev_y,n.prev_x-o.prev_x),d=Math.atan2(n.y-o.y,n.x-o.x)-c,u=t.eye.distance(this.pointOnEarth),f=n.vec.sub(o.vec),_=n.vecPrev.sub(o.vecPrev);let g=f.length()/_.length();const v=1+this.jerkLimit,p=1-this.jerkLimit;g=g>v?v:g<p?p:g;let y=u*-(1-g);t.eye.addA(t.getForward().scale(y)),t.rotateAround(-d,!1,this.pointOnEarth,this.earthUp);const b=n.vec.add(o.vec).scale(.5),C=n.vecPrev.add(o.vecPrev).scale(.5),T=b.sub(C).scale(-1);var s=.5/u*t._lonLat.height*G;s>.003&&(s=.003),t.rotateHorizontal(s*-T.x,!1,this.pointOnEarth,this.earthUp),t.rotateVertical(s*-T.y,this.pointOnEarth,this.minSlope),t.checkTerrainCollision(),t.update(),this.events.dispatch(this.events.drag,this)}this.scaleRot=0}else if(e.sys.touches.length===1){let n=this.touches[0];if(n.prev_x=n.x,n.prev_y=n.y,n.x=(e.sys.touches.item(0).clientX-e.sys.offsetLeft)*i.pixelRatio,n.y=(e.sys.touches.item(0).clientY-e.sys.offsetTop)*i.pixelRatio,!n.grabbedPoint)return;this.planet.stopFlying();let o=e.direction,l=new H(t.eye,o).hitSphere(n.grabbedSpheroid);if(l)if(t.slope>.2){this.qRot=D.getRotationBetweenVectors(l.normal(),n.grabbedPoint.normal());let h=this.qRot;t.eye=h.mulVec3(t.eye),t.rotate(h),t.checkTerrainCollision(),t.update(),this.events.dispatch(this.events.drag,this),this.scaleRot=1}else{let h=n.grabbedPoint,c=m.add(h,t.getUp()),d=m.add(h,h.getNormal()),u=t.unproject(n.x,n.y),f=new m;new H(t.eye,u).hitPlaneRes(mt.fromPoints(h,c,d),f)===H.INSIDE&&(t.eye=this._eye0.addA(f.subA(h).negate()),t.checkTerrainCollision(),t.update(),this.events.dispatch(this.events.drag,this),this.scaleRot=0)}}}onDraw(){const e=this.renderer;if(e.controlsBag.scaleRot=this.scaleRot,this._touching)return;let t=this.planet.camera,i=t.eye.clone();if(!e.events.mouseState.leftButtonDown&&this.scaleRot){if(this.scaleRot-=this.inertia,this.scaleRot<=0)this.scaleRot=0;else{e.controlsBag.scaleRot=this.scaleRot;let s=this.qRot.slerp(D.IDENTITY,1-this.scaleRot*this.scaleRot*this.scaleRot).normalize();s.x||s.y||s.z||(this.scaleRot=0),t.eye=s.mulVec3(t.eye),t.rotate(s),t.checkTerrainCollision(),t.update(),this.events.dispatch(this.events.inertiamove,this)}this.setLock(t.eye.distance(i)/t.getAltitude()>.01)}}setLock(e){e?(this.planet.layerLock.lock(this._keyLock),this.planet.terrainLock.lock(this._keyLock),this.planet._normalMapCreator.lock(this._keyLock)):(this.planet.layerLock.free(this._keyLock),this.planet.terrainLock.free(this._keyLock),this.planet._normalMapCreator.free(this._keyLock))}}class ga extends Z{constructor(e={}){super(e),this._keyLock=new Re,this._move=0,this._targetPoint=null}oninit(){let e=new he({classList:["og-map-button","og-zoomin-button"],icon:'<?xml version="1.0"?><svg width=24 height=24 xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">    <path d="M 11 5 L 11 11 L 5 11 L 5 13 L 11 13 L 11 19 L 13 19 L 13 13 L 19 13 L 19 11 L 13 11 L 13 5 L 11 5 z"/></svg>'});e.appendTo(this.renderer.div);let t=new he({classList:["og-map-button","og-zoomout-button"],icon:'<?xml version="1.0"?><svg width=24 height=24 xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">    <path d="M 5 11 L 5 13 L 19 13 L 19 11 L 5 11 z"/></svg>'});t.appendTo(this.renderer.div),e.events.on("mousedown",()=>this.zoomIn()),e.events.on("mouseup",()=>this.stopZoom()),t.events.on("mousedown",()=>this.zoomOut()),t.events.on("mouseup",()=>this.stopZoom()),e.events.on("touchstart",()=>this.zoomIn()),e.events.on("touchend",()=>this.stopZoom()),e.events.on("touchcancel",()=>this.stopZoom()),t.events.on("touchstart",()=>this.zoomOut()),t.events.on("touchend",()=>this.stopZoom()),t.events.on("touchcancel",()=>this.stopZoom()),this.renderer.events.on("draw",this._draw,this)}zoomIn(){this.planet.layerLock.lock(this._keyLock),this.planet.terrainLock.lock(this._keyLock),this.planet._normalMapCreator.lock(this._keyLock),this._targetPoint=this.renderer.getCenter(),this._move=1}zoomOut(){this.planet.layerLock.lock(this._keyLock),this.planet.terrainLock.lock(this._keyLock),this.planet._normalMapCreator.lock(this._keyLock),this._targetPoint=this.renderer.getCenter(),this._move=-1}stopZoom(){this._move=0,this.planet.layerLock.free(this._keyLock),this.planet.terrainLock.free(this._keyLock),this.planet._normalMapCreator.free(this._keyLock)}_draw(e){const t=this.planet.camera;if(this._move!==0){const i=this.planet.getCartesianFromPixelTerrain(e.getCenter());if(i){let s=.035*t.eye.distance(i);t.eye.addA(t.getForward().scale(this._move*s)),t.checkTerrainCollision(),t.update()}}}}class Il extends ce{constructor(e={}){var t,i;super(e.name),this._ignoreTerrain=!1,this.events=new xi(zl),this._ignoreTerrain=e.ignoreTerrain==null||e.ignoreTerrain,this._onSelect=e.onSelect||null,this._autoSelectionHide=e.autoSelectionHide||!1,this._planet=e.planet||null,this._startLonLat=null,this._heading=0,this._propsLabel=new U({name:"propsLabel",label:{text:"",size:11,color:"rgba(455,455,455,1.0)",outlineColor:"rgba(0,0,0,0.34)",outline:.23,align:"center",offset:[0,18]}}),(i=(t=this._propsLabel)==null?void 0:t.label)==null||i.setVisibility(!1),this._trackEntity=new U({polyline:{path3v:[],thickness:3.8,color:"rgb(455,455,455)",isClosed:!1}}),this._trackEntity.polyline.altitude=.01;let s=W.createCylinder(1.1,0,2.7,20,1,!0,!1,0,0,0);this._cornerEntity=[new U({geoObject:{scale:1,instanced:!0,tag:"selection",color:"rgb(0,305,0)",object3d:s},properties:{name:"start"}}),new U({geoObject:{scale:1,instanced:!0,tag:"selection",color:"rgb(455,0,0)",object3d:s},properties:{name:"end"}})],this._trackLayer=new ut("track",{entities:[this._trackEntity,this._propsLabel],pickingEnabled:!1,polygonOffsetUnits:-1,relativeToGround:!0,hideInLayerSwitcher:!1}),this._cornersLayer=new ut("corners",{entities:[this._cornerEntity[0],this._cornerEntity[1]],pickingEnabled:!0,hideInLayerSwitcher:!0,scaleByDistance:[1,4e6,.01],pickingScale:2})}set ignoreTerrain(e){this._ignoreTerrain=e}bindPlanet(e){this._planet=e}init(){this._activate()}onremove(){this._deactivate()}_activate(){var e,t,i,s,n;(t=(e=this._propsLabel)==null?void 0:e.label)==null||t.setVisibility(!1),this._onMouseMove_=this._onMouseMove.bind(this),(i=this.renderer)==null||i.events.on("mousemove",this._onMouseMove_,this),this._onMouseLdown_=this._onMouseLdown.bind(this),(s=this.renderer)==null||s.events.on("ldown",this._onMouseLdown_,this),this._onMouseLup_=this._onMouseLup.bind(this),(n=this.renderer)==null||n.events.on("lup",this._onMouseLup_,this),this._planet.addLayer(this._trackLayer),this._planet.addLayer(this._cornersLayer)}_deactivate(){var e,t,i;this._startLonLat=null,this._trackLayer.remove(),this._cornersLayer.remove(),(e=this.renderer)==null||e.events.off("mousemove",this._onMouseMove_),(t=this.renderer)==null||t.events.off("ldown",this._onMouseLdown_),(i=this.renderer)==null||i.events.off("lup",this._onMouseLup_),this.clear(),this._onMouseMove_=null,this._onMouseLdown_=null,this._onMouseLup_=null}_onMouseLdown(e){var t,i,s,n,o,l;if(e.renderer.handler.canvas.classList.remove("ogGrabbingPoiner"),e.renderer.handler.canvas.style.cursor="pointer",!this._startLonLat){(t=this._propsLabel.label)==null||t.setVisibility(!1),(i=this._trackEntity.polyline)==null||i.setPath3v([]),(s=this._cornerEntity[0].geoObject)==null||s.setVisibility(!0),(n=this._cornerEntity[1].geoObject)==null||n.setVisibility(!0),(l=(o=this.renderer)==null?void 0:o.controls.navigation)==null||l.deactivate(),this._startLonLat=this._planet.getLonLatFromPixelTerrain(e);let h=this._planet.ellipsoid.lonLatToCartesian(this._startLonLat);this._cornerEntity[0].setCartesian3v(h),this._cornerEntity[1].setCartesian3v(h)}}_onMouseLup(e){var t,i,s;if(this._startLonLat){if(this._pickedCorner=null,this._anchorLonLat=null,(t=this._propsLabel.label)==null||t.setVisibility(!0),this._onSelect&&typeof this._onSelect=="function"){let n=this._cornerEntity[0].getLonLat(),o=this._cornerEntity[1].getLonLat(),l=[Math.min(n.lon,o.lon),Math.min(n.lat,o.lat),Math.max(n.lon,o.lon),Math.max(n.lat,o.lat)];this._onSelect(l)}this._autoSelectionHide&&this.clear(),this._startLonLat=null}e.renderer.handler.canvas.style.cursor="default",(s=(i=this.renderer)==null?void 0:i.controls.navigation)==null||s.activate()}_drawLine(e,t,i){var s;i||(i=this._planet.ellipsoid.lonLatToCartesian(e));let n=this._planet.ellipsoid.lonLatToCartesian(t),o=this._planet.ellipsoid.direct(e,t);this._heading=o.initialAzimuth;let l=[];this._cornerEntity[0].setCartesian3v(i),this._cornerEntity[1].setCartesian3v(n);let h=[i,this._planet.ellipsoid.lonLatToCartesian(new A(t.lon,e.lat,e.height)),n,this._planet.ellipsoid.lonLatToCartesian(new A(e.lon,t.lat,e.height)),i];l.push(i);let c=(d,u)=>{let f=u.sub(d),_=f.length();f.normalize();for(let g=0;g<120;g++){let v=f.scaleTo(g*_/120).addA(d);l.push(v)}};for(let d=0;d<h.length-1;d++)c(h[d],h[d+1]);(s=this._trackEntity.polyline)==null||s.setPath3v([l]),this._ignoreTerrain}_onMouseMove(e){var t;if(this._startLonLat){(t=this._propsLabel.label)==null||t.setVisibility(!0);let i=this._planet.getLonLatFromPixelTerrain(e);if(!i)return;this._drawLine(this._startLonLat,i)}}clear(){var e,t,i;(e=this._trackEntity.polyline)==null||e.clear(),(t=this._cornerEntity[0].geoObject)==null||t.setVisibility(!1),(i=this._cornerEntity[1].geoObject)==null||i.setVisibility(!1)}frame(){var e,t;let i=(e=this._trackEntity.polyline)==null?void 0:e.getPath3v()[0];if(i&&!this._ignoreTerrain){let n=0;for(let o=0,l=i.length-1;o<l;o++)n+=i[o+1].distance(i[o]);this._propsLabel.setCartesian3v(i[Math.floor(i.length/2)]),(t=this._propsLabel.label)==null||t.setText(`${s=n,s>1e3?`${(s/1e3).toFixed(1)} km`:s>9?`${Math.round(s)} m`:`${s.toFixed(1)} m`}, ${Math.round(this._heading)} deg`)}var s}get ellipsoid(){return this._planet?this._planet.ellipsoid:null}}const zl=["add","remove","mousemove","mouseenter","mouseleave","lclick","rclick","mclick","ldblclick","rdblclick","mdblclick","lup","rup","mup","ldown","rdown","mdown","lhold","rhold","mhold","mousewheel","touchmove","touchstart","touchend","doubletouch","touchleave","touchenter"];function Jt(a,e){return new Date(+a+1e3*e)}function Dl(a,e=!0,t=!1){let i=Ol[a.getMonth()],s=a.getUTCDate(),n=a.getUTCFullYear();if(e){let o=a.getUTCHours().toString().padStart(2,"0"),l=a.getUTCMinutes().toString().padStart(2,"0"),h=a.getUTCSeconds().toString().padStart(2,"0");return t?`${i} ${s} ${n} ${o}:${l}:${h}.${a.getUTCMilliseconds().toString().padStart(3,"0")}`:`${i} ${s} ${n} ${o}:${l}:${h}`}return`${i} ${s} ${n}`}function Hn(a,e=0,t=10,i=2,s="white"){a.lineWidth=i,a.strokeStyle=s,a.beginPath(),a.moveTo(e,0),a.lineTo(e,t),a.stroke()}function Fl(a,e,t,i,s="12px Arial",n="black",o="left",l="bottom",h=0){a.save(),a.translate(t,i),a.rotate(h*G),a.fillStyle=n,a.textBaseline=l,a.font=s,a.textAlign=o,a.fillText(e,0,0),a.restore()}const Xs=[[.001,10],[.002,10],[.005,10],[.01,10],[.02,10],[.05,10],[.1,10],[.25,10],[.5,5],[1,10],[2,10],[5,5],[10,10],[15,15],[30,6],[60,12],[120,12],[300,5],[600,10],[900,15],[1800,6],[3600,12],[7200,10],[14400,4],[21600,6],[43200,12],[86400,24],[172800,2],[345600,4],[604800,7],[1296e3,15],[2592e3,5],[5184e3,6],[7776e3,9],[15552e3,18],[31536e3,12],[63072e3,2],[126144e3,4],[15768e4,5],[31536e4,10],[63072e4,2],[126144e4,4],[15768e5,5],[31536e5,10],[63072e5,2],[126144e5,4],[15768e6,5],[31536e6,10]],Ol=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Nl=["change","current"];class Hl{constructor(e={}){this.events=at(Nl),this._current=e.current||new Date,this._rangeStart=e.rangeStart||new Date,this._rangeEnd=e.rangeEnd||Jt(this._rangeStart,3600),this._range=this._rangeEnd.getTime()-this._rangeStart.getTime(),this._minDate=e.minDate||null,this._maxDate=e.maxDate||null,this.multiplier=e.multiplier!=null?e.multiplier:1,this._requestAnimationFrameId=0,this._prevNow=0,this.dt=0}play(){this._requestAnimationFrameId||(this._prevNow=window.performance.now(),this._animationFrameCallback())}stop(){this._requestAnimationFrameId&&(window.cancelAnimationFrame(this._requestAnimationFrameId),this._requestAnimationFrameId=0)}stopped(){return this._requestAnimationFrameId==0}_animationFrameCallback(){this._requestAnimationFrameId=window.requestAnimationFrame(()=>{this._frame(),this._animationFrameCallback()})}_frame(){let e=window.performance.now();this.dt=e-this._prevNow,this._prevNow=e,this.current=new Date(this.currentTime+this.dt*this.multiplier)}get range(){return this._range}set(e,t){e===this._rangeStart&&t===this._rangeEnd||(this._rangeStart=e,this._rangeEnd=t,this._range=this._rangeEnd.getTime()-this._rangeStart.getTime(),this.events.dispatch(this.events.change,e,t))}get current(){return this._current}get rangeStart(){return this._rangeStart}get rangeEnd(){return this._rangeEnd}get rangeStartTime(){return this._rangeStart.getTime()}get rangeEndTime(){return this._rangeEnd.getTime()}get currentTime(){return this._current.getTime()}set current(e){e!==this._current&&(this._maxDate&&e>this._maxDate?this._current=this._maxDate:this._minDate&&e<this._minDate?this._current=this._minDate:this._current=e,this.events.dispatch(this.events.current,this._current))}set rangeStart(e){e!==this._rangeStart&&(this._rangeStart=e,this._range=this._rangeEnd.getTime()-this._rangeStart.getTime(),this.events.dispatch(this.events.change,e))}set rangeEnd(e){e!==this._rangeEnd&&(this._rangeEnd=e,this._range=this._rangeEnd.getTime()-this._rangeStart.getTime(),this.events.dispatch(this.events.change,e))}}const De=.001,Vl=["startdrag","stopdrag","startdragcurrent","stopdragcurrent","setcurrent","reset","play","playback","pause","visibility"],Vn="#bfbfbf";class Ul extends dt{constructor(e={}){super({template:`<div class="og-timeline">

  <div class="og-timeline-top">
  </div>

  <div class="og-timeline-frame">
    <div class="og-timeline-current">
      <div class="og-timeline-current-spin">
        <div class="og-timeline-current-arrow"></div>
      </div>
    </div>
    <div class="og-timeline-scale"></div>
  </div>

  <div class="og-timeline-bottom">
    <div class="og-timeline-controls">
    </div>
  </div>

</div>`,model:new Hl({rangeStart:e.rangeStart,rangeEnd:e.rangeEnd,current:e.currentDate,minDate:e.minDate,maxDate:e.maxDate})}),this._onMouseWheel=t=>{if(this._isMouseOver){let i=this._canvasEl.getBoundingClientRect(),s=t.clientX-i.left,n=-(s-.5*this.clientWidth),o=this.model.rangeStartTime+this._millisecondsInPixel*s;this._zoom(o,n,Math.sign(t.wheelDelta))}else if(this._isCurrentMouseOver){let i=-((this.model.currentTime-this.model.rangeStartTime)/this._millisecondsInPixel-.5*this.clientWidth);this._zoom(this.model.currentTime,i,Math.sign(t.wheelDelta))}},this._onMouseWheelFF=t=>{this._onMouseWheel(t)},this._onMouseDown=t=>{this._isMouseOver?(this._isDragging=!0,document.body.classList.add("og-timeline-unselectable"),this._clickPosX=t.clientX,this._clickTime=Date.now(),this._clickRangeStart=this.model.rangeStart,this._clickRangeEnd=this.model.rangeEnd,this.events.dispatch(this.events.startdrag,t)):this._isCurrentMouseOver&&(this._isCurrentDragging=!0,document.body.classList.add("og-timeline-unselectable"),this._clickPosX=t.clientX,this._clickCurrentDate=this.model.current,this.events.dispatch(this.events.startdragcurrent,t))},this._onMouseUp=t=>{if(this._isDragging)if(this._isDragging=!1,document.body.classList.remove("og-timeline-unselectable"),this._clickPosX===t.clientX&&Date.now()-this._clickTime<this._clickDelay){let i=this._canvasEl.getBoundingClientRect(),s=new Date(this.model.rangeStartTime+(t.clientX-i.left)*this._millisecondsInPixel);this.model.current=s,this.events.dispatch(this.events.stopdrag,s),this.events.dispatch(this.events.setcurrent,s)}else this.events.dispatch(this.events.stopdrag,this.model.current);else this._isCurrentDragging&&(this._isCurrentDragging=!1,document.body.classList.remove("og-timeline-unselectable"),this.events.dispatch(this.events.stopdragcurrent,this.model.current))},this._onMouseEnter=()=>{this._isMouseOver=!0},this._onMouseOut=()=>{this._isMouseOver=!1},this._onCurrentMouseEnter=()=>{this._isCurrentMouseOver=!0},this._onCurrentMouseOut=()=>{this._isCurrentMouseOver=!1},this._onMouseMove=t=>{if(this._isDragging){let i=(this._clickPosX-t.clientX)*this._millisecondsInPixel*De;this.model.set(Jt(this._clickRangeStart,i),Jt(this._clickRangeEnd,i))}else if(this._isCurrentDragging){let i=(this._clickPosX-t.clientX)*this._millisecondsInPixel*De,s=Jt(this._clickCurrentDate,-i);s>=this.model.rangeStart&&s<=this.model.rangeEnd&&(this.model.current=Jt(this._clickCurrentDate,-i))}},this.events=this.events.registerNames(Vl),this.fillStyle=e.fillStyle||"rgba(64, 59, 59, 1.0)",this.$controls=null,this._frameEl=null,this._currentEl=null,this._canvasEl=document.createElement("canvas"),this._ctx=this._canvasEl.getContext("2d"),this._isMouseOver=!1,this._isDragging=!1,this._isCurrentDragging=!1,this._isCurrentMouseOver=!1,this._minWidth=330,this._canvasScale=2,this._millisecondsInPixel=0,this._clickPosX=0,this._clickRangeStart=new Date,this._clickRangeEnd=new Date,this._clickCurrentDate=new Date,this._clickTime=0,this._clickDelay=450,this._onResizeObserver_=this._onResizeObserver.bind(this),this._resizeObserver=new ResizeObserver(this._onResizeObserver_),this._pauseBtn=new ct({classList:["og-timeline-control_button"],icon:`<?xml version="1.0" ?><!DOCTYPE svg  PUBLIC '-//W3C//DTD SVG 1.1//EN'  'http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd'><svg enable-background="new 0 0 512 512" height="512px" version="1.1" viewBox="0 0 512 512" width="512px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g id="Layer_6"><rect fill="#252525" height="320" width="60" x="153" y="96"/><rect fill="#252525" height="320" width="60" x="299" y="96"/></g></svg>`,name:"pause"}),this._playBtn=new ct({classList:["og-timeline-control_button"],icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M8 5v14l11-7z" style="fill: black;"/></svg>',name:"play"}),this._buttons=new Uo({buttons:[this._pauseBtn,this._playBtn]}),this._visibility=!1}_onResizeObserver(){this.resize()}get canvasScale(){return this._canvasScale}set canvasScale(e){e!==this._canvasScale&&(this._canvasScale=e,this.resize())}resize(){this._resize(),this.draw()}afterRender(e){this.resize()}render(){return super.render(),this.$controls=this.select(".og-timeline-controls"),this._frameEl=this.select(".og-timeline-frame"),this._currentEl=this.select(".og-timeline-current"),this.select(".og-timeline-frame .og-timeline-scale").appendChild(this._canvasEl),this._resizeObserver.observe(this.el),this.model.events.on("change",()=>{this.draw()}),this.model.events.on("current",e=>{this._drawCurrent(),this.events.dispatch(this.events.setcurrent,e)}),this._canvasEl.addEventListener("mouseenter",this._onMouseEnter),this._canvasEl.addEventListener("mouseout",this._onMouseOut),this._currentEl.addEventListener("mouseenter",this._onCurrentMouseEnter),this._currentEl.addEventListener("mouseout",this._onCurrentMouseOut),document.body.addEventListener("mousemove",this._onMouseMove),document.body.addEventListener("mousedown",this._onMouseDown),document.body.addEventListener("mouseup",this._onMouseUp),document.body.addEventListener("wheel",this._onMouseWheelFF),this._playBtn.appendTo(this.$controls),this._pauseBtn.appendTo(this.$controls),this.model.stopped()?(this._pauseBtn.setActive(!0,!0),this._pauseBtn.preventClick=!0):(this._playBtn.setActive(!0,!0),this._playBtn.preventClick=!0),this._buttons.events.on("change",e=>{switch(e.name){case"play":this.play();break;case"pause":this.pause()}}),this.setVisibility(!0),this}setVisibility(e){e!==this._visibility&&(this._visibility=e,this.el&&(this.el.style.display=e?"block":"none"),this.events.dispatch(this.events.visibility,e))}reset(){this.model.stop(),this.events.dispatch(this.events.reset,this.model)}play(){this.model.multiplier=Math.abs(this.model.multiplier),this.model.play(),this.events.dispatch(this.events.play,this.model)}pause(){this.model.stop(),this.events.dispatch(this.events.pause,this.model)}playBack(){this.model.multiplier=-1*Math.abs(this.model.multiplier),this.model.play(),this.events.dispatch(this.events.playback,this.model)}_zoom(e,t,i){let s=(e-(this.model.rangeStartTime+.5*this.model.range))*De,n=Jt(this.model.rangeStart,s),o=Jt(this.model.rangeEnd,s),l=(o.getTime()-n.getTime())/20*De,h=Jt(n,l*i),c=Jt(o,-l*i),d=(c.getTime()-h.getTime())/this.clientWidth;if(d<31536e6&&d>.1){let u=d*t*De;this.model.set(Jt(h,u),Jt(c,u))}}get clientWidth(){return this._canvasEl?this._canvasEl.width/this._canvasScale:0}get clientHeight(){return this._canvasEl?this._canvasEl.height/this._canvasScale:0}_resize(){this._frameEl&&(this._canvasEl.width=this._frameEl.clientWidth*this._canvasScale,this._canvasEl.height=this._frameEl.clientHeight*this._canvasScale,this._canvasEl.style.width=`${this._frameEl.clientWidth}px`,this._canvasEl.style.height=`${this._frameEl.clientHeight}px`)}getOffsetByTime(e){return(e-this.model.rangeStartTime)/this._millisecondsInPixel}remove(){super.remove(),this.model.stop()}_clearCanvas(){this._ctx.fillStyle=this.fillStyle,this._ctx.fillRect(0,0,this.clientWidth*this._canvasScale,this.clientHeight*this._canvasScale)}_drawCurrent(){let e=(this.model.currentTime-this.model.rangeStartTime)/this._millisecondsInPixel;this.model.current<this.model.rangeStart||this.model.current>this.model.rangeEnd?this._currentEl.style.display="none":(this._currentEl.style.display="block",this._currentEl.style.transform=`translateX(${e}px)`)}draw(){this._millisecondsInPixel=this.model.range/this.clientWidth;let e=function(i){for(let s=0,n=Xs.length;s<n;s++)if(Xs[s][0]>i)return Xs[s-1]}(this._minWidth*this._millisecondsInPixel*De);if(e){this._clearCanvas();let i=1e3*e[0],s=i/this._millisecondsInPixel,n=e[1],o=(t=this.model.rangeStartTime)-t%i,l=e[0]<1,h=e[0]<86400;for(let c=o,d=this.model.rangeEndTime+i;c<d;c+=i){let u=this.getOffsetByTime(c);u>=0&&u<=this.clientWidth*this._canvasScale&&Hn(this._ctx,u*this._canvasScale,10*this._canvasScale,2*this._canvasScale,Vn);for(let f=1;f<n;f++){let _=u+f*(s/n);_>=0&&_<=this.clientWidth*this._canvasScale&&Hn(this._ctx,_*this._canvasScale,5*this._canvasScale,1*this._canvasScale,Vn)}Fl(this._ctx,Dl(new Date(c),h,l),u*this._canvasScale,26*this._canvasScale,"24px monospace","#bfbfbf","center")}this._drawCurrent()}var t}}function Un(a,e){const t=new Date(a);return t.setHours(t.getHours()+e),t}class gi{constructor(){this.resolve=()=>{},this.reject=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t}),Object.freeze(this)}}const Gl=["startcollecting","profilecollected","clear"];class jl{constructor(e={}){this.events=at(Gl),this.planet=e.planet||null,this._warningHeightLevel=5,this._pointsReady=!1,this._isWarning=!1,this._minX=0,this._planeDistance=this._maxX=1e3,this._minY=0,this._maxY=200,this._drawData=[[],[]],this._promiseArr=[],this._promiseCounter=0,this._pMaxY=0,this._pMinY=0,this._pDist=0,this._pTrackCoords=[],this._pGroundCoords=[],this._pIndex=0}bindPlanet(e){this.planet=e}setWarningHeightLevel(e=0){this._warningHeightLevel=e}setRange(e,t,i,s){this._minX=e,this._maxX=t,i&&(this._minY=i),s&&(this._maxY=s)}_getHeightAsync(e,t,i){let s=new gi;if(this.planet){let n=this.planet.terrain.geoid.getHeightLonLat(e);this.planet.terrain.getHeightAsync(e,o=>{this.planet&&i===this._promiseCounter?(o+=n,this._pGroundCoords[t][1]=o,this._pGroundCoords[t][2]=0,this._pGroundCoords[t][3]=e.height,o>this._pMaxY&&(this._pMaxY=o),o<this._pMinY&&(this._pMinY=o),this._updatePointType(t),s.resolve(o)):s.reject()})}else s.reject();return s.promise}_collectCoordsBetweenTwoTrackPoints(e,t,i,s,n,o){if(this.planet)for(let l=1;l<=t;l++){this._pDist+=1,this._pIndex++;let h=l*i,c=s.add(n.scaleTo(h)),d=this.planet.ellipsoid.cartesianToLonLat(c);this._pGroundCoords[this._pIndex]=[this._pDist,0,0,0,e],((u,f)=>{this._promiseArr.push(this._getHeightAsync(u,f,o))})(d,this._pIndex)}}_collectAllPoints(e,t){if(!this.planet||t!==this._promiseCounter)return;let i=new m,s=new m;for(let n=1,o=e.length;n<o;n++){let l=e[n-1],h=e[n];this.planet.ellipsoid.lonLatToCartesianRes(l,i),this.planet.ellipsoid.lonLatToCartesianRes(h,s);let c=s.sub(i),d=c.length(),u=this.planet.ellipsoid.getSurfaceNormal3v(i),f=m.proj_b_to_plane(c,u),_=f.length(),g=Math.floor(_/1),v=1*d/_;this._getGroundElevation(l,n-1,t),f.normalize(),c.normalize(),this._collectCoordsBetweenTwoTrackPoints(n-1,g,v,i,c,t),this._pDist+=_-1*g,this._pIndex++;let p=h.height;p>this._pMaxY&&(this._pMaxY=p),p<this._pMinY&&(this._pMinY=p),this._pTrackCoords[n]=[this._pDist,p,this._pIndex]}}_getGroundElevation(e,t,i){this._pGroundCoords[this._pIndex]=[this._pDist,0,0,0,t],this._promiseArr.push(this._getHeightAsync(e,this._pIndex,i))}_calcPointsAsync(e,t){return new Promise((i,s)=>{this._pTrackCoords=[[0,e[0].height,0]],this._pMaxY=e[0].height,this._pMinY=this._pMaxY,this._pDist=0,this._pGroundCoords=[],this._pIndex=0,this._promiseArr=[],this._collectAllPoints(e,t),this._getGroundElevation(e[e.length-1],e.length-1,t),Promise.all(this._promiseArr).then(()=>{i({dist:this._pDist,minY:this._pMinY,maxY:this._pMaxY,trackCoords:this._pTrackCoords,groundCoords:this._pGroundCoords})})})}get minX(){return this._minX}get planeDistance(){return this._planeDistance}get maxX(){return this._maxX}get minY(){return this._minY}get maxY(){return this._maxY}get pointsReady(){return this._pointsReady}get isWarningOrCollision(){return this._isWarning}get drawData(){return this._drawData}collectProfile(e){let t=new gi;return this.planet||t.reject(),this._pointsReady=!1,this._isWarning=!1,e&&e.length?(this.events.dispatch(this.events.startcollecting,this),this._promiseCounter++,(i=>{this._calcPointsAsync(e,i).then(s=>{i===this._promiseCounter&&(this._planeDistance=s.dist,this.setRange(0,s.dist,s.minY-.1*Math.abs(s.minY),s.maxY+.2*Math.abs(s.maxY)),this._pointsReady=!0,this._drawData=[s.trackCoords,s.groundCoords],this.events.dispatch(this.events.profilecollected,this._drawData,this),t.resolve(this._drawData))})})(this._promiseCounter),t.promise):(t.reject(),t.promise)}_updatePointType(e){this._pGroundCoords[e][3]>=this._pGroundCoords[e][1]&&this._pGroundCoords[e][3]<this._pGroundCoords[e][1]+this._warningHeightLevel-.1&&(this._pGroundCoords[e][2]=1),this._pGroundCoords[e][3]<=this._pGroundCoords[e][1]+1&&(this._pGroundCoords[e][2]=2),this._pGroundCoords[e][2]!==1&&this._pGroundCoords[e][2]!==2||(this._isWarning=!0)}_setPointsType(){this._isWarning=!1,this._pTrackCoords=this._drawData[0],this._pGroundCoords=this._drawData[1];for(let e=0;e<this._pGroundCoords.length;e++)this._updatePointType(e);this._drawData[1]=this._pGroundCoords,this.events.dispatch(this.events.profilecollected,this._drawData,this)}clear(){this._promiseCounter=0,this._pointsReady=!1,this._isWarning=!1,this._drawData=[[],[]],this._pMaxY=0,this._pMinY=0,this._pDist=0,this._pTrackCoords=[],this._pGroundCoords=[],this._pIndex=0,this.events.dispatch(this.events.clear,this._drawData,this)}}const pa="rgb(198, 198, 198)",Gn=[pa,"rgb(255, 255, 0)","rgb(255, 0, 0)"],ql=["startdrag","stopdrag","pointer","mouseenter","mouseleave","dblclick","tracklength","groundlength","warninglength","collisionlength"];class Yl extends dt{constructor(e={}){super({template:`<div class="og-elevationprofile">
      <div class="og-elevationprofile-loading" style="display: none;">
        <div class="loadingio-spinner-bars-r354qqyl5v">
          <div class="ldio-p0v5a1f6oz">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
          </div>
        </div> 
      </div>     
    </div>`,model:new jl}),this._onMouseDblClick=t=>{let i,s=this.$canvas.getBoundingClientRect(),n=t.clientX-s.left,o=this._leftDistance+(this._rightDistance-this._leftDistance)*n/this.clientWidth,l=this.model.drawData[1],h=this.model.drawData[0];o<0?(i=1,o=0,n=(0-this._leftDistance)*this.clientWidth/(this._rightDistance-this._leftDistance)):o>this.model.planeDistance?(i=l.length-1,o=this.model.planeDistance,n=(o-this._leftDistance)*this.clientWidth/(this._rightDistance-this._leftDistance)):i=-1-Se(l,o,(y,b)=>y-b[0]);let c=l[i-1],d=l[i],u=(o-c[0])/(d[0]-c[0]),f=c[1]+u*(d[1]-c[1]),_=c[4],g=h[_],v=h[_+1];u=(o-g[0])/(v[0]-g[0]);let p=g[1]+u*(v[1]-g[1]);this.events.dispatch(this.events.dblclick,o,g,v,c,d,_,i-1,p-f)},this._onMouseEnter=t=>{this._isMouseOver=!0,this.events.dispatch(this.events.mouseenter,t)},this._onMouseOut=t=>{this._isMouseOver=!1,this.events.dispatch(this.events.mouseleave,t)},this._onMouseDown=t=>{this._isMouseOver&&(this._isDragging=!0,document.body.classList.add("og-timeline-unselectable"),this._clickPosX=t.clientX,this._customFrame||(this._leftDistance=this.model.minX,this._rightDistance=this.model.maxX),this._clickLeftDistance=this._leftDistance,this._clickRightDistance=this._rightDistance,this.events.dispatch(this.events.startdrag,t))},this._onMouseUp=t=>{this._isDragging&&(this._isDragging=!1,document.body.classList.remove("og-timeline-unselectable"),this.events.dispatch(this.events.stopdrag,t))},this._onCanvasMouseMove=t=>{if(this.model.pointsReady)if(this._isDragging)this.clearPointerCanvas();else{this._customFrame||(this._leftDistance=this.model.minX,this._rightDistance=this.model.maxX);let i=this.$pointerCanvas.getBoundingClientRect(),s=t.clientX-i.left;this.redrawPointerCanvas(s)}},this._onMouseMove=t=>{if(this._isDragging&&this.model.pointsReady){let i=(this._clickPosX-t.clientX)*this._canvasScale/this._pixelsInMeter_x;this.setFrame(this._clickLeftDistance+i,this._clickRightDistance+i)}},this._onMouseWheelFF=t=>{this._onMouseWheel(t)},this._onMouseWheel=t=>{if(this._isMouseOver&&this.model.pointsReady){this._customFrame||(this._leftDistance=this.model.minX,this._rightDistance=this.model.maxX),this._customFrame=!0;let i=Math.sign(t.wheelDelta)*(this._rightDistance-this._leftDistance)/20,s=this.$canvas.getBoundingClientRect(),n=t.clientX-s.left,o=n-.5*this.$canvas.clientWidth,l=o*this._canvasScale/this._pixelsInMeter_x,h=l+this._leftDistance+i,c=l+this._rightDistance-i;l=-o*(c-h)/this.clientWidth,this.setFrame(h+l,c+l),this.redrawPointerCanvas(n)}},this.events=this.events.registerNames(ql),this.fillStyle=e.fillStyle||"rgb(63, 63, 63)",this._customFrame=!1,this._leftDistance=0,this._rightDistance=0,this._pixelsInMeter_x=0,this._pixelsInMeter_y=0,this._canvasScale=2,this.$canvas=document.createElement("canvas"),this.$canvas.style.position="absolute",this._ctx=this.$canvas.getContext("2d"),this.$pointerCanvas=document.createElement("canvas"),this.$pointerCanvas.style.pointerEvents="none",this.$pointerCanvas.style.position="absolute",this._pointerCtx=this.$pointerCanvas.getContext("2d"),this.$loading=null,this._isMouseOver=!1,this._isDragging=!1,this._clickPosX=0,this._clickLeftDistance=0,this._clickRightDistance=0,this._timeStartHandler=0,this._onResizeObserver_=this._onResizeObserver.bind(this),this._resizeObserver=new ResizeObserver(this._onResizeObserver_)}_onResizeObserver(){this.resize()}get canvasScale(){return this._canvasScale}set canvasScale(e){e!==this._canvasScale&&(this._canvasScale=e,this.resize())}resize(){this._resize(),this.draw()}render(){return super.render(),this._resizeObserver.observe(this.el),this.el.appendChild(this.$canvas),this.el.appendChild(this.$pointerCanvas),this.model.events.on("profilecollected",e=>{this._hideLoading(),this.clearPointerCanvas(),this.draw()}),this.model.events.on("startcollecting",()=>{clearTimeout(this._timeStartHandler),this._timeStartHandler=setTimeout(()=>{this._showLoading()},450)}),this.model.events.on("clear",()=>{this._customFrame=!1,this._leftDistance=0,this.clearCanvas(),this.clearPointerCanvas()}),this.$loading=this.select(".og-elevationprofile-loading"),this.$canvas.addEventListener("mouseenter",this._onMouseEnter),this.$canvas.addEventListener("mouseout",this._onMouseOut),this.$canvas.addEventListener("dblclick",this._onMouseDblClick),this.$canvas.addEventListener("mousemove",this._onCanvasMouseMove),document.body.addEventListener("mousemove",this._onMouseMove),document.body.addEventListener("mousedown",this._onMouseDown),document.body.addEventListener("mouseup",this._onMouseUp),document.body.addEventListener("wheel",this._onMouseWheelFF),this}_hideLoading(){clearTimeout(this._timeStartHandler),this.$loading.style.display="none"}_showLoading(){this.$loading.style.display="flex"}redrawPointerCanvas(e){this.clearPointerCanvas();let t,i=this._leftDistance+(this._rightDistance-this._leftDistance)*e/this.clientWidth,s=this.model.drawData[1],n=this.model.drawData[0];i<0?(t=1,i=0,e=(0-this._leftDistance)*this.clientWidth/(this._rightDistance-this._leftDistance)):i>this.model.planeDistance?(t=s.length-1,i=this.model.planeDistance,e=(i-this._leftDistance)*this.clientWidth/(this._rightDistance-this._leftDistance)):t=-1-Se(s,i,(b,C)=>b-C[0]);let o=s[t-1],l=s[t],h=(i-o[0])/(l[0]-o[0]),c=o[1]+h*(l[1]-o[1]),d=o[4],u=n[d],f=n[d+1];h=(i-u[0])/(f[0]-u[0]);let _=u[1]+h*(f[1]-u[1]),g=(this.model.maxY-_)*this._pixelsInMeter_y,v=(this.model.maxY-c)*this._pixelsInMeter_y;this.events.dispatch(this.events.pointer,i,u,f,o,l,d,t-1,_-c);let p=this._pointerCtx;p.lineWidth=3,p.strokeStyle="rgba(64,64,64,0.6)",p.beginPath(),p.moveTo(e*this._canvasScale,0),p.lineTo(e*this._canvasScale,this.clientHeight*this._canvasScale),p.stroke(),p.beginPath(),p.arc(e*this._canvasScale,v,4,0,2*Math.PI,!1),p.fillStyle="#FFB277",p.fill(),p.lineWidth=4,p.strokeStyle="#FFB277",p.stroke(),p.beginPath(),p.arc(e*this._canvasScale,g,4,0,2*Math.PI,!1),p.fillStyle="#FFB277",p.fill(),p.lineWidth=4,p.strokeStyle="#FFB277",p.stroke(),p.lineWidth=3,p.strokeStyle="#FFB277",p.beginPath(),p.moveTo(e*this._canvasScale,v),p.lineTo(e*this._canvasScale,g),p.stroke(),p.fillStyle="white",p.font=28/devicePixelRatio+"px Arial",p.textBaseline="middle",p.textAlign="left",p.fillText(`${Math.round(_-c).toString()} m`,(e+5)*this._canvasScale,v+.5*(g-v)),p.fillStyle="white",p.font=28/devicePixelRatio+"px Arial",p.textAlign="right";let y=Ue(i);p.fillText(`${y[0]} ${y[1]}`,(e-5)*this._canvasScale,(this.clientHeight-7)*this._canvasScale)}get clientWidth(){return this.$canvas?this.$canvas.width/this._canvasScale:0}get clientHeight(){return this.$canvas?this.$canvas.height/this._canvasScale:0}_resize(){this.el&&(this.$canvas.width=this.el.clientWidth*this._canvasScale,this.$canvas.height=this.el.clientHeight*this._canvasScale,this.$canvas.style.width=`${this.el.clientWidth}px`,this.$canvas.style.height=`${this.el.clientHeight}px`,this.$pointerCanvas.width=this.el.clientWidth*this._canvasScale,this.$pointerCanvas.height=this.el.clientHeight*this._canvasScale,this.$pointerCanvas.style.width=`${this.el.clientWidth}px`,this.$pointerCanvas.style.height=`${this.el.clientHeight}px`,this._customFrame&&(this._pixelsInMeter_x=this._canvasScale*this.clientWidth/(this._rightDistance-this._leftDistance)))}clearPointerCanvas(){this._pointerCtx.fillStyle="rgba(0,0,0,0)",this._pointerCtx.clearRect(0,0,this.clientWidth*this._canvasScale,this.clientHeight*this._canvasScale)}clearCanvas(){const e=this._ctx.createLinearGradient(0,0,0,this.clientHeight*this._canvasScale);e.addColorStop(0,"black"),e.addColorStop(1,this.fillStyle),this._ctx.fillStyle=e,this._ctx.fillRect(0,0,this.clientWidth*this._canvasScale,this.clientHeight*this._canvasScale)}setFrame(e,t){this._leftDistance=e,this._rightDistance=t,this._customFrame=!0,this._pixelsInMeter_x=this._canvasScale*this.clientWidth/(this._rightDistance-this._leftDistance),this.model.setRange(e,t),this.draw()}_updateUnits(){this._customFrame||(this._pixelsInMeter_x=this._canvasScale*this.clientWidth/(this.model.maxX-this.model.minX)),this._pixelsInMeter_y=this._canvasScale*this.clientHeight/(this.model.maxY-this.model.minY)}clear(){this.model.clear(),this.clearCanvas()}draw(){let e=this.model.drawData[0];if(e.length>1){this._updateUnits(),this.clearCanvas();let t=this.model.drawData[1];this._drawTrack(e,t),this._drawTerrain(t),this._drawWarningAndCollision(t),this._drawLabels(e,t)}else this.clearCanvas()}_drawLabels(e,t){let i=this._ctx;if(i){let s=e[0];const n=this.model.maxY;let o=(-this._leftDistance+s[0])*this._pixelsInMeter_x,l=(n-s[1])*this._pixelsInMeter_y;t[s[2]][1],this._pixelsInMeter_y,i.beginPath(),i.fillStyle="#F7F718",i.fillRect(o-4,l-4,8,8),i.stroke(),i.fillStyle="white",i.font=26/devicePixelRatio+"px Arial",i.textBaseline="bottom",i.textAlign="left",i.fillText(`${Math.round(s[1]-t[s[2]][1]).toString()} m`,o+1,l-10),i.stroke();for(let h=1,c=e.length;h<c;h++){let d=e[h];o=(-this._leftDistance+d[0])*this._pixelsInMeter_x,l=(n-d[1])*this._pixelsInMeter_y,t[d[2]][1],this._pixelsInMeter_y,i.beginPath(),i.fillStyle="#F7F718",i.fillRect(o-4,l-4,8,8),i.stroke(),i.fillStyle="white",i.fillText(`${Math.round(d[1]-t[d[2]][1]).toString()} m`,o+1,l-10),i.stroke()}}}_drawTrack(e,t){let i=e[0],s=this._ctx;if(s){const n=this.model.maxY;s.lineWidth=5,s.strokeStyle="rgb(0, 255, 50)",s.beginPath(),s.moveTo((-this._leftDistance+i[0])*this._pixelsInMeter_x,(n-i[1])*this._pixelsInMeter_y);let o=0;for(let d=1,u=e.length;d<u;d++){let f=e[d];s.lineTo((-this._leftDistance+f[0])*this._pixelsInMeter_x,(n-f[1])*this._pixelsInMeter_y);let _=e[d-1],g=f[0]-_[0],v=f[1]-_[1],p=g*g,y=v*v;o+=Math.sqrt(p+y)}s.stroke(),s.lineWidth=2,s.strokeStyle="rgba(255,255,255,0.7)",s.beginPath();let l=(-this._leftDistance+i[0])*this._pixelsInMeter_x,h=(n-i[1])*this._pixelsInMeter_y,c=(n-t[i[2]][1])*this._pixelsInMeter_y;s.moveTo(l,h),s.lineTo(l,c);for(let d=1,u=e.length;d<u;d++){let f=e[d];l=(-this._leftDistance+f[0])*this._pixelsInMeter_x,h=(n-f[1])*this._pixelsInMeter_y,c=(n-t[f[2]][1])*this._pixelsInMeter_y,s.strokeStyle="rgba(255,255,255,0.7)",s.moveTo(l,h),s.lineTo(l,c)}s.stroke(),this.events.dispatch(this.events.tracklength,o)}}_drawTerrain(e){let t=e[0],i=this._ctx;if(i){const s=this.model.maxY;i.lineWidth=5,i.strokeStyle=pa,i.beginPath(),i.moveTo((-this._leftDistance+t[0])*this._pixelsInMeter_x,this.$canvas.height),i.lineTo((-this._leftDistance+t[0])*this._pixelsInMeter_x,(s-t[1])*this._pixelsInMeter_y);let n=0;for(let o=1,l=e.length;o<l;o++){let h=e[o];i.lineTo((-this._leftDistance+h[0])*this._pixelsInMeter_x,(s-h[1])*this._pixelsInMeter_y);let c=e[o-1],d=h[0]-c[0],u=h[1]-c[1],f=d*d,_=u*u;n+=Math.sqrt(f+_)}i.lineTo((-this._leftDistance+e[e.length-1][0])*this._pixelsInMeter_x,this.$canvas.height),i.closePath(),i.stroke(),i.save(),i.fillStyle="rgb(64, 68, 82)",i.globalAlpha=.5,i.fill(),i.restore(),i.globalAlpha=1,this.events.dispatch(this.events.groundlength,n)}}_drawWarningAndCollision(e){let t=this._ctx;if(t&&e.length>1){let i=this.model.maxY;t.lineWidth=5,t.beginPath();let s=0,n=0;for(let o=0,l=e.length-1;o<l;o++){let h=e[o],c=e[o+1];if(h[2]!==0&&c[2]!==0){let d=c[0]-h[0],u=c[1]-h[1],f=d*d,_=u*u;h[2]===2?(t.stroke(),t.beginPath(),t.strokeStyle=Gn[2],n+=Math.sqrt(f+_)):h[2]===1&&(t.stroke(),t.beginPath(),t.strokeStyle=Gn[1],s+=Math.sqrt(f+_)),t.moveTo((-this._leftDistance+h[0])*this._pixelsInMeter_x,(i-h[1])*this._pixelsInMeter_y),t.lineTo((-this._leftDistance+c[0])*this._pixelsInMeter_x,(i-c[1])*this._pixelsInMeter_y)}}t.stroke(),this.events.dispatch(this.events.warninglength,s),this.events.dispatch(this.events.collisionlength,n)}}}let Wl=W.createCylinder(.33,0,1,20,1,!0,!1,0,0,0),$l=W.createCylinder(.33,.33,1.1,20,1,!0,!0,0,-.55,0);const Xl={startPosition:new m,endPosition:new m,startColor:"rgba(255,131,0,0.2)",endColor:"rgba(255,131,0,1.0)",thickness:2.7},Zl={src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjEuNBNAaMQAAAiLSURBVHhe7Z0r0BxFEMcjIhAIRERERAQCgUAgEBEIBAIRiUAgIiIQiAgEIlUREQgEIgIREYFAIBCIiAgEIiIiAoGIoHimqPAKz5CP/t23/8vcbe89d/dmZ/pf9avLdZK72e6+ee3M7Imjo6Opc8o4b7xn3DIeGEOJz+Y7+C6+k+/2yjQZXOMEOGdcNe4anv4wvjV+m73bT3wGn8VneqIMlIUyeWXNGteYKTj4feNrI9W/xi/HfxxVfCffnYqyUcbJJINrzIjTxjvGV0aqn43fj/+YhSgLZUpFmd81uAbv2rLANWbAC8ZHxp+GxC8ufZ+rKGNaI1FLcC1ck3etB8U1HhCqzk8N6T/jENV7X6LsXIN008iqeXCNB+B54zND+tt4ePzHIsS1cE0SicA1e74YFdc4IgyjrhvqTP3TvJas9Bq59oP2EVzjCJw03jI0TCMBcurUDS1qBCU9PnjbwCeerwbFNQ4MVd9tQ5pyG7+v0mvHJ6N3FF3jgFwy1JPvmlipUfIFvmHY6/luEFzjANDO0fGRfm1eQ0+UzlriqzOG58tecY0985LxnYH+al5D3ZKP8Bm+83zaG66xRy4a6uzU3NZvK/nqkUEH0fNtL7jGHqBH+4EhTWEGL2ddMwYZJbjGPaGgHxuIDA7tJ/mQGdLek8A17sHTxucGiva+P6kGxbf42PP9TrjGHUmDH1V+/xokCVzjDkTwx1HvSeAat4R2SWP8CP7wko9ZmrZ3n8A1bok6fBH88SRf4/u9ksA1bgFr4ZDG+qHxpLuKLFD1YrMRrnFDLhjocfMaGl8aIjLh5sVoLa5xA140+lhxG+pHNAk7TRu7xjXQ+9TK3Jru4ecqxYB7B88YXsw6cY1rUKcv7ujlI907YLbQi1knrnEFavej05ef1ClkpZUXOxfX2AH3p6Pdz1/E6FnDi2EL19iBVu3Gbd18pdgwU+jFsIVrdHjDQHGDJ39pkojm2ovlAq5xCXqWWtETmo7uG2t3L7vGJTTbF73+6UhNARtVvZjOcY0JZ42Y45+uGK2t7BC6xoQbBoqO3/SkGpt5Gy+2M1xjw3MGGZRubgxNS5qv6dxw4hob9OuPsf90pWnizlrANRpM+sSvvwypFqBGb8W6ZWjgHjOKtn/6Ug3OMv1WrFsG4ykjqv3yxGiudbdw4U2DbvjEuL8cqSZv7TJaeNOg1b2h8nTHWIj3whuDSQOUHmcSKkPagr5wNE0afLhioOj8lSc16QvTw2nwYfk8vlB5YjnfPOZp8FX9x8kd5Uqju3kzkCYAPUQU1X+5UjPACaatBEiPcAmVrfmKIQU/Jn/qEpNCs82lSgCOL0U/Na+hcvVD8/qKMU8AjiZDsdGjfCnGl415AnyCJVSVZptIlAD3sISqEgt9ZwnAHSIU07/1SMv7T5EA7CpFPzavofKljuA5EkCbPmICqB4p1m+SAPQGQ3XqMgnAQwtCdeo6CRBTwPXqJgnAKpFQnbpDAsQcQL26RwLEzt96dZ8ECFWsSIDKFQlQuSIBKlckQOUiAThLJlSnZqOAmAeoV7N5gJgJrFd3SQCePBGqU7dIgLgbWK9mdwO1ITRUn66QADoQIlYE1SPF+gIJEGsC69PCmkDOk0WxKrgeaQf4aRIA9AiYUD2a7wuA2BlUn1gKOE8A9ouj2BtYvh42r4z+5gnATlEUHcHy9X3z+poxT4A4H6Aecfxv63wAiOXh9ah1QgioHxAnhJYr1fKz9h/SBOA0aRSnhJUrJQCP/m0lAMQ5geWr85xA0I2haAbKk4b4K08KVTMQ08LlSU37vPqHNPgiVgiVK5r4hXgvvGm4aKC4PVyOFMuNnhfABEFMCpWnjZ8YAjxfBkUiTF/q/LH0rxXrlqFBJ4friVOh6Uod+oUHRYiWIYFnzaG4QzhdqefPo/+9GK9MAJ42SQ0QtcB0pV//wtAvxTUmqBaIiaHpSff9Z0fCduEaE+gLxBNEpyliRuzctl+4xiU0Ioh5gelIsfrQ8GI6xzUuwdjxgRGalojZacOL6RzX6KDNI0wmhPKWev6tWT8P19jBFwaKDmG+0pD9tnHS8OK4gGvsgDuFUQPkr7UdvxTXuAI9Wk7nzYfykX6clwwvdi6ucQ3MKqEYFeQjxYKFvRtV/cI1roG9hDpdNNYPHl6KAWc9re31L+MaN4DHzMUUcT4iFi8bXqxW4ho3RP2Bx81raHw9al557J8Xo7W4xi24ZqAYHYwv+XztbN8qXOMW0OFQpzBuG48n+XrrTt8yrnFLWELGViMUSTC85GN8Ptvftw+ucQcYGTD7hCIJhpN8y8rtrXv8Hq5xR7hpdNdAkQT9Sz7Fx70EH1zjHlAl6Z5BdAz7k3xJLdta2bsPrnFP0j5BzBXsL/mwlzZ/GdfYA/RMbxgo5gl2l3yHL/fq7XfhGnskfSpp3DvYXKmvZs/5HwrX2DOcP6QVRVqoGOqWfMSmnFcNz6e94RoH4IyhziGLFeMmUlv4RItv8RU+83zZK65xIGjDOH9AnZoYKj6RfIFvrhqDtPcernFg2KTwpSHVvMQsvXa2bnNus+ezwXCNI6DaQOPbGoeLumZ8gC9G+9WnuMYRYeOJdh+hGiaP0mvkiF584PlmFFzjAWAxgzqJqMRESK+Ja91pAUffuMYDwvGlaSJQTU65j0DZ0+aNaztveNd+EFxjBjB3QPWYOm9Kh1WkZeUa2KDJNXnXelBcY0bQPnKs2fIj7nOsFZbLRJkp+0Hb+HW4xgzhMGuqTubEl2sC9igcYpqZ71zeH0HZKCNlpczetWSFa8wcJQO7lrtONiUQ3xh9TDbxGXxWVxNEGSjLZIKe4honxlnjdYMFqnSyhhxB8Nl8B9/Fd/LdXpkmg2ssANpdfpEsXacdZq6BJ6Tya+VZyWnnUsLG3/Fv+Lf8H/4vn8FnZd2W78bRif8BxMOwtJg5Ph4AAAAASUVORK5CYII=",color:"rgb(255,131,0)",size:[8,8]},Kl={text:"",face:"arial",size:10.5,color:"rgba(455,455,455,1.0)",outlineColor:"rgba(0,0,0,0.34)",outline:.23,align:"left",offset:[5,15,-5]},jn={face:"arial",text:"",size:10.5,color:"rgba(455,455,455,1.0)",outlineColor:"rgba(0,0,0,0.34)",outline:.23,align:"right",offset:[-47,25,0]},Ql={instanced:!0,tag:"ground-pointer",color:"rgb(0,305,0)",object3d:Wl},Jl={instanced:!0,tag:"head-pointer",color:"rgb(305,305,0)",object3d:$l};class th extends ce{constructor(e={}){super("ElevationProfileScene"),this._onLClick=t=>{let i=this._planet.getCartesianFromPixelTerrain(t.pos);i&&this.addGroundPoint3vAsync(i)},this._onMouseMove=t=>{if(this._planet.getCartesianFromMouseTerrain(),this._pickedGroundEntity){let i=new N(t.x,t.y).sub(this._startClickPos),s=this._startEntityPos.add(i),n=this._planet.getCartesianFromPixelTerrain(s);n&&this.setGroundPointCartesian3v(this._pickedGroundEntity.properties.index,n)}else if(this._pickedHeadEntity){let i=this._planet.camera,s=this._pickedHeadEntity.properties.groundEntity.getCartesian(),n=this._planet.ellipsoid.getSurfaceNormal3v(s),o=s.add(n),l=s.add(i.getRight()),h=new m;if(new H(i.eye,t.direction).hitPlaneRes(mt.fromPoints(s,o,l),h)===H.INSIDE){let c=m.proj_b_to_a(h,s),d=c.sub(s).dot(s),u=s.add(n.scale(Math.sign(d)*c.distance(s)));this.setHeadPointCartesian3v(this._pickedHeadEntity.properties.index,u)}}},this._onLUp=t=>{},this._onGroundPointerEnter=t=>{t.renderer.handler.canvas.style.cursor="pointer"},this._onGroundPointerLeave=t=>{t.renderer.handler.canvas.style.cursor="default"},this._onGroundPointerLDown=t=>{this._clampToGround=!1,this.renderer.controls.navigation.deactivate(),this._pickedGroundEntity=t.pickingObject;const i=this._pickedGroundEntity.getCartesian();this._startClickPos.set(t.x,t.y),this._startEntityPos=this._planet.getPixelFromCartesian(i)},this._onGroundPointerLUp=t=>{this._clampToGround=!0,this.renderer.controls.navigation.activate(),this._pickedGroundEntity=null},this._onHeadPointerEnter=t=>{t.renderer.handler.canvas.style.cursor="pointer"},this._onHeadPointerLeave=t=>{t.renderer.handler.canvas.style.cursor="default"},this._onHeadPointerLDown=t=>{this.renderer.controls.navigation.deactivate(),this._pickedHeadEntity=t.pickingObject},this._onHeadPointerLUp=t=>{this.renderer.controls.navigation.activate(),this._pickedHeadEntity=null},this.events=at(eh),this._planet=e.planet||null,this._pickedGroundEntity=null,this._pickedHeadEntity=null,this._startClickPos=new N,this._startEntityPos=new N,this._clampToGround=!0,this._trackLayer=new ut("track",{entities:[],pickingEnabled:!1,polygonOffsetUnits:-1,relativeToGround:!0,hideInLayerSwitcher:!0}),this._groundPointersLayer=new ut("ground-pointers",{entities:[],pickingEnabled:!0,hideInLayerSwitcher:!0,scaleByDistance:[1,5e3,.02],pickingScale:1.5}),this._headPointersLayer=new ut("head-pointers",{entities:[],pickingEnabled:!0,hideInLayerSwitcher:!0,scaleByDistance:[1,1e4,.02],pickingScale:1}),this._columnPointersLayer=new ut("column-pointers",{entities:[],pickingEnabled:!1,hideInLayerSwitcher:!0}),this._trackEntity=new U({polyline:{path3v:[],thickness:3.8,color:"rgba(0,305,0,0.8)",isClosed:!1}}),this._trackLayer=new ut("column-pointers",{entities:[this._trackEntity],pickingEnabled:!1,hideInLayerSwitcher:!0}),this._heightsLayer=new ut("heights-labels",{entities:[],pickingEnabled:!1,hideInLayerSwitcher:!0}),this._pointerHeadEntity=new U({cartesian:new m,billboard:Zl}),this._pointerLabelEntity=new U({cartesian:new m,label:Kl}),this._pointerRayEntity=new U({cartesian:new m,ray:Xl}),this._pointerLayer=new ut("pointer",{entities:[this._pointerHeadEntity,this._pointerLabelEntity,this._pointerRayEntity],pickingEnabled:!1,hideInLayerSwitcher:!0})}flyExtent(){let e=this._headPointersLayer.getEntities(),t=180,i=180,s=-180,n=-180,o=-1e6;if(e.length>1){for(let l=0;l<e.length;l++){let h=e[l].getLonLat();h.lon<t&&(t=h.lon),h.lat<i&&(i=h.lat),h.lon>s&&(s=h.lon),h.lat>n&&(n=h.lat),h.height>o&&(o=h.height)}this._planet.camera.flyExtent(new V(new A(t,i),new A(s,n)),o,{amplitude:0})}}get planet(){return this._planet}_createGroundPointer(e,t=10){let i=this.ellipsoid.getSurfaceNormal3v(e),s=e.add(i.scale(t)),n=new U({ray:{startPosition:e,endPosition:s,startColor:"rgba(255,255,255,0.2)",endColor:"rgba(355,355,355,1.0)",thickness:3.2}}),o=new U({cartesian:e,geoObject:Ql}),l=new U({cartesian:s,geoObject:Jl,properties:{}}),h=new U({cartesian:s,label:jn});h.appendChild(new U({cartesian:s,label:{...jn,offset:[-47,45,0]}}));const c=this._groundPointersLayer.getEntities().length;return n.properties=o.properties=l.properties={index:c,altitude:t,lonLatEll:new A,headEntity:l,groundEntity:o,columnEntity:n,heightLabelEntity:h},{headEntity:l,groundEntity:o,columnEntity:n,heightLabelEntity:h}}setPointerCartesian3v(e,t){this._pointerLabelEntity.setCartesian3v(e),this._pointerLabelEntity.label.setText(`${Math.round(t).toString()} m`),this._pointerRayEntity.ray.setEndPosition3v(e);let i=this._planet.ellipsoid.getSurfaceNormal3v(e);this._pointerRayEntity.ray.setStartPosition3v(e.add(i.scale(-t))),this._pointerHeadEntity.setCartesian3v(e)}bindPlanet(e){this._planet=e}init(){this._activate()}onremove(){this._deactivate()}_activate(){this._planet.addLayer(this._trackLayer),this._planet.addLayer(this._groundPointersLayer),this._planet.addLayer(this._columnPointersLayer),this._planet.addLayer(this._headPointersLayer),this._planet.addLayer(this._heightsLayer),this._planet.addLayer(this._pointerLayer),this.renderer.events.on("ldblclick",this._onLClick),this.renderer.events.on("mousemove",this._onMouseMove),this.renderer.events.on("lup",this._onLUp),this._groundPointersLayer.events.on("mouseenter",this._onGroundPointerEnter),this._groundPointersLayer.events.on("mouseleave",this._onGroundPointerLeave),this._groundPointersLayer.events.on("ldown",this._onGroundPointerLDown),this._groundPointersLayer.events.on("lup",this._onGroundPointerLUp),this._headPointersLayer.events.on("mouseenter",this._onHeadPointerEnter),this._headPointersLayer.events.on("mouseleave",this._onHeadPointerLeave),this._headPointersLayer.events.on("ldown",this._onHeadPointerLDown),this._headPointersLayer.events.on("lup",this._onHeadPointerLUp),this.setPointerVisibility(!1)}getPointLonLat(e){let t=this._headPointersLayer.getEntities()[e];if(t)return t.getLonLat()}getPointsLonLat(){let e=this._headPointersLayer.getEntities(),t=new Array(e.length);for(let i=0,s=t.length;i<s;i++){let n=e[i];t[i]=n.getLonLat()}return t}getHeightMSL(e){return this._planet&&this._planet.terrain.geoid?this._planet.terrain.geoid.getHeightLonLat(e):0}getHeightELLAsync(e){return new Promise((t,i)=>{this._planet.terrain.getHeightAsync(e,s=>{if(this._planet){let n=this.getHeightMSL(e);t(s+n)}else i()})})}addPointLonLatArrayAsync(e,t=!1){if(!this._planet)throw new Error("Planet is not defined");let i=this._planet.ellipsoid;for(let n=0,o=e.length-1;n<o;n++){let l=i.lonLatToCartesian(e[n]),h=i.lonLatToCartesian(e[n+1]);if(l.distance(h)>1e5)throw new Error("Track is too long! 100 km is maximum.")}let s=new Array(e.length);for(let n=0,o=e.length;n<o;n++)s[n]=this.addPointLonLatAsync(e[n],!0);return Promise.all(s).then(()=>{t||this.events.dispatch(this.events.change,this)}),s}addPointLonLatAsync(e,t=!1){let i=this._planet.ellipsoid.lonLatToCartesian(e),s=this._planet.ellipsoid.getSurfaceNormal3v(i),n=new A(e.lon,e.lat),o=this._planet.ellipsoid.lonLatToCartesian(n),{headEntity:l,groundEntity:h,columnEntity:c,heightLabelEntity:d}=this._createGroundPointer(o);return this._groundPointersLayer.add(h),this._columnPointersLayer.add(c),this._headPointersLayer.add(l),this._heightsLayer.add(d),this._trackEntity.polyline.appendPoint3v(l.getCartesian()),h.properties.lonLatEll.lon=n.lon,h.properties.lonLatEll.lat=n.lat,h.properties.lonLatEll.height=n.height,new Promise(u=>{this.getHeightELLAsync(e).then(f=>{var _;h.properties.lonLatEll.height=f;let g,v=10;e.height===0?(g=i.add(s.scaleTo(f)),i=g.add(s.scaleTo(v))):(v=e.height-f,g=i.sub(s.scaleTo(v))),h.setCartesian3v(g),d.setCartesian3v(i),d.label.setText(`${f.toFixed(1)} m`),d.childEntities[0].label.setText(`${v.toFixed(1)} m`),l.properties.altitude=v,l.setCartesian3v(i),l.properties.columnEntity.ray.setStartPosition3v(g),l.properties.columnEntity.ray.setEndPosition3v(i),(_=this._trackEntity.polyline)==null||_.setPoint3v(i,l.properties.index),t||(this.events.dispatch(this.events.addpoint,l,this),this.events.dispatch(this.events.change,this)),u(l)})})}addGroundPointLonLatAsync(e,t=10,i=!1){let s=this._planet.ellipsoid.lonLatToCartesian(e);return this._addPoint(s,e,t,i)}addGroundPoint3vAsync(e,t=10,i=!1){let s=this._planet.ellipsoid.cartesianToLonLat(e);return this._addPoint(e,s,t,i)}_addPoint(e,t,i,s=!1){return new Promise((n,o)=>{let{headEntity:l,groundEntity:h,columnEntity:c,heightLabelEntity:d}=this._createGroundPointer(e,i);this._groundPointersLayer.add(h),this._columnPointersLayer.add(c),this._headPointersLayer.add(l),this._heightsLayer.add(d),this._trackEntity.polyline.appendPoint3v(l.getCartesian()),h.properties.lonLatEll.lon=t.lon,h.properties.lonLatEll.lat=t.lat,h.properties.lonLatEll.height=t.height,this.getHeightELLAsync(t).then(u=>{var f;h.properties.lonLatEll.height=t.height=u;let _=this._planet.ellipsoid.lonLatToCartesian(t),g=this._planet.ellipsoid.getSurfaceNormal3v(_),v=_.add(g.scale(i));d.setCartesian3v(v),d.label.setText(`${u.toFixed(1)} m`),d.childEntities[0].label.setText(`${i.toFixed(1)} m`),l.setCartesian3v(v),l.properties.columnEntity.ray.setEndPosition3v(v),(f=this._trackEntity.polyline)==null||f.setPoint3v(v,l.properties.index),s||(this.events.dispatch(this.events.addpoint,l,this),this.events.dispatch(this.events.change,this)),n(l)})})}setHeadPointCartesian3v(e,t){const i=this._headPointersLayer.getEntities()[e];if(i){let s=this._planet.ellipsoid.lonLatToCartesian(i.properties.lonLatEll),n=t.length()-s.length();n<=0&&(t=s,n=0),i.properties.altitude=n,i.setCartesian3v(t),i.properties.columnEntity.ray.setEndPosition3v(t),i.properties.heightLabelEntity.setCartesian3v(t),i.properties.heightLabelEntity.childEntities[0].label.setText(`${n.toFixed(1)} m`),this._trackEntity.polyline.setPoint3v(t,e),this.events.dispatch(this.events.change,this._pickedHeadEntity)}}setGroundPointCartesian3v(e,t){var i;let s=this._groundPointersLayer.getEntities()[e];if(s){let n=this._planet.ellipsoid.cartesianToLonLat(t);s.properties.lonLatEll.lon=n.lon,s.properties.lonLatEll.lat=n.lat,s.properties.lonLatEll.height=n.height;let o=this._planet.ellipsoid.getSurfaceNormal3v(t),l=s.properties.headEntity,h=s.properties.heightLabelEntity,c=s.properties.altitude;s.setCartesian3v(t);let d=t.add(o.scale(c));l.setCartesian3v(d),l.properties.columnEntity.ray.setStartPosition3v(t),l.properties.columnEntity.ray.setEndPosition3v(d),(i=this._trackEntity.polyline)==null||i.setPoint3v(d,l.properties.index),h.setCartesian3v(d),h.label.setText(`${n.height.toFixed(1)} m`),h.childEntities[0].label.setText(`${c.toFixed(1)} m`),this.events.dispatch(this.events.change,s.properties.headEntity)}}_deactivate(){this.renderer.events.off("ldblclick",this._onLClick),this.renderer.events.off("mousemove",this._onMouseMove),this.renderer.events.off("lup",this._onLUp),this._groundPointersLayer.events.off("mouseenter",this._onGroundPointerEnter),this._groundPointersLayer.events.off("mouseleave",this._onGroundPointerLeave),this._groundPointersLayer.events.off("ldown",this._onGroundPointerLDown),this._groundPointersLayer.events.off("lup",this._onGroundPointerLUp),this._headPointersLayer.events.off("mouseenter",this._onHeadPointerEnter),this._headPointersLayer.events.off("mouseleave",this._onHeadPointerLeave),this._headPointersLayer.events.off("ldown",this._onHeadPointerLDown),this._headPointersLayer.events.off("lup",this._onHeadPointerLUp),this._trackLayer.remove(),this._groundPointersLayer.remove(),this._headPointersLayer.remove(),this._columnPointersLayer.remove(),this._trackLayer.remove(),this._heightsLayer.remove(),this._pointerLayer.remove(),this.clear()}setPointerVisibility(e){this._pointerLayer.setVisibility(e)}setVisibility(e){this._groundPointersLayer.setVisibility(e),this._trackLayer.setVisibility(e),this._columnPointersLayer.setVisibility(e),this._headPointersLayer.setVisibility(e),this._trackLayer.setVisibility(e),this._heightsLayer.setVisibility(e),this._pointerLayer.setVisibility(e)}clear(){this._headPointersLayer.setEntities([]),this._groundPointersLayer.setEntities([]),this._columnPointersLayer.setEntities([]),this._heightsLayer.setEntities([]),this._trackEntity.polyline.setPath3v([])}frame(){if(this._clampToGround){let e=new m;const t=this._planet.quadTreeStrategy._renderedNodes,i=this._groundPointersLayer.getEntities();for(let s=0;s<i.length;s++){let n=i[s];for(let o=0;o<t.length;o++){let l=t[o];if(l.segment.isEntityInside(n)){l.segment.getEntityTerrainPoint(n,e),n.setCartesian3v(e),n.properties.columnEntity.ray.setStartPosition3v(e);break}}}}}get ellipsoid(){return this._planet?this._planet.ellipsoid:null}}const eh=["change","addpoint"],ih=["reset","list","location"];class sh extends dt{constructor(e={}){super({...e,template:'<div class="og-elevationprofile-buttons"></div>'}),this.events=this.events.registerNames(ih),this.pointListBtn=new ct({classList:["og-elevationprofile-button"],icon:'<?xml version="1.0" encoding="utf-8"?><svg width="800px" height="800px" viewBox="0 0 32 32" id="icon" xmlns="http://www.w3.org/2000/svg"><defs><style>.cls-1{fill:none;}</style></defs><title>list</title><rect x="10" y="6" width="18" height="2"/><rect x="10" y="24" width="18" height="2"/><rect x="10" y="15" width="18" height="2"/><rect x="4" y="15" width="2" height="2"/><rect x="4" y="6" width="2" height="2"/><rect x="4" y="24" width="2" height="2"/></svg>',title:"Point List"}),this.pointListBtn.events.on("change",t=>{this.events.dispatch(this.events.list,t)})}render(e){super.render(e);let t=new he({classList:["og-elevationprofile-button"],icon:`<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<svg width="30" height="30" viewBox="0 0 30 30" version="1.1">
  <g transform="translate(0,-289.0625)">
    <path d="M 15 6 C 10.041282 6 6 10.04128 6 15 C 6 19.95872 10.041282 24 15 24 C 16.586491 24 18.07668 23.58246 19.373047 22.857422 L 17.888672 21.375 C 17.00816 21.772814 16.032235 22 15 22 C 11.122162 22 8 18.87784 8 15 C 8 11.12216 11.122162 8 15 8 C 18.877838 8 22 11.12216 22 15 L 19 15 L 23 20 L 27 15 L 24 15 C 24 10.04128 19.958718 6 15 6 z " transform="translate(0,289.0625)" />
  </g>
</svg>`,title:"Reset"});t.appendTo(this.el),t.events.on("click",()=>{this.model.clear(),this.events.dispatch(this.events.reset,this)}),this.pointListBtn.appendTo(this.el);let i=new he({classList:["og-elevationprofile-button","og-elevationprofile-button__location"],icon:`<?xml version="1.0" encoding="utf-8"?>
<!-- Svg Vector Icons : http://www.onlinewebfonts.com/icon -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 256 256" enable-background="new 0 0 256 256" xml:space="preserve">
<metadata> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata>
<g><g><path fill="#000000" d="M127,169.4c23.7,0,42.8-18.3,42.8-41s-19.2-41-42.8-41c-23.7,0-42.8,18.4-42.8,41S103.4,169.4,127,169.4z"/><path fill="#000000" d="M221.7,120.2c-3.8-44-40.9-78.9-87-82V15h-16.3v23.6c-44.8,4-80.3,38.5-84.1,81.7H10v15.6h24.3c3.8,43.1,39.3,77.4,84.1,81.7V241h16.3v-23.2c46-3.1,83.2-37.9,87-82H246v-15.6H221.7L221.7,120.2L221.7,120.2z M128,201.6c-42.5,0-76.7-33-76.7-73.4c0-40.4,34.5-73.4,76.7-73.4c42.5,0,76.7,33,76.7,73.4C204.7,168.5,170.5,201.6,128,201.6L128,201.6z"/></g></g>
</svg>`,title:"View bounds"});return i.appendTo(this.el),i.events.on("click",()=>{this.events.dispatch(this.events.location,this)}),this}}class rh extends Zt{constructor(e){super({title:"Points List",visible:!1,resizable:!0,useHide:!0,top:150,left:200,width:400,height:300,minHeight:100,minWidth:100,...e}),this._onApplyClick=()=>{try{this.model.clear();let t=JSON.parse(this.$textarea.value),i=new Array(t.length);for(let s=0;s<t.length;s++){let n=t[s];i[s]=new A(n[0],n[1],n[2])}this.model.addPointLonLatArrayAsync(i)}catch(t){console.error(t)}},this.$textarea=null}render(e){super.render(e);let t=new dt({template:`<div class="og-elevationprofile-list">
        <textarea placeholder="[[lon, lat, height], [lon, lat, height], ..., [lon, lat, height]]"></textarea>
        <div class="og-elevationprofile-list-buttons"></div>
    </div>`});t.appendTo(this.container);let i=new he({classList:["og-elevationprofile-list-apply"],icon:"Apply"});return i.appendTo(t.select(".og-elevationprofile-list-buttons")),i.events.on("click",this._onApplyClick),this.$textarea=t.select("textarea"),this}}class nh extends dt{constructor(e={}){super({...e,template:`<div class="og-elevationprofile-legend">
        <div class="og-elevationprofile-legend__row og-elevationprofile-legend__track">
          <div class="og-elevationprofile-square"></div>
          <div class="og-elevationprofile-value">0</div>
          <div class="og-elevationprofile-units">m</div>
        </div>
        <div class="og-elevationprofile-legend__row og-elevationprofile-legend__ground">
          <div class="og-elevationprofile-square"></div>
          <div class="og-elevationprofile-value">0</div>
          <div class="og-elevationprofile-units">m</div>
        </div>
        <div class="og-elevationprofile-legend__row og-elevationprofile-legend__warning">        
          <div class="og-elevationprofile-square"></div>
          <div class="og-elevationprofile-value">0</div>
          <div class="og-elevationprofile-units">m</div>
        </div>
        <div class="og-elevationprofile-legend__row og-elevationprofile-legend__collision">
          <div class="og-elevationprofile-square"></div>
          <div class="og-elevationprofile-value">0</div>
          <div class="og-elevationprofile-units">m</div>
        </div>
      </div>`}),this.$groundValue=null,this.$trackValue=null,this.$warningValue=null,this.$collisionValue=null,this.$trackUnits=null,this.$groundUnits=null,this.$warningUnits=null,this.$collisionUnits=null}render(e){return super.render(e),this.$trackValue=this.select(".og-elevationprofile-legend__track .og-elevationprofile-value"),this.$groundValue=this.select(".og-elevationprofile-legend__ground .og-elevationprofile-value"),this.$warningValue=this.select(".og-elevationprofile-legend__warning .og-elevationprofile-value"),this.$collisionValue=this.select(".og-elevationprofile-legend__collision .og-elevationprofile-value"),this.$trackUnits=this.select(".og-elevationprofile-legend__track .og-elevationprofile-units"),this.$groundUnits=this.select(".og-elevationprofile-legend__ground .og-elevationprofile-units"),this.$warningUnits=this.select(".og-elevationprofile-legend__warning .og-elevationprofile-units"),this.$collisionUnits=this.select(".og-elevationprofile-legend__collision .og-elevationprofile-units"),this}clear(){this.$trackValue&&(this.$trackValue.innerText="0"),this.$trackUnits&&(this.$trackUnits.innerText="m"),this.$groundValue&&(this.$groundValue.innerText="0"),this.$groundUnits&&(this.$groundUnits.innerText="m"),this.$warningValue&&(this.$warningValue.innerText="0"),this.$warningUnits&&(this.$warningUnits.innerText="m"),this.$collisionValue&&(this.$collisionValue.innerText="0"),this.$collisionUnits&&(this.$collisionUnits.innerText="m")}setTrackLength(e){let t=Ue(e);this.$trackValue.innerText=t[0],this.$trackUnits.innerText=t[1]}setGroundLength(e){let t=Ue(e);this.$groundValue.innerText=t[0],this.$groundUnits.innerText=t[1]}setWarningLength(e){let t=Ue(e);this.$warningValue.innerText=t[0],this.$warningUnits.innerText=t[1]}setCollisionLength(e){let t=Ue(e);this.$collisionValue.innerText=t[0],this.$collisionUnits.innerText=t[1]}}const $e="rgb(253,77,77)",sn="rgb(248,115,115)",os="rgb(73,73,239)",rn="rgb(90,90,253)",as="rgb(26,122,26)",nn="rgb(55,191,55)",qn="rgba(255,255,255,0.8)",Yi=.1,ma=new m(Yi,Yi,Yi),va=.17,Yn=.0095,oh=W.createCylinder(Yn,Yn,.83).scale(ma),ah=W.createCylinder(0,.04,va,16,16,!1,!0,0,-.17).scale(ma);class Zs extends U{constructor(e={}){super({independentPicking:!0,yaw:e.yaw||0,pitch:e.pitch||0,roll:e.roll||0,forceGlobalPosition:!0,geoObject:{color:e.color||$e,scale:1,tag:"line",object3d:oh},properties:e.properties}),this._size=e.size!=null?e.size:1,this.appendChild(new U({yaw:e.yaw||0,pitch:e.pitch||0,roll:e.roll||0,forceGlobalPosition:!0,geoObject:{color:e.color||$e,scale:1,tag:"tip",object3d:ah},properties:e.properties}))}setSize(e){this._size=e;const t=new m(1,(this._size-va)/.83,1),i=new m(0,this._size*Yi,0);let s=this.childEntities[0];this.setScale3v(t),s.geoObject.setTranslate3v(i)}setColorHTML(e){let t=this.childEntities[0];this.geoObject.setColorHTML(e),t.geoObject.setColorHTML(e)}}class lh extends U{constructor(e={}){super(e),this._size=e.size!=null?e.size:1,this.childEntities=[],this._init()}_init(){let e=new Zs({color:$e,yaw:0,pitch:0,roll:90*G,properties:{opName:"move_x",noEdit:!0,style:{color:$e,selectColor:sn}}}),t=new Zs({color:os,yaw:0,pitch:0,roll:0,properties:{opName:"move_y",noEdit:!0,style:{color:os,selectColor:rn}}}),i=new Zs({color:as,yaw:0,pitch:90*G,roll:0,properties:{opName:"move_z",noEdit:!0,style:{color:as,selectColor:nn}}});this.appendChild(e),this.appendChild(t),this.appendChild(i),this.setSize(this._size)}setSize(e){this.childEntities[0].setSize(e),this.childEntities[1].setSize(e),this.childEntities[2].setSize(e)}setPitch(e){let t=this.childEntities[0],i=t.childEntities[0];t.setPitch(e),i.setPitch(e),t=this.childEntities[1],i=t.childEntities[0],t.setPitch(e),i.setPitch(e),t=this.childEntities[2],i=t.childEntities[0],t.setPitch(e+90),i.setPitch(e+90)}setYaw(e){let t=this.childEntities[0],i=t.childEntities[0];t.setYaw(e),i.setYaw(e),t=this.childEntities[1],i=t.childEntities[0],t.setYaw(e),i.setYaw(e),t=this.childEntities[2],i=t.childEntities[0],t.setYaw(e),i.setYaw(e)}setRoll(e){let t=this.childEntities[0],i=t.childEntities[0];t.setRoll(e+90),i.setRoll(e+90),t=this.childEntities[1],i=t.childEntities[0],t.setRoll(e),i.setRoll(e)}getY(){return this.childEntities[1].getAbsoluteRotation().mulVec3(m.UP).normalize()}}const hh=W.createPlane(1,1,-.5,0,.5);class ch extends U{constructor(e={}){super(e),this._init()}_init(){let e=new U({independentPicking:!0,scale:.025,forceGlobalPosition:!0,geoObject:{color:qn,tag:"plane",object3d:hh},properties:{opName:"move_xz",noEdit:!0,style:{color:qn,selectColor:"rgba(255,255,255,1.0)"}}});this.appendChild(e)}}const Ai=360,Ks=.95,Wn=new Array(Ai),$n=new Array(Ai),Xn=new Array(Ai);class dh extends U{constructor(e={}){super(e),this._init()}_init(){const e=Ai;let t=new U({independentPicking:!0,polyline:{path3v:[Array.from({length:e},(n,o)=>new m)],thickness:3.1,color:$e,isClosed:!0},properties:{opName:"rotate_pitch",noEdit:!0,style:{color:$e,selectColor:sn}}}),i=new U({independentPicking:!0,polyline:{path3v:[Array.from({length:e},(n,o)=>new m)],thickness:2.5,color:os,isClosed:!0},properties:{opName:"rotate_yaw",noEdit:!0,style:{color:os,selectColor:rn}}}),s=new U({independentPicking:!0,polyline:{path3v:[Array.from({length:e},(n,o)=>new m)],thickness:2.5,color:as,isClosed:!0},properties:{opName:"rotate_roll",noEdit:!0,style:{color:as,selectColor:nn}}});this.appendChild(t),this.appendChild(i),this.appendChild(s)}setCartesian3v(e,t=0){if(super.setCartesian3v(e),this._entityCollection&&this._entityCollection.renderNode){let i=this._entityCollection.renderNode,s=i.renderer.activeCamera,n=i.getFrameRotation(e).conjugate(),o=.15*s.eye.distance(e),l=D.xRotation(0),h=D.yRotation(t),c=D.zRotation(0).mul(l).mul(h).mul(i.getFrameRotation(e)).conjugate();for(let _=0,g=0,v=1;_<Ai;_+=v,g++){let p=_*G,y=Math.cos(p),b=Math.sin(p),C=c.mulVec3(new m(0,b,y)).normalize().scale(o).add(e),T=n.mulVec3(new m(y,0,b)).normalize().scale(o).add(e),w=c.mulVec3(new m(y,b,0)).normalize().scale(o).add(e);Wn[g]=C,$n[g]=T,Xn[g]=w}this.childEntities[0].polyline.setPath3v([Wn],void 0,!0),this.childEntities[1].polyline.setPath3v([$n],void 0,!0),this.childEntities[2].polyline.setPath3v([Xn],void 0,!0);let d=c.mulVec3(new m(1,0,0)).normalize(),u=n.mulVec3(new m(0,1,0)).normalize(),f=c.mulVec3(new m(0,0,1)).normalize();this.childEntities[0].polyline.setVisibleSphere(e,Math.abs(d.dot(s.getForward()))>Ks?0:o),this.childEntities[1].polyline.setVisibleSphere(e,Math.abs(u.dot(s.getForward()))>Ks?0:o),this.childEntities[2].polyline.setVisibleSphere(e,Math.abs(f.dot(s.getForward()))>Ks?0:o)}}}class uh extends U{constructor(e={}){super({...e,forceGlobalPosition:!0}),this._init()}_init(){let e=[],t=[],i=[],s=me(sn),n=me(rn),o=me(nn);for(let d=0;d<20;d++){let u=1;if(d<5){let f=d/5;u=.5*(1-Math.cos(Math.PI*f))}else if(d>15){let f=(d-15)/5;u=1-.5*(1-Math.cos(Math.PI*f))}t.push([o[0],o[1],o[2],u]),e.push([s[0],s[1],s[2],u]),i.push([n[0],n[1],n[2],u])}let l=new U({polyline:{path3v:[Array.from({length:20},(d,u)=>new m)],thickness:2.5,pathColors:[e],isClosed:!1}}),h=new U({polyline:{path3v:[Array.from({length:20},(d,u)=>new m)],thickness:2.5,pathColors:[i],isClosed:!1}}),c=new U({polyline:{path3v:[Array.from({length:20},(d,u)=>new m)],thickness:2.5,pathColors:[t],isClosed:!1}});this.appendChild(l),this.appendChild(h),this.appendChild(c)}setCartesian3v(e){if(super.setCartesian3v(e),this._entityCollection&&this._entityCollection.renderNode){let t=this._entityCollection.renderNode,i=.05*t.renderer.activeCamera.eye.distance(e);if(t.planet){let s=[],n=[],o=[],l=t.planet.ellipsoid.getSurfaceNormal3v(e),h=this._lonLat,c=10;for(let d=-10;d<c;d++)o.push(new A(h.lon,h.lat+d,h.height)),n.push(new A(h.lon+d,h.lat,h.height)),s.push(e.add(l.scaleTo(d*i)));this.childEntities[0].polyline.setPathLonLatFast([n]),this.childEntities[1].polyline.setPath3vFast([s]),this.childEntities[2].polyline.setPathLonLatFast([o])}else{let s=[],n=[],o=[],l=m.UNIT_Y,h=m.UNIT_X,c=m.UNIT_Z,d=10;for(let u=-10;u<d;u++)n.push(e.add(h.scaleTo(u*i))),o.push(e.add(l.scaleTo(u*i))),s.push(e.add(c.scaleTo(u*i)));this.childEntities[0].polyline.setPath3vFast([n]),this.childEntities[1].polyline.setPath3vFast([o]),this.childEntities[2].polyline.setPath3vFast([s])}}}}function Zn(a,e,t,i,s,n){let o=s.add(m.UP),l=s.add(a),h=new m;if(new H(e,t).hitPlaneRes(mt.fromPoints(s,o,l),h)===H.INSIDE){let c=m.proj_b_to_a(h,a);if(new H(e,i).hitPlaneRes(mt.fromPoints(s,o,l),h)===H.INSIDE){let d=m.proj_b_to_a(h,a).sub(c);n.copy(s.add(d))}}}class _h extends ce{constructor(e={}){super(e.name||"GeoObjectEditorScene"),this._onAxisLayerMouseEnter=t=>{this.renderer.handler.canvas.style.cursor="pointer",t.pickingObject.setColorHTML(t.pickingObject.properties.style.selectColor)},this._onAxisLayerMouseLeave=t=>{this.renderer.handler.canvas.style.cursor="default",t.pickingObject.setColorHTML(t.pickingObject.properties.style.color)},this._onAxisLayerLUp=t=>{this._selectedMove=null,this._navActivate(),this._setAxisTrackVisibility(!1)},this._onAxisLayerLDown=t=>{this._clickPos=t.pos.clone(),this._selectedEntity&&(this._selectedEntityCart=this._selectedEntity.getAbsoluteCartesian(),this._setAxisTrackVisibility(!0)),this._selectedMove=t.pickingObject.properties.opName,this._navDeactivate()},this._onPlaneLayerMouseEnter=t=>{this.renderer.handler.canvas.style.cursor="pointer",t.pickingObject.geoObject.setColorHTML(t.pickingObject.properties.style.selectColor)},this._onPlaneLayerMouseLeave=t=>{this.renderer.handler.canvas.style.cursor="default",t.pickingObject.geoObject.setColorHTML(t.pickingObject.properties.style.color)},this._onPlaneLayerLUp=t=>{this._selectedMove=null,this._navActivate(),this._setAxisTrackVisibility(!1)},this._onPlaneLayerLDown=t=>{this._clickPos=t.pos.clone(),this._selectedEntity&&(this._selectedEntityCart=this._selectedEntity.getAbsoluteCartesian(),this._setAxisTrackVisibility(!0)),this._selectedMove=t.pickingObject.properties.opName,this._navDeactivate()},this._onRotateLayerMouseEnter=t=>{this.renderer.handler.canvas.style.cursor="pointer",t.pickingObject.polyline.setColorHTML(t.pickingObject.properties.style.selectColor)},this._onRotateLayerMouseLeave=t=>{this.renderer.handler.canvas.style.cursor="default",t.pickingObject.polyline.setColorHTML(t.pickingObject.properties.style.color)},this._onRotateLayerLUp=t=>{this._selectedMove=null,this._navActivate()},this._onRotateLayerLDown=t=>{this._clickPos=t.pos.clone(),this._selectedEntity&&(this._selectedEntityCart=this._selectedEntity.getAbsoluteCartesian(),this._selectedEntity&&(this._selectedEntityPitch=this._selectedEntity.getAbsolutePitch(),this._selectedEntityYaw=this._selectedEntity.getAbsoluteYaw(),this._selectedEntityRoll=this._selectedEntity.getAbsoluteRoll())),this._selectedMove=t.pickingObject.properties.opName,this._navDeactivate()},this._onMouseMove=t=>{this._selectedEntity&&this._selectedMove&&this._ops[this._selectedMove]&&this._ops[this._selectedMove](t)},this._onLclick=t=>{t.pickingObject&&t.pickingObject instanceof U&&this.select(t.pickingObject)},this._moveX=t=>{if(!this._selectedEntity)return;let i=this.renderer.activeCamera,s=this._selectedEntityCart,n=i.unproject(this._clickPos.x,this._clickPos.y),o=new m;if(this.planet){let l=new H(i.eye,n).hitSphere(new Dt(s.length(),new m)),h=new H(i.eye,t.direction).hitSphere(new Dt(s.length(),new m));if(!h)return;if(o=D.getRotationBetweenVectors(l.normal(),h.normal()).mulVec3(s),this.ellipsoid){let c=this.ellipsoid.cartesianToLonLat(s),d=this.ellipsoid.cartesianToLonLat(o);this.ellipsoid.lonLatToCartesianRes(new A(d.lon,c.lat,c.height),o)}}else Zn(m.UNIT_X,i.eye,n,t.direction,s,o);this._selectedEntity.setAbsoluteCartesian3v(o),this.events.dispatch(this.events.position,o,this._selectedEntity),this.events.dispatch(this.events.change,this._selectedEntity)},this._moveY=t=>{if(!this._selectedEntity)return;let i=this.renderer.activeCamera,s=this._selectedEntityCart,n=m.UP;this.planet&&(n=this._axisEntity.getY());let o=s.add(n),l=s.add(i.getRight()),h=new m,c=i.unproject(this._clickPos.x,this._clickPos.y);if(new H(i.eye,c).hitPlaneRes(mt.fromPoints(s,o,l),h)===H.INSIDE){let d=m.proj_b_to_a(h,n);if(new H(i.eye,t.direction).hitPlaneRes(mt.fromPoints(s,o,l),h)===H.INSIDE){let u=m.proj_b_to_a(h,n).sub(d),f=this._selectedEntityCart.add(u);this._selectedEntity.setAbsoluteCartesian3v(f),this.events.dispatch(this.events.position,h,this._selectedEntity),this.events.dispatch(this.events.change,this._selectedEntity)}}},this._moveZ=t=>{if(!this._selectedEntity)return;let i=this.renderer.activeCamera,s=this._selectedEntityCart,n=i.unproject(this._clickPos.x,this._clickPos.y),o=new m;if(this.planet){let l=new H(i.eye,n).hitSphere(new Dt(s.length(),new m)),h=new H(i.eye,t.direction).hitSphere(new Dt(s.length(),new m));if(!h)return;if(o=D.getRotationBetweenVectors(l.normal(),h.normal()).mulVec3(s),this.ellipsoid){let c=this.ellipsoid.cartesianToLonLat(s),d=this.ellipsoid.cartesianToLonLat(o);this.ellipsoid.lonLatToCartesianRes(new A(c.lon,d.lat,c.height),o)}}else Zn(m.UNIT_Z,i.eye,n,t.direction,s,o);this._selectedEntity.setAbsoluteCartesian3v(o),this.events.dispatch(this.events.position,o,this._selectedEntity),this.events.dispatch(this.events.change,this._selectedEntity)},this._moveXZ=t=>{if(!this._selectedEntity)return;let i=this.renderer.activeCamera,s=this._selectedEntityCart,n=i.unproject(this._clickPos.x,this._clickPos.y),o=new m;if(this.planet){let l=new H(i.eye,n).hitSphere(new Dt(s.length(),new m)),h=new H(i.eye,t.direction).hitSphere(new Dt(s.length(),new m));if(!h)return;if(o=D.getRotationBetweenVectors(l.normal(),h.normal()).mulVec3(s),this.ellipsoid){let c=this.ellipsoid.cartesianToLonLat(o),d=this._selectedEntity.getLonLat().height;this.ellipsoid.lonLatToCartesianRes(new A(c.lon,c.lat,d),o)}}else{let l=s.add(m.UNIT_X),h=s.add(m.UNIT_Z),c=new m,d=new m;if(new H(i.eye,n).hitPlaneRes(mt.fromPoints(s,l,h),c)===H.INSIDE&&new H(i.eye,t.direction).hitPlaneRes(mt.fromPoints(s,l,h),d)===H.INSIDE){let u=d.sub(c);o=s.add(u)}}this._selectedEntity.setAbsoluteCartesian3v(o),this.events.dispatch(this.events.position,o,this._selectedEntity),this.events.dispatch(this.events.change,this._selectedEntity)},this._moveXY=t=>{console.log("moveXY")},this._moveZY=t=>{console.log("moveZY")},this._rotatePitch=t=>{if(!this._selectedEntity)return;let i=this.renderer.activeCamera,s=this._selectedEntityCart,n=D.xRotation(0),o=D.yRotation(this._selectedEntity.getYaw()),l=D.zRotation(0).mul(n).mul(o).mul(this.getFrameRotation(s)).conjugate().mulVec3(new m(1,0,0)).normalize(),h=i.unproject(this._clickPos.x,this._clickPos.y),c=new mt(s,l),d=new m,u=new m;if(new H(i.eye,h).hitPlaneRes(c,d)===H.INSIDE&&new H(i.eye,t.direction).hitPlaneRes(c,u)===H.INSIDE){let f=d.sub(s).normalize(),_=u.sub(s).normalize(),g=Math.sign(f.cross(_).dot(l)),v=Math.acos(f.dot(_)),p=this._selectedEntityPitch+g*v;this._selectedEntity.setAbsolutePitch(p),this.events.dispatch(this.events.pitch,p,this._selectedEntity),this.events.dispatch(this.events.change,this._selectedEntity)}},this._rotateYaw=t=>{if(!this._selectedEntity)return;let i=this.renderer.activeCamera,s=this._selectedEntityCart,n=this.getFrameRotation(s).conjugate().mulVec3(new m(0,1,0)).normalize(),o=i.unproject(this._clickPos.x,this._clickPos.y),l=new mt(s,n),h=new m,c=new m;if(new H(i.eye,o).hitPlaneRes(l,h)===H.INSIDE&&new H(i.eye,t.direction).hitPlaneRes(l,c)===H.INSIDE){let d=h.sub(s).normalize(),u=c.sub(s).normalize(),f=Math.sign(u.cross(d).dot(n)),_=Math.acos(d.dot(u)),g=this._selectedEntityYaw+f*_;this._selectedEntity.setAbsoluteYaw(g),this.events.dispatch(this.events.yaw,g,this._selectedEntity),this.events.dispatch(this.events.change,this._selectedEntity)}},this._rotateRoll=t=>{if(!this._selectedEntity)return;let i=this.renderer.activeCamera,s=this._selectedEntityCart;this.getFrameRotation(s).conjugate();let n=D.xRotation(0),o=D.yRotation(this._selectedEntity.getYaw()),l=D.zRotation(0).mul(n).mul(o).mul(this.getFrameRotation(s)).conjugate().mulVec3(new m(0,0,1)).normalize(),h=i.unproject(this._clickPos.x,this._clickPos.y),c=new mt(s,l),d=new m,u=new m;if(new H(i.eye,h).hitPlaneRes(c,d)===H.INSIDE&&new H(i.eye,t.direction).hitPlaneRes(c,u)===H.INSIDE){let f=d.sub(s).normalize(),_=u.sub(s).normalize(),g=Math.sign(f.cross(_).dot(l)),v=Math.acos(f.dot(_)),p=this._selectedEntityRoll+g*v;this._selectedEntity.setAbsoluteRoll(p),this.events.dispatch(this.events.roll,p,this._selectedEntity),this.events.dispatch(this.events.change,this._selectedEntity)}},this._scale=t=>{this.events.dispatch(this.events.scale,1,this._selectedEntity),this.events.dispatch(this.events.change,this._selectedEntity)},this._scaleX=t=>{},this._scaleY=t=>{},this._scaleZ=t=>{},this.events=at(fh),this._planet=e.planet||null,this._startPos=null,this._startClick=new N,this._axisEntity=new lh,this._planeEntity=new ch,this._rotateEntity=new dh,this._axisTrackEntity=new uh,this._moveLayer=new ie({scaleByDistance:[.1,Ee,.1],useLighting:!1,pickingScale:[5,1.1,5],visibility:!1,depthOrder:1e3}),this._planeLayer=new ie({scaleByDistance:[.1,Ee,.1],useLighting:!1,visibility:!1,depthOrder:1e3}),this._rotateLayer=new ie({useLighting:!1,visibility:!1,depthOrder:1e3,pickingScale:5}),this._selectedEntity=null,this._clickPos=new N,this._selectedEntityCart=new m,this._selectedEntityPitch=0,this._selectedEntityYaw=0,this._selectedEntityRoll=0,this._selectedMove=null,this._axisTrackVisibility=!1,this._axisTrackLayer=new ie({useLighting:!1,visibility:!1,pickingScale:5,pickingEnabled:!1,opacity:.6}),this._ops={move_x:this._moveX,move_y:this._moveY,move_z:this._moveZ,move_xz:this._moveXZ,move_xy:this._moveXY,move_zy:this._moveZY,rotate_pitch:this._rotatePitch,rotate_yaw:this._rotateYaw,rotate_roll:this._rotateRoll,scale:this._scale,scale_x:this._scaleX,scale_y:this._scaleY,scale_z:this._scaleZ}}get ellipsoid(){if(this._planet)return this._planet.ellipsoid}get planet(){return this._planet}bindPlanet(e){this._planet=e}init(){this.activate()}onremove(){this.deactivate()}_addAxisLayers(){this._moveLayer.addTo(this),this._planeLayer.addTo(this),this._rotateLayer.addTo(this),this._axisTrackLayer.addTo(this),this._moveLayer.add(this._axisEntity),this._moveLayer.events.on("mouseenter",this._onAxisLayerMouseEnter),this._moveLayer.events.on("mouseleave",this._onAxisLayerMouseLeave),this._moveLayer.events.on("lup",this._onAxisLayerLUp),this._moveLayer.events.on("ldown",this._onAxisLayerLDown),this._planeLayer.add(this._planeEntity),this._planeLayer.events.on("mouseenter",this._onPlaneLayerMouseEnter),this._planeLayer.events.on("mouseleave",this._onPlaneLayerMouseLeave),this._planeLayer.events.on("lup",this._onPlaneLayerLUp),this._planeLayer.events.on("ldown",this._onPlaneLayerLDown),this._rotateLayer.add(this._rotateEntity),this._rotateLayer.events.on("mouseenter",this._onRotateLayerMouseEnter),this._rotateLayer.events.on("mouseleave",this._onRotateLayerMouseLeave),this._rotateLayer.events.on("lup",this._onRotateLayerLUp),this._rotateLayer.events.on("ldown",this._onRotateLayerLDown),this._axisTrackLayer.add(this._axisTrackEntity)}_navActivate(){this.renderer&&(this.renderer.controls.navigation&&this.renderer.controls.navigation.activate(),this.renderer.controls.SimpleNavigation&&this.renderer.controls.SimpleNavigation.activate())}_navDeactivate(){this.renderer&&(this.renderer.controls.navigation&&this.renderer.controls.navigation.deactivate(),this.renderer.controls.SimpleNavigation&&this.renderer.controls.SimpleNavigation.deactivate())}_removeAxisLayers(){this._moveLayer.remove(),this._planeLayer.remove(),this._rotateLayer.remove()}activate(){this.renderer.events.on("lclick",this._onLclick),this.renderer.events.on("mousemove",this._onMouseMove),this._addAxisLayers()}deactivate(){this.renderer.events.off("lclick",this._onLclick),this.renderer.events.off("mousemove",this._onMouseMove),this._removeAxisLayers(),this.clear()}_setAxisTrackVisibility(e){e!==this._axisTrackVisibility&&(this._axisTrackVisibility=e,this._axisTrackLayer.setVisibility(e))}setVisibility(e){this._moveLayer.setVisibility(e),this._planeLayer.setVisibility(e),this._rotateLayer.setVisibility(e),this.unlockView()}readyToEdit(e){return!e.properties||!e.properties.noEdit}select(e){(!this._selectedEntity||this._selectedEntity&&!e.isEqual(this._selectedEntity))&&this.readyToEdit(e)&&(this._selectedEntity&&this.unselect(),this._selectedEntity=e,this.renderer&&this.renderer.setRelativeCenter(),this.setVisibility(!0),this.events.dispatch(this.events.select,this._selectedEntity))}unselect(){this.setVisibility(!1);let e=this._selectedEntity;this._selectedEntity=null,this.events.dispatch(this.events.unselect,e)}clear(){this.removeEntityCollection(this._moveLayer),this.removeEntityCollection(this._planeLayer),this.removeEntityCollection(this._rotateLayer)}frame(){if(this._selectedEntity){let e=this._selectedEntity.getAbsoluteCartesian();this._axisEntity.setCartesian3v(e),this._planeEntity.setCartesian3v(e),this._rotateEntity.setCartesian3v(e,this._selectedEntity.getAbsoluteYaw()),this._axisTrackEntity.setCartesian3v(e)}}getFrameRotation(e){return this._planet?this._planet.getFrameRotation(e):super.getFrameRotation(e)}getSelectedEntity(){return this._selectedEntity}lockView(){this.renderer&&this._selectedEntity&&this.renderer.controls.CameraLock.lockView(this._selectedEntity)}unlockView(){if(this.renderer&&this._selectedEntity){let e=this.renderer.controls.CameraLock;e&&e.unlockView()}}}const fh=["mousemove","mouseenter","mouseleave","lclick","rclick","mclick","ldblclick","rdblclick","mdblclick","lup","rup","mup","ldown","rdown","mdown","lhold","rhold","mhold","mousewheel","touchmove","touchstart","touchend","doubletouch","touchleave","touchenter","select","unselect","change","position","pitch","yaw","roll","scale"],gh=["change"];class vt extends dt{constructor(e={}){super({template:zt(`<div class="og-input">
      <div class="og-input-label">{label}</div>
      <input type="{type}"/>
    </div>`,{label:e.label||"",type:e.type||"text"})}),this._onResize=()=>{},this._onMouseWheel=t=>{(t=t||window.event).preventDefault(),t.stopPropagation()},this._onMouseWheelFF=t=>{this._onMouseWheel(t)},this._onInput=t=>{(t=t||window.event).preventDefault(),t.stopPropagation(),this._setValue(t.target.value)},this.events=this.events.registerNames(gh),this._value=e.value||"",this._maxFixed=e.maxFixed!=null?e.maxFixed:-1,this.$label=null,this.$input=null}render(e){return super.render(e),this.$label=this.select(".og-input-label"),this.$label.innerHTML===""&&(this.$label.style.display="none"),this.$input=this.select("input"),this._initEvents(),this}set value(e){e!==this._value&&(this._value=typeof e=="number"?dr(e,this._maxFixed):e,this.$input&&(this.$input.value=this._value),this.events.dispatch(this.events.change,this._value,this))}_setValue(e){e!==this._value&&(this._value=typeof e=="number"?dr(e,this._maxFixed):e,this.events.dispatch(this.events.change,this._value,this))}get value(){return this._value}_initEvents(){this.el.addEventListener("mousewheel",this._onMouseWheel),this.el.addEventListener("wheel",this._onMouseWheelFF),this.$input.addEventListener("input",this._onInput)}_clearEvents(){this.el.removeEventListener("mousewheel",this._onMouseWheel),this.el.removeEventListener("wheel",this._onMouseWheelFF),this.$input.removeEventListener("input",this._onInput)}remove(){this._clearEvents(),super.remove()}set visibility(e){this.el&&(this.el.style.display=e?"":"none")}}const ph=["change"];class mh extends dt{constructor(e={}){super({template:zt(`<div class="og-checkbox">
      <div class="og-input-label">{label}</div>
      <div class="og-checkbox-input">
        <input type="checkbox" {checked}/>
      </div>
    </div>`,{label:e.label||"",checked:e.checked?"checked":""})}),this._onResize=()=>{},this._onMouseWheel=t=>{(t=t||window.event).preventDefault(),t.stopPropagation()},this._onMouseWheelFF=t=>{this._onMouseWheel(t)},this._onClick=t=>{(t=t||window.event).stopPropagation(),this.checked=!this._checked},this._checked=e.checked||!1,this._disabled=e.disabled||!1,this.events=this.events.registerNames(ph),this.$label=null,this.$input=null}set disabled(e){this._disabled=e,this._updateDisabled()}_updateDisabled(){this.el&&(this._disabled?this.el.classList.add("og-input-disabled"):this.el.classList.remove("og-input-disabled"))}get disabled(){return this._disabled}render(e){return super.render(e),this.$label=this.select(".og-input-label"),this.$label.innerHTML===""&&(this.$label.style.display="none"),this.$input=this.select("input"),this.$input.checked=this._checked,this._updateDisabled(),this._initEvents(),this}set checked(e){e!==this._checked&&(this._checked=e,this.$input&&(this.$input.checked=this._checked),this.events.dispatch(this.events.change,this._checked,this))}get checked(){return this._checked}_initEvents(){this.el.addEventListener("mousewheel",this._onMouseWheel),this.el.addEventListener("wheel",this._onMouseWheelFF),this.$input.addEventListener("click",this._onClick)}_clearEvents(){this.el.removeEventListener("mousewheel",this._onMouseWheel),this.el.removeEventListener("wheel",this._onMouseWheelFF),this.$input.removeEventListener("click",this._onClick)}remove(){this._clearEvents(),super.remove()}set visibility(e){this.el&&(this.el.style.display=e?"":"none")}}class vh extends Zt{constructor(e){super({title:"GeoObject Properties",visible:!1,resizable:!0,useHide:!0,top:25,right:85,width:252,height:480,minHeight:100,minWidth:100,model:e.model}),this._onVisibility=t=>{this.model.setVisibility(t)},this._onSelect=t=>{this.show(),this._refresh(t)},this._onUnselect=t=>{this.hide()},this._onChangeRelativePosition=t=>{let i=this.model.getSelectedEntity();i&&(i.relativePosition=t,this._refresh(i))},this._onPosition=(t,i)=>{this._refresh(i)},this._onPitch=(t,i)=>{this._pitchView.stopPropagation(),this._pitchView.value=i.getPitch()*Q,this._absolutePitchView.stopPropagation(),this._absolutePitchView.value=i.getAbsolutePitch()*Q},this._onYaw=(t,i)=>{this._yawView.stopPropagation(),this._yawView.value=i.getYaw()*Q,this._absoluteYawView.stopPropagation(),this._absoluteYawView.value=i.getAbsoluteYaw()*Q},this._onRoll=(t,i)=>{this._rollView.stopPropagation(),this._rollView.value=i.getRoll()*Q,this._absoluteRollView.stopPropagation(),this._absoluteRollView.value=i.getAbsoluteRoll()*Q},this._onChangeLon=t=>{let i=this.model.getSelectedEntity();if(i){let s=i.getLonLat();i.setLonLat2(parseFloat(t),s.lat,s.height),this._refresh(i)}},this._onChangeLat=t=>{let i=this.model.getSelectedEntity();if(i){let s=i.getLonLat();i.setLonLat2(s.lon,parseFloat(t),s.height),this._refresh(i)}},this._onChangeHeight=t=>{let i=this.model.getSelectedEntity();if(i){let s=i.getLonLat();i.setLonLat2(s.lon,s.lat,parseFloat(t)),this._refresh(i)}},this._onChangeX=t=>{let i=this.model.getSelectedEntity();if(i){let s=i.getCartesian();i.setCartesian(parseFloat(t),s.y,s.z),this._refresh(i)}},this._onChangeY=t=>{let i=this.model.getSelectedEntity();if(i){let s=i.getCartesian();i.setCartesian(s.x,parseFloat(t),s.z),this._refresh(i)}},this._onChangeZ=t=>{let i=this.model.getSelectedEntity();if(i){let s=i.getCartesian();i.setCartesian(s.x,s.y,parseFloat(t)),this._refresh(i)}},this._onChangeAbsoluteX=t=>{let i=this.model.getSelectedEntity();if(i){let s=i.getAbsoluteCartesian();i.setAbsoluteCartesian(parseFloat(t),s.y,s.z),this._refresh(i)}},this._onChangeAbsoluteY=t=>{let i=this.model.getSelectedEntity();if(i){let s=i.getAbsoluteCartesian();i.setAbsoluteCartesian(s.x,parseFloat(t),s.z),this._refresh(i)}},this._onChangeAbsoluteZ=t=>{let i=this.model.getSelectedEntity();if(i){let s=i.getAbsoluteCartesian();i.setAbsoluteCartesian(s.x,s.y,parseFloat(t)),this._refresh(i)}},this._onChangePitch=t=>{let i=this.model.getSelectedEntity();i&&(i.setPitch(parseFloat(t)*G),this._refresh(i))},this._onChangeYaw=t=>{let i=this.model.getSelectedEntity();i&&(i.setYaw(parseFloat(t)*G),this._refresh(i))},this._onChangeRoll=t=>{let i=this.model.getSelectedEntity();i&&(i.setRoll(parseFloat(t)*G),this._refresh(i))},this._onChangeAbsolutePitch=t=>{let i=this.model.getSelectedEntity();i&&(i.setAbsolutePitch(parseFloat(t)*G),this._refresh(i))},this._onChangeAbsoluteYaw=t=>{let i=this.model.getSelectedEntity();i&&(i.setAbsoluteYaw(parseFloat(t)*G),this._refresh(i))},this._onChangeAbsoluteRoll=t=>{let i=this.model.getSelectedEntity();i&&(i.setAbsoluteRoll(parseFloat(t)*G),this._refresh(i))},this._onChangeScale=t=>{let i=this.model.getSelectedEntity();if(i){let s=parseFloat(t);i.setScale(s),this._scaleXView.stopPropagation(),this._scaleYView.stopPropagation(),this._scaleZView.stopPropagation(),this._scaleXView.value=s,this._scaleYView.value=s,this._scaleZView.value=s}},this._onChangeScaleX=t=>{let i=this.model.getSelectedEntity();if(i){let s=i.getScale();i.setScale3v(new m(parseFloat(t),s.y,s.z))}},this._onChangeScaleY=t=>{let i=this.model.getSelectedEntity();if(i){let s=i.getScale();i.setScale3v(new m(s.x,parseFloat(t),s.z))}},this._onChangeScaleZ=t=>{let i=this.model.getSelectedEntity();if(i){let s=i.getScale();i.setScale3v(new m(s.x,s.y,parseFloat(t)))}},this._onGround=()=>{let t=this.model.getSelectedEntity();t&&this.model.planet&&(this.model.planet.terrain?this.model.planet.terrain.getHeightAsync(t.getLonLat(),i=>{this._heightView.value=i}):this._heightView.value=0)},this._relativePositionView=new mh({label:"Relative position"}),this._lonView=new vt({label:"Lon",type:"number",min:-180,max:180,maxFixed:10}),this._latView=new vt({label:"Lat",type:"number",min:-90,max:90,maxFixed:10}),this._heightView=new vt({label:"Height",type:"number",maxFixed:4}),this._xView=new vt({label:"X",type:"number",maxFixed:10}),this._yView=new vt({label:"Y",type:"number"}),this._zView=new vt({label:"Z",type:"number"}),this._absXView=new vt({label:"Absolute X",type:"number",maxFixed:10}),this._absYView=new vt({label:"Absolute Y",type:"number"}),this._absZView=new vt({label:"Absolute Z",type:"number"}),this._pitchView=new vt({label:"Pitch",type:"number",maxFixed:2}),this._yawView=new vt({label:"Yaw",type:"number",maxFixed:2}),this._rollView=new vt({label:"Roll",type:"number",maxFixed:2}),this._absolutePitchView=new vt({label:"Absolute pitch",type:"number",maxFixed:2}),this._absoluteYawView=new vt({label:"Absolute yaw",type:"number",maxFixed:2}),this._absoluteRollView=new vt({label:"Absolute roll",type:"number",maxFixed:2}),this._scaleView=new vt({label:"Scale",type:"number",maxFixed:2}),this._scaleXView=new vt({label:"Scale X",type:"number",maxFixed:2}),this._scaleYView=new vt({label:"Scale Y",type:"number",maxFixed:2}),this._scaleZView=new vt({label:"Scale Z",type:"number",maxFixed:2}),this._groundBtn=new he({text:"Ground",title:"Put on the ground",name:"ground",classList:["og-editor-ground_button"]})}render(e){var t;super.render(e),this._initSceneEvents();let i=document.createElement("div");i.classList.add("og-editor_toolbar"),(t=this.container)==null||t.appendChild(i);let s=new ct({classList:["og-editor_toolbar-button"],icon:`<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" id="filter-center-focus">
  <path d="M5 15H3v4c0 1.1.9 2 2 2h4v-2H5v-4zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2V5zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2zm0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2v4zM12 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
</svg>`,title:"Lock/Unlock camera view"});return s.appendTo(i),s.events.on("change",n=>{n?this.model.lockView():this.model.unlockView()}),this.events.on("visibility",n=>{n||(s.events.stopPropagation(),s.setActive(!1))}),this.events.on("visibility",this._onVisibility),this._relativePositionView.appendTo(this.container),this.model.planet&&(this._lonView.appendTo(this.container),this._latView.appendTo(this.container),this._heightView.appendTo(this.container)),this._xView.appendTo(this.container),this._yView.appendTo(this.container),this._zView.appendTo(this.container),this._absXView.appendTo(this.container),this._absYView.appendTo(this.container),this._absZView.appendTo(this.container),this._pitchView.appendTo(this.container),this._yawView.appendTo(this.container),this._rollView.appendTo(this.container),this._absolutePitchView.appendTo(this.container),this._absoluteYawView.appendTo(this.container),this._absoluteRollView.appendTo(this.container),this._scaleView.appendTo(this.container),this._scaleXView.appendTo(this.container),this._scaleYView.appendTo(this.container),this._scaleZView.appendTo(this.container),this.model.planet&&this._groundBtn.appendTo(this.container),this._relativePositionView.events.on("change",this._onChangeRelativePosition),this._lonView.events.on("change",this._onChangeLon),this._latView.events.on("change",this._onChangeLat),this._heightView.events.on("change",this._onChangeHeight),this._xView.events.on("change",this._onChangeX),this._yView.events.on("change",this._onChangeY),this._zView.events.on("change",this._onChangeZ),this._absXView.events.on("change",this._onChangeAbsoluteX),this._absYView.events.on("change",this._onChangeAbsoluteY),this._absZView.events.on("change",this._onChangeAbsoluteZ),this._pitchView.events.on("change",this._onChangePitch),this._yawView.events.on("change",this._onChangeYaw),this._rollView.events.on("change",this._onChangeRoll),this._absolutePitchView.events.on("change",this._onChangeAbsolutePitch),this._absoluteYawView.events.on("change",this._onChangeAbsoluteYaw),this._absoluteRollView.events.on("change",this._onChangeAbsoluteRoll),this._scaleView.events.on("change",this._onChangeScale),this._scaleXView.events.on("change",this._onChangeScaleX),this._scaleYView.events.on("change",this._onChangeScaleY),this._scaleZView.events.on("change",this._onChangeScaleZ),this._groundBtn.appendTo(this.container),this._groundBtn.events.on("click",this._onGround),this}remove(){super.remove(),this._clearSceneEvents()}_initSceneEvents(){this.model.events.on("select",this._onSelect),this.model.events.on("unselect",this._onUnselect),this.model.events.on("position",this._onPosition),this.model.events.on("pitch",this._onPitch),this.model.events.on("yaw",this._onYaw),this.model.events.on("roll",this._onRoll)}_clearSceneEvents(){this.model.events.off("select",this._onSelect),this.model.events.off("unselect",this._onUnselect),this.model.events.off("position",this._onPosition),this.model.events.off("pitch",this._onPitch),this.model.events.off("yaw",this._onYaw),this.model.events.off("roll",this._onRoll)}_refresh(e){e.parent?this._relativePositionView.disabled=!1:this._relativePositionView.disabled=!0,this._relativePositionView.checked=e.relativePosition;let t=e.getLonLat();this._lonView.stopPropagation(),this._latView.stopPropagation(),this._heightView.stopPropagation(),this._lonView.value=t.lon,this._latView.value=t.lat,this._heightView.value=t.height;let i=e.getCartesian();this._xView.stopPropagation(),this._yView.stopPropagation(),this._zView.stopPropagation(),this._xView.value=i.x,this._yView.value=i.y,this._zView.value=i.z,i=e.getAbsoluteCartesian(),this._absXView.stopPropagation(),this._absYView.stopPropagation(),this._absZView.stopPropagation(),this._absXView.value=i.x,this._absYView.value=i.y,this._absZView.value=i.z,this._pitchView.stopPropagation(),this._yawView.stopPropagation(),this._rollView.stopPropagation(),this._pitchView.value=e.getPitch()*Q,this._yawView.value=e.getYaw()*Q,this._rollView.value=e.getRoll()*Q,this._absolutePitchView.stopPropagation(),this._absoluteYawView.stopPropagation(),this._absoluteRollView.stopPropagation(),this._absolutePitchView.value=e.getAbsolutePitch()*Q,this._absoluteYawView.value=e.getAbsoluteYaw()*Q,this._absoluteRollView.value=e.getAbsoluteRoll()*Q,this._scaleView.stopPropagation();let s=e.getScale();s.x===s.y&&s.y===s.z?this._scaleView.value=s.x:this._scaleView.value=1,this._scaleXView.stopPropagation(),this._scaleYView.stopPropagation(),this._scaleZView.stopPropagation(),this._scaleXView.value=s.x,this._scaleYView.value=s.y,this._scaleZView.value=s.z}hide(){super.hide(),this.model.events.stopPropagation(),this.model.unselect()}}const yh=["lockview","unlockview"];class Kn extends Z{constructor(e={}){super(e),this._onLockViewDraw=()=>{this.renderer&&this._lockEntity&&(this._isFromTheBack||this.renderer.activeCamera.viewDistance(this._lockEntity.getAbsoluteCartesian(),this._lockDistance))},this._onMouseWheel=t=>{if(this.renderer&&this._lockEntity&&!this._isFromTheBack){let i=this.renderer.activeCamera.eye.distance(this._lockEntity.getAbsoluteCartesian());this._lockDistance-=.33*i*Math.sign(t.wheelDelta),this._lockDistance<.001&&(this._lockDistance=.001),this.renderer.activeCamera.viewDistance(this._lockEntity.getAbsoluteCartesian(),this._lockDistance)}},this._onMouseMove=t=>{if(this._lockEntity&&this.renderer&&(t.rightButtonDown||this.renderer.events.isKeyPressed(Y.KEY_ALT))){let i=this._lockEntity.getAbsoluteCartesian(),s=this.renderer.activeCamera,n=.5/G;n>.007&&(n=.007),this.planet?s.rotateHorizontal(n*(t.x-t.prev_x),!1,i,i.isZero()?m.UP:i.normal()):s.rotateHorizontal(n*(t.x-t.prev_x),!1,i,m.UP),s.rotateVertical(n*(t.y-t.prev_y),i),this._viewDir=i.sub(s.eye).normalize()}},this.events=at(yh),this._name="CameraLock",this.planet=e.planet||null,this._lockDistance=0,this._isFromTheBack=!1,this._lockEntity=null,this._viewDir=new m(0,0,0)}onactivate(){this.renderer}ondeactivate(){this.renderer&&this.unlockView()}oninit(){this.activate(),this.renderer}flyCartesian(e,t=120){if(!e.isZero()&&this.renderer)if(this.unlockView(),this.planet){let i=this.planet.camera;this.isVisibleDistance(e)&&i.flyDistance(e,t),i.eye.distance(e)<1e6?i.flyDistance(e,t):i.viewDistance(e,t)}else this.renderer.activeCamera.viewDistance(e,t)}lockView(e,t=!1){if(!this.renderer)return;this._lockDistance=this._getDistance(e,this._lockEntity),this._isFromTheBack=t,this._deactivateLockViewEvents(),this._lockEntity=e;let i=this.renderer.activeCamera;this.planet&&this.planet.camera.stopFlying(),i.viewDistance(e.getAbsoluteCartesian(),this._lockDistance),this._deactivateNav(),this._activateLockViewEvents(),this._viewDir=e.getAbsoluteCartesian().sub(i.eye).normalize(),this.events.dispatch(this.events.lockview,this._lockEntity,t)}_activateNav(){this.renderer&&this.renderer.controls.navigation&&this.renderer.controls.navigation.activate(),this.renderer&&this.renderer.controls.simpleNavigation&&this.renderer.controls.simpleNavigation.activate()}_deactivateNav(){this.renderer&&this.renderer.controls.navigation&&(this.renderer.controls.navigation.deactivate(),this.renderer.controls.navigation.stop()),this.renderer&&this.renderer.controls.simpleNavigation&&this.renderer.controls.simpleNavigation.deactivate()}unlockView(){this._lockEntity&&(this._deactivateLockViewEvents(),this._activateNav(),this.events.dispatch(this.events.unlockview,this._lockEntity),this._lockEntity=null)}_getCenterDist(){return this.renderer&&this.renderer.getDistanceFromPixel(this.renderer.handler.getCenter())||0}_getDistance(e,t){if(this.renderer){let i=e.getAbsoluteCartesian(),s=this.renderer.activeCamera,n=s.eye.distance(i);return t&&(n=s.eye.distance(t.getAbsoluteCartesian())),this.isVisibleDistance(i)?n:s.eye.distance(i)<1e6?this._getCenterDist():120}return 0}isVisibleDistance(e,t=0){if(this.planet){let i=this.planet.ellipsoid.equatorialSize,s=this.planet.camera.eye;return s.distance(e)<Math.sqrt(s.length2()-i*i)+t}return!0}get lockEntity(){return this._lockEntity}flyLonLat(e,t=120){if(this.planet){let i=this.planet.ellipsoid.lonLatToCartesian(e);this.flyCartesian(i,t)}}_activateLockViewEvents(){this.renderer&&(this.renderer.events.on("mousewheel",this._onMouseWheel),this.renderer.events.on("mousemove",this._onMouseMove),this.renderer.events.on("draw",this._onLockViewDraw))}_deactivateLockViewEvents(){this.renderer&&(this.renderer.events.off("mousewheel",this._onMouseWheel),this.renderer.events.off("mousemove",this._onMouseMove),this._lockEntity&&this.renderer.events.off("draw",this._onLockViewDraw))}}const xh=["click"];class bh extends dt{constructor(e){super({template:zt(`<button class="og-object3d-collection__item">
        <div class="og-object3d-collection__item_name">{name}</div>
    </button>`,{name:e.model.name}),...e}),this.events=at(xh)}render(e){var t;return super.render(e),(t=this.el)==null||t.addEventListener("click",i=>{this.events.dispatch(this.events.click,this.model,this,i)}),this}}const wh=["select"];class Th extends dt{constructor(e){super({template:'<div class="og-object3d-collection"></div>',model:e.model,...e}),this._onAdd=t=>{this._addItem(t)},this.events=at(wh),this._activeView=null}_addItem(e){let t=new bh({model:e});t.appendTo(this.el),t.events.on("click",i=>{var s,n;this._activeView&&((s=this._activeView.el)==null||s.classList.remove("active")),this._activeView=t,(n=this._activeView.el)==null||n.classList.add("active"),this.events.dispatch(this.events.select,i,t)})}render(e){super.render(e);let t=this.model.getItems();for(let i of t)this._addItem(i);return this._initEvents(),this}_initEvents(){this.model.events.on("add",this._onAdd)}}const Ch=["select"];class Eh extends Zt{constructor(e){super({classList:["og-object3d-manager"],title:"Object3D Collection",visible:!1,resizable:!0,useHide:!0,top:25,right:85,width:252,height:480,minHeight:100,minWidth:100}),this._onLoadClick=()=>{let t=new dt({initRender:!0,template:'<input type="file" accept=".obj,.mtl" multiple />'});t.el&&(t.el.addEventListener("change",i=>{const s=i.target;if(s.files){const n=Array.from(s.files),o=n.find(h=>h.name.toLowerCase().endsWith(".obj")),l=n.find(h=>h.name.toLowerCase().endsWith(".mtl"));o&&async function(h,c){return await W.readFileObj(h,c).then(d=>({name:h.name,objects:c?d:[W.merge(d)]}))}(o,l).then(this._addObject)}}),t.el.click())},this._addObject=t=>{this._object3dCollectionView.model.addItem(t)},this.events=at(Ch),this._object3dCollectionView=new Th({model:e.model})}render(e){var t;super.render(e);let i=document.createElement("div");i.classList.add("og-editor_toolbar"),(t=this.container)==null||t.appendChild(i);let s=new he({classList:["og-editor_toolbar-button"],icon:'<svg class="svg-icon" style="vertical-align: middle;fill: currentColor;overflow: hidden;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M426.666667 170.666667H170.666667c-47.146667 0-84.906667 38.186667-84.906667 85.333333L85.333333 768c0 47.146667 38.186667 85.333333 85.333334 85.333333h682.666666c47.146667 0 85.333333-38.186667 85.333334-85.333333V341.333333c0-47.146667-38.186667-85.333333-85.333334-85.333333H512l-85.333333-85.333333z"  /></svg>',title:"Load 3D object"});return s.appendTo(i),s.events.on("click",this._onLoadClick),this._object3dCollectionView.appendTo(this.container),this._object3dCollectionView.events.on("select",n=>{this.events.dispatch(this.events.select,n)}),this}}const Ah=["add","remove"];class on{constructor(e={}){this.events=at(Ah,this),this._items=on.createItemsMap(e.collection||[])}static createItemsMap(e){let t=new Map;for(let i=0;i<e.length;i++)t.set(e[i].name,e[i]);return t}getItem(e){return this._items.get(e)}addItem(e,t=!1){this._items.has(e.name)&&!t||(this._items.set(e.name,e),this.events.dispatch(this.events.add,e))}getItems(){return Array.from(this._items,([e,t])=>t)}}class zr extends Z{constructor(e={}){super({name:"CameraFrameComposer",autoActivate:!0,...e}),this._onPostdraw=()=>{for(let t=0,i=this._frameHandlers.length;t<i;t++)this._frameHandlers[t].frame()},this._cameraLayer=new ie({scaleByDistance:[100,1e6,1],pickingEnabled:!1}),this._cameraScene=new ce("CameraScene"),this._frameHandlers=e.frameHandlers||[]}get frameHandlers(){return[...this._frameHandlers]}add(e){e.addTo(this),this._cameraLayer.add(e.cameraEntity)}oninit(){super.oninit(),this._cameraLayer.addTo(this._cameraScene)}activate(){super.activate(),this.renderer&&(this.renderer.events.on("postdraw",this._onPostdraw),this.renderer.addNode(this._cameraScene))}deactivate(){super.deactivate(),this.renderer&&(this.renderer.events.off("postdraw",this._onPostdraw),this.renderer.removeNode(this._cameraScene))}}let Lh=W.createFrustum();class Qn{constructor(e){this.camera=e.camera,this.frameBuffer=e.frameBuffer,this.frameHandler=e.frameHandler||null,this._composer=null,this._composerIndex=-1,this.showFrustum=e.showFrustum==null||e.showFrustum,this.cameraEntity=new U({visibility:!0,scale:this.frustumScale,geoObject:{tag:"frustum",color:"rgba(0,255,0,0.20)",object3d:Lh}}),this.frameBuffer.init()}get frustumScale(){return W.getFrustumScaleByCameraAspectRatio(1e3,this.camera.getViewAngle(),this.camera.getAspectRatio())}addTo(e){this._composer||(this._composer=e,this._composerIndex=e.frameHandlers.length,this._composer._frameHandlers.push(this))}remove(){this._composer&&(this._composer._frameHandlers.splice(this._composerIndex,1),this._composer=null,this._composerIndex=-1)}frame(){if(this.frameHandler&&this.frameBuffer.handler.gl&&(this.frameHandler(this),this.showFrustum)){let e=this.camera,t=W.getFrustumScaleByCameraAngles(100,e.horizontalViewAngle,e.verticalViewAngle);this.cameraEntity.setScale3v(t),this.cameraEntity.setCartesian3v(e.eye),this.cameraEntity.setAbsolutePitch(e.getAbsolutePitch()),this.cameraEntity.setAbsoluteYaw(e.getAbsoluteYaw()),this.cameraEntity.setAbsoluteRoll(e.getAbsoluteRoll())}}}function Fe(a){let e=1/Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);a[0]*=e,a[1]*=e,a[2]*=e,a[3]*=e}class Jn{constructor(e={}){this._pickingColorU=new Float32Array([0,0,0]),this._f=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.projectionMatrix=new J,this.inverseProjectionMatrix=new J,this.projectionViewMatrix=new J,this.projectionViewRTEMatrix=new J,this.inverseProjectionViewMatrix=new J,this.left=0,this.right=0,this.bottom=0,this.top=0,this.near=0,this.far=0,this.cameraFrustumIndex=e.cameraFrustumIndex!=null?e.cameraFrustumIndex:-1,this.setProjectionMatrix(e.fov||30,e.aspect||1,e.near||1,e.far||1e3)}getRightPlane(){return this._f[0]}getLeftPlane(){return this._f[1]}getBottomPlane(){return this._f[2]}getTopPlane(){return this._f[3]}getBackwardPlane(){return this._f[4]}getForwardPlane(){return this._f[5]}getProjectionViewMatrix(){return this.projectionViewMatrix._m}getProjectionViewRTEMatrix(){return this.projectionViewRTEMatrix._m}getProjectionMatrix(){return this.projectionMatrix._m}getInverseProjectionMatrix(){return this.inverseProjectionMatrix._m}setProjectionMatrix(e,t,i,s,n,o=10){if(n){let l=o*Math.tan(e*Kt),h=l*t;this._setFrustumParams(l,h,i,s),this.projectionMatrix.setOrthographic(this.left,this.right,this.bottom,this.top,this.near,this.far)}else{let l=i*Math.tan(e*Kt),h=l*t;this._setFrustumParams(l,h,i,s),this.projectionMatrix.setPerspective(this.left,this.right,this.bottom,this.top,this.near,this.far)}this.projectionMatrix.inverseTo(this.inverseProjectionMatrix)}_setFrustumParams(e,t,i,s){this.top=e,this.right=t,this.bottom=-this.top,this.left=-this.right,this.near=i,this.far=s}setProjectionViewRTEMatrix(e){this.projectionViewRTEMatrix=this.projectionMatrix.mul(e)}setViewMatrix(e){this.projectionViewMatrix=this.projectionMatrix.mul(e),this.projectionViewMatrix.inverseTo(this.inverseProjectionViewMatrix);let t=this.projectionViewMatrix._m;this._f[0][0]=t[3]-t[0],this._f[0][1]=t[7]-t[4],this._f[0][2]=t[11]-t[8],this._f[0][3]=t[15]-t[12],Fe(this._f[0]),this._f[1][0]=t[3]+t[0],this._f[1][1]=t[7]+t[4],this._f[1][2]=t[11]+t[8],this._f[1][3]=t[15]+t[12],Fe(this._f[1]),this._f[2][0]=t[3]+t[1],this._f[2][1]=t[7]+t[5],this._f[2][2]=t[11]+t[9],this._f[2][3]=t[15]+t[13],Fe(this._f[2]),this._f[3][0]=t[3]-t[1],this._f[3][1]=t[7]-t[5],this._f[3][2]=t[11]-t[9],this._f[3][3]=t[15]-t[13],Fe(this._f[3]),this._f[4][0]=t[3]-t[2],this._f[4][1]=t[7]-t[6],this._f[4][2]=t[11]-t[10],this._f[4][3]=t[15]-t[14],Fe(this._f[4]),this._f[5][0]=t[3]+t[2],this._f[5][1]=t[7]+t[6],this._f[5][2]=t[11]+t[10],this._f[5][3]=t[15]+t[14],Fe(this._f[5])}containsPoint(e){for(let t=0;t<6;t++)if(e.dotArr(this._f[t])+this._f[t][3]<=0)return!1;return!0}containsSphereBottomExc(e){let t=-e.radius,i=this._f;return!(e.center.dotArr(i[0])+i[0][3]<=t||e.center.dotArr(i[1])+i[1][3]<=t||e.center.dotArr(i[3])+i[3][3]<=t||e.center.dotArr(i[4])+i[4][3]<=t||e.center.dotArr(i[5])+i[5][3]<=t)}containsSphereButtom(e){let t=-e.radius,i=this._f;return!(e.center.dotArr(i[2])+i[2][3]<=t)}containsSphere(e){let t=-e.radius,i=this._f;return!(e.center.dotArr(i[0])+i[0][3]<=t||e.center.dotArr(i[1])+i[1][3]<=t||e.center.dotArr(i[2])+i[2][3]<=t||e.center.dotArr(i[3])+i[3][3]<=t||e.center.dotArr(i[4])+i[4][3]<=t||e.center.dotArr(i[5])+i[5][3]<=t)}containsSphere2(e,t){let i=-t;return!(e.dotArr(this._f[0])+this._f[0][3]<=i||e.dotArr(this._f[1])+this._f[1][3]<=i||e.dotArr(this._f[2])+this._f[2][3]<=i||e.dotArr(this._f[3])+this._f[3][3]<=i||e.dotArr(this._f[4])+this._f[4][3]<=i||e.dotArr(this._f[5])+this._f[5][3]<=i)}containsBox(e){let t,i,s=!0;for(let n=0;n<6;n++){t=0,i=0;for(let o=0;o<8&&(i===0||t===0);o++)e.vertices[o].dotArr(this._f[n])+this._f[n][3]<0?t++:i++;if(i===0)return!1;t>0&&(s=!0)}return s}}const X=class{};X.Linear=a=>a,X.QuadIn=a=>a*a,X.QuadOut=a=>1-(1-a)*(1-a),X.QuadInOut=a=>a<.5?2*a*a:1-Math.pow(-2*a+2,2)/2,X.CubicIn=a=>a*a*a,X.CubicOut=a=>1-Math.pow(1-a,3),X.CubicInOut=a=>a<.5?4*a*a*a:1-Math.pow(-2*a+2,3)/2,X.QuartIn=a=>a*a*a*a,X.QuartOut=a=>1-Math.pow(1-a,4),X.QuartInOut=a=>a<.5?8*a*a*a*a:1-Math.pow(-2*a+2,4)/2,X.QuintIn=a=>a*a*a*a*a,X.QuintOut=a=>1-Math.pow(1-a,5),X.QuintInOut=a=>a<.5?16*a*a*a*a*a:1-Math.pow(-2*a+2,5)/2,X.SineIn=a=>1-Math.cos(a*Math.PI/2),X.SineOut=a=>Math.sin(a*Math.PI/2),X.SineInOut=a=>-(Math.cos(Math.PI*a)-1)/2,X.ExpoIn=a=>a===0?0:Math.pow(2,10*a-10),X.ExpoOut=a=>a===1?1:1-Math.pow(2,-10*a),X.ExpoInOut=a=>a===0?0:a===1?1:a<.5?Math.pow(2,20*a-10)/2:(2-Math.pow(2,-20*a+10))/2,X.CircIn=a=>1-Math.sqrt(1-Math.pow(a,2)),X.CircOut=a=>Math.sqrt(1-Math.pow(a-1,2)),X.CircInOut=a=>a<.5?(1-Math.sqrt(1-Math.pow(2*a,2)))/2:(Math.sqrt(1-Math.pow(-2*a+2,2))+1)/2,X.BackIn=a=>2.70158*a*a*a-1.70158*a*a,X.BackOut=a=>1+2.70158*Math.pow(a-1,3)+1.70158*Math.pow(a-1,2),X.BackInOut=a=>{const e=2.5949095;return a<.5?Math.pow(2*a,2)*(7.189819*a-e)/2:(Math.pow(2*a-2,2)*((e+1)*(2*a-2)+e)+2)/2},X.ElasticIn=a=>{const e=2*Math.PI/3;return a===0?0:a===1?1:-Math.pow(2,10*a-10)*Math.sin((10*a-10.75)*e)},X.ElasticOut=a=>{const e=2*Math.PI/3;return a===0?0:a===1?1:Math.pow(2,-10*a)*Math.sin((10*a-.75)*e)+1},X.ElasticInOut=a=>{const e=2*Math.PI/4.5;return a===0?0:a===1?1:a<.5?-Math.pow(2,20*a-10)*Math.sin((20*a-11.125)*e)/2:Math.pow(2,-20*a+10)*Math.sin((20*a-11.125)*e)/2+1},X.BounceOut=a=>a<1/2.75?7.5625*a*a:a<2/2.75?7.5625*(a-=1.5/2.75)*a+.75:a<2.5/2.75?7.5625*(a-=2.25/2.75)*a+.9375:7.5625*(a-=2.625/2.75)*a+.984375,X.BounceIn=a=>1-X.BounceOut(1-a),X.BounceInOut=a=>a<.5?.5*(1-X.BounceOut(1-2*a)):.5*(X.BounceOut(2*a-1)+1);let Dr=X;const Ph=["viewchange","moveend","flystart","flyend","flystop"],ya=Dr.CubicInOut,Ps=class $0{constructor(e={}){if(this.__id=$0.__counter__++,this.events=at(Ph,this),this._isOrthographic=e.isOrthographic??!1,this._focusDistance=e.focusDistance!=null?e.focusDistance:10,this._width=e.width||1,this._height=e.height||1,this.eye=e.eye||new m,this.eyeHigh=new Float32Array(3),this.eyeLow=new Float32Array(3),this._viewAngle=e.viewAngle||47,this._horizontalViewAngle=0,this._viewMatrix=new J,this._viewMatrixRTE=new J,this._normalMatrix=new Pe,this._r=new m(1,0,0),this._u=new m(0,1,0),this._b=new m(0,0,1),this._f=this._b.negateTo(),this._pr=this._r.clone(),this._pu=this._u.clone(),this._pb=this._b.clone(),this._peye=this.eye.clone(),this.isMoving=!1,this._flight=null,this._completeCallback=null,this._frameCallback=null,this._flying=!1,this._tanViewAngle_hrad=0,this._tanViewAngle_hradOneByHeight=0,this.frustums=[],this.frustumColors=[],e.frustums)for(let t=0,i=e.frustums.length;t<i;t++){let s=e.frustums[t],n=new Jn({fov:this._viewAngle,aspect:this.getAspectRatio(),near:s[0],far:s[1]});n.cameraFrustumIndex=this.frustums.length,this.frustums.push(n),this.frustumColors.push(n._pickingColorU[0],n._pickingColorU[1],n._pickingColorU[2])}else{let t=1,i=500,s=new Jn({fov:this._viewAngle,aspect:this.getAspectRatio(),near:t,far:i});s.cameraFrustumIndex=this.frustums.length,this.frustums.push(s),this.frustumColors.push(s._pickingColorU[0],s._pickingColorU[1],s._pickingColorU[2])}this.FARTHEST_FRUSTUM_INDEX=this.frustums.length-1,this.currentFrustumIndex=0,this.frustumColorIndex=0,this.isFirstPass=!1,this._projSizeConst=0,this.set(e.eye||new m(0,0,1),e.look||new m,e.up||new m(0,1,0))}get isOrthographic(){return this._isOrthographic}set isOrthographic(e){this._isOrthographic!==e&&(this._isOrthographic=e,this.refresh())}get focusDistance(){return this._focusDistance}set focusDistance(e){e!==this._focusDistance&&(this._focusDistance=e,this._isOrthographic&&this.refresh())}get id(){return this.__id}flyCartesian(e,t={}){this.stopFlying(),t.look=t.look||m.ZERO,t.up=t.up||m.UP,t.duration=t.duration||800;const i=t.ease||ya;this._completeCallback=t.completeCallback||(()=>{}),this._frameCallback=t.frameCallback||(()=>{}),t.startCallback&&t.startCallback.call(this);let s=this.eye.clone(),n=this._u,o=this._b,l=t.up,h=e.clone(),c=m.sub(e,t.look),d=l.cross(c);c.normalize(),d.normalize();let u=c.cross(d);this._flight={fly:f=>{let _=1-i(f),g=s.smerp(h,_),v=n.smerp(u,_),p=m.add(g,o.smerp(c,_).negateTo()),y=new m(g.x-p.x,g.y-p.y,g.z-p.z),b=v.cross(y);y.normalize(),b.normalize();let C=y.cross(b);return{eye:g,n:y,u:b,v:C}},duration:t.duration,startedAt:Date.now()},this._flying=!0,this.events.dispatch(this.events.flystart,this)}stopFlying(){this._flying&&(this._flying=!1,this._flight=null,this._frameCallback=null,this.events.dispatch(this.events.flystop,this))}checkFly(){if(this._flying&&this._flight!==null){let e=Math.min((Date.now()-this._flight.startedAt)/this._flight.duration,1);const t=this._flight.fly(e);this.eye=t.eye,this._r=t.u,this._u=t.v,this._b=t.n,this._f.set(-this._b.x,-this._b.y,-this._b.z),this._frameCallback&&this._frameCallback(),this.update(),e>=1&&(this.stopFlying(),this._completeCallback&&(this.events.dispatch(this.events.flyend,this),this._completeCallback(),this._completeCallback=null))}}isFlying(){return this._flying}checkMoveEnd(){let e=this._r,t=this._u,i=this._b,s=this.eye;this._peye.equal(s)&&this._pr.equal(e)&&this._pu.equal(t)&&this._pb.equal(i)?(this.isMoving&&this.events.dispatch(this.events.moveend,this),this.isMoving=!1):this.isMoving=!0,this._pr.copy(e),this._pu.copy(t),this._pb.copy(i),this._peye.copy(s)}bindFrustumsPickingColors(e){for(let t=0;t<this.frustums.length;t++)e.assignPickingColor(this.frustums[t])}_init(e){this._setProj(this._viewAngle,this.getAspectRatio()),this.set(e.eye||new m(0,0,1),e.look||new m,e.up||new m(0,1,0))}getUp(){return this._u.clone()}getDown(){return this._u.negateTo()}getRight(){return this._r.clone()}getLeft(){return this._r.negateTo()}getForward(){return this._f.clone()}getBackward(){return this._b.clone()}update(){let e=this._r,t=this._u,i=this._b,s=this.eye;m.doubleToTwoFloat32Array(s,this.eyeHigh,this.eyeLow),this._viewMatrix.set([e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,-s.dot(e),-s.dot(t),-s.dot(i),1]),this._viewMatrixRTE.set([e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1]);for(let n=0,o=this.frustums.length;n<o;n++)this.frustums[n].setViewMatrix(this._viewMatrix),this.frustums[n].setProjectionViewRTEMatrix(this._viewMatrixRTE);this.events.dispatch(this.events.viewchange,this)}refresh(){this._setProj(this._viewAngle,this.getAspectRatio()),this.update()}get width(){return this._width}get height(){return this._height}setViewportSize(e,t){this._width=e,this._height=t,this.refresh()}getAspectRatio(){return this._width/this._height}_setProj(e,t){this._viewAngle=e;for(let n=0,o=this.frustums.length;n<o;n++){let l=this.frustums[n];l.setProjectionMatrix(e,t,l.near,l.far,this._isOrthographic,this._focusDistance)}var i,s;this._horizontalViewAngle=(i=e,s=t,Vr*Math.atan(Math.tan(Kt*i)*s)),this._updateViewportParameters()}_updateViewportParameters(){this._tanViewAngle_hrad=Math.tan(this._viewAngle*Kt),this._tanViewAngle_hradOneByHeight=this._tanViewAngle_hrad*(1/this._height),this._projSizeConst=Math.min(this._width<512?512:this._width,this._height<512?512:this._height)/(this._viewAngle*G)}setViewAngle(e){this._viewAngle=e,this.refresh()}getViewAngle(){return this._viewAngle}get viewAngle(){return this._viewAngle}get verticalViewAngle(){return this._viewAngle}get horizontalViewAngle(){return this._horizontalViewAngle}set(e,t,i){return this.eye.x=e.x,this.eye.y=e.y,this.eye.z=e.z,t=t||this._b,i=i||this._u,this._b.x=e.x-t.x,this._b.y=e.y-t.y,this._b.z=e.z-t.z,this._r.copy(i.cross(this._b)),this._b.normalize(),this._r.normalize(),this._u.copy(this._b.cross(this._r)),this._f.set(-this._b.x,-this._b.y,-this._b.z),this}look(e,t){this._b.set(this.eye.x-e.x,this.eye.y-e.y,this.eye.z-e.z),this._r.copy((t||this._u).cross(this._b)),this._b.normalize(),this._f.set(-this._b.x,-this._b.y,-this._b.z),this._r.normalize(),this._u.copy(this._b.cross(this._r))}slide(e,t,i){this.eye.x+=e*this._r.x+t*this._u.x+i*this._b.x,this.eye.y+=e*this._r.y+t*this._u.y+i*this._b.y,this.eye.z+=e*this._r.z+t*this._u.z+i*this._b.z}setRoll(e){let t=Math.cos(e),i=Math.sin(e),s=this._r.clone();this._r.set(t*s.x-i*this._u.x,t*s.y-i*this._u.y,t*s.z-i*this._u.z),this._u.set(i*s.x+t*this._u.x,i*s.y+t*this._u.y,i*s.z+t*this._u.z)}setPitch(e){let t=Math.cos(e),i=Math.sin(e),s=this._b;this._b.set(t*s.x-i*this._u.x,t*s.y-i*this._u.y,t*s.z-i*this._u.z),this._u.set(i*s.x+t*this._u.x,i*s.y+t*this._u.y,i*s.z+t*this._u.z)}setYaw(e){let t=Math.cos(e),i=Math.sin(e),s=this._r;this._r.set(t*s.x-i*this._b.x,t*s.y-i*this._b.y,t*s.z-i*this._b.z),this._b.set(i*s.x+t*this._b.x,i*s.y+t*this._b.y,i*s.z+t*this._b.z)}setPitchYawRoll(e,t,i){let s=new D;s.setPitchYawRoll(e,t,i),this.setRotation(s)}getPitch(){return this.getRotation().getPitch()}getYaw(){return this.getRotation().getYaw()}getRoll(){return this.getRotation().getRoll()}getAbsolutePitch(){return this.getRotation().getPitch()}getAbsoluteYaw(){return this.getRotation().getYaw()}getAbsoluteRoll(){return this.getRotation().getRoll()}getRotation(){return D.getLookRotation(this._f,this._u).conjugate()}setRotation(e,t,i,s){e.mulVec3Res(t||new m(0,1,0),this._u),e.mulVec3Res(i||new m(1,0,0),this._r),e.mulVec3Res(s||new m(0,0,1),this._b),this._f.set(-this._b.x,-this._b.y,-this._b.z)}rotate(e){e.mulVec3Res(this._u,this._u),e.mulVec3Res(this._r,this._r),e.mulVec3Res(this._b,this._b),this._f.set(-this._b.x,-this._b.y,-this._b.z)}unproject2v(e,t,i){return this.unproject(e.x,e.y,t,i)}unproject(e,t,i,s){let n=.5*this._width,o=.5*this._height,l=(e-n)/n,h=-(t-o)/o,c=this.frustums[0];if(this.isOrthographic){if(i){let d=.5*(c.right-c.left)*l,u=.5*(c.top-c.bottom)*h,f=this.getUp().scale(u),_=this.getRight().scale(d),g=f.addA(_),v=this.eye.add(g),p=this.getForward(),y=v.addA(p.scaleTo(i));return s&&s.copy(y),y.sub(this.eye).normalize()}return this.getForward()}{let d=c.inverseProjectionViewMatrix,u=d.mulVec4(new tt(l,h,-1,1)).affinity();return d.mulVec4(new tt(l,h,0,1)).affinity().subA(u).toVec3().normalize()}}project3v(e){return this.project(e.x,e.y,e.z)}project(e,t,i){let s=this.frustums[0].projectionViewMatrix.mulVec4(new tt(e,t,i,1));return new N((1+s.x/s.w)*this._width*.5,(1-s.y/s.w)*this._height*.5)}rotateAround(e,t=!1,i=m.ZERO,s=m.UP){s=t?this._u:s;let n=J.getRotation(e,s),o=J.getRotationAroundPoint(e,i,s);this.eye=o.mulVec3(this.eye),this._u=n.mulVec3(this._u).normalize(),this._r=n.mulVec3(this._r).normalize(),this._b=n.mulVec3(this._b).normalize(),this._f.set(-this._b.x,-this._b.y,-this._b.z)}rotateHorizontal(e,t,i,s){this.rotateAround(e,t,i,s)}rotateVertical(e,t){this.rotateAround(e,!1,t,this._r)}projectedSize(e,t){if(this.isOrthographic){const i=this.frustums[0].projectionMatrix._m;return t*(this._height*i[5]*.5)}return Math.atan(t/this.eye.distance(e))*this._projSizeConst}getViewMatrix(){return this._viewMatrix._m}getNormalMatrix(){return this._normalMatrix._m}setCurrentFrustum(e){this.currentFrustumIndex=e,this.frustumColorIndex=10*(e+1)/255,this.isFirstPass=e===this.FARTHEST_FRUSTUM_INDEX}getCurrentFrustum(){return this.currentFrustumIndex}containsSphere(e){for(let t=0;t<this.frustums.length;t++)if(this.frustums[t].containsSphere(e))return!0;return!1}get frustum(){return this.frustums[this.currentFrustumIndex]}getProjectionMatrix(){return this.frustum.projectionMatrix._m}getProjectionViewMatrix(){return this.frustum.projectionViewMatrix._m}getProjectionViewRTEMatrix(){return this.frustum.projectionViewRTEMatrix._m}getInverseProjectionViewMatrix(){return this.frustum.inverseProjectionViewMatrix._m}getInverseProjectionMatrix(){return this.frustum.inverseProjectionMatrix._m}viewDistance(e,t=1e4){let i=e.add(this.getBackward().scaleTo(t));this.set(i,e),this.update()}copy(e){this.eye.copy(e.eye),this._r.copy(e._r),this._u.copy(e._u),this._b.copy(e._b),this._f.copy(e._f),this._width=e.width,this._height=e.height,this.setViewAngle(e.viewAngle),this.update()}getAltitude(){return this.eye.y}};Ps.__counter__=0;let Li=Ps;class xa extends Li{constructor(e,t={}){super({...t,frustums:t.frustums||[[1,100.075],[100,1000.075],[1e3,101e4],[1e6,1e9]]}),this.planet=e,this.minAltitude=t.minAltitude||1,this.maxAltitude=t.maxAltitude||2e7,this._lonLat=this.planet.ellipsoid.cartesianToLonLat(this.eye),this._lonLatMerc=this._lonLat.forwardMercator(),this._terrainAltitude=this._lonLat.height,this._terrainPoint=new m,this._insideSegment=null,this.slope=0,this._keyLock=new Re,this._flight=null,this._completeCallback=null,this._frameCallback=null,this._flying=!1,this._checkTerrainCollision=!0,this.eyeNorm=this.eye.getNormal()}setTerrainCollisionActivity(e){this._checkTerrainCollision=e}update(){this.events.stopPropagation();let e=this.maxAltitude+this.planet.ellipsoid.getEquatorialSize();this.eye.length()>e&&this.eye.copy(this.eye.getNormal().scale(e)),super.update(),this.updateGeodeticPosition(),this.eyeNorm=this.eye.getNormal(),this.slope=this._b.dot(this.eyeNorm),this.events.dispatch(this.events.viewchange,this)}updateGeodeticPosition(){this.planet.ellipsoid.cartesianToLonLatRes(this.eye,this._lonLat),Math.abs(this._lonLat.lat)<=ht&&A.forwardMercatorRes(this._lonLat,this._lonLatMerc)}setAltitude(e){let t=this._terrainPoint,i=this.planet.ellipsoid.getSurfaceNormal3v(this.eye);this.eye.x=i.x*e+t.x,this.eye.y=i.y*e+t.y,this.eye.z=i.z*e+t.z,this._terrainAltitude=e}getAltitude(){return this._terrainAltitude}setLonLat(e,t,i){this.stopFlying(),this._lonLat.set(e.lon,e.lat,e.height||this._lonLat.height);let s=this.planet.ellipsoid,n=s.lonLatToCartesian(this._lonLat),o=t?s.lonLatToCartesian(t):m.ZERO;this.set(n,o,i||n.getNormal()),this.update()}getLonLat(){return this._lonLat}getHeight(){return this._lonLat.height}getExtentPosition(e,t){t=t||0;let i=e.getNorth(),s=e.getSouth(),n=e.getEast(),o=e.getWest();o>n&&(n+=360);let l=this.planet.ellipsoid,h=new A(n,i),c=l.lonLatToCartesian(h);h.lat=s;let d=l.lonLatToCartesian(h);h.lon=o;let u=l.lonLatToCartesian(h);h.lat=i;let f=l.lonLatToCartesian(h),_=m.sub(c,u).scale(.5).addA(u),g=_.length();g<1e-6&&(h.lon=.5*(n+o),h.lat=.5*(i+s),_=l.lonLatToCartesian(h)),f.subA(_),d.subA(_),c.subA(_),u.subA(_);let v=_.getNormal(),p=v.cross(m.NORTH).normalize(),y=p.cross(v).normalize(),b=Math.max(Math.abs(y.dot(f)),Math.abs(y.dot(d)),Math.abs(y.dot(c)),Math.abs(y.dot(u))),C=Math.max(Math.abs(p.dot(f)),Math.abs(p.dot(d)),Math.abs(p.dot(c)),Math.abs(p.dot(u))),T=Math.tan(this._viewAngle*G*.5),w=this.getAspectRatio()*T,L=Math.max(C/w,b/T);return _.normalize(),_.scale(g+L+t),_}viewExtent(e,t){this.stopFlying(),this.set(this.getExtentPosition(e,t),m.ZERO,m.NORTH),this.update()}flyExtent(e,t,i={}){i.look=m.ZERO,this.flyCartesian(this.getExtentPosition(e,t),i)}viewDistance(e,t=1e4){let i=this.eye.add(this.getForward().scaleTo(t)),s=D.getRotationBetweenVectors(i.getNormal(),e.getNormal());if(s.isZero()){let n=e.add(this.getBackward().scaleTo(t));this.set(n,e)}else{let n=e.add(s.mulVec3(this.getBackward()).scale(t)),o=s.mulVec3(this.getUp());this.set(n,e,o)}this.update()}flyLonLat(e,t={}){let i=new A(e.lon,e.lat,e.height||this._lonLat.height);this.flyCartesian(this.planet.ellipsoid.lonLatToCartesian(i),t)}flyDistance(e,t=1e4,i={}){let s=this.eye.add(this.getForward().scaleTo(t)),n=D.getRotationBetweenVectors(s.getNormal(),e.getNormal());if(n.isZero()){let o=e.add(this.getBackward().scaleTo(t));this.set(o,e)}else{let o=e.add(n.mulVec3(this.getBackward()).scale(t)),l=n.mulVec3(this.getUp());i.look=e,i.up=l,this.flyCartesian(o,i)}}flyCartesian(e,t={}){this.stopFlying(),t.preventLock||(this.planet.layerLock.lock(this._keyLock),this.planet.terrainLock.lock(this._keyLock),this.planet.normalMapCreator.lock(this._keyLock)),t.amplitude=t.amplitude!=null?t.amplitude:1,t.look=t.look||m.ZERO,t.up=t.up||m.NORTH,t.duration=t.duration||800;const i=t.ease||ya;this._completeCallback=t.completeCallback||(()=>{}),this._frameCallback=t.frameCallback||(()=>{}),t.startCallback&&t.startCallback.call(this),t.look instanceof A&&(t.look=this.planet.ellipsoid.lonLatToCartesian(t.look));let s=this.eye.clone(),n=this._u,o=this._b,l=this.planet.ellipsoid.cartesianToLonLat(e),h=t.up,c=this.planet.ellipsoid.lonLatToCartesian(new A(l.lon,l.lat,0)),d=m.sub(e,t.look),u=h.cross(d);d.normalize(),u.normalize();let f=d.cross(u),_=s.getNormal(),g=c.getNormal(),v=1-_.dot(g),p=t.amplitude*mo*Math.sqrt(v>0?v:0),y=6639613,b=Math.max(this._lonLat.height,l.height);b>y&&(y=b);let C=b+2.5*p*(y-b),T=m.ZERO;this._flight={fly:w=>{let L,S=i(w),P=1-S;if(S>=1)L=e.clone();else{let R=s.smerp(e,P).normalize(),O=this.planet.getRayIntersectionEllipsoid(new H(T,R)),se=this._lonLat.height*P*P*P+3*C*P*P*S+3*C*P*S*S+l.height*S*S*S;L=O.addA(R.scale(se))}let B=n.smerp(f,P),k=m.add(L,o.smerp(d,P).negateTo()),I=new m(L.x-k.x,L.y-k.y,L.z-k.z),z=B.cross(I);I.normalize(),z.normalize();let Ce=I.cross(z);return{eye:L,n:I,u:z,v:Ce}},duration:t.duration,startedAt:Date.now()},this._flying=!0,this.events.dispatch(this.events.flystart,this)}stopFlying(){this._flying&&(this.planet.layerLock.free(this._keyLock),this.planet.terrainLock.free(this._keyLock),this.planet.normalMapCreator.free(this._keyLock),super.stopFlying())}rotateLeft(e,t){this.rotateHorizontal(e,t!==!0,m.ZERO),this.update()}rotateRight(e,t){this.rotateHorizontal(-e,t!==!0,m.ZERO),this.update()}rotateUp(e){this.rotateVertical(e,m.ZERO),this.update()}rotateDown(e){this.rotateVertical(-e,m.ZERO),this.update()}rotateVertical(e,t,i=0){let s=new J().setRotation(this._r,e),n=new J().setIdentity().translate(t),o=new J().setIdentity().translate(t.negateTo()),l=n.mul(s).mul(o).mulVec3(this.eye),h=s.mulVec3(this._u).normalize(),c=s.mulVec3(this._r).normalize(),d=s.mulVec3(this._b).normalize(),u=l.getNormal(),f=d.dot(u);if(!(h.dot(u)<=0))if(i){let _=f-this.slope;if(f<i&&_<0)return;(f>.1&&h.dot(u)>0||this.slope<=.1||this._u.dot(this.eye.getNormal())<=0)&&(this.eye=l,this._u=h,this._r=c,this._b=d,this._f.set(-d.x,-d.y,-d.z))}else this.eye=l,this._u=h,this._r=c,this._b=d,this._f.set(-d.x,-d.y,-d.z)}checkTerrainCollision(){if(this._terrainAltitude=this._lonLat.height,this._insideSegment&&this._insideSegment.planet)return this._terrainAltitude=this._insideSegment.getTerrainPoint(this.eye,this._insideSegment.getInsideLonLat(this),this._terrainPoint),this._terrainAltitude<this.minAltitude&&this._checkTerrainCollision&&this.setAltitude(this.minAltitude),this._terrainPoint}getSurfaceVisibleDistance(e){let t=this.planet.ellipsoid.equatorialSize;return t*Math.acos(t/(t+this._lonLat.height+e))}getHeading(){let e=this.eye.getNormal(),t=m.proj_b_to_plane(this.slope>=.97?this.getUp():this.getForward(),e).normalize(),i=m.proj_b_to_plane(m.NORTH,e).normalize(),s=Math.sign(e.dot(t.cross(i)))*Math.acos(t.dot(i))*Q;return s<0?360+s:s}isVisible(e){let t=this.eye.length();return this.eye.distance(e)<Math.sqrt(t*t-this.planet.ellipsoid.equatorialSizeSqr)}getPitch(){return this.planet.getFrameRotation(this.eye).conjugate().inverse().mul(this.getRotation()).getPitch()}getYaw(){return this.planet.getFrameRotation(this.eye).conjugate().inverse().mul(this.getRotation()).getYaw()}getRoll(){return this.planet.getFrameRotation(this.eye).conjugate().inverse().mul(this.getRotation()).getRoll()}setPitch(e){let t=this.planet.getFrameRotation(this.eye),i=new D;i.setPitchYawRoll(e,this.getYaw(),this.getRoll(),t),this.setRotation(i)}setYaw(e){let t=this.planet.getFrameRotation(this.eye),i=new D;i.setPitchYawRoll(this.getPitch(),e,this.getRoll(),t),this.setRotation(i)}setRoll(e){let t=this.planet.getFrameRotation(this.eye),i=new D;i.setPitchYawRoll(this.getPitch(),this.getYaw(),e,t),this.setRotation(i)}setPitchYawRoll(e,t,i){let s=this.planet.getFrameRotation(this.eye),n=new D;n.setPitchYawRoll(e,t,i,s).conjugate(),this.setRotation(n)}}const Ss=class X0{constructor(e,t={}){this.handler=e,this.__id=X0.__counter__++,this._fbo=null,this._width=t.width||e.canvas.width,this._height=t.height||e.canvas.height,this._depthComponent=t.depthComponent!=null?t.depthComponent:"DEPTH_COMPONENT16",this._useDepth=t.useDepth==null||t.useDepth,this._active=!1,this._size=t.size||1,this._depthRenderbuffer=null,this._filter=t.filter||"NEAREST"}get width(){return this._width}get height(){return this._height}setSize(e,t,i=!1){this._width=e,this._height=t,this._active&&this.handler.gl.viewport(0,0,this._width,this._height),(this._useDepth||i)&&(this.destroy(),this.init())}init(){}destroy(){}isComplete(){let e=this.handler.gl;return e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE}checkStatus(){let e=this.handler.gl;return e.checkFramebufferStatus(e.FRAMEBUFFER)}activate(){let e=this.handler.gl;e.bindFramebuffer(e.FRAMEBUFFER,null),e.bindFramebuffer(e.FRAMEBUFFER,this._fbo),e.viewport(0,0,this._width,this._height),this._active=!0;let t=this.handler.framebufferStack.current().data;return t&&(t._active=!1),this.handler.framebufferStack.push(this),this}deactivate(){let e=this.handler,t=e.gl;t.bindFramebuffer(t.FRAMEBUFFER,null),this._active=!1;let i=this.handler.framebufferStack.popPrev();i?(t.bindFramebuffer(t.FRAMEBUFFER,i._fbo),t.viewport(0,0,i._width,i._height)):t.viewport(0,0,e.canvas.width,e.canvas.height)}isEqual(e){return!!e&&this.__id===e.__id}};Ss.__counter__=0;let ls=Ss;class pi{constructor(e=256,t=256){this._canvas=document.createElement("canvas"),this._canvas.width=e,this._canvas.height=t,this._context=this._canvas.getContext("2d",{willReadFrequently:!0})}getCanvas(){return this._canvas}getContext(){return this._context}fillEmpty(){let e=this._context.getImageData(0,0,this._canvas.width,this._canvas.height),t=e.data;for(let i=0,s=t.length;i<s;i+=4)t[i]=t[i+1]=t[i+2]=t[i+3]=0;this._context.putImageData(e,0,0)}fill(e){this._context.fillStyle=e,this._context.fill()}getData(){return this._context.getImageData(0,0,this._canvas.width,this._canvas.height).data}fillColor(e){this._context.fillStyle=e,this._context.fillRect(0,0,this._canvas.width,this._canvas.height)}setData(e){let t=this._context.createImageData(this._canvas.width,this._canvas.height);t.data.set(e),this._context.putImageData(t,0,0)}resize(e,t){this._canvas.width=e,this._canvas.height=t,this._context=this._canvas.getContext("2d")}drawImage(e,t,i,s,n){this._context.drawImage(e,t||0,i||0,s||e.width,n||e.height)}getImage(){let e=new Image;return e.width=this.getWidth(),e.height=this.getHeight(),e.src=this._canvas.toDataURL("image/png"),e}getTextWidth(e){let t=this._context.measureText(e);return Math.round(t.width)}drawText(e,t=0,i=14,s="normal 14px Verdana",n="black"){this._context.fillStyle=n,this._context.font=s,this._context.fillText(e,t,i)}getWidth(){return this._canvas.width}getHeight(){return this._canvas.height}load(e,t){let i=new Image,s=this;i.onload=function(){s.resize(i.width,i.height),s._context.drawImage(i,0,0,i.width,i.height),t&&t(i)},i.src=e}openImage(){let e=this.getImage(),t="<!DOCTYPE html>";t+="<html>",t+="<head><title>Print</title></head>",t+="<body>",t+='<img src="'+e.src+'">',t+="</body>",t+="</html>";let i=window.open("","","width="+e.width+"px ,height="+e.height+"px");i&&(i.document.open(),i.document.write(t),i.document.close(),i.focus())}destroy(){this._canvas.width=1,this._canvas.height=1,this._canvas=null,this._context=null}}const to={UNSIGNED_BYTE:Uint8Array,FLOAT:Float32Array};class St extends ls{constructor(e,t={}){super(e,t),this.readPixelBuffersAsync=i=>{const s=this.handler.gl;if(this._skipFrame)return;this._skipFrame=!0;let n=this.width,o=this.height,l=this.pixelBuffers;this.activate();for(let u=0;u<l.length;u++){let f=l[u];s.bindBuffer(s.PIXEL_PACK_BUFFER,f.buffer),s.bufferData(s.PIXEL_PACK_BUFFER,f.data.byteLength,s.STREAM_READ),s.readBuffer(f.glAttachment),s.readPixels(0,0,n,o,s.RGBA,f.glType,0),s.bindBuffer(s.PIXEL_PACK_BUFFER,null)}this.deactivate();const h=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);var c,d;s.flush(),(c=s,d=h,new Promise((u,f)=>{(function _(){const g=c.clientWaitSync(d,0,0);g==c.WAIT_FAILED?f():g==c.TIMEOUT_EXPIRED?requestAnimationFrame(_):u()})()})).then(()=>{this._skipFrame=!1,s.deleteSync(h);for(let u=0;u<l.length;u++){let f=l[u];f.data&&(s.bindBuffer(s.PIXEL_PACK_BUFFER,f.buffer),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,f.data))}s.bindBuffer(s.PIXEL_PACK_BUFFER,null),i&&i(this)})},this._targets=St.createTargets(t.targets),this._size=this._targets.length,this._renderbufferTarget=t.renderbufferTarget!=null?t.renderbufferTarget:"DEPTH_ATTACHMENT",this.textures=t.textures||new Array(this._size),this.pixelBuffers=[],this._skipFrame=!1}static createTargets(e){let t=0,i=0;return e?e.map(s=>{let n=s.attachment||"COLOR_ATTACHMENT";n==="COLOR_ATTACHMENT"&&(n="COLOR_ATTACHMENT"+t++);let o=s.type||"UNSIGNED_BYTE";return{internalFormat:s.internalFormat||"RGBA",format:s.format||"RGBA",type:o,attachment:n,filter:s.filter||"NEAREST",pixelBufferIndex:s.readAsync?i++:-1,TypeArrayConstructor:to[o]}}):[{internalFormat:"RGBA",format:"RGBA",type:"UNSIGNED_BYTE",attachment:"COLOR_ATTACHMENT0",filter:"NEAREST",pixelBufferIndex:-1,TypeArrayConstructor:to.UNSIGNED_BYTE}]}destroy(){let e=this.handler.gl;if(e){for(let t=0;t<this.textures.length;t++)e.deleteTexture(this.textures[t]);this.textures=new Array(this._size);for(let t=0;t<this.pixelBuffers.length;t++)this.pixelBuffers[t].data=null,e.deleteBuffer(this.pixelBuffers[t].buffer);this.pixelBuffers=[],e.deleteFramebuffer(this._fbo),e.deleteRenderbuffer(this._depthRenderbuffer),this._depthRenderbuffer=null,this._fbo=null,this._active=!1}}init(){let e=this.handler.gl;if(!e)return;this._fbo=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this._fbo);let t=[];for(let i=0;i<this._targets.length;i++){let s=this._targets[i],n=this.textures[i]||this.handler.createEmptyTexture2DExt(this._width,this._height,s.filter,s.internalFormat,s.format,s.type),o=e[s.attachment];n&&(this.bindOutputTexture(n,o),this.textures[i]=n),s.attachment!=="DEPTH_ATTACHMENT"&&t.push(o),s.pixelBufferIndex!==-1&&this._createPixelBuffer(s)}e.drawBuffers&&e.drawBuffers(t),this._useDepth&&(this._depthRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this._depthRenderbuffer),e.renderbufferStorage(e.RENDERBUFFER,e[this._depthComponent],this._width,this._height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e[this._renderbufferTarget],e.RENDERBUFFER,this._depthRenderbuffer),e.bindRenderbuffer(e.RENDERBUFFER,null)),e.bindFramebuffer(e.FRAMEBUFFER,null)}getPixelBufferData(e=0){let t=this._targets[e].pixelBufferIndex;return t!==-1?this.pixelBuffers[t].data:null}_createPixelBuffer(e){let t=this.handler.gl,i=e.pixelBufferIndex,s=this.pixelBuffers[i];s||(s=this.pixelBuffers[i]={buffer:null,data:null,glType:-1,glAttachment:-1});let n=this.width*this.height*4;s.data=null,s.data=new e.TypeArrayConstructor(n),s.buffer=t.createBuffer(),t.bindBuffer(t.PIXEL_PACK_BUFFER,s.buffer),t.bufferData(t.PIXEL_PACK_BUFFER,n,t.STREAM_READ),t.bindBuffer(t.PIXEL_PACK_BUFFER,null),s.glType=t[e.type],s.glAttachment=t[e.attachment]}bindOutputTexture(e,t){let i=this.handler.gl;i.bindTexture(i.TEXTURE_2D,e),i.framebufferTexture2D(i.FRAMEBUFFER,t||i.COLOR_ATTACHMENT0,i.TEXTURE_2D,e,0),i.bindTexture(i.TEXTURE_2D,null)}readPixels(e,t,i,s=0,n=1,o=1){let l=this.handler.gl;l.bindFramebuffer(l.FRAMEBUFFER,this._fbo),l.readBuffer&&l.readBuffer(l.COLOR_ATTACHMENT0+s||0),l.readPixels(t*this._width,i*this._height,n,o,l.RGBA,l[this._targets[s].type],e),l.bindFramebuffer(l.FRAMEBUFFER,null)}readAllPixels(e,t=0){let i=this.handler.gl;i.bindFramebuffer(i.FRAMEBUFFER,this._fbo),i.readBuffer&&i.readBuffer(i.COLOR_ATTACHMENT0+t),i.readPixels(0,0,this._width,this._height,i.RGBA,i[this._targets[t].type],e),i.bindFramebuffer(i.FRAMEBUFFER,null)}getImage(){let e=new Uint8Array(4*this._width*this._height);this.readAllPixels(e);let t=new pi(this._width,this._height);return t.setData(e),t.getImage()}readData(e,t,i,s=0){const n=this.width,o=this.height,l=Math.floor(e*(n-1)),h=4*(Math.floor(t*(o-1))*n+l),c=this.pixelBuffers[s].data;c&&(i[0]=c[h],i[1]=c[h+1],i[2]=c[h+2],i[3]=c[h+3])}}const Sh=["tick","end","start","stop"],Rs=class K0{constructor(e={}){this.__handler=null,this.active=!0,this.__id=K0.__counter__++,this.events=at(Sh,this),this.name=e.name||"",this.startDate=e.startDate||0,this.endDate=e.endDate||0;let t=e.currentDate||es(new Date);e.startDate&&t<e.startDate&&(t=e.startDate),e.endDate&&t>e.endDate&&(t=e.endDate),this.currentDate=t,this._multiplier=e.multiplier!==void 0?e.multiplier:1,this._running=1,this.deltaTicks=0,this.active=!0,this._intervalDelay=0,this._intervalStart=0,this._intervalCallback=null}clearInterval(){this._intervalDelay=0,this._intervalStart=0,this._intervalCallback=null}setInterval(e,t){this._intervalStart=this.currentDate,this._intervalDelay=e*Qr,this._intervalCallback=t}setDate(e){let t=es(e);this.startDate&&t<this.startDate&&(t=this.startDate),this.endDate&&t>this.endDate&&(t=this.endDate),this.currentDate=t}getDate(){return gr(this.currentDate)}reset(){this.startDate&&(this.currentDate=this.startDate)}tick(e){let t=this._multiplier*this._running;if(this.deltaTicks=e*t,this.active){let i=zo(this.currentDate,this.deltaTicks);t>0?this.endDate&&i>this.endDate?(this.currentDate=this.startDate,this.events.dispatch(this.events.end,this)):this.currentDate=i:this.startDate&&i<this.startDate?(this.currentDate=this.endDate,this.events.dispatch(this.events.end,this)):this.currentDate=i,this._intervalCallback&&this.currentDate-this._intervalStart>=this._intervalDelay&&(this._intervalStart=this.currentDate,this._intervalCallback(this)),this.events.dispatch(this.events.tick,this)}}isEqual(e){return this.__id===e.__id}start(){this._running===0&&(this._running=1,this.events.dispatch(this.events.start,this))}get multiplier(){return this._multiplier}set multiplier(e){this._multiplier=e}stop(){this._running===1&&(this._running=0,this.events.dispatch(this.events.stop,this))}};Rs.__counter__=0;let Fr=Rs;class Rh{constructor(e,t){t._programController=this,this._program=t,this._handler=e,this._activated=!1}initialize(){this._handler.gl&&this._program.createProgram(this._handler.gl)}getProgram(){return this._program}activate(){if(!this._activated){this._handler.activeProgram.deactivate(),this._handler.activeProgram=this;let e=this._program;this._activated=!0,e.enableAttribArrays(),e.use()}return this}remove(){let e=this._handler.programs;e[this._program.name]&&(this._activated&&this.deactivate(),this._program.delete(),delete e[this._program.name])}deactivate(){this._program.disableAttribArrays(),this._activated=!1}isActive(){return this._activated}set(e){return this.activate(),this._program.set(e),this}drawIndexBuffer(e,t){return this._program.drawIndexBuffer(e,t),this}drawArrays(e,t){return this._program.drawArrays(e,t),this}}let eo=class{constructor(){this.next=null,this.prev=null,this.data=null}};class Qs{constructor(e=256){this._current=new eo,this._head=this._current;for(let t=0;t<e;t++){let i=new eo;i.prev=this._current,this._current.next=i,this._current=i}this._current=this._head}current(){return this._current}push(e){this._current=this._current.next,this._current.data=e}pop(){let e=this._current.data;return this._current=this._current.prev,e}popPrev(){return this._current=this._current.prev,this._current.data}}const io=["","WEBKIT_","MOZ_"],Js=["webgl2","webgl"];class Me{constructor(e,t={}){this.framebufferStack=new Qs,this._requestAnimationFrameId=0,this.drawFrame=()=>{let i=window.performance.now(),s=this.deltaTime;this.deltaTime=.5*(i-this._lastAnimationFrameTime+this.prevDeltaTime),this.deltaTime>3?this.deltaTime=3:this.deltaTime<1&&(this.deltaTime=1),this.prevDeltaTime=s,this._lastAnimationFrameTime=i,this.defaultClock.tick(this.deltaTime);for(let o=0;o<this._clocks.length;o++)this._clocks[o].tick(this.deltaTime);let n=this.canvas;Math.floor(n.clientWidth*this._params.pixelRatio)===n.width&&Math.floor(n.clientHeight*this._params.pixelRatio)===n.height||(n.clientWidth===0||n.clientHeight===0?this.stop():document.hidden||(this.start(),this.setSize(n.clientWidth,n.clientHeight))),this._frameCallback()},this.events=at(["visibilitychange","resize"]),this._throttledDrawFrame=this.drawFrame,this.defaultClock=new Fr,this._clocks=[],this.prevDeltaTime=0,this.deltaTime=0,this.canvas=null,this.gl=null,this.programs={},this.activeProgram=null,this._canvasSize=[0,0],this._params={anisotropy:t.anisotropy||4,width:t.width||256,height:t.height||256,pixelRatio:ko("og_dpi")||t.pixelRatio||1,extensions:t.extensions||[],context:t.context||{}},this.extensions={},this._canvasTarget=e,this._lastAnimationFrameTime=0,this._initialized=!1,this._frameCallback=function(){},this.transparentTexture=null,this.defaultTexture=null,this.framebufferStack=new Qs,this.createTexture_n=this.createTexture_n_webgl2.bind(this),this.createTexture_l=this.createTexture_l_webgl2.bind(this),this.createTexture_mm=this.createTexture_mm_webgl2.bind(this),this.createTexture_a=this.createTexture_a_webgl2.bind(this),this.createTexture={NEAREST:this.createTexture_n,LINEAR:this.createTexture_l,MIPMAP:this.createTexture_mm,ANISOTROPIC:this.createTexture_a},this.createTextureDefault=this.createTexture_n,this.ONCANVASRESIZE=null,this._createCanvas(),(t.autoActivate||Ut(t.autoActivate))&&this.initialize()}set frameDelay(e){this._throttledDrawFrame=e===0?this.drawFrame:vi(this.drawFrame,e)}isInitialized(){return this._initialized}_createCanvas(){this._canvasTarget?this._canvasTarget instanceof HTMLElement?this.canvas=this._canvasTarget:this.canvas=document.getElementById(this._canvasTarget)||document.querySelector(this._canvasTarget):(this.canvas=document.createElement("canvas"),this.canvas.width=this._params.width,this.canvas.height=this._params.height)}static getExtension(e,t){if(!e)return;let i,s;for(i in io)if(s=e.getExtension(io[i]+t),s)return s}static getContext(e,t){let i=null;try{let s=new URLSearchParams(location.search).get("og_ver");if(s)i=e.getContext(s,t),i&&(i.type=s);else for(let n=0;n<Js.length;n++)if(i=e.getContext(Js[n],t),i){i.type=Js[n];break}}catch{ee.logErr("exception during the GL context initialization")}return i||ee.logErr("could not initialise WebGL"),i}setFrameCallback(e){e&&(this._frameCallback=e)}createEmptyTexture2DExt(e=1,t=1,i="NEAREST",s="RGBA",n="RGBA",o="UNSIGNED_BYTE",l="CLAMP_TO_EDGE",h=0){let c=this.gl,d=c.createTexture();return c.bindTexture(c.TEXTURE_2D,d),c.texImage2D(c.TEXTURE_2D,h,c[s.toUpperCase()],e,t,0,c[n.toUpperCase()],c[o.toUpperCase()],null),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c[i.toUpperCase()]),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c[i.toUpperCase()]),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c[l.toUpperCase()]),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c[l.toUpperCase()]),c.bindTexture(c.TEXTURE_2D,null),d}createEmptyTexture_n(e,t,i,s){let n=this.gl,o=n.createTexture();return n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,i||n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,s||n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,s||n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),o}createEmptyTexture_l(e,t,i,s){let n=this.gl,o=n.createTexture();return n.bindTexture(n.TEXTURE_2D,o),n.texImage2D(n.TEXTURE_2D,0,i||n.RGBA,e,t,0,n.RGBA,n.UNSIGNED_BYTE,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,s||n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,s||n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),o}createTexture_n_webgl1(e,t,i,s=null){let n=this.gl;return s=s||n.createTexture(),n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t||n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,i||n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,i||n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),s}createTexture_l_webgl1(e,t,i,s=null){let n=this.gl;return s=s||n.createTexture(),n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t||n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,i||n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,i||n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),s}createTexture_mm_webgl1(e,t,i,s=null){let n=this.gl;return s=s||n.createTexture(),n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t||n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e),n.generateMipmap(n.TEXTURE_2D),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,i||n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,i||n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),s}createTexture_a_webgl1(e,t,i,s=null){let n=this.gl;return s=s||n.createTexture(),n.bindTexture(n.TEXTURE_2D,s),n.texImage2D(n.TEXTURE_2D,0,t||n.RGBA,n.RGBA,n.UNSIGNED_BYTE,e),n.generateMipmap(n.TEXTURE_2D),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_LINEAR),n.texParameterf(n.TEXTURE_2D,this.extensions.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._params.anisotropy),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,i||n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,i||n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),s}createTexture_n_webgl2(e,t,i,s=null){let n=this.gl;return s=s||n.createTexture(),n.bindTexture(n.TEXTURE_2D,s),n.texStorage2D(n.TEXTURE_2D,1,t||n.RGBA8,e.width,e.height),n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.width,e.height,n.RGBA,n.UNSIGNED_BYTE,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,i||n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,i||n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),s}createTexture_l_webgl2(e,t,i,s=null){let n=this.gl;return s=s||n.createTexture(),n.bindTexture(n.TEXTURE_2D,s),n.texStorage2D(n.TEXTURE_2D,1,t||n.RGBA8,e.width,e.height),n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.width,e.height,n.RGBA,n.UNSIGNED_BYTE,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,i||n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,i||n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),s}createTexture_mm_webgl2(e,t,i,s=null){let n=this.gl;return s=s||n.createTexture(),n.bindTexture(n.TEXTURE_2D,s),n.texStorage2D(n.TEXTURE_2D,2,t||n.RGBA8,e.width,e.height),n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.width,e.height,n.RGBA,n.UNSIGNED_BYTE,e),n.generateMipmap(n.TEXTURE_2D),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,i||n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,i||n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),s}createTexture_a_webgl2(e,t,i,s=null){let n=this.gl;return s=s||n.createTexture(),n.bindTexture(n.TEXTURE_2D,s),n.texStorage2D(n.TEXTURE_2D,2,t||n.RGBA8,e.width,e.height),n.texSubImage2D(n.TEXTURE_2D,0,0,0,e.width,e.height,n.RGBA,n.UNSIGNED_BYTE,e),n.generateMipmap(n.TEXTURE_2D),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_LINEAR),n.texParameterf(n.TEXTURE_2D,this.extensions.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,this._params.anisotropy),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,i||n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,i||n.CLAMP_TO_EDGE),n.bindTexture(n.TEXTURE_2D,null),s}loadCubeMapTexture(e){let t=this.gl,i=t.createTexture();t.bindTexture(t.TEXTURE_CUBE_MAP,i),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR);let s=[[e.px,t.TEXTURE_CUBE_MAP_POSITIVE_X],[e.nx,t.TEXTURE_CUBE_MAP_NEGATIVE_X],[e.py,t.TEXTURE_CUBE_MAP_POSITIVE_Y],[e.ny,t.TEXTURE_CUBE_MAP_NEGATIVE_Y],[e.pz,t.TEXTURE_CUBE_MAP_POSITIVE_Z],[e.nz,t.TEXTURE_CUBE_MAP_NEGATIVE_Z]],n=new pi;n.fillEmpty();let o=n.getImage();for(let l=0;l<s.length;l++){let h=s[l][1];t.bindTexture(t.TEXTURE_CUBE_MAP,i),t.texImage2D(h,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,o)}for(let l=0;l<s.length;l++){let h=s[l][1],c=new Image;c.crossOrigin="",c.onload=function(d,u,f){return function(){t&&d&&(t.bindTexture(t.TEXTURE_CUBE_MAP,d),t.texImage2D(u,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,f))}}(i,h,c),c.src=s[l][0]}return i}addProgram(e,t=!1){if(this.programs[e.name])console.warn(`Shader program: "${e.name}" already exists.`);else{let i=new Rh(this,e);this.programs[e.name]=i,this._initProgramController(i),t||(i._activated=!1)}return e}removeProgram(e){this.programs[e]&&this.programs[e].remove()}addPrograms(e){for(let t=0;t<e.length;t++)this.addProgram(e[t])}_initProgramController(e){this._initialized&&(e.initialize(),this.activeProgram?(e.deactivate(),this.activeProgram._program.enableAttribArrays(),this.activeProgram._program.use()):(this.activeProgram=e,e.activate()))}_initPrograms(){for(let e in this.programs)this._initProgramController(this.programs[e])}initializeExtension(e,t=!1){if(!this.extensions||!this.extensions[e]){let i=Me.getExtension(this.gl,e);i?this.extensions[e]=i:t&&console.warn("og.webgl.Handler: extension '"+e+"' doesn't initialize.")}return this.extensions&&this.extensions[e]}initialize(){if(this._initialized||!this.canvas||(this.gl=Me.getContext(this.canvas,this._params.context),!this.gl))return;this._initialized=!0,this._params.extensions.push("EXT_texture_filter_anisotropic"),this.gl.type==="webgl"?(this._params.extensions.push("OES_standard_derivatives"),this._params.extensions.push("OES_element_index_uint"),this._params.extensions.push("WEBGL_depth_texture"),this._params.extensions.push("ANGLE_instanced_arrays")):(this._params.extensions.push("EXT_color_buffer_float"),this._params.extensions.push("OES_texture_float_linear"));let e=this._params.extensions.length;for(;e--;)this.initializeExtension(this._params.extensions[e],!0);this.gl.type==="webgl"?(this.createTexture_n=this.createTexture_n_webgl1.bind(this),this.createTexture_l=this.createTexture_l_webgl1.bind(this),this.createTexture_mm=this.createTexture_mm_webgl1.bind(this),this.createTexture_a=this.createTexture_a_webgl1.bind(this)):(this.createTexture_n=this.createTexture_n_webgl2.bind(this),this.createTexture_l=this.createTexture_l_webgl2.bind(this),this.createTexture_mm=this.createTexture_mm_webgl2.bind(this),this.createTexture_a=this.createTexture_a_webgl2.bind(this)),this.createTexture.NEAREST=this.createTexture_n,this.createTexture.LINEAR=this.createTexture_l,this.createTexture.MIPMAP=this.createTexture_mm,this.createTexture.ANISOTROPIC=this.createTexture_a,this.extensions.EXT_texture_filter_anisotropic?this.createTextureDefault=this.createTexture_a:this.createTextureDefault=this.createTexture_mm,this._initPrograms(),this._setDefaults(),this.intersectionObserver=new IntersectionObserver(t=>{this._toggleVisibilityChange(t[t.length-1].isIntersecting)},{threshold:0}),this.intersectionObserver.observe(this.canvas),this.resizeObserver=new ResizeObserver(t=>{this._toggleVisibilityChange(t[0].contentRect.width!==0&&t[0].contentRect.height!==0)}),this.resizeObserver.observe(this.canvas),document.addEventListener("visibilitychange",()=>{this._toggleVisibilityChange(document.visibilityState==="visible")})}_toggleVisibilityChange(e){e?(this.start(),this.ONCANVASRESIZE&&this.ONCANVASRESIZE(),this.events.dispatch(this.events.visibilitychange,!0)):(this.events.dispatch(this.events.visibilitychange,!1),this.stop())}_setDefaults(){let e=this.gl;e&&this.canvas&&(e.depthFunc(e.LESS),e.enable(e.DEPTH_TEST),this.setSize(this.canvas.clientWidth||this._params.width,this.canvas.clientHeight||this._params.height),e.frontFace(e.CCW),e.cullFace(e.BACK),e.enable(e.CULL_FACE),e.disable(e.BLEND),this.createDefaultTexture({color:"rgba(0,0,0,0.0)"},t=>{this.transparentTexture=t}),this.createDefaultTexture({color:"rgba(255, 255, 255, 1.0)"},t=>{this.defaultTexture=t}))}getCanvasSize(){return this._canvasSize}createStreamArrayBuffer(e,t,i,s=4){let n=this.gl,o=n.createBuffer();return n.bindBuffer(n.ARRAY_BUFFER,o),n.bufferData(n.ARRAY_BUFFER,t*e*s,i||n.STREAM_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),o.itemSize=e,o.numItems=t,o}setStreamArrayBuffer(e,t,i=0){let s=this.gl;return s.bindBuffer(s.ARRAY_BUFFER,e),s.bufferSubData(s.ARRAY_BUFFER,i,t),s.bindBuffer(s.ARRAY_BUFFER,null),e}createArrayBuffer(e,t,i,s){let n=this.gl,o=n.createBuffer();return n.bindBuffer(n.ARRAY_BUFFER,o),n.bufferData(n.ARRAY_BUFFER,e,s||n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),o.itemSize=t,o.numItems=i||e.length/t,o}createArrayBufferLength(e,t){let i=this.gl,s=i.createBuffer();return i.bindBuffer(i.ARRAY_BUFFER,s),i.bufferData(i.ARRAY_BUFFER,e,t||i.STATIC_DRAW),i.bindBuffer(i.ARRAY_BUFFER,null),s.itemSize=1,s.numItems=e,s}createElementArrayBuffer(e,t,i,s){let n=this.gl,o=n.createBuffer();return n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,o),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,s||n.STATIC_DRAW),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),o.itemSize=t,o.numItems=i||e.length,o}setSize(e,t){this._params.width=e,this._params.height=t,this.canvas&&(this.canvas.width=e*this._params.pixelRatio,this.canvas.height=t*this._params.pixelRatio,this._canvasSize[0]=this.canvas.width,this._canvasSize[1]=this.canvas.height,this.gl&&this.gl.viewport(0,0,e,t),this.ONCANVASRESIZE&&this.ONCANVASRESIZE(this.canvas),this.events.dispatch(this.events.resize,this))}get pixelRatio(){return this._params.pixelRatio}set pixelRatio(e){this._params.pixelRatio=e,this.setSize(this._params.width,this._params.height)}getWidth(){return this.canvas?this.canvas.width:0}getHeight(){return this.canvas?this.canvas.height:0}getClientAspect(){return this.canvas?this.canvas.clientWidth/this.canvas.clientHeight:0}getCenter(){let e=this.canvas;return e?new N(Math.round(.5*e.width),Math.round(.5*e.height)):new N}clearFrame(){let e=this.gl;e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT)}start(){!this._requestAnimationFrameId&&this._initialized&&this._animationFrameCallback()}stop(){this._requestAnimationFrameId&&(window.cancelAnimationFrame(this._requestAnimationFrameId),this._requestAnimationFrameId=0)}isStopped(){return!this._requestAnimationFrameId}isWebGl2(){return!!this.gl&&this.gl.type==="webgl2"}_animationFrameCallback(){this._requestAnimationFrameId=window.requestAnimationFrame(()=>{this._throttledDrawFrame(),this._requestAnimationFrameId&&this._animationFrameCallback()})}createDefaultTexture(e,t){let i,s;if(e&&e.color)i=new pi(2,2),i.fillColor(e.color),s=this.createTexture_n(i.getCanvas()),s.default=!0,t(s);else if(e&&e.url){let n=new Image,o=this;n.onload=function(){s=o.createTextureDefault(n),s.default=!0,t(s)},n.src=e.url}else i=new pi(2,2),i.fillColor("#C5C5C5"),s=this.createTexture_n(i.getCanvas()),s.default=!0,t(s)}deleteTexture(e){e&&!e.default&&this.gl&&this.gl.deleteTexture(e)}destroy(){var e,t;(e=this.resizeObserver)==null||e.disconnect(),(t=this.intersectionObserver)==null||t.disconnect(),this.stop();for(let s in this.programs)this.removeProgram(s);let i=this.gl;if(i){i.deleteTexture(this.transparentTexture),this.transparentTexture=null,i.deleteTexture(this.defaultTexture),this.defaultTexture=null,this.framebufferStack=new Qs;let s=i.getParameter(i.MAX_VERTEX_ATTRIBS),n=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,n);for(let l=0;l<s;++l)i.disableVertexAttribArray(l),i.vertexAttribPointer(l,4,i.FLOAT,!1,0,0),i.vertexAttrib1f(l,0);i.deleteBuffer(n);let o=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS);for(let l=0;l<o;++l)i.activeTexture(i.TEXTURE0+l),i.bindTexture(i.TEXTURE_CUBE_MAP,null),i.bindTexture(i.TEXTURE_2D,null);i.activeTexture(i.TEXTURE0),i.useProgram(null),i.bindBuffer(i.ARRAY_BUFFER,null),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,null),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindRenderbuffer(i.RENDERBUFFER,null),i.disable(i.BLEND),i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),i.disable(i.DITHER),i.disable(i.SCISSOR_TEST),i.blendColor(0,0,0,0),i.blendEquation(i.FUNC_ADD),i.blendFunc(i.ONE,i.ZERO),i.clearColor(0,0,0,0),i.clearDepth(1),i.clearStencil(-1)}this.canvas&&(this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.canvas.width=1,this.canvas.height=1,this.canvas=null),this.gl=null,this._initialized=!1}addClock(e){e.__handler||(e.__handler=this,this._clocks.push(e))}addClocks(e){for(let t=0;t<e.length;t++)this.addClock(e[t])}removeClock(e){if(e.__handler){let t=this._clocks,i=t.length;for(;i--;)if(t[i].isEqual(e)){e.__handler=null,t.splice(i,1);break}}}}class ba extends ls{constructor(e,t={}){super(e,t),this._internalFormat=t.internalFormat?t.internalFormat.toUpperCase():"RGBA8",this._msaa=t.msaa!=null?t.msaa:4,this._glFilter=0,this.renderbuffers=new Array(this._size)}destroy(){let e=this.handler.gl;if(e){for(let t=0;t<this.renderbuffers.length;t++)e.deleteRenderbuffer(this.renderbuffers[t]);this.renderbuffers=new Array(this._size),e.deleteFramebuffer(this._fbo),e.deleteRenderbuffer(this._depthRenderbuffer),this._depthRenderbuffer=null,this._fbo=null,this._active=!1}}init(){let e=this.handler.gl;if(!e)return;this._glFilter=e[this._filter],this._fbo=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this._fbo);let t=[];for(let i=0;i<this.renderbuffers.length;i++){let s=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,s),this._msaa>0?e.renderbufferStorageMultisample(e.RENDERBUFFER,this._msaa,e[this._internalFormat],this._width,this._height):e.renderbufferStorage(e.RENDERBUFFER,e[this._internalFormat],this._width,this._height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+i,e.RENDERBUFFER,s),t.push(e.COLOR_ATTACHMENT0+i),this.renderbuffers[i]=s,e.bindRenderbuffer(e.RENDERBUFFER,null)}e.drawBuffers(t),this._useDepth&&(this._depthRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,this._depthRenderbuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,this._msaa,e[this._depthComponent],this._width,this._height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,this._depthRenderbuffer),e.bindRenderbuffer(e.RENDERBUFFER,null)),e.bindFramebuffer(e.FRAMEBUFFER,null)}blitTo(e,t=0){let i=this.handler.gl;i.bindFramebuffer(i.READ_FRAMEBUFFER,this._fbo),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,e._fbo),i.readBuffer(i.COLOR_ATTACHMENT0+t),i.clearBufferfv(i.COLOR,0,[0,0,0,1]),i.blitFramebuffer(0,0,this._width,this._height,0,0,e._width,e._height,i.COLOR_BUFFER_BIT,this._glFilter),i.bindFramebuffer(i.FRAMEBUFFER,null),i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,null)}}Object.freeze(Object.defineProperty({__proto__:null,Framebuffer:St,Handler:Me,Multisample:ba,Program:$,types:lt},Symbol.toStringTag,{value:"Module"}));class wa extends Ei{constructor(e,t={}){super(e,t),this._image=t.image||null,this._src=t.src||null,this._onLoad_=null}get instanceName(){return"GeoImage"}abortLoading(){this._image instanceof HTMLImageElement&&(this._image.src="")}setSrc(e){this._planet&&this._planet._geoImageCreator.remove(this),this._src=e,this._sourceReady=!1,this._sourceCreated=!1,this._image=new Image,this._image.crossOrigin="Anonymous",this._onLoad_=this._onLoad.bind(this),this._image.addEventListener("load",this._onLoad_),this._image.src=e}setImage(e){this._planet&&this._planet._geoImageCreator.remove(this),this._sourceCreated=!1,this._sourceReady=!1,this._image=e,this._image.crossOrigin="Anonymous",this._src=e.src,cr(this._image)?this._applyImage(this._image):(this._onLoad_=this._onLoad.bind(this),this._image.addEventListener("load",this._onLoad_))}_createSourceTexture(){!this._sourceCreated&&this._image&&(this._sourceTexture=this._planet.renderer.handler.createTexture_l(this._image),this._sourceCreated=!0)}_onLoad(e){this._applyImage(this._image),this._image instanceof HTMLImageElement&&this._image.removeEventListener("load",this._onLoad_),this._onLoad_=null}_applyImage(e){e&&(this._frameWidth=We(2*e.width,4096),this._frameHeight=We(3*e.height,4096),this._sourceReady=!0,this._planet&&this._planet._geoImageCreator.add(this))}loadMaterial(e){e.isLoading=!0,this._creationProceeding=!0,!this._sourceReady&&this._src?this._image?this._image instanceof HTMLImageElement&&(cr(this._image)?this._applyImage(this._image):(this._onLoad_=this._onLoad.bind(this),this._image.addEventListener("load",this._onLoad_))):(this._image=new Image,this._image.crossOrigin="Anonymous",this._onLoad_=this._onLoad.bind(this),this._image.addEventListener("load",this._onLoad_),this._image.src=this._src):this._planet&&this._planet._geoImageCreator.add(this)}abortMaterialLoading(e){this._image&&this._image instanceof HTMLImageElement&&(this._image.src=""),this._creationProceeding=!1,e.isLoading=!1,e.isReady=!1}}Object.freeze(Object.defineProperty({__proto__:null,AtmosphereConfig:class extends Z{constructor(a={}){super(a),this.$maxOpacity=null,this.$minOpacity=null,this.$rayleight=null,this.$mie=null,this.$height=null,this.$bottomRadius=null,this.$mieScatteringCoefficient=null,this.$mieExtinctionCoefficient=null,this.$rayleighScatteringCoefficientA=null,this.$rayleighScatteringCoefficientB=null,this.$rayleighScatteringCoefficientC=null,this.$ozoneAbsorptionCoefficientA=null,this.$ozoneAbsorptionCoefficientB=null,this.$ozoneAbsorptionCoefficientC=null,this.$sunAngularRadius=null,this.$sunIntensity=null,this.$groundAlbedo=null,this.$ozoneDensityHeight=null,this.$ozoneDensityWide=null,this._toggleBtn=new ct({classList:["og-map-button","og-atmosphere_button"],icon:`<?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg width="800px" height="800px" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path fill="#000000" d="M135.688 18.5c-6.798 74.842-23.842 85.39-107.907 59.656 84.85 52.022 73.57 64.954-6.843 96.938 87.743-10.27 103.29 4.89 70.75 87.594 17.805-27.56 32.5-44.498 46.282-54.47-11.813 28.26-18.345 59.274-18.345 91.813 0 84.184 43.71 157.96 109.656 200.376-41.624-43.834-67.686-102.7-67.686-167.875 0-134.923 109.45-244.405 244.375-244.405 30.92 0 60.76 5.762 88 16.25-38.584-26.87-85.517-42.625-136.064-42.625-55.257 0-106.14 18.802-146.562 50.375 4.627-18.783 17.39-38.073 41.03-60.906C190.18 90.942 153.53 95.634 135.69 18.5zm10.03 77.188c5.67.002 11.428 1.247 16.876 3.874 14.506 6.998 22.72 21.81 22 36.938-10.26 10.87-19.507 22.696-27.594 35.344-9.035 2.753-19.075 2.27-28.25-2.156-19.37-9.343-27.5-32.6-18.156-51.97 6.715-13.92 20.638-22.036 35.125-22.03z"/></svg>`}),this._dialog=new Zt({title:"Atmosphere Parameters",visible:!1,useHide:!0,top:60,left:60,width:720}),this._dialog.events.on("visibility",e=>{this._toggleBtn.setActive(e)}),this._panel=new dt({template:`<div class="og-atmosphere og-options-container">
         
         <div class="og-option og-atmosphere-maxOpacity"></div> 
         <div class="og-option og-atmosphere-minOpacity"></div>
         
       <div class="og-emptyline-2"></div>
         
         <div class="og-option og-atmosphere-rayleight"></div>
         <div class="og-option og-atmosphere-mie"></div>
         
       <div class="og-emptyline-2"></div>
                  
         <div class="og-option og-atmosphere-height"></div> 
         <div class="og-option og-atmosphere-bottomRadius"></div>
         
       <div class="og-emptyline-2"></div>
         
         <div class="og-option og-atmosphere-mieScatteringCoefficient"></div>  
         <div class="og-option og-atmosphere-mieExtinctionCoefficient"></div>
         
       <div class="og-emptyline-2"></div>
         
         <div class="og-option og-atmosphere-rayleighScatteringCoefficientA"></div>    
         <div class="og-option og-atmosphere-rayleighScatteringCoefficientB"></div>    
         <div class="og-option og-atmosphere-rayleighScatteringCoefficientC"></div>
         
       <div class="og-emptyline-2"></div>
         
         <div class="og-option og-atmosphere-ozoneAbsorptionCoefficientA"></div>    
         <div class="og-option og-atmosphere-ozoneAbsorptionCoefficientB"></div>    
         <div class="og-option og-atmosphere-ozoneAbsorptionCoefficientC"></div>
         
       <div class="og-emptyline-2"></div>
         
         <div class="og-option og-atmosphere-ozoneDensityHeight"></div>    
         <div class="og-option og-atmosphere-ozoneDensityWide"></div>    
         
       <div class="og-emptyline-2"></div>
         
         <div class="og-option og-atmosphere-sunAngularRadius"></div> 
         <div class="og-option og-atmosphere-sunIntensity"></div> 
         <div class="og-option og-atmosphere-earthAlbedo"></div>
       
    </div>`}),this._maxOpacity=new K({label:"Max.opacity",max:5}),this._minOpacity=new K({label:"Min.opacity",max:5}),this._rayleight=new K({label:"Rayleight Scale",min:-10,max:10}),this._mie=new K({label:"Mie Scale",min:-10,max:10}),this._height=new K({label:"Height",max:1e6}),this._bottomRadius=new K({label:"Planet Radius",max:31783761571225896e-9}),this._mieScatteringCoefficient=new K({label:"Mie Scattering Coefficient e-6",min:-39.96,max:39.96}),this._mieExtinctionCoefficient=new K({label:"Mie Extinction Coef.e-6",min:4.44*-10,max:10*4.44}),this._rayleighScatteringCoefficientA=new K({label:"Rayleight Scattering Coef A.e-6",min:5.802*-10,max:10*5.802}),this._rayleighScatteringCoefficientB=new K({label:"Rayleight Scattering Coef B.e-6",min:13.558*-10,max:10*13.558}),this._rayleighScatteringCoefficientC=new K({label:"Rayleight Scattering Coef C.e-6",min:-331,max:331}),this._ozoneAbsorptionCoefficientA=new K({label:"Ozone absorbtion Coef A.e-6",min:-6.5,max:6.5}),this._ozoneAbsorptionCoefficientB=new K({label:"Ozone absorbtion Coef B.e-6",min:-6.5,max:18.81}),this._ozoneAbsorptionCoefficientC=new K({label:"Ozone absorbtion Coef C.e-6",min:.085*-10,max:10*.085}),this._ozoneDensityHeight=new K({label:"Ozone Density Height",max:25e5}),this._ozoneDensityWide=new K({label:"Ozone Density Wide",max:25e5}),this._sunAngularRadius=new K({label:"Sun Angular Radius",max:4.685}),this._sunIntensity=new K({label:"Sun Intensity",max:10}),this._groundAlbedo=new K({label:"Earth Albedo",max:.5}),this._parameters={ATMOS_HEIGHT:0,RAYLEIGH_SCALE:0,MIE_SCALE:0,GROUND_ALBEDO:0,BOTTOM_RADIUS:0,rayleighScatteringCoefficient_0:0,rayleighScatteringCoefficient_1:0,rayleighScatteringCoefficient_2:0,mieScatteringCoefficient:0,mieExtinctionCoefficient:0,ozoneAbsorptionCoefficient_0:0,ozoneAbsorptionCoefficient_1:0,ozoneAbsorptionCoefficient_2:0,SUN_ANGULAR_RADIUS:0,SUN_INTENSITY:0,ozoneDensityHeight:0,ozoneDensityWide:0,disableSunDisk:!1}}oninit(){this._toggleBtn.appendTo(this.renderer.div),this._dialog.appendTo(this.renderer.div),this._panel.appendTo(this._dialog.container),this._panel.el&&(this.$height=this._panel.el.querySelector(".og-option.og-atmosphere-height"),this.$maxOpacity=this._panel.el.querySelector(".og-option.og-atmosphere-maxOpacity"),this.$minOpacity=this._panel.el.querySelector(".og-option.og-atmosphere-minOpacity"),this.$rayleight=this._panel.el.querySelector(".og-option.og-atmosphere-rayleight"),this.$mie=this._panel.el.querySelector(".og-option.og-atmosphere-mie"),this.$bottomRadius=this._panel.el.querySelector(".og-option.og-atmosphere-bottomRadius"),this.$mieScatteringCoefficient=this._panel.el.querySelector(".og-option.og-atmosphere-mieScatteringCoefficient"),this.$mieExtinctionCoefficient=this._panel.el.querySelector(".og-option.og-atmosphere-mieExtinctionCoefficient"),this.$rayleighScatteringCoefficientA=this._panel.el.querySelector(".og-option.og-atmosphere-rayleighScatteringCoefficientA"),this.$rayleighScatteringCoefficientB=this._panel.el.querySelector(".og-option.og-atmosphere-rayleighScatteringCoefficientB"),this.$rayleighScatteringCoefficientC=this._panel.el.querySelector(".og-option.og-atmosphere-rayleighScatteringCoefficientC"),this.$ozoneAbsorptionCoefficientA=this._panel.el.querySelector(".og-option.og-atmosphere-ozoneAbsorptionCoefficientA"),this.$ozoneAbsorptionCoefficientB=this._panel.el.querySelector(".og-option.og-atmosphere-ozoneAbsorptionCoefficientB"),this.$ozoneAbsorptionCoefficientC=this._panel.el.querySelector(".og-option.og-atmosphere-ozoneAbsorptionCoefficientC"),this.$sunAngularRadius=this._panel.el.querySelector(".og-option.og-atmosphere-sunAngularRadius"),this.$sunIntensity=this._panel.el.querySelector(".og-option.og-atmosphere-sunIntensity"),this.$groundAlbedo=this._panel.el.querySelector(".og-option.og-atmosphere-earthAlbedo"),this.$ozoneDensityHeight=this._panel.el.querySelector(".og-option.og-atmosphere-ozoneDensityHeight"),this.$ozoneDensityWide=this._panel.el.querySelector(".og-option.og-atmosphere-ozoneDensityWide")),this._toggleBtn.events.on("change",a=>{this._dialog.setVisibility(a)}),this._maxOpacity.appendTo(this.$maxOpacity),this._minOpacity.appendTo(this.$minOpacity),this._height.appendTo(this.$height),this._rayleight.appendTo(this.$rayleight),this._mie.appendTo(this.$mie),this._bottomRadius.appendTo(this.$bottomRadius),this._mieScatteringCoefficient.appendTo(this.$mieScatteringCoefficient),this._mieExtinctionCoefficient.appendTo(this.$mieExtinctionCoefficient),this._rayleighScatteringCoefficientA.appendTo(this.$rayleighScatteringCoefficientA),this._rayleighScatteringCoefficientB.appendTo(this.$rayleighScatteringCoefficientB),this._rayleighScatteringCoefficientC.appendTo(this.$rayleighScatteringCoefficientC),this._ozoneAbsorptionCoefficientA.appendTo(this.$ozoneAbsorptionCoefficientA),this._ozoneAbsorptionCoefficientB.appendTo(this.$ozoneAbsorptionCoefficientB),this._ozoneAbsorptionCoefficientC.appendTo(this.$ozoneAbsorptionCoefficientC),this._sunAngularRadius.appendTo(this.$sunAngularRadius),this._sunIntensity.appendTo(this.$sunIntensity),this._groundAlbedo.appendTo(this.$groundAlbedo),this._ozoneDensityHeight.appendTo(this.$ozoneDensityHeight),this._ozoneDensityWide.appendTo(this.$ozoneDensityWide),this.planet&&(this._parameters=this.planet.atmosphereControl.parameters,this._height.value=this._parameters.ATMOS_HEIGHT,this._rayleight.value=this._parameters.RAYLEIGH_SCALE,this._mie.value=this._parameters.MIE_SCALE,this._bottomRadius.value=this._parameters.BOTTOM_RADIUS,this._mieScatteringCoefficient.value=this._parameters.mieScatteringCoefficient,this._mieExtinctionCoefficient.value=this._parameters.mieExtinctionCoefficient,this._rayleighScatteringCoefficientA.value=this._parameters.rayleighScatteringCoefficient_0,this._rayleighScatteringCoefficientB.value=this._parameters.rayleighScatteringCoefficient_1,this._rayleighScatteringCoefficientC.value=this._parameters.rayleighScatteringCoefficient_2,this._ozoneAbsorptionCoefficientA.value=this._parameters.ozoneAbsorptionCoefficient_0,this._ozoneAbsorptionCoefficientB.value=this._parameters.ozoneAbsorptionCoefficient_1,this._ozoneAbsorptionCoefficientC.value=this._parameters.ozoneAbsorptionCoefficient_2,this._sunAngularRadius.value=this._parameters.SUN_ANGULAR_RADIUS,this._sunIntensity.value=this._parameters.SUN_INTENSITY,this._groundAlbedo.value=this._parameters.GROUND_ALBEDO,this._ozoneDensityHeight.value=this._parameters.ozoneDensityHeight,this._ozoneDensityWide.value=this._parameters.ozoneDensityWide),this._minOpacity.value=this.planet.atmosphereMinOpacity,this._minOpacity.events.on("change",a=>{this.planet.atmosphereMinOpacity=a}),this._maxOpacity.value=this.planet.atmosphereMaxOpacity,this._maxOpacity.events.on("change",a=>{this.planet.atmosphereMaxOpacity=a}),this._rayleight.events.on("change",a=>{this._parameters.RAYLEIGH_SCALE=a,this._update()}),this._mie.events.on("change",a=>{this._parameters.MIE_SCALE=a,this._update()}),this._height.events.on("change",a=>{this._parameters.ATMOS_HEIGHT=a,this._update()}),this._bottomRadius.events.on("change",a=>{this._parameters.BOTTOM_RADIUS=a,this._update()}),this._mieScatteringCoefficient.events.on("change",a=>{this._parameters.mieScatteringCoefficient=a,this._update()}),this._mieExtinctionCoefficient.events.on("change",a=>{this._parameters.mieExtinctionCoefficient=a,this._update()}),this._rayleighScatteringCoefficientA.events.on("change",a=>{this._parameters.rayleighScatteringCoefficient_0=a,this._update()}),this._rayleighScatteringCoefficientB.events.on("change",a=>{this._parameters.rayleighScatteringCoefficient_1=a,this._update()}),this._rayleighScatteringCoefficientC.events.on("change",a=>{this._parameters.rayleighScatteringCoefficient_2=a,this._update()}),this._ozoneAbsorptionCoefficientA.events.on("change",a=>{this._parameters.ozoneAbsorptionCoefficient_0=a,this._update()}),this._ozoneAbsorptionCoefficientB.events.on("change",a=>{this._parameters.ozoneAbsorptionCoefficient_1=a,this._update()}),this._ozoneAbsorptionCoefficientC.events.on("change",a=>{this._parameters.ozoneAbsorptionCoefficient_2=a,this._update()}),this._sunAngularRadius.events.on("change",a=>{this._parameters.SUN_ANGULAR_RADIUS=a,this._update()}),this._sunIntensity.events.on("change",a=>{this._parameters.SUN_INTENSITY=a,this._update()}),this._groundAlbedo.events.on("change",a=>{this._parameters.GROUND_ALBEDO=a,this._update()}),this._ozoneDensityHeight.events.on("change",a=>{this._parameters.ozoneDensityHeight=a,this._update()}),this._ozoneDensityWide.events.on("change",a=>{this._parameters.ozoneDensityWide=a,this._update()})}_update(){this.planet&&this.planet.atmosphereControl.setParameters(this._parameters)}},CameraDepthHandler:class extends Z{constructor(a){super(a),this._skipPreRender=!1,this._depthHandlerCallback=e=>{if(!this.planet)return;let t=e.frameBuffer;if(t.handler.gl,t.activate(),this._quadTreeStrategy){let l=e.camera;this._skipPreRender&&this._quadTreeStrategy.collectRenderNodes(l),this._skipPreRender=!0,console.log(this._quadTreeStrategy._renderedNodes)}t.deactivate(),t.readPixelBuffersAsync();let i=this.getLonLatFromPixelTerrain(1,1),s=this.getLonLatFromPixelTerrain(t.width-1,1),n=this.getLonLatFromPixelTerrain(t.width-1,t.height-1),o=this.getLonLatFromPixelTerrain(1,t.height-1);i&&s&&n&&o&&this.cameraGeoImage.setCorners([[i.lon,i.lat],[s.lon,s.lat],[n.lon,n.lat],[o.lon,o.lat]])},this._frameComposer=new zr,this._frameHandler=null,this.cameraGeoImage=new wa(`cameraGeoImage:${this.__id}`,{src:"test4.jpg",corners:[[0,1],[1,1],[1,0],[0,0]],visibility:!0,isBaseLayer:!1,opacity:.7}),this._quadTreeStrategy=null}_createCamera(){return this.planet?new xa(this.planet,{frustums:[[100,1e9]],width:640,height:480,viewAngle:45}):new Li({frustums:[[100,1e9]],width:640,height:480,viewAngle:45})}get camera(){if(this._frameHandler)return this._frameHandler.camera}oninit(){if(super.oninit(),!this.renderer)return;this.renderer.handler.addProgram(new $("camera_depth",{uniforms:{projectionMatrix:"mat4",viewMatrix:"mat4",height:"float",eyePositionHigh:"vec3",eyePositionLow:"vec3"},attributes:{aVertexPositionHigh:"vec3",aVertexPositionLow:"vec3"},vertexShader:`#version 300 es
            
            precision highp float;

            in vec3 aVertexPositionHigh;
            in vec3 aVertexPositionLow;

            uniform mat4 projectionMatrix;
            uniform mat4 viewMatrix;
            uniform vec3 eyePositionHigh;
            uniform vec3 eyePositionLow;
            uniform float height;

            void main(void) {

                mat4 viewMatrixRTE = viewMatrix;
                viewMatrixRTE[3] = vec4(0.0, 0.0, 0.0, 1.0);

                mat4 m = projectionMatrix * viewMatrixRTE;

                vec3 nh = height * normalize(aVertexPositionHigh + aVertexPositionLow);

                vec3 eyePosition = eyePositionHigh + eyePositionLow;
                vec3 vertexPosition = aVertexPositionHigh + aVertexPositionLow;

                vec3 highDiff = aVertexPositionHigh - eyePositionHigh;
                vec3 lowDiff = aVertexPositionLow - eyePositionLow + nh;
                
                gl_Position =  m * vec4(highDiff * step(1.0, length(highDiff)) + lowDiff, 1.0);    
            }`,fragmentShader:`#version 300 es
            
            precision highp float;        

            layout(location = 0) out vec4 depthColor;

            void main(void) {
                depthColor = vec4(gl_FragCoord.z, gl_FragCoord.z, gl_FragCoord.z, 1.0);
            }`})),this.planet&&this.planet.addLayer(this.cameraGeoImage);let a=new St(this.renderer.handler,{width:640,height:480,targets:[{internalFormat:"RGBA16F",type:"FLOAT",attachment:"COLOR_ATTACHMENT",readAsync:!0}],useDepth:!0});if(this._frameHandler=new Qn({camera:this._createCamera(),frameBuffer:a,frameHandler:this._depthHandlerCallback}),this.renderer.controls.CameraFrameComposer?this._frameComposer=this.renderer.controls.CameraFrameComposer:this.renderer.addControl(this._frameComposer),this._frameComposer.add(this._frameHandler),this.planet){const e={planet:this.planet,maxEqualZoomAltitude:this.planet.quadTreeStrategy.maxEqualZoomAltitude,minEqualZoomAltitude:this.planet.quadTreeStrategy.minEqualZoomAltitude,minEqualZoomCameraSlope:this.planet.quadTreeStrategy.minEqualZoomCameraSlope,transitionOpacityEnabled:!1};this._quadTreeStrategy=new this.planet.quadTreeStrategyPrototype(e),this._quadTreeStrategy.init(this.camera),this._quadTreeStrategy.preRender(),this._quadTreeStrategy.clearRenderedNodes(),this._skipPreRender=!1,this._quadTreeStrategy.preLoad()}}get framebuffer(){if(this._frameHandler)return this._frameHandler.frameBuffer}getCartesianFromPixelTerrain(a,e){if(this._frameHandler){let t=this._frameHandler.frameBuffer,i=this._frameHandler.camera,s=function(l,h,c,d){let u=new N(l,h),f=u.x/d.width,_=(d.height-u.y)/d.height,g=new Float32Array(4),v=0;if(d.readData(f,_,g,0),g[0]===0)return 0;let p=g[0],y=c.frustums[0].inverseProjectionMatrix,b=new tt(2*f-1,2*_-1,2*p-1,1),C=y.mulVec4(b),T=c.unproject(f*c.width,(1-_)*c.height);return v=-C.z/C.w/T.dot(c.getForward()),v}(a,e,i,t);if(s===0)return;let n=a/t.width,o=(t.height-e)/t.height;return i.unproject(n*i.width,(1-o)*i.height).scaleTo(s).addA(i.eye)}}getLonLatFromPixelTerrain(a,e){if(this.planet){let t=this.getCartesianFromPixelTerrain(a,e);if(t)return this.planet.ellipsoid.cartesianToLonLat(t)}}activate(){super.activate()}deactivate(){super.deactivate()}},CameraFrameComposer:zr,CameraFrameHandler:Qn,CameraLock:Kn,CompassButton:Oo,Control:Z,DebugInfo:class extends Z{constructor(a={}){a.name&&a.name!==""||(a.name="DebugInfo"),super(a),this.el=null,this._watch=a.watch||[],this._toggleBtn=new ct({classList:["og-map-button","og-debuginfo_button"],icon:`<?xml version="1.0" encoding="iso-8859-1"?>
<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg fill="#000000" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
	 width="800px" height="800px" viewBox="0 0 932.179 932.179"
	 xml:space="preserve">
<g>
	<path d="M61.2,341.538c4.9,16.8,11.7,33,20.3,48.2l-24.5,30.9c-8,10.1-7.1,24.5,1.9,33.6l42.2,42.2c9.1,9.1,23.5,9.899,33.6,1.899
		l30.7-24.3c15.8,9.101,32.6,16.2,50.1,21.2l4.6,39.5c1.5,12.8,12.3,22.4,25.1,22.4h59.7c12.8,0,23.6-9.601,25.1-22.4l4.4-38.1
		c18.8-4.9,36.8-12.2,53.7-21.7l29.7,23.5c10.1,8,24.5,7.1,33.6-1.9l42.2-42.2c9.1-9.1,9.9-23.5,1.9-33.6l-23.1-29.3
		c9.6-16.601,17.1-34.3,22.1-52.8l35.6-4.1c12.801-1.5,22.4-12.3,22.4-25.1v-59.7c0-12.8-9.6-23.6-22.4-25.1l-35.1-4.1
		c-4.801-18.3-12-35.8-21.199-52.2l21.6-27.3c8-10.1,7.1-24.5-1.9-33.6l-42.1-42.1c-9.1-9.1-23.5-9.9-33.6-1.9l-26.5,21
		c-17.2-10.1-35.601-17.8-54.9-23l-4-34.3c-1.5-12.8-12.3-22.4-25.1-22.4h-59.7c-12.8,0-23.6,9.6-25.1,22.4l-4,34.3
		c-19.8,5.3-38.7,13.3-56.3,23.8l-27.5-21.8c-10.1-8-24.5-7.1-33.6,1.9l-42.2,42.2c-9.1,9.1-9.9,23.5-1.9,33.6l23,29.1
		c-9.2,16.6-16.2,34.3-20.8,52.7l-36.8,4.2c-12.8,1.5-22.4,12.3-22.4,25.1v59.7c0,12.8,9.6,23.6,22.4,25.1L61.2,341.538z
		 M277.5,180.038c54.4,0,98.7,44.3,98.7,98.7s-44.3,98.7-98.7,98.7c-54.399,0-98.7-44.3-98.7-98.7S223.1,180.038,277.5,180.038z"/>
	<path d="M867.699,356.238l-31.5-26.6c-9.699-8.2-24-7.8-33.199,0.9l-17.4,16.3c-14.699-7.1-30.299-12.1-46.4-15l-4.898-24
		c-2.5-12.4-14-21-26.602-20l-41.1,3.5c-12.6,1.1-22.5,11.4-22.9,24.1l-0.799,24.4c-15.801,5.7-30.701,13.5-44.301,23.3
		l-20.799-13.8c-10.602-7-24.701-5-32.9,4.7l-26.6,31.7c-8.201,9.7-7.801,24,0.898,33.2l18.201,19.399
		c-6.301,14.2-10.801,29.101-13.4,44.4l-26,5.3c-12.4,2.5-21,14-20,26.601l3.5,41.1c1.1,12.6,11.4,22.5,24.1,22.9l28.1,0.899
		c5.102,13.4,11.801,26.101,19.9,38l-15.699,23.7c-7,10.6-5,24.7,4.699,32.9l31.5,26.6c9.701,8.2,24,7.8,33.201-0.9l20.6-19.3
		c13.5,6.3,27.699,11,42.299,13.8l5.701,28.2c2.5,12.4,14,21,26.6,20l41.1-3.5c12.6-1.1,22.5-11.399,22.9-24.1l0.9-27.601
		c15-5.3,29.199-12.5,42.299-21.399l22.701,15c10.6,7,24.699,5,32.9-4.7l26.6-31.5c8.199-9.7,7.799-24-0.9-33.2l-18.301-19.399
		c6.701-14.2,11.602-29.2,14.4-44.601l25-5.1c12.4-2.5,21-14,20-26.601l-3.5-41.1c-1.1-12.6-11.4-22.5-24.1-22.9l-25.1-0.8
		c-5.201-14.6-12.201-28.399-20.9-41.2l13.699-20.6C879.4,378.638,877.4,364.438,867.699,356.238z M712.801,593.837
		c-44.4,3.801-83.602-29.3-87.301-73.699c-3.801-44.4,29.301-83.601,73.699-87.301c44.4-3.8,83.602,29.301,87.301,73.7
		C790.301,550.938,757.199,590.138,712.801,593.837z"/>
	<path d="M205,704.438c-12.6,1.3-22.3,11.899-22.4,24.6l-0.3,25.3c-0.2,12.7,9.2,23.5,21.8,25.101l18.6,2.399
		c3.1,11.301,7.5,22.101,13.2,32.301l-12,14.8c-8,9.899-7.4,24.1,1.5,33.2l17.7,18.1c8.9,9.1,23.1,10.1,33.2,2.3l14.899-11.5
		c10.5,6.2,21.601,11.101,33.2,14.5l2,19.2c1.3,12.6,11.9,22.3,24.6,22.4l25.301,0.3c12.699,0.2,23.5-9.2,25.1-21.8l2.3-18.2
		c12.601-3.101,24.601-7.8,36-14l14,11.3c9.9,8,24.101,7.4,33.201-1.5l18.1-17.7c9.1-8.899,10.1-23.1,2.301-33.2L496.6,818.438
		c6.6-11,11.701-22.7,15.201-35l16.6-1.7c12.6-1.3,22.299-11.9,22.4-24.6l0.299-25.301c0.201-12.699-9.199-23.5-21.799-25.1
		l-16.201-2.1c-3.1-12.2-7.699-24-13.699-35l10.1-12.4c8-9.9,7.4-24.1-1.5-33.2l-17.699-18.1c-8.9-9.101-23.102-10.101-33.201-2.3
		l-12.101,9.3c-11.399-6.9-23.6-12.2-36.399-15.8l-1.601-15.7c-1.3-12.601-11.899-22.3-24.6-22.4l-25.3-0.3
		c-12.7-0.2-23.5,9.2-25.101,21.8l-2,15.601c-13.199,3.399-25.899,8.6-37.699,15.399l-12.5-10.2c-9.9-8-24.101-7.399-33.201,1.5
		l-18.2,17.801c-9.1,8.899-10.1,23.1-2.3,33.199l10.7,13.801c-6.2,11-11.1,22.699-14.3,35L205,704.438z M368.3,675.837
		c36.3,0.4,65.399,30.301,65,66.601c-0.4,36.3-30.301,65.399-66.601,65c-36.3-0.4-65.399-30.3-65-66.601
		C302.1,704.538,332,675.438,368.3,675.837z"/>
</g>
</svg>`}),this._dialog=new Zt({title:"Debug Info",visible:!1,useHide:!0,top:120,left:60,width:480}),this._dialog.events.on("visibility",e=>{this._toggleBtn.setActive(e)}),this._canvasTiles=new is("Tile grid",{visibility:!0,isBaseLayer:!1,hideInLayerSwitcher:!0,drawTile:function(e,t){let i,s=document.createElement("canvas"),n=s.getContext("2d");s.width=256,s.height=256,n.clearRect(0,0,s.width,s.height),n.beginPath(),n.rect(0,0,s.width,s.height),n.lineWidth=2,n.strokeStyle="black",n.stroke(),i=e.segment.tileZoom>14?"26":"32",n.fillStyle="black",n.font="normal "+i+"px Verdana",n.textAlign="center",n.fillText(e.segment.tileX+","+e.segment.tileY+","+e.segment.tileZoom,s.width/2,s.height/2),t(s)}})}addWatches(a){for(let e=0;e<a.length;e++)this.addWatch(a[e])}addWatch(a){this._watch.push(a);let e=document.createElement("div");e.classList.add("og-watch-line"),e.innerHTML=`<div class="og-watch-label">${a.label}</div><div class="og-watch-value"></div>`,a.valEl=e.querySelector(".og-watch-value"),this.el.appendChild(e)}oninit(){var a;this._toggleBtn.appendTo(this.renderer.div),this._dialog.appendTo(this.renderer.div),this._toggleBtn.events.on("change",o=>{this._dialog.setVisibility(o)}),this.el=document.createElement("div"),this.el.className="og-debug-info";let e=document.createElement("div");e.classList.add("og-debuginfo_controls"),this.el.appendChild(e);let t=this._watch;this._watch=[];for(let o=0;o<t.length;o++)this.addWatch(t[o]);(a=this._dialog.container)==null||a.appendChild(this.el),this.renderer.events.on("draw",this._frame,this);let i=this.planet;i&&this.addWatches([{label:"Nodes count",frame:()=>i.quadTreeStrategy._renderedNodes.length},{label:"Planet._fadingNodes",frame:()=>i.quadTreeStrategy._fadingNodes.size},{label:"createdNodes",frame:()=>i._createdNodesCount},{label:"indexesCache",frame:()=>i._indexesCacheToRemoveCounter},{label:"distBeforeMemClear",frame:()=>Math.round(i._distBeforeMemClear)},{label:"maxZoom/minZoom",frame:()=>i.quadTreeStrategy.maxCurrZoom+" / "+(i==null?void 0:i.quadTreeStrategy.minCurrZoom)},{label:"viewExtent",frame:()=>i.getViewExtent().toString()},{label:"Mouse distance, m",frame:()=>{let o=i.getCartesianFromMouseTerrain();return o?i.camera.eye.distance(o).toFixed(3):""}},{label:"lodSize",frame:()=>Math.round(i.quadTreeStrategy.lodSize)},{label:"deltaTime/FPS",frame:()=>`<div style="width:70px"><div style="width:20px; float: left;">
                        ${Math.round(i.renderer.handler.deltaTime)}
                        </div> <div style="float: left">
                        ${Math.round(1e3/i.renderer.handler.deltaTime)}
                        </div></div>`},{label:"-------------------------"},{label:"Pitch, deg",frame:()=>(i.camera.getPitch()*Q).toFixed(2)},{label:"Yaw, deg",frame:()=>(i.camera.getYaw()*Q).toFixed(2)},{label:"Roll, deg",frame:()=>(i.camera.getRoll()*Q).toFixed(2)},{label:"Lon, Lat",frame:()=>`<div style="width:190px">${i.camera._lonLat.lon.toFixed(7)}, ${i.camera._lonLat.lon.toFixed(7)}</div>`},{label:"height/alt, m",frame:()=>`<div style="width:190px">${i.camera._lonLat.height.toFixed(2)+" / "+i.camera.getAltitude().toFixed(2)}</div>`},{label:"cam.slope",frame:()=>i.camera.slope.toFixed(3)},{label:"-------------------------"},{label:"_renderCompleted / renderCompletedActivated",frame:()=>`${i.quadTreeStrategy._renderCompleted} / ${i.quadTreeStrategy._renderCompletedActivated}`},{label:"_terrainCompleted / terrainCompletedActivated",frame:()=>`${i.quadTreeStrategy._terrainCompleted} / ${i.quadTreeStrategy._terrainCompletedActivated}`},{label:"PlainWorker",frame:()=>i._plainSegmentWorker.pendingQueue.length},{label:"TileLoader",frame:()=>`${i._tileLoader.loading} ${i._tileLoader.queue.length}`},{label:"TerrainLoader",frame:()=>i.terrain&&!i.terrain.isEmpty?`${i.terrain.loader.loading}  ${i.terrain.loader.queue.length}`:""},{label:"TerrainWorker",frame:()=>i._terrainWorker.pendingQueue.length},{label:"NormalMapCreator",frame:()=>i._normalMapCreator.queueSize},{label:"VectorTileCreator",frame:()=>i._vectorTileCreator.queueSize}]);let s=new ct({classList:["og-debuginfo_controls-button"],icon:`<?xml version="1.0" encoding="utf-8"?>
<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg fill="#000000" width="800px" height="800px" viewBox="-7.5 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg">
<title>lock</title>
<path d="M14.625 15.156h2.094c0.281 0 0.5 0.25 0.5 0.531v11c0 0.281-0.219 0.5-0.5 0.5h-16.219c-0.281 0-0.5-0.219-0.5-0.5v-11c0-0.281 0.219-0.531 0.5-0.531h2.031v-5.125c0-2.875 1.844-5.25 4.688-5.25h2.688c2.875 0 4.719 2.375 4.719 5.25v5.125zM5.188 15.156h6.813v-4.875c0-1.594-1.313-2.938-2.938-2.938h-0.969c-1.594 0-2.906 1.344-2.906 2.938v4.875zM7.156 24h2.906l-0.719-3.156c0.5-0.25 0.844-0.781 0.844-1.375 0-0.906-0.719-1.594-1.594-1.594s-1.563 0.688-1.563 1.594c0 0.594 0.344 1.125 0.844 1.375z"></path>
</svg>`,title:"Lock/Unlock quad tree"});s.appendTo(e),s.events.on("change",o=>{o?i.lockQuadTree():i.unlockQuadTree()});let n=new ct({classList:["og-debuginfo_controls-button"],icon:`<?xml version="1.0"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M 4 4 L 4 8 L 8 8 L 8 4 L 4 4 z M 10 4 L 10 8 L 14 8 L 14 4 L 10 4 z M 16 4 L 16 8 L 20 8 L 20 4 L 16 4 z M 4 10 L 4 14 L 8 14 L 8 10 L 4 10 z M 10 10 L 10 14 L 14 14 L 14 10 L 10 10 z M 16 10 L 16 14 L 20 14 L 20 10 L 16 10 z M 4 16 L 4 20 L 8 20 L 8 16 L 4 16 z M 10 16 L 10 20 L 14 20 L 14 16 L 10 16 z M 16 16 L 16 20 L 20 20 L 20 16 L 16 16 z"/>
</svg>`,title:"Show/Hide grid"});n.appendTo(e),n.events.on("change",o=>{o?this.planet.addLayer(this._canvasTiles):this._canvasTiles.remove()})}_frame(){this._watch.forEach(a=>{a.valEl&&(a.valEl.innerHTML=a.frame?String(a.frame()):"")})}},DrawingControl:Mn,DrawingSwitcher:class extends Z{constructor(a={}){super({name:"DrawingSwitcher",...a}),this.drawingControl=new Mn(a)}oninit(){this.planet.addControl(this.drawingControl),this._createMenu()}onactivate(){this.drawingControl.activate()}ondeactivate(){this.drawingControl.deactivate()}_createMenu(){let a=new ct({classList:["og-map-button","og-drawing-default_button"],icon:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M4 0l16 12.279-6.951 1.17 4.325 8.817-3.596 1.734-4.35-8.879-5.428 4.702z"/></svg>',name:"default",isActive:!0}),e=new ct({classList:["og-map-button","og-drawing-polygon_button"],icon:`<?xml version="1.0" encoding="utf-8"?>
<!-- Generator: Adobe Illustrator 24.1.3, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
<svg version="1.1" id="Layer_2" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	 viewBox="0 0 1024 1024" style="enable-background:new 0 0 1024 1024;" xml:space="preserve">
<g>
	<path d="M926.03,321.16c-16.02,0-31.11,3.94-44.48,10.79l-263.43-191.4c2.69-8.94,4.18-18.4,4.18-28.2
		c0-54.02-43.95-97.97-97.97-97.97c-54.03,0-97.98,43.95-97.98,97.97c0,9.81,1.49,19.27,4.18,28.21L155.75,340.18
		c-16.22-11.91-36.16-19.03-57.78-19.03C43.95,321.16,0,365.11,0,419.13c0,52.58,41.67,95.5,93.71,97.75l102.63,315.86
		c-24.28,17.85-40.13,46.52-40.13,78.9c0,54.02,43.95,97.98,97.98,97.98c37.54,0,70.18-21.25,86.62-52.34h367.26
		c16.44,31.08,49.08,52.34,86.63,52.34c54.03,0,97.98-43.95,97.98-97.98c0-32.46-15.94-61.21-40.33-79.05l104.11-320.4
		c39.15-12.84,67.54-49.68,67.54-93.07C1024,365.11,980.05,321.16,926.03,321.16z M828.05,911.65c0,8.5-3.3,16.19-8.55,22.09
		c-6.11,6.85-14.9,11.26-24.79,11.26c-13.65,0-25.37-8.26-30.52-20.02c-1.79-4.09-2.82-8.58-2.82-13.33
		c0-18.39,14.95-33.35,33.34-33.35c2.93,0,5.72,0.5,8.43,1.21c13.27,3.49,23.21,14.91,24.59,28.9
		C827.83,909.5,828.05,910.54,828.05,911.65z M790.48,813.89c-45.63,1.96-83.27,35.16-91.87,78.77H350.28
		c-8.62-43.69-46.38-76.93-92.11-78.79L155.59,498.19c24.41-17.84,40.36-46.59,40.36-79.06c0-8.9-1.3-17.49-3.53-25.7L468.57,192.8
		c15.84,11.01,35.05,17.52,55.76,17.52c20.71,0,39.92-6.5,55.76-17.52l256.56,186.4c-5.48,12.21-8.59,25.7-8.59,39.93
		c0,41.02,25.36,76.17,61.21,90.75L790.48,813.89z M254.19,945c-10.11,0-19.07-4.62-25.19-11.75c-5.01-5.84-8.15-13.32-8.15-21.6
		c0-0.91,0.2-1.76,0.27-2.66c1.14-14.18,11.08-25.8,24.43-29.41c2.78-0.75,5.64-1.28,8.65-1.28c18.38,0,33.33,14.96,33.33,33.35
		c0,4.74-1.03,9.24-2.82,13.33C279.55,936.74,267.83,945,254.19,945z M64.88,421.49c-0.06-0.79-0.24-1.55-0.24-2.35
		c0-16.41,11.93-30.01,27.55-32.76c1.89-0.33,3.8-0.58,5.78-0.58c11.94,0,22.35,6.36,28.24,15.81c3.18,5.11,5.11,11.09,5.11,17.53
		c0,15.47-10.63,28.39-24.94,32.14c-2.7,0.71-5.48,1.2-8.4,1.2C80.4,452.47,66.11,438.76,64.88,421.49z M549.41,90.62
		c5.07,5.85,8.25,13.39,8.25,21.72c0,7.32-2.44,14.03-6.45,19.54c-6.07,8.33-15.82,13.81-26.88,13.81
		c-11.07,0-20.83-5.48-26.89-13.81c-4.01-5.51-6.45-12.22-6.45-19.54c0-8.33,3.17-15.86,8.24-21.71
		c6.12-7.07,15.04-11.64,25.1-11.64C534.38,79,543.29,83.57,549.41,90.62z M959.36,419.13c0,11.94-6.36,22.35-15.82,28.24
		c-5.1,3.18-11.07,5.1-17.52,5.1c-6.08,0-11.71-1.76-16.62-4.61c-9.71-5.64-16.33-15.94-16.64-27.89c-0.01-0.29-0.09-0.56-0.09-0.85
		c0-11.75,6.14-22.05,15.36-28c5.2-3.35,11.35-5.35,17.99-5.35C944.41,385.78,959.36,400.75,959.36,419.13z"/>
</g>
</svg>`,name:"polygon"}),t=new ct({classList:["og-map-button","og-drawing-linestring_button"],icon:`<?xml version="1.0" encoding="utf-8"?><!-- License: MIT. Made by Esri: https://github.com/Esri/calcite-ui-icons -->
    <svg width="800px" height="800px" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 6h.046l-5.25 9h-.944L10 9.455V7H7v2.926L1.862 18H0v3h3v-2.926L8.138 10h1.01L14 15.545V18h3v-3h-.046l5.25-9H24V3h-3zM8 8h1v1H8zM2 20H1v-1h1zm14-3h-1v-1h1zm7-13v1h-1V4z"/></svg>`,name:"linestring"});new Uo({buttons:[a,e,t]}).events.on("change",i=>{switch(this.drawingControl.deactivate(),i.name){case"polygon":this.drawingControl.activatePolygonDrawing();break;case"linestring":this.drawingControl.activateLineStringDrawing()}}),a.appendTo(this.renderer.div),e.appendTo(this.renderer.div),t.appendTo(this.renderer.div)}},EarthCoordinates:ha,ElevationProfileControl:class extends Z{constructor(a={}){super({name:"ElevationProfileControl",...a}),this._onSceneChange=()=>{this._collectProfileThrottled()},this._onElevationProfilePointer=(e,t,i,s,n,o,l,h)=>{let c=this._elevationProfileScene.getPointLonLat(o),d=this._elevationProfileScene.getPointLonLat(o+1),u=this.planet.ellipsoid.lonLatToCartesian(c),f=this.planet.ellipsoid.lonLatToCartesian(d),_=(e-t[0])/(i[0]-t[0]),g=f.sub(u);this._elevationProfileScene.setPointerCartesian3v(u.add(g.scale(_)),h)},this._onElevationProfileDblClick=(e,t,i,s,n,o,l,h)=>{let c=this._elevationProfileScene.getPointLonLat(o),d=this._elevationProfileScene.getPointLonLat(o+1),u=this.planet.ellipsoid.lonLatToCartesian(c),f=this.planet.ellipsoid.lonLatToCartesian(d),_=(e-t[0])/(i[0]-t[0]),g=f.sub(u),v=u.add(g.scale(_));this.planet.camera.flyDistance(v,this.planet.camera.eye.distance(v))},this._onElevationProfileMouseEnter=()=>{this._elevationProfileView.model.pointsReady&&this._elevationProfileScene.setPointerVisibility(!0)},this._onElevationProfileMouseLeave=()=>{},this._elevationProfileScene=new th,this._elevationProfileView=new Yl,this._elevationProfileLegend=new nh,this._elevationProfileButtonsView=new sh({model:this._elevationProfileView.model}),this._elevationProfileView.events.on("pointer",this._onElevationProfilePointer),this._elevationProfileView.events.on("dblclick",this._onElevationProfileDblClick),this._elevationProfileView.events.on("mouseenter",this._onElevationProfileMouseEnter),this._elevationProfileView.events.on("mouseleave",this._onElevationProfileMouseLeave),this._dialog=new Zt({title:"Elevation Profile",visible:!1,resizable:!0,useHide:!0,top:175,left:65,width:400,height:200,minHeight:100,minWidth:100}),this._graphView=new dt({template:`<div class="og-elevationprofile__container">
      <div class="og-elevationprofile__menu"></div>
      <div class="og-elevationprofile__graph"></div>
    </div>`}),this._poiListDialog=new rh({model:this._elevationProfileScene}),this._toggleBtn=new ct({classList:["og-map-button","og-elevationprofile_button"],icon:'<svg style="width: 2em; height: 2em;" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg"><path d="M128 896v-158.293333l331.946667-191.573334 160.853333 93.866667L896 480V896H128M896 381.44l-275.2 159.146667-160.853333-92.586667L128 640v-94.293333l331.946667-191.573334 160.853333 93.866667L896 288v93.44z" fill="" /></svg>'}),this._collectProfileThrottled=vi(()=>{let e=this._elevationProfileScene.getPointsLonLat();this._elevationProfileView.model.collectProfile(e)},250)}oninit(){this._dialog.appendTo(this.planet.renderer.div),this._graphView.appendTo(this._dialog.container),this._toggleBtn.appendTo(this.renderer.div),this._dialog.events.on("visibility",a=>{this._toggleBtn.setActive(a),a?(this.activate(),this._elevationProfileView.resize()):this.deactivate()}),this._toggleBtn.events.on("change",a=>{this._dialog.setVisibility(a)}),this._elevationProfileView.appendTo(this._graphView.select(".og-elevationprofile__graph")),this._elevationProfileView.model.bindPlanet(this.planet),this._elevationProfileView.model.events.on("clear",()=>{this._elevationProfileScene.clear(),this._elevationProfileLegend.clear()}),this._elevationProfileView.model.events.on("startcollecting",()=>{this._elevationProfileScene.setPointerVisibility(!1)}),this._elevationProfileView.events.on("tracklength",a=>{this._elevationProfileLegend.setTrackLength(a)}),this._elevationProfileView.events.on("groundlength",a=>{this._elevationProfileLegend.setGroundLength(a)}),this._elevationProfileView.events.on("warninglength",a=>{this._elevationProfileLegend.setWarningLength(a)}),this._elevationProfileView.events.on("collisionlength",a=>{this._elevationProfileLegend.setCollisionLength(a)}),this._poiListDialog.appendTo(this.planet.renderer.div),this._poiListDialog.events.on("visibility",a=>{this._elevationProfileButtonsView.pointListBtn.setActive(a,!0)}),this._elevationProfileLegend.appendTo(this._graphView.select(".og-elevationprofile__menu")),this._elevationProfileButtonsView.appendTo(this._graphView.select(".og-elevationprofile__menu")),this._elevationProfileButtonsView.events.on("list",a=>{this._poiListDialog.setVisibility(a)}),this._elevationProfileButtonsView.events.on("location",a=>{this._elevationProfileScene.flyExtent()}),this._elevationProfileButtonsView.events.on("reset",a=>{this._elevationProfileScene.setPointerVisibility(!1)}),this._elevationProfileScene.events.on("change",this._onSceneChange)}onactivate(){this.planet&&this._elevationProfileScene.bindPlanet(this.planet),this.renderer&&this.renderer.addNode(this._elevationProfileScene)}ondeactivate(){this._poiListDialog.setVisibility(!1),this._elevationProfileView.model.clear(),this.renderer&&this.renderer.removeNode(this._elevationProfileScene),this._dialog.hide()}},FramebufferPreview:class extends Z{constructor(a){super({autoActivate:!0,...a}),this._onDraw=()=>{if(this._framebuffer&&this._screenFramebuffer){let e=this.renderer,t=e.handler.gl;t.disable(t.BLEND),this._screenFramebuffer.activate();let i=this._program._programController,s=i._program;t.bindBuffer(t.ARRAY_BUFFER,e.screenFramePositionBuffer),t.vertexAttribPointer(s.attributes.corners,2,t.FLOAT,!1,0,0),i.activate(),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this._framebuffer.textures[this.framebufferCurrentTexture]),t.uniform1i(s.uniforms.inputTexture,0),t.drawArrays(t.TRIANGLE_STRIP,0,4),this._screenFramebuffer.deactivate(),t.enable(t.BLEND),this._screenFramebuffer.readPixelBuffersAsync(n=>{let o=n.getPixelBufferData();if(o){let l=n.width,h=n.height,c=this.$canvas.getContext("2d"),d=new Uint8ClampedArray(o.buffer,o.byteOffset,o.byteLength),u=new ImageData(d,l,h);createImageBitmap(u).then(f=>{c.clearRect(0,0,this.$canvas.width,this.$canvas.height),c.drawImage(f,0,0,this.$canvas.width,this.$canvas.height)})}})}},this._dialog=new Zt({title:a.title||"",width:580,height:340,left:100,top:100}),this.$canvas=function(e,t){let i=document.createElement("canvas");return i.width=e,i.height=t,i.style.position="absolute",i.style.width="100%",i.style.height="100%",i}(this._dialog.width,this._dialog.height),this._framebuffer=a.framebuffer||null,this._screenFramebuffer=null,this.framebufferCurrentTexture=0,this._program=function(e=0,t,i,s){return new $(`framebuffer_dialog_screen:${e.toString()}`,{uniforms:{inputTexture:"sampler2D"},attributes:{corners:"vec2"},vertexShader:`#version 300 es
            
            in vec2 corners;
            
            out vec2 tc;

            void main(void) {
                gl_Position = vec4(corners, 0.0, 1.0);
                tc = corners * 0.5 + 0.5;
                ${s?"tc.y = 1.0 - tc.y;":""}               
            }`,fragmentShader:`#version 300 es

            precision highp float;

            uniform sampler2D inputTexture;
           
            in vec2 tc;

            layout(location = 0) out vec4 fragColor;

            ${t||""}
            
            ${i||`void mainImage(out vec4 fragColor, in vec2 fragCoord) { 
                fragColor = texture(inputTexture, fragCoord);
            }`}
            
            void main(void) {                              
               mainImage(fragColor, tc);
            }`})}(this.__id,a.common,a.image,a.flippedUV)}bindFramebuffer(a){a.isEqual(this._framebuffer)||(this._framebuffer=a)}oninit(){var a,e;super.oninit(),this.renderer&&(this.renderer.handler.addProgram(this._program),this._screenFramebuffer=new St(this.renderer.handler,{width:(a=this._framebuffer)==null?void 0:a.width,height:(e=this._framebuffer)==null?void 0:e.height,useDepth:!1,targets:[{internalFormat:"RGBA",type:"UNSIGNED_BYTE",attachment:"COLOR_ATTACHMENT",readAsync:!0}]}),this._screenFramebuffer.init())}activate(){var a,e;super.activate(),this._dialog.appendTo(document.body),(a=this._dialog.container)==null||a.appendChild(this.$canvas),(e=this.renderer)==null||e.events.on("draw",this._onDraw)}deactivate(){var a;super.deactivate(),this._dialog.remove(),(a=this.renderer)==null||a.events.off("draw",this._onDraw)}},GeoImageDragControl:class extends Z{constructor(a={}){super(a),this._cornerIndex=-1,this._catchCorner=!1,this._toggleBtn=new ct({classList:["og-map-button","og-geoimagegrag_button"],icon:'<?xml version="1.0" encoding="UTF-8" standalone="no"?> <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24"><path d="M16 13l6.964 4.062-2.973.85 2.125 3.681-1.732 1-2.125-3.68-2.223 2.15L16 13zm-2-7h2v2h5a1 1 0 0 1 1 1v4h-2v-3H10v10h4v2H9a1 1 0 0 1-1-1v-5H6v-2h2V9a1 1 0 0 1 1-1h5V6zM4 14v2H2v-2h2zm0-4v2H2v-2h2zm0-4v2H2V6h2zm0-4v2H2V2h2zm4 0v2H6V2h2zm4 0v2h-2V2h2zm4 0v2h-2V2h2z" fill="#000"/></svg>'})}oninit(){this._toggleBtn.appendTo(this.renderer.div),this.planet.events.on("layeradd",a=>{this.isActive()&&this._bindLayer(a)},this),this._toggleBtn.events.on("change",a=>{a?this.activate():this.deactivate()})}onactivate(){super.onactivate();const a=this.planet;for(let e=0;e<a.layers.length;e++)this._bindLayer(a.layers[e])}ondeactivate(){super.ondeactivate();const a=this.planet;for(let e=0;e<a.layers.length;e++)this._unbindLayer(a.layers[e])}_bindLayer(a){a instanceof Ei&&(a.events.on("mousemove",this._onMouseMove,this),a.events.on("mouseleave",this._onMouseLeave,this),a.events.on("ldown",this._onLDown,this),a.events.on("lup",this._onLUp,this))}_unbindLayer(a){a instanceof Ei&&(a.events.off("mousemove",this._onMouseMove),a.events.off("mouseleave",this._onMouseLeave),a.events.off("ldown",this._onLDown),a.events.off("lup",this._onLUp))}_onLUp(a){this._catchCorner=!1,a.renderer.controls.navigation.activate()}_onLDown(a){this._cornerIndex!==-1&&(this._catchCorner=!0,a.renderer.controls.navigation.deactivate())}_onMouseLeave(){document.body.style.cursor="auto"}_onMouseMove(a){let e=a.pickingObject;const t=this.planet;if(this._catchCorner){let i=e.getCornersLonLat();i[this._cornerIndex]=t.getLonLatFromPixelTerrain(a),e.setCornersLonLat(i)}else{this._cornerIndex=-1;for(let i=0;i<e._cornersWgs84.length;i++){let s=t.getLonLatFromPixelTerrain(a);if(s&&t.ellipsoid.getGreatCircleDistance(e._cornersWgs84[i],s)/t.getDistanceFromPixel(a)<=.05){this._cornerIndex=i,document.body.style.cursor="move";break}document.body.style.cursor="auto"}}}},GeoObjectEditor:class extends Z{constructor(a={}){super(a),this._geoObjectEditopScene=new _h({name:`geoObjectEditorScene:${this.__id}`}),this._dialog=new vh({model:this._geoObjectEditopScene})}oninit(){this.renderer&&(this.renderer.addControl(new Kn({planet:this.planet})),this._geoObjectEditopScene.bindPlanet(this.planet),this._dialog.appendTo(this.renderer.div||document.body),this.activate())}onactivate(){this.renderer&&this.renderer.addNode(this._geoObjectEditopScene)}ondeactivate(){this.renderer&&this.renderer.removeNode(this._geoObjectEditopScene),this._dialog.hide()}},HeightRuler:On,KeyboardNavigation:class extends Z{constructor(a={}){a=a||{},super({name:"KeyboardNavigation",...a}),this.onCameraPitchUp=()=>{this._camera&&this._camera.setPitch(this._camera.getPitch()+.1*G)},this.onCameraPitchDown=()=>{this._camera&&this._camera.setPitch(this._camera.getPitch()-.1*G)},this.onCameraYawLeft=()=>{this._camera&&this._camera.setYaw(this._camera.getYaw()-.1*G)},this.onCameraYawRight=()=>{this._camera&&this._camera.setYaw(this._camera.getYaw()+.1*G)},this.onCameraMoveForward=()=>{this._camera&&this.force.addA(this._camera.getForward()).normalize()},this.onCameraMoveBackward=()=>{this._camera&&this.force.addA(this._camera.getBackward()).normalize()},this._camera=a.camera||null,this.speed=a.speed||10,this.force=new m,this.vel=new m,this.mass=1}bindCamera(a){this._camera=a}onactivate(){let a=this.renderer;a.events.on("keypress",Y.KEY_S,this.onCameraMoveBackward,this),a.events.on("keypress",Y.KEY_W,this.onCameraMoveForward,this),a.events.on("keypress",Y.KEY_UP,this.onCameraPitchUp,this),a.events.on("keypress",Y.KEY_DOWN,this.onCameraPitchDown,this),a.events.on("keypress",Y.KEY_LEFT,this.onCameraYawLeft,this),a.events.on("keypress",Y.KEY_RIGHT,this.onCameraYawRight,this),a.events.on("draw",this.onDraw,this,-1e3)}ondeactivate(){this.renderer}oninit(){this.activate()}get dt(){return .001*this.renderer.handler.deltaTime}onDraw(){if(this.renderer&&this._camera){let a=this.force.scale(1/this.mass);this.vel.addA(a),this.vel.scale(.96),this.force.set(0,0,0);let e=this._camera;e.eye=e.eye.add(this.vel.scaleTo(this.dt)),e.update()}}},LayerAnimation:class extends Z{constructor(a={}){super(a),this._currVisibleIndex=0,this._onViewchange=()=>{this._timeoutStart=performance.now()},this._onVisibilityChange=e=>{e||this.pause()},this._onLayerLoadend=e=>{let t=this._layersArr[this._currentIndex];if(t&&t.isEqual(e)){let i=this._getFrameIndex(this._currentIndex)*this._frameSize,s=this._currentIndex;for(let o=i;o<s;o++){let l=this._layersArr[o];l.opacity=0,l.setVisibility(!1)}t.opacity=1;let n=this._layersArr[this._currVisibleIndex];if(n){n.opacity=0,n.setVisibility(!1);let o=this._getFrameIndex(this._currVisibleIndex);this._getFrameIndex(this._currentIndex)!==o&&this._removeFrameFromPlanet(o)}this.events.dispatch(this.events.idle,t)}},this.events=at(bl),this._name=a.name||`layerAnimation-${this.__id}`,this._layersArr=a.layers?[].concat(a.layers):[],this._currentIndex=-1,this._playInterval=a.playInterval||120,this._playIntervalHandler=-1,this._playIndex=0,this._frameSize=a.frameSize||50,this.repeat=a.repeat==null||a.repeat,this.skipTimeout=a.skipTimeout||5e3,this._timeoutStart=0}_getFramesNum(){return Math.ceil(this._layersArr.length/this._frameSize)}_setFrame(a){for(let e=0,t=this._getFramesNum();e<t;e++)e!==a?this._removeFrameFromPlanet(e):this._appendFrameToPlanet(e)}_getFrameIndex(a){return Math.floor(a/this._frameSize)}_appendFrameToPlanet(a){if(this.planet){let e=a*this._frameSize,t=e+this._frameSize;for(let i=e,s=t>this._layersArr.length?this._layersArr.length:t;i<s;i++)this.planet.addLayer(this._layersArr[i])}}_removeFrameFromPlanet(a){if(this.planet){let e=a*this._frameSize,t=e+this._frameSize;for(let i=e,s=t>this._layersArr.length?this._layersArr.length:t;i<s;i++)this._layersArr[i].abortLoading(),this._layersArr[i].remove(),this._layersArr[i].setVisibility(!1)}}oninit(){super.oninit(),this.onactivate(),this._initLayers(),this.planet.events.on("layerloadend",this._onLayerLoadend),this._setCurrentIndexAsync(0,!1,!0)}onactivate(){super.onactivate(),this.planet.camera.events.on("viewchange",this._onViewchange),this.planet.renderer.handler.events.on("visibilitychange",this._onVisibilityChange)}ondeactivate(){super.ondeactivate(),this.planet.camera.events.off("viewchange",this._onViewchange);for(let a=0;a<this._layersArr.length;a++)this._layersArr[a].setVisibility(!1);this.planet.events.off("layerloadend",this._onLayerLoadend),this.planet.renderer.handler.events.off("visibilitychange",this._onVisibilityChange)}clear(){this.stop(),this._currentIndex=-1,this._currVisibleIndex=-1;let a=this._layersArr;this._layersArr=[];for(let e=0;e<a.length;e++)a[e].remove()}_initLayers(){if(this.planet){for(let a=0,e=this._layersArr.length;a<e;a++){let t=this._layersArr[a];t.setVisibility(!1),t.setBaseLayer(!1),t.opacity=0}this._appendFrameToPlanet(0)}}setLayers(a){this.clear(),this._layersArr=[].concat(a),this._initLayers()}appendLayer(a){var e;this._layersArr.push(a),a.setVisibility(!1),a.setBaseLayer(!1),a.opacity=0,(e=this.planet)==null||e.addLayer(a)}get isIdle(){let a=this._layersArr[this._currentIndex];return a&&a.isIdle||!a}get playInterval(){return this._playInterval}set playInterval(a){a!==this._playInterval&&(this._playInterval=a,this.isPlaying&&(this.pause(),this.play()))}get isPlaying(){return this._playIntervalHandler!==-1}get layers(){return this._layersArr}_checkEnd(){this._playIndex>this._layersArr.length&&(this.repeat?this._playIndex=0:this.pause())}play(){this.isPlaying||(this._currentIndex>=this._layersArr.length-1&&this.stop(),this._timeoutStart=performance.now(),this._playIntervalHandler=setInterval(()=>{this._checkEnd(),this._setCurrentIndexAsync(this._playIndex,!1,!1),requestAnimationFrame(()=>{(this.isIdle||performance.now()-this._timeoutStart>this.skipTimeout)&&(this._playIndex++,this._timeoutStart=performance.now())})},this._playInterval),this.events.dispatch(this.events.play))}stop(){this._playIndex>0&&(this._clearInterval(),this._playIndex=0,this.setCurrentIndex(0),this.events.dispatch(this.events.stop))}pause(){this.isPlaying&&(this._clearInterval(),this.events.dispatch(this.events.pause))}_clearInterval(){clearInterval(this._playIntervalHandler),this._playIntervalHandler=-1}setCurrentIndex(a,e=!1){this._setCurrentIndexAsync(a,!0,e)}_setCurrentIndexAsync(a,e=!1,t=!1){if(a!=this._currentIndex&&a>=0&&a<this._layersArr.length){let i=this._currentIndex;this._currentIndex=a,this._playIndex=a;let s=this._getFrameIndex(i),n=this._getFrameIndex(this._currentIndex),o=this._layersArr[i],l=this._layersArr[a],h=n!=s;h&&this._appendFrameToPlanet(n),o&&(o.isIdle?this._currVisibleIndex=i:(o.opacity=0,o.setVisibility(!1))),l&&(l.opacity=0,l.setVisibility(!0),requestAnimationFrame(()=>{if(l.isIdle||e){l.opacity=1,h&&this._removeFrameFromPlanet(s),o&&(o.opacity=0,o.setVisibility(!1));let c=this._layersArr[this._currVisibleIndex];c&&(c.opacity=0,c.setVisibility(!1))}}),t||this.events.dispatch(this.events.change,this._currentIndex,i))}}},LayerSwitcher:class extends Z{constructor(a={}){super({name:"LayerSwitcher",...a}),this.addLayer=e=>{if(!e.hideInLayerSwitcher){let t=this._createLayerButton(e);this._layerViews.push(t),e.isBaseLayer()?t.appendTo(this.$baseLayers):t.appendTo(this.$overlays)}},this.removeLayer=e=>{for(let t=0;t<this._layerViews.length;t++){let i=this._layerViews[t];if(i.model.isEqual(e)){i.remove(),this._layerViews.splice(t,1);break}}},this._dialog=new Zt({title:"Layer Switcher",top:15,useHide:!0,visible:!1,width:300,maxHeight:500}),this._panel=new dt({template:`<div class="og-layerSwitcher">
      <div class="og-layerSwitcher__title">Base Layers</div>
      <div class="og-layerSwitcher__list og-layerSwitcher__baseLayers"></div>        
        
      <div class="og-layerSwitcher__title">Overlays</div>
      <div class="og-layerSwitcher__list og-layerSwitcher__overlays"></div>
         
    </div>`}),this._toggleBtn=new ct({classList:["og-map-button","og-layerSwitcher_button"],icon:`<?xml version="1.0" encoding="utf-8"?>
<!-- Svg Vector Icons : http://www.onlinewebfonts.com/icon -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve">
<metadata> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata>
<g><path d="M500,573.5c-3.2,0-6.5-0.6-9.5-1.9L25,375.6c-9.1-3.8-15-12.7-15-22.6s5.9-18.8,15-22.6l465.5-196c6.1-2.5,12.9-2.5,19,0l465.5,196c9.1,3.8,15,12.7,15,22.6s-5.9,18.8-15,22.6l-465.5,196C506.5,572.9,503.2,573.5,500,573.5L500,573.5z M97.6,353L500,522.4L902.4,353L500,183.6L97.6,353L97.6,353z"/><path d="M500,720.5c-3.2,0-6.5-0.6-9.5-1.9L25,522.6c-12.4-5.2-18.3-19.6-13.1-32.1c5.2-12.5,19.6-18.3,32.1-13.1l456,192l456-192c12.4-5.2,26.9,0.6,32.1,13.1s-0.6,26.9-13.1,32.1l-465.5,196C506.5,719.9,503.2,720.5,500,720.5L500,720.5z"/><path d="M500,867.5c-3.2,0-6.5-0.6-9.5-1.9L25,669.6c-12.4-5.2-18.3-19.6-13.1-32.1c5.2-12.5,19.6-18.3,32.1-13.1l456,192l456-192c12.4-5.2,26.9,0.6,32.1,13.1c5.2,12.5-0.6,26.8-13.1,32.1l-465.5,196C506.5,866.9,503.2,867.5,500,867.5L500,867.5z"/></g>
</svg>`}),this.$baseLayers=null,this.$overlays=null,this._layerViews=[]}oninit(){this._toggleBtn.appendTo(this.renderer.div),this._dialog.appendTo(this.planet.renderer.div),this._panel.appendTo(this._dialog.container),this.$baseLayers=this._panel.el.querySelector(".og-layerSwitcher__baseLayers"),this.$overlays=this._panel.el.querySelector(".og-layerSwitcher__overlays"),this._dialog.setPosition(this.planet.renderer.div.clientWidth-this._dialog.width-67),this._dialog.events.on("visibility",a=>{this._toggleBtn.setActive(a)}),this._toggleBtn.events.on("change",a=>{this._dialog.setVisibility(a)}),this.planet.events.on("layeradd",this.addLayer,this),this.planet.events.on("layerremove",this.removeLayer,this),this._initLayers()}_initLayers(){let a=this.planet.layers;for(let e=0;e<a.length;e++)this.addLayer(a[e])}_createLayerButton(a){return new wl({model:a})}onactivate(){}ondeactivate(){this._dialog.hide()}},Lighting:class extends Z{constructor(a={}){super(a),this._selectedLayer=null,this._toggleBtn=new ct({classList:["og-map-button","og-lighting_button"],icon:`<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="256" height="256" viewBox="0 0 256 256" xml:space="preserve">

<defs>
</defs>
<g style="stroke: none; stroke-width: 0; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; opacity: 1;" transform="translate(1.4065934065934016 1.4065934065934016) scale(2.81 2.81)" >
	<path d="M 45 68 c -12.682 0 -23 -10.317 -23 -23 c 0 -12.682 10.318 -23 23 -23 c 12.683 0 23 10.318 23 23 C 68 57.683 57.683 68 45 68 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
	<path d="M 45 17.556 c -1.657 0 -3 -1.343 -3 -3 V 3 c 0 -1.657 1.343 -3 3 -3 c 1.657 0 3 1.343 3 3 v 11.556 C 48 16.212 46.657 17.556 45 17.556 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
	<path d="M 45 90 c -1.657 0 -3 -1.343 -3 -3 V 75.444 c 0 -1.657 1.343 -3 3 -3 c 1.657 0 3 1.343 3 3 V 87 C 48 88.657 46.657 90 45 90 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
	<path d="M 14.556 48 H 3 c -1.657 0 -3 -1.343 -3 -3 c 0 -1.657 1.343 -3 3 -3 h 11.556 c 1.657 0 3 1.343 3 3 C 17.556 46.657 16.212 48 14.556 48 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
	<path d="M 87 48 H 75.444 c -1.657 0 -3 -1.343 -3 -3 c 0 -1.657 1.343 -3 3 -3 H 87 c 1.657 0 3 1.343 3 3 C 90 46.657 88.657 48 87 48 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
	<path d="M 66.527 26.473 c -0.768 0 -1.535 -0.293 -2.121 -0.878 c -1.172 -1.172 -1.172 -3.071 0 -4.243 l 8.171 -8.171 c 1.172 -1.172 3.07 -1.171 4.242 0 c 1.172 1.172 1.172 3.071 0 4.243 l -8.171 8.171 C 68.063 26.18 67.295 26.473 66.527 26.473 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
	<path d="M 15.302 77.698 c -0.768 0 -1.536 -0.293 -2.121 -0.879 c -1.172 -1.171 -1.172 -3.071 0 -4.242 l 8.171 -8.171 c 1.171 -1.172 3.071 -1.172 4.242 0 c 1.172 1.171 1.172 3.071 0 4.242 l -8.171 8.171 C 16.837 77.405 16.069 77.698 15.302 77.698 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
	<path d="M 23.473 26.473 c -0.768 0 -1.536 -0.293 -2.121 -0.878 l -8.171 -8.171 c -1.172 -1.172 -1.172 -3.071 0 -4.243 c 1.172 -1.172 3.072 -1.171 4.243 0 l 8.171 8.171 c 1.172 1.172 1.172 3.071 0 4.243 C 25.008 26.18 24.24 26.473 23.473 26.473 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
	<path d="M 74.698 77.698 c -0.768 0 -1.535 -0.293 -2.121 -0.879 l -8.171 -8.171 c -1.172 -1.171 -1.172 -3.071 0 -4.242 c 1.172 -1.172 3.07 -1.172 4.242 0 l 8.171 8.171 c 1.172 1.171 1.172 3.071 0 4.242 C 76.233 77.405 75.466 77.698 74.698 77.698 z" style="stroke: none; stroke-width: 1; stroke-dasharray: none; stroke-linecap: butt; stroke-linejoin: miter; stroke-miterlimit: 10; fill-rule: nonzero; opacity: 1;" transform=" matrix(1 0 0 1 0 0) " stroke-linecap="round" />
</g>
</svg>`}),this._dialog=new Zt({title:"Lighting Parameters",visible:!1,useHide:!0,top:60,left:60,width:600}),this._dialog.events.on("visibility",e=>{this._toggleBtn.setActive(e)}),this._panel=new dt({template:`<div class="og-lighing og-options-container">

         <div class="og-option">
           <div class="og-suncontrol"></div>
         </div>        
         
         <div class="og-option og-atmosphere-opacity">
         </div>
         
         <div class="og-option og-simpleskybackground">
         </div>
         
        <div class="og-lighting-emptyline"></div>

         <div class="og-option og-gamma"></div>         
         <div class="og-option og-exposure"></div>
       
        <div class="og-lighting-emptyline"></div>

         <div class="og-option">
         <div class="og-layers">
           <div class="og-caption">Select layer:</div>
           <select id="layers"></select>
         </div>
         </div>

         <div class="og-option og-opacity">
         </div>
         
         <div class="og-option og-night">
         </div>
         
         <div class="og-lighting-emptyline"></div>

         <div class="og-option og-diffuse">
         </div>
      
         <div class="og-option og-ambient">
         </div>

         <div class="og-option og-specular">
         </div>        

    </div>`}),this.$gamma=null,this.$exposure=null,this.$night=null,this.$opacity=null,this.$diffuse=null,this.$ambient=null,this.$specular=null,this.$atmosphereOpacity=null,this.$simpleSkyBackground=null,this._atmosphereMaxOpacity=new K({label:"Max.opacity",max:5}),this._atmosphereMinOpacity=new K({label:"Min.opacity",max:5}),this._simpleSkyBackgroundColorOne=new kn({label:"Color One"}),this._simpleSkyBackgroundColorTwo=new kn({label:"Color Two"}),this._gamma=new K({label:"Gamma",max:5}),this._exposure=new K({label:"Exposure",max:5}),this._night=new K({label:"Nightlight",max:5}),this._opacity=new K({label:"Opacity",max:1}),this._diffuse_r=new K({label:"Diffuse R",max:5}),this._diffuse_g=new K({label:"Diffuse G",max:5}),this._diffuse_b=new K({label:"Diffuse B",max:5}),this._ambient_r=new K({label:"Ambient R",max:5}),this._ambient_g=new K({label:"Ambient G",max:5}),this._ambient_b=new K({label:"Ambient B",max:5}),this._specular_r=new K({label:"Specular R",max:.2}),this._specular_g=new K({label:"Specular G",max:.2}),this._specular_b=new K({label:"Specular B",max:.2}),this._shininess=new K({label:"Shininess",max:100})}bindLayer(a){this._selectedLayer=a,this._opacity.value=a.opacity,this._update()}oninit(){this._toggleBtn.appendTo(this.renderer.div),this._dialog.appendTo(this.renderer.div),this._panel.appendTo(this._dialog.container),this._panel.el&&(this.$atmosphereOpacity=this._panel.el.querySelector(".og-atmosphere-opacity"),this.$simpleSkyBackground=this._panel.el.querySelector(".og-simpleskybackground"),this.$gamma=this._panel.el.querySelector(".og-option.og-gamma"),this.$exposure=this._panel.el.querySelector(".og-option.og-exposure"),this.$opacity=this._panel.el.querySelector(".og-option.og-opacity"),this.$diffuse=this._panel.el.querySelector(".og-option.og-diffuse"),this.$ambient=this._panel.el.querySelector(".og-option.og-ambient"),this.$specular=this._panel.el.querySelector(".og-option.og-specular"),this.$night=this._panel.el.querySelector(".og-option.og-night")),this._toggleBtn.events.on("change",o=>{this._dialog.setVisibility(o)});let a=this._dialog.select(".og-suncontrol"),e=new ct({classList:["og-suncontrol-button"],isActive:!0,icon:'<?xml version="1.0" encoding="utf-8"?><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 122.88 70.41" style="enable-background:new 0 0 122.88 70.41" xml:space="preserve"><g><path d="M60.91,19.12c6.95,0,13.24,2.95,17.8,7.72c4.55,4.77,7.37,11.37,7.37,18.64c0,1.94-0.2,3.83-0.58,5.65h31.61 c2.1,0,2.62,1.16,2.62,2.59c0,1.43-0.52,2.59-2.62,2.59H7.09c-2.1,0-2.62-1.16-2.62-2.59c0-1.43,0.52-2.59,2.62-2.59h29.23 c-0.38-1.82-0.58-3.71-0.58-5.65c0-7.28,2.82-13.87,7.37-18.64C47.67,22.08,53.96,19.12,60.91,19.12L60.91,19.12L60.91,19.12z M63.4,70.41c-2.1,0-2.62-1.16-2.62-2.59s0.52-2.59,2.62-2.59h56.86c2.1,0,2.62,1.16,2.62,2.59s-0.52,2.59-2.62,2.59H63.4 L63.4,70.41z M2.62,70.41c-2.1,0-2.62-1.16-2.62-2.59s0.52-2.59,2.62-2.59h29.51c2.1,0,2.62,1.16,2.62,2.59s-0.52,2.59-2.62,2.59 H2.62L2.62,70.41z M38.39,9.46c-0.78-1.35-0.32-3.07,1.03-3.85c1.35-0.78,3.07-0.32,3.85,1.03l3.62,6.27 c0.78,1.35,0.32,3.07-1.03,3.85c-1.35,0.78-3.07,0.32-3.85-1.03L38.39,9.46L38.39,9.46L38.39,9.46z M58.67,2.83 c0-1.56,1.27-2.83,2.83-2.83c1.56,0,2.83,1.27,2.83,2.83v7.24c0,1.56-1.27,2.83-2.83,2.83c-1.56,0-2.83-1.26-2.83-2.83V2.83 L58.67,2.83L58.67,2.83z M79.56,7.23c0.77-1.35,2.49-1.81,3.84-1.04c1.35,0.77,1.81,2.49,1.04,3.84l-3.62,6.27 c-0.77,1.35-2.49,1.81-3.84,1.04c-1.35-0.77-1.81-2.49-1.04-3.84L79.56,7.23L79.56,7.23L79.56,7.23z M95.45,21.48 c1.35-0.78,3.07-0.32,3.85,1.03c0.78,1.35,0.32,3.07-1.03,3.85L92,29.98c-1.35,0.78-3.07,0.32-3.85-1.03 c-0.78-1.35-0.32-3.07,1.03-3.85L95.45,21.48L95.45,21.48L95.45,21.48z M102.08,41.76c1.56,0,2.83,1.27,2.83,2.83 c0,1.56-1.27,2.83-2.83,2.83h-7.24c-1.56,0-2.83-1.26-2.83-2.83s1.26-2.83,2.83-2.83H102.08L102.08,41.76L102.08,41.76z M19.74,46.25c-1.56,0-2.83-1.27-2.83-2.83c0-1.56,1.27-2.83,2.83-2.83h7.24c1.56,0,2.83,1.26,2.83,2.83s-1.27,2.83-2.83,2.83 H19.74L19.74,46.25L19.74,46.25z M24.14,25.35c-1.35-0.77-1.81-2.49-1.04-3.84c0.77-1.35,2.49-1.81,3.84-1.04l6.27,3.62 c1.35,0.77,1.81,2.49,1.04,3.84c-0.77,1.35-2.49,1.81-3.84,1.04L24.14,25.35L24.14,25.35L24.14,25.35z"/></g></svg>',title:"Star/stop the Sun from following the camera"});e.appendTo(a);let t=new ct({classList:["og-suncontrol-button"],isActive:!0,icon:`<?xml version="1.0"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32">
    <path style="text-indent:0;text-align:start;line-height:normal;text-transform:none;block-progression:tb;-inkscape-font-specification:Sans" d="M 16 4 C 9.3844277 4 4 9.3844277 4 16 C 4 22.615572 9.3844277 28 16 28 C 22.615572 28 28 22.615572 28 16 C 28 9.3844277 22.615572 4 16 4 z M 16 6 C 16.389823 6 16.778223 6.0506339 17.15625 6.09375 C 18.631659 7.6568432 21 10.9245 21 16 C 21 21.0755 18.631659 24.343157 17.15625 25.90625 C 16.778223 25.949366 16.389823 26 16 26 C 10.465308 26 6 21.534692 6 16 C 6 10.465308 10.465308 6 16 6 z" overflow="visible" font-family="Sans"/>
</svg>
`,title:"Activate/deactivate the Sun current time positioning"});t.appendTo(a),e.events.on("change",o=>{const l=this.planet.renderer.controls.sun;o?l.start():l.stop()}),t.events.on("change",o=>{const l=this.planet.renderer.controls.sun;o?l.activate():l.deactivate()});let i=new ct({classList:["og-suncontrol-button"],isActive:this.planet.lightEnabled,icon:`<?xml version="1.0" encoding="utf-8"?>
<!-- Generated by IcoMoon.io -->
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="512" height="512" viewBox="0 0 512 512">
<g>
</g>
	<path d="M257.894 156.948c-53.258 0-96.42 43.561-96.42 97.26 0 53.719 43.161 97.249 96.42 97.249 53.197 0 96.379-43.53 96.379-97.25 0-53.698-43.182-97.26-96.379-97.26zM257.894 309.873c-30.464 0-55.163-24.945-55.163-55.665s24.699-55.624 55.163-55.624c30.423 0 55.101 24.904 55.101 55.624s-24.688 55.665-55.101 55.665z" fill="#000000" />
	<path d="M241.808 43.499h32.144v79.575h-32.144v-79.575z" fill="#000000" />
	<path d="M417.209 115.897l-22.723-22.917-55.757 56.279 22.723 22.907z" fill="#000000" />
	<path d="M389.468 238.407h78.899v32.389h-78.899v-32.389z" fill="#000000" />
	<path d="M396.012 416.86l22.723-22.917-55.767-56.259-22.712 22.897z" fill="#000000" />
	<path d="M242.473 388.915h32.144v79.575h-32.144v-79.575z" fill="#000000" />
	<path d="M96.266 396.073l22.722 22.938 55.778-56.289-22.692-22.928z" fill="#000000" />
	<path d="M43.633 240.537h78.879v32.43h-78.879v-32.43z" fill="#000000" />
	<path d="M115.394 93.051l-22.681 22.907 55.757 56.258 22.702-22.917z" fill="#000000" />
</svg>`,title:"Enable/disable planet lighting"});i.appendTo(a),i.events.on("change",o=>{this.planet.lightEnabled=o});let s=new ct({classList:["og-suncontrol-button"],isActive:this.planet.atmosphereEnabled,icon:`<?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg width="800px" height="800px" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><path fill="#000000" d="M135.688 18.5c-6.798 74.842-23.842 85.39-107.907 59.656 84.85 52.022 73.57 64.954-6.843 96.938 87.743-10.27 103.29 4.89 70.75 87.594 17.805-27.56 32.5-44.498 46.282-54.47-11.813 28.26-18.345 59.274-18.345 91.813 0 84.184 43.71 157.96 109.656 200.376-41.624-43.834-67.686-102.7-67.686-167.875 0-134.923 109.45-244.405 244.375-244.405 30.92 0 60.76 5.762 88 16.25-38.584-26.87-85.517-42.625-136.064-42.625-55.257 0-106.14 18.802-146.562 50.375 4.627-18.783 17.39-38.073 41.03-60.906C190.18 90.942 153.53 95.634 135.69 18.5zm10.03 77.188c5.67.002 11.428 1.247 16.876 3.874 14.506 6.998 22.72 21.81 22 36.938-10.26 10.87-19.507 22.696-27.594 35.344-9.035 2.753-19.075 2.27-28.25-2.156-19.37-9.343-27.5-32.6-18.156-51.97 6.715-13.92 20.638-22.036 35.125-22.03z"/></svg>`,title:"Enable/disable atmosphere scattering"});s.appendTo(a),this.planet.atmosphereEnabled?(this.$atmosphereOpacity.style.display="block",this.$simpleSkyBackground.style.display="none"):(this.$atmosphereOpacity.style.display="none",this.$simpleSkyBackground.style.display="flex"),s.events.on("change",o=>{this.planet.atmosphereEnabled=o,this.planet.atmosphereEnabled?(this.$atmosphereOpacity.style.display="block",this.$simpleSkyBackground.style.display="none"):(this.$atmosphereOpacity.style.display="none",this.$simpleSkyBackground.style.display="flex")}),this._atmosphereMaxOpacity.appendTo(this.$atmosphereOpacity),this._atmosphereMinOpacity.appendTo(this.$atmosphereOpacity),this._simpleSkyBackgroundColorOne.appendTo(this.$simpleSkyBackground),this._simpleSkyBackgroundColorTwo.appendTo(this.$simpleSkyBackground),this._gamma.appendTo(this.$gamma),this._exposure.appendTo(this.$exposure),this._night.appendTo(this.$night),this._opacity.appendTo(this.$opacity),this._diffuse_r.appendTo(this.$diffuse),this._diffuse_g.appendTo(this.$diffuse),this._diffuse_b.appendTo(this.$diffuse),this._ambient_r.appendTo(this.$ambient),this._ambient_g.appendTo(this.$ambient),this._ambient_b.appendTo(this.$ambient),this._specular_r.appendTo(this.$specular),this._specular_g.appendTo(this.$specular),this._specular_b.appendTo(this.$specular),this._shininess.appendTo(this.$specular),this._gamma.value=this.planet.renderer.gamma,this._gamma.events.on("change",o=>{this.planet.renderer.gamma=o}),this._exposure.value=this.planet.renderer.exposure,this._exposure.events.on("change",o=>{this.planet.renderer.exposure=o}),this._atmosphereMinOpacity.value=this.planet.atmosphereMinOpacity,this._atmosphereMinOpacity.events.on("change",o=>{this.planet.atmosphereMinOpacity=o}),this._atmosphereMaxOpacity.value=this.planet.atmosphereMaxOpacity,this._atmosphereMaxOpacity.events.on("change",o=>{this.planet.atmosphereMaxOpacity=o,this.planet.renderer.controls.Atmosphere.opacity=o});let n=this.planet.renderer.controls.SimpleSkyBackground;n&&(this._simpleSkyBackgroundColorOne.value=n.colorOne,this._simpleSkyBackgroundColorTwo.value=n.colorTwo),this._simpleSkyBackgroundColorOne.events.on("input",o=>{let l=this.planet.renderer.controls.SimpleSkyBackground;l&&(l.colorOne=o)}),this._simpleSkyBackgroundColorTwo.events.on("input",o=>{let l=this.planet.renderer.controls.SimpleSkyBackground;l&&(l.colorTwo=o)}),this._panel.el.querySelector("#layers").addEventListener("change",o=>{const l=this.planet.getLayerByName(o.target.value);l&&this.bindLayer(l)}),this._night.events.on("change",o=>{this._selectedLayer&&(this._selectedLayer.nightTextureCoefficient=o)}),this._opacity.events.on("change",o=>{this._selectedLayer&&(this._selectedLayer.opacity=o)}),this._ambient_r.events.on("change",o=>{this._selectedLayer&&this._selectedLayer._ambient&&(this._selectedLayer._ambient[0]=o)}),this._ambient_g.events.on("change",o=>{this._selectedLayer&&this._selectedLayer._ambient&&(this._selectedLayer._ambient[1]=o)}),this._ambient_b.events.on("change",o=>{this._selectedLayer&&this._selectedLayer._ambient&&(this._selectedLayer._ambient[2]=o)}),this._diffuse_r.events.on("change",o=>{this._selectedLayer&&this._selectedLayer._diffuse&&(this._selectedLayer._diffuse[0]=o)}),this._diffuse_g.events.on("change",o=>{this._selectedLayer&&this._selectedLayer._diffuse&&(this._selectedLayer._diffuse[1]=o)}),this._diffuse_b.events.on("change",o=>{this._selectedLayer&&this._selectedLayer._diffuse&&(this._selectedLayer._diffuse[2]=o)}),this._specular_r.events.on("change",o=>{this._selectedLayer&&this._selectedLayer._specular&&(this._selectedLayer._specular[0]=o)}),this._specular_g.events.on("change",o=>{this._selectedLayer&&this._selectedLayer._specular&&(this._selectedLayer._specular[1]=o)}),this._specular_b.events.on("change",o=>{this._selectedLayer&&this._selectedLayer._specular&&(this._selectedLayer._specular[2]=o)}),this._shininess.events.on("change",o=>{this._selectedLayer&&this._selectedLayer._specular&&(this._selectedLayer._specular[3]=o)}),this.planet&&(this.planet.events.on("layeradd",this._onLayerAdd,this),this.planet.events.on("layerremove",this._onLayerRemove,this)),this._fetchLayers()}_update(){let a=this._selectedLayer;this._opacity.value=a&&a.opacity?a.opacity:0,this._night.value=a&&a.nightTextureCoefficient?a.nightTextureCoefficient:this.planet.nightTextureCoefficient;let e=a&&a._ambient?a._ambient:this.planet._ambient;this._ambient_r.value=e[0],this._ambient_g.value=e[1],this._ambient_b.value=e[2];let t=a&&a._diffuse?a._diffuse:this.planet._diffuse;this._diffuse_r.value=t[0],this._diffuse_g.value=t[1],this._diffuse_b.value=t[2];let i=a&&a._specular?a._specular:this.planet._specular;this._specular_r.value=i[0],this._specular_g.value=i[1],this._specular_b.value=i[2],this._shininess.value=i[3]}_fetchLayers(){if(this.planet)for(let a=0;a<this.planet.layers.length;a++)this._onLayerAdd(this.planet.layers[a])}_onLayerAdd(a){this.bindLayer(a);let e=document.createElement("option");e.value=a.name,e.innerText=a.name,this._panel.el.querySelector("#layers").appendChild(e),this._panel.el.querySelector("#layers").value=a.name}_onLayerRemove(a){}},Navigation:qi,Object3dManager:class extends Z{constructor(a={}){super(a),this._onSelect=e=>{this._currentItem=e},this._onClick=e=>{if(!this.planet||!this._layer||!this._currentItem)return;let t=this.planet.getLonLatFromPixelTerrain(e.pos);if(t&&(this.renderer.setRelativeCenter(this.planet.camera.eye),this.renderer.events.isKeyPressed(Y.KEY_CTRL))){let i=this._createEntity(this._currentItem,t);this._layer.add(i)}},this._layer=a.layer||null,this._currentItem=null,this._collection=new on({collection:a.collection}),this._dialog=new Eh({model:this._collection})}oninit(){this.renderer&&(this._dialog.appendTo(this.renderer.div||document.body),this._dialog.events.on("select",this._onSelect),this.activate())}onactivate(){this._dialog.show(),this._initEvents()}ondeactivate(){this._dialog.hide(),this._clearEvents()}bindLayer(a){this._layer=a}_initEvents(){this.planet&&this.planet.renderer&&this.planet.renderer.events.on("lclick",this._onClick)}_clearEvents(){this.planet&&this.planet.renderer&&this.planet.renderer.events.off("lclick",this._onClick)}_createEntity(a,e){let t=a.name,i=a.scale,s=new U({lonlat:e,pitch:0,yaw:0,roll:0,scale:i});for(let n=0;n<a.objects.length;n++){let o=a.objects[n],l=new U({forceGlobalPosition:!0,forceGlobalRotation:!0,forceGlobalScale:!0,geoObject:{tag:`${t}:${n.toString()}`,object3d:o}});s.appendChild(l)}return s}},OldMouseNavigation:en,Ruler:da,RulerSwitcher:class extends Z{constructor(a={}){super({name:"RulerSwitcher",...a}),this.ruler=new On({ignoreTerrain:a.ignoreTerrain})}oninit(){this.planet.addControl(this.ruler),this._createMenuBtn()}onactivate(){this.ruler.activate()}ondeactivate(){this.ruler.deactivate()}_createMenuBtn(){let a=new ct({classList:["og-map-button","og-ruler_button"],icon:`<?xml version="1.0" encoding="iso-8859-1"?>
<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg fill="#000000" height="800px" width="800px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" 
	 viewBox="0 0 512 512" xml:space="preserve">
<g>
	<g>
		<path d="M369.151,0L0.001,369.15L142.85,512l369.149-369.15L369.151,0z M47.286,369.15l10.908-10.908l47.782,47.782l23.642-23.642
			L81.837,334.6l10.909-10.909l23.711,23.711L140.1,323.76l-23.711-23.711l10.909-10.909l23.711,23.711l23.642-23.642
			l-23.711-23.711l10.909-10.909l47.782,47.782l23.642-23.642l-47.782-47.782l10.908-10.908l23.71,23.71l23.642-23.642l-23.71-23.71
			l10.908-10.908l23.711,23.711l23.642-23.642l-23.711-23.711l10.909-10.909l47.782,47.782l23.642-23.642l-47.782-47.782
			l10.908-10.908l23.71,23.711l23.642-23.642l-23.711-23.71L334.6,81.837l23.711,23.71l23.642-23.642l-23.711-23.712l10.908-10.908
			l95.564,95.564L142.85,464.714L47.286,369.15z"/>
	</g>
</g>
</svg>`});a.appendTo(this.renderer.div),a.events.on("change",e=>{e?this.onactivate():this.ondeactivate()})}},ScaleControl:ua,Selection:class extends Z{constructor(a={}){super(a),this._selectorScene=new Il({name:`selectionScene:${this.__id}`,ignoreTerrain:a.ignoreTerrain,onSelect:a.onSelect,autoSelectionHide:a.autoSelectionHide}),this._toggleBtn=new ct({classList:["og-map-button","og-selection_button"],icon:`<?xml version="1.0" encoding="utf-8"?><!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
<svg width="800px" height="800px" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--gis" preserveAspectRatio="xMidYMid meet"><path d="M2.1 0v1.914H0v6h3V3h5.1V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h6V0h-6zm9 0v3h1.8v1.2h3V0h-4.8zm1.8 7.2v6h3v-6h-3zM0 10.913v6h3v-6H0zM66.9 16.2v6h3v-6h-3zM0 19.914v6h3v-6H0zM66.9 25.2v6h3v-6h-3zM0 28.914v6h3v-6H0zM66.9 34.2v6h3v-6h-3zM0 37.914v6h3v-6H0zM66.9 43.2v6h3v-6h-3zM0 46.914v6h3v-6H0zM66.9 52.2v6h3v-6h-3zM0 55.914v5.191h3.809v-3H3v-2.19H0zm6.809 2.191v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9 0v3h6v-3h-6zm9.648 1.899a2.076 2.076 0 0 0-2.19 2.324l3.137 33.676c.2 1.635 2.135 2.399 3.397 1.34l6.623-5.371l2.969 5.142c1.707 2.958 4.417 3.684 7.375 1.977c2.957-1.708 3.684-4.417 1.976-7.375l-2.959-5.125l7.848-3.008c1.548-.564 1.855-2.62.539-3.611L71.576 60.416a2.073 2.073 0 0 0-1.119-.412z" fill="#000000"></path></svg>`})}set ignoreTerrain(a){this._selectorScene.ignoreTerrain=a}oninit(){this._toggleBtn.appendTo(this.renderer.div),this._toggleBtn.events.on("change",a=>{a?this.activate():this.deactivate()}),this._selectorScene.bindPlanet(this.planet)}onactivate(){this.renderer.addNode(this._selectorScene)}ondeactivate(){this.renderer.removeNode(this._selectorScene)}},ShowFps:class extends Z{constructor(a){super(a)}oninit(){let a=document.createElement("div");a.className="defaultText ",a.id="ogShowFpsControl",document.body.appendChild(a),this.renderer.events.on("draw",this._draw,this)}_draw(){Po("ogShowFpsControl",(1e3/this.renderer.handler.deltaTime).toFixed(1),this.renderer.handler.canvas.clientWidth-60,0)}},SimpleNavigation:class extends Z{constructor(a={}){super({name:"SimpleNavigation",autoActivate:!0,...a}),this.focusVel=0,this.focusForce=0,this._nx=0,this._ny=0,this._onMouseLeftButtonDown=e=>{if(this._active&&this.renderer){if(this.stop(),this.renderer.handler.canvas.classList.add("ogGrabbingPoiner"),this._grabbedPoint=this.renderer.getCartesianFromPixel(e),this._grabbedScreenPoint.set(e.nx,e.ny),!this._grabbedPoint){let t=this.renderer.activeCamera,i=new m,s=new m(1,0,0),n=new m(0,0,1),o=new m;new H(t.eye,e.direction).hitPlaneRes(mt.fromPoints(i,s,n),o)===H.INSIDE&&(this._grabbedPoint=o)}this._grabbedPoint&&this._eye0.copy(this.renderer.activeCamera.eye)}},this._onMouseLeftButtonUp=e=>{this.renderer.handler.canvas.classList.remove("ogGrabbingPoiner"),e.x===e.prev_x&&(e.y,e.prev_y)},this._onMouseLeftButtonHold=e=>{if(this.renderer&&this._grabbedPoint&&e.moving){let t=this.renderer.activeCamera;if(t.isOrthographic){let i=e.nx-this._grabbedScreenPoint.x,s=e.ny-this._grabbedScreenPoint.y,n=t.frustum,o=-(n.right-n.left)*i,l=(n.top-n.bottom)*s,h=t.getUp().scale(l),c=t.getRight().scale(o);t.eye=this._eye0.add(c.add(h))}else{let i,s,n=Math.abs(t.getForward().dot(m.UP)),o=this._grabbedPoint;n>.7?(i=m.add(o,m.LEFT),s=m.add(o,t.getRight())):(i=m.add(o,t.getRight()),s=m.add(o,m.UP));let l=new m;new H(t.eye,e.direction).hitPlaneRes(mt.fromPoints(o,i,s),l)===H.INSIDE&&(t.eye=t.eye.add(o.sub(l)))}t.update()}},this._onRHold=e=>{if(this._lookPos&&e.moving&&this.renderer){const t=this.renderer.activeCamera;this.renderer.controlsBag.scaleRot=1;let i=.5/t.eye.distance(this._lookPos)*G;i>.007?i=.007:i<.003&&(i=.003),t.rotateHorizontal(i*(e.x-e.prev_x),!1,this._lookPos,this._up),t.rotateVertical(i*(e.y-e.prev_y),this._lookPos),t.update()}},this._onRDown=e=>{if(this.renderer)if(this.stop(),this._lookPos=this.renderer.getCartesianFromPixel(e.pos),this._lookPos)this._up=m.UP;else{const t=this.renderer.activeCamera;let i=new mt(m.ZERO,m.UP),s=new H(t.eye,e.direction);this._lookPos=new m,s.hitPlaneRes(i,this._lookPos),this._up=m.UP}},this._onMouseWheel=e=>{if(this.renderer){let t=this.renderer.activeCamera;if(t.isOrthographic){let i=t.frustums[0],s=-(i.right-i.left)*(.5-e.nx),n=(i.top-i.bottom)*(.5-e.ny),o=t.getUp().scale(n),l=t.getRight().scale(s),h=t.eye.add(l.add(o));this._wheelPos=h.add(t.getForward()),this._wheelDist=1,this._nx=e.nx,this._ny=e.ny,this.focusForce=.05*e.wheelDelta}else{let i=this.renderer.getCartesianFromPixel(e);if(!i){i=new m;let o=new mt(m.ZERO,m.UP);new H(t.eye,e.direction).hitPlaneRes(o,i)}let s=i.sub(t.eye).normalize(),n=8*t.eye.distance(i);this.force.addA(s.scale(e.wheelDelta)).normalize().scale(n)}}},this.onCameraMoveForward=()=>{this.force.addA(this.renderer.activeCamera.getForward()).normalize()},this.onCameraMoveBackward=()=>{this.force.addA(this.renderer.activeCamera.getBackward()).normalize()},this.onCameraStrifeLeft=()=>{this.force.addA(this.renderer.activeCamera.getLeft()).normalize()},this.onCameraStrifeRight=()=>{this.force.addA(this.renderer.activeCamera.getRight()).normalize()},this.onCameraLookUp=()=>{this.renderer.activeCamera.update()},this.onCameraLookDown=()=>{this.renderer.activeCamera.update()},this.onCameraTurnLeft=()=>{this.renderer.activeCamera.update()},this.onCameraTurnRight=()=>{this.renderer.activeCamera.update()},this.onCameraRollLeft=()=>{this.renderer.activeCamera.update()},this.onCameraRollRight=()=>{this.renderer.activeCamera.update()},this.speed=a.speed||1,this.force=new m,this.vel=new m,this.mass=1,this._lookPos=void 0,this._grabbedPoint=void 0,this._grabbedScreenPoint=new N,this._up=null,this._eye0=new m,this._wheelDist=0,this._wheelPos=new m}oninit(){}onactivate(){super.onactivate();let a=this.renderer;a.activeCamera.isOrthographic&&a.getDepthMinDistanceAsync().then(e=>{a.activeCamera.focusDistance=e}),a.events.on("mousewheel",this._onMouseWheel),a.events.on("keypress",Y.KEY_W,this.onCameraMoveForward,this),a.events.on("keypress",Y.KEY_S,this.onCameraMoveBackward,this),a.events.on("keypress",Y.KEY_A,this.onCameraStrifeLeft,this),a.events.on("keypress",Y.KEY_D,this.onCameraStrifeRight,this),a.events.on("keypress",Y.KEY_UP,this.onCameraLookUp,this),a.events.on("keypress",Y.KEY_DOWN,this.onCameraLookDown,this),a.events.on("keypress",Y.KEY_LEFT,this.onCameraTurnLeft,this),a.events.on("keypress",Y.KEY_RIGHT,this.onCameraTurnRight,this),a.events.on("keypress",Y.KEY_Q,this.onCameraRollLeft,this),a.events.on("keypress",Y.KEY_E,this.onCameraRollRight,this),a.events.on("rhold",this._onRHold,this),a.events.on("rdown",this._onRDown,this),a.events.on("lhold",this._onMouseLeftButtonHold),a.events.on("ldown",this._onMouseLeftButtonDown),a.events.on("lup",this._onMouseLeftButtonUp),a.events.on("draw",this.onDraw,this,-1e3)}ondeactivate(){super.ondeactivate();let a=this.renderer;a.events.off("mousewheel",this._onMouseWheel),a.events.off("keypress",Y.KEY_W,this.onCameraMoveForward),a.events.off("keypress",Y.KEY_S,this.onCameraMoveBackward),a.events.off("keypress",Y.KEY_A,this.onCameraStrifeLeft),a.events.off("keypress",Y.KEY_D,this.onCameraStrifeRight),a.events.off("keypress",Y.KEY_UP,this.onCameraLookUp),a.events.off("keypress",Y.KEY_DOWN,this.onCameraLookDown),a.events.off("keypress",Y.KEY_LEFT,this.onCameraTurnLeft),a.events.off("keypress",Y.KEY_RIGHT,this.onCameraTurnRight),a.events.off("keypress",Y.KEY_Q,this.onCameraRollLeft),a.events.off("keypress",Y.KEY_E,this.onCameraRollRight),a.events.off("rhold",this._onRHold),a.events.off("rdown",this._onRDown),a.events.off("lhold",this._onMouseLeftButtonHold),a.events.off("ldown",this._onMouseLeftButtonDown),a.events.off("lup",this._onMouseLeftButtonUp),a.events.off("draw",this.onDraw)}_handleMouseWheel(){let a=this.renderer.activeCamera;if(a.isOrthographic&&Math.abs(this.focusVel)>.01){a.eye=this._wheelPos.add(a.getBackward().scale(this._wheelDist)),a.focusDistance-=a.focusDistance*this.focusVel*this.dt;let e=a.frustums[0],t=(e.right-e.left)*(.5-this._nx),i=-(e.top-e.bottom)*(.5-this._ny),s=a.getUp().scale(i),n=a.getRight().scale(t);a.eye.addA(n.add(s)),a.update()}else this.vel.length()>.01&&(a.eye=a.eye.add(this.vel.scaleTo(this.dt)),a.update())}onDraw(){this._updateVel(),this._handleMouseWheel()}get dt(){return .001*this.renderer.handler.deltaTime}_updateVel(){let a=this.force.scale(1/this.mass);this.vel.addA(a),this.vel.scale(.77),this.force.set(0,0,0),this.focusVel+=this.focusForce,this.focusVel*=.77,this.focusForce=0}stop(){this.focusVel=0,this.vel.clear()}},SimpleSkyBackground:_a,Sun:Ir,TimelineControl:class extends Z{constructor(a={}){super({name:"timeline",...a});let e=a.current||new Date,t=a.rangeStart||Un(e,-12),i=a.rangeEnd||Un(e,12);this._timelineView=new Ul({rangeStart:t,rangeEnd:i,currentDate:e}),this._toggleBtn=new ct({classList:["og-map-button","og-timeline_button"],icon:`<?xml version="1.0" encoding="utf-8"?>
<!-- Svg Vector Icons : http://www.onlinewebfonts.com/icon -->
    <!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1000 1000" enable-background="new 0 0 1000 1000" xml:space="preserve">
    <metadata> Svg Vector Icons : http://www.onlinewebfonts.com/icon </metadata>
    <g><path d="M500,10C229.4,10,10,229.4,10,500s219.4,490,490,490s490-219.4,490-490S770.6,10,500,10z M800.3,800.3c-39,39-84.5,69.7-135,91C613,913.5,557.4,924.7,500,924.7s-112.9-11.2-165.3-33.3c-50.5-21.3-95.9-52-135-91c-39-39-69.7-84.5-91-135C86.5,612.9,75.3,557.4,75.3,500s11.2-112.9,33.3-165.3c21.3-50.5,52-95.9,91-135c39-39,84.5-69.7,135-91C387.1,86.5,442.6,75.3,500,75.3s112.9,11.2,165.3,33.3c50.5,21.3,95.9,52,135,91c39,39,69.7,84.5,91,135c22.1,52.3,33.3,107.9,33.3,165.3s-11.2,112.9-33.3,165.3C869.9,715.8,839.3,761.2,800.3,800.3z"/><path d="M761.3,532.7H532.7V304c0-18.1-14.6-32.7-32.7-32.7s-32.7,14.6-32.7,32.7v261.3l0,0c0,18.1,14.6,32.7,32.7,32.7h261.3c18.1,0,32.7-14.6,32.7-32.7l0,0C794,547.3,779.4,532.7,761.3,532.7z"/></g>
</svg>`}),this._dialog=new Zt({title:"Timeline",visible:!1,resizable:!0,useHide:!0,top:10,left:60,width:600,height:115,minHeight:115,maxHeight:110}),this._dialog.events.on("visibility",s=>{this._toggleBtn.setActive(s)})}oninit(){let a=this.renderer.div;this._toggleBtn.appendTo(a),this._dialog.appendTo(a),this._toggleBtn.events.on("change",e=>{this._dialog.setVisibility(e),e&&this._timelineView.resize()}),this._timelineView.appendTo(this._dialog.container),this._timelineView.events.on("setcurrent",e=>{this.renderer&&this.renderer.handler.defaultClock.setDate(e)}),this._timelineView.events.on("startdrag",()=>{var e;(e=this.planet)==null||e.sun.stop(),this.renderer&&this.renderer.controls.navigation.deactivate()}),this._timelineView.events.on("stopdrag",()=>{this.renderer&&this.renderer.controls.navigation.activate()}),this._timelineView.events.on("startdragcurrent",()=>{var e;(e=this.planet)==null||e.sun.stop(),this.renderer&&this.renderer.controls.navigation.deactivate()}),this._timelineView.events.on("stopdragcurrent",()=>{this.renderer&&this.renderer.controls.navigation.activate()})}},ToggleWireframe:class extends Z{constructor(a={}){super(a),this._isActive=!1,this.toogleWireframe=()=>{this.renderer&&this.renderer.handler.gl&&(this.planet.drawMode===this.renderer.handler.gl.LINE_STRIP?this.planet.setDrawMode(this.renderer.handler.gl.TRIANGLE_STRIP):this.planet.setDrawMode(this.renderer.handler.gl.LINE_STRIP))},this._isActive=a.isActive||!1}oninit(){this.renderer.events.on("charkeypress",Y.KEY_X,this.toogleWireframe,this),this._isActive&&this.planet.setDrawMode(this.renderer.handler.gl.LINE_STRIP)}},TouchNavigation:fa,ZoomControl:ga},Symbol.toStringTag,{value:"Module"}));function Ze(a){return new Uint32Array(a)}function Mh(a){let e=[],t=0,i=0,s=0;for(let n=1;n<a-1-1;n++){for(let o=1;o<a-1;o++)t=n*a+o,s=(n+1)*a,i=s+o,e.push(t,i);e.push(i,s+1)}return e.push(e[e.length-1],a*a-a),Ze(e)}function Bh(a,e){let t=[];const i=(a-1)/e,s=a*a-a;let n=0;for(let o=0;o<a-2;o++){o%i==0&&(n=o);let l=s-a*o-a+1,h=s-a*n;t.push(h,l)}return e===a-1&&(t.push(a),t.push(0)),Ze(t)}function kh(a,e){let t=[];const i=(a-1)/e;let s=0;for(let n=0;n<a-2;n++){n%i==0&&(s=n);let o=a+n+1,l=s;t.push(l,o)}return e===a-1&&(t.push(a-2),t.push(a-1)),Ze(t)}function Ih(a,e){let t=[];const i=(a-1)/e;let s=0;for(let n=0;n<a-2;n++){n%i==0&&(s=n);let o=a*(n+1)+a-2,l=a+a*s-1;t.push(l,o)}return e===a-1&&(t.push(a*(a-1)-1),t.push(a*a-1)),Ze(t)}function zh(a,e){let t=[];const i=(a-1)/e;let s=0;const n=a*(a-1)-2,o=a*a-1;for(let l=0;l<a-2;l++){l%i==0&&(s=l);let h=n-l,c=o-s;t.push(c,h)}return e===a-1&&t.push(a*a-a+1),t.push(a*a-a),Ze(t)}function so(a){let e=[[],[],[],[]];for(let t=0;t<=a;t++){let i=Math.pow(2,t)+1;e[0][t]=[],e[3][t]=[],e[2][t]=[],e[1][t]=[];for(let s=0;s<=a;s++){let n=Math.pow(2,s);e[3][t][s]=Bh(i,n),e[0][t][s]=kh(i,n),e[1][t][s]=Ih(i,n),e[2][t][s]=zh(i,n)}}return e}function ro(a){let e=[];for(let t=0;t<=a;t++){const i=Math.pow(2,t);e[t]=Mh(i+1)}return e}function Dh(a){let e=new Uint16Array((a+1)*(a+1)*2),t=0;for(let i=0;i<=a;i++)for(let s=0;s<=a;s++)e[t++]=s/a*65535,e[t++]=i/a*65535;return e}let Fh=new class{constructor(a=0){this._maxGridSize=a,this.centerIndexesTable=ro(this._maxGridSize),this.skirtsIndexesTable=so(this._maxGridSize)}get maxGridSize(){return this._maxGridSize}init(){this.centerIndexesTable=ro(this._maxGridSize),this.skirtsIndexesTable=so(this._maxGridSize)}setMaxGridSize(a){this._maxGridSize=a,this.init()}createSegmentIndexes(a,e){if(a){let i=this.centerIndexesTable[a],s=this.skirtsIndexesTable[3][a][e[3]],n=this.skirtsIndexesTable[0][a][e[0]],o=this.skirtsIndexesTable[1][a][e[1]],l=this.skirtsIndexesTable[2][a][e[2]],h=(t=i.length+s.length+n.length+o.length+l.length,new Uint32Array(t));return h.set(i,0),h.set(s,i.length),h.set(n,i.length+s.length),h.set(o,i.length+s.length+n.length),h.set(l,i.length+s.length+n.length+o.length),h}var t;return Ze([0,2,1,3])}initTextureCoordsTable(a){let e=[];for(let t=0;t<=a;t++){const i=Math.pow(2,t);e[t]=Dh(i)}return e}};function Wi(){return Fh}function no(){return new $("drawnode_screen_wl",{uniforms:{projectionMatrix:"mat4",viewMatrix:"mat4",eyePositionHigh:"vec3",eyePositionLow:"vec3",height:"float",uGlobalTextureCoord:"vec4",uNormalMapBias:"vec3",samplerCount:"int",tileOffsetArr:"vec4",layerOpacityArr:"float",samplerArr:"sampler2darray",defaultTexture:"sampler2d",uNormalMap:"sampler2d",nightTexture:"sampler2d",specularTexture:"sampler2d",lightPosition:"vec3",diffuse:"vec3",ambient:"vec3",specular:"vec4",camHeight:"float",nightTextureCoefficient:"float"},attributes:{aVertexPositionHigh:"vec3",aVertexPositionLow:"vec3",aTextureCoord:"vec2"},vertexShader:"attribute vec3 aVertexPositionHigh;attribute vec3 aVertexPositionLow;attribute vec2 aTextureCoord;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform vec4 uGlobalTextureCoord;uniform vec3 uNormalMapBias;uniform vec3 eyePositionHigh;uniform vec3 eyePositionLow;uniform float height;varying vec4 vTextureCoord;varying vec3 v_vertex;varying vec3 cameraPosition;varying vec2 vGlobalTextureCoord;varying float v_height;void main(void){vec3 aVertexPosition=aVertexPositionHigh+aVertexPositionLow;vec3 nh=height*normalize(aVertexPosition);vTextureCoord.xy=aTextureCoord;vGlobalTextureCoord=uGlobalTextureCoord.xy+(uGlobalTextureCoord.zw-uGlobalTextureCoord.xy)*aTextureCoord;vTextureCoord.zw=uNormalMapBias.z*(aTextureCoord+uNormalMapBias.xy);cameraPosition=eyePositionHigh+eyePositionLow;vec3 highDiff=aVertexPositionHigh-eyePositionHigh;vec3 lowDiff=aVertexPositionLow-eyePositionLow+nh;mat4 viewMatrixRTE=viewMatrix;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);v_height=height;v_vertex=aVertexPosition+nh;gl_Position=projectionMatrix*viewMatrixRTE*vec4(highDiff*step(1.0,length(highDiff))+lowDiff,1.0);}",fragmentShader:`precision highp float;float getLerpValue(in float min,in float max,in float between){return(clamp(between,min,max)-min)/(max-min);}vec3 aces(vec3 color){float a=2.51;float b=0.03;float c=2.43;float d=0.59;float e=0.14;return clamp((color*(a*color+b))/(color*(c*color+d)+e),0.0,1.0);}bool intersectSphere(vec3 rayOrigin,vec3 rayDirection,float radius,inout float t1,inout float t2){float b=dot(rayDirection,rayOrigin);float c=dot(rayOrigin,rayOrigin)-radius*radius;float d=b*b-c;if(d<0.0){return false;}t1=-b-sqrt(d);t2=-b+sqrt(d);return true;}bool intersectSphere(vec3 rayOrigin,vec3 rayDirection,float radius,inout float t){float b=dot(rayDirection,rayOrigin);float c=dot(rayOrigin,rayOrigin)-radius*radius;float d=b*b-c;if(d<0.0){return false;}t=-b-sqrt(d);return true;}float intersectSphere(vec3 ro,vec3 rd,vec4 sph){vec3 oc=ro-sph.xyz;float b=dot(oc,rd);float c=dot(oc,oc)-sph.w*sph.w;float h=b*b-c;if(h<0.0)return-1.0;h=sqrt(h);return-b-h;}bool intersectEllipsoid(in vec3 ro,in vec3 rd,in vec3 ra,inout float t){vec3 ocn=ro/ra;vec3 rdn=rd/ra;float a=dot(rdn,rdn);float b=dot(ocn,rdn);float c=dot(ocn,ocn);float h=b*b-a*(c-1.0);if(h<0.0){return false;}t=(-b-sqrt(h))/a;return true;}bool intersectEllipsoid(in vec3 ro,in vec3 rd,in vec3 ra,inout float t1,inout float t2){vec3 ocn=ro/ra;vec3 rdn=rd/ra;float a=dot(rdn,rdn);float b=dot(ocn,rdn);float c=dot(ocn,ocn);float h=b*b-a*(c-1.0);if(h<0.0){return false;}h=sqrt(h);t1=(-b-h)/a;t2=(-b+h)/a;return true;}vec3 normalEllipsoid(in vec3 pos,in vec3 ra){return normalize(pos/(ra*ra));}
#ifdef WEBGL2
#define TEXTURE_FUNC texture
#else
#define TEXTURE_FUNC texture2D
#endif
#define SLICE_SIZE 5
#define blend(DEST, SAMPLER, OFFSET, OPACITY) src = TEXTURE_FUNC(SAMPLER, OFFSET.xy + vTextureCoord.xy * OFFSET.zw); DEST = DEST * (1.0 - src.a * OPACITY) + src * OPACITY;
#define blendPicking(DEST, OFFSET, SAMPLER, MASK, COLOR, OPACITY) tc = OFFSET.xy + vTextureCoord.xy * OFFSET.zw; t = TEXTURE_FUNC(SAMPLER, tc); p = TEXTURE_FUNC(MASK, tc); DEST = mix(DEST, vec4(max(COLOR.rgb, p.rgb), OPACITY), (t.a == 0.0 ? 0.0: 1.0) * COLOR.a);
const vec3 nightStep=10.0*vec3(0.58,0.48,0.25);uniform vec4 specular;uniform vec3 diffuse;uniform vec3 ambient;uniform sampler2D uNormalMap;uniform sampler2D nightTexture;uniform sampler2D specularTexture;uniform sampler2D defaultTexture;uniform sampler2D samplerArr[SLICE_SIZE];uniform vec4 tileOffsetArr[SLICE_SIZE];uniform vec3 lightPosition;uniform float layerOpacityArr[SLICE_SIZE];uniform int samplerCount;uniform float nightTextureCoefficient;uniform float camHeight;varying vec4 vTextureCoord;varying vec3 v_vertex;varying vec3 cameraPosition;varying vec2 vGlobalTextureCoord;varying float v_height;vec3 sunPos;void main(void){sunPos=lightPosition;vec3 texNormal=texture2D(uNormalMap,vTextureCoord.zw).rgb;vec3 normal=normalize((texNormal-0.5)*2.0);float minH=1200000.0;float maxH=minH*3.0;float nightCoef=getLerpValue(minH,maxH,camHeight)*nightTextureCoefficient;vec3 lightDir=normalize(sunPos);vec3 viewDir=normalize(cameraPosition-v_vertex);float overGround=1.0-step(0.1,v_height);float shininess=texture2D(specularTexture,vGlobalTextureCoord.st).r*255.0*overGround;vec3 reflectionDirection=reflect(-lightDir,normal);float reflection=max(dot(reflectionDirection,viewDir),0.0);vec3 spec=specular.rgb*pow(reflection,specular.w)*shininess;float diffuseLightWeighting=max(dot(normal,lightDir),0.0);vec4 nightImageColor=texture2D(nightTexture,vGlobalTextureCoord.st);vec3 night=nightStep*(.18-diffuseLightWeighting*3.0)*nightImageColor.rgb*nightCoef;night*=overGround*step(0.0,night);vec4 lightWeighting=vec4(ambient+diffuse*diffuseLightWeighting+night,1.0);gl_FragColor=texture2D(defaultTexture,vTextureCoord.xy);if(samplerCount==0){gl_FragColor=gl_FragColor*lightWeighting+vec4(spec,0.0);return;}vec4 src;blend(gl_FragColor,samplerArr[0],tileOffsetArr[0],layerOpacityArr[0]);if(samplerCount==1){gl_FragColor=gl_FragColor*lightWeighting+vec4(spec,0.0);return;}blend(gl_FragColor,samplerArr[1],tileOffsetArr[1],layerOpacityArr[1]);if(samplerCount==2){gl_FragColor=gl_FragColor*lightWeighting+vec4(spec,0.0);return;}blend(gl_FragColor,samplerArr[2],tileOffsetArr[2],layerOpacityArr[2]);if(samplerCount==3){gl_FragColor=gl_FragColor*lightWeighting+vec4(spec,0.0);return;}blend(gl_FragColor,samplerArr[3],tileOffsetArr[3],layerOpacityArr[3]);if(samplerCount==4){gl_FragColor=gl_FragColor*lightWeighting+vec4(spec,0.0);return;}blend(gl_FragColor,samplerArr[4],tileOffsetArr[4],layerOpacityArr[4]);gl_FragColor=gl_FragColor*lightWeighting+vec4(spec,0.0);}`})}function oo(a){return new $("drawnode_screen_wl",{uniforms:{projectionMatrix:"mat4",viewMatrix:"mat4",eyePositionHigh:"vec3",eyePositionLow:"vec3",height:"float",uGlobalTextureCoord:"vec4",uNormalMapBias:"vec3",samplerCount:"int",tileOffsetArr:"vec4",layerOpacityArr:"float",samplerArr:"sampler2darray",defaultTexture:"sampler2d",uNormalMap:"sampler2d",nightTexture:"sampler2d",specularTexture:"sampler2d",lightPosition:"vec3",diffuse:"vec3",ambient:"vec3",specular:"vec4",transmittanceTexture:"sampler2D",scatteringTexture:"sampler2D",camHeight:"float",nightTextureCoefficient:"float",maxMinOpacity:"vec2",transitionOpacity:"float"},attributes:{aVertexPositionHigh:"vec3",aVertexPositionLow:"vec3",aTextureCoord:"vec2"},vertexShader:`#version 300 es
precision highp float;in vec3 aVertexPositionHigh;in vec3 aVertexPositionLow;in vec2 aTextureCoord;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform vec4 uGlobalTextureCoord;uniform vec3 uNormalMapBias;uniform vec3 eyePositionHigh;uniform vec3 eyePositionLow;uniform float height;out vec4 vTextureCoord;out vec3 v_vertex;out vec3 cameraPosition;out vec2 vGlobalTextureCoord;out float v_height;void main(void){vec3 aVertexPosition=aVertexPositionHigh+aVertexPositionLow;vec3 nh=height*normalize(aVertexPosition);vTextureCoord.xy=aTextureCoord;vGlobalTextureCoord=uGlobalTextureCoord.xy+(uGlobalTextureCoord.zw-uGlobalTextureCoord.xy)*aTextureCoord;vTextureCoord.zw=uNormalMapBias.z*(aTextureCoord+uNormalMapBias.xy);cameraPosition=eyePositionHigh+eyePositionLow;vec3 highDiff=aVertexPositionHigh-eyePositionHigh;vec3 lowDiff=aVertexPositionLow-eyePositionLow+nh;mat4 viewMatrixRTE=viewMatrix;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);v_height=height;v_vertex=aVertexPosition+nh;gl_Position=projectionMatrix*viewMatrixRTE*vec4(highDiff*step(1.0,length(highDiff))+lowDiff,1.0);}`,fragmentShader:ci("#version 300 es\nprecision highp float;\n#ifdef WEBGL2\n#define TEXTURE_FUNC texture\n#else\n#define TEXTURE_FUNC texture2D\n#endif\n#define SLICE_SIZE 5\n#define blend(DEST, SAMPLER, OFFSET, OPACITY) src = TEXTURE_FUNC(SAMPLER, OFFSET.xy + vTextureCoord.xy * OFFSET.zw); DEST = DEST * (1.0 - src.a * OPACITY) + src * OPACITY;\n#define blendPicking(DEST, OFFSET, SAMPLER, MASK, COLOR, OPACITY) tc = OFFSET.xy + vTextureCoord.xy * OFFSET.zw; t = TEXTURE_FUNC(SAMPLER, tc); p = TEXTURE_FUNC(MASK, tc); DEST = mix(DEST, vec4(max(COLOR.rgb, p.rgb), OPACITY), (t.a == 0.0 ? 0.0: 1.0) * COLOR.a);\nconst vec3 nightStep=10.0*vec3(0.58,0.48,0.25);float getLerpValue(in float min,in float max,in float between){return(clamp(between,min,max)-min)/(max-min);}vec3 aces(vec3 color){float a=2.51;float b=0.03;float c=2.43;float d=0.59;float e=0.14;return clamp((color*(a*color+b))/(color*(c*color+d)+e),0.0,1.0);}bool intersectSphere(vec3 rayOrigin,vec3 rayDirection,float radius,inout float t1,inout float t2){float b=dot(rayDirection,rayOrigin);float c=dot(rayOrigin,rayOrigin)-radius*radius;float d=b*b-c;if(d<0.0){return false;}t1=-b-sqrt(d);t2=-b+sqrt(d);return true;}bool intersectSphere(vec3 rayOrigin,vec3 rayDirection,float radius,inout float t){float b=dot(rayDirection,rayOrigin);float c=dot(rayOrigin,rayOrigin)-radius*radius;float d=b*b-c;if(d<0.0){return false;}t=-b-sqrt(d);return true;}float intersectSphere(vec3 ro,vec3 rd,vec4 sph){vec3 oc=ro-sph.xyz;float b=dot(oc,rd);float c=dot(oc,oc)-sph.w*sph.w;float h=b*b-c;if(h<0.0)return-1.0;h=sqrt(h);return-b-h;}bool intersectEllipsoid(in vec3 ro,in vec3 rd,in vec3 ra,inout float t){vec3 ocn=ro/ra;vec3 rdn=rd/ra;float a=dot(rdn,rdn);float b=dot(ocn,rdn);float c=dot(ocn,ocn);float h=b*b-a*(c-1.0);if(h<0.0){return false;}t=(-b-sqrt(h))/a;return true;}bool intersectEllipsoid(in vec3 ro,in vec3 rd,in vec3 ra,inout float t1,inout float t2){vec3 ocn=ro/ra;vec3 rdn=rd/ra;float a=dot(rdn,rdn);float b=dot(ocn,rdn);float c=dot(ocn,ocn);float h=b*b-a*(c-1.0);if(h<0.0){return false;}h=sqrt(h);t1=(-b-h)/a;t2=(-b+h)/a;return true;}vec3 normalEllipsoid(in vec3 pos,in vec3 ra){return normalize(pos/(ra*ra));}\n#define PI 3.1415926538\n#define ATMOS_HEIGHT float(${ATMOS_HEIGHT})\n#define RAYLEIGH_SCALE float(${RAYLEIGH_SCALE})\n#define MIE_SCALE float(${MIE_SCALE})\n#define SAMPLE_COUNT 16\n#define SQRT_SAMPLE_COUNT 4\nconst float GROUND_ALBEDO=float(${GROUND_ALBEDO})/PI;const float BOTTOM_RADIUS=float(${BOTTOM_RADIUS});const float TOP_RADIUS=BOTTOM_RADIUS+ATMOS_HEIGHT;const float EQUATORIAL_RADIUS=6378137.0;const vec3 bottomRadii=vec3(EQUATORIAL_RADIUS,EQUATORIAL_RADIUS,BOTTOM_RADIUS);const vec3 topRadii=bottomRadii+ATMOS_HEIGHT;const vec3 SPHERE_TO_ELLIPSOID_SCALE=vec3(BOTTOM_RADIUS)/bottomRadii;const vec2 rayleighMieHeights=vec2(RAYLEIGH_SCALE,MIE_SCALE)*ATMOS_HEIGHT;const vec3 rayleighScatteringCoefficient=vec3(float(${rayleighScatteringCoefficient_0}),float(${rayleighScatteringCoefficient_1}),float(${rayleighScatteringCoefficient_2}))*1e-6;const float mieScatteringCoefficient=float(${mieScatteringCoefficient})*1e-6;const float mieExtinctionCoefficient=float(${mieExtinctionCoefficient})*1e-6;const vec3 ozoneAbsorptionCoefficient=vec3(float(${ozoneAbsorptionCoefficient_0}),float(${ozoneAbsorptionCoefficient_1}),float(${ozoneAbsorptionCoefficient_2}))*1e-6;const float SUN_ANGULAR_RADIUS=float(${SUN_ANGULAR_RADIUS});const float SUN_INTENSITY=float(${SUN_INTENSITY});const float ozoneDensityHeight=float(${ozoneDensityHeight});const float ozoneDensityWide=float(${ozoneDensityWide});vec3 sunWithBloom(vec3 rayDir,vec3 sunDir){float minSunCosTheta=cos(SUN_ANGULAR_RADIUS);float cosTheta=dot(rayDir,sunDir);if(cosTheta>=minSunCosTheta)return vec3(1.0);float offset=minSunCosTheta-cosTheta;float gaussianBloom=exp(-offset*15000.0)*0.7;float invBloom=1.0/(0.09+offset*200.0)*0.01;return vec3(gaussianBloom+invBloom);}vec3 sunWithBloomScaled(vec3 rayDir,vec3 sunDir,float angularScale){float minSunCosTheta=cos(SUN_ANGULAR_RADIUS*angularScale);float cosTheta=dot(rayDir,sunDir);if(cosTheta>=minSunCosTheta)return vec3(1.0);float offset=minSunCosTheta-cosTheta;float gaussianBloom=exp(-offset*15000.0)*0.7;float invBloom=1.0/(0.09+offset*200.0)*0.01;return vec3(gaussianBloom+invBloom);}float rayleighPhase(float angle){return 3.0/(16.0*PI)*(1.0+(angle*angle));}float miePhase(float angle){float g=0.8;return 3.0/(8.0*PI)*((1.0-g*g)*(1.0+angle*angle))/((2.0+g*g)*pow(1.0+g*g-2.0*g*angle,1.5));}vec3 opticalDepth(float height,float angle){vec3 rayOrigin=vec3(0.0,BOTTOM_RADIUS+height,0.0);vec3 rayDirection=vec3(sqrt(1.0-angle*angle),angle,0.0);float t1,t2;intersectSphere(rayOrigin,rayDirection,TOP_RADIUS,t1,t2);float segmentLength=t2/float(SAMPLE_COUNT);float t=segmentLength*0.5;vec3 opticalDepth=vec3(0.0);for(int i=0;i<SAMPLE_COUNT;i++){vec3 position=rayOrigin+t*rayDirection;float height=length(position)-BOTTOM_RADIUS;opticalDepth.xy+=exp(-height/rayleighMieHeights)*segmentLength;opticalDepth.z+=(1.0-min(abs(height-ozoneDensityHeight)/ozoneDensityWide,1.0))*segmentLength;t+=segmentLength;}return opticalDepth;}vec3 transmittance(float height,float angle){vec3 opticalDepth=opticalDepth(height,angle);return exp(-(rayleighScatteringCoefficient*opticalDepth.x+mieExtinctionCoefficient*opticalDepth.y+ozoneAbsorptionCoefficient*opticalDepth.z));}uniform vec4 specular;uniform vec3 diffuse;uniform vec3 ambient;uniform vec3 lightPosition;uniform sampler2D uNormalMap;uniform sampler2D nightTexture;uniform sampler2D specularTexture;uniform sampler2D transmittanceTexture;uniform sampler2D scatteringTexture;uniform sampler2D defaultTexture;uniform sampler2D samplerArr[SLICE_SIZE];uniform vec4 tileOffsetArr[SLICE_SIZE];uniform float layerOpacityArr[SLICE_SIZE];uniform int samplerCount;uniform float nightTextureCoefficient;uniform vec2 maxMinOpacity;uniform float camHeight;uniform float transitionOpacity;in vec4 vTextureCoord;in vec3 v_vertex;in vec3 cameraPosition;in vec2 vGlobalTextureCoord;in float v_height;vec3 sunPos;layout(location=0)out vec4 diffuseColor;vec3 transmittanceFromTexture(float height,float angle){float u=(angle+1.0)*0.5;float v=height/ATMOS_HEIGHT;return texture(transmittanceTexture,vec2(u,v)).xyz;}vec3 multipleScatteringContributionFromTexture(float height,float angle){float u=(angle+1.0)*0.5;float v=height/ATMOS_HEIGHT;return texture(scatteringTexture,vec2(u,v)).xyz;}void getSunIlluminance(in vec3 point,in vec3 lightDir,out vec3 sunIlluminance){float mu_s=dot(normalize(point),lightDir);float height=length(point)-BOTTOM_RADIUS;sunIlluminance=SUN_INTENSITY*transmittanceFromTexture(height,mu_s);}void atmosGroundColor(out vec4 fragColor,in vec3 normal){vec3 cameraPosition=cameraPosition;if(length(cameraPosition*SPHERE_TO_ELLIPSOID_SCALE)<BOTTOM_RADIUS+1.0){cameraPosition=normalize(cameraPosition*SPHERE_TO_ELLIPSOID_SCALE)*(BOTTOM_RADIUS+1.0)/SPHERE_TO_ELLIPSOID_SCALE;}vec3 rayDirection=normalize(v_vertex-cameraPosition);vec3 lightDir=normalize(sunPos);rayDirection=normalize(rayDirection*SPHERE_TO_ELLIPSOID_SCALE);vec3 camPos=cameraPosition*SPHERE_TO_ELLIPSOID_SCALE;lightDir=normalize(lightDir*SPHERE_TO_ELLIPSOID_SCALE);vec3 light=vec3(0.0);vec3 transmittanceFromCameraToSpace=vec3(1.0);float offset=0.0;float distanceToSpace=0.0;intersectSphere(camPos,rayDirection,TOP_RADIUS,offset,distanceToSpace);vec3 rayOrigin=camPos;if(offset>0.0){rayOrigin+=rayDirection*offset;}float height=length(rayOrigin)-BOTTOM_RADIUS;float rayAngle=dot(rayOrigin,rayDirection)/length(rayOrigin);bool cameraBelow=rayAngle<0.0;transmittanceFromCameraToSpace=transmittanceFromTexture(height,cameraBelow ?-rayAngle : rayAngle);float phaseAngle=dot(lightDir,rayDirection);float rayleighPhase=rayleighPhase(phaseAngle);float miePhase=miePhase(phaseAngle);float distanceToGround=0.0;bool hitGround=intersectSphere(camPos,rayDirection,BOTTOM_RADIUS,distanceToGround)&&distanceToGround>0.0;if(length(v_vertex*SPHERE_TO_ELLIPSOID_SCALE)>BOTTOM_RADIUS){distanceToGround=distance(camPos,v_vertex*SPHERE_TO_ELLIPSOID_SCALE);}float segmentLength=(distanceToGround-max(offset,0.0))/float(SAMPLE_COUNT);float t=segmentLength*0.5;vec3 transmittanceCamera;vec3 transmittanceLight;for(int i=0;i<SAMPLE_COUNT;i++){vec3 position=rayOrigin+t*rayDirection;float height=length(position)-BOTTOM_RADIUS;vec3 up=position/length(position);float rayAngle=dot(up,rayDirection);float lightAngle=dot(up,lightDir);vec3 transmittanceToSpace=transmittanceFromTexture(height,cameraBelow ?-rayAngle : rayAngle);transmittanceCamera=cameraBelow ?(transmittanceToSpace/transmittanceFromCameraToSpace):(transmittanceFromCameraToSpace/transmittanceToSpace);transmittanceLight=transmittanceFromTexture(height,lightAngle);vec2 opticalDensity=exp(-height/rayleighMieHeights);vec3 scatteredLight=transmittanceLight*(rayleighScatteringCoefficient*opticalDensity.x*rayleighPhase+mieScatteringCoefficient*opticalDensity.y*miePhase);scatteredLight+=multipleScatteringContributionFromTexture(height,lightAngle)*(rayleighScatteringCoefficient*opticalDensity.x+mieScatteringCoefficient*opticalDensity.y);light+=transmittanceCamera*scatteredLight*segmentLength;t+=segmentLength;}light*=SUN_INTENSITY;vec3 hitPoint=camPos+rayDirection*distanceToGround;vec3 up=normalize(hitPoint);float diffuseAngle=max(dot(up,lightDir),0.0);float lightAngle=dot(normal,lightDir);vec3 tA=transmittanceCamera*GROUND_ALBEDO*SUN_INTENSITY;vec3 scatteringLight=multipleScatteringContributionFromTexture(height,lightAngle);vec3 diffuseTransmittanceLight=transmittanceLight*diffuseAngle;light+=tA*(scatteringLight+diffuseTransmittanceLight);fragColor=vec4(pow(light*8.0,vec3(1.0/2.2)),1.0);}void getAtmosFadingOpacity(out float opacity){float c=length(cameraPosition);float maxDist=sqrt(c*c-BOTTOM_RADIUS*BOTTOM_RADIUS);float minDist=c-BOTTOM_RADIUS;float vertDist=distance(cameraPosition,v_vertex);opacity=clamp(maxMinOpacity.y+(maxMinOpacity.x-maxMinOpacity.y)*getLerpValue(minDist,maxDist,vertDist),0.0,1.0);}void main(void){sunPos=lightPosition;vec3 texNormal=texture(uNormalMap,vTextureCoord.zw).rgb;vec3 normal=normalize((texNormal-0.5)*2.0);float minH=1200000.0;float maxH=minH*3.0;float nightCoef=getLerpValue(minH,maxH,camHeight)*nightTextureCoefficient;vec3 lightDir=normalize(sunPos);vec3 viewDir=normalize(cameraPosition-v_vertex);vec4 atmosColor;atmosGroundColor(atmosColor,normal);vec3 sunIlluminance;getSunIlluminance(v_vertex*SPHERE_TO_ELLIPSOID_SCALE,lightDir*SPHERE_TO_ELLIPSOID_SCALE,sunIlluminance);float overGround=1.0-step(0.1,v_height);float shininess=texture(specularTexture,vGlobalTextureCoord.st).r*255.0*overGround;vec3 reflectionDirection=reflect(-lightDir,normal);float reflection=max(dot(reflectionDirection,viewDir),0.0);vec3 spec=sunIlluminance*specular.rgb*pow(reflection,specular.w)*shininess;float diffuseLightWeighting=max(dot(normal,lightDir),0.0);vec4 nightImageColor=texture(nightTexture,vGlobalTextureCoord.st);vec3 night=nightStep*(.18-diffuseLightWeighting*3.0)*nightImageColor.rgb*nightCoef;night*=overGround*step(0.0,night);vec4 lightWeighting=vec4(ambient+sunIlluminance*diffuse*diffuseLightWeighting+night,1.0);float fadingOpacity;getAtmosFadingOpacity(fadingOpacity);getSunIlluminance(cameraPosition,viewDir*SPHERE_TO_ELLIPSOID_SCALE,sunIlluminance);spec*=sunIlluminance;diffuseColor=texture(defaultTexture,vTextureCoord.xy);if(samplerCount==0){diffuseColor=mix(diffuseColor*lightWeighting,atmosColor,fadingOpacity)+vec4(spec,0.0);diffuseColor*=transitionOpacity;return;}vec4 src;blend(diffuseColor,samplerArr[0],tileOffsetArr[0],layerOpacityArr[0]);if(samplerCount==1){diffuseColor=mix(diffuseColor*lightWeighting,atmosColor*diffuseColor.a,fadingOpacity)+vec4(spec,0.0);diffuseColor*=transitionOpacity;return;}blend(diffuseColor,samplerArr[1],tileOffsetArr[1],layerOpacityArr[1]);if(samplerCount==2){diffuseColor=mix(diffuseColor*lightWeighting,atmosColor*diffuseColor.a,fadingOpacity)+vec4(spec,0.0);diffuseColor*=transitionOpacity;return;}blend(diffuseColor,samplerArr[2],tileOffsetArr[2],layerOpacityArr[2]);if(samplerCount==3){diffuseColor=mix(diffuseColor*lightWeighting,atmosColor*diffuseColor.a,fadingOpacity)+vec4(spec,0.0);diffuseColor*=transitionOpacity;return;}blend(diffuseColor,samplerArr[3],tileOffsetArr[3],layerOpacityArr[3]);if(samplerCount==4){diffuseColor=mix(diffuseColor*lightWeighting,atmosColor*diffuseColor.a,fadingOpacity)+vec4(spec,0.0);diffuseColor*=transitionOpacity;return;}blend(diffuseColor,samplerArr[4],tileOffsetArr[4],layerOpacityArr[4]);diffuseColor=mix(diffuseColor*lightWeighting,atmosColor*diffuseColor.a,fadingOpacity)+vec4(spec,0.0);diffuseColor*=transitionOpacity;}",a)})}var Oh="attribute vec2 corners;void main(void){gl_Position=vec4(corners,0.0,1.0);}",Nh="precision lowp float;float getLerpValue(in float min,in float max,in float between){return(clamp(between,min,max)-min)/(max-min);}vec3 aces(vec3 color){float a=2.51;float b=0.03;float c=2.43;float d=0.59;float e=0.14;return clamp((color*(a*color+b))/(color*(c*color+d)+e),0.0,1.0);}bool intersectSphere(vec3 rayOrigin,vec3 rayDirection,float radius,inout float t1,inout float t2){float b=dot(rayDirection,rayOrigin);float c=dot(rayOrigin,rayOrigin)-radius*radius;float d=b*b-c;if(d<0.0){return false;}t1=-b-sqrt(d);t2=-b+sqrt(d);return true;}bool intersectSphere(vec3 rayOrigin,vec3 rayDirection,float radius,inout float t){float b=dot(rayDirection,rayOrigin);float c=dot(rayOrigin,rayOrigin)-radius*radius;float d=b*b-c;if(d<0.0){return false;}t=-b-sqrt(d);return true;}float intersectSphere(vec3 ro,vec3 rd,vec4 sph){vec3 oc=ro-sph.xyz;float b=dot(oc,rd);float c=dot(oc,oc)-sph.w*sph.w;float h=b*b-c;if(h<0.0)return-1.0;h=sqrt(h);return-b-h;}bool intersectEllipsoid(in vec3 ro,in vec3 rd,in vec3 ra,inout float t){vec3 ocn=ro/ra;vec3 rdn=rd/ra;float a=dot(rdn,rdn);float b=dot(ocn,rdn);float c=dot(ocn,ocn);float h=b*b-a*(c-1.0);if(h<0.0){return false;}t=(-b-sqrt(h))/a;return true;}bool intersectEllipsoid(in vec3 ro,in vec3 rd,in vec3 ra,inout float t1,inout float t2){vec3 ocn=ro/ra;vec3 rdn=rd/ra;float a=dot(rdn,rdn);float b=dot(ocn,rdn);float c=dot(ocn,ocn);float h=b*b-a*(c-1.0);if(h<0.0){return false;}h=sqrt(h);t1=(-b-h)/a;t2=(-b+h)/a;return true;}vec3 normalEllipsoid(in vec3 pos,in vec3 ra){return normalize(pos/(ra*ra));}\n#define PI 3.1415926538\n#define ATMOS_HEIGHT float(${ATMOS_HEIGHT})\n#define RAYLEIGH_SCALE float(${RAYLEIGH_SCALE})\n#define MIE_SCALE float(${MIE_SCALE})\n#define SAMPLE_COUNT 16\n#define SQRT_SAMPLE_COUNT 4\nconst float GROUND_ALBEDO=float(${GROUND_ALBEDO})/PI;const float BOTTOM_RADIUS=float(${BOTTOM_RADIUS});const float TOP_RADIUS=BOTTOM_RADIUS+ATMOS_HEIGHT;const float EQUATORIAL_RADIUS=6378137.0;const vec3 bottomRadii=vec3(EQUATORIAL_RADIUS,EQUATORIAL_RADIUS,BOTTOM_RADIUS);const vec3 topRadii=bottomRadii+ATMOS_HEIGHT;const vec3 SPHERE_TO_ELLIPSOID_SCALE=vec3(BOTTOM_RADIUS)/bottomRadii;const vec2 rayleighMieHeights=vec2(RAYLEIGH_SCALE,MIE_SCALE)*ATMOS_HEIGHT;const vec3 rayleighScatteringCoefficient=vec3(float(${rayleighScatteringCoefficient_0}),float(${rayleighScatteringCoefficient_1}),float(${rayleighScatteringCoefficient_2}))*1e-6;const float mieScatteringCoefficient=float(${mieScatteringCoefficient})*1e-6;const float mieExtinctionCoefficient=float(${mieExtinctionCoefficient})*1e-6;const vec3 ozoneAbsorptionCoefficient=vec3(float(${ozoneAbsorptionCoefficient_0}),float(${ozoneAbsorptionCoefficient_1}),float(${ozoneAbsorptionCoefficient_2}))*1e-6;const float SUN_ANGULAR_RADIUS=float(${SUN_ANGULAR_RADIUS});const float SUN_INTENSITY=float(${SUN_INTENSITY});const float ozoneDensityHeight=float(${ozoneDensityHeight});const float ozoneDensityWide=float(${ozoneDensityWide});vec3 sunWithBloom(vec3 rayDir,vec3 sunDir){float minSunCosTheta=cos(SUN_ANGULAR_RADIUS);float cosTheta=dot(rayDir,sunDir);if(cosTheta>=minSunCosTheta)return vec3(1.0);float offset=minSunCosTheta-cosTheta;float gaussianBloom=exp(-offset*15000.0)*0.7;float invBloom=1.0/(0.09+offset*200.0)*0.01;return vec3(gaussianBloom+invBloom);}vec3 sunWithBloomScaled(vec3 rayDir,vec3 sunDir,float angularScale){float minSunCosTheta=cos(SUN_ANGULAR_RADIUS*angularScale);float cosTheta=dot(rayDir,sunDir);if(cosTheta>=minSunCosTheta)return vec3(1.0);float offset=minSunCosTheta-cosTheta;float gaussianBloom=exp(-offset*15000.0)*0.7;float invBloom=1.0/(0.09+offset*200.0)*0.01;return vec3(gaussianBloom+invBloom);}float rayleighPhase(float angle){return 3.0/(16.0*PI)*(1.0+(angle*angle));}float miePhase(float angle){float g=0.8;return 3.0/(8.0*PI)*((1.0-g*g)*(1.0+angle*angle))/((2.0+g*g)*pow(1.0+g*g-2.0*g*angle,1.5));}vec3 opticalDepth(float height,float angle){vec3 rayOrigin=vec3(0.0,BOTTOM_RADIUS+height,0.0);vec3 rayDirection=vec3(sqrt(1.0-angle*angle),angle,0.0);float t1,t2;intersectSphere(rayOrigin,rayDirection,TOP_RADIUS,t1,t2);float segmentLength=t2/float(SAMPLE_COUNT);float t=segmentLength*0.5;vec3 opticalDepth=vec3(0.0);for(int i=0;i<SAMPLE_COUNT;i++){vec3 position=rayOrigin+t*rayDirection;float height=length(position)-BOTTOM_RADIUS;opticalDepth.xy+=exp(-height/rayleighMieHeights)*segmentLength;opticalDepth.z+=(1.0-min(abs(height-ozoneDensityHeight)/ozoneDensityWide,1.0))*segmentLength;t+=segmentLength;}return opticalDepth;}vec3 transmittance(float height,float angle){vec3 opticalDepth=opticalDepth(height,angle);return exp(-(rayleighScatteringCoefficient*opticalDepth.x+mieExtinctionCoefficient*opticalDepth.y+ozoneAbsorptionCoefficient*opticalDepth.z));}\n#define DISABLE_SUN_DISK ${ disableSunDisk }\nuniform mat4 viewMatrix;uniform vec3 sunPos;uniform vec3 camPos;uniform vec2 iResolution;uniform float fov;uniform float opacity;uniform float isOrthographic;uniform vec4 frustumParams;uniform sampler2D transmittanceTexture;uniform sampler2D scatteringTexture;float valueHSV(vec3 rgb){return max(max(rgb.r,rgb.g),rgb.b);}vec3 transmittanceFromTexture(float height,float angle){float u=(angle+1.0)*0.5;float v=height/ATMOS_HEIGHT;return texture2D(transmittanceTexture,vec2(u,v)).xyz;}vec3 multipleScatteringContributionFromTexture(float height,float angle){float u=(angle+1.0)*0.5;float v=height/ATMOS_HEIGHT;return texture2D(scatteringTexture,vec2(u,v)).xyz;}bool intersectEllipsoidToSphere(in vec3 ro,in vec3 rd,in vec3 ellRadii,in float sphereRadius,out float t1,out float t2){float offset=0.0,distanceToSpace=0.0;if(intersectEllipsoid(ro,rd,ellRadii,offset,distanceToSpace)){vec3 hitEll=ro+rd*offset;vec3 nEll=normalEllipsoid(hitEll,ellRadii);float t=0.0;bool intersectsSphere=intersectSphere(hitEll,nEll,sphereRadius,t);vec3 hitSphere=hitEll+nEll*t;t1=length(hitSphere-ro);hitEll=ro+rd*distanceToSpace;nEll=normalEllipsoid(hitEll,ellRadii);t=0.0;intersectsSphere=intersectSphere(hitEll,nEll,sphereRadius,t);hitSphere=hitEll+nEll*t;t2=length(hitSphere-ro);return true;}return false;}mat4 transpose(in mat4 m){vec4 i0=m[0];vec4 i1=m[1];vec4 i2=m[2];vec4 i3=m[3];mat4 outMatrix=mat4(vec4(i0.x,i1.x,i2.x,i3.x),vec4(i0.y,i1.y,i2.y,i3.y),vec4(i0.z,i1.z,i2.z,i3.z),vec4(i0.w,i1.w,i2.w,i3.w));return outMatrix;}void mainImage(out vec4 fragColor){vec3 cameraPosition=camPos;vec3 lightDirection=normalize(sunPos);vec2 uv=(2.0*gl_FragCoord.xy-iResolution.xy)/iResolution.y;vec3 rayDirection;if(isOrthographic!=0.0){float px=uv.x*iResolution.y/iResolution.x;float py=uv.y;float dx=0.5*frustumParams.x*px;float dy=0.5*frustumParams.y*py;mat4 viewMatrixT=transpose(viewMatrix);vec3 right=normalize(viewMatrixT[0].xyz);vec3 up=normalize(viewMatrixT[1].xyz);vec3 backward=normalize(viewMatrixT[2].xyz);vec3 forward=-backward;rayDirection=forward;cameraPosition=cameraPosition+right*dx+up*dy;}else{float fieldOfView=fov;float z=1.0/tan(fieldOfView*0.5*PI/180.0);rayDirection=normalize(vec3(uv,-z));vec4 rd=transpose(viewMatrix)*vec4(rayDirection,1.0);rayDirection=rd.xyz;}vec3 light=vec3(0.0);vec3 transmittanceFromCameraToSpace=vec3(1.0);float offset=0.0;float distanceToSpace=0.0;rayDirection=normalize(rayDirection*SPHERE_TO_ELLIPSOID_SCALE);cameraPosition*=SPHERE_TO_ELLIPSOID_SCALE;lightDirection=normalize(lightDirection*SPHERE_TO_ELLIPSOID_SCALE);if(length(cameraPosition)<BOTTOM_RADIUS+100.0){cameraPosition=normalize(cameraPosition)*(BOTTOM_RADIUS+100.0);}if(intersectSphere(cameraPosition,rayDirection,TOP_RADIUS,offset,distanceToSpace)){vec3 rayOrigin=cameraPosition;if(offset>0.0){rayOrigin=cameraPosition+rayDirection*offset;}float height=length(rayOrigin)-BOTTOM_RADIUS;float rayAngle=dot(rayOrigin,rayDirection)/length(rayOrigin);bool cameraBelow=rayAngle<0.0;transmittanceFromCameraToSpace=transmittanceFromTexture(height,cameraBelow ?-rayAngle : rayAngle);float phaseAngle=dot(lightDirection,rayDirection);float rayleighPhase=rayleighPhase(phaseAngle);float miePhase=miePhase(phaseAngle);float distanceToGround=0.0;bool hitGround=intersectSphere(cameraPosition,rayDirection,BOTTOM_RADIUS,distanceToGround)&&distanceToGround>0.0;if(intersectSphere(cameraPosition,rayDirection,BOTTOM_RADIUS-100000.0,distanceToGround)&&hitGround){fragColor=vec4(0.47,0.47,0.5,1.0);return;}float segmentLength=abs(((hitGround ? distanceToGround : distanceToSpace)-max(offset,0.0))/float(SAMPLE_COUNT));float t=segmentLength*0.5;vec3 transmittanceCamera;vec3 transmittanceLight;for(int i=0;i<SAMPLE_COUNT;i++){vec3 position=rayOrigin+t*rayDirection;float height=length(position)-BOTTOM_RADIUS;vec3 up=position/length(position);float rayAngle=dot(up,rayDirection);float lightAngle=dot(up,lightDirection);vec3 transmittanceToSpace=transmittanceFromTexture(height,cameraBelow ?-rayAngle : rayAngle);transmittanceCamera=cameraBelow ?(transmittanceToSpace/transmittanceFromCameraToSpace):(transmittanceFromCameraToSpace/transmittanceToSpace);transmittanceLight=transmittanceFromTexture(height,lightAngle);vec2 opticalDensity=exp(-height/rayleighMieHeights);vec3 scatteredLight=transmittanceLight*(rayleighScatteringCoefficient*opticalDensity.x*rayleighPhase+mieScatteringCoefficient*opticalDensity.y*miePhase);scatteredLight+=multipleScatteringContributionFromTexture(height,lightAngle)*(rayleighScatteringCoefficient*opticalDensity.x+mieScatteringCoefficient*opticalDensity.y);light+=transmittanceCamera*scatteredLight*segmentLength;t+=segmentLength;}light*=SUN_INTENSITY;if(hitGround){vec3 hitPoint=cameraPosition+rayDirection*distanceToGround;vec3 up=hitPoint/length(hitPoint);float diffuseAngle=max(dot(up,lightDirection),0.0);float lightAngle=dot(up,lightDirection);light+=transmittanceCamera*GROUND_ALBEDO*multipleScatteringContributionFromTexture(height,lightAngle)*SUN_INTENSITY;light+=transmittanceCamera*transmittanceLight*GROUND_ALBEDO*diffuseAngle*SUN_INTENSITY;}}\n#if !DISABLE_SUN_DISK\n{float distanceToGround=0.0;bool hitGround=intersectSphere(cameraPosition,rayDirection,BOTTOM_RADIUS,distanceToGround)&&distanceToGround>0.0;if(!hitGround){vec3 sunLum;if(isOrthographic!=0.0){float z=1.0/tan(fov*0.5*PI/180.0);vec3 viewRay=normalize(vec3(uv,-z));vec4 rd=transpose(viewMatrix)*vec4(viewRay,1.0);vec3 pseudoRayDirection=normalize(rd.xyz);const float sunOrthoAngularScale=2.0;sunLum=sunWithBloomScaled(pseudoRayDirection,lightDirection,sunOrthoAngularScale)*vec3(1.0,1.0,0.8);}else{sunLum=sunWithBloom(rayDirection,lightDirection)*vec3(1.0,1.0,0.8);}sunLum=smoothstep(0.002,1.0,sunLum);light+=sunLum*SUN_INTENSITY*transmittanceFromCameraToSpace;}}\n#endif\nvec4 color=vec4(pow(opacity*light*8.0,vec3(1.0/2.2)),valueHSV(light)*clamp(opacity,0.0,1.0));fragColor=color;}void main(void){mainImage(gl_FragColor);}";class Hh extends Z{constructor(e={}){super({name:"Atmosphere",...e}),this._transmittanceBuffer=null,this._scatteringBuffer=null,this.opacity=1,this._parameters={ATMOS_HEIGHT:e.height||1e5,RAYLEIGH_SCALE:e.rayleighScale||.08,MIE_SCALE:e.mieScale||.012,GROUND_ALBEDO:e.groundAlbedo||.05,BOTTOM_RADIUS:e.bottomRadius||6356752314245179e-9,rayleighScatteringCoefficient_0:e.rayleighScatteringCoefficient_0||5.802,rayleighScatteringCoefficient_1:e.rayleighScatteringCoefficient_1||13.558,rayleighScatteringCoefficient_2:e.rayleighScatteringCoefficient_2||33.1,mieScatteringCoefficient:e.mieScatteringCoefficient||3.996,mieExtinctionCoefficient:e.mieExtinctionCoefficient||4.44,ozoneAbsorptionCoefficient_0:e.ozoneAbsorptionCoefficient_0||.65,ozoneAbsorptionCoefficient_1:e.ozoneAbsorptionCoefficient_1||1.881,ozoneAbsorptionCoefficient_2:e.ozoneAbsorptionCoefficient_2||.085,SUN_ANGULAR_RADIUS:e.sunAngularRadius||.004685,SUN_INTENSITY:e.sunIntensity||1,ozoneDensityHeight:e.ozoneDensityHeight||25e3,ozoneDensityWide:e.ozoneDensityWide||15e3,disableSunDisk:e.disableSunDisk}}setParameters(e){this._parameters=JSON.parse(JSON.stringify(e)),this.initLookupTexturesShaders(),this.drawLookupTextures(),this.removeLookupTexturesShaders(),this.initPlanetAtmosphereShader()}get parameters(){return JSON.parse(JSON.stringify(this._parameters))}initPlanetAtmosphereShader(){var e;(e=this.planet)==null||e.initAtmosphereShader(this._parameters)}oninit(){this.renderer&&(this._initLookupTextures(),this.initLookupTexturesShaders(),this.drawLookupTextures(),this.removeLookupTexturesShaders(),this.initBackgroundShader(),this.activate())}initLookupTexturesShaders(){var e,t;this.renderer&&(this.renderer.handler.addProgram((e=this._parameters,new $("transmittance",{uniforms:{iResolution:"vec2"},attributes:{a_position:"vec2"},vertexShader:"attribute vec2 a_position;void main(void){gl_Position=vec4(a_position,0.0,1.0);}",fragmentShader:ci("precision highp float;float getLerpValue(in float min,in float max,in float between){return(clamp(between,min,max)-min)/(max-min);}vec3 aces(vec3 color){float a=2.51;float b=0.03;float c=2.43;float d=0.59;float e=0.14;return clamp((color*(a*color+b))/(color*(c*color+d)+e),0.0,1.0);}bool intersectSphere(vec3 rayOrigin,vec3 rayDirection,float radius,inout float t1,inout float t2){float b=dot(rayDirection,rayOrigin);float c=dot(rayOrigin,rayOrigin)-radius*radius;float d=b*b-c;if(d<0.0){return false;}t1=-b-sqrt(d);t2=-b+sqrt(d);return true;}bool intersectSphere(vec3 rayOrigin,vec3 rayDirection,float radius,inout float t){float b=dot(rayDirection,rayOrigin);float c=dot(rayOrigin,rayOrigin)-radius*radius;float d=b*b-c;if(d<0.0){return false;}t=-b-sqrt(d);return true;}float intersectSphere(vec3 ro,vec3 rd,vec4 sph){vec3 oc=ro-sph.xyz;float b=dot(oc,rd);float c=dot(oc,oc)-sph.w*sph.w;float h=b*b-c;if(h<0.0)return-1.0;h=sqrt(h);return-b-h;}bool intersectEllipsoid(in vec3 ro,in vec3 rd,in vec3 ra,inout float t){vec3 ocn=ro/ra;vec3 rdn=rd/ra;float a=dot(rdn,rdn);float b=dot(ocn,rdn);float c=dot(ocn,ocn);float h=b*b-a*(c-1.0);if(h<0.0){return false;}t=(-b-sqrt(h))/a;return true;}bool intersectEllipsoid(in vec3 ro,in vec3 rd,in vec3 ra,inout float t1,inout float t2){vec3 ocn=ro/ra;vec3 rdn=rd/ra;float a=dot(rdn,rdn);float b=dot(ocn,rdn);float c=dot(ocn,ocn);float h=b*b-a*(c-1.0);if(h<0.0){return false;}h=sqrt(h);t1=(-b-h)/a;t2=(-b+h)/a;return true;}vec3 normalEllipsoid(in vec3 pos,in vec3 ra){return normalize(pos/(ra*ra));}\n#define PI 3.1415926538\n#define ATMOS_HEIGHT float(${ATMOS_HEIGHT})\n#define RAYLEIGH_SCALE float(${RAYLEIGH_SCALE})\n#define MIE_SCALE float(${MIE_SCALE})\n#define SAMPLE_COUNT 16\n#define SQRT_SAMPLE_COUNT 4\nconst float GROUND_ALBEDO=float(${GROUND_ALBEDO})/PI;const float BOTTOM_RADIUS=float(${BOTTOM_RADIUS});const float TOP_RADIUS=BOTTOM_RADIUS+ATMOS_HEIGHT;const float EQUATORIAL_RADIUS=6378137.0;const vec3 bottomRadii=vec3(EQUATORIAL_RADIUS,EQUATORIAL_RADIUS,BOTTOM_RADIUS);const vec3 topRadii=bottomRadii+ATMOS_HEIGHT;const vec3 SPHERE_TO_ELLIPSOID_SCALE=vec3(BOTTOM_RADIUS)/bottomRadii;const vec2 rayleighMieHeights=vec2(RAYLEIGH_SCALE,MIE_SCALE)*ATMOS_HEIGHT;const vec3 rayleighScatteringCoefficient=vec3(float(${rayleighScatteringCoefficient_0}),float(${rayleighScatteringCoefficient_1}),float(${rayleighScatteringCoefficient_2}))*1e-6;const float mieScatteringCoefficient=float(${mieScatteringCoefficient})*1e-6;const float mieExtinctionCoefficient=float(${mieExtinctionCoefficient})*1e-6;const vec3 ozoneAbsorptionCoefficient=vec3(float(${ozoneAbsorptionCoefficient_0}),float(${ozoneAbsorptionCoefficient_1}),float(${ozoneAbsorptionCoefficient_2}))*1e-6;const float SUN_ANGULAR_RADIUS=float(${SUN_ANGULAR_RADIUS});const float SUN_INTENSITY=float(${SUN_INTENSITY});const float ozoneDensityHeight=float(${ozoneDensityHeight});const float ozoneDensityWide=float(${ozoneDensityWide});vec3 sunWithBloom(vec3 rayDir,vec3 sunDir){float minSunCosTheta=cos(SUN_ANGULAR_RADIUS);float cosTheta=dot(rayDir,sunDir);if(cosTheta>=minSunCosTheta)return vec3(1.0);float offset=minSunCosTheta-cosTheta;float gaussianBloom=exp(-offset*15000.0)*0.7;float invBloom=1.0/(0.09+offset*200.0)*0.01;return vec3(gaussianBloom+invBloom);}vec3 sunWithBloomScaled(vec3 rayDir,vec3 sunDir,float angularScale){float minSunCosTheta=cos(SUN_ANGULAR_RADIUS*angularScale);float cosTheta=dot(rayDir,sunDir);if(cosTheta>=minSunCosTheta)return vec3(1.0);float offset=minSunCosTheta-cosTheta;float gaussianBloom=exp(-offset*15000.0)*0.7;float invBloom=1.0/(0.09+offset*200.0)*0.01;return vec3(gaussianBloom+invBloom);}float rayleighPhase(float angle){return 3.0/(16.0*PI)*(1.0+(angle*angle));}float miePhase(float angle){float g=0.8;return 3.0/(8.0*PI)*((1.0-g*g)*(1.0+angle*angle))/((2.0+g*g)*pow(1.0+g*g-2.0*g*angle,1.5));}vec3 opticalDepth(float height,float angle){vec3 rayOrigin=vec3(0.0,BOTTOM_RADIUS+height,0.0);vec3 rayDirection=vec3(sqrt(1.0-angle*angle),angle,0.0);float t1,t2;intersectSphere(rayOrigin,rayDirection,TOP_RADIUS,t1,t2);float segmentLength=t2/float(SAMPLE_COUNT);float t=segmentLength*0.5;vec3 opticalDepth=vec3(0.0);for(int i=0;i<SAMPLE_COUNT;i++){vec3 position=rayOrigin+t*rayDirection;float height=length(position)-BOTTOM_RADIUS;opticalDepth.xy+=exp(-height/rayleighMieHeights)*segmentLength;opticalDepth.z+=(1.0-min(abs(height-ozoneDensityHeight)/ozoneDensityWide,1.0))*segmentLength;t+=segmentLength;}return opticalDepth;}vec3 transmittance(float height,float angle){vec3 opticalDepth=opticalDepth(height,angle);return exp(-(rayleighScatteringCoefficient*opticalDepth.x+mieExtinctionCoefficient*opticalDepth.y+ozoneAbsorptionCoefficient*opticalDepth.z));}uniform vec2 iResolution;void main(void){vec2 uv=gl_FragCoord.xy/iResolution.xy;float height=uv.y*ATMOS_HEIGHT;float angle=uv.x*2.0-1.0;gl_FragColor=vec4(transmittance(height,angle),1.0);}",e)}))),this.renderer.handler.addProgram((t=this._parameters,new $("scattering",{uniforms:{iResolution:"vec2",transmittanceTexture:"sampler2d"},attributes:{a_position:"vec2"},vertexShader:"attribute vec2 a_position;void main(void){gl_Position=vec4(a_position,0.0,1.0);}",fragmentShader:ci("precision highp float;float getLerpValue(in float min,in float max,in float between){return(clamp(between,min,max)-min)/(max-min);}vec3 aces(vec3 color){float a=2.51;float b=0.03;float c=2.43;float d=0.59;float e=0.14;return clamp((color*(a*color+b))/(color*(c*color+d)+e),0.0,1.0);}bool intersectSphere(vec3 rayOrigin,vec3 rayDirection,float radius,inout float t1,inout float t2){float b=dot(rayDirection,rayOrigin);float c=dot(rayOrigin,rayOrigin)-radius*radius;float d=b*b-c;if(d<0.0){return false;}t1=-b-sqrt(d);t2=-b+sqrt(d);return true;}bool intersectSphere(vec3 rayOrigin,vec3 rayDirection,float radius,inout float t){float b=dot(rayDirection,rayOrigin);float c=dot(rayOrigin,rayOrigin)-radius*radius;float d=b*b-c;if(d<0.0){return false;}t=-b-sqrt(d);return true;}float intersectSphere(vec3 ro,vec3 rd,vec4 sph){vec3 oc=ro-sph.xyz;float b=dot(oc,rd);float c=dot(oc,oc)-sph.w*sph.w;float h=b*b-c;if(h<0.0)return-1.0;h=sqrt(h);return-b-h;}bool intersectEllipsoid(in vec3 ro,in vec3 rd,in vec3 ra,inout float t){vec3 ocn=ro/ra;vec3 rdn=rd/ra;float a=dot(rdn,rdn);float b=dot(ocn,rdn);float c=dot(ocn,ocn);float h=b*b-a*(c-1.0);if(h<0.0){return false;}t=(-b-sqrt(h))/a;return true;}bool intersectEllipsoid(in vec3 ro,in vec3 rd,in vec3 ra,inout float t1,inout float t2){vec3 ocn=ro/ra;vec3 rdn=rd/ra;float a=dot(rdn,rdn);float b=dot(ocn,rdn);float c=dot(ocn,ocn);float h=b*b-a*(c-1.0);if(h<0.0){return false;}h=sqrt(h);t1=(-b-h)/a;t2=(-b+h)/a;return true;}vec3 normalEllipsoid(in vec3 pos,in vec3 ra){return normalize(pos/(ra*ra));}\n#define PI 3.1415926538\n#define ATMOS_HEIGHT float(${ATMOS_HEIGHT})\n#define RAYLEIGH_SCALE float(${RAYLEIGH_SCALE})\n#define MIE_SCALE float(${MIE_SCALE})\n#define SAMPLE_COUNT 16\n#define SQRT_SAMPLE_COUNT 4\nconst float GROUND_ALBEDO=float(${GROUND_ALBEDO})/PI;const float BOTTOM_RADIUS=float(${BOTTOM_RADIUS});const float TOP_RADIUS=BOTTOM_RADIUS+ATMOS_HEIGHT;const float EQUATORIAL_RADIUS=6378137.0;const vec3 bottomRadii=vec3(EQUATORIAL_RADIUS,EQUATORIAL_RADIUS,BOTTOM_RADIUS);const vec3 topRadii=bottomRadii+ATMOS_HEIGHT;const vec3 SPHERE_TO_ELLIPSOID_SCALE=vec3(BOTTOM_RADIUS)/bottomRadii;const vec2 rayleighMieHeights=vec2(RAYLEIGH_SCALE,MIE_SCALE)*ATMOS_HEIGHT;const vec3 rayleighScatteringCoefficient=vec3(float(${rayleighScatteringCoefficient_0}),float(${rayleighScatteringCoefficient_1}),float(${rayleighScatteringCoefficient_2}))*1e-6;const float mieScatteringCoefficient=float(${mieScatteringCoefficient})*1e-6;const float mieExtinctionCoefficient=float(${mieExtinctionCoefficient})*1e-6;const vec3 ozoneAbsorptionCoefficient=vec3(float(${ozoneAbsorptionCoefficient_0}),float(${ozoneAbsorptionCoefficient_1}),float(${ozoneAbsorptionCoefficient_2}))*1e-6;const float SUN_ANGULAR_RADIUS=float(${SUN_ANGULAR_RADIUS});const float SUN_INTENSITY=float(${SUN_INTENSITY});const float ozoneDensityHeight=float(${ozoneDensityHeight});const float ozoneDensityWide=float(${ozoneDensityWide});vec3 sunWithBloom(vec3 rayDir,vec3 sunDir){float minSunCosTheta=cos(SUN_ANGULAR_RADIUS);float cosTheta=dot(rayDir,sunDir);if(cosTheta>=minSunCosTheta)return vec3(1.0);float offset=minSunCosTheta-cosTheta;float gaussianBloom=exp(-offset*15000.0)*0.7;float invBloom=1.0/(0.09+offset*200.0)*0.01;return vec3(gaussianBloom+invBloom);}vec3 sunWithBloomScaled(vec3 rayDir,vec3 sunDir,float angularScale){float minSunCosTheta=cos(SUN_ANGULAR_RADIUS*angularScale);float cosTheta=dot(rayDir,sunDir);if(cosTheta>=minSunCosTheta)return vec3(1.0);float offset=minSunCosTheta-cosTheta;float gaussianBloom=exp(-offset*15000.0)*0.7;float invBloom=1.0/(0.09+offset*200.0)*0.01;return vec3(gaussianBloom+invBloom);}float rayleighPhase(float angle){return 3.0/(16.0*PI)*(1.0+(angle*angle));}float miePhase(float angle){float g=0.8;return 3.0/(8.0*PI)*((1.0-g*g)*(1.0+angle*angle))/((2.0+g*g)*pow(1.0+g*g-2.0*g*angle,1.5));}vec3 opticalDepth(float height,float angle){vec3 rayOrigin=vec3(0.0,BOTTOM_RADIUS+height,0.0);vec3 rayDirection=vec3(sqrt(1.0-angle*angle),angle,0.0);float t1,t2;intersectSphere(rayOrigin,rayDirection,TOP_RADIUS,t1,t2);float segmentLength=t2/float(SAMPLE_COUNT);float t=segmentLength*0.5;vec3 opticalDepth=vec3(0.0);for(int i=0;i<SAMPLE_COUNT;i++){vec3 position=rayOrigin+t*rayDirection;float height=length(position)-BOTTOM_RADIUS;opticalDepth.xy+=exp(-height/rayleighMieHeights)*segmentLength;opticalDepth.z+=(1.0-min(abs(height-ozoneDensityHeight)/ozoneDensityWide,1.0))*segmentLength;t+=segmentLength;}return opticalDepth;}vec3 transmittance(float height,float angle){vec3 opticalDepth=opticalDepth(height,angle);return exp(-(rayleighScatteringCoefficient*opticalDepth.x+mieExtinctionCoefficient*opticalDepth.y+ozoneAbsorptionCoefficient*opticalDepth.z));}uniform sampler2D transmittanceTexture;uniform vec2 iResolution;vec3 transmittanceFromTexture(float height,float angle){float u=(angle+1.0)*0.5;float v=height/ATMOS_HEIGHT;return texture2D(transmittanceTexture,vec2(u,v)).xyz;}void main(void){vec2 uv=gl_FragCoord.xy/iResolution.xy;float height=uv.y*ATMOS_HEIGHT;float angle=uv.x*2.0-1.0;vec3 rayOrigin=vec3(0.0,BOTTOM_RADIUS+height,0.0);vec3 up=rayOrigin/length(rayOrigin);vec3 lightDirection=vec3(sqrt(1.0-angle*angle),angle,0.0);const float isotropicPhase=1.0/(4.0*PI);vec3 light=vec3(0.0);vec3 lightTransferFactor=vec3(0.0);for(int i=0;i<SQRT_SAMPLE_COUNT;i++){for(int j=0;j<SQRT_SAMPLE_COUNT;j++){float u=((0.5+float(i))/float(SQRT_SAMPLE_COUNT))*2.0-1.0;float v=(0.5+float(j))/float(SQRT_SAMPLE_COUNT);float r=sqrt(1.0-u*u);float theta=2.0*PI*v;vec3 rayDirection=vec3(cos(theta)*r,sin(theta)*r,u);float rayAngle=dot(up,rayDirection);bool cameraBelow=rayAngle<0.0;vec3 transmittanceFromCameraToSpace=transmittanceFromTexture(height,cameraBelow ?-rayAngle : rayAngle);float offset=0.0;float distanceToSpace=0.0;intersectSphere(rayOrigin,rayDirection,TOP_RADIUS,offset,distanceToSpace);float distanceToGround=0.0;bool hitGround=intersectSphere(rayOrigin,rayDirection,BOTTOM_RADIUS,distanceToGround)&&distanceToGround>0.0;float segmentLength=(hitGround ? distanceToGround : distanceToSpace)/float(SAMPLE_COUNT);float t=segmentLength*0.5;vec3 transmittanceCamera;vec3 transmittanceLight;for(int k=0;k<SAMPLE_COUNT;k++){vec3 position=rayOrigin+t*rayDirection;float height=length(position)-BOTTOM_RADIUS;vec3 up=position/length(position);float rayAngle=dot(up,rayDirection);float lightAngle=dot(up,lightDirection);float distanceToGround;float shadow=intersectSphere(position,lightDirection,BOTTOM_RADIUS,distanceToGround)&&distanceToGround>=0.0 ? 0.0 : 1.0;vec3 transmittanceToSpace=transmittanceFromTexture(height,cameraBelow ?-rayAngle : rayAngle);transmittanceCamera=cameraBelow ?(transmittanceToSpace/transmittanceFromCameraToSpace):(transmittanceFromCameraToSpace/transmittanceToSpace);transmittanceLight=transmittanceFromTexture(height,lightAngle);vec2 opticalDensity=exp(-height/rayleighMieHeights);vec3 scatteredLight=transmittanceLight*(rayleighScatteringCoefficient*opticalDensity.x+mieScatteringCoefficient*opticalDensity.y)*isotropicPhase;light+=shadow*transmittanceCamera*scatteredLight*segmentLength;lightTransferFactor+=transmittanceCamera*(rayleighScatteringCoefficient*opticalDensity.x+mieScatteringCoefficient*opticalDensity.y)*segmentLength;t+=segmentLength;}if(hitGround){vec3 hitPoint=rayOrigin+rayDirection*distanceToGround;vec3 normal=normalize(hitPoint);float diffuseAngle=max(dot(normal,lightDirection),0.0);light+=transmittanceCamera*transmittanceLight*GROUND_ALBEDO*diffuseAngle;}}}light/=float(SAMPLE_COUNT);lightTransferFactor/=float(SAMPLE_COUNT);vec3 color=light/(1.0-lightTransferFactor);gl_FragColor=vec4(color,1.0);}",t)}))))}initBackgroundShader(){var e;this.renderer&&this.renderer.handler.addProgram((e=this._parameters,new $("atmosphereBackground",{uniforms:{iResolution:"vec2",fov:"float",camPos:"vec3",viewMatrix:"mat4",transmittanceTexture:"sampler2D",scatteringTexture:"sampler2D",sunPos:"vec3",opacity:"float",isOrthographic:"float",frustumParams:"vec4"},attributes:{corners:"vec3"},vertexShader:Oh,fragmentShader:ci(Nh,{...e,disableSunDisk:e!=null&&e.disableSunDisk?1:0})})))}removeBackgroundShader(){this.renderer&&this.renderer.handler.removeProgram("atmosphereBackground")}removeLookupTexturesShaders(){var e,t;if(this.renderer){let i=this.renderer.handler;(e=this._scatteringBuffer)!=null&&e.isComplete()&&i.removeProgram("scattering"),(t=this._transmittanceBuffer)!=null&&t.isComplete()&&i.removeProgram("transmittance")}}onactivate(){super.onactivate(),this.planet&&this.planet.events.on("draw",this._drawBackground,this)}ondeactivate(){super.ondeactivate(),this.planet&&this.planet.events.off("draw",this._drawBackground)}_initLookupTextures(){this._transmittanceBuffer=new St(this.renderer.handler,{width:1024,height:1024,useDepth:!1,targets:[{filter:"LINEAR",type:"FLOAT",internalFormat:"RGBA16F"}]}),this._transmittanceBuffer.init(),this._scatteringBuffer=new St(this.renderer.handler,{width:1024,height:1024,useDepth:!1,targets:[{filter:"LINEAR",type:"FLOAT",internalFormat:"RGBA16F"}]}),this._scatteringBuffer.init()}_renderLookupTextures(){if(!this.renderer)return;let e=this.renderer.screenFramePositionBuffer,t=this.renderer.handler,i=t.gl;if(this._transmittanceBuffer){this._transmittanceBuffer.activate();let s=t.programs.transmittance,n=s._program.attributes,o=s._program.uniforms;s.activate(),i.clearColor(0,0,0,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.uniform2fv(o.iResolution,[this._transmittanceBuffer.width,this._transmittanceBuffer.height]),i.bindBuffer(i.ARRAY_BUFFER,e),i.vertexAttribPointer(n.a_position,e.itemSize,i.FLOAT,!1,0,0),i.drawArrays(i.TRIANGLE_STRIP,0,e.numItems),this._transmittanceBuffer.deactivate()}if(this._scatteringBuffer&&this._transmittanceBuffer){this._scatteringBuffer.activate();let s=t.programs.scattering,n=s._program.attributes,o=s._program.uniforms;s.activate(),i.clearColor(0,0,0,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.uniform2fv(o.iResolution,[this._scatteringBuffer.width,this._scatteringBuffer.height]),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this._transmittanceBuffer.textures[0]),i.uniform1i(o.transmittanceTexture,0),i.bindBuffer(i.ARRAY_BUFFER,e),i.vertexAttribPointer(n.a_position,e.itemSize,i.FLOAT,!1,0,0),i.drawArrays(i.TRIANGLE_STRIP,0,e.numItems),this._scatteringBuffer.deactivate()}}drawLookupTextures(){this._renderLookupTextures()}_drawBackground(){let e=this.renderer.handler,t=e.programs.atmosphereBackground,i=t._program,s=i.uniforms,n=e.gl,o=this.renderer,l=this.planet.camera;n.disable(n.DEPTH_TEST),o.enableBlendOneSrcAlpha(),t.activate(),n.bindBuffer(n.ARRAY_BUFFER,o.screenFramePositionBuffer),n.vertexAttribPointer(i.attributes.corners,2,n.FLOAT,!1,0,0),n.activeTexture(n.TEXTURE0),n.bindTexture(n.TEXTURE_2D,this._transmittanceBuffer.textures[0]),n.uniform1i(s.transmittanceTexture,0),n.activeTexture(n.TEXTURE1),n.bindTexture(n.TEXTURE_2D,this._scatteringBuffer.textures[0]),n.uniform1i(s.scatteringTexture,1),n.uniformMatrix4fv(s.viewMatrix,!1,l.getViewMatrix());let h=this.planet.sunPos;n.uniform3fv(s.sunPos,[h.x,h.y,h.z]),n.uniform3fv(s.camPos,[l.eye.x,l.eye.y,l.eye.z]),n.uniform2fv(s.iResolution,[o.sceneFramebuffer.width,o.sceneFramebuffer.height]),n.uniform1f(s.fov,l.getViewAngle()),n.uniform1f(s.opacity,this.opacity);let c=l.frustum;n.uniform1f(s.isOrthographic,l.isOrthographic?1:0),n.uniform4fv(s.frustumParams,[c.right-c.left,c.top-c.bottom,c.right,c.top]),n.drawArrays(n.TRIANGLE_STRIP,0,4),n.enable(n.DEPTH_TEST),o.enableBlendDefault()}}const Ta="degrees",Vh="m";let Uh=0;class an{constructor(e){this.id=Uh++,this.code=e.code,this.units=e.units}equal(e){return e.id===this.id}}const ln=new an({code:"epsg:3857",units:Vh});class Gh{constructor(e){this.segment=e,this.layers=[],this.tileOffsetArr=new Float32Array(e.planet.SLICE_SIZE_4),this.layerOpacityArr=new Float32Array(e.planet.SLICE_SIZE)}clear(){this.layers=null,this.tileOffsetArr=null,this.layerOpacityArr=null}append(e,t){let i=this.layers.length;this.layers.push(e),this.layerOpacityArr[i]=e.screenOpacity;let s=4*i,n=e.applyMaterial(t);this.tileOffsetArr[s]=n[0],this.tileOffsetArr[s+1]=n[1],this.tileOffsetArr[s+2]=n[2],this.tileOffsetArr[s+3]=n[3]}}function Et(a,e,t){return Math.floor(Math.abs(t-a)/e)}function Pi(a,e,t,i){let s=1/(1<<t),n=i.getWidth()*s,o=i.getHeight()*s,l=i.southWest.lon+a*n,h=i.northEast.lat-e*o;return new V(new A(l,h-o),new A(l+n,h))}const Ae=20,Le=300;let ve=new m,ye=new m,tr=new m,Ke=new m,Qe=new m,er=new m,Je=new H,zi=new H;const li=new Array(4);li[0]=0,li[1]=1,li[2]=1,li[3]=0;const hi=new Array(4);hi[0]=!1,hi[1]=!0,hi[2]=!1,hi[3]=!0;class Ca{constructor(e,t,i,s){this.isPole=!1,this._tileGroup=0,this._projection=ln,this.node=e,this.quadTreeStrategy=t,this.planet=t.planet,this.handler=t.planet.renderer.handler,this.bsphere=new Dt,this._plainRadius=0,this.bbox=new Fo,this._sw=new m,this._nw=new m,this._se=new m,this._ne=new m,this.centerNormal=new m,this._extent=this._extentMerc=s,this._extentLonLat=new V,this.gridSize=this.planet.terrain.gridSizeByZoom[i],this.fileGridSize=0,this.tileZoom=i,this.powTileZoom=1<<i,this.tileX=0,this.tileXE=0,this.tileXW=0,this.tileYN=0,this.tileYS=0,this.tileY=0,this.tileIndex="",this.elevationData=null,this._assignTileIndexes(),this.materials=[],this.plainReady=!1,this.initialized=!1,this.normalMapReady=!1,this.terrainReady=!1,this.terrainIsLoading=!1,this.terrainExists=!1,this.passReady=!1,this.plainVertices=null,this.plainVerticesHigh=null,this.plainVerticesLow=null,this.plainNormals=null,this.terrainVertices=null,this.terrainVerticesHigh=null,this.terrainVerticesLow=null,this.noDataVertices=null,this.tempVertices=null,this.tempVerticesHigh=null,this.tempVerticesLow=null,this.normalMapTexture=null,this.normalMapTextureBias=new Float32Array(3),this.normalMapVertices=null,this.normalMapVerticesHigh=null,this.normalMapVerticesLow=null,this.normalMapNormals=null,this.vertexNormalBuffer=null,this.vertexPositionBuffer=null,this.vertexPositionBufferHigh=null,this.vertexPositionBufferLow=null,this.vertexTextureCoordBuffer=null,this._globalTextureCoordinates=new Float32Array(4),this._inTheQueue=!1,this._appliedNeighborsZoom=[0,0,0,0],this._slices=[],this._indexBuffer=null,this.readyToEngage=!1,this.plainProcessing=!1,this.normalMapTexturePtr=null,this._transitionOpacity=1,this._transitionTimestamp=0}checkZoom(){return this.tileZoom<this.planet.terrain._maxNodeZoom}getEntityTerrainPoint(e,t){return this.getTerrainPoint(e._cartesian,this.getInsideLonLat(e),t)}getInsideLonLat(e){return e._lonLatMerc}isEntityInside(e){return this._extentLonLat.isInside(e._lonLat)}getTerrainPoint(e,t,i){let s=this.tempVertices;if(s&&s.length){let n=this.planet.ellipsoid.getSurfaceNormal3v(e);Je.set(e,n.negateTo());let o=this._extent.northEast,l=this._extent.southWest,h=Math.sqrt(s.length/3)-1,c=o.lon,d=o.lat,u=l.lon,f=l.lat,_=(c-u)/h,g=(d-f)/h,v=t.lon-u,p=t.lat-f,y=Math.floor(v/_),b=Math.floor(h-p/g),C=3*((h+1)*b+y),T=3*((h+1)*(b+1)+y);tr.set(s[C],s[C+1],s[C+2]),Ke.set(s[C+3],s[C+4],s[C+5]),Qe.set(s[T],s[T+1],s[T+2]);let w=Je.hitTriangleRes(tr,Ke,Qe,i);return w===H.INSIDE?e.distance(i):w===H.AWAY&&(zi.set(e,n),zi.hitTriangleRes(tr,Ke,Qe,i)===H.INSIDE)?-e.distance(i):(er.set(s[T+3],s[T+4],s[T+5]),w=Je.hitTriangleRes(Ke,er,Qe,i),w===H.INSIDE?e.distance(i):w===H.AWAY&&(zi.set(e,n),zi.hitTriangleRes(Ke,er,Qe,i)===H.INSIDE)||w===H.AWAY?-e.distance(i):e.distance(i))}return e.distance(this.planet.ellipsoid.hitRay(Je.origin,Je.direction))}projectNative(e){return e.forwardMercator()}loadTerrain(e=!1){this.tileZoom<this.planet.terrain.minZoom||this.planet.terrain.isEmpty?(this.terrainIsLoading=!0,this.elevationsNotExists(),this._inTheQueue||this.planet._normalMapCreator.queue(this)):this.tileZoom>this.planet.terrain.maxZoom?this.elevationsNotExists():this.terrainIsLoading||this.terrainReady||this.planet.terrain.loadTerrain(this,e)}elevationsExists(e){if(this.plainReady&&this.terrainIsLoading){let t=new Float32Array(e.length);t.set(e),this.elevationData=new Float32Array(e.length),this.elevationData.set(e),this.planet._terrainWorker.make({segment:this,elevations:t}),this.plainVerticesHigh=null,this.plainVerticesLow=null,this.normalMapVerticesHigh=null,this.normalMapVerticesLow=null,this.planet.terrain.equalizeVertices||(this.tempVerticesHigh=null,this.tempVerticesLow=null)}}elevationsNotExists(){if(this.planet&&this.tileZoom<=this.planet.terrain.maxNativeZoom){if(this.plainReady&&this.terrainIsLoading){this.terrainIsLoading=!1;let e=this.node;e.appliedTerrainNodeId=this.node.nodeId,e.equalizedSideWithNodeId[0]=e.equalizedSideWithNodeId[1]=e.equalizedSideWithNodeId[2]=e.equalizedSideWithNodeId[3]=e.appliedTerrainNodeId,this.planet.lightEnabled&&!this._inTheQueue&&this.planet._normalMapCreator.queue(this),this.readyToEngage=!0}this.terrainVertices=this.plainVertices,this.terrainVerticesHigh=this.plainVerticesHigh,this.terrainVerticesLow=this.plainVerticesLow,this.tempVertices=this.terrainVertices,this.tempVerticesHigh=this.terrainVerticesHigh,this.tempVerticesLow=this.terrainVerticesLow,this.noDataVertices=null,this.fileGridSize=Math.sqrt(this.terrainVertices.length/3)-1,this.gridSize=this.fileGridSize,this.terrainReady=!0,this.terrainExists=!1}else if(this.plainReady&&this.terrainIsLoading){this.terrainIsLoading=!1;let e=this.node;e.appliedTerrainNodeId=this.node.nodeId,e.equalizedSideWithNodeId[0]=e.equalizedSideWithNodeId[1]=e.equalizedSideWithNodeId[2]=e.equalizedSideWithNodeId[3]=e.appliedTerrainNodeId,this.readyToEngage=!0,this.terrainReady=!0,this.passReady=!0,this.terrainExists=!1}}_checkEqualization(e,t){return t&&t.segment&&this.tileZoom>=t.segment.tileZoom&&this.node.equalizedSideWithNodeId[e]!==t.equalizedSideWithNodeId[di[e]]}equalize(){if(this.tileZoom<2||this.gridSize<2)return;this.readyToEngage=!0;let e=this.node.neighbors,t=this.tempVertices,i=this.tempVerticesHigh,s=this.tempVerticesLow,n=this.gridSize,o=n+1,l=e[0][0];if(this._checkEqualization(0,l)){this.node.equalizedSideWithNodeId[0]=l.equalizedSideWithNodeId[2],this.readyToEngage=!0;let h=this.node.getOffsetOppositeNeighbourSide(l,0),c=l.segment.tempVertices,d=l.segment.tempVerticesHigh,u=l.segment.tempVerticesLow,f=l.segment.gridSize,_=f+1,g=1/(1<<this.tileZoom-l.segment.tileZoom),v=Math.max(n/(f*g),1),p=Math.max(f*g/n,1);for(let y=0,b=h*f;y<o;y+=v,b+=p){const C=3*y,T=3*(_*f+b);t[C]=c[T],t[C+1]=c[T+1],t[C+2]=c[T+2],i[C]=d[T],i[C+1]=d[T+1],i[C+2]=d[T+2],s[C]=u[T],s[C+1]=u[T+1],s[C+2]=u[T+2]}}if(l=e[1][0],this._checkEqualization(1,l)){this.node.equalizedSideWithNodeId[1]=l.equalizedSideWithNodeId[3],this.readyToEngage=!0;let h=this.node.getOffsetOppositeNeighbourSide(l,1),c=l.segment.tempVertices,d=l.segment.tempVerticesHigh,u=l.segment.tempVerticesLow,f=l.segment.gridSize,_=f+1,g=1/(1<<this.tileZoom-l.segment.tileZoom),v=Math.max(n/(f*g),1),p=Math.max(f*g/n,1);for(let y=0,b=h*f;y<o;y+=v,b+=p){const C=3*(o*y+n),T=_*b*3;t[C]=c[T],t[C+1]=c[T+1],t[C+2]=c[T+2],i[C]=d[T],i[C+1]=d[T+1],i[C+2]=d[T+2],s[C]=u[T],s[C+1]=u[T+1],s[C+2]=u[T+2]}}if(l=e[2][0],this._checkEqualization(2,l)){this.node.equalizedSideWithNodeId[2]=l.equalizedSideWithNodeId[0],this.readyToEngage=!0;let h=this.node.getOffsetOppositeNeighbourSide(l,2),c=l.segment.tempVertices,d=l.segment.tempVerticesHigh,u=l.segment.tempVerticesLow,f=l.segment.gridSize,_=1/(1<<this.tileZoom-l.segment.tileZoom),g=Math.max(n/(f*_),1),v=Math.max(f*_/n,1);for(let p=0,y=h*f;p<o;p+=g,y+=v){const b=3*(o*n+p),C=3*y;t[b]=c[C],t[b+1]=c[C+1],t[b+2]=c[C+2],i[b]=d[C],i[b+1]=d[C+1],i[b+2]=d[C+2],s[b]=u[C],s[b+1]=u[C+1],s[b+2]=u[C+2]}}if(l=e[3][0],this._checkEqualization(3,l)){this.node.equalizedSideWithNodeId[3]=l.equalizedSideWithNodeId[1],this.readyToEngage=!0;let h=this.node.getOffsetOppositeNeighbourSide(l,3),c=l.segment.tempVertices,d=l.segment.tempVerticesHigh,u=l.segment.tempVerticesLow,f=l.segment.gridSize,_=f+1,g=1/(1<<this.tileZoom-l.segment.tileZoom),v=Math.max(n/(f*g),1),p=Math.max(f*g/n,1);for(let y=0,b=h*f;y<o;y+=v,b+=p){const C=o*y*3,T=3*(_*b+f);t[C]=c[T],t[C+1]=c[T+1],t[C+2]=c[T+2],i[C]=d[T],i[C+1]=d[T+1],i[C+2]=d[T+2],s[C]=u[T],s[C+1]=u[T+1],s[C+2]=u[T+2]}}}engage(){this.readyToEngage=!1,this.createCoordsBuffers(this.tempVerticesHigh,this.tempVerticesLow,this.gridSize)}_terrainWorkerCallback(e){if(this.plainReady){this.readyToEngage=!0,this.normalMapNormals=null,this.normalMapVertices=null,this.normalMapVerticesHigh=null,this.normalMapVerticesLow=null,this.terrainVertices=null,this.terrainVerticesHigh=null,this.terrainVerticesLow=null,this.noDataVertices=null,this.tempVertices=null,this.tempVerticesHigh=null,this.tempVerticesLow=null,this.normalMapNormals=e.normalMapNormals,this.normalMapVertices=e.normalMapVertices,this.normalMapVerticesHigh=e.normalMapVerticesHigh,this.normalMapVerticesLow=e.normalMapVerticesLow,this.terrainVertices=e.terrainVertices,this.terrainVerticesHigh=e.terrainVerticesHigh,this.terrainVerticesLow=e.terrainVerticesLow,this.noDataVertices=e.noDataVertices,this.tempVertices=this.terrainVertices,this.tempVerticesHigh=this.terrainVerticesHigh,this.tempVerticesLow=this.terrainVerticesLow,this.setBoundingVolumeArr(e.bounds),this.gridSize=Math.sqrt(this.terrainVertices.length/3)-1;let t=this.node;if(t.appliedTerrainNodeId=t.nodeId,t.equalizedSideWithNodeId[0]=t.equalizedSideWithNodeId[1]=t.equalizedSideWithNodeId[2]=t.equalizedSideWithNodeId[3]=t.appliedTerrainNodeId,this.terrainReady=!0,this.terrainIsLoading=!1,this.terrainExists=!0,!this.normalMapTexturePtr){const i=this.planet._normalMapCreator;this.normalMapTexturePtr=this.planet.renderer.handler.createEmptyTexture_l(i.width,i.height)}this.planet.lightEnabled&&this.planet._normalMapCreator.queue(this)}}_normalMapEdgeEqualize(e){let t=this.node.neighbors,i=t[e],s=i&&i[0],n=this.planet.terrain.maxZoom;this.tileZoom===n&&i&&!(t[0].length||t[1].length||t[2].length||t[3].length)&&(s=this.node.getEqualNeighbor(e));let o=s&&s.segment,l=this;if(s&&o&&o.terrainReady&&o.terrainExists&&o.tileZoom<=n&&l._appliedNeighborsZoom[e]!==o.tileZoom){l._appliedNeighborsZoom[e]=o.tileZoom;let h=l.normalMapNormals,c=o.normalMapNormals;if(!h||!c)return;let d=l.normalMapNormals,u=o.normalMapNormals,f=Math.sqrt(h.length/3),_=f-1;const g=_*li[e];let v,p,y,b;if(l.tileZoom===o.tileZoom){const C=_-g;if(hi[e])for(let T=0;T<f;T++){let w=3*(T*f+g),L=3*(T*f+C);v=d[w]+u[L],p=d[w+1]+u[L+1],y=d[w+2]+u[L+2],b=1/Math.sqrt(v*v+p*p+y*y),c[L]=h[w]=v*b,c[L+1]=h[w+1]=p*b,c[L+2]=h[w+2]=y*b}else for(let T=0;T<f;T++){let w=3*(g*f+T),L=3*(C*f+T);v=d[w]+u[L],p=d[w+1]+u[L+1],y=d[w+2]+u[L+2],b=1/Math.sqrt(v*v+p*p+y*y),c[L]=h[w]=v*b,c[L+1]=h[w+1]=p*b,c[L+2]=h[w+2]=y*b}o._inTheQueue||o._appliedNeighborsZoom[di[e]]===l.tileZoom||(o._appliedNeighborsZoom[di[e]]=l.tileZoom,l.planet._normalMapCreator.queue(o))}}}applyTerrain(e){e?this.elevationsExists(e):this.elevationsNotExists()}deleteBuffers(){const e=this.handler.gl;e.deleteBuffer(this.vertexNormalBuffer),e.deleteBuffer(this.vertexPositionBuffer),e.deleteBuffer(this.vertexPositionBufferHigh),e.deleteBuffer(this.vertexPositionBufferLow),this.vertexNormalBuffer=null,this.vertexPositionBuffer=null,this.vertexPositionBufferHigh=null,this.vertexPositionBufferLow=null,this.vertexTextureCoordBuffer=null}deleteMaterials(){let e=this.materials;for(let t=0;t<e.length;t++){let i=e[t];i&&i.clear()}this.materials.length=0}deleteElevations(){this.terrainExists=!1,this.terrainReady=!1,this.terrainIsLoading=!1,this.normalMapVertices=null,this.normalMapVerticesHigh=null,this.normalMapVerticesLow=null,this.normalMapNormals=null,this.tempVertices=null,this.tempVerticesHigh=null,this.tempVerticesLow=null,this.terrainVertices=null,this.terrainVerticesHigh=null,this.terrainVerticesLow=null,this.noDataVertices=null,this.plainVertices=null,this.plainVerticesHigh=null,this.plainVerticesLow=null,this.plainNormals=null,this.normalMapReady&&(this.handler.gl.deleteTexture(this.normalMapTexture),this.normalMapReady=!1),this._appliedNeighborsZoom=[0,0,0,0],this.normalMapTextureBias[0]=0,this.normalMapTextureBias[1]=0,this.normalMapTextureBias[2]=1,this._inTheQueue=!1}clearSegment(){this.plainReady=!1,this.initialized=!1,this.deleteBuffers(),this.deleteMaterials(),this.deleteElevations()}childrenInitialized(){let e=this.node.nodes;return e.length===4&&e[0].segment.initialized&&e[1].segment.initialized&&e[2].segment.initialized&&e[3].segment.initialized}destroySegment(){this.clearSegment();let e=this._slices.length;for(;e--;)this._slices[e].clear();this._slices=null,this.node=null,this.planet=null,this.handler=null,this.bbox=null,this.bsphere=null,this._extent=null,this.materials=null,this.plainVertices=null,this.plainVerticesHigh=null,this.plainVerticesLow=null,this.plainNormals=null,this.terrainVertices=null,this.terrainVerticesHigh=null,this.terrainVerticesLow=null,this.noDataVertices=null,this.tempVertices=null,this.tempVerticesHigh=null,this.tempVerticesLow=null,this.normalMapTextureBias=null,this.normalMapTexture=null,this.normalMapVertices=null,this.normalMapVerticesHigh=null,this.normalMapVerticesLow=null,this.normalMapNormals=null,this.vertexNormalBuffer=null,this.vertexPositionBuffer=null,this.vertexPositionBufferHigh=null,this.vertexPositionBufferLow=null,this.vertexTextureCoordBuffer=null,this._projection=null,this._appliedNeighborsZoom=null,this._globalTextureCoordinates=null}_setExtentLonLat(){this._extentLonLat=this._extent.inverseMercator()}_createExtentNormals(){const e=this.planet.ellipsoid,t=this._extentLonLat,i=e.geodeticToCartesian(t.southWest.lon,t.southWest.lat),s=e.geodeticToCartesian(t.northEast.lon,t.northEast.lat),n=e.geodeticToCartesian(t.southWest.lon,t.northEast.lat),o=e.geodeticToCartesian(t.northEast.lon,t.southWest.lat);this._sw.copy(i),this._nw.copy(n),this._ne.copy(s),this._se.copy(o)}createBoundsByExtent(){this._createExtentNormals(),this.setBoundingVolume3v(this._sw,this._ne)}createBoundsByParent(){let e=this.node;for(;e.parentNode&&!e.segment.terrainReady;)e=e.parentNode;let t=1<<this.tileZoom-e.segment.tileZoom,i=this.tileX-e.segment.tileX*t,s=this.tileY-e.segment.tileY*t;if(e.segment.terrainReady&&e.segment.tileZoom>=this.planet.terrain.minZoom){let n=e.segment.gridSize/t;if(n>=1){this.bsphere.center.x=e.segment.bsphere.center.x,this.bsphere.center.y=e.segment.bsphere.center.y,this.bsphere.center.z=e.segment.bsphere.center.z,this.bsphere.radius=e.segment.bsphere.radius;let o=n*s,l=n*i,h=e.segment.gridSize+1,c=3*((o+n)*h+l),d=3*(o*h+l),u=3*(o*h+l+n),f=3*((o+n)*h+l+n),_=e.segment.tempVertices,g=new m(_[c],_[c+1],_[c+2]),v=new m(_[u],_[u+1],_[u+2]),p=new m(_[d],_[d+1],_[d+2]),y=new m(_[f],_[f+1],_[f+2]);this._sw.copy(g),this._nw.copy(p),this._ne.copy(v),this._se.copy(y)}else{let o,l=e.segment,h=Math.floor(n*s),c=Math.floor(n*i),d=1/n,u=s-d*h,f=i-d*c;o=l.gridSize===1?l.tempVertices:Xr(l.tempVertices,l.gridSize,h,c,1);let _,g,v=new m(o[0],o[1],o[2]),p=new m(o[9],o[10],o[11]),y=new m(o[3]-o[0],o[4]-o[1],o[5]-o[2]),b=new m(o[6]-o[0],o[7]-o[1],o[8]-o[2]),C=new m(o[3]-o[9],o[4]-o[10],o[5]-o[11]),T=new m(o[6]-o[9],o[7]-o[10],o[8]-o[11]),w=u,L=f;_=w+L<d?m.add(y.scaleTo(L/d),b.scaleTo(w/d)).addA(v):m.add(T.scaleTo(1-L/d),C.scaleTo(1-w/d)).addA(p),w=u+1,L=f+1,g=w+L<d?m.add(y.scaleTo(L/d),b.scaleTo(w/d)).addA(v):m.add(T.scaleTo(1-L/d),C.scaleTo(1-w/d)).addA(p),this._createExtentNormals(),this.setBoundingVolume3v(_,g)}}else this.createBoundsByExtent()}setBoundingSphere(e,t,i,s){this.bsphere.center.x=e,this.bsphere.center.y=t,this.bsphere.center.z=i,this.bsphere.radius=this.bsphere.center.distance(s)}setBoundingVolume(e,t,i,s,n,o){this.bbox.setFromBoundsArr([e,t,i,s,n,o]);let l=e+.5*(s-e),h=t+.5*(n-t),c=i+.5*(o-i);this.bsphere.center.set(l,h,c),this.bsphere.radius=this.bsphere.center.distance(new m(e,t,i))}setBoundingVolume3v(e,t){this.bbox.setFromBoundsArr([e.x,e.y,e.z,t.x,t.y,t.z]);let i=e.x+.5*(t.x-e.x),s=e.y+.5*(t.y-e.y),n=e.z+.5*(t.z-e.z);this.bsphere.center.set(i,s,n),this.bsphere.radius=this.bsphere.center.distance(new m(e.x,e.y,e.z))}setBoundingVolumeArr(e){this.bbox.setFromBoundsArr(e);let t=e[0]+.5*(e[3]-e[0]),i=e[1]+.5*(e[4]-e[1]),s=e[2]+.5*(e[5]-e[2]);this.bsphere.center.set(t,i,s),this.bsphere.radius=this.bsphere.center.distance(new m(e[0],e[1],e[2]))}createCoordsBuffers(e,t,i){const s=(i+1)*(i+1),n=this.handler;this.vertexPositionBufferHigh&&this.vertexPositionBufferHigh.numItems===s?(n.setStreamArrayBuffer(this.vertexPositionBufferHigh,e),n.setStreamArrayBuffer(this.vertexPositionBufferLow,t)):(n.gl.deleteBuffer(this.vertexPositionBufferHigh),n.gl.deleteBuffer(this.vertexPositionBufferLow),this.vertexTextureCoordBuffer=this.planet._textureCoordsBufferCache[Math.log2(i)],this.vertexPositionBufferHigh=n.createArrayBuffer(e,3,s),this.vertexPositionBufferLow=n.createArrayBuffer(t,3,s))}_addViewExtent(){const e=this._extentLonLat;let t=this.quadTreeStrategy._viewExtent;e.southWest.lon<t.southWest.lon&&(t.southWest.lon=e.southWest.lon),e.northEast.lon>t.northEast.lon&&(t.northEast.lon=e.northEast.lon),e.southWest.lat<t.southWest.lat&&(t.southWest.lat=e.southWest.lat),e.northEast.lat>t.northEast.lat&&(t.northEast.lat=e.northEast.lat)}_assignTileIndexes(){this._tileGroup=0;const e=this.tileZoom,t=this._extent,i=At;this.tileX=Et(t.getCenter().lon,t.getWidth(),-2003750834e-2),this.tileY=Et(t.getCenter().lat,t.getHeight(),i);const s=this.powTileZoom;this.tileXE=(this.tileX+1)%s,this.tileXW=(s+this.tileX-1)%s,this.tileYN=this.tileY-1,this.tileYS=this.tileY+1,this.tileIndex=It.getTileIndex(this.tileX,this.tileY,e,this._tileGroup)}initialize(){const e=this.planet,t=this.node;if(this.gridSize=e.terrain.gridSizeByZoom[this.tileZoom]||e.terrain.plainGridSize,t.sideSizeLog2[0]=t.sideSizeLog2[1]=t.sideSizeLog2[2]=t.sideSizeLog2[3]=Math.log2(this.gridSize),this.tileZoom<=e.terrain.maxZoom){const i=this.planet._normalMapCreator;this.normalMapTexturePtr=e.renderer.handler.createEmptyTexture_l(i.width,i.height)}this.normalMapTexture=this.planet.transparentTexture,this._assignGlobalTextureCoordinates(),this.initialized=!0}_assignGlobalTextureCoordinates(){const e=this._extent;this._globalTextureCoordinates[0]=(e.southWest.lon+At)*si,this._globalTextureCoordinates[1]=(At-e.northEast.lat)*si,this._globalTextureCoordinates[2]=(e.northEast.lon+At)*si,this._globalTextureCoordinates[3]=(At-e.southWest.lat)*si}createPlainSegmentAsync(){let e=this.planet,t=e.terrain;t.isReady()&&!this.plainReady&&this.tileZoom<=t.maxZoom&&(this.plainProcessing=!0,e._plainSegmentWorker.make(this))}_plainSegmentWorkerCallback(e){this.plainProcessing=!1,this.initialized&&!this.terrainReady&&(this.plainReady=!0,this.plainVertices=e.plainVertices,this.plainVerticesHigh=e.plainVerticesHigh,this.plainVerticesLow=e.plainVerticesLow,this.plainNormals=e.plainNormals,this._plainRadius=e.plainRadius,this.normalMapNormals=e.normalMapNormals,this.normalMapVertices=e.normalMapVertices,this.normalMapVerticesHigh=e.normalMapVerticesHigh,this.normalMapVerticesLow=e.normalMapVerticesLow,this.fileGridSize=Math.sqrt(e.normalMapVertices.length/3)-1)}createPlainSegment(){this.initialize(),this._createPlainVertices(),this.readyToEngage=!0}_projToDeg(e,t){return A.inverseMercator(e,t)}_createPlainVertices(){const e=this.planet.terrain.gridSizeByZoom[this.tileZoom],t=this.planet.terrain.plainGridSize,i=Math.max(t,e),s=this._extent,n=s.getWidth()/i,o=s.getHeight()/i,l=s.southWest.lon,h=s.northEast.lat,c=Math.max(t/e,1),d=i+1,u=this.planet.ellipsoid._invRadii2,f=d*d,_=(e+1)*(e+1)*3;let g=0,v=0;this.plainNormals=new Float32Array(_),this.plainVertices=new Float64Array(_),this.plainVerticesHigh=new Float32Array(_),this.plainVerticesLow=new Float32Array(_),this.normalMapNormals=new Float32Array(3*f),this.normalMapVertices=new Float64Array(3*f),this.normalMapVerticesHigh=new Float32Array(3*f),this.normalMapVerticesLow=new Float32Array(3*f);let p=this.plainVertices,y=this.plainVerticesHigh,b=this.plainVerticesLow,C=this.plainNormals,T=this.normalMapVertices,w=this.normalMapVerticesHigh,L=this.normalMapVerticesLow,S=this.normalMapNormals;for(let P=0;P<f;P++){let B=P%d,k=~~(P/d),I=this.planet.ellipsoid.lonLatToCartesian(this._projToDeg(l+B*n,h-k*o)),z=I.x*u.x,Ce=I.y*u.y,R=I.z*u.z,O=1/Math.sqrt(z*z+Ce*Ce+R*R),se=z*O,M=Ce*O,F=R*O;m.doubleToTwoFloats(I,ve,ye),T[v]=I.x,w[v]=ve.x,L[v]=ye.x,S[v++]=se,T[v]=I.y,w[v]=ve.y,L[v]=ye.y,S[v++]=M,T[v]=I.z,w[v]=ve.z,L[v]=ye.z,S[v++]=F,k%c==0&&B%c==0&&(p[g]=I.x,y[g]=ve.x,b[g]=ye.x,C[g++]=se,p[g]=I.y,y[g]=ve.y,b[g]=ye.y,C[g++]=M,p[g]=I.z,y[g]=ve.z,b[g]=ye.z,C[g++]=F)}this.terrainVertices=p,this.terrainVerticesHigh=y,this.terrainVerticesLow=b,this.plainReady=!0}getMaterialByLayer(e){return this.materials[e.__id]}_getLayerExtentOffset(e){const t=e._extentMerc,i=this._extent,s=t.northEast.lon-t.southWest.lon,n=t.northEast.lat-t.southWest.lat;return[(i.southWest.lon-t.southWest.lon)/s,(t.northEast.lat-i.northEast.lat)/n,(i.northEast.lon-i.southWest.lon)/s,(i.northEast.lat-i.southWest.lat)/n]}initSlice(e){let t=this._slices[e];return t?t.layers=[]:t=this._slices[e]=new Gh(this),t}screenRendering(e,t,i,s,n=!1,o){const l=this.handler.gl,h=e.attributes,c=e.uniforms,d=this.materials,u=this.planet,f=this.quadTreeStrategy;let _,g;t&&t.length?(g=t[0],_=g._height):_=0,l.activeTexture(l.TEXTURE0+u.SLICE_SIZE+2),l.bindTexture(l.TEXTURE_2D,s||this.getDefaultTexture()),l.uniform1i(c.defaultTexture,u.SLICE_SIZE+2);let v=0,p=0,y=!1,b=this.initSlice(i);for(this._indexBuffer=this._getIndexBuffer();g;){if(this.layerOverlap(g)&&(g._fading&&g._fadingOpacity>0||(g.minZoom>=f.minCurrZoom||g.maxZoom>=f.minCurrZoom)&&(g.minZoom<=f.maxCurrZoom||g.maxZoom<=f.maxCurrZoom))){y=!0;let C=d[g.__id];C||(C=d[g.__id]=g.createMaterial(this)),C.isReady||(f._renderCompleted=!1),b.append(g,C),u._samplerArr[v]=v,l.activeTexture(l.TEXTURE0+v),l.bindTexture(l.TEXTURE_2D,C.texture||u.transparentTexture),v++}p++,g=t[p]}!y&&n||(l.uniform1f(c.transitionOpacity,o||this._transitionOpacity>1?1:this._transitionOpacity),l.uniform1i(c.samplerCount,v),l.uniform1f(c.height,_),l.uniform1iv(c.samplerArr,u._samplerArr),l.uniform4fv(c.tileOffsetArr,b.tileOffsetArr),l.uniform1fv(c.layerOpacityArr,b.layerOpacityArr),u.lightEnabled&&(l.activeTexture(l.TEXTURE0+u.SLICE_SIZE+3),l.bindTexture(l.TEXTURE_2D,this.normalMapTexture||u.transparentTexture),l.uniform1i(c.uNormalMap,u.SLICE_SIZE+3),l.uniform3fv(c.uNormalMapBias,this.normalMapTextureBias),l.uniform4fv(c.uGlobalTextureCoord,this._globalTextureCoordinates)),l.bindBuffer(l.ARRAY_BUFFER,this.vertexPositionBufferHigh),l.vertexAttribPointer(h.aVertexPositionHigh,this.vertexPositionBufferHigh.itemSize,l.FLOAT,!1,0,0),l.bindBuffer(l.ARRAY_BUFFER,this.vertexPositionBufferLow),l.vertexAttribPointer(h.aVertexPositionLow,this.vertexPositionBufferLow.itemSize,l.FLOAT,!1,0,0),l.bindBuffer(l.ARRAY_BUFFER,this.vertexTextureCoordBuffer),l.vertexAttribPointer(h.aTextureCoord,2,l.UNSIGNED_SHORT,!0,0,0),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,this._indexBuffer),l.drawElements(u.drawMode,this._indexBuffer.numItems,l.UNSIGNED_INT,0))}increaseTransitionOpacity(){this._transitionOpacity+=(window.performance.now()-this._transitionTimestamp)/this.planet.transitionTime,this._transitionTimestamp=window.performance.now(),this._transitionOpacity>2&&(this._transitionOpacity=2);let e=this.node._fadingNodes.length;for(;e--;){let t=this.node._fadingNodes[e];if(!t.segment){this._transitionOpacity=1;break}t.segment._transitionOpacity>0&&!this.quadTreeStrategy._fadingNodes.has(t.__id)&&(this.quadTreeStrategy._fadingNodes.set(t.__id,t),t.segment._transitionOpacity=2-this._transitionOpacity,t.segment._transitionOpacity===0&&this.node._fadingNodes.splice(e,1))}}fadingTransitionOpacity(){this._transitionOpacity-=.01,this._transitionTimestamp=window.performance.now(),this._transitionOpacity<0&&(this._transitionOpacity=0)}colorPickingRendering(e,t,i,s,n=!1){const o=this.handler.gl,l=e.attributes,h=e.uniforms;let c,d=this.materials,u=this.planet;c=t&&t.length?t[0]._height:0;let f=!1,_=this._slices[i],g=_.layers.length;for(let v=0;v<g;v++){f=!0;let p=_.layers[v],y=4*v;u._pickingColorArr[y]=p._pickingColor.x/255,u._pickingColorArr[y+1]=p._pickingColor.y/255,u._pickingColorArr[y+2]=p._pickingColor.z/255,u._pickingColorArr[y+3]=Number(p._pickingEnabled),u._samplerArr[v]=v,o.activeTexture(o.TEXTURE0+v),o.bindTexture(o.TEXTURE_2D,d[p.__id].texture||this.planet.transparentTexture),u._pickingMaskArr[v]=v+u.SLICE_SIZE,o.activeTexture(o.TEXTURE0+v+u.SLICE_SIZE),o.bindTexture(o.TEXTURE_2D,d[p.__id].pickingMask||this.planet.transparentTexture)}!f&&n||(o.uniform1i(h.samplerCount,g),o.uniform1f(h.height,c),o.uniform1iv(h.samplerArr,u._samplerArr),o.uniform1iv(h.pickingMaskArr,u._pickingMaskArr),o.uniform4fv(h.pickingColorArr,u._pickingColorArr),o.uniform4fv(h.tileOffsetArr,_.tileOffsetArr),o.uniform1fv(h.layerOpacityArr,_.layerOpacityArr),o.bindBuffer(o.ARRAY_BUFFER,this.vertexPositionBufferHigh),o.vertexAttribPointer(l.aVertexPositionHigh,this.vertexPositionBufferHigh.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.vertexPositionBufferLow),o.vertexAttribPointer(l.aVertexPositionLow,this.vertexPositionBufferLow.itemSize,o.FLOAT,!1,0,0),o.bindBuffer(o.ARRAY_BUFFER,this.vertexTextureCoordBuffer),o.vertexAttribPointer(l.aTextureCoord,2,o.UNSIGNED_SHORT,!0,0,0),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,this._indexBuffer),o.drawElements(o.TRIANGLE_STRIP,this._indexBuffer.numItems,o.UNSIGNED_INT,0))}depthRendering(e,t){const i=this.handler.gl,s=e.attributes,n=e.uniforms;var o;o=t&&t.length?t[0]._height:0,i.uniform1f(n.height,o),i.bindBuffer(i.ARRAY_BUFFER,this.vertexPositionBufferHigh),i.vertexAttribPointer(s.aVertexPositionHigh,this.vertexPositionBufferHigh.itemSize,i.FLOAT,!1,0,0),i.bindBuffer(i.ARRAY_BUFFER,this.vertexPositionBufferLow),i.vertexAttribPointer(s.aVertexPositionLow,this.vertexPositionBufferLow.itemSize,i.FLOAT,!1,0,0),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,this._indexBuffer),i.drawElements(i.TRIANGLE_STRIP,this._indexBuffer.numItems,i.UNSIGNED_INT,0)}_getIndexBuffer(){const e=this.node.sideSizeLog2;let t=this.planet._indexesCache[Math.log2(this.gridSize)][e[0]][e[1]][e[2]][e[3]];if(!t.buffer){let i=Wi().createSegmentIndexes(Math.log2(this.gridSize),[e[0],e[1],e[2],e[3]]);t.buffer=this.planet.renderer.handler.createElementArrayBuffer(i,1),this.planet._indexesCacheToRemoveCounter++}return t.buffer}layerOverlap(e){return this._extent.overlaps(e._extentMerc)}getDefaultTexture(){return this.planet.solidTextureOne}getExtentLonLat(){return this._extentLonLat}getExtentMerc(){return this._extentMerc}getExtent(){return this._extent}getNeighborSide(e){if(this.tileY===e.tileY){if(this.tileX===e.tileXE)return 3;if(this.tileX===e.tileXW)return 1}else if(this.tileX===e.tileX){if(this.tileY===e.tileYS)return 0;if(this.tileY===e.tileYN)return 2}return-1}}let Di=new m,Fi=new m;const xe=[new N(0,0),new N(1,0),new N(0,1),new N(1,1)],jh=Math.sqrt(xe.length)-1;let ot={xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0},qh=0;class jt{constructor(e,t,i,s,n,o){t.planet._createdNodesCount++,this.__id=qh++,this.SegmentPrototype=e,this.quadTreeStrategy=t,this.parentNode=s,this.partId=i,this.nodeId=i+(s?4*s.nodeId+1:0),this.state=null,this.prevState=null,this.appliedTerrainNodeId=-1,this.sideSizeLog2=[0,0,0,0],this.ready=!1,this.neighbors=[[],[],[],[]],this.equalizedSideWithNodeId=[this.nodeId,this.nodeId,this.nodeId,this.nodeId],this.nodes=[],this.segment=new e(this,t,n,o),this._cameraInside=!1,this.inFrustum=0,this._fadingNodes=[],this.createBounds()}createChildNodes(){this.ready=!0;const e=this.quadTreeStrategy,t=this.segment,i=t._extent,s=t.tileZoom+1,n=.5*i.getWidth(),o=.5*i.getHeight(),l=i.northEast,h=i.southWest,c=new A(h.lon+n,h.lat+o),d=this.nodes;d[0]=new jt(this.SegmentPrototype,e,0,this,s,new V(new A(h.lon,h.lat+o),new A(h.lon+n,l.lat))),d[1]=new jt(this.SegmentPrototype,e,1,this,s,new V(c,new A(l.lon,l.lat))),d[2]=new jt(this.SegmentPrototype,e,2,this,s,new V(new A(h.lon,h.lat),c)),d[3]=new jt(this.SegmentPrototype,e,3,this,s,new V(new A(h.lon+n,h.lat),new A(l.lon,h.lat+o)))}createBounds(){let e=this.segment;e._setExtentLonLat(),e.tileZoom===0?e.setBoundingSphere(0,0,0,new m(0,0,e.planet.ellipsoid.equatorialSize)):e.tileZoom<e.planet.terrain.minZoom?e.createBoundsByExtent():e.createBoundsByParent();let t=e.bsphere.center.x,i=e.bsphere.center.y,s=e.bsphere.center.z,n=1/Math.sqrt(t*t+i*i+s*s);e.centerNormal.x=t*n,e.centerNormal.y=i*n,e.centerNormal.z=s*n}getState(){if(this.state===-1)return this.state;let e=this.parentNode;for(;e;){if(e.state!==2)return 0;e=e.parentNode}return this.state}getEqualNeighbor(e){let t=this,i=xn[e][t.partId];if(i!==-1)return t.parentNode.nodes[i];{let s=[];for(;t.parentNode;)if(s.push(t.partId),i=xn[e][t.partId],t=t.parentNode,i!==-1){let n=s.length;for(e=di[e];t&&n--;)i=ja[e][s[n]],t=t.nodes[i];return t}}}traverseNodes(e,t,i,s,n){this.ready||this.createChildNodes();let o=this.nodes;o[0].renderTree(e,t,i,s,n),o[1].renderTree(e,t,i,s,n),o[2].renderTree(e,t,i,s,n),o[3].renderTree(e,t,i,s,n)}renderTree(e,t,i,s,n){if(this.quadTreeStrategy._renderedNodes.length>=1e3)return;(!t||n&&this.segment.tileZoom>n.segment.tileZoom)&&(this.prevState=this.state),this.state=2,this.clearNeighbors();let o=this.segment,l=this.quadTreeStrategy.planet;if(this._cameraInside=!1,!this.parentNode||this.parentNode._cameraInside){let d;d=o._projection.id===ln.id?o._extent.isInside(e._lonLatMerc):o._extent.isInside(e._lonLat),d&&(e._insideSegment=o,this._cameraInside=!0)}this.inFrustum=0;let h=e.frustums,c=h.length;if(o.tileZoom<6)for(let d=0;d<c;d++)h[d].containsSphere(o.bsphere)&&(this.inFrustum|=1<<d);else for(let d=0;d<c;d++)o.terrainReady?h[d].containsBox(o.bbox)&&(this.inFrustum|=1<<d):h[d].containsSphere(o.bsphere)&&(this.inFrustum|=1<<d);if(this.inFrustum||this._cameraInside||o.tileZoom<3){let d=Math.abs(e._lonLat.height),u=e.eye.length2()-l.ellipsoid.polarSizeSqr,f=10687647287563281e-5*l._heightFactor;u=u<f?f:u;let _=o.tileZoom<2||o.tileZoom>19||o.tileZoom<6&&!o.terrainReady;if(e.isOrthographic){let g=e.getForward();_=_||g.dot(o._sw.getNormal())<-0||g.dot(o._nw.getNormal())<-0||g.dot(o._ne.getNormal())<-0||g.dot(o._se.getNormal())<-0}else _=_||e.eye.distance2(o._sw)<u||e.eye.distance2(o._nw)<u||e.eye.distance2(o._ne)<u||e.eye.distance2(o._se)<u;(this.inFrustum&&(_||d>1e4)||this._cameraInside)&&this.quadTreeStrategy.collectVisibleNode(this),o.tileZoom<2?this.traverseNodes(e,t,i,s,n):o.terrainReady&&(!t&&e.projectedSize(o.bsphere.center,o._plainRadius)<this.quadTreeStrategy.lodSize||t&&(o.tileZoom===t||!_))?_?(o.passReady=!0,this.renderNode(this.inFrustum,!this.inFrustum,i,s)):this.state=0:o.terrainReady&&o.checkZoom()&&(!t||e.projectedSize(o.bsphere.center,o.bsphere.radius)>this.quadTreeStrategy._maxLodSize)?this.traverseNodes(e,t,o,s,n):_?(o.passReady=!!t&&o.terrainReady,this.renderNode(this.inFrustum,!this.inFrustum,i,s)):this.state=0}else this.state=0}renderNode(e,t,i,s){let n=this.segment;n.terrainReady||(n.initialized||n.initialize(),this.whileTerrainLoading(i),n.plainProcessing||n.createPlainSegmentAsync(),n.plainReady&&!s&&n.loadTerrain()),n.planet.lightEnabled&&!n.normalMapReady&&this.whileNormalMapCreating(),t?this.state=-1:(!this._cameraInside&&n.tileZoom>this.quadTreeStrategy.maxCurrZoom&&(this.quadTreeStrategy.maxCurrZoom=n.tileZoom),n.tileZoom<this.quadTreeStrategy.minCurrZoom&&(this.quadTreeStrategy.minCurrZoom=n.tileZoom),n._addViewExtent(),this.addToRender(e))}childrenPrevStateEquals(e){let t=this.nodes;return t.length===4&&t[0].prevState===e&&t[1].prevState===e&&t[2].prevState===e&&t[3].prevState===e}isFading(){let e=this.nodes;return this.state===2&&this.segment._transitionOpacity>0&&e.length===4&&e[0].state===1&&e[1].state===1&&e[2].state===1&&e[3].state===1}_collectFadingNodes(){if(this.segment.tileZoom<3)this.segment._transitionOpacity=1;else if(this.prevState!==1){this.segment._transitionOpacity=0,this._fadingNodes=[];let e=window.performance.now();if(this.segment._transitionTimestamp=e,this.parentNode){if(this.parentNode.prevState===1){let t=this.parentNode.parentNode;for(;t;){if(t.isFading()){for(let i=0;i<t.nodes.length;i++)t.nodes[i].segment._transitionOpacity=1,t.nodes[i]._fadingNodes=[];t.segment._transitionOpacity=0;break}t=t.parentNode}this.parentNode.whileTerrainLoading(),this._fadingNodes.push(this.parentNode),this.parentNode.segment._transitionOpacity=2,this.parentNode.segment._transitionTimestamp=e}else if(this.segment.childrenInitialized()&&this.childrenPrevStateEquals(1))for(let t=0;t<this.nodes.length;t++){let i=this.nodes[t];i.whileTerrainLoading(),this._fadingNodes.push(i),i.segment._transitionOpacity=2,i.segment._transitionTimestamp=e,i.prevState=i.state,i.state=0}}}}clearNeighbors(){this.neighbors&&(this.neighbors[0]=this.neighbors[1]=this.neighbors[2]=this.neighbors[3]=null,this.neighbors[0]=[],this.neighbors[1]=[],this.neighbors[2]=[],this.neighbors[3]=[])}_refreshTransitionOpacity(){if(this._fadingNodes.length===0)this.segment._transitionOpacity=1;else if(this._fadingNodes.length!==4||this.childrenPrevStateEquals(1)){for(let e=0;e<this._fadingNodes.length;e++)this.segment._transitionOpacity<1&&this._fadingNodes[e].segment._transitionOpacity===0&&(this._fadingNodes[e].segment._transitionOpacity=0,this.segment._transitionOpacity=1);this.segment.increaseTransitionOpacity()}else this.segment._transitionOpacity=1,this._fadingNodes=[]}addToRender(e){this.state=1;let t=this.quadTreeStrategy._renderedNodes;this.quadTreeStrategy._transitionOpacityEnabled?$r(t,this,(n,o)=>n.segment.tileZoom-o.segment.tileZoom):(this.getRenderedNodesNeighbors(t),t.push(this)),this.segment.terrainReady||(this.quadTreeStrategy._renderCompleted=!1,this.quadTreeStrategy._terrainCompleted=!1);let i=0,s=this.quadTreeStrategy._renderedNodesInFrustum;for(;e;)1&e&&s[i].push(this),i++,e>>=1}applyNeighbor(e,t){const i=di[t];if(this.neighbors[t].length===0||e.neighbors[i].length===0){const s=this.segment,n=e.segment,o=s.gridSize/(n.gridSize*Math.pow(2,n.tileZoom-s.tileZoom));let l=s.gridSize,h=n.gridSize;o>1?(l=Math.ceil(s.gridSize/o),h=n.gridSize):o<1&&(l=s.gridSize,h=Math.ceil(n.gridSize*o)),this.sideSizeLog2[t]=Math.log2(l),e.sideSizeLog2[i]=Math.log2(h)}this.neighbors[t].push(e),e.neighbors[i].push(this)}getRenderedNodesNeighbors(e){for(let t=e.length-1;t>=0;--t){let i=e[t],s=this.getCommonSide(i);s!==-1&&this.applyNeighbor(i,s)}}getCommonSide(e){const t=this.segment,i=e.segment;if(t.tileZoom===i.tileZoom&&t._tileGroup===i._tileGroup)return t.getNeighborSide(i);{const s=t._extentLonLat,n=i._extentLonLat;let o=s.northEast,l=s.southWest,h=n.northEast,c=n.southWest,d=o.lon,u=o.lat,f=l.lon,_=l.lat,g=h.lon,v=h.lat,p=c.lon,y=c.lat;if(t._tileGroup===i._tileGroup){if(d===p&&(u<=v&&_>=y||u>=v&&_<=y))return 1;if(f===g&&(u<=v&&_>=y||u>=v&&_<=y))return 3;if(u===y&&(f>=p&&d<=g||f<=p&&d>=g))return 0;if(_===v&&(f>=p&&d<=g||f<=p&&d>=g))return 2;if(i.tileX===0&&p===-d&&(u<=v&&_>=y||u>=v&&_<=y))return 1;if(t.tileX===0&&f===-g&&(u<=v&&_>=y||u>=v&&_<=y))return 3}if(t._tileGroup===0&&i._tileGroup===20&&t.tileY===0&&i.tileY===i.powTileZoom-1&&(f>=p&&d<=g||f<=p&&d>=g))return 0;if(t._tileGroup===0&&i._tileGroup===Le&&t.tileY===t.powTileZoom-1&&i.tileY===0&&(f>=p&&d<=g||f<=p&&d>=g))return 2;if(t._tileGroup===Le&&i._tileGroup===0&&t.tileY===0&&i.tileY===i.powTileZoom-1&&(f>=p&&d<=g||f<=p&&d>=g))return 0;if(t._tileGroup===20&&i._tileGroup===0&&t.tileY===t.powTileZoom-1&&i.tileY===0&&(f>=p&&d<=g||f<=p&&d>=g))return 2}return-1}whileNormalMapCreating(){const e=this.segment;e.terrainIsLoading||!e.terrainExists||e._inTheQueue||e.planet._normalMapCreator.queue(e);let t=this;for(;t.parentNode&&!t.segment.normalMapReady;)t=t.parentNode;const i=2<<e.tileZoom-t.segment.tileZoom-1;e.normalMapTexture=t.segment.normalMapTexture,e.normalMapTextureBias[0]=e.tileX-t.segment.tileX*i,e.normalMapTextureBias[1]=e.tileY-t.segment.tileY*i,e.normalMapTextureBias[2]=1/i}whileTerrainLoading(e){const t=this.segment;let i=this;if(e&&e.terrainReady)i=e.node;else for(;i.parentNode&&!i.segment.terrainReady;)i=i.parentNode;if(i.segment.terrainReady&&this.appliedTerrainNodeId!==i.nodeId){let s=2<<t.tileZoom-i.segment.tileZoom-1,n=t.tileX-i.segment.tileX*s,o=t.tileY-i.segment.tileY*s;const l=i.segment;let h,c,d,u;this.appliedTerrainNodeId=i.nodeId,this.equalizedSideWithNodeId[0]=this.equalizedSideWithNodeId[1]=this.equalizedSideWithNodeId[2]=this.equalizedSideWithNodeId[3]=this.appliedTerrainNodeId;let f=i.segment.gridSize/s,_=i.segment.fileGridSize/s;if(ot.xmin=yt,ot.xmax=Tt,ot.ymin=yt,ot.ymax=Tt,ot.zmin=yt,ot.zmax=Tt,f>=1){t.gridSize=f;let g=(f+1)*(f+1)*3;h=new Float64Array(g),c=new Float32Array(g),d=new Float32Array(g),l.noDataVertices&&(u=new Uint8Array(g/3)),hr(l.terrainVertices,l.terrainVerticesHigh,l.terrainVerticesLow,l.noDataVertices,l.gridSize,f*o,f*n,f,h,c,d,ot,u)}else if(_>=1&&i.segment.terrainExists){t.gridSize=_;let g=(_+1)*(_+1)*3;h=new Float64Array(g),c=new Float32Array(g),d=new Float32Array(g),l.noDataVertices&&(u=new Uint8Array(g/3)),hr(l.normalMapVertices,l.normalMapVerticesHigh,l.normalMapVerticesLow,l.noDataVertices,i.segment.fileGridSize,_*o,_*n,_,h,c,d,ot,u)}else{t.gridSize=jh;let g,v=Math.floor(f*o),p=Math.floor(f*n);g=l.gridSize===1?l.terrainVertices:Xr(l.terrainVertices,l.gridSize,v,p,1);let y=1/f,b=o-y*v,C=n-y*p,T=new m(g[0],g[1],g[2]),w=new m(g[9],g[10],g[11]),L=new m(g[3]-g[0],g[4]-g[1],g[5]-g[2]),S=new m(g[6]-g[0],g[7]-g[1],g[8]-g[2]),P=new m(g[3]-g[9],g[4]-g[10],g[5]-g[11]),B=new m(g[6]-g[9],g[7]-g[10],g[8]-g[11]),k=new m;h=new Float64Array(3*xe.length),c=new Float32Array(3*xe.length),d=new Float32Array(3*xe.length);for(let I=0;I<xe.length;I++){let z=xe[I].y+b,Ce=xe[I].x+C,R=Ce*f,O=z*f;k=z+Ce<y?L.scaleTo(R).addA(S.scaleTo(O)).addA(T):B.scaleTo(1-R).addA(P.scaleTo(1-O)).addA(w),m.doubleToTwoFloats(k,Di,Fi);let se=3*I;h[se]=k.x,h[se+1]=k.y,h[se+2]=k.z,c[se]=Di.x,c[se+1]=Di.y,c[se+2]=Di.z,d[se]=Fi.x,d[se+1]=Fi.y,d[se+2]=Fi.z,k.x<ot.xmin&&(ot.xmin=k.x),k.x>ot.xmax&&(ot.xmax=k.x),k.y<ot.ymin&&(ot.ymin=k.y),k.y>ot.ymax&&(ot.ymax=k.y),k.z<ot.zmin&&(ot.zmin=k.z),k.z>ot.zmax&&(ot.zmax=k.z)}}if(t.readyToEngage=!0,t.terrainVertices=h,t.terrainVerticesHigh=c,t.terrainVerticesLow=d,t.tempVertices=h,t.tempVerticesHigh=c,t.tempVerticesLow=d,t.noDataVertices=u,t.setBoundingVolume(ot.xmin,ot.ymin,ot.zmin,ot.xmax,ot.ymax,ot.zmax),t.tileZoom>t.planet.terrain.maxZoom&&i.segment.tileZoom>=t.planet.terrain.maxZoom&&(t._plainRadius=i.segment._plainRadius/s,t.terrainReady=!0,t.terrainIsLoading=!1,t.terrainVertices=h,t.terrainVerticesHigh=c,t.terrainVerticesLow=d,t.passReady=!0,this.appliedTerrainNodeId=this.nodeId,this.equalizedSideWithNodeId[0]=this.equalizedSideWithNodeId[1]=this.equalizedSideWithNodeId[2]=this.equalizedSideWithNodeId[3]=this.appliedTerrainNodeId,i.segment.terrainExists)){t.normalMapVertices=h,t.fileGridSize=Math.sqrt(h.length/3)-1;let g=Math.sqrt(l.normalMapNormals.length/3)-1,v=g/s;t.normalMapNormals=g>1?Bo(l.normalMapNormals,g,v*o,v*n,v):l.normalMapNormals}}}destroy(){this.prevState=this.state=0,this.segment.destroySegment();let e=this.neighbors;for(let t=0,i=e.length;t<i;t++){let s=e[t];if(s)for(let n=0;n<s.length;n++){let o=s[n];o&&o.neighbors&&o.clearNeighbors()}}this.neighbors=null,this.parentNode=null,this.sideSizeLog2=null,this.segment=null}clearTree(){const e=this.getState();if(e===0||e===1)this.destroyBranches();else for(let t=0;t<this.nodes.length;t++)this.nodes[t]&&this.nodes[t].clearTree()}clearBranches(){for(let e=0;e<this.nodes.length;e++)this.nodes[e].clearBranches(),this.nodes[e].segment.deleteMaterials()}destroyBranches(){if(this.ready){let e,t=[];for(e=0;e<this.nodes.length;e++)t[e]=this.nodes[e];for(this.ready=!1,this.nodes=[],e=0;e<t.length;e++)t[e].destroyBranches(),t[e].destroy(),t[e]=null;t.length=0,t=null}}traverseTree(e){if(e(this),this.ready)for(let t=0;t<this.nodes.length;t++)this.nodes[t].traverseTree(e)}getOffsetOppositeNeighbourSide(e,t){let i=this,s=e.segment.tileZoom,n=0;for(;i.segment.tileZoom>s;)n+=qa[i.partId][t]/(1<<i.segment.tileZoom-s),i=i.parentNode;return n}}class hn{constructor(e=2048){this._size=e,this._array=new Array(this._size),this._popIndex=Math.floor(.5*this._size),this._shiftIndex=this._popIndex,this.length=0}reset(){this._popIndex=Math.floor(.5*this._size),this._shiftIndex=this._popIndex,this.length=0}clear(){this._array.length=0,this._array=new Array(this._size),this._popIndex=Math.floor(.5*this._size),this._shiftIndex=this._popIndex,this.length=0}push(e){this.length++,this._array[this._popIndex++]=e}pop(){if(this.length){this.length--;let e=this._array[--this._popIndex];return this._array[this._popIndex]=null,this._array[this._popIndex-1]||(this._popIndex=Math.floor(.5*this._size),this._shiftIndex=this._popIndex),e}}unshift(e){this.length++,this._array[--this._shiftIndex]=e}shift(){if(this.length){this.length--;let e=this._array[this._shiftIndex];return this._array[this._shiftIndex++]=null,this._array[this._shiftIndex]||(this._popIndex=Math.floor(.5*this._size),this._shiftIndex=this._popIndex),e}}forEach(e){for(let t=this._shiftIndex;t<this._popIndex;t++)e(this._array[t])}}class cn{constructor(e,t,i){this.quadTreeStrategy=e,this._layer=t,this._nodeCapacity=i,this._secondPASS=[],this._counter=0,this._deferredEntitiesPendingQueue=new hn,this._renderingNodes={}}insertEntity(e,t=!1){}setPickingEnabled(e){}dispose(){}insertEntities(e){}collectVisibleEntityCollections(e){}_queueDeferredNode(e){this._layer.getVisibility()&&(e._inTheQueue=!0,this._counter>=1?this._deferredEntitiesPendingQueue.push(e):this._execDeferredNode(e))}_execDeferredNode(e){this._counter++,requestAnimationFrame(()=>{if(e.applyCollection(),this._counter--,this._deferredEntitiesPendingQueue.length&&this._counter<1)for(;this._deferredEntitiesPendingQueue.length;){let t=this._deferredEntitiesPendingQueue.pop();if(t._inTheQueue=!1,t.isVisible())return void this._execDeferredNode(t)}})}}class ks{constructor(e){this._skipPreRender=!1,this.events=at(Yh),this.name=e.name||"",this.projection=e.proj||ln,this.planet=e.planet,this._quadTreeList=[],this._visibleNodes={},this._renderedNodes=[],this._renderedNodesInFrustum=[],this._fadingNodes=new Map,this._fadingNodesInFrustum=[],this._fadingOpaqueSegments=[],this.minCurrZoom=yt,this.maxCurrZoom=Tt,this._viewExtent=new V(new A(180,180),new A(-180,-180)),this._lodSize=256,this._curLodSize=256,this._minLodSize=512,this._maxLodSize=256,this.maxEqualZoomAltitude=e.maxEqualZoomAltitude||15e6,this.minEqualZoomAltitude=e.minEqualZoomAltitude||1e4,this.minEqualZoomCameraSlope=e.minEqualZoomCameraSlope||.8,this._renderCompleted=!1,this._renderCompletedActivated=!1,this._terrainCompleted=!1,this._terrainCompletedActivated=!1,this._transitionOpacityEnabled=e.transitionOpacityEnabled==null||e.transitionOpacityEnabled}get lodSize(){return this._lodSize}setLodSize(e,t,i){this._maxLodSize=i||this._maxLodSize,this._minLodSize=t||this._minLodSize,this._curLodSize=e,this._renderCompletedActivated=!1,this._terrainCompletedActivated=!1}createEntityCollectionsTreeStrategy(e,t){return new cn(this,e,t)}destroyBranches(){this._renderCompletedActivated=!1,this._terrainCompletedActivated=!1;for(let e=0,t=this._quadTreeList.length;e<t;e++)this._quadTreeList[e].destroyBranches()}clearLayerMaterial(e,t=!1){let i=e.__id;for(let s=0,n=this._quadTreeList.length;s<n;s++)this._quadTreeList[s].traverseTree(o=>{if(t&&this._renderedNodes.includes(o))return;let l=o.segment.materials;l[i]&&(l[i].clear(),l[i]=null)})}get terrainReady(){return this._terrainCompleted&&this._terrainCompletedActivated}_checkRendercompleted(){this._renderCompleted?this._renderCompletedActivated||(this._renderCompletedActivated=!0,this.events.dispatch(this.events.rendercompleted,!0)):this._renderCompletedActivated=!1,this._renderCompleted=!0,this._terrainCompleted?this._terrainCompletedActivated||(this._terrainCompletedActivated=!0,this.events.dispatch(this.events.terraincompleted,!0)):this._terrainCompletedActivated=!1,this._terrainCompleted=!0}_initEvents(){this.planet.renderer.events.on("resize",()=>{this._renderCompletedActivated=!1,this._terrainCompletedActivated=!1}),this.planet.renderer.events.on("postdraw",()=>{this._checkRendercompleted()})}init(e){this._initEvents(),this._renderedNodesInFrustum=new Array(e.frustums.length);for(let t=0,i=this._renderedNodesInFrustum.length;t<i;t++)this._renderedNodesInFrustum[t]=[];this.preRender(),this.clearRenderedNodes(),this.preLoad()}clearRenderedNodes(){this._clearRenderedNodeList(),this._clearRenderNodesInFrustum()}_clearRenderedNodeList(){this._renderedNodes.length=0,this._renderedNodes=[]}_clearRenderNodesInFrustum(){for(let e=0,t=this._renderedNodesInFrustum.length;e<t;e++)this._renderedNodesInFrustum[e].length=0,this._renderedNodesInFrustum[e]=[]}_collectRenderedNodesMaxZoom(e){if(e.isOrthographic||e.slope>this.minEqualZoomCameraSlope&&e._lonLat.height<this.maxEqualZoomAltitude&&e._lonLat.height>this.minEqualZoomAltitude){this.minCurrZoom=this.maxCurrZoom;let t=this._renderedNodes,i=this._renderedNodesInFrustum,s=[];this._clearRenderNodesInFrustum(),this._renderedNodes=[];for(let n=0,o=t.length;n<o;n++){let l=t[n],h=l.segment.centerNormal.dot(e.getBackward());if(l.segment.tileZoom===this.maxCurrZoom||h<.81){this._renderedNodes.push(l);let c=0,d=l.inFrustum;for(;d;)1&d&&i[c].push(l),c++,d>>=1}else s.push(l)}for(let n=0,o=s.length;n<o;n++)s[n].renderTree(e,this.maxCurrZoom,null,!1,s[n])}}set transitionOpacityEnabled(e){this._transitionOpacityEnabled=e}get transitionOpacityEnabled(){return this._transitionOpacityEnabled}collectRenderNodes(e){if(this._skipPreRender&&(this._lodSize=xo(e.slope<0?0:e.slope,this._curLodSize,this._minLodSize),e._insideSegment=null,this._clearRenderedNodeList(),this._clearRenderNodesInFrustum(),this._viewExtent.southWest.set(180,180),this._viewExtent.northEast.set(-180,-180),this.minCurrZoom=yt,this.maxCurrZoom=Tt,this._collectRenderNodes(e),this._collectRenderedNodesMaxZoom(e),this._fadingNodes.clear(),this._transitionOpacityEnabled)){let t=[];for(let i=0;i<this._renderedNodes.length;i++){let s=this._renderedNodes[i];if(s._collectFadingNodes(),s._refreshTransitionOpacity(),s.segment._transitionOpacity>=1)s.clearNeighbors(),s.getRenderedNodesNeighbors(t),t.push(s);else for(let n=0;n<s._fadingNodes.length;n++){let o=s._fadingNodes[n];o.segment&&o.segment._transitionOpacity>=1&&(o.clearNeighbors(),o.getRenderedNodesNeighbors(t),t.push(o))}}}this._skipPreRender=!0}preRender(){this._skipPreRender=!1;for(let e=0;e<this._quadTreeList.length;e++){let t=this._quadTreeList[e];t.createChildNodes(),t.segment.createPlainSegment();for(let i=0;i<t.nodes.length;i++)t.nodes[i].segment.createPlainSegment()}}preLoad(){for(let e=0;e<this._quadTreeList.length;e++){let t=this._quadTreeList[e];t.segment.passReady=!0,t.renderNode(1),this.planet.normalMapCreator.drawSingle(t.segment);for(let i=0;i<t.nodes.length;i++)t.nodes[i].segment.passReady=!0,t.nodes[i].renderNode(1),this.planet._normalMapCreator.drawSingle(t.nodes[i].segment)}}_clearVisibleNodes(){this._visibleNodes={}}_collectRenderNodes(e){this._clearVisibleNodes();for(let t=0;t<this._quadTreeList.length;t++)this._quadTreeList[t].renderTree(e,0,null)}clear(){for(let e=0;e<this._quadTreeList.length;e++)this._quadTreeList[e].clearTree()}get quadTreeList(){return this._quadTreeList}getTileXY(e,t){let i,s,n=t,o=1<<n;return i=Et(e.lon,360/o,-180),s=Et(e.lat,180/o,90),[i,s,n,0]}getLonLatTileOffset(e,t,i,s,n){let o;o=Pi(t,i,s,V.createFromArray([-180,-90,180,90]));let l=o.getWidth()/(n-1),h=o.getHeight()/(n-1);return[n-Math.ceil((e.lat-o.southWest.lat)/h)-1,Math.floor((e.lon-o.southWest.lon)/l)]}collectVisibleNode(e){this._visibleNodes[e.nodeId]=e}}const Yh=["rendercompleted","terraincompleted"],Is=new an({code:"epsg:4326",units:Ta}),ao=(90-ht)/Math.pow(2,7);class Or extends Ca{constructor(e,t,i,s){super(e,t,i,s),this._projection=Is,this._extentLonLat=this._extent,this._extentMerc=new V(s.southWest.forwardMercatorEPS01(),s.northEast.forwardMercatorEPS01()),this._isNorth=this._extent.northEast.lat>0,this.isPole=!0}_setExtentLonLat(){this._extentLonLat=this._extent}projectNative(e){return e}getInsideLonLat(e){return e._lonLat}_getMaxZoom(){let e;if(this._isNorth){let t=Math.floor((90-this._extent.northEast.lat)/ao);e=Math.floor(t/16)+7}else{let t=Math.floor((Ft-this._extent.northEast.lat)/ao);e=12-Math.floor(t/16)}return e}checkZoom(){return super.checkZoom()&&this.tileZoom<=this._getMaxZoom()}_assignTileIndexes(){this._assignTileXIndexes(this._extent),this._assignTileYIndexes(this._extent),this.tileIndex=It.getTileIndex(this.tileX,this.tileY,this.tileZoom,this._tileGroup)}_assignTileXIndexes(e){this.tileX=Et(e.getCenter().lon,e.getWidth(),-180);let t=1<<this.tileZoom;this.tileXE=(this.tileX+1)%t,this.tileXW=(t+this.tileX-1)%t}_assignTileYIndexes(e){const t=e.getCenter().lat;t>0?(this._tileGroup=20,this.tileY=Et(t,e.getHeight(),90)):(this._tileGroup=Le,this.tileY=Et(t,e.getHeight(),Ft)),this.tileYN=this.tileY-1,this.tileYS=this.tileY+1}_projToDeg(e,t){return new A(e,t)}_assignGlobalTextureCoordinates(){const e=this._extent;this._globalTextureCoordinates[0]=(e.southWest.lon+180)/360,this._globalTextureCoordinates[1]=(90-e.northEast.lat)/180,this._globalTextureCoordinates[2]=(e.northEast.lon+180)/360,this._globalTextureCoordinates[3]=(90-e.southWest.lat)/180}_getLayerExtentOffset(e){const t=e._extent,i=this._extent,s=t.northEast.lon-t.southWest.lon,n=t.northEast.lat-t.southWest.lat;return[(i.southWest.lon-t.southWest.lon)/s,(t.northEast.lat-i.northEast.lat)/n,(i.northEast.lon-i.southWest.lon)/s,(i.northEast.lat-i.southWest.lat)/n]}layerOverlap(e){return this._extent.overlaps(e._extent)}getDefaultTexture(){return this._isNorth?this.planet.solidTextureOne:this.planet.solidTextureTwo}getExtentLonLat(){return this._extent}}class ge{constructor(e,t,i,s,n,o){this.strategy=e,this.layer=e._layer,this.parentNode=i,this.childNodes=[],this.partId=t,this.nodeId=t+(i?4*i.nodeId+1:0),this.state=null,this.extent=s,this.count=0,this.deferredEntities=[],this.entityCollection=null,this.zoom=o,this._inTheQueue=!1,this.bsphere=new Dt,n&&this._setExtentBounds()}insertEntity(e,t=!1){this.buildTree([e],t)}_addEntitiesToCollection(e,t=!1){if(e.length){const i=this.layer,s=i._planet;let n=this.entityCollection;n||(n=new ie({pickingEnabled:i._pickingEnabled,labelMaxLetters:i.labelMaxLetters}),n._layer=this.layer,n.addTo(s,!0),n._quadNode=this,i._bindEventsDefault(n),this.entityCollection=n),t||!i.async?this.entityCollection.addEntities(e):this.deferredEntities.push.apply(this.deferredEntities,e)}}_setExtentBounds(){this.nodeId?this.bsphere.setFromExtent(this.layer._planet.ellipsoid,this.extent.inverseMercator()):(this.bsphere.radius=this.layer._planet.ellipsoid.equatorialSize,this.bsphere.center=new m)}__setLonLat__(e){return e._lonLat.isZero()&&!e._cartesian.isZero()&&(e._lonLat=this.layer._planet.ellipsoid.cartesianToLonLat(e._cartesian)),Math.abs(e._lonLat.lat)<ht?e._lonLatMerc=e._lonLat.forwardMercator():e._lonLatMerc=new A,e._lonLatMerc}buildTree(e,t=!1){if(this.count+=e.length,e.length>this.layer._nodeCapacity){const i=this.childNodes;i.length||this.createChildNodes();let s=[],n=[],o=[],l=[],h=e.length;for(;h--;){const c=e[h];i[0].isInside(c)?(c._nodePtr=i[0],s.push(c)):i[1].isInside(c)?(c._nodePtr=i[1],n.push(c)):i[2].isInside(c)?(c._nodePtr=i[2],o.push(c)):i[3].isInside(c)&&(c._nodePtr=i[3],l.push(c))}s.length&&i[0].buildTree(s,t),n.length&&i[1].buildTree(n,t),o.length&&i[2].buildTree(o,t),l.length&&i[3].buildTree(l,t)}else this._addEntitiesToCollection(e,t)}isInside(e){return!!e._lonLatMerc&&this.extent.isInside(e._lonLatMerc)}createChildNodes(){const e=this.strategy,t=this.extent,i=.5*t.getWidth(),s=.5*t.getHeight(),n=t.northEast,o=t.southWest,l=new A(o.lon+i,o.lat+s),h=this.childNodes,c=this.layer._planet,d=this.zoom+1;h[0]=new ge(e,0,this,new V(new A(o.lon,o.lat+s),new A(o.lon+i,n.lat)),c,d),h[1]=new ge(e,1,this,new V(l,new A(n.lon,n.lat)),c,d),h[2]=new ge(e,2,this,new V(new A(o.lon,o.lat),l),c,d),h[3]=new ge(e,3,this,new V(new A(o.lon+i,o.lat),new A(n.lon,o.lat+s)),c,d)}collectRenderCollectionsPASS1(e,t){const i=e[this.nodeId];if(i){const s=this.childNodes;this.entityCollection?this.renderCollection(t,e):s.length&&(i.state===1?this.strategy._secondPASS.push(this):(s[0].collectRenderCollectionsPASS1(e,t),s[1].collectRenderCollectionsPASS1(e,t),s[2].collectRenderCollectionsPASS1(e,t),s[3].collectRenderCollectionsPASS1(e,t)))}}collectRenderCollectionsPASS2(e,t,i){const s=this.layer._planet.camera,n=s.eye.distance(this.bsphere.center)-this.bsphere.radius<3570*Math.sqrt(s._lonLat.height)||s._lonLat.height>1e4;if(this.count>0&&n&&s.containsSphere(this.bsphere)){const o=this.childNodes;this.entityCollection?this.renderCollection(t,e,i):o.length&&(o[0].collectRenderCollectionsPASS2(e,t,i),o[1].collectRenderCollectionsPASS2(e,t,i),o[2].collectRenderCollectionsPASS2(e,t,i),o[3].collectRenderCollectionsPASS2(e,t,i))}}applyCollection(){this.entityCollection.addEntities(this.deferredEntities),this.deferredEntities.length=0,this.deferredEntities=[],this._inTheQueue=!1}traverseTree(e){const t=this.childNodes;this.entityCollection?e(this):t.length&&(t[0].traverseTree(e),t[1].traverseTree(e),t[2].traverseTree(e),t[3].traverseTree(e))}renderCollection(e,t,i){const s=this.strategy;s._renderingNodes[this.nodeId]=!0,this.deferredEntities.length&&!this._inTheQueue&&(this.layer.async?s._queueDeferredNode(this):this.applyCollection());let n=this.entityCollection,o=this.layer;if(n._fadingOpacity=o._fadingOpacity,n.scaleByDistance=o.scaleByDistance,n.pickingScale=o.pickingScale,n.polygonOffsetUnits=o.polygonOffsetUnits,e.push(n),o.clampToGround||o.relativeToGround){const l=n._entities;let h=l.length;if(t[this.nodeId]&&t[this.nodeId].state===1)for(;h--;){let c=l[h];this.alignEntityToTheGround(c,t[this.nodeId].segment)}else if(i)for(;h--;){let c=l[h];this.alignEntityToTheGround(c,t[i].segment)}else{const c=this.strategy.quadTreeStrategy._renderedNodes;for(;h--;){let d=l[h],u=c.length;for(;u--;)if(c[u].segment.isEntityInside(d)){this.alignEntityToTheGround(d,c[u].segment);break}}}}}alignEntityToTheGround(e,t){let i=new m;t.getEntityTerrainPoint(e,i);let s=Number(this.layer.relativeToGround)&&e._altitude||0;if(s){let n=this.layer._planet.ellipsoid.getSurfaceNormal3v(i);e._setCartesian3vSilent(i.addA(n.scale(s)))}else e._setCartesian3vSilent(i)}isVisible(){return!!this.strategy._renderingNodes[this.nodeId]}}class Te extends ge{constructor(e,t,i,s,n,o){super(e,t,i,s,n,o),this.strategy=e,this.isNorth=!1}createChildNodes(){const e=this.strategy,t=this.extent,i=.5*t.getWidth(),s=.5*t.getHeight(),n=t.northEast,o=t.southWest,l=new A(o.lon+i,o.lat+s),h=this.childNodes,c=this.layer._planet,d=this.zoom+1;h[0]=new Te(e,0,this,new V(new A(o.lon,o.lat+s),new A(o.lon+i,n.lat)),c,d),h[1]=new Te(e,1,this,new V(l,new A(n.lon,n.lat)),c,d),h[2]=new Te(e,2,this,new V(new A(o.lon,o.lat),l),c,d),h[3]=new Te(e,3,this,new V(new A(o.lon+i,o.lat),new A(n.lon,o.lat+s)),c,d)}_setExtentBounds(){this.extent.northEast.lat>0&&(this.isNorth=!0),this.bsphere.setFromExtent(this.layer._planet.ellipsoid,this.extent)}__setLonLat__(e){return e._lonLat.isZero()&&(e._lonLat=this.layer._planet.ellipsoid.cartesianToLonLat(e._cartesian)),e._lonLat}isVisible(){return!(!this.isNorth||!this.strategy._renderingNodesNorth[this.nodeId])||!!this.strategy._renderingNodesSouth[this.nodeId]}isInside(e){return this.extent.isInside(e._lonLat)}renderCollection(e,t,i){this.isNorth?this.strategy._renderingNodesNorth[this.nodeId]=!0:this.strategy._renderingNodesSouth[this.nodeId]=!0,this.deferredEntities.length&&!this._inTheQueue&&(this.layer.async?this.strategy._queueDeferredNode(this):this.applyCollection());const s=this.entityCollection;s._fadingOpacity=this.layer._fadingOpacity,s.scaleByDistance=this.layer.scaleByDistance,s.pickingScale=this.layer.pickingScale,s.isEmpty()||e.push(s)}}class Wh extends cn{constructor(e,t,i){super(e,t,i);let s=t._planet;this._entityCollectionsTree=new ge(this,0,null,V.createFromArray([-2003750834e-2,-2003750834e-2,2003750834e-2,2003750834e-2]),s,0),this._entityCollectionsTreeNorth=new Te(this,0,null,V.createFromArray([-180,ht,180,90]),s,0),this._entityCollectionsTreeSouth=new Te(this,0,null,V.createFromArray([-180,-90,180,Ft]),s,0),this._renderingNodes={},this._renderingNodesNorth={},this._renderingNodesSouth={}}insertEntity(e,t=!1){e._lonLat.lat>ht?(this._entityCollectionsTreeNorth.__setLonLat__(e),this._entityCollectionsTreeNorth.insertEntity(e,t)):e._lonLat.lat<Ft?(this._entityCollectionsTreeSouth.__setLonLat__(e),this._entityCollectionsTreeSouth.insertEntity(e,t)):(this._entityCollectionsTree.__setLonLat__(e),this._entityCollectionsTree.insertEntity(e,t))}setPickingEnabled(e){this._entityCollectionsTree&&this._entityCollectionsTree.traverseTree(t=>{t.entityCollection.setPickingEnabled(e)}),this._entityCollectionsTreeNorth&&this._entityCollectionsTreeNorth.traverseTree(t=>{t.entityCollection.setPickingEnabled(e)}),this._entityCollectionsTreeSouth&&this._entityCollectionsTreeSouth.traverseTree(t=>{t.entityCollection.setPickingEnabled(e)})}dispose(){this._entityCollectionsTree=null,this._entityCollectionsTreeNorth=null,this._entityCollectionsTreeSouth=null,this._renderingNodes={},this._renderingNodesNorth={},this._renderingNodesSouth={}}insertEntities(e){let t=[],i=[],s=[];for(let n=0,o=e.length;n<o;n++){let l=e[n];l._lonLat.lat>ht?(t.push(l),this._entityCollectionsTreeNorth.__setLonLat__(l)):l._lonLat.lat<Ft?(i.push(l),this._entityCollectionsTreeSouth.__setLonLat__(l)):(s.push(l),this._entityCollectionsTree.__setLonLat__(l))}this._entityCollectionsTree.buildTree(s),this._entityCollectionsTreeNorth.buildTree(t),this._entityCollectionsTreeSouth.buildTree(i)}collectVisibleEntityCollections(e){this._renderingNodes={},this._renderingNodesNorth={},this._renderingNodesSouth={};let t=this._layer._planet.quadTreeStrategy;this._secondPASS=[],this._entityCollectionsTree.collectRenderCollectionsPASS1(t._visibleNodes,e);let i=this._secondPASS.length;for(;i--;)this._secondPASS[i].collectRenderCollectionsPASS2(t._visibleNodes,e,this._secondPASS[i].nodeId);for(this._secondPASS=[],this._entityCollectionsTreeNorth.collectRenderCollectionsPASS1(t._visibleNodesNorth,e),i=this._secondPASS.length;i--;)this._secondPASS[i].collectRenderCollectionsPASS2(t._visibleNodesNorth,e,this._secondPASS[i].nodeId);for(this._secondPASS=[],this._entityCollectionsTreeSouth.collectRenderCollectionsPASS1(t._visibleNodesSouth,e),i=this._secondPASS.length;i--;)this._secondPASS[i].collectRenderCollectionsPASS2(t._visibleNodesSouth,e,this._secondPASS[i].nodeId)}}class Ea extends ks{constructor(e){super({name:"Earth",...e}),this._visibleNodesNorth={},this._visibleNodesSouth={}}collectVisibleNode(e){let t=e.segment._tileGroup;t===20?this._visibleNodesNorth[e.nodeId]=e:t===Le?this._visibleNodesSouth[e.nodeId]=e:this._visibleNodes[e.nodeId]=e}_clearVisibleNodes(){super._clearVisibleNodes(),this._visibleNodesNorth={},this._visibleNodesSouth={}}createEntityCollectionsTreeStrategy(e,t){return new Wh(this,e,t)}init(e){this._quadTreeList=[new jt(Ca,this,0,null,0,V.createFromArray([-2003750834e-2,-2003750834e-2,2003750834e-2,2003750834e-2])),new jt(Or,this,0,null,0,V.createFromArray([-180,ht,180,90])),new jt(Or,this,0,null,0,V.createFromArray([-180,-90,180,Ft]))],super.init(e)}getTileXY(e,t){let i,s,n=function(h,c=ht){return h>c?20:h<-c?Le:0}(e.lat,ht),o=t,l=1<<o;if(n===20)i=Et(e.lon,360/l,-180),s=Et(e.lat,(90-ht)/l,90);else if(n===Le)i=Et(e.lon,360/l,-180),s=Et(e.lat,(90-ht)/l,Ft);else{let h=Qi(e);i=Et(h.lon,Ki/l,-2003750834e-2),s=Et(h.lat,Ki/l,At)}return[i,s,o,n]}getLonLatTileOffset(e,t,i,s,n){let o,l=e;e.lat>ht?o=Pi(t,i,s,V.createFromArray([-180,ht,180,90])):e.lat<Ft?o=Pi(t,i,s,V.createFromArray([-180,-90,180,Ft])):(l=Qi(e),o=Xe(t,i,s));let h=o.getWidth()/(n-1),c=o.getHeight()/(n-1);return[n-Math.ceil((l.lat-o.southWest.lat)/c)-1,Math.floor((l.lon-o.southWest.lon)/h)]}}class Aa{constructor(e={}){this.model=e.model||null,this.src=e.src||null,this._cached_ix=0,this._cached_iy=0,this._v00=0,this._v01=0,this._v10=0,this._v11=0,this._t=0}static loadModel(e){return e?fetch(e,{}).then(t=>{if(!t.ok)throw Error("Geoid model file: HTTP error "+t.status);return t.arrayBuffer()}).then(t=>{if(t)return new Uint8Array(t);throw Error("Geoid model file: no data from "+e)}).then(function(t){if(t[0]!==80||t[1]!==53||(t[2]!==13||t[3]!==10)&&t[2]!==10)throw new Error("Geoid model file: no PGM header");var i,s,n=t[2]===13?4:3,o=null,l=null;function h(){let u=n;for(var f=n;;f++){if(f>=t.length)throw new Error("Geoid model file: missing newline in header");if(t[f]===10){n=f+1;break}}return f>u&&t[f-1]===13&&f--,String.fromCharCode.apply(null,t.slice(u,f))}for(;(s=h())[0]==="#";)if(i=s.match(/^# Offset (.*)$/)){if(o=parseInt(i[1],10),!isFinite(o))throw new Error("Geoid model file: bad offset "+i[1])}else if((i=s.match(/^# Scale (.*)$/))&&(l=parseFloat(i[1]),!isFinite(l)))throw new Error("Geoid model file: bad scale "+i[1]);let c=0,d=0;if((i=s.match(/^\s*(\d+)\s+(\d+)\s*$/))&&(c=parseInt(i[1],10),d=parseInt(i[2],10)),!(i&&c>=0&&d>=0))throw new Error("Geoid model file: bad PGM width&height line");if(parseInt(h())!=65535)throw new Error("Geoid model file: PGM file must have 65535 gray levels");if(o===null)throw new Error("Geoid model file: PGM file does not contain offset");if(l===null)throw new Error("Geoid model file: PGM file does not contain scale");if(c<2||d<2)throw new Error("Geoid model file: Raster size too small");if(t.length-n!=c*d*2)throw new Error("Geoid model file: File has the wrong length");return{scale:l,offset:o,width:c,height:d,rlonres:c/360,rlatres:(d-1)/180,i:n,rawfile:t}}):new Promise(t=>{t(null)})}setModel(e){this.model=e}_rawval(e,t){let i=this.model;t<0?(t=-t,e+=i.width/2):t>=i.height&&(t=2*(i.height-1)-t,e+=i.width/2),e<0?e+=i.width:e>=i.width&&(e-=i.width);let s=2*(t*i.width+e)+i.i;return i.rawfile[s]<<8|i.rawfile[s+1]}getHeightLonLat(e){return this.getHeight(e.lon,e.lat)}getHeight(e,t){if(!this.model)return 0;let i=this.model;e<0&&(e+=360);let s=(90-t)*i.rlatres,n=e*i.rlonres,o=Math.floor(s),l=Math.floor(n);n-=l,s-=o,o===i.height-1&&o--,this._cached_ix===l&&this._cached_iy===o||(this._cached_ix=l,this._cached_iy=o,this._v00=this._rawval(l,o),this._v01=this._rawval(l+1,o),this._v10=this._rawval(l,o+1),this._v11=this._rawval(l+1,o+1));let h=(1-s)*((1-n)*this._v00+n*this._v01)+s*((1-n)*this._v10+n*this._v11);return i.offset+i.scale*h}}class $h{constructor(e,t=5){this.MAX_FRAMES=t,this._gridSize=64,this._planet=e,this._framebuffer=null,this._framebufferMercProj=null,this._texCoordsBuffer=null,this._indexBuffer=null,this._currentFrame=0,this._queue=[],this._animate=[],this._quadTexCoordsBuffer=null,this._quadVertexBuffer=null}init(){this._initShaders(),this._initBuffers()}createGridBuffer(e,t=!1){let i=this._gridSize,s=new A((e[3].lon-e[0].lon)/i,(e[3].lat-e[0].lat)/i),n=new A((e[2].lon-e[1].lon)/i,(e[2].lat-e[1].lat)/i),o=new A((e[1].lon-e[0].lon)/i,(e[1].lat-e[0].lat)/i),l=new A((e[2].lon-e[3].lon)/i,(e[2].lat-e[3].lat)/i);const h=(i+1)*(i+1)*2,c=h/2;let d=new Float32Array(h),u=new Float32Array(h),f=new Array(c),_=0,g=0,v=0,p=new Float32Array(2);for(let y=0;y<=i;y++){let b=new A(e[0].lon+y*s.lon,e[0].lat+y*s.lat),C=new A(e[1].lon+y*n.lon,e[1].lat+y*n.lat);for(let T=0;T<=i;T++){let w=Mo(b,C,new A(e[0].lon+T*o.lon,e[0].lat+T*o.lat),new A(e[3].lon+T*l.lon,e[3].lat+T*l.lat));oe(w.lon,p),d[_++]=p[0],u[g++]=p[1],oe(w.lat,p),d[_++]=p[0],u[g++]=p[1],f[v++]=w}}if(t)for(let y=0;y<c;y++){let b=f[y].forwardMercator();oe(b.lon,p),d[2*y]=p[0],u[2*y]=p[1],oe(b.lat,p),d[2*y+1]=p[0],u[2*y+1]=p[1]}return[this._planet.renderer.handler.createArrayBuffer(d,2,c),this._planet.renderer.handler.createArrayBuffer(u,2,c)]}frame(){let e=this.MAX_FRAMES;for(;e--&&this._queue.length;){const t=this._queue.shift();t._isRendering=!1,t.rendering(),t.events.dispatch(t.events.loadend)}for(e=this._animate.length;e--;)this._animate[e].rendering()}add(e){e._isRendering||(e._isRendering=!0,e._animate?this._animate.push(e):this._queue.push(e))}remove(e){if(e._isRendering){let t;e._creationProceeding=!1,e._isRendering=!1,t=e._animate?this._animate:this._queue;for(let i=0;i<t.length;i++)if(t[i].isEqual(e))return void t.splice(i,1)}}_initBuffers(){let e=this._planet.renderer.handler;this._framebuffer=new St(e,{width:2,height:2,useDepth:!1}),this._framebuffer.init(),this._framebufferMercProj=new St(e,{width:2,height:2,useDepth:!1}),this._framebufferMercProj.init();let t=Math.log2(this._gridSize);this._texCoordsBuffer=this._planet._textureCoordsBufferCache[t],this._indexBuffer=this._planet._indexesCache[t][t][t][t][t].buffer,this._quadTexCoordsBuffer=e.createArrayBuffer(new Float32Array([0,1,1,1,0,0,1,0]),2,4),this._quadVertexBuffer=e.createArrayBuffer(new Float32Array([-1,1,1,1,-1,-1,1,-1]),2,4)}_initShaders(){this._planet.renderer.handler.addProgram(new $("geoImageTransform",{uniforms:{sourceTexture:"sampler2d",extentParamsHigh:"vec4",extentParamsLow:"vec4",isFullExtent:"bool"},attributes:{cornersHigh:"vec2",cornersLow:"vec2",texCoords:"vec2"},vertexShader:`attribute vec2 cornersHigh; 
                     attribute vec2 cornersLow;
                      attribute vec2 texCoords; 
                      uniform vec4 extentParamsHigh; 
                      uniform vec4 extentParamsLow; 
                      varying vec2 v_texCoords;
                      void main() {                                                             
                          v_texCoords = texCoords; 
                          vec2 highDiff = cornersHigh - extentParamsHigh.xy;
                          vec2 lowDiff = cornersLow - extentParamsLow.xy;                                        
                          gl_Position = vec4((-1.0 + (highDiff * step(1.0, length(highDiff)) + lowDiff) * extentParamsHigh.zw) * vec2(1.0, -1.0), 0.0, 1.0); 
                      }`,fragmentShader:`precision highp float;
                        uniform sampler2D sourceTexture;
                        uniform bool isFullExtent;
                        varying vec2 v_texCoords;
                        void main () {
                            if(!isFullExtent && (v_texCoords.x <= 0.001 || v_texCoords.x >= 0.999 ||
                                v_texCoords.y <= 0.001 || v_texCoords.y >= 0.999)) {
                                discard;
                            }
                            gl_FragColor = texture2D(sourceTexture, v_texCoords);
                        }`}))}}const Xh=["loadend","layerloadend"];class La{constructor(e=24){this.MAX_REQUESTS=e,this.events=at(Xh),this._loading=0,this._queue=[],this._senderRequestCounter=[],this._promises={json:t=>t.json(),blob:t=>t.blob(),arrayBuffer:t=>t.arrayBuffer(),imageBitmap:t=>t.blob().then(i=>createImageBitmap(i,{premultiplyAlpha:"premultiply"})),text:t=>t.text()}}load(e,t){e.sender&&(this._senderRequestCounter[e.sender.__id]||(this._senderRequestCounter[e.sender.__id]={sender:e.sender,counter:0,__requestCounterFrame__:0}),this._senderRequestCounter[e.sender.__id].counter++),this._queue.push({params:e,callback:t}),this._exec()}fetch(e){return fetch(e.src,e.options||{}).then(t=>{if(!t.ok)throw Error(`Unable to load '${e.src}'`);return this._promises[e.type||"blob"](t)}).then(t=>({status:"ready",data:t})).catch(t=>({status:"error",msg:t.toString()}))}getRequestCounter(e){if(e){let t=this._senderRequestCounter[e.__id];if(t)return t.counter}return 0}isIdle(e){return e.isIdle}_checkLoadend(e,t){e.counter===0&&(!t._planet||t.quadTreeStrategy&&t.quadTreeStrategy._terrainCompletedActivated)?(t.events.dispatch(t.events.loadend,t),this.events.dispatch(this.events.layerloadend,t),e.__requestCounterFrame__=0):e.__requestCounterFrame__=requestAnimationFrame(()=>{this._checkLoadend(e,t)})}_handleResponse(e,t){e.callback(t);let i=e.params.sender;if(i&&(i.events.loadend.handlers.length||this.events.layerloadend.handlers.length)){let s=this._senderRequestCounter[i.__id];s&&s.counter>0&&(s.counter--,cancelAnimationFrame(s.__requestCounterFrame__),s.__requestCounterFrame__=requestAnimationFrame(()=>{this._checkLoadend(s,i)}))}this._exec()}_exec(){if(this._queue.length>0&&this._loading<this.MAX_REQUESTS){let e=this._queue.pop();if(!e)return;let t=e.params;if(!t.filter||t.filter(t))return this._loading++,fetch(t.src,t.options||{}).then(i=>{if(!i.ok)throw Error(`Unable to load '${t.src}'`);return this._promises[t.type||"blob"](i)}).then(i=>{this._loading--,this._handleResponse(e,{status:"ready",data:i})}).catch(i=>{this._loading--,this._handleResponse(e,{status:"error",msg:i.toString()})});this._handleResponse(e,{status:"abort"})}else this._loading===0&&this.events.dispatch(this.events.loadend)}abort(e){this._senderRequestCounter[e.__id]&&(this._senderRequestCounter[e.__id].counter=0,cancelAnimationFrame(this._senderRequestCounter[e.__id].__requestCounterFrame__),this._senderRequestCounter[e.__id].__requestCounterFrame__=0);for(let t=0,i=this._queue.length;t<i;t++){let s=this._queue[t];s&&s.params.sender&&e.isEqual(s.params.sender)&&(s.callback({status:"abort"}),this._queue[t]=null)}}abortAll(){for(let e=0,t=this._queue.length;e<t;e++){let i=this._queue[e];if(i){let s=i.params.sender;s&&this._senderRequestCounter[s.__id]&&(this._senderRequestCounter[s.__id].counter=0,cancelAnimationFrame(this._senderRequestCounter[s.__id].__requestCounterFrame__),this._senderRequestCounter[s.__id].__requestCounterFrame__=0),i.callback({status:"abort"}),this._queue[e]=null}}this._queue=[]}get loading(){return this._loading}get queue(){return this._queue}}class Zh{constructor(e,t={}){this._minTabelSize=t.minTableSize||1,this._maxTableSize=t.maxTableSize||8,this._planet=e,this._handler=null,this._verticesBufferArray=[],this._indexBufferArray=[],this._positionBuffer=null,this._framebuffer=null,this._normalMapVerticesTexture=null,this._width=t.width||128,this._height=t.height||128,this._queue=new hn(1024),this._lock=new kr}get width(){return this._width}get height(){return this._height}init(){this._maxTableSize=this._planet.maxGridSize||8,this._handler=this._planet.renderer.handler;const e=new $("normalMapBlur",{attributes:{a_position:"vec2"},uniforms:{s_texture:"sampler2d"},vertexShader:`attribute vec2 a_position;
                       attribute vec2 a_texCoord;

                      varying vec2 blurCoordinates[5];

                      void main() {
                          vec2 vt = a_position * 0.5 + 0.5; 
                           
                          gl_Position = vec4(a_position, 0.0, 1.0);
                          blurCoordinates[0] = vt;
                          blurCoordinates[1] = vt + ${1/this._width*1.407333};
                          blurCoordinates[2] = vt - ${1/this._height*1.407333};
                          blurCoordinates[3] = vt + ${1/this._width*3.294215};
                          blurCoordinates[4] = vt - ${1/this._height*3.294215};
                }`,fragmentShader:`precision lowp float;
                        uniform sampler2D s_texture;                        
                        varying vec2 blurCoordinates[5];                        

                        void main() {
                            lowp vec4 sum = vec4(0.0);
                            //if(blurCoordinates[0].x <= 0.01 || blurCoordinates[0].x >= 0.99 ||
                            //    blurCoordinates[0].y <= 0.01 || blurCoordinates[0].y >= 0.99){
                            //    sum = texture2D(s_texture, blurCoordinates[0]);
                            //} else {
                                sum += texture2D(s_texture, blurCoordinates[0]) * 0.204164;
                                sum += texture2D(s_texture, blurCoordinates[1]) * 0.304005;
                                sum += texture2D(s_texture, blurCoordinates[2]) * 0.304005;
                                sum += texture2D(s_texture, blurCoordinates[3]) * 0.093913;
                                sum += texture2D(s_texture, blurCoordinates[4]) * 0.093913;
                            //}
                            gl_FragColor = sum;
                        }`}),t=new $("normalMap",{attributes:{a_position:"vec2",a_normal:"vec3"},uniforms:{},vertexShader:`attribute vec2 a_position;
                      attribute vec3 a_normal;
                      
                      varying vec3 v_color;
                      
                      void main() {
                          gl_Position = vec4(a_position, 0, 1);
                          v_color = normalize(a_normal) * 0.5 + 0.5;
                      }`,fragmentShader:`precision highp float;
                        
                        varying vec3 v_color;
                        
                        void main () {
                            gl_FragColor = vec4(v_color, 1.0);
                        }`});this._handler.addProgram(e),this._handler.addProgram(t),this._framebuffer=new St(this._handler,{width:this._width,height:this._height,useDepth:!1}),this._framebuffer.init(),this._normalMapVerticesTexture=this._handler.createEmptyTexture_l(this._width,this._height);for(let s=this._minTabelSize;s<=this._maxTableSize;s++){const n=1<<s,o=n/2;let l=new Float32Array((n+1)*(n+1)*2);for(let h=0;h<=n;h++)for(let c=0;c<=n;c++){let d=2*(h*(n+1)+c);l[d]=c/o-1,l[d+1]=h/o-1}this._verticesBufferArray[n]=this._handler.createArrayBuffer(l,2,l.length/2),this._indexBufferArray[n]=this._planet._indexesCache[Math.log2(n)][Math.log2(n)][Math.log2(n)][Math.log2(n)][Math.log2(n)].buffer}const i=new Float32Array([-1,-1,1,-1,-1,1,1,1]);this._positionBuffer=this._handler.createArrayBuffer(i,2,i.length/2)}_drawNormalMapBlur(e){let t=e.normalMapNormals;if(e.node&&e.node.getState()!==0&&t&&t.length){const i=t.length/3,s=Math.sqrt(i)-1;let n=this._verticesBufferArray[s];if(n){e.planet.terrain.equalizeNormals&&(e._normalMapEdgeEqualize(0),e._normalMapEdgeEqualize(2),e._normalMapEdgeEqualize(3),e._normalMapEdgeEqualize(1));let o=e.normalMapTexturePtr;const l=this._handler,h=l.gl;let c=l.createArrayBuffer(t,3,i,h.DYNAMIC_DRAW);const d=this._framebuffer;let u=l.programs.normalMap,f=u._program.attributes;return d.bindOutputTexture(this._normalMapVerticesTexture),u.activate(),h.bindBuffer(h.ARRAY_BUFFER,n),h.vertexAttribPointer(f.a_position,n.itemSize,h.FLOAT,!1,0,0),h.bindBuffer(h.ARRAY_BUFFER,c),h.vertexAttribPointer(f.a_normal,c.itemSize,h.FLOAT,!1,0,0),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this._indexBufferArray[s]),h.drawElements(h.TRIANGLE_STRIP,this._indexBufferArray[s].numItems,h.UNSIGNED_INT,0),h.deleteBuffer(c),d.bindOutputTexture(o),u=l.programs.normalMapBlur,u.activate(),h.bindBuffer(h.ARRAY_BUFFER,this._positionBuffer),h.vertexAttribPointer(u._program.attributes.a_position,this._positionBuffer.itemSize,h.FLOAT,!1,0,0),h.activeTexture(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,this._normalMapVerticesTexture),h.uniform1i(u._program.uniforms.s_texture,0),h.drawArrays(h.TRIANGLE_STRIP,0,this._positionBuffer.numItems),!0}return!0}return!1}_drawNormalMapNoBlur(e){let t=e.normalMapNormals;if(e.node&&e.node.getState()!==0&&t&&t.length){const i=t.length/3,s=Math.sqrt(i)-1;let n=this._verticesBufferArray[s];if(n){e.planet.terrain.equalizeNormals&&(e._normalMapEdgeEqualize(0),e._normalMapEdgeEqualize(2),e._normalMapEdgeEqualize(3),e._normalMapEdgeEqualize(1));let o=e.normalMapTexturePtr;const l=this._handler,h=l.gl;let c=l.createArrayBuffer(t,3,i,h.DYNAMIC_DRAW);const d=this._framebuffer,u=l.programs.normalMap,f=u._program.attributes;return d.bindOutputTexture(o),u.activate(),h.bindBuffer(h.ARRAY_BUFFER,n),h.vertexAttribPointer(f.a_position,n.itemSize,h.FLOAT,!1,0,0),h.bindBuffer(h.ARRAY_BUFFER,c),h.vertexAttribPointer(f.a_normal,c.itemSize,h.FLOAT,!1,0,0),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this._indexBufferArray[s]),h.drawElements(h.TRIANGLE_STRIP,this._indexBufferArray[s].numItems,h.UNSIGNED_INT,0),h.deleteBuffer(c),!0}return!0}return!1}_drawNormalMap(e){return e.planet.terrain.isBlur(e)?this._drawNormalMapBlur(e):this._drawNormalMapNoBlur(e)}drawSingle(e){const t=this._handler.gl;this._framebuffer.activate(),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.BLEND),e.terrainReady&&this._drawNormalMap(e)&&(e.normalMapReady=!0,e.normalMapTexture=e.normalMapTexturePtr,e.normalMapTextureBias[0]=0,e.normalMapTextureBias[1]=0,e.normalMapTextureBias[2]=1),e._inTheQueue=!1,t.enable(t.DEPTH_TEST),t.enable(t.CULL_FACE),t.enable(t.BLEND),this._framebuffer.deactivate()}frame(){if(this._queue.length){const e=this._handler.gl;this._framebuffer.activate(),e.disable(e.CULL_FACE),e.disable(e.DEPTH_TEST),e.disable(e.BLEND);let t=0,i=window.performance.now();for(;this._lock.isFree()&&this._queue.length&&t<.25;){const s=this._queue.shift();s.terrainReady&&this._drawNormalMap(s)&&(s.normalMapReady=!0,s.normalMapTexture=s.normalMapTexturePtr,s.normalMapTextureBias[0]=0,s.normalMapTextureBias[1]=0,s.normalMapTextureBias[2]=1),s._inTheQueue=!1,t=window.performance.now()-i}e.enable(e.BLEND),e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),this._framebuffer.deactivate()}}get queueSize(){return this._queue.length}queue(e){e._inTheQueue=!0,this._queue.push(e)}unshift(e){e._inTheQueue=!0,this._queue.unshift(e)}remove(e){}clear(){for(;this._queue.length;)this._queue.pop()._inTheQueue=!1}lock(e){this._lock.lock(e)}free(e){this._lock.free(e)}}const dn=new an({code:"equi",units:Ta}),Pa=`(function(){"use strict";let l=null,K=null,O=null,Q=null,S=null,T=null,U=null;function P(a,t){t<0?(t=-t,a+=l.width/2):t>=l.height&&(t=2*(l.height-1)-t,a+=l.width/2),a<0?a+=l.width:a>=l.width&&(a-=l.width);var n=2*(t*l.width+a)+l.i;return l.rawfile[n]<<8|l.rawfile[n+1]}const sa=.5*Math.PI,W=2003750834e-2,ia=Math.PI/W,ua=180/W,X=180/Math.PI,Ma=X*sa,Y=Math.PI/180,da=2*X;let k=0,Z=0,_=null;const B=function(a,t,n){this.x=a,this.y=t,this.z=n};var $=function(a,t,n,o){let f=function(c,C){if(!l)return 0;c<0&&(c+=360);var w=(90-C)*l.rlatres,M=c*l.rlonres,u=Math.floor(w),d=Math.floor(M);M-=d,w-=u,u===l.height-1&&u--,K===d&&O===u||(K=d,O=u,Q=P(d,u),S=P(d+1,u),T=P(d,u+1),U=P(d+1,u+1));let L=null;return L=(1-w)*((1-M)*Q+M*S)+w*((1-M)*T+M*U),l.offset+l.scale*L}(a,t)*n,h=Y*t,r=Y*a,m=Math.sin(h),x=Z/Math.sqrt(1-k*m*m),H=(x+f)*Math.cos(h);o.x=H*Math.cos(r),o.y=H*Math.sin(r),o.z=(x*(1-k)+f)*m},ma=function(a,t,n,o){$(a*ua,da*Math.atan(Math.exp(t*ia))-Ma,n,o)},e=new B(0,0,0),p=new B(0,0,0),y=new B(0,0,0),pa=function(a,t,n){let o=a.x,f=a.y,h=a.z;var r;o>=0?(r=65536*Math.floor(o/65536),t.x=Math.fround(r),n.x=Math.fround(o-r)):(r=65536*Math.floor(-o/65536),t.x=Math.fround(-r),n.x=Math.fround(o+r)),f>=0?(r=65536*Math.floor(f/65536),t.y=Math.fround(r),n.y=Math.fround(f-r)):(r=65536*Math.floor(-f/65536),t.y=Math.fround(-r),n.y=Math.fround(f+r)),h>=0?(r=65536*Math.floor(h/65536),t.z=Math.fround(r),n.z=Math.fround(h-r)):(r=65536*Math.floor(-h/65536),t.z=Math.fround(-r),n.z=Math.fround(h+r))};self.onmessage=function(a){if(a.data.model)l=a.data.model,l.rawfile=a.data.rawfile;else if(a.data.params){let t=549755748352,n=-549755748352,o=549755748352,f=-549755748352,h=549755748352,r=-549755748352;k=a.data.params[8],Z=a.data.params[9];let m=a.data.params[2],x=a.data.params[3],H=a.data.params[10],c=a.data.params[11],C=a.data.params[12],w=a.data.params[13];_=a.data.params[1]===0?ma:$;let M=Math.max(x,m),u=(a.data.params[6]-a.data.params[4])/M,d=(a.data.params[7]-a.data.params[5])/M,L=a.data.params[4],ya=a.data.params[7],aa=Math.max(x/m,1),N=M+1;const z=N*N,R=(m+1)*(m+1)*3;let b=new Float32Array(R),A=new Float64Array(R),F=new Float32Array(R),g=new Float32Array(R),V=new Float32Array(3*z),q=new Float64Array(3*z),v=new Float32Array(3*z),I=new Float32Array(3*z),s=0,i=0;for(let j=0;j<z;j++){let la=j%N,na=~~(j/N);_(L+la*u,ya-na*d,w,e);let D=e.x*H,E=e.y*c,G=e.z*C,J=1/Math.sqrt(D*D+E*E+G*G),oa=D*J,fa=E*J,ha=G*J;pa(e,p,y),q[i]=e.x,v[i]=p.x,I[i]=y.x,V[i++]=oa,q[i]=e.y,v[i]=p.y,I[i]=y.y,V[i++]=fa,q[i]=e.z,v[i]=p.z,I[i]=y.z,V[i++]=ha,na%aa==0&&la%aa==0&&(A[s]=e.x,F[s]=p.x,g[s]=y.x,b[s++]=oa,A[s]=e.y,F[s]=p.y,g[s]=y.y,b[s++]=fa,A[s]=e.z,F[s]=p.z,g[s]=y.z,b[s++]=ha,e.x<t&&(t=e.x),e.x>n&&(n=e.x),e.y<o&&(o=e.y),e.y>f&&(f=e.y),e.z<h&&(h=e.z),e.z>r&&(r=e.z))}let ta=.5*(n-t),ra=.5*(f-o),ea=.5*(r-h),wa=Math.sqrt(ta*ta+ra*ra+ea*ea);self.postMessage({id:a.data.params[0],plainVertices:A,plainVerticesHigh:F,plainVerticesLow:g,plainNormals:b,normalMapNormals:V,normalMapVertices:q,normalMapVerticesHigh:v,normalMapVerticesLow:I,plainRadius:wa},[A.buffer,F.buffer,g.buffer,b.buffer,V.buffer,q.buffer,v.buffer,I.buffer])}}})();
//# sourceMappingURL=PlainSegmentWorker.worker-CT1cj8jj.js.map
`,lo=typeof self<"u"&&self.Blob&&new Blob([Pa],{type:"text/javascript;charset=utf-8"});function Kh(a){let e;try{if(e=lo&&(self.URL||self.webkitURL).createObjectURL(lo),!e)throw"";const t=new Worker(e,{name:a==null?void 0:a.name});return t.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(e)}),t}catch{return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(Pa),{name:a==null?void 0:a.name})}finally{e&&(self.URL||self.webkitURL).revokeObjectURL(e)}}class Qh extends Jr{constructor(e=2){super(e,Kh)}_onMessage(e){this._source.get(e.data.id)._plainSegmentWorkerCallback(e.data),e.data.plainVertices=null,e.data.plainVerticesHigh=null,e.data.plainVerticesLow=null,e.data.plainNormals=null,e.data.normalMapNormals=null,e.data.normalMapVertices=null,e.data.normalMapVerticesHigh=null,e.data.normalMapVerticesLow=null,this._source.delete(e.data.id)}setGeoid(e){if(e.model){let t=e.model,i={scale:t.scale,offset:t.offset,width:t.width,height:t.height,rlonres:t.rlonres,rlatres:t.rlatres,i:t.i};this._workerQueue.forEach(s=>{let n=new Uint8Array(t.rawfile.length);n.set(t.rawfile),s.postMessage({model:i,rawfile:n},[n.buffer])})}else this._workerQueue.forEach(t=>{t.postMessage({model:null})})}make(e){if(e.initialized)if(this._workerQueue.length){let t=this._workerQueue.pop();this._source.set(this._sourceId,e);let i=e._projection.id===Is.id||e._projection.id===dn.id?1:0,s=new Float64Array([this._sourceId,i,e.planet.terrain.gridSizeByZoom[e.tileZoom],e.planet.terrain.plainGridSize,e._extent.southWest.lon,e._extent.southWest.lat,e._extent.northEast.lon,e._extent.northEast.lat,e.planet.ellipsoid._e2,e.planet.ellipsoid.equatorialSize,e.planet.ellipsoid._invRadii2.x,e.planet.ellipsoid._invRadii2.y,e.planet.ellipsoid._invRadii2.z,e.planet._heightFactor]);this._sourceId++,t.postMessage({params:s},[s.buffer])}else this._pendingQueue.push(e);else this.check()}}const Sa=`(function(){"use strict";function H(r,e){return function(z,b){let v=0,N=z.length-1;for(;v<=N;){let n=Math.floor(.5*(v+N));if(Math.abs(z[n]-b)<.001)return n;z[n]<b?v=n+1:N=n-1}return-1}(r,e)!==-1}var y=function(r,e,z){this.x=r,this.y=e,this.z=z},Y=function(r,e,z){let b=r.x,v=r.y,N=r.z;var n;b>=0?(n=65536*Math.floor(b/65536),e.x=Math.fround(n),z.x=Math.fround(b-n)):(n=65536*Math.floor(-b/65536),e.x=Math.fround(-n),z.x=Math.fround(b+n)),v>=0?(n=65536*Math.floor(v/65536),e.y=Math.fround(n),z.y=Math.fround(v-n)):(n=65536*Math.floor(-v/65536),e.y=Math.fround(-n),z.y=Math.fround(v+n)),N>=0?(n=65536*Math.floor(N/65536),e.z=Math.fround(n),z.z=Math.fround(N-n)):(n=65536*Math.floor(-N/65536),e.z=Math.fround(-n),z.z=Math.fround(N+n))};y.prototype.sub=function(r){return new y(this.x-r.x,this.y-r.y,this.z-r.z)},y.prototype.add=function(r){return new y(this.x+r.x,this.y+r.y,this.z+r.z)},y.prototype.cross=function(r){return new y(this.y*r.z-this.z*r.y,this.z*r.x-this.x*r.z,this.x*r.y-this.y*r.x)},y.prototype.normalize=function(r){var e=this.x,z=this.y,b=this.z,v=1/Math.sqrt(e*e+z*z+b*b);return this.x=e*v,this.y=z*v,this.z=b*v,this},y.prototype.distance=function(r){return this.sub(r).length()},y.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)};var x=new y(0,0,0),i=new y(0,0,0),t=new y(0,0,0);self.onmessage=function(r){var e=r.data.elevations,z=r.data.this_plainVertices,b=r.data.this_plainNormals,v=r.data.this_normalMapVertices,N=r.data.this_normalMapNormals,n=r.data.heightFactor,Dr=r.data.gridSize,D=r.data.noDataValues,Hr=r.data.id,Q=549755748352,W=-549755748352,T=549755748352,$=-549755748352,Z=549755748352,X=-549755748352;const J=Math.sqrt(e.length)-1,K=J+1,R=K*K,C=Dr,vr=J/C,L=C+1,tr=n;var a,d,p,m,yr,sr,S=0,xr=0,U=L*L*3,h=new Float64Array(U),j=new Float32Array(U),k=new Float32Array(U),lr=new Uint8Array(L*L),u=v,g=N;if(J>=C){a=new Float32Array(3*R),d=new Float64Array(3*R),p=new Float32Array(3*R),m=new Float32Array(3*R);for(let f=0;f<R;f++){var Ar=f%K,Fr=~~(f/K),ur=f,o=3*ur,rr=e[ur];H(D,rr)&&(rr=0);var Mr=tr*rr,s=new y(u[o]+Mr*g[o],u[o+1]+Mr*g[o+1],u[o+2]+Mr*g[o+2]);if(Y(s,i,t),d[o]=s.x,d[o+1]=s.y,d[o+2]=s.z,p[o]=i.x,p[o+1]=i.y,p[o+2]=i.z,m[o]=t.x,m[o+1]=t.y,m[o+2]=t.z,Fr%vr==0&&Ar%vr==0){let A=new y(u[o],u[o+1],u[o+2]),V=new y(u[o+3],u[o+4],u[o+5]),F=e[ur+1];H(D,F)&&(F=0);let q=!1;if(D.length===0){let _=A.distance(V);q=Math.abs(rr-F)/_>10||rr<-5e3}q?lr[xr]=1:(lr[xr]=0,s.x<Q&&(Q=s.x),s.x>W&&(W=s.x),s.y<T&&(T=s.y),s.y>$&&($=s.y),s.z<Z&&(Z=s.z),s.z>X&&(X=s.z)),j[S]=i.x,k[S]=t.x,h[S++]=s.x,j[S]=i.y,k[S]=t.y,h[S++]=s.y,j[S]=i.z,k[S]=t.z,h[S++]=s.z,xr++}if(Fr!==J&&Ar!==J){var gr=f+1,M=3*gr,B=e[gr];H(D,B)&&(B=0);var cr=tr*B,ar=new y(u[M]+cr*g[M],u[M+1]+cr*g[M+1],u[M+2]+cr*g[M+2]);Y(ar,i,t),d[M]=ar.x,d[M+1]=ar.y,d[M+2]=ar.z,p[M]=i.x,p[M+1]=i.y,p[M+2]=i.z,m[M]=t.x,m[M+1]=t.y,m[M+2]=t.z;var Vr=f+K,c=3*Vr;H(D,B=e[Vr])&&(B=0);var wr=tr*B,nr=new y(u[c]+wr*g[c],u[c+1]+wr*g[c+1],u[c+2]+wr*g[c+2]);Y(nr,i,t),d[c]=nr.x,d[c+1]=nr.y,d[c+2]=nr.z,p[c]=i.x,p[c+1]=i.y,p[c+2]=i.z,m[c]=t.x,m[c+1]=t.y,m[c+2]=t.z;var qr=f+K+1,w=3*qr;H(D,B=e[qr])&&(B=0);var dr=tr*B,er=new y(u[w]+dr*g[w],u[w+1]+dr*g[w+1],u[w+2]+dr*g[w+2]);Y(er,i,t),d[w]=er.x,d[w+1]=er.y,d[w+2]=er.z,p[w]=i.x,p[w+1]=i.y,p[w+2]=i.z,m[w]=t.x,m[w+1]=t.y,m[w+2]=t.z;var Lr=ar.sub(s),Sr=nr.sub(s),Nr=er.sub(s),hr=Sr.cross(Nr).normalize(),zr=Nr.cross(Lr).normalize(),O=zr.add(hr).normalize();a[o]+=O.x,a[o+1]+=O.y,a[o+2]+=O.z,a[M]+=zr.x,a[M+1]+=zr.y,a[M+2]+=zr.z,a[c]+=hr.x,a[c+1]+=hr.y,a[c+2]+=hr.z,a[w]+=O.x,a[w+1]+=O.y,a[w+2]+=O.z}}}else{a=new Float32Array(U),d=new Float64Array(U),p=new Float32Array(U),m=new Float32Array(U),a=new Float32Array(U);var E=C/J,_r=U/3,pr=J+1;for(let f=0;f<_r;f++){let A=Math.floor(f/L),V=f%L,F=A%E,q=V%E,_=Math.floor(A/E)*pr+Math.floor(V/E);V===C&&(_-=1,q=E),A===C&&(_-=pr,F=E);let mr=_+1,fr=_+pr,br=fr+1,or=e[_],ir=e[mr],P=e[fr],G=e[br];H(D,or)&&(or=0),H(D,ir)&&(ir=0),H(D,P)&&(P=0),H(D,G)&&(G=0);let I=or*(1-(yr=q/E))*(1-(sr=F/E))+ir*yr*(1-sr)+P*(1-yr)*sr+G*yr*sr,l=3*f;x.x=z[l]+I*b[l],x.y=z[l+1]+I*b[l+1],x.z=z[l+2]+I*b[l+2],Y(x,i,t),h[l]=x.x,h[l+1]=x.y,h[l+2]=x.z,j[l]=i.x,j[l+1]=i.y,j[l+2]=i.z,k[l]=t.x,k[l+1]=t.y,k[l+2]=t.z,x.x<Q&&(Q=x.x),x.x>W&&(W=x.x),x.y<T&&(T=x.y),x.y>$&&($=x.y),x.z<Z&&(Z=x.z),x.z>X&&(X=x.z)}d.set(h),p.set(j),m.set(k);for(let f=0;f<_r;f++)if(~~(f/L)!==C&&f%L!==C){let A=3*f,V=A+3,F=A+3*L,q=F+3,_=new y(h[A],h[A+1],h[A+2]),mr=new y(h[V],h[V+1],h[V+2]),fr=new y(h[F],h[F+1],h[F+2]),br=new y(h[q],h[q+1],h[q+2]),or=mr.sub(_).normalize(),ir=fr.sub(_).normalize(),P=br.sub(_).normalize(),G=ir.cross(P).normalize(),I=P.cross(or).normalize(),l=I.add(G).normalize();a[A]+=l.x,a[A+1]+=l.y,a[A+2]+=l.z,a[V]+=I.x,a[V+1]+=I.y,a[V+2]+=I.z,a[F]+=G.x,a[F+1]+=G.y,a[F+2]+=G.z,a[q]+=l.x,a[q+1]+=l.y,a[q+2]+=l.z}}self.postMessage({id:Hr,normalMapNormals:a,normalMapVertices:d,normalMapVerticesHigh:p,normalMapVerticesLow:m,terrainVertices:h,terrainVerticesHigh:j,terrainVerticesLow:k,noDataVertices:lr,bounds:[Q,T,Z,W,$,X]},[a.buffer,d.buffer,p.buffer,m.buffer,h.buffer,j.buffer,k.buffer,lr.buffer])}})();
//# sourceMappingURL=TerrainWorker.worker-DmikdfB2.js.map
`,ho=typeof self<"u"&&self.Blob&&new Blob([Sa],{type:"text/javascript;charset=utf-8"});function Jh(a){let e;try{if(e=ho&&(self.URL||self.webkitURL).createObjectURL(ho),!e)throw"";const t=new Worker(e,{name:a==null?void 0:a.name});return t.addEventListener("error",()=>{(self.URL||self.webkitURL).revokeObjectURL(e)}),t}catch{return new Worker("data:text/javascript;charset=utf-8,"+encodeURIComponent(Sa),{name:a==null?void 0:a.name})}finally{e&&(self.URL||self.webkitURL).revokeObjectURL(e)}}class tc extends Jr{constructor(e=2){super(e,Jh)}_onMessage(e){this._source.get(e.data.id).segment._terrainWorkerCallback(e.data),this._source.delete(e.data.id),e.data.normalMapNormals=null,e.data.normalMapVertices=null,e.data.normalMapVerticesHigh=null,e.data.normalMapVerticesLow=null,e.data.terrainVertices=null,e.data.terrainVerticesHigh=null,e.data.terrainVerticesLow=null}make(e){if(e.segment.plainReady&&e.segment.terrainIsLoading)if(this._workerQueue.length){const t=this._workerQueue.pop();this._source.set(this._sourceId,e);let i=e.segment;t.postMessage({elevations:e.elevations,this_plainVertices:i.plainVertices,this_plainNormals:i.plainNormals,this_normalMapVertices:i.normalMapVertices,this_normalMapNormals:i.normalMapNormals,heightFactor:i.planet._heightFactor,gridSize:i.planet.terrain.gridSizeByZoom[i.tileZoom],noDataValues:i.planet.terrain.noDataValues,id:this._sourceId},[e.elevations.buffer,i.plainVertices.buffer,i.plainNormals.buffer,i.normalMapVertices.buffer,i.normalMapNormals.buffer]),this._sourceId++}else this._pendingQueue.push(e);else this.check()}}let Oe=new Float32Array(2);class ec{constructor(e,t=256,i=256){this._width=t,this._height=i,this._planet=e,this._framebuffer=null,this._queue=[],this._handler=null}init(){this._handler=this._planet.renderer.handler,this._handler.programs.vectorTileLineRasterization||this._handler.addProgram(new $("vectorTileLineRasterization",{uniforms:{viewport:"vec2",thicknessOutline:"float",alpha:"float",extentParamsHigh:"vec4",extentParamsLow:"vec4"},attributes:{prevHigh:"vec2",currentHigh:"vec2",nextHigh:"vec2",prevLow:"vec2",currentLow:"vec2",nextLow:"vec2",order:"float",color:"vec4",thickness:"float"},vertexShader:`attribute vec2 prevHigh;
                attribute vec2 currentHigh;
                attribute vec2 nextHigh;

                attribute vec2 prevLow;
                attribute vec2 currentLow;
                attribute vec2 nextLow;

                attribute float order;
                attribute float thickness;
                attribute vec4 color;
                uniform float thicknessOutline;
                uniform vec2 viewport;
                uniform vec4 extentParamsHigh;
                uniform vec4 extentParamsLow;
                varying vec4 vColor;
                
                vec2 proj(vec2 coordHigh, vec2 coordLow) {
                    vec2 highDiff = coordHigh - extentParamsHigh.xy;
                    vec2 lowDiff = coordLow - extentParamsLow.xy;                    
                    return vec2(-1.0 + (highDiff * step(1.0, length(highDiff)) + lowDiff) * extentParamsHigh.zw) * vec2(1.0, -1.0);
                }
                
                void main(){
                    vColor = color;

                    vec2 vNext = proj(nextHigh, nextLow),
                         vCurrent = proj(currentHigh, currentLow),
                         vPrev = proj(prevHigh, prevLow);

                    vec2 _next = vNext;
                    vec2 _prev = vPrev;
                    vec2 _current = vCurrent;

                    if(_prev == _current){
                        if(_next == _current){
                            _next = _current + vec2(1.0, 0.0);
                            _prev = _current - _next;
                        }else{
                            _prev = _current + normalize(_current - _next);
                        }
                    }

                    if(_next == _current){
                        _next = _current + normalize(_current - _prev);
                    }

                    vec2 sNext = _next;
                    vec2 sCurrent = _current;
                    vec2 sPrev = _prev;
                    
                    vec2 dirNext = normalize(sNext - sCurrent);
                    vec2 dirPrev = normalize(sPrev - sCurrent);
                    float dotNP = dot(dirNext, dirPrev);
                    
                    vec2 normalNext = normalize(vec2(-dirNext.y, dirNext.x));
                    vec2 normalPrev = normalize(vec2(dirPrev.y, -dirPrev.x));
                    vec2 d = (thickness + thicknessOutline) * 0.5 * sign(order) / viewport;
                    
                    vec2 m;
                    if(dotNP >= 0.99991){
                        m = sCurrent - normalPrev * d;
                    }else{
                        vec2 dir = normalPrev + normalNext;
                        m = sCurrent + dir * d / (dirNext.x * dir.y - dirNext.y * dir.x);
                        
                        if( dotNP > 0.5 && dot(dirNext + dirPrev, m - sCurrent) < 0.0 ){
                            float occw = order * sign(dirNext.x * dirPrev.y - dirNext.y * dirPrev.x);
                            if(occw == -1.0){
                                m = sCurrent + normalPrev * d;
                            }else if(occw == 1.0){
                                m = sCurrent + normalNext * d;
                            }else if(occw == -2.0){
                                m = sCurrent + normalNext * d;
                            }else if(occw == 2.0){
                                m = sCurrent + normalPrev * d;
                            }
                        }else if(distance(sCurrent, m) > min(distance(sCurrent, sNext), distance(sCurrent, sPrev))){
                            m = sCurrent + normalNext * d;
                        }
                    }
                    gl_Position = vec4(m.x, m.y, 0.0, 1.0);
                }`,fragmentShader:`precision highp float;
                uniform float alpha;
                varying vec4 vColor;
                void main() {
                    gl_FragColor = vec4(vColor.rgb, alpha * vColor.a);
                }`})),this._handler.programs.vectorTilePolygonRasterization||this._handler.addProgram(new $("vectorTilePolygonRasterization",{uniforms:{extentParamsHigh:"vec4",extentParamsLow:"vec4"},attributes:{coordinatesHigh:"vec2",coordinatesLow:"vec2",colors:"vec4"},vertexShader:`attribute vec2 coordinatesHigh;
                attribute vec2 coordinatesLow; 
                attribute vec4 colors; 
                uniform vec4 extentParamsHigh; 
                uniform vec4 extentParamsLow; 
                varying vec4 color;

                vec2 proj(vec2 coordHigh, vec2 coordLow) {
                    vec2 highDiff = coordHigh - extentParamsHigh.xy;
                    vec2 lowDiff = coordLow - extentParamsLow.xy;
                    return vec2(-1.0 + (highDiff * step(1.0, length(highDiff)) + lowDiff) * extentParamsHigh.zw) * vec2(1.0, -1.0);
                }

                void main() { 
                    color = colors;
                    gl_Position = vec4(proj(coordinatesHigh, coordinatesLow), 0.0, 1.0); 
                }`,fragmentShader:`precision highp float;
                varying vec4 color;
                void main () {  
                    gl_FragColor = color; 
                }`})),this._framebuffer=new St(this._handler,{width:this._width,height:this._height,useDepth:!1}),this._framebuffer.init()}frame(){if(this._planet.layerLock.isFree()&&this._queue.length){let e=this._handler,t=e.gl;t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST);let i=e.programs.vectorTileLineRasterization,s=e.programs.vectorTilePolygonRasterization,n=this._width,o=this._height,l=n,h=o,c=l<<1,d=h<<1,u=new Float32Array(4),f=new Float32Array(4),_=this._framebuffer.activate(),g=0,v=window.performance.now();for(;this._queue.length&&g<25;){let p=this._queue.shift();if(p.isLoading&&p.segment.node.getState()===1){let y=p.layer._pickingEnabled;p.segment.tileZoom<4?(l=c,h=d):(l=n,h=o);let b=p._updateTexture||e.createEmptyTexture_l(l,h),C=y?p._updatePickingMask||e.createEmptyTexture_n(l,h):null;p.applyTexture(b,C),_.setSize(l,h),_.bindOutputTexture(b),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT);let T=p.segment.getExtentMerc();oe(T.southWest.lon,Oe),u[0]=Oe[0],f[0]=Oe[1],oe(T.southWest.lat,Oe),u[1]=Oe[0],f[1]=Oe[1],u[2]=2/T.getWidth(),u[3]=2/T.getHeight(),s.activate();let w=s._program,L=w.attributes,S=w.uniforms,P=p.layer._geometryHandler;t.uniform4fv(S.extentParamsHigh,u),t.uniform4fv(S.extentParamsLow,f),t.bindBuffer(t.ARRAY_BUFFER,P._polyVerticesHighBufferMerc),t.vertexAttribPointer(L.coordinatesHigh,P._polyVerticesHighBufferMerc.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,P._polyVerticesLowBufferMerc),t.vertexAttribPointer(L.coordinatesLow,P._polyVerticesLowBufferMerc.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,P._polyColorsBuffer),t.vertexAttribPointer(L.colors,P._polyColorsBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,P._polyIndexesBuffer),t.drawElements(t.TRIANGLES,P._polyIndexesBuffer.numItems,t.UNSIGNED_INT,0),y&&(_.bindOutputTexture(C),t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT),t.bindBuffer(t.ARRAY_BUFFER,P._polyPickingColorsBuffer),t.vertexAttribPointer(L.colors,P._polyPickingColorsBuffer.itemSize,t.FLOAT,!1,0,0),t.drawElements(t.TRIANGLES,P._polyIndexesBuffer.numItems,t.UNSIGNED_INT,0)),_.bindOutputTexture(b),i.activate(),w=i._program,L=w.attributes,S=w.uniforms,t.uniform2fv(S.viewport,[l,h]),t.uniform4fv(S.extentParamsHigh,u),t.uniform4fv(S.extentParamsLow,f);let B=P._lineVerticesHighBufferMerc;t.bindBuffer(t.ARRAY_BUFFER,B),t.vertexAttribPointer(L.prevHigh,B.itemSize,t.FLOAT,!1,8,0),t.vertexAttribPointer(L.currentHigh,B.itemSize,t.FLOAT,!1,8,32),t.vertexAttribPointer(L.nextHigh,B.itemSize,t.FLOAT,!1,8,64),B=P._lineVerticesLowBufferMerc,t.bindBuffer(t.ARRAY_BUFFER,B),t.vertexAttribPointer(L.prevLow,B.itemSize,t.FLOAT,!1,8,0),t.vertexAttribPointer(L.currentLow,B.itemSize,t.FLOAT,!1,8,32),t.vertexAttribPointer(L.nextLow,B.itemSize,t.FLOAT,!1,8,64),t.bindBuffer(t.ARRAY_BUFFER,P._lineOrdersBuffer),t.vertexAttribPointer(L.order,P._lineOrdersBuffer.itemSize,t.FLOAT,!1,4,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,P._lineIndexesBuffer),t.bindBuffer(t.ARRAY_BUFFER,P._lineStrokesBuffer),t.vertexAttribPointer(L.thickness,P._lineStrokesBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,P._lineStrokeColorsBuffer),t.vertexAttribPointer(L.color,P._lineStrokeColorsBuffer.itemSize,t.FLOAT,!1,0,0),t.uniform1f(S.thicknessOutline,2),t.uniform1f(S.alpha,.54),t.drawElements(t.TRIANGLE_STRIP,P._lineIndexesBuffer.numItems,t.UNSIGNED_INT,0),t.uniform1f(S.thicknessOutline,1),t.uniform1f(S.alpha,1),t.drawElements(t.TRIANGLE_STRIP,P._lineIndexesBuffer.numItems,t.UNSIGNED_INT,0),t.bindBuffer(t.ARRAY_BUFFER,P._lineThicknessBuffer),t.vertexAttribPointer(L.thickness,P._lineThicknessBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,P._lineColorsBuffer),t.vertexAttribPointer(L.color,P._lineColorsBuffer.itemSize,t.FLOAT,!1,0,0),t.uniform1f(S.thicknessOutline,2),t.uniform1f(S.alpha,.54),t.drawElements(t.TRIANGLE_STRIP,P._lineIndexesBuffer.numItems,t.UNSIGNED_INT,0),t.uniform1f(S.thicknessOutline,1),t.uniform1f(S.alpha,1),t.drawElements(t.TRIANGLE_STRIP,P._lineIndexesBuffer.numItems,t.UNSIGNED_INT,0),y&&(_.bindOutputTexture(C),t.uniform1f(S.thicknessOutline,8),t.bindBuffer(t.ARRAY_BUFFER,P._linePickingColorsBuffer),t.vertexAttribPointer(L.color,P._linePickingColorsBuffer.itemSize,t.FLOAT,!1,0,0),t.drawElements(t.TRIANGLE_STRIP,P._lineIndexesBuffer.numItems,t.UNSIGNED_INT,0))}else p.isLoading=!1;g=window.performance.now()-v}t.enable(t.DEPTH_TEST),t.enable(t.CULL_FACE),_.deactivate()}}add(e){this._queue.push(e)}remove(e){}get queueSize(){return this._queue.length}}class Si extends ce{constructor(e={}){super(e.name),this._minDistanceBeforeMemClear=0,this._renderingFadingNodes=(l,h,c,d,u,f,_,g)=>{let v=f===0,p=this.terrain.equalizeVertices;for(let y=0,b=d._fadingNodes.length;y<b;y++){let C=d._fadingNodes[y].segment;l._fadingNodes.has(d._fadingNodes[0].__id)&&!h.has(C.node.__id)&&(h.set(C.node.__id,!0),C._transitionOpacity<1?_.push(C):v?(p&&C.equalize(),C.readyToEngage&&C.engage(),C.screenRendering(c,u,f),g.push(C)):C.screenRendering(c,u,f,this.transparentTexture,!0))}},this._renderingFadingNodesNoDepth=(l,h,c,d,u,f,_)=>{let g=f===0,v=this.terrain.equalizeVertices,p=c.gl;p.disable(p.DEPTH_TEST);for(let y=0,b=d._fadingNodes.length;y<b;y++){let C=d._fadingNodes[y].segment;l._fadingNodes.has(d._fadingNodes[0].__id)&&!h.has(C.node.__id)&&(h.set(C.node.__id,!0),g?(v&&C.equalize(),C.readyToEngage&&C.engage(),C.screenRendering(c,u,f),_.push(C)):C.screenRendering(c,u,f,this.transparentTexture,!0))}p.enable(p.DEPTH_TEST)},this._createdNodesCount=0,this._atmosphere=new Hh(e.atmosphereParameters),this.transitionTime=580,this.ellipsoid=e.ellipsoid||Lo,this.lightEnabled=!0,this._planetRadius2=(this.ellipsoid.getPolarSize()-1e4)*(this.ellipsoid.getPolarSize()-1e4),this._layers=[],this._updateLayers=!1,this.visibleTileLayers=[],this.visibleVectorLayers=[],this._visibleVectorLayersByDepthOrder=[],this._visibleTileLayerSlices=[],this._visibleEntityCollections=[[]],this.baseLayer=null,this.terrain=null,this.camera=new xa(this,{frustums:e.frustums,eye:new m(25e6,0,0),look:m.ZERO,up:m.NORTH,minAltitude:e.minAltitude,maxAltitude:e.maxAltitude}),this.mousePositionOnEarth=new m,this.emptyTexture=null,this.transparentTexture=null,this.defaultTexture=null,this._initialViewExtent=null,this.layerLock=new kr,this.terrainLock=new kr,this._heightFactor=1,this._indexesCache=[],this._indexesCacheToRemove=[],this._indexesCacheToRemoveCounter=0,this._textureCoordsBufferCache=[];const t={planet:this,maxEqualZoomAltitude:e.maxEqualZoomAltitude,minEqualZoomAltitude:e.minEqualZoomAltitude,minEqualZoomCameraSlope:e.minEqualZoomCameraSlope,transitionOpacityEnabled:e.transitionOpacityEnabled};this.quadTreeStrategyPrototype=e.quadTreeStrategyPrototype||Ea,this.quadTreeStrategy=new this.quadTreeStrategyPrototype(t),this._nightTexture=null,this._specularTexture=null;let i=Gt(e.ambient,new m(.2,.2,.3)),s=Gt(e.diffuse,new m(1,1,1)),n=Gt(e.specular,new m(63e-5,55e-5,32e-5)),o=e.shininess||18;this._ambient=new Float32Array([i.x,i.y,i.z]),this._diffuse=new Float32Array([s.x,s.y,s.z]),this._specular=new Float32Array([n.x,n.y,n.z,o]),this._maxGridSize=Math.log2(e.maxGridSize||256),this.SLICE_SIZE=4,this.SLICE_SIZE_4=4*this.SLICE_SIZE,this.SLICE_SIZE_3=3*this.SLICE_SIZE,this._maxNodes=e.maxNodesCount||200,this._pickingColorArr=new Float32Array(this.SLICE_SIZE_4),this._samplerArr=new Int32Array(this.SLICE_SIZE),this._pickingMaskArr=new Int32Array(this.SLICE_SIZE),this._geoImageCreator=new $h(this),this._vectorTileCreator=new ec(this,e.vectorTileSize,e.vectorTileSize),this._normalMapCreator=new Zh(this),this._terrainWorker=new tc(3),this._plainSegmentWorker=new Qh(3),this._tileLoader=new La(e.maxLoadingRequests||12),this._memKey=new Re,this.events=at(ic),this._distBeforeMemClear=0,this._prevCamEye=new m,this._initialized=!1,this._collectRenderNodesIsActive=!0,this.nightTextureCoefficient=2,this._renderScreenNodesPASS=this._renderScreenNodesPASSNoAtmos,this._renderScreenNodesWithHeightPASS=this._renderScreenNodesWithHeightPASSNoAtmos,this._atmosphereEnabled=e.atmosphereEnabled||!1,this._atmosphereMaxMinOpacity=new Float32Array([.95,.28]),this.solidTextureOne=null,this.solidTextureTwo=null,this._nightTextureSrc=e.nightTextureSrc||null,this._specularTextureSrc=e.specularTextureSrc||null,this._transparentBackground=e.transparentBackground||!1}get terrainReady(){return this.quadTreeStrategy.terrainReady}get maxGridSize(){return this._maxGridSize}getNorthFrameRotation(e){return this.getFrameRotation(e)}getFrameRotation(e){return this.ellipsoid.getNorthFrameRotation(e)}set atmosphereMaxOpacity(e){this._atmosphereMaxMinOpacity[0]=e}get atmosphereMaxOpacity(){return this._atmosphereMaxMinOpacity[0]}set atmosphereMinOpacity(e){this._atmosphereMaxMinOpacity[1]=e}get atmosphereMinOpacity(){return this._atmosphereMaxMinOpacity[1]}set atmosphereEnabled(e){e!=this._atmosphereEnabled&&(this._atmosphereEnabled=e,this._initializeAtmosphere())}get atmosphereEnabled(){return this._atmosphereEnabled}set diffuse(e){let t=Gt(e);this._diffuse=new Float32Array(t.toArray())}set ambient(e){let t=Gt(e);this._ambient=new Float32Array(t.toArray())}set specular(e){let t=Gt(e);this._specular=new Float32Array([t.x,t.y,t.y,this._specular[3]])}set shininess(e){this._specular[3]=e}get normalMapCreator(){return this._normalMapCreator}get layers(){return[...this._layers]}get sun(){if(this.renderer&&this.renderer.controls.sun)return this.renderer.controls.sun}get sunPos(){return this.sun.sunlight.getPosition()}addControl(e){e.planet=this,e.addTo(this.renderer)}addControls(e){for(let t=0;t<e.length;t++)this.addControl(e[t])}getLayerByName(e){for(let t=0,i=this._layers.length;t<i;t++)if(e===this._layers[t].name)return this._layers[t]}addLayer(e){e.addTo(this)}_onLayerVisibilityChanged(e){this.events.dispatch(this.events.layervisibilitychange,e)}addLayers(e){for(let t=0,i=e.length;t<i;t++)this.addLayer(e[t])}removeLayer(e){e.remove()}_clearLayerMaterial(e){this.quadTreeStrategy.clearLayerMaterial(e)}setBaseLayer(e){this.baseLayer?this.baseLayer.isEqual(e)||(this.baseLayer.setVisibility(!1),this.baseLayer=e,e.setVisibility(!0),this.events.dispatch(this.events.baselayerchange,e)):(this.baseLayer=e,this.baseLayer.setVisibility(!0),this.events.dispatch(this.events.baselayerchange,e))}setHeightFactor(e){this._heightFactor!==e&&(this._heightFactor=e,this.quadTreeStrategy.destroyBranches(),this.quadTreeStrategy.clearRenderedNodes())}getHeightFactor(){return this._heightFactor}setTerrain(e){this._initialized&&this.memClear(),this.terrain&&(this.terrain.abortLoading(),this.terrain.clearCache(),this.terrain._planet=null),this.terrain=e,this.terrain._planet=this,this.quadTreeStrategy.destroyBranches(),e._geoid.model?(this._plainSegmentWorker.setGeoid(e.getGeoid()),e._isReady=!0):Aa.loadModel(e.geoid.src).then(t=>{e.geoid.setModel(t),this._plainSegmentWorker.setGeoid(e.getGeoid()),e._isReady=!0}).catch(t=>{console.warn(t)})}initAtmosphereShader(e){if(this.renderer&&this.renderer.handler&&this._atmosphereEnabled){let t=this.renderer.handler;t.isWebGl2()?(t.removeProgram("drawnode_screen_wl"),t.addProgram(oo(e))):console.warn("Atmosphere WebGL2 only")}}get atmosphereControl(){return this._atmosphere}_initializeAtmosphere(){if(!this.renderer)return;let e=this.renderer.handler;e.removeProgram("drawnode_screen_wl"),this._atmosphereEnabled?(this._renderScreenNodesPASS=this._renderScreenNodesPASSAtmos,this._renderScreenNodesWithHeightPASS=this._renderScreenNodesWithHeightPASSAtmos,this.renderer.controls.Atmosphere||this.addControl(this._atmosphere),this._atmosphere.activate(),e.isWebGl2()?e.addProgram(oo(this._atmosphere.parameters)):e.addProgram(no()),this._transparentBackground||this.renderer.controls.SimpleSkyBackground&&this.renderer.controls.SimpleSkyBackground.deactivate()):(this._renderScreenNodesPASS=this._renderScreenNodesPASSNoAtmos,this._renderScreenNodesWithHeightPASS=this._renderScreenNodesWithHeightPASSNoAtmos,this._atmosphere.deactivate(),this._transparentBackground||(this.renderer.controls.SimpleSkyBackground?this.renderer.controls.SimpleSkyBackground.activate():this.addControl(new _a)),e.isWebGl2()?e.addProgram(new $("drawnode_screen_wl",{uniforms:{projectionMatrix:"mat4",viewMatrix:"mat4",eyePositionHigh:"vec3",eyePositionLow:"vec3",height:"float",uGlobalTextureCoord:"vec4",uNormalMapBias:"vec3",samplerCount:"int",tileOffsetArr:"vec4",layerOpacityArr:"float",samplerArr:"sampler2darray",defaultTexture:"sampler2d",uNormalMap:"sampler2d",nightTexture:"sampler2d",specularTexture:"sampler2d",lightPosition:"vec3",diffuse:"vec3",ambient:"vec3",specular:"vec4",camHeight:"float",nightTextureCoefficient:"float",transitionOpacity:"float"},attributes:{aVertexPositionHigh:"vec3",aVertexPositionLow:"vec3",aTextureCoord:"vec2"},vertexShader:`#version 300 es
precision highp float;in vec3 aVertexPositionHigh;in vec3 aVertexPositionLow;in vec2 aTextureCoord;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform vec4 uGlobalTextureCoord;uniform vec3 uNormalMapBias;uniform vec3 eyePositionHigh;uniform vec3 eyePositionLow;uniform float height;out vec4 vTextureCoord;out vec3 v_vertex;out vec3 cameraPosition;out vec2 vGlobalTextureCoord;out float v_height;void main(void){vec3 aVertexPosition=aVertexPositionHigh+aVertexPositionLow;vec3 nh=height*normalize(aVertexPosition);vTextureCoord.xy=aTextureCoord;vGlobalTextureCoord=uGlobalTextureCoord.xy+(uGlobalTextureCoord.zw-uGlobalTextureCoord.xy)*aTextureCoord;vTextureCoord.zw=uNormalMapBias.z*(aTextureCoord+uNormalMapBias.xy);cameraPosition=eyePositionHigh+eyePositionLow;vec3 highDiff=aVertexPositionHigh-eyePositionHigh;vec3 lowDiff=aVertexPositionLow-eyePositionLow+nh;mat4 viewMatrixRTE=viewMatrix;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);v_height=height;v_vertex=aVertexPosition+nh;gl_Position=projectionMatrix*viewMatrixRTE*vec4(highDiff*step(1.0,length(highDiff))+lowDiff,1.0);}`,fragmentShader:`#version 300 es
precision highp float;float getLerpValue(in float min,in float max,in float between){return(clamp(between,min,max)-min)/(max-min);}vec3 aces(vec3 color){float a=2.51;float b=0.03;float c=2.43;float d=0.59;float e=0.14;return clamp((color*(a*color+b))/(color*(c*color+d)+e),0.0,1.0);}bool intersectSphere(vec3 rayOrigin,vec3 rayDirection,float radius,inout float t1,inout float t2){float b=dot(rayDirection,rayOrigin);float c=dot(rayOrigin,rayOrigin)-radius*radius;float d=b*b-c;if(d<0.0){return false;}t1=-b-sqrt(d);t2=-b+sqrt(d);return true;}bool intersectSphere(vec3 rayOrigin,vec3 rayDirection,float radius,inout float t){float b=dot(rayDirection,rayOrigin);float c=dot(rayOrigin,rayOrigin)-radius*radius;float d=b*b-c;if(d<0.0){return false;}t=-b-sqrt(d);return true;}float intersectSphere(vec3 ro,vec3 rd,vec4 sph){vec3 oc=ro-sph.xyz;float b=dot(oc,rd);float c=dot(oc,oc)-sph.w*sph.w;float h=b*b-c;if(h<0.0)return-1.0;h=sqrt(h);return-b-h;}bool intersectEllipsoid(in vec3 ro,in vec3 rd,in vec3 ra,inout float t){vec3 ocn=ro/ra;vec3 rdn=rd/ra;float a=dot(rdn,rdn);float b=dot(ocn,rdn);float c=dot(ocn,ocn);float h=b*b-a*(c-1.0);if(h<0.0){return false;}t=(-b-sqrt(h))/a;return true;}bool intersectEllipsoid(in vec3 ro,in vec3 rd,in vec3 ra,inout float t1,inout float t2){vec3 ocn=ro/ra;vec3 rdn=rd/ra;float a=dot(rdn,rdn);float b=dot(ocn,rdn);float c=dot(ocn,ocn);float h=b*b-a*(c-1.0);if(h<0.0){return false;}h=sqrt(h);t1=(-b-h)/a;t2=(-b+h)/a;return true;}vec3 normalEllipsoid(in vec3 pos,in vec3 ra){return normalize(pos/(ra*ra));}
#ifdef WEBGL2
#define TEXTURE_FUNC texture
#else
#define TEXTURE_FUNC texture2D
#endif
#define SLICE_SIZE 5
#define blend(DEST, SAMPLER, OFFSET, OPACITY) src = TEXTURE_FUNC(SAMPLER, OFFSET.xy + vTextureCoord.xy * OFFSET.zw); DEST = DEST * (1.0 - src.a * OPACITY) + src * OPACITY;
#define blendPicking(DEST, OFFSET, SAMPLER, MASK, COLOR, OPACITY) tc = OFFSET.xy + vTextureCoord.xy * OFFSET.zw; t = TEXTURE_FUNC(SAMPLER, tc); p = TEXTURE_FUNC(MASK, tc); DEST = mix(DEST, vec4(max(COLOR.rgb, p.rgb), OPACITY), (t.a == 0.0 ? 0.0: 1.0) * COLOR.a);
const vec3 nightStep=10.0*vec3(0.58,0.48,0.25);uniform vec4 specular;uniform vec3 diffuse;uniform vec3 ambient;uniform sampler2D uNormalMap;uniform sampler2D nightTexture;uniform sampler2D specularTexture;uniform sampler2D defaultTexture;uniform sampler2D samplerArr[SLICE_SIZE];uniform vec4 tileOffsetArr[SLICE_SIZE];uniform vec3 lightPosition;uniform float layerOpacityArr[SLICE_SIZE];uniform int samplerCount;uniform float nightTextureCoefficient;uniform float transitionOpacity;uniform float camHeight;in vec4 vTextureCoord;in vec3 v_vertex;in vec3 cameraPosition;in vec2 vGlobalTextureCoord;in float v_height;vec3 sunPos;layout(location=0)out vec4 diffuseColor;void main(void){sunPos=lightPosition;vec3 texNormal=texture(uNormalMap,vTextureCoord.zw).rgb;vec3 normal=normalize((texNormal-0.5)*2.0);float minH=1200000.0;float maxH=minH*3.0;float nightCoef=getLerpValue(minH,maxH,camHeight)*nightTextureCoefficient;vec3 lightDir=normalize(sunPos);vec3 viewDir=normalize(cameraPosition-v_vertex);float overGround=1.0-step(0.1,v_height);float shininess=texture(specularTexture,vGlobalTextureCoord.st).r*255.0*overGround;vec3 reflectionDirection=reflect(-lightDir,normal);float reflection=max(dot(reflectionDirection,viewDir),0.0);vec3 spec=specular.rgb*pow(reflection,specular.w)*shininess;float diffuseLightWeighting=max(dot(normal,lightDir),0.0);vec4 nightImageColor=texture(nightTexture,vGlobalTextureCoord.st);vec3 night=nightStep*(.18-diffuseLightWeighting*3.0)*nightImageColor.rgb*nightCoef;night*=overGround*step(0.0,night);vec4 lightWeighting=vec4(ambient+diffuse*diffuseLightWeighting+night,1.0);diffuseColor=texture(defaultTexture,vTextureCoord.xy);if(samplerCount==0){diffuseColor=diffuseColor*lightWeighting+vec4(spec,0.0);diffuseColor*=transitionOpacity;return;}vec4 src;blend(diffuseColor,samplerArr[0],tileOffsetArr[0],layerOpacityArr[0]);if(samplerCount==1){diffuseColor=diffuseColor*lightWeighting+vec4(spec,0.0);diffuseColor*=transitionOpacity;return;}blend(diffuseColor,samplerArr[1],tileOffsetArr[1],layerOpacityArr[1]);if(samplerCount==2){diffuseColor=diffuseColor*lightWeighting+vec4(spec,0.0);diffuseColor*=transitionOpacity;return;}blend(diffuseColor,samplerArr[2],tileOffsetArr[2],layerOpacityArr[2]);if(samplerCount==3){diffuseColor=diffuseColor*lightWeighting+vec4(spec,0.0);diffuseColor*=transitionOpacity;return;}blend(diffuseColor,samplerArr[3],tileOffsetArr[3],layerOpacityArr[3]);if(samplerCount==4){diffuseColor=diffuseColor*lightWeighting+vec4(spec,0.0);diffuseColor*=transitionOpacity;return;}blend(diffuseColor,samplerArr[4],tileOffsetArr[4],layerOpacityArr[4]);diffuseColor=diffuseColor*lightWeighting+vec4(spec,0.0);diffuseColor*=transitionOpacity;}`})):e.addProgram(no()))}_initializeShaders(){if(!this.renderer)throw new Error("Renderer is not initialized");let e=this.renderer,t=e.handler;t.addProgram(new $("drawnode_screen_nl",{uniforms:{projectionMatrix:"mat4",viewMatrix:"mat4",eyePositionHigh:"vec3",eyePositionLow:"vec3",samplerCount:"int",tileOffsetArr:"vec4",layerOpacityArr:"float",samplerArr:"sampler2darray",defaultTexture:"sampler2d",height:"float"},attributes:{aVertexPositionHigh:"vec3",aVertexPositionLow:"vec3",aTextureCoord:"vec2"},vertexShader:"precision highp float;attribute vec3 aVertexPositionHigh;attribute vec3 aVertexPositionLow;attribute vec2 aTextureCoord;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform vec3 eyePositionHigh;uniform vec3 eyePositionLow;uniform float height;varying vec2 vTextureCoord;void main(void){vTextureCoord=aTextureCoord;vec3 nh=height*normalize(aVertexPositionHigh+aVertexPositionLow);mat4 viewMatrixRTE=viewMatrix;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);mat4 m=projectionMatrix*viewMatrixRTE;vec3 highDiff=aVertexPositionHigh-eyePositionHigh;vec3 lowDiff=aVertexPositionLow-eyePositionLow+nh;gl_Position=m*vec4(highDiff*step(1.0,length(highDiff))+lowDiff,1.0);}",fragmentShader:`precision highp float;
#ifdef WEBGL2
#define TEXTURE_FUNC texture
#else
#define TEXTURE_FUNC texture2D
#endif
#define SLICE_SIZE 5
#define blend(DEST, SAMPLER, OFFSET, OPACITY) src = TEXTURE_FUNC(SAMPLER, OFFSET.xy + vTextureCoord.xy * OFFSET.zw); DEST = DEST * (1.0 - src.a * OPACITY) + src * OPACITY;
#define blendPicking(DEST, OFFSET, SAMPLER, MASK, COLOR, OPACITY) tc = OFFSET.xy + vTextureCoord.xy * OFFSET.zw; t = TEXTURE_FUNC(SAMPLER, tc); p = TEXTURE_FUNC(MASK, tc); DEST = mix(DEST, vec4(max(COLOR.rgb, p.rgb), OPACITY), (t.a == 0.0 ? 0.0: 1.0) * COLOR.a);
const vec3 nightStep=10.0*vec3(0.58,0.48,0.25);uniform vec4 tileOffsetArr[SLICE_SIZE];uniform float layerOpacityArr[SLICE_SIZE];uniform sampler2D defaultTexture;uniform sampler2D samplerArr[SLICE_SIZE];uniform int samplerCount;varying vec2 vTextureCoord;void main(void){gl_FragColor=texture2D(defaultTexture,vTextureCoord);if(samplerCount==0)return;vec4 src;blend(gl_FragColor,samplerArr[0],tileOffsetArr[0],layerOpacityArr[0]);if(samplerCount==1)return;blend(gl_FragColor,samplerArr[1],tileOffsetArr[1],layerOpacityArr[1]);if(samplerCount==2)return;blend(gl_FragColor,samplerArr[2],tileOffsetArr[2],layerOpacityArr[2]);if(samplerCount==3)return;blend(gl_FragColor,samplerArr[3],tileOffsetArr[3],layerOpacityArr[3]);if(samplerCount==4)return;blend(gl_FragColor,samplerArr[4],tileOffsetArr[4],layerOpacityArr[4]);}`})),t.addProgram(new $("drawnode_colorPicking",{uniforms:{projectionMatrix:"mat4",viewMatrix:"mat4",eyePositionHigh:"vec3",eyePositionLow:"vec3",samplerCount:"int",tileOffsetArr:"vec4",samplerArr:"sampler2darray",pickingMaskArr:"sampler2darray",pickingColorArr:"vec4",height:"float"},attributes:{aVertexPositionHigh:"vec3",aVertexPositionLow:"vec3",aTextureCoord:"vec2"},vertexShader:"precision highp float;attribute vec3 aVertexPositionHigh;attribute vec3 aVertexPositionLow;attribute vec2 aTextureCoord;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform vec3 eyePositionHigh;uniform vec3 eyePositionLow;uniform float height;varying vec2 vTextureCoord;void main(void){vTextureCoord=aTextureCoord;mat4 viewMatrixRTE=viewMatrix;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);mat4 m=projectionMatrix*viewMatrixRTE;vec3 nh=height*normalize(aVertexPositionHigh+aVertexPositionLow);vec3 highDiff=aVertexPositionHigh-eyePositionHigh;vec3 lowDiff=aVertexPositionLow-eyePositionLow+nh;gl_Position=m*vec4(highDiff*step(1.0,length(highDiff))+lowDiff,1.0);}",fragmentShader:`precision highp float;
#ifdef WEBGL2
#define TEXTURE_FUNC texture
#else
#define TEXTURE_FUNC texture2D
#endif
#define SLICE_SIZE 5
#define blend(DEST, SAMPLER, OFFSET, OPACITY) src = TEXTURE_FUNC(SAMPLER, OFFSET.xy + vTextureCoord.xy * OFFSET.zw); DEST = DEST * (1.0 - src.a * OPACITY) + src * OPACITY;
#define blendPicking(DEST, OFFSET, SAMPLER, MASK, COLOR, OPACITY) tc = OFFSET.xy + vTextureCoord.xy * OFFSET.zw; t = TEXTURE_FUNC(SAMPLER, tc); p = TEXTURE_FUNC(MASK, tc); DEST = mix(DEST, vec4(max(COLOR.rgb, p.rgb), OPACITY), (t.a == 0.0 ? 0.0: 1.0) * COLOR.a);
const vec3 nightStep=10.0*vec3(0.58,0.48,0.25);uniform vec4 tileOffsetArr[SLICE_SIZE];uniform vec4 pickingColorArr[SLICE_SIZE];uniform sampler2D samplerArr[SLICE_SIZE];uniform sampler2D pickingMaskArr[SLICE_SIZE];uniform int samplerCount;varying vec2 vTextureCoord;void main(void){gl_FragColor=vec4(0.0);if(samplerCount==0)return;vec2 tc;vec4 t;vec4 p;blendPicking(gl_FragColor,tileOffsetArr[0],samplerArr[0],pickingMaskArr[0],pickingColorArr[0],1.0);if(samplerCount==1)return;blendPicking(gl_FragColor,tileOffsetArr[1],samplerArr[1],pickingMaskArr[1],pickingColorArr[1],1.0);if(samplerCount==2)return;blendPicking(gl_FragColor,tileOffsetArr[2],samplerArr[2],pickingMaskArr[2],pickingColorArr[2],1.0);if(samplerCount==3)return;blendPicking(gl_FragColor,tileOffsetArr[3],samplerArr[3],pickingMaskArr[3],pickingColorArr[3],1.0);if(samplerCount==4)return;blendPicking(gl_FragColor,tileOffsetArr[4],samplerArr[4],pickingMaskArr[4],pickingColorArr[4],1.0);}`})),t.addProgram(new $("drawnode_depth",{uniforms:{projectionMatrix:"mat4",viewMatrix:"mat4",height:"float",eyePositionHigh:"vec3",eyePositionLow:"vec3",frustumPickingColor:"float"},attributes:{aVertexPositionHigh:"vec3",aVertexPositionLow:"vec3"},vertexShader:`#version 300 es
precision highp float;in vec3 aVertexPositionHigh;in vec3 aVertexPositionLow;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform vec3 eyePositionHigh;uniform vec3 eyePositionLow;uniform float height;void main(void){mat4 viewMatrixRTE=viewMatrix;viewMatrixRTE[3]=vec4(0.0,0.0,0.0,1.0);mat4 m=projectionMatrix*viewMatrixRTE;vec3 nh=height*normalize(aVertexPositionHigh+aVertexPositionLow);vec3 eyePosition=eyePositionHigh+eyePositionLow;vec3 vertexPosition=aVertexPositionHigh+aVertexPositionLow;vec3 highDiff=aVertexPositionHigh-eyePositionHigh;vec3 lowDiff=aVertexPositionLow-eyePositionLow+nh;gl_Position=m*vec4(highDiff*step(1.0,length(highDiff))+lowDiff,1.0);}`,fragmentShader:`#version 300 es
precision highp float;uniform float frustumPickingColor;layout(location=0)out vec4 frustumColor;layout(location=1)out vec4 depthColor;void main(void){frustumColor=vec4(frustumPickingColor,frustumPickingColor,frustumPickingColor,1.0);depthColor=vec4(gl_FragCoord.z,gl_FragCoord.z,gl_FragCoord.z,1.0);}`})),e.addPickingCallback(this,this._renderColorPickingFramebufferPASS),e.addDepthCallback(this,()=>{this.renderDepthFramebuffer(this.camera,this.quadTreeStrategy)})}_onLayerLoadend(e){this.events.dispatch(this.events.layerloadend,e)}init(){this._tileLoader.events.on("layerloadend",this._onLayerLoadend,this),Wi().setMaxGridSize(this._maxGridSize);const e=this._maxGridSize;let t=0;for(let s=0;s<=e;s++){!this._indexesCache[s]&&(this._indexesCache[s]=new Array(e));for(let n=0;n<=e;n++){!this._indexesCache[s][n]&&(this._indexesCache[s][n]=new Array(e));for(let o=0;o<=e;o++){!this._indexesCache[s][n][o]&&(this._indexesCache[s][n][o]=new Array(e));for(let l=0;l<=e;l++){!this._indexesCache[s][n][o][l]&&(this._indexesCache[s][n][o][l]=new Array(e));for(let h=0;h<=e;h++){let c={buffer:null};if(s>=1&&s===n&&s===o&&s===l&&s===h){let d=Wi().createSegmentIndexes(s,[n,o,l,h]);c.buffer=this.renderer.handler.createElementArrayBuffer(d,1)}else this._indexesCacheToRemove[t++]=c;this._indexesCache[s][n][o][l][h]=c}}}}}this.renderer.events.on("drawtransparent",()=>{this._renderScreenNodesWithHeightPASS()}),this._textureCoordsBufferCache=[];let i=Wi().initTextureCoordsTable(e+1);for(let s=0;s<=e;s++)this._textureCoordsBufferCache[s]=this.renderer.handler.createArrayBuffer(i[s],2,(1+(1<<s))*(1+(1<<s)));if(this.renderer.handler.createDefaultTexture(null,s=>{this.solidTextureOne=s,this.solidTextureTwo=s}),this.transparentTexture=this.renderer.handler.transparentTexture,this.drawMode=this.renderer.handler.gl.TRIANGLE_STRIP,this._initializeShaders(),this._initializeAtmosphere(),this._updateVisibleLayers(),this._nightTextureSrc){let s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{this._nightTexture=this.renderer.handler.createTextureDefault(s),this._nightTexture.default=!0},s.src=this._nightTextureSrc}if(this._specularTextureSrc){let s=new Image;s.crossOrigin="Anonymous",s.onload=()=>{this._specularTexture=this.renderer.handler.createTextureDefault(s),this._specularTexture.default=!0},s.src=this._specularTextureSrc}this._geoImageCreator.init(),this._vectorTileCreator.init(),this._normalMapCreator.init(),this.renderer.events.on("draw",this._globalPreDraw,this,-100),this.quadTreeStrategy.init(this.camera),this.initLayers(),this._initialized=!0,this._initialViewExtent&&this.viewExtent(this._initialViewExtent),this.renderer.activeCamera=this.camera,this.camera.bindFrustumsPickingColors(this.renderer),this.camera.update()}initLayers(){let e=[...this._layers];for(let t=0;t<e.length;t++)this.removeLayer(e[t]),this.addLayer(e[t])}_clearIndexesCache(){this._indexesCacheToRemoveCounter=0;let e=this._indexesCacheToRemove,t=this.renderer.handler.gl;for(let i=0,s=e.length;i<s;i++){let n=e[i];t.deleteBuffer(n.buffer),n.buffer=null}}createDefaultTextures(e,t){this.renderer.handler.gl.deleteTexture(this.solidTextureOne),this.renderer.handler.gl.deleteTexture(this.solidTextureTwo),this.renderer.handler.createDefaultTexture(e,i=>{this.solidTextureOne=i}),this.renderer.handler.createDefaultTexture(t,i=>{this.solidTextureTwo=i})}_getLayerAttributionHTML(e){return`<div class="og-attribution__layer">${e.getAttribution()}</div>`}updateAttributionsList(){let e="";for(let t=0,i=this._layers.length;t<i;t++){let s=this._layers[t];s.getVisibility()&&s.getAttribution().length&&(e+=this._getLayerAttributionHTML(s))}this._applyAttribution(e)}updateVisibleLayers(){this._updateLayers=!0}_updateVisibleLayers(){this.visibleTileLayers=[],this.visibleTileLayers.length=0,this.visibleVectorLayers=[],this.visibleVectorLayers.length=0;let e="";for(let t=0,i=this._layers.length;t<i;t++){let s=this._layers[t];s.getVisibility()?(s.isBaseLayer()&&(this.createDefaultTextures(s._defaultTextures[0],s._defaultTextures[1]),this.baseLayer=s),s.hasImageryTiles()&&this.visibleTileLayers.push(s),s.isVector&&this.visibleVectorLayers.push(s),s.getAttribution().length&&(e+=this._getLayerAttributionHTML(s))):s._fading&&s._fadingOpacity>0&&(s.hasImageryTiles()&&this.visibleTileLayers.push(s),s.isVector&&this.visibleVectorLayers.push(s))}this._applyAttribution(e),this._sortLayers()}_applyAttribution(e){this.renderer&&this.renderer.div&&(e.length?this.renderer.div.attributions.innerHTML!==e&&(this.renderer.div.attributions.innerHTML=e):this.renderer.div.attributions.innerHTML="")}_sortLayers(){this.visibleVectorLayers.sort((t,i)=>t.getZIndex()-i.getZIndex()||t.getHeight()-i.getHeight());let e={0:[]};for(const t of this.visibleVectorLayers)e[t.depthOrder]||(e[t.depthOrder]=[]),e[t.depthOrder].push(t);if(this._visibleVectorLayersByDepthOrder.length=0,this._visibleVectorLayersByDepthOrder=[],this._visibleVectorLayersByDepthOrder=Object.keys(e).sort((t,i)=>Number(t)-Number(i)).map(t=>e[Number(t)]),this._visibleTileLayerSlices=[],this._visibleTileLayerSlices.length=0,this.visibleTileLayers.length){this.visibleTileLayers.sort((s,n)=>s.getHeight()-n.getHeight()||s.getZIndex()-n.getZIndex());let t=-1,i=this.visibleTileLayers[0].getHeight();for(let s=0,n=this.visibleTileLayers.length;s<n;s++)s%this.SLICE_SIZE!=0&&this.visibleTileLayers[s].getHeight()===i||(t++,this._visibleTileLayerSlices[t]=[],i=this.visibleTileLayers[s].getHeight()),this._visibleTileLayerSlices[t].push(this.visibleTileLayers[s])}}_renderScreenNodesPASSNoAtmos(){let e=this.camera,t=this._setUniformsNoAtmos(e);this._renderingScreenNodes(this.quadTreeStrategy,t,e,this.quadTreeStrategy._renderedNodesInFrustum[e.currentFrustumIndex])}_renderScreenNodesPASSAtmos(){let e=this.camera,t=this._setUniformsAtmos(e);this._renderingScreenNodes(this.quadTreeStrategy,t,e,this.quadTreeStrategy._renderedNodesInFrustum[e.currentFrustumIndex])}_renderScreenNodesWithHeightPASSNoAtmos(){let e=this.camera,t=this._setUniformsNoAtmos(e);this._renderingScreenNodesWithHeight(this.quadTreeStrategy,t,e,this.quadTreeStrategy._renderedNodesInFrustum[e.currentFrustumIndex])}_renderScreenNodesWithHeightPASSAtmos(){let e=this.camera,t=this._setUniformsAtmos(e);this._renderingScreenNodesWithHeight(this.quadTreeStrategy,t,e,this.quadTreeStrategy._renderedNodesInFrustum[e.currentFrustumIndex])}_globalPreDraw(){let e=this.camera;this._distBeforeMemClear+=this._prevCamEye.distance(e.eye),this._prevCamEye.copy(e.eye),this._createdNodesCount>this._maxNodes&&this._distBeforeMemClear>this._minDistanceBeforeMemClear&&(this.terrain.clearCache(),this.memClear()),this._indexesCacheToRemoveCounter>600&&this._clearIndexesCache()}preFrame(){this._updateLayers&&(this._updateLayers=!1,this._updateVisibleLayers()),this.camera.isFirstPass&&(this.camera.update(),this._collectRenderNodesIsActive&&this.quadTreeStrategy.collectRenderNodes(this.camera),this._normalMapCreator.frame(),this._geoImageCreator.frame(),this._vectorTileCreator.frame(),this.camera.checkTerrainCollision(),this.camera.update(),this.events.dispatch(this.events.draw,this),this._collectVectorLayerCollections());for(let e=0;e<this._visibleEntityCollections.length;e++)this.drawEntityCollections(this._visibleEntityCollections[e],e)}frame(){this._renderScreenNodesPASS()}lockQuadTree(){this._collectRenderNodesIsActive=!1,this.camera.setTerrainCollisionActivity(!1)}unlockQuadTree(){this._collectRenderNodesIsActive=!0,this.camera.setTerrainCollisionActivity(!0)}_setUniformsNoAtmos(e){let t,i,s=this.renderer,n=s.handler,o=n.gl;return o.enable(o.CULL_FACE),s.enableBlendOneSrcAlpha(),this.lightEnabled?(n.programs.drawnode_screen_wl.activate(),t=n.programs.drawnode_screen_wl._program,i=t.uniforms,o.uniform3fv(i.lightPosition,this._lightPosition),o.uniformMatrix4fv(i.viewMatrix,!1,e.getViewMatrix()),o.uniformMatrix4fv(i.projectionMatrix,!1,e.getProjectionMatrix()),this.baseLayer?(o.uniform3fv(i.diffuse,this.baseLayer._diffuse||this._diffuse),o.uniform3fv(i.ambient,this.baseLayer._ambient||this._ambient),o.uniform4fv(i.specular,this.baseLayer._specular||this._specular),o.uniform1f(i.nightTextureCoefficient,this.baseLayer.nightTextureCoefficient||this.nightTextureCoefficient)):(o.uniform3fv(i.diffuse,this._diffuse),o.uniform3fv(i.ambient,this._ambient),o.uniform4fv(i.specular,this._specular),o.uniform1f(i.nightTextureCoefficient,this.nightTextureCoefficient)),o.activeTexture(o.TEXTURE0+this.SLICE_SIZE),o.bindTexture(o.TEXTURE_2D,this._nightTexture||this.transparentTexture),o.uniform1i(i.nightTexture,this.SLICE_SIZE),o.activeTexture(o.TEXTURE0+this.SLICE_SIZE+1),o.bindTexture(o.TEXTURE_2D,this._specularTexture||this.transparentTexture),o.uniform1i(i.specularTexture,this.SLICE_SIZE+1),o.uniform1f(i.camHeight,e.getHeight())):(n.programs.drawnode_screen_nl.activate(),t=n.programs.drawnode_screen_nl._program,i=t.uniforms,o.uniformMatrix4fv(i.viewMatrix,!1,e.getViewMatrix()),o.uniformMatrix4fv(i.projectionMatrix,!1,e.getProjectionMatrix())),o.uniform3fv(i.eyePositionHigh,e.eyeHigh),o.uniform3fv(i.eyePositionLow,e.eyeLow),t}_setUniformsAtmos(e){let t,i,s=this.renderer,n=s.handler,o=n.gl;return o.enable(o.CULL_FACE),s.enableBlendOneSrcAlpha(),this.lightEnabled?(n.programs.drawnode_screen_wl.activate(),t=n.programs.drawnode_screen_wl._program,i=t.uniforms,o.uniform3fv(i.lightPosition,this._lightPosition),o.uniformMatrix4fv(i.viewMatrix,!1,e.getViewMatrix()),o.uniformMatrix4fv(i.projectionMatrix,!1,e.getProjectionMatrix()),this.baseLayer?(o.uniform3fv(i.diffuse,this.baseLayer._diffuse||this._diffuse),o.uniform3fv(i.ambient,this.baseLayer._ambient||this._ambient),o.uniform4fv(i.specular,this.baseLayer._specular||this._specular),o.uniform1f(i.nightTextureCoefficient,this.baseLayer.nightTextureCoefficient||this.nightTextureCoefficient)):(o.uniform3fv(i.diffuse,this._diffuse),o.uniform3fv(i.ambient,this._ambient),o.uniform4fv(i.specular,this._specular),o.uniform1f(i.nightTextureCoefficient,this.nightTextureCoefficient)),o.uniform2fv(i.maxMinOpacity,this._atmosphereMaxMinOpacity),o.activeTexture(o.TEXTURE0+this.SLICE_SIZE),o.bindTexture(o.TEXTURE_2D,this._nightTexture||this.transparentTexture),o.uniform1i(i.nightTexture,this.SLICE_SIZE),o.activeTexture(o.TEXTURE0+this.SLICE_SIZE+1),o.bindTexture(o.TEXTURE_2D,this._specularTexture||this.transparentTexture),o.uniform1i(i.specularTexture,this.SLICE_SIZE+1),o.activeTexture(o.TEXTURE0+this.SLICE_SIZE+4),o.bindTexture(o.TEXTURE_2D,s.controls.Atmosphere._transmittanceBuffer.textures[0]),o.uniform1i(i.transmittanceTexture,this.SLICE_SIZE+4),o.activeTexture(o.TEXTURE0+this.SLICE_SIZE+5),o.bindTexture(o.TEXTURE_2D,s.controls.Atmosphere._scatteringBuffer.textures[0]),o.uniform1i(i.scatteringTexture,this.SLICE_SIZE+5),o.uniform1f(i.camHeight,e.getHeight())):(n.programs.drawnode_screen_nl.activate(),t=n.programs.drawnode_screen_nl._program,i=t.uniforms,o.uniformMatrix4fv(i.viewMatrix,!1,e.getViewMatrix()),o.uniformMatrix4fv(i.projectionMatrix,!1,e.getProjectionMatrix())),o.uniform3fv(i.eyePositionHigh,e.eyeHigh),o.uniform3fv(i.eyePositionLow,e.eyeLow),t}static __refreshLayersFadingOpacity__(e,t,i){for(let s=e.length-1;s>=0;--s){let n=e[s];n._fading&&n._refreshFadingOpacity(t,i)&&e.splice(s,1)}}_renderingScreenNodes(e,t,i,s){let n=this._visibleTileLayerSlices;n.length&&i.isFirstPass&&Si.__refreshLayersFadingOpacity__(n[0],e.minCurrZoom,e.maxCurrZoom);let o=new Map,l=[],h=this.terrain.equalizeVertices,c=s.length;if(e._fadingOpaqueSegments=[],i.slope>.8||!this.terrain||this.terrain.isEmpty)for(;c--;){let d=s[c],u=d.segment;this._renderingFadingNodesNoDepth(e,o,t,d,n[0],0,e._fadingOpaqueSegments),h&&u.equalize(),u.readyToEngage&&u.engage(),u.screenRendering(t,n[0],0)}else{for(;c--;){let d=s[c],u=d.segment;this._renderingFadingNodes(e,o,t,d,n[0],0,l,e._fadingOpaqueSegments),u._transitionOpacity<1?l.push(u):(h&&u.equalize(),u.readyToEngage&&u.engage(),u.screenRendering(t,n[0],0))}for(let d=0;d<l.length;d++){let u=l[d];h&&u.equalize(),u.readyToEngage&&u.engage(),u.screenRendering(t,n[0],0)}}}_renderingScreenNodesWithHeight(e,t,i,s){let n=this.renderer.handler.gl;n.enable(n.POLYGON_OFFSET_FILL),n.disable(n.CULL_FACE);let o=new Map,l=[],h=this._visibleTileLayerSlices;for(let c=1,d=h.length;c<d;c++){i.isFirstPass&&Si.__refreshLayersFadingOpacity__(h[c],e.minCurrZoom,e.maxCurrZoom),n.polygonOffset(0,-c);let u=s.length;for(;u--;){let f=s[u];this._renderingFadingNodes(e,o,t,f,h[c],c,l),f.segment._transitionOpacity<1?f.segment.initSlice(c):f.segment.screenRendering(t,h[c],c,this.transparentTexture,!0)}}n.disable(n.POLYGON_OFFSET_FILL),n.enable(n.CULL_FACE)}_renderColorPickingFramebufferPASS(){let e,t=this.renderer,i=t.handler,s=i.gl;i.programs.drawnode_colorPicking.activate(),e=i.programs.drawnode_colorPicking._program;let n=e.uniforms,o=t.activeCamera;s.enable(s.CULL_FACE),s.uniformMatrix4fv(n.viewMatrix,!1,o.getViewMatrix()),s.uniformMatrix4fv(n.projectionMatrix,!1,o.getProjectionMatrix()),s.uniform3fv(n.eyePositionHigh,o.eyeHigh),s.uniform3fv(n.eyePositionLow,o.eyeLow);let l=this.quadTreeStrategy._renderedNodesInFrustum[o.getCurrentFrustum()],h=this._visibleTileLayerSlices,c=l.length;for(;c--;)l[c].segment._transitionOpacity>=1&&l[c].segment.colorPickingRendering(e,h[0],0);for(let d=0;d<this.quadTreeStrategy._fadingOpaqueSegments.length;++d)this.quadTreeStrategy._fadingOpaqueSegments[d].colorPickingRendering(e,h[0],0);s.enable(s.POLYGON_OFFSET_FILL);for(let d=1,u=h.length;d<u;d++)for(c=l.length,s.polygonOffset(0,-d);c--;)l[c].segment.colorPickingRendering(e,h[d],d,this.transparentTexture,!0);s.disable(s.POLYGON_OFFSET_FILL)}renderDepthFramebuffer(e,t){let i,s=this.renderer.handler,n=s.gl;s.programs.drawnode_depth.activate(),i=s.programs.drawnode_depth._program;let o=i.uniforms;n.disable(n.BLEND),n.disable(n.POLYGON_OFFSET_FILL),n.uniformMatrix4fv(o.viewMatrix,!1,e.getViewMatrix()),n.uniformMatrix4fv(o.projectionMatrix,!1,e.getProjectionMatrix()),n.uniform3fv(o.eyePositionHigh,e.eyeHigh),n.uniform3fv(o.eyePositionLow,e.eyeLow),n.uniform1f(o.frustumPickingColor,e.frustumColorIndex);let l=t._renderedNodesInFrustum[e.getCurrentFrustum()],h=this._visibleTileLayerSlices,c=l.length;for(;c--;)l[c].segment._transitionOpacity>=1&&l[c].segment.depthRendering(i,h[0]);for(let d=0;d<t._fadingOpaqueSegments.length;++d)t._fadingOpaqueSegments[d].depthRendering(i,h[0]);n.enable(n.BLEND)}_collectVectorLayerCollections(){let e=this._visibleVectorLayersByDepthOrder.length;this._visibleEntityCollections.length=0,this._visibleEntityCollections=new Array(e);for(let t=0;t<this._visibleEntityCollections.length;t++)this._visibleEntityCollections[t]=[];for(;e--;){let t=this._visibleVectorLayersByDepthOrder[e],i=t.length;for(;i--;){let s=t[i];s._fading&&s._refreshFadingOpacity(this.quadTreeStrategy.minCurrZoom,this.quadTreeStrategy.maxCurrZoom)&&(t.splice(i,1),t.length===0&&this._visibleVectorLayersByDepthOrder.splice(e,1)),s.collectVisibleCollections(this._visibleEntityCollections[e]),s.update()}}}memClear(){this._distBeforeMemClear=0,this.camera._insideSegment=null,this.layerLock.lock(this._memKey),this.terrainLock.lock(this._memKey),this._normalMapCreator.lock(this._memKey),this._normalMapCreator.clear(),this.terrain.abortLoading(),this._tileLoader.abortAll(),this.quadTreeStrategy.clear(),this.layerLock.free(this._memKey),this.terrainLock.free(this._memKey),this._normalMapCreator.free(this._memKey),this._createdNodesCount=0}getRayIntersectionEllipsoid(e){return this.ellipsoid.hitRay(e.origin,e.direction)}getCartesianFromPixelEllipsoid(e){let t=this.renderer.activeCamera;return this.ellipsoid.hitRay(t.eye,t.unproject(e.x,e.y))}getLonLatFromPixelEllipsoid(e){let t=this.getCartesianFromPixelEllipsoid(e);if(t)return this.ellipsoid.cartesianToLonLat(t)}getCartesianFromMouseTerrain(){let e=this.renderer.events.mouseState,t=this.getDistanceFromPixel(e);if(t)return e.direction.scaleTo(t).addA(this.renderer.activeCamera.eye)}getCartesianFromPixelTerrain(e){let t=this.getDistanceFromPixel(e);if(t)return(e.direction||this.renderer.activeCamera.unproject(e.x,e.y)).scaleTo(t).addA(this.renderer.activeCamera.eye)}getLonLatFromPixelTerrain(e){let t=this.getCartesianFromPixelTerrain(e);if(t)return this.ellipsoid.cartesianToLonLat(t)}getPixelFromCartesian(e){return this.renderer.activeCamera.project3v(e)}getPixelFromLonLat(e){let t=this.ellipsoid.lonLatToCartesian(e);if(t)return this.renderer.activeCamera.project3v(t)}getDistanceFromPixelEllipsoid(e){let t=this.getCartesianFromPixelEllipsoid(e);if(t)return t.distance(this.renderer.activeCamera.eye)}getDistanceFromPixel(e){return this.renderer.getDistanceFromPixel(e)||this.getDistanceFromPixelEllipsoid(e)||0}viewExtent(e){this.camera?this.camera.viewExtent(e):this._initialViewExtent=e}viewExtentArr(e){this.viewExtent(new V(new A(e[0],e[1]),new A(e[2],e[3])))}getExtent(){if(this.renderer){let e=this.renderer.handler.getWidth(),t=this.renderer.handler.getHeight(),i=[this.getLonLatFromPixelTerrain(new N(0,0)),this.getLonLatFromPixelTerrain(new N(e,0)),this.getLonLatFromPixelTerrain(new N(e,t)),this.getLonLatFromPixelTerrain(new N(0,t))];if(i[0]&&i[1]&&i[2]&&i[3]){let s=i[0].lon,n=i[2].lat,o=i[1].lon,l=i[0].lat;for(let h=0;h<i.length;h++)i[h].lon>o&&(o=i[h].lon),i[h].lat>l&&(l=i[h].lat),i[h].lon<s&&(s=i[h].lon),i[h].lat<n&&(n=i[h].lat);return new V(new A(s,n),new A(o,l))}}return this.quadTreeStrategy._viewExtent}getViewExtent(){return this.quadTreeStrategy._viewExtent}viewLonLat(e,t,i){this.camera.setLonLat(e,t,i)}flyExtent(e,t,i={}){this.camera.flyExtent(e,t,i)}flyCartesian(e,t){this.camera.flyCartesian(e,t)}flyLonLat(e,t={}){this.camera.flyLonLat(e,t)}stopFlying(){this.camera.stopFlying()}updateBillboardsTexCoords(){for(let t=0;t<this.entityCollections.length;t++)this.entityCollections[t].billboardHandler.refreshTexCoordsArr();let e={};for(let t=0;t<this._layers.length;t++){let i=this._layers[t];i instanceof ut&&i.each(function(s){s._entityCollection&&!e[s._entityCollection.id]&&(s._entityCollection.billboardHandler.refreshTexCoordsArr(),e[s._entityCollection.id]=!0)})}}getEntityTerrainPoint(e,t){let i=this.quadTreeStrategy._renderedNodes,s=i.length;for(;s--;)if(i[s].segment.isEntityInside(e))return i[s].segment.getEntityTerrainPoint(e,t)}async getHeightDefault(e){return new Promise(t=>{this.terrain?this.terrain.getHeightAsync(e.clone(),i=>{t(i)}):t(0)})}async getHeightAboveELL(e){return new Promise(t=>{this.terrain?this.terrain.getHeightAsync(e.clone(),i=>{t(i+this.terrain.geoid.getHeightLonLat(e))}):t(0)})}onremove(){this.memClear(),this.quadTreeStrategy.destroyBranches(),this.quadTreeStrategy.clearRenderedNodes()}destroy(){var e;this._terrainWorker.destroy(),this._plainSegmentWorker.destroy(),(e=this.renderer)==null||e.destroy(),this.onremove(),super.destroy()}}const ic=["draw","layeradd","baselayerchange","layerremove","layervisibilitychange","rendercompleted","terraincompleted","layerloadend"];class un extends ce{constructor(e){super("skybox"),this.params=e,this.vertexPositionBuffer=null,this.texture=null}static createDefault(e){return new un({nx:e+"skybox/gal/_nx.jpg",px:e+"skybox/gal/_px.jpg",py:e+"skybox/gal/_py.jpg",ny:e+"skybox/gal/_ny.jpg",pz:e+"skybox/gal/_pz.jpg",nz:e+"skybox/gal/_nz.jpg"})}init(){this.renderer.handler.addProgram(new $("skybox",{uniforms:{projectionViewMatrix:{type:lt.MAT4},uSampler:{type:lt.SAMPLERCUBE},pos:{type:lt.VEC3}},attributes:{aVertexPosition:{type:lt.VEC3,enableArray:!0}},vertexShader:`attribute vec3 aVertexPosition;
            uniform mat4 projectionViewMatrix;
            uniform vec3 pos;
            varying vec3 vTextureCoord;
            void main(void) {
                vTextureCoord = aVertexPosition;
                gl_Position = projectionViewMatrix * vec4(aVertexPosition + pos, 1.0);
            }`,fragmentShader:`precision lowp float;
            varying vec3 vTextureCoord;
            uniform samplerCube uSampler;
            void main(void) {
                gl_FragColor = textureCube(uSampler, vTextureCoord);
            }`})),this.texture=this.renderer.handler.loadCubeMapTexture(this.params),this._createBuffers(),this.drawMode=this.renderer.handler.gl.TRIANGLES}preFrame(){let e=this.renderer.handler,t=e.gl,i=this.renderer.activeCamera;t.disable(t.DEPTH_TEST),e.programs.skybox.activate();let s=e.programs.skybox._program,n=s.uniforms;if(i.isOrthographic){const l=i.frustum.near,h=i.frustum.far,c=i.getAspectRatio(),d=l*Math.tan(i.viewAngle*Kt),u=d*c,f=new J().setPerspective(-u,u,-d,d,l,h),_=new J().set(i.getViewMatrix());t.uniformMatrix4fv(n.projectionViewMatrix,!1,f.mul(_)._m)}else t.uniformMatrix4fv(n.projectionViewMatrix,!1,i.getProjectionViewMatrix());t.uniform3fv(n.pos,i.eye.toArray()),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_CUBE_MAP,this.texture),t.uniform1i(n.uSampler,0);let o=this.vertexPositionBuffer;t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(s.attributes.aVertexPosition,o.itemSize,t.FLOAT,!1,0,0),t.drawArrays(this.drawMode,0,o.numItems),t.enable(t.DEPTH_TEST)}_createBuffers(){const e=new Float32Array([-1e8,1e8,-1e8,-1e8,-1e8,-1e8,1e8,-1e8,-1e8,1e8,-1e8,-1e8,1e8,1e8,-1e8,-1e8,1e8,-1e8,-1e8,-1e8,1e8,-1e8,-1e8,-1e8,-1e8,1e8,-1e8,-1e8,1e8,-1e8,-1e8,1e8,1e8,-1e8,-1e8,1e8,1e8,-1e8,-1e8,1e8,-1e8,1e8,1e8,1e8,1e8,1e8,1e8,1e8,1e8,1e8,-1e8,1e8,-1e8,-1e8,-1e8,-1e8,1e8,-1e8,1e8,1e8,1e8,1e8,1e8,1e8,1e8,1e8,1e8,-1e8,1e8,-1e8,-1e8,1e8,-1e8,1e8,-1e8,1e8,1e8,-1e8,1e8,1e8,1e8,1e8,1e8,1e8,-1e8,1e8,1e8,-1e8,1e8,-1e8,-1e8,-1e8,-1e8,-1e8,-1e8,1e8,1e8,-1e8,-1e8,1e8,-1e8,-1e8,-1e8,-1e8,1e8,1e8,-1e8,1e8]);this.vertexPositionBuffer=this.renderer.handler.createArrayBuffer(e,3,e.length/3)}}Object.freeze(Object.defineProperty({__proto__:null,Axes:class extends ce{constructor(a=100){super("Axes"),this.size=a,this.axesBuffer=null,this.axesColorBuffer=null}init(){this.createAxesBuffer(this.size),this.drawMode=this.renderer.handler.gl.LINES,this.renderer.handler.addProgram(new $("axesShader",{uniforms:{projectionViewMatrix:"mat4"},attributes:{aVertexPosition:"vec3",aVertexColor:"vec4"},vertexShader:`attribute vec3 aVertexPosition;
            attribute vec4 aVertexColor;
            uniform mat4 projectionViewMatrix;
            varying vec4 vColor;
            void main(void) {
                gl_Position = projectionViewMatrix * vec4(aVertexPosition, 1.0);
                vColor = aVertexColor;
            }`,fragmentShader:`precision highp float;
            varying vec4 vColor;
            void main(void) {
                gl_FragColor = vColor;
            }`}))}frame(){this.renderer.handler.programs.axesShader.activate().set({projectionViewMatrix:this.renderer.activeCamera.getProjectionViewMatrix(),aVertexPosition:this.axesBuffer,aVertexColor:this.axesColorBuffer}),this.renderer.handler.programs.axesShader.drawArrays(this.drawMode,this.axesBuffer.numItems)}createAxesBuffer(a){const e=[0,0,0,a-1,0,0,0,0,0,0,a-1,0,0,0,0,0,0,a-1];this.axesBuffer=this.renderer.handler.createArrayBuffer(new Float32Array(e),3,6),this.axesColorBuffer=this.renderer.handler.createArrayBuffer(new Float32Array([1,0,0,1,1,0,0,1,0,0,1,1,0,0,1,1,0,1,0,1,0,1,0,1]),4,6)}},Planet:Si,RenderNode:ce,SkyBox:un},Symbol.toStringTag,{value:"Module"}));const Ms=class Q0{constructor(e={}){this.__id=Q0.__counter__++,this.equalizeVertices=e.equalizeVertices||!1,this.equalizeNormals=!1,this.isEmpty=!0,this.name=e.name||"empty",this.minZoom=e.minZoom||2,this.maxZoom=e.maxZoom||19,this.maxNativeZoom=e.maxNativeZoom||this.maxZoom,this.gridSizeByZoom=e.gridSizeByZoom||[64,32,16,8,4,4,4,4,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2],this._maxNodeZoom=this.gridSizeByZoom.length-1,this.plainGridSize=2,this.noDataValues=[],this._planet=null,this._geoid=e.geoid||new Aa({src:e.geoidSrc||null}),this._isReady=!1}setUrlRewriteCallback(e){}get isIdle(){return!0}isEqual(e){return e.__id===this.__id}static checkNoDataValue(e,t){return Wr(e,t)!==-1}isBlur(e){return!1}set maxNodeZoom(e){e>this.gridSizeByZoom.length-1&&(e=this.gridSizeByZoom.length-1),this._maxNodeZoom=e}get maxNodeZoom(){return this._maxNodeZoom}set geoid(e){this._geoid=e}get geoid(){return this._geoid}getGeoid(){return this._geoid}handleSegmentTerrain(e){e.terrainIsLoading=!1,e.terrainReady=!0,e.terrainExists=!0}isReady(){return this._isReady}abortLoading(){}clearCache(){}getHeightAsync(e,t){return t(0),!0}loadTerrain(e,t=!1){}};Ms.__counter__=0;let Ri=Ms;class _n extends Ri{constructor(e="",t={}){super({geoidSrc:"https://openglobus.org/geoid/egm84-30.pgm",maxNativeZoom:t.maxNativeZoom||14,...t}),this._s=t.subdomains||["a","b","c"],this.events=at(sc,this),this._requestCount=0,this._requestsPeerSubdomain=4,this.isEmpty=!1,this.equalizeNormals=!0,this.name=e||"openglobus",this.url=t.url||"https://{s}.srtm3.openglobus.org/{z}/{y}/{x}.ddm",this.gridSizeByZoom=t.gridSizeByZoom||[64,32,32,16,16,8,8,8,16,16,16,32,32,32,32,16,8,4,2,2,2,2,2,2],this._heightFactor=t.heightFactor!=null?t.heightFactor:1,this.noDataValues=t.noDataValues||[];for(let i=0;i<this.noDataValues.length;i++)this.noDataValues[i]*=this._heightFactor;this.plainGridSize=t.plainGridSize||32,this._extent=Yr(t.extent,new V(new A(-180,-90),new A(180,90))),this._dataType="arrayBuffer",this._maxNodeZoom=this.gridSizeByZoom.length-1,this._elevationCache={},this._fetchCache={},this._cache=t.cache||"default",this._loader=new La,this._urlRewriteCallback=t.urlRewrite||null}get loader(){return this._loader}clearCache(){for(let e in this._elevationCache)this._elevationCache[e].heights=null,this._elevationCache[e].extent=null,delete this._elevationCache[e];this._elevationCache=null,this._elevationCache={};for(let e in this._fetchCache)this._fetchCache[e]=null,delete this._fetchCache[e];this._fetchCache=null,this._fetchCache={}}isBlur(e){return e.tileZoom>=6}setElevationCache(e,t){this._elevationCache[e]=t}getElevationCache(e){return this._elevationCache[e]}getHeightAsync(e,t,i,s){if(!e||e.lat>ht||e.lat<Ft)return t(0),!0;s=s==null||s;const[n,o,l,h]=this._planet.quadTreeStrategy.getTileXY(e,i||this.maxZoom);let c=It.getTileIndex(n,o,l,h),d=this.getElevationCache(c),u=Qi(e);if(d)return d.heights?t(this._getGroundHeightMerc(u,d)):t(0),!0;{let f=this._fetchCache[c];f||(f=this._loader.fetch({src:this._urlRewriteCallback&&this._urlRewriteCallback(n,o,l,h)||this.buildURL(n,o,l,h),type:this._dataType,options:{cache:this._cache}}),this._fetchCache[c]=f),f.then(_=>{let g=Xe(n,o,l);if(_.status==="ready"){let v={heights:this._createHeights(_.data,null,h,n,o,l,g),extent:g};this.setElevationCache(c,v),t(this._getGroundHeightMerc(u,v))}else if(_.status==="error"){if(s&&l>this.maxNativeZoom)return s=!1,void this.getHeightAsync(e,t,this.maxNativeZoom,!1);this.setElevationCache(c,{heights:null,extent:g}),t(0)}else this._fetchCache[c]=null,delete this._fetchCache[c]})}return!1}_getGroundHeightMerc(e,t){if(!t.extent||!t.heights)return 0;let i=t.extent.getWidth(),s=Math.sqrt(t.heights.length),n=i/(s-1),o=s-Math.ceil((e.lat-t.extent.southWest.lat)/n)-1,l=Math.floor((e.lon-t.extent.southWest.lon)/n),h=(o+1)*s+l,c=h+1,d=o*s+l,u=d+1,f=t.heights[h],_=t.heights[c],g=t.heights[d],v=t.heights[u],p=new m(t.extent.southWest.lon+n*l,f,t.extent.northEast.lat-n*o-n),y=new m(p.x+n,_,p.z),b=new m(p.x,g,p.z+n),C=new m(p.x+n,v,p.z+n),T=new m(e.lon,1e5,e.lat),w=new H(T,new m(0,-1,0)),L=new m,S=w.hitTriangleRes(p,y,b,L);return S===H.INSIDE?L.y:(S=w.hitTriangleRes(y,C,b,L),S===H.INSIDE?L.y:0)}abortLoading(){this._loader.abortAll()}setUrl(e){this.url=e}setName(e){this.name=e}isReadyToLoad(e){return e._tileGroup===0&&this._extent.overlaps(e.getExtentLonLat())}loadTerrain(e,t=!1){if(this._planet.terrainLock.isFree())if(e.terrainReady=!1,e.terrainIsLoading=!0,this.isReadyToLoad(e)){let i=this.getElevationCache(e.tileIndex);i?this._applyElevationsData(e,i.heights):this._loader.load({sender:this,src:this._getHTTPRequestString(e),segment:e,type:this._dataType,options:{cache:this._cache},filter:()=>e.plainReady&&e.node.getState()!==0||t},s=>{if(s.status==="ready"){let n=this._createHeights(s.data,e,e._tileGroup,e.tileX,e.tileY,e.tileZoom,e.getExtent(),e.tileZoom===this.maxZoom);this.setElevationCache(e.tileIndex,{heights:n,extent:e.getExtent()}),this._applyElevationsData(e,n)}else s.status==="abort"?e.terrainIsLoading=!1:s.status==="error"?this._applyElevationsData(e,null):e.terrainIsLoading=!1})}else e.elevationsNotExists();else e.terrainIsLoading=!1}_getSubdomain(){return this._requestCount++,this._s[Math.floor(this._requestCount%(this._requestsPeerSubdomain*this._s.length)/this._requestsPeerSubdomain)]}buildURL(e,t,i,s){return zt(this.url,{s:this._getSubdomain(),x:e.toString(),y:t.toString(),z:i.toString()})}_createUrl(e){return this.buildURL(e.tileX,e.tileY,e.tileZoom,e._tileGroup)}_getHTTPRequestString(e){return this._urlRewriteCallback&&this._urlRewriteCallback(e.tileX,e.tileY,e.tileZoom,e._tileGroup)||this._createUrl(e)}setUrlRewriteCallback(e){this._urlRewriteCallback=e}_createHeights(e,t,i,s,n,o,l,h){if(this._heightFactor!==1){let c=new Float32Array(e);for(let d=0,u=c.length;d<u;d++)c[d]=c[d]*this._heightFactor;return c}return new Float32Array(e)}_applyElevationsData(e,t){if(e){let i=this.events.load;i.handlers.length&&this.events.dispatch(i,{elevations:t,segment:e}),e.applyTerrain(t)}}}const sc=["load","loadend"];class zs extends It{constructor(e,t={}){super(e,t),this.events=this.events.registerNames(rc),this.url=t.url||"",this._s=t.subdomains||["a","b","c"],this.minNativeZoom=t.minNativeZoom||0,this.maxNativeZoom=t.maxNativeZoom||19,this._urlRewriteCallback=t.urlRewrite||null,this._requestsPeerSubdomains=4,this._requestCount=0,this._cache=t.cache||"default"}get isIdle(){return super.isIdle&&this._planet._tileLoader.getRequestCounter(this)===0}get instanceName(){return"XYZ"}abortLoading(){this._planet&&this._planet._tileLoader.abort(this)}setVisibility(e){e!==this._visibility&&(super.setVisibility(e),e||this.abortLoading())}remove(){return this.abortLoading(),super.remove(),this}setUrl(e){this.url=e}_checkSegment(e){return e._projection.id===this._planet.quadTreeStrategy.projection.id}loadMaterial(e,t=!1){let i=e.segment;this._isBaseLayer?e.texture=i.getDefaultTexture():e.texture=i.planet.transparentTexture,(this._planet.layerLock.isFree()||e.segment.tileZoom<2)&&(e.isReady=!1,e.isLoading=!0,this._checkSegment(i)?(e.loadingAttempts++,this._planet._tileLoader.load({sender:this,src:this._getHTTPRequestString(e.segment),type:"imageBitmap",filter:()=>i.initialized&&i.node.getState()===1||t,options:{cache:this._cache}},s=>{if(s.status==="ready"){if(e.isLoading){let n=this.events.load;n.handlers.length&&this.events.dispatch(n,e),e.applyImage(s.data),s.data=null}}else s.status==="abort"?e.isLoading=!1:s.status==="error"&&e.isLoading&&e.textureNotExists()})):e.textureNotExists())}_createUrl(e){return zt(this.url,{s:this._getSubdomain(),x:e.tileX.toString(),y:e.tileY.toString(),z:e.tileZoom.toString()})}_getSubdomain(){return this._requestCount++,this._s[Math.floor(this._requestCount%(this._requestsPeerSubdomains*this._s.length)/this._requestsPeerSubdomains)]}_getHTTPRequestString(e){return this._urlRewriteCallback?this._urlRewriteCallback(e,this.url):this._createUrl(e)}setUrlRewriteCallback(e){this._urlRewriteCallback=e}applyMaterial(e,t=!1){if(e.isReady)return e.texOffset;if(e.segment.tileZoom<this.minNativeZoom)e.textureNotExists();else{let i=e.segment,s=i.node,n=!1,o=this.__id,l=e;for(;s.parentNode;)if(s=s.parentNode,l=s.segment.materials[o],l&&l.textureExists){n=!0;break}if(i.passReady){let h=e.layer.maxNativeZoom;if(s.segment.tileZoom===h)e.textureNotExists();else if(e.segment.tileZoom<=h)!e.isLoading&&!e.isReady&&this.loadMaterial(e,t);else{let c=i.node;for(;c.segment.tileZoom>e.layer.maxNativeZoom;)c=c.parentNode;let d=c.segment.materials[e.layer.__id];d?!d.isLoading&&!d.isReady&&this.loadMaterial(d,!0):(d=c.segment.materials[e.layer.__id]=e.layer.createMaterial(c.segment),this.loadMaterial(d,!0))}}if(n){e.appliedNode=s,e.appliedNodeId=s.nodeId,e.texture=l.texture;let h=1/(2<<i.tileZoom-s.segment.tileZoom-1);e.texOffset[0]=i.tileX*h-s.segment.tileX,e.texOffset[1]=i.tileY*h-s.segment.tileY,e.texOffset[2]=h,e.texOffset[3]=h}else e.texture=i.planet.transparentTexture,e.texOffset[0]=0,e.texOffset[1]=0,e.texOffset[2]=1,e.texOffset[3]=1}return e.texOffset}clearMaterial(e){e.isReady&&e.textureExists&&(!e.texture.default&&e.segment.handler.gl.deleteTexture(e.texture),e.texture=null),e.isReady=!1,e.textureExists=!1,e.isLoading=!1}_correctFullExtent(){let e=this._extent,t=this._extentMerc;e.northEast.lat===90&&(t.northEast.lat=2008750834e-2),e.northEast.lon===180&&(t.northEast.lon=2008750834e-2),e.southWest.lat===-90&&(t.southWest.lat=-2008750834e-2),e.southWest.lon===-180&&(t.southWest.lon=-2008750834e-2)}}const rc=["load","loadend"];class pe extends zs{constructor(e,t){super(e,t),this._extra=new URLSearchParams(t.extra).toString(),t.extent||this.setExtent(new V(new A(-180,-90),new A(180,90))),this.layers=t.layers,this.imageWidth=t.imageWidth||256,this.imageHeight=t.imageHeight||256,this._getBbox=pe.get_bbox_v1_1_1,this._version="",this.setVersion(t.version)}static createRequestUrl(e,t,i="image/png",s="1.1.1",n="GetMap",o,l,h=256,c=256,d){return`${e}?LAYERS=${t}&FORMAT=${i}&SERVICE=WMS&VERSION=${s}&REQUEST=${n}&SRS=${o}&BBOX=${l}&WIDTH=${h}&HEIGHT=${c}`+(d?`&${d}`:"")}static get_bbox_v1_1_1(e){return`${e.getWest()},${e.getSouth()},${e.getEast()},${e.getNorth()}`}static get_bbox_v1_3_0(e,t){return t==="epsg:4326"?`${e.getSouth()},${e.getWest()},${e.getNorth()},${e.getEast()}`:`${e.getWest()},${e.getSouth()},${e.getEast()},${e.getNorth()}`}_checkSegment(e){return!0}get instanceName(){return"WMS"}_createUrl(e){return pe.createRequestUrl(this.url,this.layers,"image/png",this._version,"GetMap",e._projection.code,this._getBbox(e.getExtent(),e._projection.code),this.imageWidth,this.imageHeight,this._extra)}setVersion(e){this._version=e||"1.1.1",this._version==="1.1.1"?this._getBbox=pe.get_bbox_v1_1_1:e==="1.3.0"&&(this._getBbox=pe.get_bbox_v1_3_0)}_correctFullExtent(){const e=this._extent,t=this._extentMerc;e.northEast.lat===90&&(t.northEast.lat=2008750834e-2),e.northEast.lon===180&&(t.northEast.lon=2008750834e-2),e.southWest.lat===-90&&(t.southWest.lat=-2008750834e-2),e.southWest.lon===-180&&(t.southWest.lon=-2008750834e-2)}}class Ge extends _n{constructor(e={}){super("BilTerrain",e),this.equalizeVertices=!0,this.equalizeNormals=!0,this.minZoom=e.minZoom||2,this.maxZoom=e.maxZoom||14,this.noDataValues=e.noDataValues||[-9999,32767],this.url=e.url||"",this._format="application/bil16",this._layers=e.layers||"",this._imageSize=e.imageSize||256,this.plainGridSize=e.plainGridSize!=null?e.plainGridSize:Zi(this._imageSize)?this._imageSize/2:We(this._imageSize)/2,this._dataType="arrayBuffer"}isBlur(e){return e.tileZoom>=18}_createUrl(e){return pe.createRequestUrl(this.url,this._layers,this._format,"1.1.1","GetMap",e._projection.code,pe.get_bbox_v1_1_1(e.getExtent()),this._imageSize,this._imageSize)}_createHeights(e,t,i,s,n,o,l,h){let c=new Int16Array(e);if(!Zi(this._imageSize)){let v=new Float32Array(c.length);return function(p,y){for(let b=0,C=y.length;b<C;b++)y[b]=p[b]}(c,v),v}let d=(this.plainGridSize+1)*(this.plainGridSize+1),u=new Array(4);for(let v=0;v<4;v++){u[v]=[];for(let p=0;p<4;p++)u[v][p]=new Float32Array(d)}let f=new Float32Array(d);(function(v,p,y,b){let C=Math.sqrt(y.length)-1,T=C+1,w=Math.sqrt(v.length),L=w/C,S=0,P=0;for(let B=0,k=0,I=v.length;B<I;B++){let z=v[B],Ce=Ge.checkNoDataValue(p,z),R=!1,O=!1,se=Math.floor(B/w),M=B%w,F=Math.floor(M/C),Ie=Math.floor(se/C),Bi=b[Ie][F],Mt=se%C,Wt=M%C,Nt=(Mt+Ie)*T+Wt+F;if(Bi[Nt]=z,(se+Ie)%L==0&&(M+F)%L==0&&(y[k++]=z),(M+1)%C==0&&M!==w-1){S=v[B],R=Ge.checkNoDataValue(p,S);let pt=z;Ce||R||(pt=.5*(z+S)),Nt=(Mt+Ie)*T+Wt+1,Bi[Nt]=pt,(se+Ie)%L==0&&(y[k++]=pt);let ji=(Mt+Ie)*T+(Wt+1)%C;b[Ie][F+1][ji]=pt}if((se+1)%C==0&&se!==w-1){P=v[B+w],O=Ge.checkNoDataValue(p,P);let pt=z;Ce||O||(pt=.5*(z+P)),Nt=(Mt+1)*T+Wt+F,Bi[Nt]=pt,(M+F)%L==0&&(y[k++]=pt);let ji=(Mt+1)%C*T+Wt+F;b[Ie+1][F][ji]=pt}if((M+1)%C==0&&M!==w-1&&(se+1)%C==0&&se!==w-1){let pt=v[B+w+1],ji=Ge.checkNoDataValue(p,pt),Xt=z;Ce||R||O||ji||(Xt=.25*(z+S+P+pt)),Nt=(Mt+1)*T+(Wt+1),Bi[Nt]=Xt,y[k++]=Xt;let b0=(Mt+1)*T;b[Ie][F+1][b0]=Xt;let x0=C;b[Ie+1][F][x0]=Xt;let C0=0;b[Ie+1][F+1][C0]=Xt}}})(c,this.noDataValues,f,u);let _=It.getTileIndex(s,n,o,i);this.setElevationCache(_,{heights:f,extent:l});let g=this._imageSize/this.plainGridSize;for(let v=0;v<g;v++)for(let p=0;p<g;p++){let y=2*s+p,b=2*n+v,C=o+1,T=It.getTileIndex(y,b,C,i);this.setElevationCache(T,{heights:u[v][p],extent:Xe(y,b,C)})}return f}}class Pt extends _n{constructor(e,t={}){super(e||"RgbTerrain",{equalizeVertices:t.equalizeVertices==null||t.equalizeVertices,maxZoom:t.maxZoom||17,noDataValues:t.noDataValues||[t.minHeight!=null?t.minHeight:-1e4],plainGridSize:t.plainGridSize||128,url:t.url!=null?t.url:`//api.mapbox.com/v4/mapbox.terrain-rgb/{z}/{x}/{y}.pngraw?access_token=${t.key||"<key>"}`,gridSizeByZoom:t.gridSizeByZoom||[64,32,16,8,8,8,16,16,16,32,32,32,32,32,32,64,64,64,32,32,16,8],...t}),this.equalizeNormals=t.equalizeNormals||!1,this._dataType="imageBitmap",this._imageSize=t.imageSize||256,this._ctx=this._createTemporalCanvas(this._imageSize),this._imageDataCache={},this._minHeight=t.minHeight||-1e4,this._resolution=t.resolution||.1}static checkNoDataValue(e,t){return t>5e4||Wr(e,t)!==-1}rgb2Height(e,t,i){return e===255?this._minHeight:this._minHeight+this._resolution*(256*e*256+256*t+i)}isBlur(e){return e.tileZoom>=16}_createTemporalCanvas(e){let t=document.createElement("canvas");return t.width=e,t.height=e,t.getContext("2d",{willReadFrequently:!0})}_createHeights(e,t,i,s,n,o,l,h){this._ctx.clearRect(0,0,this._imageSize,this._imageSize),this._ctx.drawImage(e,0,0);let c=this._ctx.getImageData(0,0,this._imageSize,this._imageSize).data;const d=e.width;let u=0,f=0,_=0,g=null,v=!1;if(t&&t.tileZoom>this.maxNativeZoom){let w=t.node;for(;w&&!w.segment.terrainExists;)w=w.parentNode;w&&(u=w.segment.tileX,f=w.segment.tileY,_=w.segment.tileZoom,g=w.segment.elevationData,v=_<=8)}if(!Zi(this._imageSize)&&d===this._imageSize){let w=new Float32Array(d*d);return this.extractElevationTilesRgbNonPowerOfTwo(c,w,this._heightFactor),w}if(this._imageSize===this.plainGridSize){let w=(this.plainGridSize+1)*(this.plainGridSize+1),L=new Float32Array(w),[S,P,B]=t?ir(t.tileX,t.tileY,t.tileZoom,u,f,_):[0,0,0];return this.extractElevationSimple(c,this.noDataValues,g,S,P,B,v,L,this._heightFactor,this._imageSize),L}let p=(this.plainGridSize+1)*(this.plainGridSize+1),y=d/this.plainGridSize,b=new Float32Array(p),C=new Array(y);for(let w=0;w<y;w++){C[w]=[];for(let L=0;L<y;L++)C[w][L]=new Float32Array(p)}if(h)this.extractElevationTilesRgbNoChildren(c,this._heightFactor,this.noDataValues,g,u,f,_,t?t.tileX:0,t?t.tileY:0,t?t.tileZoom:0,v,b);else{this.extractElevationTilesRgb(c,this._heightFactor,this.noDataValues,g,u,f,_,t?t.tileX:0,t?t.tileY:0,t?t.tileZoom:0,v,b,C);for(let w=0;w<y;w++)for(let L=0;L<y;L++){let[S,P,B]=[2*s+L,2*n+w,o+1],k=It.getTileIndex(S,P,B,i);this.setElevationCache(k,{heights:C[w][L],extent:Xe(S,P,B)})}}let T=It.getTileIndex(s,n,o,i);return this.setElevationCache(T,{heights:b,extent:l}),b}getHeightAsync(e,t,i){if((i=i??this.maxZoom)===0)return t(0),!0;const s=this._planet.quadTreeStrategy,[n,o,l,h]=s.getTileXY(e,i),[c,d]=s.getLonLatTileOffset(e,n,o,l,this._imageSize),u=4*(c*this._imageSize+d),f=It.getTileIndex(n,o,l,h);if(this._imageDataCache[f]){let g=this._imageDataCache[f],v=this._heightFactor*this.rgb2Height(g[u],g[u+1],g[u+2]);return Pt.checkNoDataValue(this.noDataValues,v)?this.getHeightAsync(e,t,i-1):(t(this._heightFactor*this.rgb2Height(g[u],g[u+1],g[u+2])),!0)}let _=this._fetchCache[f];return _||(_=this._loader.fetch({src:this._urlRewriteCallback&&this._urlRewriteCallback(n,o,l,h)||this.buildURL(n,o,l,h),type:this._dataType,options:{cache:this._cache}}),this._fetchCache[f]=_),_.then(g=>{if(g.status==="ready"){this._ctx.clearRect(0,0,this._imageSize,this._imageSize),this._ctx.drawImage(g.data,0,0);let v=this._ctx.getImageData(0,0,256,256).data;this._imageDataCache[f]=v;let p=this._heightFactor*this.rgb2Height(v[u],v[u+1],v[u+2]);if(Pt.checkNoDataValue(this.noDataValues,p))return this.getHeightAsync(e,t,i-1);t(this._heightFactor*this.rgb2Height(v[u],v[u+1],v[u+2]))}else{if(g.status==="error")return this.getHeightAsync(e,t,i-1);this._fetchCache[f]=null,delete this._fetchCache[f]}}),!1}extractElevationSimple(e,t,i=null,s,n,o,l,h,c=1,d){for(let f=0,_=d*d;f<_;f++){let g=f%d,v=Math.floor(f/d),p=4*f,y=c*this.rgb2Height(e[p],e[p+1],e[p+2]);(Pt.checkNoDataValue(t,y)||y===0)&&i&&(y=$t(o,s,n,i,v,g,l)),h[v*(d+1)+g]=y}for(let f=0,_=d;f<_;f++){let g=d-1,v=4*(f*d+g),p=c*this.rgb2Height(e[v],e[v+1],e[v+2]);(Pt.checkNoDataValue(t,p)||p===0)&&i&&(p=$t(o,s,n,i,f,g,l)),h[f*(d+1)+d]=p}for(let f=0,_=d;f<_;f++){let g=d-1,v=4*(g*d+f),p=c*this.rgb2Height(e[v],e[v+1],e[v+2]);(Pt.checkNoDataValue(t,p)||p===0)&&i&&(p=$t(o,s,n,i,g,f,l)),h[d*(d+1)+f]=p}let u=c*this.rgb2Height(e[e.length-4],e[e.length-3],e[e.length-2]);(Pt.checkNoDataValue(t,u)||u===0)&&i&&(u=$t(o,s,n,i,d-1,d-1,l)),h[h.length-1]=u}extractElevationTilesRgbNonPowerOfTwo(e,t,i=1){for(let s=0,n=t.length;s<n;s++){let o=4*s;t[s]=i*this.rgb2Height(e[o],e[o+1],e[o+2])}}extractElevationTilesRgb(e,t,i,s=null,n,o,l,h,c,d,u,f,_){let g=Math.sqrt(f.length)-1,v=g+1,p=Math.sqrt(e.length/4),y=p/g,b=0,C=0,T=0,[w,L,S]=ir(h,c,d,n,o,l);for(let P=0,B=0,k=e.length/4;P<k;P++){let I=4*P,z=t*this.rgb2Height(e[I],e[I+1],e[I+2]),Ce=Pt.checkNoDataValue(i,z),R=!1,O=!1,se=Math.floor(P/p),M=P%p;(Ce||z===0)&&s&&(z=$t(S,w,L,s,Math.floor(se/y),Math.floor(M/y),u));let F=Math.floor(M/g),Ie=Math.floor(se/g),Bi=_[Ie][F],Mt=se%g,Wt=M%g,Nt=(Mt+Ie)*v+Wt+F;if(Bi[Nt]=z,(se+Ie)%y==0&&(M+F)%y==0&&(f[B++]=z),(M+1)%g==0&&M!==p-1){b=t*this.rgb2Height(e[I+4],e[I+5],e[I+6]),R=Pt.checkNoDataValue(i,b),(R||b===0)&&s&&(b=$t(S,w,L,s,Math.floor(se/y),Math.floor((M+1)/y),u));let pt=z;Ce||R||(pt=.5*(z+b)),Nt=(Mt+Ie)*v+Wt+1,Bi[Nt]=pt,(se+Ie)%y==0&&(f[B++]=pt);let ji=(Mt+Ie)*v+(Wt+1)%g;_[Ie][F+1][ji]=pt}if((se+1)%g==0&&se!==p-1){T=4*p,C=t*this.rgb2Height(e[I+T],e[I+T+1],e[I+T+2]),O=Pt.checkNoDataValue(i,C),(O||C===0)&&s&&(C=$t(S,w,L,s,Math.floor((se+1)/y),Math.floor(M/y),u));let pt=.5*(z+C);Ce||O||(pt=.5*(z+C)),Nt=(Mt+1)*v+Wt+F,Bi[Nt]=pt,(M+F)%y==0&&(f[B++]=pt);let ji=(Mt+1)%g*v+Wt+F;_[Ie+1][F][ji]=pt}if((M+1)%g==0&&M!==p-1&&(se+1)%g==0&&se!==p-1){let pt=t*this.rgb2Height(e[I+T+4],e[I+T+5],e[I+T+6]),ji=Pt.checkNoDataValue(i,pt);(ji||pt===0)&&s&&(pt=$t(S,w,L,s,Math.floor((se+1)/y),Math.floor((M+1)/y),u));let Xt=z;Ce||R||O||ji||(Xt=.25*(z+b+C+pt)),Nt=(Mt+1)*v+(Wt+1),Bi[Nt]=Xt,f[B++]=Xt;let b0=(Mt+1)*v;_[Ie][F+1][b0]=Xt;let x0=g;_[Ie+1][F][x0]=Xt;let C0=0;_[Ie+1][F+1][C0]=Xt}}}extractElevationTilesRgbNoChildren(e,t,i,s=null,n,o,l,h,c,d,u,f){let _=Math.sqrt(f.length)-1,g=_+1,v=Math.sqrt(e.length/4),p=v/_,y=0,b=0,C=0,[T,w,L]=ir(h,c,d,n,o,l);for(let S=0,P=0,B=e.length/4;S<B;S++){let k=4*S,I=t*this.rgb2Height(e[k],e[k+1],e[k+2]),z=Pt.checkNoDataValue(i,I),Ce=!1,R=!1,O=Math.floor(S/v),se=S%v;(z||I===0)&&s&&(I=$t(L,T,w,s,Math.floor(P/g),P%g,u));let M=Math.floor(se/_),F=Math.floor(O/_);if((O+F)%p==0&&(se+M)%p==0&&(f[P++]=I),(se+1)%_==0&&se!==v-1){y=t*this.rgb2Height(e[k+4],e[k+5],e[k+6]),Ce=Pt.checkNoDataValue(i,y),(Ce||y===0)&&s&&(y=$t(L,T,w,s,Math.floor(P/g),P%g,u));let Ie=I;z||Ce||(Ie=.5*(I+y)),(O+F)%p==0&&(f[P++]=Ie)}if((O+1)%_==0&&O!==v-1){C=4*v,b=t*this.rgb2Height(e[k+C],e[k+C+1],e[k+C+2]),R=Pt.checkNoDataValue(i,b),(R||b===0)&&s&&(b=$t(L,T,w,s,Math.floor(P/g),P%g,u));let Ie=.5*(I+b);z||R||(Ie=.5*(I+b)),(se+M)%p==0&&(f[P++]=Ie)}if((se+1)%_==0&&se!==v-1&&(O+1)%_==0&&O!==v-1){let Ie=t*this.rgb2Height(e[k+C+4],e[k+C+5],e[k+C+6]),Bi=Pt.checkNoDataValue(i,Ie);(Bi||Ie===0)&&s&&(Ie=$t(L,T,w,s,Math.floor(P/g),P%g,u));let Mt=I;z||Ce||R||Bi||(Mt=.25*(I+y+b+Ie)),f[P++]=Mt}}}}function ir(a,e,t,i,s,n){let o=2<<t-n-1;return[a-o*i,e-o*s,1/o]}function $t(a,e,t,i,s,n,o){let l=Math.sqrt(i.length),h=i[Math.floor(t*a*l+s*a)*l+Math.floor(e*a*l+n*a)];return o&&h>0?0:h}const nc={[Ae]:"north",[Le]:"south"},oc=(a,e,t,i)=>{let s=nc[i];if(s)return`https://terrain.openglobus.org/poles/${s}/${t}/${a}/${e}.png`};class ac extends Pt{constructor(e,t){super(e||"GlobusEarthRgb",{maxNativeZoom:6,maxZoom:17,url:"https://{s}.terrain.openglobus.org/all/{z}/{x}/{y}.png",urlRewrite:oc,...t})}isReadyToLoad(e){return this._extent.overlaps(e.getExtentLonLat())}}Object.freeze(Object.defineProperty({__proto__:null,BilTerrain:Ge,EmptyTerrain:Ri,GlobusRgbTerrain:ac,GlobusTerrain:_n,RgbTerrain:Pt},Symbol.toStringTag,{value:"Module"}));class lc extends Ei{constructor(e,t={}){super(e,t),this._sourceTexture=t.texture||null,t.texture&&(this._sourceReady=!0,this._sourceCreated=!0),this._frameWidth=t.frameWidth!=null?We(t.frameWidth):256,this._frameHeight=t.frameHeight!=null?We(t.frameHeight):256,this._animate=!0}get instanceName(){return"GeoTexture2d"}loadMaterial(e){this._planet._geoImageCreator.add(this)}bindTexture(e){this._sourceReady=!0,this._sourceCreated=!0,this._sourceTexture=e}setSize(e,t){this._frameWidth=e,this._frameHeight=t,this._frameCreated=!1}abortMaterialLoading(e){this._creationProceeding=!1,e.isLoading=!1,e.isReady=!1}}class hc extends Ei{constructor(e,t={}){super(e,t),this._animate=!0,this._video=t.videoElement||null,this._src=t.src||null}get instanceName(){return"GeoVideo"}setSrc(e){this._planet&&this._planet._geoImageCreator.remove(this),this._src=e,this._sourceReady=!1}setVideoElement(e){this._planet&&this._planet._geoImageCreator.remove(this),this._video=e,this._src=e.src,this._sourceReady=!1}setVisibility(e){e!=this._visibility&&(super.setVisibility(e),this._planet&&(e?(this._sourceReady&&this._planet._geoImageCreator.add(this),this._video&&this._video.play()):(this._sourceReady&&this._planet._geoImageCreator.remove(this),this._video&&this._video.pause())))}_createSourceTexture(){let e=this._planet.renderer.handler.gl;this._sourceCreated?(e.bindTexture(e.TEXTURE_2D,this._sourceTexture),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,this._video)):(this._sourceTexture=this._planet.renderer.handler.createTexture_n_webgl1(this._video),this._sourceCreated=!0)}_onCanPlay(e){this._frameWidth=e.videoWidth,this._frameHeight=e.videoHeight,e.width=e.videoWidth,e.height=e.videoHeight,e.play(),this._sourceReady=!0,this._planet._geoImageCreator.add(this)}_onError(e){let t="unknown error";switch(e.error.code){case 1:t="video loading aborted";break;case 2:t="network loading error";break;case 3:t="video decoding failed / corrupted data or unsupported codec";break;case 4:t="video not supported"}console.warn(`Error: ${t} error-code=${e.error.code})`)}loadMaterial(e){if(e.isLoading=!0,this._creationProceeding=!0,!this._sourceReady&&this._src){if(this._video){if(this._video.readyState===this._video.HAVE_ENOUGH_DATA)this._onCanPlay(this._video);else if(this._video.src){let t=this;this._video.addEventListener("canplay",function(i){t._onCanPlay(this)})}}else{this._video=document.createElement("video"),this._video.crossOrigin="Anonymous";let t=this;this._video.addEventListener("canplay",function(){t._onCanPlay(this)}),this._video.addEventListener("error",function(){t._onError(this)})}this._video.autoplay=!0,this._video.loop=!0,this._video.src=this._src,this._video.muted=!0,this._video.setAttribute("playsinline","true"),this._video.setAttribute("webkit-playsinline","true")}else this._planet._geoImageCreator.add(this)}abortMaterialLoading(e){this._video&&(this._video.src=""),this._creationProceeding=!1,e.isLoading=!1,e.isReady=!1}}class cc extends ut{constructor(e,t={}){super(e,t),this._billboard=t.billboard||{src:"https://openglobus.org/examples/billboards/carrot.png"},this._color=t.color||"#6689db"}get instanceName(){return"KML"}_extractCoordonatesFromKml(e){return Array.from(e.getElementsByTagName("coordinates")).map(t=>t.textContent.trim()).map(t=>t.replace(/\n/g," ").replace(/\t/g," ").replace(/ +/g," ").split(" ").map(i=>i.split(",").map(parseFloat)))}_AGBRtoRGBA(e){if(!e||e.length!=8)return;const t=parseInt(e.slice(0,2),16)/255,i=parseInt(e.slice(2,4),16),s=parseInt(e.slice(4,6),16);return`rgba(${parseInt(e.slice(6,8),16)},${s},${i},${t})`}_parseKMLcoordinates(e){return e.innerHTML.trim().replace(/\n/g," ").replace(/\t/g," ").replace(/ +/g," ").split(" ").map(t=>t.split(",").map(parseFloat))}_kmlPlacemarkToEntity(e,t){if(!e)return;const i=Array.from(e.getElementsByTagName("name")),s=i&&i.length>0?i[0].innerHTML.trim():"",{iconHeading:n,iconURL:o,iconColor:l,lineWidth:h,lineColor:c}=this._extractStyle(e),d=[];for(const u of e.getElementsByTagName("coordinates")){const f=this._parseKMLcoordinates(u)||[[0,0,0]];for(const _ of f){const[g,v,p]=_;d.push(new A(g,v,p)),g<t.southWest.lon&&(t.southWest.lon=g),v<t.southWest.lat&&(t.southWest.lat=v),g>t.northEast.lon&&(t.northEast.lon=g),v>t.northEast.lat&&(t.northEast.lat=v)}}if(d.length===1){const u=.01745329*n;return new U({name:s,lonlat:d[0],billboard:{src:o,size:[24,24],color:l,rotation:u},properties:{color:l,heading:n}})}return new U({name:s,polyline:{pathLonLat:[d],thickness:h,color:c,isClosed:!1},properties:{name:s}})}_extractStyle(e){let t,i,s,n,o;const l=e.getElementsByTagName("Style")[0];if(l){let h=l.getElementsByTagName("IconStyle")[0];if(h){let d=h.getElementsByTagName("color")[0];d&&(t=this._AGBRtoRGBA(d.innerHTML.trim()));let u=h.getElementsByTagName("heading")[0];if(u){const _=parseFloat(u.innerHTML.trim());_>=0&&_<=360&&(i=_%360)}let f=h.getElementsByTagName("Icon")[0];if(f){let _=f.getElementsByTagName("href")[0];_&&(s=_.innerHTML.trim())}}let c=l.getElementsByTagName("LineStyle")[0];if(c){let d=c.getElementsByTagName("color")[0];d&&(n=this._AGBRtoRGBA(d.innerHTML.trim()));let u=c.getElementsByTagName("width")[0];u!==void 0&&(o=parseFloat(u.innerHTML.trim()))}}return t||(t="#FFFFFF"),i||(i=0),s||(s="https://openglobus.org/examples/billboards/carrot.png"),n||(n="#FFFFFF"),o||(o=1),{iconHeading:i,iconURL:s,iconColor:t,lineWidth:o,lineColor:n}}_parseKML(e,t,i){if(i||(i=[]),e.documentElement.nodeName!=="kml")return i;for(const s of e.getElementsByTagName("Placemark")){const n=this._kmlPlacemarkToEntity(s,t);n&&i.push(n)}return i}_convertKMLintoEntities(e){const t=new V(new A(180,90),new A(-180,-90));return{entities:this._parseKML(e,t),extent:t}}_convertCoordonatesIntoEntities(e,t,i){const s=new V(new A(180,90),new A(-180,-90)),n=l=>{const h=l[0],c=l[1];h<s.southWest.lon&&(s.southWest.lon=h),c<s.southWest.lat&&(s.southWest.lat=c),h>s.northEast.lon&&(s.northEast.lon=h),c>s.northEast.lat&&(s.northEast.lat=c)},o=[];return e.forEach(l=>l.forEach(h=>o.push(h))),{entities:o.map(l=>{if(l.length===1){const h=l[0],c=new U({lonlat:h,billboard:i});return n(h),c}if(l.length>1){const h=l.map(c=>(n(c),new A(c[0],c[1],c[2])));return new U({polyline:{pathLonLat:[h],thickness:3,color:t,isClosed:!1}})}}),extent:s}}_getXmlContent(e){return new Promise(t=>{const i=new FileReader;i.onload=async s=>t(new DOMParser().parseFromString(s.target.result,"text/xml")),i.readAsText(e)})}_expandExtents(e,t){return e?(t.southWest.lon<e.southWest.lon&&(e.southWest.lon=t.southWest.lon),t.southWest.lat<e.southWest.lat&&(e.southWest.lat=t.southWest.lat),t.northEast.lon>e.northEast.lon&&(e.northEast.lon=t.northEast.lon),t.northEast.lat>e.northEast.lat&&(e.northEast.lat=t.northEast.lat),e):t}async addKmlFromFiles(e,t,i){if(!Array.isArray(e))return null;const s=(await Promise.all(e.map(this._getXmlContent))).map(this._extractCoordonatesFromKml),{entities:n,extent:o}=this._convertCoordonatesIntoEntities(s,t||this._color,i||this._billboard);return this._extent=this._expandExtents(this._extent,o),n.forEach(this.add.bind(this)),{entities:n,extent:o}}setColor(e){this._color=e,this._billboard.color=e}_getKmlFromUrl(e){return new Promise((t,i)=>{const s=new XMLHttpRequest;s.open("GET",e,!0),s.responseType="document",s.overrideMimeType("text/xml"),s.onload=()=>{s.readyState===s.DONE&&s.status===200?t(s.responseXML):i(new Error("no valid kml file"))},s.send()})}async addKmlFromUrl(e,t,i){const s=await this._getKmlFromUrl(e),{entities:n,extent:o}=this._convertKMLintoEntities(s);return this._extent=this._expandExtents(this._extent,o),n.forEach(this.add.bind(this)),{entities:n,extent:o}}}class dc extends zs{constructor(e,t={}){super(e||"OpenStreetMap",{iconSrc:"https://tile.openstreetmap.org/8/138/95.png",url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"Data @ OpenStreetMap contributors, ODbL",isBaseLayer:!0,maxNativeZoom:19,defaultTextures:[{color:"#AAD3DF"},{color:"#F2EFE9"}],isSRGB:!1,shininess:18,specular:[63e-5,55e-5,32e-5],ambient:[.2,.2,.3],diffuse:[.9,.9,.7],...t})}}function uc(a,e,t){var i="";for(let o=t;o>0;o--){var s=0,n=1<<o-1;a&n&&s++,e&n&&(s+=2),i+=s.toString()}return i}class _c extends zs{constructor(e,t={}){super(e||"Bing",{iconSrc:"https://ecn.t0.tiles.virtualearth.net/tiles/a120.jpeg?n=z&g=7146",subdomains:["t0","t1","t2","t3"],url:"https://ecn.{s}.tiles.virtualearth.net/tiles/a{quad}.jpeg?n=z&g=7146",isBaseLayer:!0,textureFilter:"LINEAR",maxNativeZoom:17,defaultTextures:[{color:"#001522"},{color:"#E4E6F3"}],attribution:'<div style="transform: scale(0.8); margin-top:-2px;"><a href="https://www.bing.com" target="_blank"><img style="position: relative; top: 2px;" title="Bing Imagery" src="https://sandcastle.cesium.com/CesiumUnminified/Assets/Images/bing_maps_credit.png"></a>  2021 Microsoft Corporation</div>',urlRewrite:(i,s)=>zt(s,{s:this._getSubdomain(),quad:uc(i.tileX,i.tileY,i.tileZoom)}),specular:[63e-5,55e-5,32e-5],ambient:[.35,.35,.35],diffuse:[1.5,1.5,1.5],shininess:20,nightTextureCoefficient:2.7,...t})}}Object.freeze(Object.defineProperty({__proto__:null,Bing:_c,CanvasTiles:is,GeoImage:wa,GeoTexture2d:lc,GeoVideo:hc,KML:cc,LAYER_EVENTS:Vo,Layer:It,Material:Ho,OpenStreetMap:dc,Vector:ut,WMS:pe,XYZ:zs},Symbol.toStringTag,{value:"Module"}));const sr=function(a,e){return+(a.priority<e.priority)};class fc{constructor(){this._currentlyPressedKeys={},this._pressedKeysCallbacks={},this._unpressedKeysCallbacks={},this._charkeysCallbacks={},this._anykeyCallback=null,this._event=null,this._active=!0,this._stampCache={},document.onkeydown=e=>{this._event=e,this._active&&this.handleKeyDown()},document.onkeyup=e=>{this._event=e,this._active&&this.handleKeyUp()}}getcurrentlyPressedKeys(){return this._currentlyPressedKeys}getPressedKeysCallbacks(){return this._pressedKeysCallbacks}getUnpressedKeysCallbacks(){return this._unpressedKeysCallbacks}getCharkeysCallbacks(){return this._charkeysCallbacks}removeEvent(e,t,i){let s=this._getStamp(e,t,i._openglobus_id);i._openglobus_id&&this._stampCache[s]&&(delete this._stampCache[s],e==="keypress"?this._removeCallback(this._pressedKeysCallbacks[t],i):e==="keyfree"?this._removeCallback(this._unpressedKeysCallbacks[t],i):e==="charkeypress"&&this._removeCallback(this._charkeysCallbacks[t],i))}_removeCallback(e,t){for(let i=0;i<e.length;i++)e[i].callback._openglobus_id===t._openglobus_id&&e.splice(i,1)}_getStamp(e,t,i){return`${e}_${t}_${i}`}_stamp(e,t,i){const s=jr(i),n=this._getStamp(e,t,s);return!this._stampCache[n]&&(this._stampCache[n]=s,!0)}setActivity(e){this._active=e}releaseKeys(){this._currentlyPressedKeys={}}addEvent(e,t,i,s,n){if(this._stamp(e,t,i))switch(n===void 0&&(n=1600),e){case"keyfree":this._unpressedKeysCallbacks[t]||(this._unpressedKeysCallbacks[t]=[]),this._unpressedKeysCallbacks[t].push({callback:i,sender:s,priority:n}),this._unpressedKeysCallbacks[t].sort(sr);break;case"keypress":t==null?this._anykeyCallback={callback:i,sender:s||this}:(this._pressedKeysCallbacks[t]||(this._pressedKeysCallbacks[t]=[]),this._pressedKeysCallbacks[t].push({callback:i,sender:s,priority:n}),this._pressedKeysCallbacks[t].sort(sr));break;case"charkeypress":this._charkeysCallbacks[t]||(this._charkeysCallbacks[t]=[]),this._charkeysCallbacks[t].push({callback:i,sender:s,priority:n}),this._charkeysCallbacks[t].sort(sr)}}isKeyPressed(e){return this._currentlyPressedKeys[e]}handleKeyDown(){this._anykeyCallback&&this._anykeyCallback.callback.call(this._anykeyCallback.sender,this._event),this._currentlyPressedKeys[this._event.keyCode]=!0;for(let e in this._charkeysCallbacks)if(String.fromCharCode(this._event.keyCode)===String.fromCharCode(Number(e))){let t=this._charkeysCallbacks[e];for(let i=0;i<t.length;i++)t[i].callback.call(t[i].sender,this._event)}this._event.keyCode!=Y.KEY_ALT&&this._event.keyCode!=Y.KEY_SHIFT||this._event.preventDefault()}handleKeyUp(){if(this._currentlyPressedKeys[this._event.keyCode]||this._event.keyCode===Y.KEY_PRINTSCREEN){for(let e in this._unpressedKeysCallbacks)if(this._currentlyPressedKeys[e]||this._event.keyCode===Y.KEY_PRINTSCREEN&&Number(e)===Y.KEY_PRINTSCREEN){let t=this._unpressedKeysCallbacks[e];for(let i=0;i<t.length;i++)t[i].callback.call(t[i].sender,this._event)}}this._currentlyPressedKeys[this._event.keyCode]=!1}handleEvents(){for(let e in this._pressedKeysCallbacks)if(this._currentlyPressedKeys[e]){let t=this._pressedKeysCallbacks[e];for(let i=0;i<t.length;i++)t[i].callback.call(t[i].sender,this._event)}}}class gc{constructor(e){this._htmlObject=e}setEvent(e,t,i){switch(e){case"mousewheel":this._htmlObject.addEventListener("wheel",s=>{let n=s.deltaY||s.detail||s.wheelDelta||0;var o;s.wheelDelta==null&&(s.wheelDelta=-120*n),s.isTouchPad=(o=s).deltaMode===0&&Math.abs(o.deltaY)<50,i.call(t,s),s.preventDefault()},!1);break;case"mousedown":this._htmlObject.addEventListener("mousedown",function(s){let n=this.getBoundingClientRect();i.call(t,s,{button:s.button,clientX:s.clientX-n.left,clientY:s.clientY-n.top})}),this._htmlObject.addEventListener("contextmenu",function(s){return s.preventDefault(),!1});break;case"mouseup":this._htmlObject.addEventListener("mouseup",function(s){let n=this.getBoundingClientRect();i.call(t,s,{button:s.button,clientX:s.clientX-n.left,clientY:s.clientY-n.top})});break;case"mousemove":this._htmlObject.addEventListener("mousemove",function(s){let n=this.getBoundingClientRect();i.call(t,s,{clientX:s.clientX-n.left,clientY:s.clientY-n.top})});break;case"mouseleave":this._htmlObject.addEventListener("mouseleave",function(s){i.call(t,s)});break;case"mouseout":this._htmlObject.addEventListener("mouseout",function(s){i.call(t,s)});break;case"mouseover":this._htmlObject.addEventListener("mouseover",function(s){i.call(t,s)});break;case"mouseenter":this._htmlObject.addEventListener("mouseenter",function(s){i.call(t,s)})}}}class pc{constructor(e){this._htmlObject=e}setEvent(e,t,i){switch(e){case"touchcancel":this._htmlObject.addEventListener("touchcancel",function(s){s.preventDefault();const n=this.getBoundingClientRect(),o=Object.assign(s,{offsetLeft:n.left,offsetTop:n.top});i.call(t,o)});break;case"touchstart":this._htmlObject.addEventListener("touchstart",function(s){s.preventDefault();const n=this.getBoundingClientRect(),o=Object.assign(s,{offsetLeft:n.left,offsetTop:n.top});i.call(t,o)});break;case"touchend":this._htmlObject.addEventListener("touchend",function(s){s.preventDefault();const n=this.getBoundingClientRect(),o=Object.assign(s,{offsetLeft:n.left,offsetTop:n.top});i.call(t,o)});break;case"touchmove":this._htmlObject.addEventListener("touchmove",function(s){s.preventDefault();const n=this.getBoundingClientRect(),o=Object.assign(s,{offsetLeft:n.left,offsetTop:n.top});i.call(t,o)})}}}let ue=new Uint8Array(4),ti=new Uint8Array(4),ei=new Uint8Array(4);class mc extends xi{constructor(e){super(vc),this.renderer=e,this._touchHandler=new pc(e.handler.canvas),this._mouseHandler=new gc(e.handler.canvas),this._keyboardHandler=new fc,this._active=!0,this.clickRadius=15,this.mouseState={clientX:0,clientY:0,pos:new N,x:0,y:0,nx:0,ny:0,prev_x:0,prev_y:0,direction:new m,leftButtonUp:!1,rightButtonUp:!1,middleButtonUp:!1,leftButtonDown:!1,rightButtonDown:!1,middleButtonDown:!1,leftButtonHold:!1,rightButtonHold:!1,middleButtonHold:!1,leftButtonDoubleClick:!1,rightButtonDoubleClick:!1,middleButtonDoubleClick:!1,leftButtonClick:!1,rightButtonClick:!1,middleButtonClick:!1,moving:!1,justStopped:!1,doubleClickDelay:500,clickDelay:200,wheelDelta:0,sys:null,pickingObject:null,renderer:e,isTouchPad:!1},this.touchState={touching:!1,moving:!1,touchEnd:!1,touchStart:!1,touchCancel:!1,doubleTouch:!1,doubleTouchDelay:550,doubleTouchRadius:10,clientX:0,clientY:0,pos:new N,x:0,y:0,nx:0,ny:0,prev_x:0,prev_y:0,direction:new m,sys:null,pickingObject:null,renderer:e},this._isMouseInside=!0,this._entityPickingEventsActive=!0,this._dblTchCoords=new N,this._oneTouchStart=!1,this._dblTchBegins=0,this._mousestopThread=null,this._ldblClkBegins=0,this._rdblClkBegins=0,this._mdblClkBegins=0,this._lClkBegins=0,this._rClkBegins=0,this._mClkBegins=0,this._lclickX=0,this._lclickY=0,this._rclickX=0,this._rclickY=0,this._mclickX=0,this._mclickY=0}pointerEvent(){let e=this.mouseState;return e.moving||e.justStopped||e.wheelDelta!==0}get active(){return this._active}set active(e){this._active=e,this._keyboardHandler.setActivity(e)}handleEvents(){this._active&&(this.mouseState.direction=this.renderer.activeCamera.unproject(this.mouseState.x,this.mouseState.y),this.touchState.direction=this.renderer.activeCamera.unproject(this.touchState.x,this.touchState.y),this._keyboardHandler.handleEvents(),this.handleMouseEvents(),this.handleTouchEvents(),this.entityPickingEvents())}on(e,t,i,s,n){e==="keypress"||e==="charkeypress"||e==="keyfree"?this._keyboardHandler.addEvent(e,t,i,s,n):super.on(e,t,i,s)}off(e,t,i){e==="keypress"||e==="charkeypress"||e==="keyfree"?this._keyboardHandler.removeEvent(e,t,i):super.off(e,t)}isKeyPressed(e){return this._keyboardHandler.isKeyPressed(e)}releaseKeys(){this._keyboardHandler.releaseKeys()}initialize(){this._mouseHandler.setEvent("mouseup",this,this.onMouseUp),this._mouseHandler.setEvent("mousemove",this,this.onMouseMove),this._mouseHandler.setEvent("mousedown",this,this.onMouseDown),this._mouseHandler.setEvent("mousewheel",this,this.onMouseWheel),this._mouseHandler.setEvent("mouseleave",this,this.onMouseLeave),this._mouseHandler.setEvent("mouseenter",this,this.onMouseEnter),this._touchHandler.setEvent("touchstart",this,this.onTouchStart),this._touchHandler.setEvent("touchend",this,this.onTouchEnd),this._touchHandler.setEvent("touchcancel",this,this.onTouchCancel),this._touchHandler.setEvent("touchmove",this,this.onTouchMove)}onMouseWheel(e){this.mouseState.isTouchPad=e.isTouchPad||!1,this.mouseState.sys=e,this.mouseState.wheelDelta=e.wheelDelta||0}updateButtonsStates(e){let t=this.mouseState;1&e&&t.leftButtonDown?t.leftButtonDown=!0:(t.leftButtonHold=!1,t.leftButtonDown=!1),2&e&&t.rightButtonDown?t.rightButtonDown=!0:(t.rightButtonHold=!1,t.rightButtonDown=!1),4&e&&t.middleButtonDown?t.middleButtonDown=!0:(t.middleButtonHold=!1,t.middleButtonDown=!1)}onMouseMove(e,t){let i=this.mouseState;this.updateButtonsStates(e.buttons),i.sys=e;let s=t.clientX,n=t.clientY,o=this.clickRadius;if(Math.abs(this._lclickX-s)>=o&&Math.abs(this._lclickY-n)>=o&&(this._ldblClkBegins=0,this._lClkBegins=0),Math.abs(this._rclickX-s)>=o&&Math.abs(this._rclickY-n)>=o&&(this._rdblClkBegins=0,this._rClkBegins=0),Math.abs(this._mclickX-s)>=o&&Math.abs(this._mclickY-n)>=o&&(this._mdblClkBegins=0,this._mClkBegins=0),i.clientX===t.clientX&&i.clientY===t.clientY)return;i.clientX=t.clientX,i.clientY=t.clientY;let l=this.renderer.handler;i.pos.x=i.x=t.clientX*l.pixelRatio,i.pos.y=i.y=t.clientY*l.pixelRatio,i.nx=i.x/l.canvas.width,i.ny=i.y/l.canvas.height,i.moving=!0,clearTimeout(this._mousestopThread),this._mousestopThread=setTimeout(function(){i.justStopped=!0},100)}onMouseLeave(e){this._isMouseInside=!1,this.mouseState.sys=e,this.dispatch(this.mouseleave,this.mouseState)}onMouseEnter(e){this._isMouseInside=!0,this.mouseState.sys=e,this.dispatch(this.mouseenter,this.mouseState)}onMouseDown(e,t){t.button===Y.MB_LEFT?(this._lClkBegins=window.performance.now(),this._lclickX=t.clientX,this._lclickY=t.clientY,this.mouseState.sys=e,this.mouseState.leftButtonDown=!0):t.button===Y.MB_RIGHT?(this._rClkBegins=window.performance.now(),this._rclickX=t.clientX,this._rclickY=t.clientY,this.mouseState.sys=e,this.mouseState.rightButtonDown=!0):t.button===Y.MB_MIDDLE&&(this._mClkBegins=window.performance.now(),this._mclickX=t.clientX,this._mclickY=t.clientY,this.mouseState.sys=e,this.mouseState.middleButtonDown=!0)}onMouseUp(e,t){let i=this.mouseState;i.sys=e;let s=window.performance.now();t.button===Y.MB_LEFT?(i.leftButtonDown=!1,i.leftButtonUp=!0,Math.abs(this._lclickX-t.clientX)<this.clickRadius&&Math.abs(this._lclickY-t.clientY)<this.clickRadius&&s-this._lClkBegins<=i.clickDelay&&(this._ldblClkBegins?(window.performance.now()-this._ldblClkBegins<=i.doubleClickDelay&&(i.leftButtonDoubleClick=!0),this._ldblClkBegins=0):this._ldblClkBegins=window.performance.now(),i.leftButtonClick=!0,this._lClkBegins=0)):t.button===Y.MB_RIGHT?(i.rightButtonDown=!1,i.rightButtonUp=!0,Math.abs(this._rclickX-t.clientX)<this.clickRadius&&Math.abs(this._rclickY-t.clientY)<this.clickRadius&&s-this._rClkBegins<=i.clickDelay&&(this._rdblClkBegins?(window.performance.now()-this._rdblClkBegins<=i.doubleClickDelay&&(i.rightButtonDoubleClick=!0),this._rdblClkBegins=0):this._rdblClkBegins=window.performance.now(),i.rightButtonClick=!0,this._rClkBegins=0)):t.button===Y.MB_MIDDLE&&(i.middleButtonDown=!1,i.middleButtonUp=!0,Math.abs(this._mclickX-t.clientX)<this.clickRadius&&Math.abs(this._mclickY-t.clientY)<this.clickRadius&&s-this._mClkBegins<=i.clickDelay)&&(this._mdblClkBegins?(window.performance.now()-this._mdblClkBegins<=i.doubleClickDelay&&(i.middleButtonDoubleClick=!0),this._mdblClkBegins=0):this._mdblClkBegins=window.performance.now(),i.middleButtonClick=!0,this._mClkBegins=0)}onTouchStart(e){let t=this.touchState;t.sys=e,t.clientX=e.touches.item(0).clientX-e.offsetLeft,t.clientY=e.touches.item(0).clientY-e.offsetTop;let i=this.renderer.handler;t.pos.x=t.x=t.clientX*i.pixelRatio,t.pos.y=t.y=t.clientY*i.pixelRatio,t.nx=t.x/i.canvas.width,t.ny=t.y/i.canvas.height,t.prev_x=t.x,t.prev_y=t.y,t.touchStart=!0,t.touching=!0,e.touches.length===1?(this._dblTchCoords.x=t.x,this._dblTchCoords.y=t.y,this._oneTouchStart=!0):this._oneTouchStart=!1}onTouchEnd(e){let t=this.touchState;t.sys=e,t.touchEnd=!0,e.touches.length===0&&(t.prev_x=t.x,t.prev_y=t.y,this._oneTouchStart)&&(this._dblTchBegins&&(window.performance.now()-this._dblTchBegins<=t.doubleTouchDelay&&(t.doubleTouch=!0),this._dblTchBegins=0),this._dblTchBegins=window.performance.now(),this._oneTouchStart=!1)}onTouchCancel(e){let t=this.touchState;t.sys=e,t.touchCancel=!0}onTouchMove(e){let t=this.touchState;t.clientX=e.touches.item(0).clientX-e.offsetLeft,t.clientY=e.touches.item(0).clientY-e.offsetTop;let i=this.renderer.handler;t.x=t.clientX*i.pixelRatio,t.y=t.clientY*i.pixelRatio,t.nx=t.x/i.canvas.width,t.ny=t.y/i.canvas.height,t.sys=e,t.moving=!0;let s=t.x-t.prev_x,n=t.y-t.prev_y;(Math.abs(s)>9||Math.abs(n)>9)&&(this._dblTchBegins=0,this._oneTouchStart=!1)}entityPickingEvents(){let e=this.touchState,t=this.mouseState;if(this._isMouseInside!==this._entityPickingEventsActive&&(this._entityPickingEventsActive=this._isMouseInside,!this._entityPickingEventsActive)){let s=this.renderer,n=ue,o=s.getPickingObjectArr(n);if(o){let l=o.rendererEvents;t.pickingObject=o,l&&l.dispatch(l.mouseleave,t),e.pickingObject=o,l&&l.dispatch(l.touchleave,e)}ue[0]=ue[1]=ue[2]=ue[3]=ei[0]=ei[1]=ei[2]=ei[3]=ti[0]=ti[1]=ti[2]=ti[3]=0}if(this._isMouseInside&&!(t.leftButtonHold||t.rightButtonHold||t.middleButtonHold)){let s=this.renderer,n=ue,o=ei,l=ti;e.x||e.y?s.readPickingColor(e.nx,1-e.ny,l):s.readPickingColor(t.nx,1-t.ny,l),o[0]=n[0],o[1]=n[1],o[2]=n[2],n[0]=l[0],n[1]=l[1],n[2]=l[2],t.pickingObject=null,e.pickingObject=null;let h=s.getPickingObjectArr(n);if(t.pickingObject=h,e.pickingObject=h,n[0]!==o[0]||n[1]!==o[1]||n[2]!==o[2])if((i=n)[0]||i[1]||i[2]){if((c=>!!(c[0]||c[1]||c[2]))(o)){let c=s.getPickingObjectArr(o);if(c){let d=c.rendererEvents;t.pickingObject=c,d&&d.dispatch(d.mouseleave,t),e.pickingObject=c,d&&d.dispatch(d.touchleave,e)}}if(h){let c=h.rendererEvents;t.pickingObject=h,c&&c.dispatch(c.mouseenter,t),e.pickingObject=h,c&&c.dispatch(c.touchenter,e)}}else{let c=s.getPickingObjectArr(o);if(c){let d=c.rendererEvents;t.pickingObject=c,d&&d.dispatch(d.mouseleave,t),e.pickingObject=c,d&&d.dispatch(d.touchleave,e)}}}var i}handleMouseEvents(){let e=this,t=this.mouseState,i=t.pickingObject,s=null;t.leftButtonClick&&(i&&(s=i.rendererEvents,s&&s.dispatch(s.lclick,t)),this.dispatch(e.lclick,t),t.leftButtonClick=!1),t.rightButtonClick&&(i&&(s=i.rendererEvents,s&&s.dispatch(s.rclick,t)),this.dispatch(e.rclick,t),t.rightButtonClick=!1),t.middleButtonClick&&(i&&(s=i.rendererEvents,s&&s.dispatch(s.mclick,t)),this.dispatch(e.mclick,t),t.middleButtonClick=!1),t.leftButtonDown&&(t.leftButtonHold?(i&&(s=i.rendererEvents,s&&s.dispatch(s.lhold,t)),this.dispatch(e.lhold,t)):(t.leftButtonHold=!0,i&&(s=i.rendererEvents,s&&s.dispatch(s.ldown,t)),this.dispatch(e.ldown,t))),t.rightButtonDown&&(t.rightButtonHold?(i&&(s=i.rendererEvents,s&&s.dispatch(s.rhold,t)),this.dispatch(e.rhold,t)):(t.rightButtonHold=!0,i&&(s=i.rendererEvents,s&&s.dispatch(s.rdown,t)),this.dispatch(e.rdown,t))),t.middleButtonDown&&(t.middleButtonHold?(i&&(s=i.rendererEvents,s&&s.dispatch(s.mhold,t)),this.dispatch(e.mhold,t)):(t.middleButtonHold=!0,i&&(s=i.rendererEvents,s&&s.dispatch(s.mdown,t)),this.dispatch(e.mdown,t))),t.leftButtonUp&&(i&&(s=i.rendererEvents,s&&s.dispatch(s.lup,t)),this.dispatch(e.lup,t),t.leftButtonUp=!1,t.leftButtonHold=!1),t.rightButtonUp&&(i&&(s=i.rendererEvents,s&&s.dispatch(s.rup,t)),this.dispatch(e.rup,t),t.rightButtonUp=!1,t.rightButtonHold=!1),t.middleButtonUp&&(i&&(s=i.rendererEvents,s&&s.dispatch(s.mup,t)),this.dispatch(e.mup,t),t.middleButtonUp=!1,t.middleButtonHold=!1),t.leftButtonDoubleClick&&(i&&(s=i.rendererEvents,s&&s.dispatch(s.ldblclick,t)),this.dispatch(e.ldblclick,t),t.leftButtonDoubleClick=!1),t.rightButtonDoubleClick&&(i&&(s=i.rendererEvents,s&&s.dispatch(s.rdblclick,t)),this.dispatch(e.rdblclick,t),t.rightButtonDoubleClick=!1),t.middleButtonDoubleClick&&(i&&(s=i.rendererEvents,s&&s.dispatch(s.mdblclick,t)),this.dispatch(e.mdblclick,t),t.middleButtonDoubleClick=!1),t.wheelDelta&&(i&&(s=i.rendererEvents,s&&s.dispatch(s.mousewheel,t)),this.dispatch(e.mousewheel,t)),t.moving&&(i&&(s=i.rendererEvents,s&&s.dispatch(s.mousemove,t)),this.dispatch(e.mousemove,t),t.prev_x=t.x,t.prev_y=t.y),t.justStopped&&this.dispatch(e.mousestop,t)}handleTouchEvents(){let e=this,t=this.touchState,i=t.pickingObject,s=null;if(t.touchCancel&&(this.dispatch(e.touchcancel,t),t.touchCancel=!1),t.touchStart){let n=this.renderer;n.readPickingColor(t.nx,1-t.ny,ue);let o=n.getPickingObjectArr(ue);i=t.pickingObject=o,i&&(s=i.rendererEvents,s&&s.dispatch(s.touchstart,t)),this.dispatch(e.touchstart,t),t.touchStart=!1}t.doubleTouch&&(i&&(s=i.rendererEvents,s&&s.dispatch(s.doubletouch,t)),this.dispatch(e.doubletouch,t),t.doubleTouch=!1),t.touchEnd&&(i&&(s=i.rendererEvents,s&&s.dispatch(s.touchend,t)),this.dispatch(e.touchend,t),t.x=0,t.y=0,t.touchEnd=!1,t.touching=!1),t.moving&&(i&&(s=i.rendererEvents,s&&s.dispatch(s.touchmove,t)),this.dispatch(e.touchmove,t),t.prev_x=t.x,t.prev_y=t.y)}}const vc=["projchanged","changerelativecenter","draw","drawtransparent","postdraw","resize","resizeend","mouseenter","mouseleave","mousemove","mousestop","lclick","rclick","mclick","ldblclick","rdblclick","mdblclick","lup","rup","mup","ldown","rdown","mdown","lhold","rhold","mhold","mousewheel","touchstart","touchend","touchcancel","touchmove","doubletouch","touchleave","touchenter"];class ki{constructor(e=0,t=0,i=0,s=0){this.left=e,this.right=i,this.top=t,this.bottom=s}set(e=0,t=0,i=0,s=0){this.left=e,this.right=i,this.top=t,this.bottom=s}clone(){return new ki(this.left,this.top,this.right,this.bottom)}getWidth(){return Math.abs(this.right-this.left)}getHeight(){return Math.abs(this.bottom-this.top)}getSquare(){return this.getHeight()*this.getWidth()}getDiagonal(){let e=this.getWidth(),t=this.getHeight();return Math.sqrt(t*t+e*e)}fit(e,t){return this.getWidth()===e&&this.getHeight()===t}isInside(e,t){return e>=this.left&&e<=this.right&&t>=this.top&&t<=this.bottom}}class yc{constructor(){this.imagesCache={},this._counter=0,this._pendingsQueue=new hn,this._imageIndexCounter=0}load(e,t){if(this.imagesCache[e])t(this.imagesCache[e]);else{let i={src:e,success:t};this._counter>=1?this._pendingsQueue.unshift(i):this._exec(i)}}_exec(e){this._counter++;const t=this;let i=new Image;i.crossOrigin="",i.onload=function(){t.imagesCache[e.src]=i,i.__nodeIndex=t._imageIndexCounter++,e.success(i),t._dequeueRequest()},i.onerror=function(){t._dequeueRequest()},i.src=e.src}_dequeueRequest(){if(this._counter--,this._pendingsQueue.length&&this._counter<1)for(;this._pendingsQueue.length;){let e=this._pendingsQueue.pop();if(e){if(!this.imagesCache[e.src]){this._exec(e);break}this._counter<=0?this._counter=0:this._counter--,e.success(this.imagesCache[e.src])}}}}class Nr{constructor(e=1024,t=1024){this.nodes=new Map,this.texture=null,this.canvas=new pi(e,t),this.clearCanvas(),this._handler=null,this._images=[],this._btree=null,this._imagesCacheManager=new yc,this.borderSize=4}getImage(){return this.canvas.getImage()}getCanvas(){return this.canvas.getCanvas()}clearCanvas(){this.canvas.fillEmpty()}assignHandler(e){this._handler=e,this.createTexture()}getDiagonal(e){let t=e.atlasWidth||e.width,i=e.atlasHeight||e.height;return Math.sqrt(t*t+i*i)}addImage(e,t=!1){if(e.width&&e.height)return this._images.push(e),this._makeAtlas(t),e.__nodeIndex!=null?this.get(e.__nodeIndex):void 0}_completeNode(e,t){if(t){let i=this.canvas.getWidth(),s=this.canvas.getHeight(),n=t.image,o=t.rect,l=Math.round(.5*this.borderSize);this.canvas.drawImage(n,o.left+l,o.top+l,n.atlasWidth||0,n.atlasHeight||0);let h=t.texCoords;h[0]=(o.left+l)/i,h[1]=(o.top+l)/s,h[2]=(o.left+l)/i,h[3]=(o.bottom-l)/s,h[4]=(o.right-l)/i,h[5]=(o.bottom-l)/s,h[6]=(o.right-l)/i,h[7]=(o.bottom-l)/s,h[8]=(o.right-l)/i,h[9]=(o.top+l)/s,h[10]=(o.left+l)/i,h[11]=(o.top+l)/s,e.set(n.__nodeIndex,t)}}_makeAtlas(e=!1){if(e&&this._btree){let t=this._images[this._images.length-1];this._completeNode(this.nodes,this._btree.insert(t))}else{let t=this._images.slice(0);t.sort(function(s,n){return(n.atlasWidth||n.width)-(s.atlasWidth||s.width)||(n.atlasHeight||n.height)-(s.atlasHeight||s.height)}),this._btree=new Mi(new ki(0,0,this.canvas.getWidth(),this.canvas.getHeight())),this._btree.atlas=this,this.clearCanvas();let i=new Map;for(let s=0;s<t.length;s++)this._completeNode(i,this._btree.insert(t[s]));this.nodes=null,this.nodes=i}}get(e){return this.nodes.get(e)}set(e,t){this.nodes.set(e,t)}createTexture(e,t){this._handler&&(this._handler.gl.deleteTexture(this.texture),e&&(this.canvas.resize(e.width,e.height),this.canvas.drawImage(e,0,0,e.width,e.height)),this.texture=this._handler.createTexture_l(this.canvas.getCanvas(),t))}loadImage(e,t){this._imagesCacheManager.load(e,t)}getImageTexCoordinates(e){if(e.__nodeIndex!=null){let t=this.get(e.__nodeIndex);if(t)return t.texCoords}}}class Mi{constructor(e,t){this.childNodes=null,this.image=null,this.rect=e||new ki,this.texCoords=t||[],this.atlas=null}insert(e){if(this.childNodes)return this.childNodes[0].insert(e)||this.childNodes[1].insert(e);{if(this.image!=null)return;let t=this.rect;const i=(e.atlasWidth||e.width)+this.atlas.borderSize,s=(e.atlasHeight||e.height)+this.atlas.borderSize;return i>t.getWidth()||s>t.getHeight()?void 0:t.fit(i,s)?(this.image=e,this):(this.childNodes=new Array(2),this.childNodes[0]=new Mi,this.childNodes[0].atlas=this.atlas,this.childNodes[1]=new Mi,this.childNodes[1].atlas=this.atlas,t.getWidth()-i>t.getHeight()-s?(this.childNodes[0].rect.set(t.left,t.top,t.left+i,t.bottom),this.childNodes[1].rect.set(t.left+i,t.top,t.right,t.bottom)):(this.childNodes[0].rect.set(t.left,t.top,t.right,t.top+s),this.childNodes[1].rect.set(t.left,t.top+s,t.right,t.bottom)),this.childNodes[0].insert(e))}}}class co extends Nr{constructor(e,t){super(e,t),this.width=0,this.height=0,this.gliphSize=0,this.distanceRange=0,this.nodes=new Map,this.kernings={}}get(e){return this.nodes.get(e)}}class xc extends Mi{constructor(e,t){super(e,t),this.emptySize=1,this.metrics={id:0,char:"",width:0,height:0,x:0,y:0,chnl:0,index:0,page:0,xadvance:0,xoffset:0,yoffset:0,nChar:"",nCode:0,nWidth:0,nHeight:0,nAdvance:0,nXOffset:0,nYOffset:0}}}class bc{constructor(e){this.atlasesArr=[],this.atlasIndexes={},this.atlasIndexesDeferred={},this.tokenImageSize=64,this.samplerArr=new Uint32Array(11),this.sdfParamsArr=new Float32Array(44),this._handler=null,this.catalogSrc=e||"./"}assignHandler(e){this._handler=e}getFontIndex(e){let t=this.getFullIndex(e);return this.atlasIndexes[t]||this.loadFont(e,this.catalogSrc,`${e}.json`),this.atlasIndexesDeferred[t]||(this.atlasIndexesDeferred[t]=new gi),this.atlasIndexesDeferred[t].promise}getFullIndex(e){return e.trim().toLowerCase()}_applyFontDataToAtlas(e,t,i=0){let s=t.chars;e.height=t.common.scaleH,e.width=t.common.scaleW,e.gliphSize=t.info.size,e.distanceRange=t.distanceField.distanceRange;let n=e.width,o=e.height,l=e.gliphSize;this.sdfParamsArr[4*i]=n,this.sdfParamsArr[4*i+1]=o,this.sdfParamsArr[4*i+2]=l,this.sdfParamsArr[4*i+3]=e.distanceRange;let h={};for(let c=0;c<s.length;c++){let d=s[c],u=d.char;h[d.id]=u;let f=new ki(d.x,d.y,d.x+d.width,d.y+d.height),_=new Array(12);_[0]=f.left/n,_[1]=f.top/o,_[2]=f.left/n,_[3]=f.bottom/o,_[4]=f.right/n,_[5]=f.bottom/o,_[6]=f.right/n,_[7]=f.bottom/o,_[8]=f.right/n,_[9]=f.top/o,_[10]=f.left/n,_[11]=f.top/o;let g=new xc(f,_),v=d.char.normalize("NFKC"),p=v.charCodeAt(0),y=g.metrics;y.id=d.id,y.char=d.char,y.width=d.width,y.height=d.height,y.x=d.x,y.y=d.y,y.chnl=d.chnl,y.index=d.index,y.page=d.page,y.xadvance=d.xadvance,y.xoffset=d.xoffset,y.yoffset=d.yoffset,y.nChar=v,y.nCode=p,y.nWidth=g.metrics.width/l,y.nHeight=g.metrics.height/l,y.nAdvance=g.metrics.xadvance/l,y.nXOffset=g.metrics.xoffset/l,y.nYOffset=1-g.metrics.yoffset/l,g.emptySize=1,e.nodes.set(v.charCodeAt(0),g)}e.kernings={};for(let c=0;c<t.kernings.length;c++){let d=t.kernings[c],u=d.first,f=d.second;e.kernings[u]||(e.kernings[u]={}),e.kernings[u][f]=d.amount/l}}initFont(e,t,i){let s=this.atlasesArr.length,n=this.getFullIndex(e);this.atlasIndexes[n]=s;let o=this.atlasIndexesDeferred[n];o||(o=this.atlasIndexesDeferred[n]=new gi),this.samplerArr[this.atlasesArr.length]=s;let l=new co;l.height=0,l.width=0,l.gliphSize=0,l.distanceRange=0,l.kernings={},l.assignHandler(this._handler),this.atlasesArr[s]=l,this._applyFontDataToAtlas(l,t,s);let h=new Image;h.onload=()=>{this._createTexture(l,h),o.resolve(s)},h.src=i}_createTexture(e,t){e.createTexture(t)}loadFont(e,t,i){let s=this.atlasesArr.length,n=this.getFullIndex(e);this.atlasIndexes[n]=s;let o=this.atlasIndexesDeferred[n];o||(o=this.atlasIndexesDeferred[n]=new gi),this.samplerArr[this.atlasesArr.length]=s;let l=new co;l.height=0,l.width=0,l.gliphSize=0,l.distanceRange=0,l.kernings={},l.assignHandler(this._handler),this.atlasesArr[s]=l,fetch(`${t}/${i}`).then(h=>{if(!h.ok)throw Error(`Unable to load "${t}/${i}"`);return h.json()}).then(h=>{this._applyFontDataToAtlas(l,h,s);let c=new Image;c.onload=()=>{this._createTexture(l,c),o.resolve(s)},c.src=`${t}/${h.pages[0]}`,c.crossOrigin="Anonymous"}).catch(h=>(o.reject(),{status:"error",msg:h.toString()}))}}let wc=0,Tc=0,Ne=new Float32Array(2);class Cc{constructor(e,t={}){var i,s;if(this.div=null,this.handler=e instanceof Me?e:new Me(e,{pixelRatio:t.dpi||window.devicePixelRatio+.15,autoActivate:!0}),this.clearColor=new Float32Array(t.clearColor||[0,0,0,1]),this.exposure=t.exposure||3.01,this.gamma=t.gamma||.47,this.whitepoint=1,this.brightThreshold=.9,this._renderNodesArr=[],this.renderNodes={},this.activeCamera=new Li({width:(i=this.handler.canvas)==null?void 0:i.width,height:(s=this.handler.canvas)==null?void 0:s.height,eye:new m(0,0,0),look:new m(0,0,-1),up:new m(0,1,0)}),this.events=new mc(this),this.controls={},t.controls)for(let l in t.controls)this.controls[t.controls[l].name]=t.controls[l];this.controlsBag={},this.colorObjects=new Map,this._pickingCallbacks=[],this.pickingFramebuffer=null,this._depthCallbacks=[],this.depthFramebuffer=null,this._depthRefreshRequired=!1;let n=new URLSearchParams(location.search),o=n.get("og_msaa");this._msaa=o?Number(n.get("og_msaa")):t.msaa!=null?t.msaa:0,this._internalFormat="RGBA16F",this._format="RGBA",this._type="FLOAT",this.sceneFramebuffer=null,this.blitFramebuffer=null,this.toneMappingFramebuffer=null,this._initialized=!1,this.billboardsTextureAtlas=new Nr,this.fontAtlas=new bc(t.fontsSrc),this.strokeTextureAtlas=new Nr,this._entityCollections=[[]],this._currentOutput="screen",this._fnScreenFrame=null,this.labelWorker=new Xa(4),this.screenDepthFramebuffer=null,this.screenFramePositionBuffer=null,this.screenTexture={},this.outputTexture=null,this._readPickingBuffer=this._readPickingBuffer_webgl2,(t.autoActivate||Ut(t.autoActivate))&&this.start()}enableBlendOneSrcAlpha(){let e=this.handler.gl;e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)}enableBlendDefault(){let e=this.handler.gl;e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE)}setRelativeCenter(e){this.events.dispatch(this.events.changerelativecenter,e||this.activeCamera.eye)}setEventsActivity(e){this.events.active=e}addDepthCallback(e,t){let i=Tc++;return this._depthCallbacks.push({id:i,callback:t,sender:e}),i}removeDepthCallback(e){for(let t=0;t<this._depthCallbacks.length;t++)if(e===this._depthCallbacks[t].id){this._depthCallbacks.splice(t,1);break}}addPickingCallback(e,t){let i=wc++;return this._pickingCallbacks.push({id:i,callback:t,sender:e}),i}removePickingCallback(e){for(let t=0;t<this._pickingCallbacks.length;t++)if(e===this._pickingCallbacks[t].id){this._pickingCallbacks.splice(t,1);break}}getPickingObject(e,t,i){return this.colorObjects.get(`${e}_${t}_${i}`)}getPickingObjectArr(e){return this.colorObjects.get(`${e[0]}_${e[1]}_${e[2]}`)}getPickingObject3v(e){return this.colorObjects.get(`${e.x}_${e.y}_${e.z}`)}assignPickingColor(e){if(!e._pickingColor||e._pickingColor.isZero()){let t=0,i=0,s=0,n="0_0_0";for(;!(t||i||s)||this.colorObjects.has(n);)t=Oi(1,255),i=Oi(1,255),s=Oi(1,255),n=`${t}_${i}_${s}`;e._pickingColor?e._pickingColor.set(t,i,s):e._pickingColor=new m(t,i,s),e._pickingColorU=new Float32Array([t/255,i/255,s/255]),this.colorObjects.set(n,e)}}clearPickingColor(e){if(e._pickingColor&&!e._pickingColor.isZero()){let t=e._pickingColor;t.isZero()||(this.colorObjects.delete(`${t.x}_${t.y}_${t.z}`),t.x=t.y=t.z=0)}}getWidth(){return this.handler.canvas.clientWidth}getHeight(){return this.handler.canvas.clientHeight}getCenter(){let e=this.handler.canvas;return new N(Math.round(.5*e.width),Math.round(.5*e.height))}getClientCenter(){let e=this.handler.canvas;return new N(Math.round(.5*e.clientWidth),Math.round(.5*e.clientHeight))}addControl(e){e.addTo(this)}addControls(e){for(let t=0;t<e.length;t++)e[t].addTo(this)}removeControl(e){e.remove()}isInitialized(){return this._initialized}initialize(){if(!this._initialized){if(this._initialized=!0,this.handler.initialize(),this.billboardsTextureAtlas.assignHandler(this.handler),this.fontAtlas.assignHandler(this.handler),this.strokeTextureAtlas.assignHandler(this.handler),this.handler.setFrameCallback(()=>{this.draw()}),this.events.initialize(),this.events.on("charkeypress",Y.KEY_APOSTROPHE,function(){ee.setVisibility(!ee.getVisibility())}),this.handler.addProgram(new $("screenFrame",{uniforms:{texture:"sampler2d"},attributes:{corners:"vec3"},vertexShader:`attribute vec2 corners;
            
            varying vec2 tc;
            void main(void) {
                gl_Position = vec4(corners, 0.0, 1.0);
                tc = corners * 0.5 + 0.5;
            }`,fragmentShader:`precision highp float;
            uniform sampler2D texture;
            
            varying vec2 tc;
            
            void main(void) {
                gl_FragColor = texture2D( texture, tc );
            }`})),this.pickingFramebuffer=new St(this.handler,{width:640,height:480,targets:[{readAsync:!0}]}),this.pickingFramebuffer.init(),this.depthFramebuffer=new St(this.handler,{width:640,height:480,targets:[{internalFormat:"RGBA",type:"UNSIGNED_BYTE",attachment:"COLOR_ATTACHMENT",readAsync:!0},{internalFormat:"RGBA16F",type:"FLOAT",attachment:"COLOR_ATTACHMENT",readAsync:!0}],useDepth:!0}),this.depthFramebuffer.init(),this.screenDepthFramebuffer=new St(this.handler,{useDepth:!1}),this.screenDepthFramebuffer.init(),this.handler.gl.type==="webgl")this._readPickingBuffer=this._readPickingBuffer_webgl1,this.sceneFramebuffer=new St(this.handler),this.sceneFramebuffer.init(),this._fnScreenFrame=this._screenFrameNoMSAA,this.screenTexture={screen:this.sceneFramebuffer.textures[0],picking:this.pickingFramebuffer.textures[0],depth:this.screenDepthFramebuffer.textures[0]};else{let e=this.getMaxMSAA(this._internalFormat);this._msaa>e&&(this._msaa=e),this.handler.addPrograms([new $("toneMapping",{uniforms:{hdrBuffer:"sampler2d",exposure:"float",gamma:"float",whitepoint:"float"},attributes:{corners:"vec3"},vertexShader:`#version 300 es
in vec2 corners;out vec2 tc;void main(void){gl_Position=vec4(corners,0.0,1.0);tc=corners*0.5+0.5;}`,fragmentShader:`#version 300 es
precision highp float;
#ifndef saturate
#define saturate(a) clamp(a, 0.0, 1.0)
#endif
uniform sampler2D hdrBuffer;uniform float whitepoint;uniform float exposure;uniform float gamma;vec3 LinearToneMapping(vec3 color){return exposure*color;}vec3 ReinhardToneMapping2(vec3 color){return vec3(1.0)-exp(-color*exposure);}vec3 ReinhardToneMapping(vec3 color){color*=exposure;return saturate(color/(vec3(1.0)+color));}
#define Uncharted2Helper(x) max(((x * (0.15 * x + 0.10 * 0.50) + 0.20 * 0.02) / (x * (0.15 * x + 0.50) + 0.20 * 0.30)) - 0.02 / 0.30, vec3(0.0))
vec3 Uncharted2ToneMapping(vec3 color){color*=exposure;return saturate(Uncharted2Helper(color)/Uncharted2Helper(vec3(whitepoint)));}vec3 OptimizedCineonToneMapping(vec3 color){color*=exposure;color=max(vec3(0.0),color-0.004);return pow((color*(6.2*color+0.5))/(color*(6.2*color+1.7)+0.06),vec3(2.2));}vec3 ACESFilmicToneMapping(vec3 color){color*=exposure;return saturate((color*(2.51*color+0.03))/(color*(2.43*color+0.59)+0.14));}in vec2 tc;layout(location=0)out vec4 fragColor;void main(void){vec4 hdrColor=texture(hdrBuffer,tc);float oneByGamma=gamma/gamma;float oneByWhitePoint=whitepoint/whitepoint;vec3 mapped=ReinhardToneMapping2(hdrColor.rgb)*oneByGamma*oneByWhitePoint;mapped=pow(mapped,vec3(1.0/gamma));fragColor=vec4(mapped,hdrColor.a);}`})]),this.handler.addPrograms([new $("depth",{uniforms:{depthTexture:"sampler2D"},attributes:{corners:"vec2"},vertexShader:`#version 300 es
            
            in vec2 corners;
            
            out vec2 tc;

            void main(void) {
                gl_Position = vec4(corners, 0.0, 1.0);
                tc = corners * 0.5 + 0.5;
            }`,fragmentShader:`#version 300 es

            precision highp float;

            uniform sampler2D depthTexture;
           
            in vec2 tc;

            layout(location = 0) out vec4 fragColor;

            float LinearizeDepth(in vec2 uv)
            {
                return texture(depthTexture, tc).r;
            }
            
            void main(void) {
                float c = LinearizeDepth(tc);
                fragColor = vec4(c, c, c, 1.0);
            }`})]),this.sceneFramebuffer=new ba(this.handler,{size:1,msaa:this._msaa,internalFormat:this._internalFormat,filter:"LINEAR"}),this.sceneFramebuffer.init(),this.blitFramebuffer=new St(this.handler,{size:1,useDepth:!1,targets:[{internalFormat:this._internalFormat,format:this._format,type:this._type,filter:"NEAREST"}]}),this.blitFramebuffer.init(),this.toneMappingFramebuffer=new St(this.handler,{useDepth:!1}),this.toneMappingFramebuffer.init(),this._fnScreenFrame=this._screenFrameMSAA,this.screenTexture={screen:this.toneMappingFramebuffer.textures[0],picking:this.pickingFramebuffer.textures[0],depth:this.screenDepthFramebuffer.textures[0],frustum:this.depthFramebuffer.textures[0]}}this.handler.ONCANVASRESIZE=()=>{this._resizeStart(),this.events.dispatch(this.events.resize,this.handler.canvas),this._resizeEnd(),this.events.dispatch(this.events.resizeend,this.handler.canvas)},this.screenFramePositionBuffer=this.handler.createArrayBuffer(new Float32Array([1,1,-1,1,1,-1,-1,-1]),2,4),this.outputTexture=this.screenTexture.screen,this._initializeRenderNodes(),this._initializeControls()}}_initializeControls(){let e=this.controls;this.controls={};for(let t in e)this.addControl(e[t])}resize(){this._resizeEnd()}setCurrentScreen(e){this._currentOutput=e,this.screenTexture[e]&&(this.outputTexture=this.screenTexture[e])}_resizeStart(){let e=this.handler.canvas;this.activeCamera.setViewportSize(e.width,e.height),this.sceneFramebuffer.setSize(.5*e.width,.5*e.height),this.blitFramebuffer&&this.blitFramebuffer.setSize(.5*e.width,.5*e.height,!0)}_resizeEnd(){let e=this.handler.canvas;this.activeCamera.setViewportSize(e.width,e.height),this.sceneFramebuffer.setSize(e.width,e.height),this.blitFramebuffer&&this.blitFramebuffer.setSize(e.width,e.height,!0),this.toneMappingFramebuffer&&this.toneMappingFramebuffer.setSize(e.width,e.height,!0),this.screenDepthFramebuffer&&this.screenDepthFramebuffer.setSize(e.clientWidth,e.clientHeight,!0),this.handler.gl.type==="webgl"?(this.screenTexture.screen=this.sceneFramebuffer.textures[0],this.screenTexture.picking=this.pickingFramebuffer.textures[0],this.screenTexture.depth=this.screenDepthFramebuffer.textures[0],this.screenTexture.frustum=this.depthFramebuffer.textures[0]):(this.screenTexture.screen=this.toneMappingFramebuffer.textures[0],this.screenTexture.picking=this.pickingFramebuffer.textures[0],this.screenTexture.depth=this.screenDepthFramebuffer.textures[0],this.screenTexture.frustum=this.depthFramebuffer.textures[0]),this.setCurrentScreen(this._currentOutput)}removeNode(e){e.remove()}addNode(e){this.renderNodes[e.name]?ee.logWrn(`Node name ${e.name} already exists.`):(e.assign(this),this._renderNodesArr.unshift(e),this.renderNodes[e.name]=e)}_initializeRenderNodes(){for(let e=0;e<this._renderNodesArr.length;e++)this._renderNodesArr[e].initialize()}addNodeBefore(e,t){if(this.renderNodes[e.name])ee.logWrn(`Node name ${e.name} already exists.`);else{e.assign(this),this.renderNodes[e.name]=e;for(let i=0;i<this._renderNodesArr.length;i++)if(this._renderNodesArr[i].isEqual(t)){this._renderNodesArr.splice(i,0,e);break}this._renderNodesArr.unshift(e)}}addNodes(e){for(let t=0;t<e.length;t++)this.addNode(e[t])}getMaxMSAA(e){let t=this.handler.gl;return t.getInternalformatParameter(t.RENDERBUFFER,t[e],t.SAMPLES)[0]}getMSAA(){return this._msaa}enqueueEntityCollectionsToDraw(e,t=0){this._entityCollections[t]||(this._entityCollections[t]=[]),this._entityCollections[t].push(...e)}markForDepthRefresh(){this._depthRefreshRequired=!0}_drawEntityCollections(e){let t=this._entityCollections[e];if(t.length){let i=this.handler.gl;this.enableBlendDefault();let s=t.length;for(;s--;)t[s]._fadingOpacity&&t[s].pointCloudHandler.draw();for(s=t.length;s--;){let o=t[s];t[s]._fadingOpacity&&(o.events.dispatch(o.events.draw,o),t[s].geoObjectHandler.draw())}for(i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.billboardsTextureAtlas.texture),s=t.length;s--;){let o=t[s];o._fadingOpacity&&o.billboardHandler.draw()}let n=this.fontAtlas.atlasesArr;for(s=0;s<n.length;s++)i.activeTexture(i.TEXTURE0+s),i.bindTexture(i.TEXTURE_2D,n[s].texture);for(s=t.length;s--;)t[s]._fadingOpacity&&t[s].labelHandler.draw();for(i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.strokeTextureAtlas.texture),s=t.length;s--;)t[s]._fadingOpacity&&t[s].rayHandler.draw();for(s=t.length;s--;)t[s]._fadingOpacity&&t[s].polylineHandler.draw();for(s=t.length;s--;)t[s]._fadingOpacity&&t[s].stripHandler.draw()}}_drawPickingEntityCollections(e){let t=this._entityCollections[e];if(t.length){let i=t.length;for(;i--;)t[i]._fadingOpacity&&t[i].billboardHandler.drawPicking();for(i=t.length;i--;)t[i]._fadingOpacity&&t[i].geoObjectHandler.drawPicking();for(i=t.length;i--;)t[i]._fadingOpacity&&t[i].labelHandler.drawPicking();for(i=t.length;i--;)t[i]._fadingOpacity&&t[i].rayHandler.drawPicking();for(i=t.length;i--;)t[i]._visibility&&t[i].polylineHandler.drawPicking();for(i=t.length;i--;)t[i]._visibility&&t[i].stripHandler.drawPicking()}}_drawDepthEntityCollections(e){let t=this._entityCollections[e];if(t.length){let i=t.length;for(;i--;)t[i]._fadingOpacity&&t[i].geoObjectHandler.drawDepth()}}_clearEntityCollectionQueue(e){this._entityCollections[e].length=0,this._entityCollections[e]=[]}draw(){this.activeCamera.checkMoveEnd();let e=this.events,t=e.pointerEvent(),i=!e.mouseState.leftButtonDown&&!e.mouseState.rightButtonDown,s=e.touchState.touchStart||e.touchState.touchEnd;const n=t&&i||s||this._depthRefreshRequired;this._depthRefreshRequired=!1,e.handleEvents();let o=this.sceneFramebuffer;o.activate();let l=this.handler.gl;l.clearColor(this.clearColor[0],this.clearColor[1],this.clearColor[2],this.clearColor[3]),l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT),this.enableBlendDefault(),e.dispatch(e.draw,this),this.activeCamera.checkFly();let h=this.activeCamera.frustums,c=this._renderNodesArr,d=h.length;for(;d--;){this.activeCamera.setCurrentFrustum(d),l.clear(l.DEPTH_BUFFER_BIT);let u=c.length;for(;u--;)c[u].preDrawNode();for(u=c.length;u--;)this.enableBlendDefault(),c[u].drawNode();this._drawEntityCollections(0),e.dispatch(e.drawtransparent,this),n&&this._drawPickingBuffer(0),this._drawDepthBuffer(0),this._clearEntityCollectionQueue(0)}for(let u=1;u<this._entityCollections.length;u++){l.clear(l.DEPTH_BUFFER_BIT);let f=h.length;for(;f--;)this.activeCamera.setCurrentFrustum(f),this._drawEntityCollections(u),n&&this._drawPickingBuffer(u),this._drawDepthBuffer(u);this._clearEntityCollectionQueue(u)}o.deactivate(),this.blitFramebuffer&&o.blitTo(this.blitFramebuffer,0),n&&(this._readPickingBuffer(),this._readDepthBuffer()),this._fnScreenFrame(),e.dispatch(e.postdraw,this),e.mouseState.wheelDelta=0,e.mouseState.justStopped=!1,e.mouseState.moving=!1,e.touchState.moving=!1}getImageDataURL(e="image/png",t=1){return this.draw(),this.handler.canvas?this.handler.canvas.toDataURL(e,t):""}_screenFrameMSAA(){let e=this.handler,t=e.programs.toneMapping,i=t._program,s=e.gl;s.disable(s.DEPTH_TEST),s.bindBuffer(s.ARRAY_BUFFER,this.screenFramePositionBuffer),s.vertexAttribPointer(i.attributes.corners,2,s.FLOAT,!1,0,0),this.toneMappingFramebuffer.activate(),s.clearColor(0,0,0,0),s.clear(s.COLOR_BUFFER_BIT),t.activate(),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.blitFramebuffer.textures[0]),s.uniform1i(i.uniforms.hdrBuffer,0),s.uniform1f(i.uniforms.gamma,this.gamma),s.uniform1f(i.uniforms.exposure,this.exposure),s.uniform1f(i.uniforms.whitepoint,this.whitepoint),s.drawArrays(s.TRIANGLE_STRIP,0,4),this.toneMappingFramebuffer.deactivate(),t=e.programs.screenFrame,i=t._program,t.activate(),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.outputTexture),s.uniform1i(i.uniforms.texture,0),s.drawArrays(s.TRIANGLE_STRIP,0,4),s.enable(s.DEPTH_TEST)}_screenFrameNoMSAA(){let e=this.handler,t=e.programs.screenFrame,i=t._program,s=e.gl;s.disable(s.DEPTH_TEST),t.activate(),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.outputTexture),s.uniform1i(i.uniforms.texture,0),s.bindBuffer(s.ARRAY_BUFFER,this.screenFramePositionBuffer),s.vertexAttribPointer(i.attributes.corners,2,s.FLOAT,!1,0,0),s.drawArrays(s.TRIANGLE_STRIP,0,4),s.enable(s.DEPTH_TEST)}_drawPickingBuffer(e){this.pickingFramebuffer.activate();let t=this.handler.gl;if(this.activeCamera.isFirstPass&&e===0?(t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)):t.clear(t.DEPTH_BUFFER_BIT),t.disable(t.BLEND),e===0){let i=this._pickingCallbacks;for(let s=0,n=i.length;s<n;s++)i[s].callback.call(i[s].sender)}this._drawPickingEntityCollections(e),t.enable(t.BLEND),this.pickingFramebuffer.deactivate()}_drawDepthBuffer(e){this.depthFramebuffer.activate();let t=this.handler,i=t.gl;if(i.disable(i.BLEND),this.activeCamera.isFirstPass&&e===0?(i.clearColor(0,0,0,1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)):i.clear(i.DEPTH_BUFFER_BIT),e===0){let s=this._depthCallbacks,n=s.length;for(;n--;)s[n].callback.call(s[n].sender)}if(this._drawDepthEntityCollections(e),this.depthFramebuffer.deactivate(),this._currentOutput==="depth"||this._currentOutput==="frustum"){this.screenDepthFramebuffer.activate();let s=t.programs.depth,n=s._program;i.bindBuffer(i.ARRAY_BUFFER,this.screenFramePositionBuffer),i.vertexAttribPointer(n.attributes.corners,2,i.FLOAT,!1,0,0),s.activate(),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.depthFramebuffer.textures[1]),i.uniform1i(n.uniforms.depthTexture,0),i.drawArrays(i.TRIANGLE_STRIP,0,4),this.screenDepthFramebuffer.deactivate()}i.enable(i.BLEND)}_readDepthBuffer(e){this.depthFramebuffer.readPixelBuffersAsync(e)}_readPickingBuffer_webgl1(){this.pickingFramebuffer.readPixelBuffersAsync()}_readPickingBuffer_webgl2(){this.pickingFramebuffer.readPixelBuffersAsync()}readPickingColor(e,t,i){var s;let n=this.pickingFramebuffer.width,o=this.pickingFramebuffer.height;e=Math.round(e*n);let l=4*((t=Math.round(t*o))*n+e),h=(s=this.pickingFramebuffer)==null?void 0:s.pixelBuffers[0].data;h&&(i[0]=h[l],i[1]=h[l+1],i[2]=h[l+2])}readDepth(e,t,i){let s=new Float32Array(4),n=new Uint8Array(4);this.depthFramebuffer.readData(e,t,n,0),this.depthFramebuffer.readData(e,t,s,1),i[0]=s[0],i[1]=Math.round(n[0]/10)-1}getDistanceFromPixel(e){let t=this.activeCamera,i=this.handler.canvas,s=e.x/i.width,n=(i.height-e.y)/i.height;if(Ne[0]=Ne[1]=0,this.readDepth(s,n,Ne),Ne[1]===-1)return;let o=Ne[0],l=t.frustums[Ne[1]];if(!l)return;let h=new tt(2*s-1,2*n-1,2*o-1,1),c=l.inverseProjectionMatrix.mulVec4(h),d=-c.z/c.w;if(t.isOrthographic)return d;let u=e.direction||t.unproject(e.x,e.y);return d/Math.max(1e-6,u.dot(t.getForward()))}getCartesianFromPixel(e){let t=this.getDistanceFromPixel(e);if(t){if(this.activeCamera.isOrthographic){let i=new m;return this.activeCamera.unproject(e.x,e.y,t,i),i}return(e.direction||this.activeCamera.unproject(e.x,e.y)).scaleTo(t).addA(this.activeCamera.eye)}}getCartesianFromPixelAsync(e){return new Promise((t,i)=>{this._readDepthBuffer(()=>{t(this.getCartesianFromPixel(e))})})}getDepthMinDistance(){let e=this.handler.canvas,t=e.width,i=e.height,s=rr,n=i*t,o=new N;for(let l=0;l<n;l++){o.x=l%t,o.y=Math.floor(l/t);let h=this.getDistanceFromPixel(o);h&&h<s&&(s=h)}return s<rr?s:0}getDepthMinDistanceAsync(){return new Promise((e,t)=>{this._readDepthBuffer(()=>{e(this.getDepthMinDistance())})})}async setOrthographicProjection(e){if(e!==this.activeCamera.isOrthographic){let t=await this.getDepthMinDistanceAsync();t&&e&&(this.activeCamera.focusDistance=t),this.activeCamera.isOrthographic=e,this.events.dispatch(this.events.projchanged,this.activeCamera)}}start(){this._initialized||this.initialize(),this.handler.start()}destroy(){this.labelWorker.destroy();for(let e in this.controls)this.controls[e].remove();for(let e=0;e<this._renderNodesArr.length;e++)this._renderNodesArr[e].remove();this.div=null,this._renderNodesArr=[],this.renderNodes={},this.controls={},this.controlsBag={},this.colorObjects.clear(),this._pickingCallbacks=[],this.pickingFramebuffer=null,this._tempPickingPix_=null,this._depthCallbacks=[],this.depthFramebuffer=null,this.sceneFramebuffer=null,this.blitFramebuffer=null,this.toneMappingFramebuffer=null,this._entityCollections=[[]],this.handler.ONCANVASRESIZE=null,this.handler.destroy(),this._initialized=!1}}const uo="/res",qe=class p0{constructor(e){this.$target=null,this._instanceID=`__globus${p0.__counter__++?p0.__counter__:""}__`,window[this._instanceID]=this,this._canvas=document.createElement("canvas"),this._canvas.id=`canvas${this._instanceID}`,this._canvas.style.width="100%",this._canvas.style.height="100%",this._canvas.style.display="block",this._canvas.style.opacity="0.0",this._canvas.style.transition="opacity 150ms",this.$inner=document.createElement("div"),this.$inner.classList.add("og-inner"),this.$inner.appendChild(this._canvas),this.$inner.attributions=document.createElement("div"),e.attributionContainer?e.attributionContainer.appendChild(this.$inner.attributions):(this.$inner.attributions.classList.add("og-attribution"),this.$inner.appendChild(this.$inner.attributions)),e.target&&this.attachTo(e.target);const t=l=>{l.preventDefault()};this._canvas.onmouseenter=function(){document.addEventListener("mousewheel",t,{capture:!1,passive:!1})},this._canvas.onmouseleave=function(){document.removeEventListener("mousewheel",t)},this.renderer=new Cc(new Me(this._canvas,{autoActivate:!1,pixelRatio:e.dpi||window.devicePixelRatio+.15,context:{alpha:e.transparentBackground,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1}}),{autoActivate:!1,msaa:e.msaa,fontsSrc:e.fontsSrc,gamma:e.gamma,exposure:e.exposure,...e.transparentBackground&&{clearColor:[0,0,0,0]}}),this.renderer.div=this.$inner,e.skybox&&this.renderer.addNode(e.skybox),this._planetName=e.name?e.name:"globus_planet_"+p0.__counter__,this.planet=new Si({name:this._planetName,frustums:e.frustums,ellipsoid:e.ellipsoid,maxGridSize:e.maxGridSize,nightTextureSrc:e.nightTextureSrc===null?null:e.nightTextureSrc||`${e.resourcesSrc||uo}/night.png`,specularTextureSrc:e.specularTextureSrc===null?null:e.specularTextureSrc||`${e.resourcesSrc||uo}/spec.png`,minAltitude:e.minAltitude,maxAltitude:e.maxAltitude||15e6,maxEqualZoomAltitude:e.maxEqualZoomAltitude,minEqualZoomAltitude:e.minEqualZoomAltitude,minEqualZoomCameraSlope:e.minEqualZoomCameraSlope,quadTreeStrategyPrototype:e.quadTreeStrategyPrototype,maxLoadingRequests:e.maxLoadingRequests,atmosphereEnabled:e.atmosphereEnabled,transitionOpacityEnabled:e.transitionOpacityEnabled,atmosphereParameters:e.atmosphereParameters,minDistanceBeforeMemClear:e.minDistanceBeforeMemClear,vectorTileSize:e.vectorTileSize,maxNodesCount:e.maxNodesCount,transparentBackground:e.transparentBackground}),e.terrain?Array.isArray(e.terrain)?this.planet.setTerrain(e.terrain[0]):this.planet.setTerrain(e.terrain):this.planet.setTerrain(new Ri),this.renderer.addNode(this.planet),e.controls?this.planet.addControls(e.controls):this.planet.addControls([new ga,new qi,new fa,new ha,new ua,new Oo,new zr]);const i=this.renderer.controls;let s,n;for(let l in i)i[l]instanceof Ir&&(s=i[l]),i[l]instanceof qi&&(n=i[l]);s?this.sun=s:(this.sun=new Ir,this.planet.addControl(this.sun)),e.sun&&(e.sun.active===void 0||e.sun.active||this.sun.deactivate(),e.sun.stopped===!0&&this.sun.stop()),n?this.navigation=n:(this.navigation=new qi,this.planet.addControl(this.navigation)),e.navigation&&(e.navigation.active===void 0||e.navigation.active||this.navigation.deactivate(),e.navigation.inertia!==void 0&&(this.navigation.inertia=e.navigation.inertia),e.navigation.dragInertia!==void 0&&(this.navigation.dragInertia=e.navigation.dragInertia),e.navigation.minSlope!==void 0&&(this.navigation.minSlope=e.navigation.minSlope),e.navigation.mass!==void 0&&(this.navigation.mass=e.navigation.mass),e.navigation.zoomSpeed!==void 0&&(this.navigation.zoomSpeed=e.navigation.zoomSpeed),e.navigation.mode!==void 0&&this.navigation.setMode(e.navigation.mode),e.navigation.poleThreshold!==void 0&&(this.navigation.poleThreshold=e.navigation.poleThreshold),e.navigation.disableRotation!==void 0&&(this.navigation.disableRotation=e.navigation.disableRotation),e.navigation.disableTilt!==void 0&&(this.navigation.disableTilt=e.navigation.disableTilt)),e.layers&&this.planet.addLayers(e.layers);let o=e.viewExtent;o&&(o instanceof Array?this.planet.viewExtentArr(o):this.planet.viewExtent(o)),(e.autoActivate||Ut(e.autoActivate))&&this.start()}start(){this.renderer.start(),this.fadeIn()}fadeIn(){this._canvas.style.opacity="1.0"}fadeOut(){this._canvas.style.opacity="0"}attachTo(e,t){let i;this.detach(),i=e instanceof HTMLElement?e:document.getElementById(e)||document.querySelector(e),i?(this.$target=i,t&&this.$target.firstChild?this.$target.insertBefore(this.$inner,this.$target.firstChild):i.appendChild(this.$inner)):console.warn(`Target container not found. Provided target: ${e}`)}detach(){this.$target&&(this.$target.removeChild(this.$inner),this.$target=null)}destroy(){this.detach(),this.planet.layers.forEach(e=>e.remove()),this.planet.destroy(),this.renderer.destroy(),window[this._instanceID]=null}};qe.__counter__=0;let _o=qe;new Gr(3396200,3389508);new Gr(1737400,1737400);var be=(a=>(a[a.byte=5120]="byte",a[a.ubyte=5121]="ubyte",a[a.short=5122]="short",a[a.ushort=5123]="ushort",a[a.uint=5125]="uint",a[a.float=5126]="float",a))(be||{}),_e=(a=>(a.scalar="SCALAR",a.vec2="VEC2",a.vec3="VEC3",a.vec4="VEC4",a.mat2="MAT2",a.mat3="MAT3",a.mat4="MAT4",a))(_e||{}),Hr=(a=>(a[a.points=0]="points",a[a.lines=1]="lines",a[a.lineLoop=2]="lineLoop",a[a.lineStrip=3]="lineStrip",a[a.triangles=4]="triangles",a[a.triangleStrip=5]="triangleStrip",a[a.triangleFan=6]="triangleFan",a))(Hr||{});const createMapPool=(a,e,t)=>{const s=getFlatLayersArray(e.map.getLayers().getArray()).filter(n=>n.get("type")!=="Group").map(n=>n.get("_jsonDefinition")).filter(Boolean);return Array.from({length:a},()=>{const n=document.createElement("eox-map");return Object.assign(n.style,{width:"256px",height:"256px",position:"absolute",top:"-9999px",left:"-9999px"}),Object.assign(n,{projection:"EPSG:3857",layers:s}),t.appendChild(n),{tileMap:n,tileQueue:[],loadNextTile(){const o=this.tileQueue[0];requestTileFromMap(n,o.layerId,o,this)}}})};async function requestTileFromMap(a,e,t,i){const s=a.map;if(!s){a.addEventListener("mapmounted",()=>requestTileFromMap(a,e,t,i),{once:!0});return}s.getLayers().forEach(l=>{l.setVisible(l.get("id")===e)});const o=createXYZ().getTileCoordExtent([t.tile.z,t.tile.x,t.tile.y]);s.getView().fit(o,{callback:()=>{s.once("rendercomplete",function(){const l=document.createElement("canvas"),h=s.getSize();l.width=h[0],l.height=h[1];const c=l.getContext("2d");Array.prototype.forEach.call(s.getViewport().querySelectorAll(".ol-layer canvas, canvas.ol-layer"),function(d){if(d.width>0){const u=d.parentNode.style.opacity||d.style.opacity;c.globalAlpha=u===""?1:Number(u);let f;const _=d.style.transform;_?f=_.match(/^matrix\(([^(]*)\)$/)[1].split(",").map(Number):f=[parseFloat(d.style.width)/d.width,0,0,parseFloat(d.style.height)/d.height,0,0],CanvasRenderingContext2D.prototype.setTransform.apply(c,f);const g=d.parentNode.style.backgroundColor;g&&(c.fillStyle=g,c.fillRect(0,0,d.width,d.height)),c.drawImage(d,0,0)}}),c.globalAlpha=1,c.setTransform(1,0,0,1,0,0),t.callback(l),i.tileQueue.shift(),i.tileQueue.length&&i.loadNextTile()}),s.renderSync()}})}function distributeTileToIdealMap(a,e,t,i){const{x:s,y:n,z:o}=t,l={layerId:e,tile:t,callback:i};let h=0,c=null;for(let d=0;d<a.length;d++){const u=a[d];if(!u.tileQueue.length){c=u;break}const f=u.tileQueue[u.tileQueue.length-1],_=Math.abs(f.tile.x-s)+Math.abs(f.tile.y-n)+Math.abs(f.tile.z-o);(h===0||_<h)&&(h=_,c=u)}return c.tileQueue.push(l),c}let globus;const createGlobe=({EOxMap:a,target:e,mapPool:t})=>{globus=new _o({target:e,layers:a.getFlatLayersArray(a.map.getLayers().getArray()).filter(l=>l.get("type")!=="Group").map(l=>createGlobusLayer(l,t)).filter(l=>l!==void 0),sun:{active:!1},atmosphereEnabled:!1,transparentBackground:!0,resourcesSrc:"https://cdn.jsdelivr.net/npm/@openglobus/og@0.27.21/lib/res",fontsSrc:"https://cdn.jsdelivr.net/npm/@openglobus/og@0.27.21/lib/res/fonts"});const i=2105e4/Math.pow(2,a.map.getView().getZoom()-1),s=a.map.getView().getCenter(),n=transform(s,a.map.getView().getProjection().getCode(),"EPSG:4326");globus.planet.camera.setLonLat(new A(n[0],n[1],i),new A(n[0],n[1],0),m.NORTH);const o=document.createElement("style");return o.textContent=`
    .og-inner {
      height: 100%;
    }
    .og-inner *:not(canvas) {
      display: none !important;
    }
  `,e.appendChild(o),globus},refreshGlobe=()=>{globus&&globus.planet.layers.forEach(a=>{a instanceof is&&(a.abortLoading(),a.animated=!0,setTimeout(()=>a.animated=!1,200))})},createGlobusLayer=(a,e)=>{const t=a.getSource&&a.getSource(),i=a.get("id");if(t instanceof OSM)return new dc(i,{isBaseLayer:a.get("base"),visibility:a.getVisible(),opacity:a.getOpacity()});if(t instanceof XYZ)return new zs(i,{isBaseLayer:a.get("base"),url:t.getUrls()[0],visibility:a.getVisible(),opacity:a.getOpacity()});if(t instanceof TileWMS){const s=t.getParams(),o=t.getUrls()[0],l=s.LAYERS||s.layers||"default";return new pe(i,{isBaseLayer:a.get("base"),layers:l,url:o,visibility:a.getVisible(),opacity:a.getOpacity(),version:s.VERSION||s.Version||"1.1.1",extra:{...s}})}if(t instanceof VectorSource&&t.getUrl()){let s;if(fetch(t.getUrl().toString()).then(n=>n.json()).then(n=>{const o=n.crs;if(o&&(o.type=="name"?s=get(o.properties.name):o.type==="EPSG"&&(s=get("EPSG:"+o.properties.code))),s&&equivalent(s,get("EPSG:4326"))||!o){const c=globus.planet.getLayerByName(i);c&&globus.planet.removeLayer(c);const d=new ut(i,{visibility:a.getVisible(),opacity:a.getOpacity(),isBaseLayer:a.get("base")});d.addTo(globus.planet);var l=n.features;for(let u=0;u<l.length;u++){var h=l[u];d.add(new U({geometry:{type:h.geometry.type,coordinates:h.geometry.coordinates}}))}return d}else return}),s&&equivalent(s,get("EPSG:4326")))return}return new is(i,{opacity:a.getOpacity(),visibility:a.getVisible(),async drawTile(s,n){if(!s.segment)return;const o={x:s.segment.tileX,y:s.segment.tileY,z:s.segment.tileZoom},l=distributeTileToIdealMap(e,a.get("id"),o,h=>{var c;(c=s.segment)!=null&&c.initialized&&n(h)});l.tileQueue.length===1&&l.loadNextTile()}})},enableGlobe=a=>{var e;if(a.shadowRoot){let t=a.shadowRoot.querySelector("#globe");t||(t=document.createElement("div"),t.id="globe",t.style.width="100%",t.style.height="100%",t.style.display="block",(e=a.renderRoot)==null||e.appendChild(t)),a.registerProjectionFromCode("EPSG:3857"),a.globe=window.eoxMapGlobe.create({EOxMap:a,target:t}),a.shadowRoot.querySelector("#map").style.display="none",a.globeEnabled=!0}},disableGlobe=a=>{if(a.globe){const e=a.globe,t=e.planet;let i=t.getCartesianFromPixelTerrain(e.renderer.handler.getCenter());const s=i?i.normal().scaleTo(i.length()+i.distance(t.camera.eye)):t.camera.eye;t.flyCartesian(s,{amplitude:0,completeCallback:()=>{i&&t.camera.look(i);const n=e.planet.camera.getLonLat(),o=Math.log2(2105e4/n.height)+1,l=[n.lon,n.lat],h=transform(l,"EPSG:4326",a.OLprojection);a.map.getView().setCenter(h),a.map.getView().setZoom(o),a.globe=null;const c=a.shadowRoot.querySelector("#globe");c&&(c.style.display="none",c.remove());const d=a.shadowRoot.querySelector("#map");d&&(d.style.display=""),a.globeEnabled=!1}})}};function debounce(a,e){let t;return function(...s){const n=()=>{clearTimeout(t),a(...s)};clearTimeout(t),t=setTimeout(n,e)}}const setupLayerListeners=(a,e,t)=>{const i=debounce(()=>{refreshGlobe()},200);a.on("change",()=>{if(a.styleVariables_){const s=a.get("id"),n=a.styleVariables_;if(!s||!n)return;t.forEach(o=>{o.tileQueue.length=0;const l=getLayerById(o.tileMap,s);l&&l.updateStyleVariables&&l.updateStyleVariables(n)}),i()}}),a.on("propertychange",({key:s})=>{const n=e.planet.getLayerByName(a.get("id"));if(n)switch(s){case"visible":n.setVisibility(a.getVisible());break;case"opacity":n.opacity=a.getOpacity();break}})},processLayers=(a,e,t)=>{a.forEach(i=>{i.get("id")&&setupLayerListeners(i,e,t),i.getLayers&&processLayers(i.getLayers().getArray(),e,t)})};addCommonStylesheet();var l0,o0,i0,h0,c0,d0,u0,f0,g0,r0,Ds;class EOxMap extends r$1{constructor(){super();Rt(this,l0);Rt(this,o0);Rt(this,i0);Rt(this,h0);Rt(this,c0);Rt(this,d0);Rt(this,u0);Rt(this,f0,[0,0]);Rt(this,g0,0);Rt(this,r0,!1);Rt(this,Ds,"EPSG:3857");this.map=new Map$1({controls:[],interactions:defaults({altShiftDragRotate:!1,pinchRotate:!1}),layers:[],view:new View({center:[0,0],zoom:0,projection:st(this,Ds)})}),this.interactions={},this.selectInteractions={},this.mapControls={},this.globe=null}static get properties(){return{map:{attribute:!1,state:!0},config:{attribute:!1,type:Object},center:{attribute:!1,type:Array},layers:{attribute:!1,type:Array},zoom:{attribute:!1,type:Number},animationOptions:{attribute:!1,type:Object},controls:{attribute:!1,type:Object},interactions:{attribute:!1,type:Object},lonLatCenter:{attribute:!1,type:Array},lonLatExtent:{attribute:!1,type:Array},mapControls:{attribute:!1,state:!0,type:Object},preventScroll:{attribute:"prevent-scroll",type:Boolean},projection:{attribute:"projection",type:String},selectInteractions:{attribute:!1,state:!0,type:Object},sync:{attribute:"sync",type:String},zoomExtent:{attribute:!1,type:Array}}}set center(t){const i=setCenterMethod(t,this);i!==void 0&&(Ot(this,f0,i),animateToStateMethod(this))}get center(){return st(this,f0)}set config(t){Ot(this,c0,setConfigMethod(t,this))}get config(){return st(this,c0)}get lonLatCenter(){return getLonLatCenterMethod(this)}get lonLatExtent(){return getLonLatExtentMethod(this)}set zoom(t){t!==void 0&&(Ot(this,g0,t),animateToStateMethod(this))}get zoom(){return st(this,g0)}set zoomExtent(t){Ot(this,l0,setZoomExtentMethod(t,this))}get zoomExtent(){return getZoomExtentMethod(this)}set controls(t){Ot(this,o0,setControlsMethod(t,st(this,o0),this))}get controls(){return st(this,o0)}set layers(t){Ot(this,i0,setLayersMethod(t,st(this,i0),this)),this.dispatchEvent(new CustomEvent("layerschanged",{detail:{layers:st(this,i0)}}))}get layers(){return st(this,i0)}set preventScroll(t){Ot(this,h0,setPreventScrollMethod(t,this))}get preventScroll(){return st(this,h0)}set animationOptions(t){Ot(this,d0,t)}get animationOptions(){return st(this,d0)}set projection(t){t==="globe"?(st(this,Ds)!=="EPSG:3857"&&Ot(this,Ds,setProjectionMethod("EPSG:3857",st(this,Ds),this)),setTimeout(()=>{enableGlobe(this)})):(st(this,r0)&&setTimeout(()=>{disableGlobe(this)}),Ot(this,Ds,setProjectionMethod(t,st(this,Ds),this)))}get projection(){return st(this,r0)?"globe":st(this,Ds)}get OLprojection(){return st(this,Ds)}get globeEnabled(){return st(this,r0)}set globeEnabled(t){Ot(this,r0,t)}set sync(t){Ot(this,u0,setSyncMethod(t,this))}get sync(){return st(this,u0)}addOrUpdateLayer(t){return addOrUpdateLayerMethod(t,this)}removeInteraction(t){removeInteractionMethod(t,this)}removeSelect(t){removeSelectMethod(t,this)}removeControl(t){removeControlMethod(t,this)}getLayerById(t){return getLayerById(this,t)}firstUpdated(){firstUpdatedMethod(st(this,l0),this)}parseFeature(t){return parseFeature(t)}parseTextToFeature(t,i,s,n,o){parseTextToFeature(t,i,s,n,o)}registerProjectionFromCode(t){return registerProjectionFromCode(t)}registerProjection(t,i,s=void 0){registerProjection(t,i,s)}getFlatLayersArray(t){return getFlatLayersArray(t)}render(){return x`
      <style>
        :host {
          display: block;
          height: 100%;
        }
        .eox-map-tooltip {
          pointer-events: none !important;
        }
        ${olCss}
        ${eoxStyle}
        ${controlCss}
      </style>
      <div id="map" style="width: 100%; height: 100%"></div>
      <slot></slot>
    `}}l0=new WeakMap,o0=new WeakMap,i0=new WeakMap,h0=new WeakMap,c0=new WeakMap,d0=new WeakMap,u0=new WeakMap,f0=new WeakMap,g0=new WeakMap,r0=new WeakMap,Ds=new WeakMap;customElements.define("eox-map",EOxMap);const main=Object.freeze(Object.defineProperty({__proto__:null,EOxMap,buffer,transform,transformExtent},Symbol.toStringTag,{value:"Module"}));export{createGlobe as a,createMapPool as c,main as m,processLayers as p,refreshGlobe as r,transformExtent as t};
