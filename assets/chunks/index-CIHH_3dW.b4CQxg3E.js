const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/chunks/raw.DxtaBMev.js","assets/chunks/basedecoder.B2c5_Eok.js","assets/chunks/lzw.BikwkTY2.js","assets/chunks/jpeg.CbvpOiPg.js","assets/chunks/deflate.B4_27dB1.js","assets/chunks/pako.esm.BkaqWuDM.js","assets/chunks/packbits.D6Qr5eNi.js","assets/chunks/lerc.azU1oScZ.js","assets/chunks/commonjsHelpers.BosuxZz1.js","assets/chunks/main.DmoTgZ8-.js","assets/chunks/lit-element.Deg-YTNa.js","assets/chunks/Group.DOXtryoE.js","assets/chunks/getElement.BTPto6G5.js","assets/chunks/GeoJSON.CclkGaeh.js","assets/chunks/mustache.B8xfPrro.js","assets/chunks/framework.BD9sBbGn.js","assets/chunks/eo-dash.D_7lCkWe.js","assets/chunks/webimage.CU41Mh7j.js"])))=>i.map(i=>d[i]);
var hh=Object.defineProperty;var fh=(r,e,t)=>e in r?hh(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var le=(r,e,t)=>fh(r,typeof e!="symbol"?e+"":e,t);import{g as dh,C as ph,V as Ds,S as Yn,a as Xn,T as aa,F as qn,R as jt,b as fn,I as zl,c as Ht,X as bi,m as V,d as $,p as O,e as Kn,f as gh,h as Dt,i as H,j as T,w as ee,k as _e,l as Ye,O as Ar,r as Mt,n as Qr,o as kl,q as Jn,s as Qn,t as D,u as b,v as Us,x as F,y as $l,z as ei,A as Ti,B as De,D as Xt,E as mh,G as Te,H as ue,J as nt,K as mt,L as _h,M as Vl,N as yh,P as xh,Q as Eh,U as Gi,W as Nt,Y as Bt,Z as wi,_ as Q,$ as Bs,a0 as ot,a1 as bh,a2 as Gs,a3 as ss,a4 as os,a5 as Gt,a6 as Th,a7 as as,a8 as Xl,a9 as hr,aa as en,ab as wh,ac as Sh,ad as pe,ae as zs,af as tn,ag as Xe,ah as zt,ai as Pr,aj as Rh,ak as Z,al as vh,am as Ah,an as Ph,ao as Lh,ap as Wl,aq as jl,ar as ks,as as Ih,at as Ch,au as Fh,av as $s,aw as ti,ax as Hl,ay as Ct,az as dn,aA as pn,aB as Vs,aC as rn,aD as Oh,aE as Mh,aF as Nh,aG as Dh,aH as Uh,aI as Si,aJ as Bh,aK as Gh,aL as zi,aM as Ri,aN as ls,aO as Zl,aP as Lr,aQ as Yl,aR as ri,aS as la,aT as tr,aU as Xs,aV as zh,aW as ql,aX as vi,aY as kh,aZ as Ws,a_ as $h,a$ as Vh,b0 as Xh,b1 as Kl,b2 as Wh,b3 as jh,b4 as Hh,b5 as Zh,b6 as Jl,b7 as Yh,b8 as Ql,b9 as qh,ba as Kh,bb as Jh,bc as Qh,bd as ec,be as ef,bf as tf,bg as rf}from"./main.DmoTgZ8-.js";import{g as ae,a as ni,m as nn,d as ca,e as Wn,F as ct,P as xt,L as At,J as nf,t as Ue,b as sf,l as of,c as cs,M as Ai,f as gn,h as js,i as Pi,j as Hs,G as af,k as lf,n as cf,o as uf,p as sn,S as ua,q as hf,r as Zs,s as Ce,u as Ys,v as on,w as Pt,x as qs,y as ff,z as ha,A as df,B as tc,R as pf,C as gf,D as rc,E as mf,H as Ks,I as _f,K as yf,N as an,O as xf,Q as Ef,T as bf,U as fa,V as da,W as pa,X as us}from"./GeoJSON.CclkGaeh.js";import{s as Tf,w as wf,a as Sf,b as it,e as ln,i as Li,c as Ut,d as br,f as Fe,h as ii,j as Ee,k as Tr,l as gr,m as Rf,n as si,o as nc,p as Je,q as Js,r as Qs,t as de,D as ic,u as vf,v as Af,x as mn,y as St,z as eo,A as oi,T as Pf,E as ze,B as Lf,C as If,F as sc,G as at,H as Cf,I as Ff,J as hs,K as ga,L as Of,M as Mf,N as Nf,O as Df,P as ma,Q as oc,R as Uf,S as Bf}from"./getElement.BTPto6G5.js";import{T as ac,W as Gf,m as zf}from"./mustache.B8xfPrro.js";import{C as kf,a as fs,L as lc}from"./Group.DOXtryoE.js";import{g as to}from"./commonjsHelpers.BosuxZz1.js";import{a0 as $t,p as sr,ak as _a,h as ki,v as cc,c as $f,o as Vf,j as Fn,N as ya,k as xa,x as uc,q as Xf,P as Ea}from"./framework.BD9sBbGn.js";import{p as Wf,U as ds,q as On,s as ps,a as gs,i as jf,h as Hf,d as ba,f as $i,l as Zt,r as Zf,n as Yf,k as qf,t as Hr,j as Kf,v as Jf,w as Qf,E as Ta,x as ed}from"./eo-dash.D_7lCkWe.js";function hc(r,e,t){const n=[];let i=r(0),s=r(1),o=e(i),a=e(s);const c=[s,i],l=[a,o],u=[1,0],h={};let f=1e5,d,p,g,m,y,_;for(;--f>0&&u.length>0;)g=u.pop(),i=c.pop(),o=l.pop(),_=g.toString(),_ in h||(n.push(o[0],o[1]),h[_]=!0),m=u.pop(),s=c.pop(),a=l.pop(),y=(g+m)/2,d=r(y),p=e(d),Tf(p[0],p[1],o[0],o[1],a[0],a[1])<t?(n.push(a[0],a[1]),_=m.toString(),h[_]=!0):(u.push(m,y,y,g),l.push(a,p,p,o),c.push(s,d,d,i));return n}function td(r,e,t,n,i){const s=ae("EPSG:4326");return hc(function(o){return[r,e+(t-e)*o]},ni(s,n),i)}function rd(r,e,t,n,i){const s=ae("EPSG:4326");return hc(function(o){return[e+(t-e)*o,r]},ni(s,n),i)}function nd(r){if(!(r.context instanceof CanvasRenderingContext2D))throw new Error("Only works for render events from Canvas 2D layers");const e=r.inversePixelTransform[0],t=r.inversePixelTransform[1],n=Math.sqrt(e*e+t*t),i=r.frameState,s=nn(r.inversePixelTransform.slice(),i.coordinateToPixelTransform),o=dh(i.viewState.resolution,n);let a;return new ph(r.context,n,i.extent,s,i.viewState.rotation,o,a)}const id=new Yn({color:"rgba(0,0,0,0.2)"}),sd=[90,45,30,20,10,5,2,1,30/60,20/60,10/60,5/60,2/60,1/60,30/3600,20/3600,10/3600,5/3600,2/3600,1/3600];class od extends Ds{constructor(e){e=e||{};const t=Object.assign({updateWhileAnimating:!0,updateWhileInteracting:!0,renderBuffer:0},e);delete t.maxLines,delete t.strokeStyle,delete t.targetSize,delete t.showLabels,delete t.lonLabelFormatter,delete t.latLabelFormatter,delete t.lonLabelPosition,delete t.latLabelPosition,delete t.lonLabelStyle,delete t.latLabelStyle,delete t.intervals,super(t),this.projection_=null,this.maxLat_=1/0,this.maxLon_=1/0,this.minLat_=-1/0,this.minLon_=-1/0,this.maxX_=1/0,this.maxY_=1/0,this.minX_=-1/0,this.minY_=-1/0,this.targetSize_=e.targetSize!==void 0?e.targetSize:100,this.maxLines_=e.maxLines!==void 0?e.maxLines:100,this.meridians_=[],this.parallels_=[],this.strokeStyle_=e.strokeStyle!==void 0?e.strokeStyle:id,this.fromLonLatTransform_=void 0,this.toLonLatTransform_=void 0,this.projectionCenterLonLat_=null,this.bottomLeft_=null,this.bottomRight_=null,this.topLeft_=null,this.topRight_=null,this.meridiansLabels_=null,this.parallelsLabels_=null,e.showLabels&&(this.lonLabelFormatter_=e.lonLabelFormatter==null?ca.bind(this,"EW"):e.lonLabelFormatter,this.latLabelFormatter_=e.latLabelFormatter==null?ca.bind(this,"NS"):e.latLabelFormatter,this.lonLabelPosition_=e.lonLabelPosition==null?0:e.lonLabelPosition,this.latLabelPosition_=e.latLabelPosition==null?1:e.latLabelPosition,this.lonLabelStyleBase_=new Xn({text:e.lonLabelStyle!==void 0?e.lonLabelStyle.clone():new aa({font:"12px Calibri,sans-serif",textBaseline:"bottom",fill:new qn({color:"rgba(0,0,0,1)"}),stroke:new Yn({color:"rgba(255,255,255,1)",width:3})})}),this.lonLabelStyle_=n=>{const i=n.get("graticule_label");return this.lonLabelStyleBase_.getText().setText(i),this.lonLabelStyleBase_},this.latLabelStyleBase_=new Xn({text:e.latLabelStyle!==void 0?e.latLabelStyle.clone():new aa({font:"12px Calibri,sans-serif",textAlign:"right",fill:new qn({color:"rgba(0,0,0,1)"}),stroke:new Yn({color:"rgba(255,255,255,1)",width:3})})}),this.latLabelStyle_=n=>{const i=n.get("graticule_label");return this.latLabelStyleBase_.getText().setText(i),this.latLabelStyleBase_},this.meridiansLabels_=[],this.parallelsLabels_=[],this.addEventListener(jt.POSTRENDER,this.drawLabels_.bind(this))),this.intervals_=e.intervals!==void 0?e.intervals:sd,this.setSource(new fn({loader:this.loaderFunction.bind(this),strategy:this.strategyFunction.bind(this),features:new kf,overlaps:!1,useSpatialIndex:!1,wrapX:e.wrapX})),this.featurePool_=[],this.lineStyle_=new Xn({stroke:this.strokeStyle_}),this.loadedExtent_=null,this.renderedExtent_=null,this.renderedResolution_=null,this.setRenderOrder(null)}strategyFunction(e,t){let n=e.slice();return this.projection_&&this.getSource().getWrapX()&&wf(n,this.projection_),this.loadedExtent_&&(Sf(this.loadedExtent_,n,t)?n=this.loadedExtent_.slice():this.getSource().removeLoadedExtent(this.loadedExtent_)),[n]}loaderFunction(e,t,n){this.loadedExtent_=e;const i=this.getSource(),s=this.getExtent()||[-1/0,-1/0,1/0,1/0],o=it(s,e);if(this.renderedExtent_&&ln(this.renderedExtent_,o)&&this.renderedResolution_===t||(this.renderedExtent_=o,this.renderedResolution_=t,Li(o)))return;const a=Ut(o),c=t*t/4;(!this.projection_||!Wn(this.projection_,n))&&this.updateProjectionInfo_(n),this.createGraticule_(o,a,t,c);let u=this.meridians_.length+this.parallels_.length;this.meridiansLabels_&&(u+=this.meridians_.length),this.parallelsLabels_&&(u+=this.parallels_.length);let h;for(;u>this.featurePool_.length;)h=new ct,this.featurePool_.push(h);const f=i.getFeaturesCollection();f.clear();let d=0,p,g;for(p=0,g=this.meridians_.length;p<g;++p)h=this.featurePool_[d++],h.setGeometry(this.meridians_[p]),h.setStyle(this.lineStyle_),f.push(h);for(p=0,g=this.parallels_.length;p<g;++p)h=this.featurePool_[d++],h.setGeometry(this.parallels_[p]),h.setStyle(this.lineStyle_),f.push(h)}addMeridian_(e,t,n,i,s,o){const a=this.getMeridian_(e,t,n,i,o);if(br(a.getExtent(),s)){if(this.meridiansLabels_){const c=this.lonLabelFormatter_(e);o in this.meridiansLabels_?this.meridiansLabels_[o].text=c:this.meridiansLabels_[o]={geom:new xt([]),text:c}}this.meridians_[o++]=a}return o}addParallel_(e,t,n,i,s,o){const a=this.getParallel_(e,t,n,i,o);if(br(a.getExtent(),s)){if(this.parallelsLabels_){const c=this.latLabelFormatter_(e);o in this.parallelsLabels_?this.parallelsLabels_[o].text=c:this.parallelsLabels_[o]={geom:new xt([]),text:c}}this.parallels_[o++]=a}return o}drawLabels_(e){const t=e.frameState.viewState.rotation,n=e.frameState.viewState.resolution,i=e.frameState.size,s=e.frameState.extent,o=Ut(s);let a=s;if(t){const p=i[0]*n,g=i[1]*n;a=[o[0]-p/2,o[1]-g/2,o[0]+p/2,o[1]+g/2]}let c=0,l=0,u=this.latLabelPosition_<.5;const h=this.projection_.getExtent(),f=Fe(h);if(this.getSource().getWrapX()&&this.projection_.canWrapX()&&!ii(h,s)){c=Math.floor((s[0]-h[0])/f),l=Math.ceil((s[2]-h[2])/f);const p=Math.abs(t)>Math.PI/2;u=u!==p}const d=nd(e);for(let p=c;p<=l;++p){let g=this.meridians_.length+this.parallels_.length,m,y,_,E;if(this.meridiansLabels_)for(y=0,_=this.meridiansLabels_.length;y<_;++y){const S=this.meridians_[y];if(!t&&p===0)E=this.getMeridianPoint_(S,s,y);else{const R=S.clone();R.translate(p*f,0),R.rotate(-t,o),E=this.getMeridianPoint_(R,a,y),E.rotate(t,o)}m=this.featurePool_[g++],m.setGeometry(E),m.set("graticule_label",this.meridiansLabels_[y].text),d.drawFeature(m,this.lonLabelStyle_(m))}if(this.parallelsLabels_&&(p===c&&u||p===l&&!u))for(y=0,_=this.parallels_.length;y<_;++y){const S=this.parallels_[y];if(!t&&p===0)E=this.getParallelPoint_(S,s,y);else{const R=S.clone();R.translate(p*f,0),R.rotate(-t,o),E=this.getParallelPoint_(R,a,y),E.rotate(t,o)}m=this.featurePool_[g++],m.setGeometry(E),m.set("graticule_label",this.parallelsLabels_[y].text),d.drawFeature(m,this.latLabelStyle_(m))}}}createGraticule_(e,t,n,i){const s=this.getInterval_(n);if(s==-1){this.meridians_.length=0,this.parallels_.length=0,this.meridiansLabels_&&(this.meridiansLabels_.length=0),this.parallelsLabels_&&(this.parallelsLabels_.length=0);return}let o=!1;const a=this.projection_.getExtent(),c=Fe(a);this.getSource().getWrapX()&&this.projection_.canWrapX()&&!ii(a,e)&&(Fe(e)>=c?(e[0]=a[0],e[2]=a[2]):o=!0);const l=[Ee(t[0],this.minX_,this.maxX_),Ee(t[1],this.minY_,this.maxY_)],u=this.toLonLatTransform_(l);isNaN(u[1])&&(u[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_);let h=Ee(u[0],this.minLon_,this.maxLon_),f=Ee(u[1],this.minLat_,this.maxLat_);const d=this.maxLines_;let p,g,m,y,_=e;o||(_=[Ee(e[0],this.minX_,this.maxX_),Ee(e[1],this.minY_,this.maxY_),Ee(e[2],this.minX_,this.maxX_),Ee(e[3],this.minY_,this.maxY_)]);const E=Tr(_,this.toLonLatTransform_,void 0,8);let S=E[3],R=E[2],w=E[1],A=E[0];if(o||(gr(_,this.bottomLeft_)&&(A=this.minLon_,w=this.minLat_),gr(_,this.bottomRight_)&&(R=this.maxLon_,w=this.minLat_),gr(_,this.topLeft_)&&(A=this.minLon_,S=this.maxLat_),gr(_,this.topRight_)&&(R=this.maxLon_,S=this.maxLat_),S=Ee(S,f,this.maxLat_),R=Ee(R,h,this.maxLon_),w=Ee(w,this.minLat_,f),A=Ee(A,this.minLon_,h)),h=Math.floor(h/s)*s,y=Ee(h,this.minLon_,this.maxLon_),g=this.addMeridian_(y,w,S,i,e,0),p=0,o)for(;(y-=s)>=A&&p++<d;)g=this.addMeridian_(y,w,S,i,e,g);else for(;y!=this.minLon_&&p++<d;)y=Math.max(y-s,this.minLon_),g=this.addMeridian_(y,w,S,i,e,g);if(y=Ee(h,this.minLon_,this.maxLon_),p=0,o)for(;(y+=s)<=R&&p++<d;)g=this.addMeridian_(y,w,S,i,e,g);else for(;y!=this.maxLon_&&p++<d;)y=Math.min(y+s,this.maxLon_),g=this.addMeridian_(y,w,S,i,e,g);for(this.meridians_.length=g,this.meridiansLabels_&&(this.meridiansLabels_.length=g),f=Math.floor(f/s)*s,m=Ee(f,this.minLat_,this.maxLat_),g=this.addParallel_(m,A,R,i,e,0),p=0;m!=this.minLat_&&p++<d;)m=Math.max(m-s,this.minLat_),g=this.addParallel_(m,A,R,i,e,g);for(m=Ee(f,this.minLat_,this.maxLat_),p=0;m!=this.maxLat_&&p++<d;)m=Math.min(m+s,this.maxLat_),g=this.addParallel_(m,A,R,i,e,g);this.parallels_.length=g,this.parallelsLabels_&&(this.parallelsLabels_.length=g)}getInterval_(e){const t=this.projectionCenterLonLat_[0],n=this.projectionCenterLonLat_[1];let i=-1;const s=Math.pow(this.targetSize_*e,2),o=[],a=[];for(let c=0,l=this.intervals_.length;c<l;++c){const u=Ee(this.intervals_[c]/2,0,90),h=Ee(n,-90+u,90-u);if(o[0]=t-u,o[1]=h-u,a[0]=t+u,a[1]=h+u,this.fromLonLatTransform_(o,o),this.fromLonLatTransform_(a,a),Math.pow(a[0]-o[0],2)+Math.pow(a[1]-o[1],2)<=s)break;i=this.intervals_[c]}return i}getMeridian_(e,t,n,i,s){const o=td(e,t,n,this.projection_,i);let a=this.meridians_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):(a=new At(o,"XY"),this.meridians_[s]=a),a}getMeridianPoint_(e,t,n){const i=e.getFlatCoordinates();let s=1,o=i.length-1;i[s]>i[o]&&(s=o,o=1);const a=Math.max(t[1],i[s]),c=Math.min(t[3],i[o]),l=Ee(t[1]+Math.abs(t[1]-t[3])*this.lonLabelPosition_,a,c),h=[i[s-1]+(i[o-1]-i[s-1])*(l-i[s])/(i[o]-i[s]),l],f=this.meridiansLabels_[n].geom;return f.setCoordinates(h),f}getMeridians(){return this.meridians_}getParallel_(e,t,n,i,s){const o=rd(e,t,n,this.projection_,i);let a=this.parallels_[s];return a?(a.setFlatCoordinates("XY",o),a.changed()):a=new At(o,"XY"),a}getParallelPoint_(e,t,n){const i=e.getFlatCoordinates();let s=0,o=i.length-2;i[s]>i[o]&&(s=o,o=0);const a=Math.max(t[0],i[s]),c=Math.min(t[2],i[o]),l=Ee(t[0]+Math.abs(t[0]-t[2])*this.latLabelPosition_,a,c),u=i[s+1]+(i[o+1]-i[s+1])*(l-i[s])/(i[o]-i[s]),h=[l,u],f=this.parallelsLabels_[n].geom;return f.setCoordinates(h),f}getParallels(){return this.parallels_}updateProjectionInfo_(e){const t=ae("EPSG:4326"),n=e.getWorldExtent();this.maxLat_=n[3],this.maxLon_=n[2],this.minLat_=n[1],this.minLon_=n[0];const i=ni(e,t);if(this.minLon_<this.maxLon_)this.toLonLatTransform_=i;else{const o=this.minLon_+this.maxLon_/2;this.maxLon_+=360,this.toLonLatTransform_=function(a,c,l){l=l||2;const u=i(a,c,l);for(let h=0,f=u.length;h<f;h+=l)u[h]<o&&(u[h]+=360);return u}}this.fromLonLatTransform_=ni(t,e);const s=Tr([this.minLon_,this.minLat_,this.maxLon_,this.maxLat_],this.fromLonLatTransform_,void 0,8);this.minX_=s[0],this.maxX_=s[2],this.minY_=s[1],this.maxY_=s[3],this.bottomLeft_=this.fromLonLatTransform_([this.minLon_,this.minLat_]),this.bottomRight_=this.fromLonLatTransform_([this.maxLon_,this.minLat_]),this.topLeft_=this.fromLonLatTransform_([this.minLon_,this.maxLat_]),this.topRight_=this.fromLonLatTransform_([this.maxLon_,this.maxLat_]),this.projectionCenterLonLat_=this.toLonLatTransform_(Ut(e.getExtent())),isNaN(this.projectionCenterLonLat_[1])&&(this.projectionCenterLonLat_[1]=Math.abs(this.maxLat_)>=Math.abs(this.minLat_)?this.maxLat_:this.minLat_),this.projection_=e}}class ro extends zl{constructor(e,t,n,i,s){const o=s!==void 0?Ht.IDLE:Ht.LOADED;super(e,t,n,o),this.loader_=s!==void 0?s:null,this.canvas_=i,this.error_=null}getError(){return this.error_}handleLoad_(e){e?(this.error_=e,this.state=Ht.ERROR):this.state=Ht.LOADED,this.changed()}load(){this.state==Ht.IDLE&&(this.state=Ht.LOADING,this.changed(),this.loader_(this.handleLoad_.bind(this)))}getImage(){return this.canvas_}}const ad={Point:hd,LineString:fd,Polygon:md,MultiPoint:pd,MultiLineString:dd,MultiPolygon:gd},ld={Point:_d,LineString:yd,Polygon:xd,MultiPoint:bd,MultiLineString:Ed,MultiPolygon:Td};class cd extends nf{constructor(e){e=e||{},super(),this.geometryName_=e.geometryName}readFeatureFromObject(e,t,n){const i=e,s=wa(i.geometry,t),o=new ct;if(this.geometryName_&&o.setGeometryName(this.geometryName_),o.setGeometry(s),i.attributes){o.setProperties(i.attributes,!0);const a=i.attributes[n];a!==void 0&&o.setId(a)}return o}readFeaturesFromObject(e,t){if(t=t||{},e.features){const n=e,i=[],s=n.features;for(let o=0,a=s.length;o<a;++o)i.push(this.readFeatureFromObject(s[o],t,e.objectIdFieldName));return i}return[this.readFeatureFromObject(e,t)]}readGeometryFromObject(e,t){return wa(e,t)}readProjectionFromObject(e){if(e.spatialReference&&e.spatialReference.wkid!==void 0){const n=e.spatialReference.wkid;return ae("EPSG:"+n)}return null}writeGeometryObject(e,t){return Sa(e,this.adaptOptions(t))}writeFeatureObject(e,t){t=this.adaptOptions(t);const n={};if(!e.hasProperties())return n.attributes={},n;const i=e.getProperties(),s=e.getGeometry();if(s){n.geometry=Sa(s,t);const o=t&&(t.dataProjection||t.featureProjection);o&&(n.geometry.spatialReference={wkid:Number(ae(o).getCode().split(":").pop())}),delete i[e.getGeometryName()]}return Rf(i)?n.attributes={}:n.attributes=i,n}writeFeaturesObject(e,t){t=this.adaptOptions(t);const n=[];for(let i=0,s=e.length;i<s;++i)n.push(this.writeFeatureObject(e[i],t));return{features:n}}}function wa(r,e){if(!r)return null;let t;if(typeof r.x=="number"&&typeof r.y=="number")t="Point";else if(r.points)t="MultiPoint";else if(r.paths)r.paths.length===1?t="LineString":t="MultiLineString";else if(r.rings){const i=r,s=Ir(i),o=ud(i.rings,s);o.length===1?(t="Polygon",r=Object.assign({},r,{rings:o[0]})):(t="MultiPolygon",r=Object.assign({},r,{rings:o}))}const n=ad[t];return Ue(n(r),!1,e)}function ud(r,e){const t=[],n=[],i=[];let s,o;for(s=0,o=r.length;s<o;++s)t.length=0,sf(t,0,r[s],e.length),of(t,0,t.length,e.length)?n.push([r[s]]):i.push(r[s]);for(;i.length;){const a=i.shift();let c=!1;for(s=n.length-1;s>=0;s--){const l=n[s][0];if(ii(new cs(l).getExtent(),new cs(a).getExtent())){n[s].push(a),c=!0;break}}c||n.push([a.reverse()])}return n}function hd(r){let e;return r.m!==void 0&&r.z!==void 0?e=new xt([r.x,r.y,r.z,r.m],"XYZM"):r.z!==void 0?e=new xt([r.x,r.y,r.z],"XYZ"):r.m!==void 0?e=new xt([r.x,r.y,r.m],"XYM"):e=new xt([r.x,r.y]),e}function fd(r){const e=Ir(r);return new At(r.paths[0],e)}function dd(r){const e=Ir(r);return new gn(r.paths,e)}function Ir(r){let e="XY";return r.hasZ===!0&&r.hasM===!0?e="XYZM":r.hasZ===!0?e="XYZ":r.hasM===!0&&(e="XYM"),e}function pd(r){const e=Ir(r);return new js(r.points,e)}function gd(r){const e=Ir(r);return new Ai(r.rings,e)}function md(r){const e=Ir(r);return new Pi(r.rings,e)}function _d(r,e){const t=r.getCoordinates();let n;const i=r.getLayout();if(i==="XYZ")n={x:t[0],y:t[1],z:t[2]};else if(i==="XYM")n={x:t[0],y:t[1],m:t[2]};else if(i==="XYZM")n={x:t[0],y:t[1],z:t[2],m:t[3]};else if(i==="XY")n={x:t[0],y:t[1]};else throw new Error("Invalid geometry layout");return n}function _n(r){const e=r.getLayout();return{hasZ:e==="XYZ"||e==="XYZM",hasM:e==="XYM"||e==="XYZM"}}function yd(r,e){const t=_n(r);return{hasZ:t.hasZ,hasM:t.hasM,paths:[r.getCoordinates()]}}function xd(r,e){const t=_n(r);return{hasZ:t.hasZ,hasM:t.hasM,rings:r.getCoordinates(!1)}}function Ed(r,e){const t=_n(r);return{hasZ:t.hasZ,hasM:t.hasM,paths:r.getCoordinates()}}function bd(r,e){const t=_n(r);return{hasZ:t.hasZ,hasM:t.hasM,points:r.getCoordinates()}}function Td(r,e){const t=_n(r),n=r.getCoordinates(!1),i=[];for(let s=0;s<n.length;s++)for(let o=n[s].length-1;o>=0;o--)i.push(n[s][o]);return{hasZ:t.hasZ,hasM:t.hasM,rings:i}}function Sa(r,e){const t=ld[r.getType()];return t(Ue(r,!0,e),e)}const vt="http://www.opengis.net/gml",wd=/^\s*$/;class B extends bi{constructor(e){super(),e=e||{},this.featureType=e.featureType,this.featureNS=e.featureNS,this.srsName=e.srsName,this.schemaLocation="",this.FEATURE_COLLECTION_PARSERS={},this.FEATURE_COLLECTION_PARSERS[this.namespace]={featureMember:$(this.readFeaturesInternal),featureMembers:V(this.readFeaturesInternal)},this.supportedMediaTypes=["application/gml+xml"]}readFeaturesInternal(e,t){const n=e.localName;let i=null;if(n=="FeatureCollection")i=O([],this.FEATURE_COLLECTION_PARSERS,e,t,this);else if(n=="featureMembers"||n=="featureMember"||n=="member"){const s=t[0];let o=s.featureType,a=s.featureNS;const c="p",l="p0";if(!o&&e.childNodes){o=[],a={};for(let f=0,d=e.childNodes.length;f<d;++f){const p=e.childNodes[f];if(p.nodeType===1){const g=p.nodeName.split(":").pop();if(!o.includes(g)){let m="",y=0;const _=p.namespaceURI;for(const E in a){if(a[E]===_){m=E;break}++y}m||(m=c+y,a[m]=_),o.push(m+":"+g)}}}n!="featureMember"&&(s.featureType=o,s.featureNS=a)}if(typeof a=="string"){const f=a;a={},a[l]=f}const u={},h=Array.isArray(o)?o:[o];for(const f in a){const d={};for(let p=0,g=h.length;p<g;++p)(h[p].includes(":")?h[p].split(":")[0]:l)===f&&(d[h[p].split(":").pop()]=n=="featureMembers"?$(this.readFeatureElement,this):V(this.readFeatureElement,this));u[a[f]]=d}n=="featureMember"||n=="member"?i=O(void 0,u,e,t):i=O([],u,e,t)}return i===null&&(i=[]),i}readGeometryOrExtent(e,t){const n=t[0];return n.srsName=e.firstElementChild.getAttribute("srsName"),n.srsDimension=e.firstElementChild.getAttribute("srsDimension"),O(null,this.GEOMETRY_PARSERS,e,t,this)}readExtentElement(e,t){const n=t[0],i=this.readGeometryOrExtent(e,t);return i?Hs(i,n):void 0}readGeometryElement(e,t){const n=t[0],i=this.readGeometryOrExtent(e,t);return i?Ue(i,!1,n):void 0}readFeatureElementInternal(e,t,n){let i;const s={};for(let c=e.firstElementChild;c;c=c.nextElementSibling){let l;const u=c.localName;c.childNodes.length===0||c.childNodes.length===1&&(c.firstChild.nodeType===3||c.firstChild.nodeType===4)?(l=Kn(c,!1),wd.test(l)&&(l=void 0)):(n&&(l=u==="boundedBy"?this.readExtentElement(c,t):this.readGeometryElement(c,t)),l?u!=="boundedBy"&&(i=u):l=this.readFeatureElementInternal(c,t,!1));const h=c.attributes.length;if(h>0&&!(l instanceof af)){l={_content_:l};for(let f=0;f<h;f++){const d=c.attributes[f].name;l[d]=c.attributes[f].value}}s[u]?(s[u]instanceof Array||(s[u]=[s[u]]),s[u].push(l)):s[u]=l}if(!n)return s;const o=new ct(s);i&&o.setGeometryName(i);const a=e.getAttribute("fid")||gh(e,this.namespace,"id");return a&&o.setId(a),o}readFeatureElement(e,t){return this.readFeatureElementInternal(e,t,!0)}readPoint(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new xt(n,"XYZ")}readMultiPoint(e,t){const n=O([],this.MULTIPOINT_PARSERS,e,t,this);if(n)return new js(n)}readMultiLineString(e,t){const n=O([],this.MULTILINESTRING_PARSERS,e,t,this);if(n)return new gn(n)}readMultiPolygon(e,t){const n=O([],this.MULTIPOLYGON_PARSERS,e,t,this);if(n)return new Ai(n)}pointMemberParser(e,t){Dt(this.POINTMEMBER_PARSERS,e,t,this)}lineStringMemberParser(e,t){Dt(this.LINESTRINGMEMBER_PARSERS,e,t,this)}polygonMemberParser(e,t){Dt(this.POLYGONMEMBER_PARSERS,e,t,this)}readLineString(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new At(n,"XYZ")}readFlatLinearRing(e,t){const n=O(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this);if(n)return n}readLinearRing(e,t){const n=this.readFlatCoordinatesFromNode(e,t);if(n)return new cs(n,"XYZ")}readPolygon(e,t){const n=O([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this);if(n&&n[0]){const i=n[0],s=[i.length];let o,a;for(o=1,a=n.length;o<a;++o)si(i,n[o]),s.push(i.length);return new Pi(i,"XYZ",s)}}readFlatCoordinatesFromNode(e,t){return O(null,this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}readGeometryFromNode(e,t){const n=this.readGeometryElement(e,[this.getReadOptions(e,t||{})]);return n||null}readFeaturesFromNode(e,t){const n={featureType:this.featureType,featureNS:this.featureNS};return n&&Object.assign(n,this.getReadOptions(e,t)),this.readFeaturesInternal(e,[n])||[]}readProjectionFromNode(e){return ae(this.srsName?this.srsName:e.firstElementChild.getAttribute("srsName"))}}B.prototype.namespace=vt;B.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{}};B.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{}};B.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{}};B.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml":{pointMember:$(B.prototype.pointMemberParser),pointMembers:$(B.prototype.pointMemberParser)}};B.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml":{lineStringMember:$(B.prototype.lineStringMemberParser),lineStringMembers:$(B.prototype.lineStringMemberParser)}};B.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml":{polygonMember:$(B.prototype.polygonMemberParser),polygonMembers:$(B.prototype.polygonMemberParser)}};B.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml":{Point:$(B.prototype.readFlatCoordinatesFromNode)}};B.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:$(B.prototype.readLineString)}};B.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:$(B.prototype.readPolygon)}};B.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:V(B.prototype.readFlatLinearRing)}};const Sd=vt+" http://schemas.opengis.net/gml/2.1.2/feature.xsd",Rd={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class J extends B{constructor(e){e=e||{},super(e),this.FEATURE_COLLECTION_PARSERS[vt].featureMember=$(this.readFeaturesInternal),this.schemaLocation=e.schemaLocation?e.schemaLocation:Sd}readFlatCoordinates(e,t){const n=Kn(e,!1).replace(/^\s*|\s*$/g,""),s=t[0].srsName;let o="enu";if(s){const l=ae(s);l&&(o=l.getAxisOrientation())}const a=n.trim().split(/\s+/),c=[];for(let l=0,u=a.length;l<u;l++){const h=a[l].split(/,+/),f=parseFloat(h[0]),d=parseFloat(h[1]),p=h.length===3?parseFloat(h[2]):0;o.startsWith("en")?c.push(f,d,p):c.push(d,f,p)}return c}readBox(e,t){const n=O([null],this.BOX_PARSERS_,e,t,this);return nc(n[1][0],n[1][1],n[1][3],n[1][4])}innerBoundaryIsParser(e,t){const n=O(void 0,this.RING_PARSERS,e,t,this);n&&t[t.length-1].push(n)}outerBoundaryIsParser(e,t){const n=O(void 0,this.RING_PARSERS,e,t,this);if(n){const i=t[t.length-1];i[0]=n}}GEOMETRY_NODE_FACTORY_(e,t,n){const i=t[t.length-1],s=i.multiSurface,o=i.surface,a=i.multiCurve;return Array.isArray(e)?n="Envelope":(n=e.getType(),n==="MultiPolygon"&&s===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="MultiLineString"&&a===!0&&(n="MultiCurve")),H("http://www.opengis.net/gml",n)}writeFeatureElement(e,t,n){const i=t.getId();i&&e.setAttribute("fid",i);const s=n[n.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const c=[],l=[];if(t.hasProperties()){const h=t.getProperties();for(const f in h){const d=h[f];d!=null&&(c.push(f),l.push(d),f==a||typeof d.getSimplifiedGeometry=="function"?f in s.serializers[o]||(s.serializers[o][f]=T(this.writeGeometryElement,this)):f in s.serializers[o]||(s.serializers[o][f]=T(ee)))}}const u=Object.assign({},s);u.node=e,_e(u,s.serializers,Ye(void 0,o),l,n,c)}writeCurveOrLineString(e,t,n){const s=n[n.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,n)}else if(e.nodeName==="Curve"){const o=H(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,n)}}writeLineStringOrCurveMember(e,t,n){const i=this.GEOMETRY_NODE_FACTORY_(t,n);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,n))}writeMultiCurveOrLineString(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&e.setAttribute("srsName",o);const c=t.getLineStrings();_e({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,c,n,void 0,this)}writeGeometryElement(e,t,n){const i=n[n.length-1],s=Object.assign({},i);s.node=e;let o;Array.isArray(t)?o=Hs(t,i):o=Ue(t,!0,i),_e(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}createCoordinatesNode_(e){const t=H(e,"coordinates");return t.setAttribute("decimal","."),t.setAttribute("cs",","),t.setAttribute("ts"," "),t}writeCoordinates_(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=t.getCoordinates(),c=a.length,l=new Array(c);for(let u=0;u<c;++u){const h=a[u];l[u]=this.getCoords_(h,o,s)}ee(e,l.join(" "))}writeCurveSegments_(e,t,n){const i=H(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,n)}writeSurfaceOrPolygon(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();_e({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(e.nodeName==="Surface"){const a=H(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,n)}}RING_NODE_FACTORY_(e,t,n){const i=t[t.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),H(s.namespaceURI,o!==void 0?"innerBoundaryIs":"outerBoundaryIs")}writeSurfacePatches_(e,t,n){const i=H(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,n)}writeRing(e,t,n){const i=H(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,n)}getCoords_(e,t,n){let s=(t?ae(t).getAxisOrientation():"enu").startsWith("en")?e[0]+","+e[1]:e[1]+","+e[0];if(n){const o=e[2]||0;s+=","+o}return s}writePoint(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;o&&e.setAttribute("srsName",o);const a=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(a);const c=t.getCoordinates(),l=this.getCoords_(c,o,s);ee(a,l)}writeMultiPoint(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;o&&e.setAttribute("srsName",o);const a=t.getPoints();_e({node:e,hasZ:s,srsName:o},this.POINTMEMBER_SERIALIZERS,Ye("pointMember"),a,n,void 0,this)}writePointMember(e,t,n){const i=H(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,n)}writeLinearRing(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=this.createCoordinatesNode_(e.namespaceURI);e.appendChild(o),this.writeCoordinates_(o,t,n)}writeMultiSurfaceOrPolygon(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&e.setAttribute("srsName",o);const c=t.getPolygons();_e({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,c,n,void 0,this)}writeSurfaceOrPolygonMember(e,t,n){const i=this.GEOMETRY_NODE_FACTORY_(t,n);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,n))}writeEnvelope(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];_e({node:e},this.ENVELOPE_SERIALIZERS,Ar,a,n,o,this)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,n){const i=t[t.length-1].node;return H("http://www.opengis.net/gml",Rd[i.nodeName])}}J.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{coordinates:V(J.prototype.readFlatCoordinates)}};J.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{innerBoundaryIs:J.prototype.innerBoundaryIsParser,outerBoundaryIs:J.prototype.outerBoundaryIsParser}};J.prototype.BOX_PARSERS_={"http://www.opengis.net/gml":{coordinates:$(J.prototype.readFlatCoordinates)}};J.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:V(B.prototype.readPoint),MultiPoint:V(B.prototype.readMultiPoint),LineString:V(B.prototype.readLineString),MultiLineString:V(B.prototype.readMultiLineString),LinearRing:V(B.prototype.readLinearRing),Polygon:V(B.prototype.readPolygon),MultiPolygon:V(B.prototype.readMultiPolygon),Box:V(J.prototype.readBox)}};J.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:T(J.prototype.writeCurveOrLineString),MultiCurve:T(J.prototype.writeMultiCurveOrLineString),Point:T(J.prototype.writePoint),MultiPoint:T(J.prototype.writeMultiPoint),LineString:T(J.prototype.writeCurveOrLineString),MultiLineString:T(J.prototype.writeMultiCurveOrLineString),LinearRing:T(J.prototype.writeLinearRing),Polygon:T(J.prototype.writeSurfaceOrPolygon),MultiPolygon:T(J.prototype.writeMultiSurfaceOrPolygon),Surface:T(J.prototype.writeSurfaceOrPolygon),MultiSurface:T(J.prototype.writeMultiSurfaceOrPolygon),Envelope:T(J.prototype.writeEnvelope)}};J.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:T(J.prototype.writeLineStringOrCurveMember),curveMember:T(J.prototype.writeLineStringOrCurveMember)}};J.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{outerBoundaryIs:T(J.prototype.writeRing),innerBoundaryIs:T(J.prototype.writeRing)}};J.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:T(J.prototype.writePointMember)}};J.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:T(J.prototype.writeSurfaceOrPolygonMember),polygonMember:T(J.prototype.writeSurfaceOrPolygonMember)}};J.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:T(ee),upperCorner:T(ee)}};const vd=vt+" http://schemas.opengis.net/gml/3.1.1/profiles/gmlsfProfile/1.0.0/gmlsf.xsd",Ad={MultiLineString:"lineStringMember",MultiCurve:"curveMember",MultiPolygon:"polygonMember",MultiSurface:"surfaceMember"};class I extends B{constructor(e){e=e||{},super(e),this.surface_=e.surface!==void 0?e.surface:!1,this.curve_=e.curve!==void 0?e.curve:!1,this.multiCurve_=e.multiCurve!==void 0?e.multiCurve:!0,this.multiSurface_=e.multiSurface!==void 0?e.multiSurface:!0,this.schemaLocation=e.schemaLocation?e.schemaLocation:vd,this.hasZ=e.hasZ!==void 0?e.hasZ:!1}readMultiCurve(e,t){const n=O([],this.MULTICURVE_PARSERS,e,t,this);if(n)return new gn(n)}readFlatCurveRing(e,t){const n=O([],this.MULTICURVE_PARSERS,e,t,this),i=[];for(let s=0,o=n.length;s<o;++s)si(i,n[s].getFlatCoordinates());return i}readMultiSurface(e,t){const n=O([],this.MULTISURFACE_PARSERS,e,t,this);if(n)return new Ai(n)}curveMemberParser(e,t){Dt(this.CURVEMEMBER_PARSERS,e,t,this)}surfaceMemberParser(e,t){Dt(this.SURFACEMEMBER_PARSERS,e,t,this)}readPatch(e,t){return O([null],this.PATCHES_PARSERS,e,t,this)}readSegment(e,t){return O([],this.SEGMENTS_PARSERS,e,t,this)}readPolygonPatch(e,t){return O([null],this.FLAT_LINEAR_RINGS_PARSERS,e,t,this)}readLineStringSegment(e,t){return O([null],this.GEOMETRY_FLAT_COORDINATES_PARSERS,e,t,this)}interiorParser(e,t){const n=O(void 0,this.RING_PARSERS,e,t,this);n&&t[t.length-1].push(n)}exteriorParser(e,t){const n=O(void 0,this.RING_PARSERS,e,t,this);if(n){const i=t[t.length-1];i[0]=n}}readSurface(e,t){const n=O([null],this.SURFACE_PARSERS,e,t,this);if(n&&n[0]){const i=n[0],s=[i.length];let o,a;for(o=1,a=n.length;o<a;++o)si(i,n[o]),s.push(i.length);return new Pi(i,"XYZ",s)}}readCurve(e,t){const n=O([null],this.CURVE_PARSERS,e,t,this);if(n)return new At(n,"XYZ")}readEnvelope(e,t){const n=O([null],this.ENVELOPE_PARSERS,e,t,this);return nc(n[1][0],n[1][1],n[2][0],n[2][1])}readFlatPos(e,t){let n=Kn(e,!1);const i=/^\s*([+\-]?\d*\.?\d+(?:[eE][+\-]?\d+)?)\s*/,s=[];let o;for(;o=i.exec(n);)s.push(parseFloat(o[1])),n=n.substr(o[0].length);if(n!=="")return;const c=t[0].srsName;if((c?ae(c).getAxisOrientation():"enu")==="neu")for(let h=0,f=s.length;h<f;h+=3){const d=s[h],p=s[h+1];s[h]=p,s[h+1]=d}const u=s.length;if(u==2&&s.push(0),u!==0)return s}readFlatPosList(e,t){const n=Kn(e,!1).replace(/^\s*|\s*$/g,""),i=t[0],s=i.srsName,o=i.srsDimension,a=s?ae(s).getAxisOrientation():"enu",c=n.split(/\s+/);let l=2;e.getAttribute("srsDimension")?l=Mt(e.getAttribute("srsDimension")):e.getAttribute("dimension")?l=Mt(e.getAttribute("dimension")):e.parentNode.getAttribute("srsDimension")?l=Mt(e.parentNode.getAttribute("srsDimension")):o&&(l=Mt(o));const u=a.startsWith("en");let h,f,d;const p=[];for(let g=0,m=c.length;g<m;g+=l)h=parseFloat(c[g]),f=parseFloat(c[g+1]),d=l===3?parseFloat(c[g+2]):0,u?p.push(h,f,d):p.push(f,h,d);return p}writePos_(e,t,n){const i=n[n.length-1],s=i.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=i.srsName,c=a?ae(a).getAxisOrientation():"enu",l=t.getCoordinates();let u=c.startsWith("en")?l[0]+" "+l[1]:l[1]+" "+l[0];if(s){const h=l[2]||0;u+=" "+h}ee(e,u)}getCoords_(e,t,n){let s=(t?ae(t).getAxisOrientation():"enu").startsWith("en")?e[0]+" "+e[1]:e[1]+" "+e[0];if(n){const o=e[2]||0;s+=" "+o}return s}writePosList_(e,t,n){const i=n[n.length-1],s=i.hasZ,o=s?"3":"2";e.setAttribute("srsDimension",o);const a=i.srsName,c=t.getCoordinates(),l=c.length,u=new Array(l);let h;for(let f=0;f<l;++f)h=c[f],u[f]=this.getCoords_(h,a,s);ee(e,u.join(" "))}writePoint(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=H(e.namespaceURI,"pos");e.appendChild(o),this.writePos_(o,t,n)}writeEnvelope(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=["lowerCorner","upperCorner"],a=[t[0]+" "+t[1],t[2]+" "+t[3]];_e({node:e},this.ENVELOPE_SERIALIZERS,Ar,a,n,o,this)}writeLinearRing(e,t,n){const s=n[n.length-1].srsName;s&&e.setAttribute("srsName",s);const o=H(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,n)}RING_NODE_FACTORY_(e,t,n){const i=t[t.length-1],s=i.node,o=i.exteriorWritten;return o===void 0&&(i.exteriorWritten=!0),H(s.namespaceURI,o!==void 0?"interior":"exterior")}writeSurfaceOrPolygon(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName;if(e.nodeName!=="PolygonPatch"&&o&&e.setAttribute("srsName",o),e.nodeName==="Polygon"||e.nodeName==="PolygonPatch"){const a=t.getLinearRings();_e({node:e,hasZ:s,srsName:o},this.RING_SERIALIZERS,this.RING_NODE_FACTORY_,a,n,void 0,this)}else if(e.nodeName==="Surface"){const a=H(e.namespaceURI,"patches");e.appendChild(a),this.writeSurfacePatches_(a,t,n)}}writeCurveOrLineString(e,t,n){const s=n[n.length-1].srsName;if(e.nodeName!=="LineStringSegment"&&s&&e.setAttribute("srsName",s),e.nodeName==="LineString"||e.nodeName==="LineStringSegment"){const o=H(e.namespaceURI,"posList");e.appendChild(o),this.writePosList_(o,t,n)}else if(e.nodeName==="Curve"){const o=H(e.namespaceURI,"segments");e.appendChild(o),this.writeCurveSegments_(o,t,n)}}writeMultiSurfaceOrPolygon(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.surface;o&&e.setAttribute("srsName",o);const c=t.getPolygons();_e({node:e,hasZ:s,srsName:o,surface:a},this.SURFACEORPOLYGONMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,c,n,void 0,this)}writeMultiPoint(e,t,n){const i=n[n.length-1],s=i.srsName,o=i.hasZ;s&&e.setAttribute("srsName",s);const a=t.getPoints();_e({node:e,hasZ:o,srsName:s},this.POINTMEMBER_SERIALIZERS,Ye("pointMember"),a,n,void 0,this)}writeMultiCurveOrLineString(e,t,n){const i=n[n.length-1],s=i.hasZ,o=i.srsName,a=i.curve;o&&e.setAttribute("srsName",o);const c=t.getLineStrings();_e({node:e,hasZ:s,srsName:o,curve:a},this.LINESTRINGORCURVEMEMBER_SERIALIZERS,this.MULTIGEOMETRY_MEMBER_NODE_FACTORY_,c,n,void 0,this)}writeRing(e,t,n){const i=H(e.namespaceURI,"LinearRing");e.appendChild(i),this.writeLinearRing(i,t,n)}writeSurfaceOrPolygonMember(e,t,n){const i=this.GEOMETRY_NODE_FACTORY_(t,n);i&&(e.appendChild(i),this.writeSurfaceOrPolygon(i,t,n))}writePointMember(e,t,n){const i=H(e.namespaceURI,"Point");e.appendChild(i),this.writePoint(i,t,n)}writeLineStringOrCurveMember(e,t,n){const i=this.GEOMETRY_NODE_FACTORY_(t,n);i&&(e.appendChild(i),this.writeCurveOrLineString(i,t,n))}writeSurfacePatches_(e,t,n){const i=H(e.namespaceURI,"PolygonPatch");e.appendChild(i),this.writeSurfaceOrPolygon(i,t,n)}writeCurveSegments_(e,t,n){const i=H(e.namespaceURI,"LineStringSegment");e.appendChild(i),this.writeCurveOrLineString(i,t,n)}writeGeometryElement(e,t,n){const i=n[n.length-1],s=Object.assign({},i);s.node=e;let o;Array.isArray(t)?o=Hs(t,i):o=Ue(t,!0,i),_e(s,this.GEOMETRY_SERIALIZERS,this.GEOMETRY_NODE_FACTORY_,[o],n,void 0,this)}writeFeatureElement(e,t,n){const i=t.getId();i&&e.setAttribute("fid",i);const s=n[n.length-1],o=s.featureNS,a=t.getGeometryName();s.serializers||(s.serializers={},s.serializers[o]={});const c=[],l=[];if(t.hasProperties()){const h=t.getProperties();for(const f in h){const d=h[f];d!=null&&(c.push(f),l.push(d),f==a||typeof d.getSimplifiedGeometry=="function"?f in s.serializers[o]||(s.serializers[o][f]=T(this.writeGeometryElement,this)):f in s.serializers[o]||(s.serializers[o][f]=T(ee)))}}const u=Object.assign({},s);u.node=e,_e(u,s.serializers,Ye(void 0,o),l,n,c)}writeFeatureMembers_(e,t,n){const i=n[n.length-1],s=i.featureType,o=i.featureNS,a={};a[o]={},a[o][s]=T(this.writeFeatureElement,this);const c=Object.assign({},i);c.node=e,_e(c,a,Ye(s,o),t,n)}MULTIGEOMETRY_MEMBER_NODE_FACTORY_(e,t,n){const i=t[t.length-1].node;return H(this.namespace,Ad[i.nodeName])}GEOMETRY_NODE_FACTORY_(e,t,n){const i=t[t.length-1],s=i.multiSurface,o=i.surface,a=i.curve,c=i.multiCurve;return Array.isArray(e)?n="Envelope":(n=e.getType(),n==="MultiPolygon"&&s===!0?n="MultiSurface":n==="Polygon"&&o===!0?n="Surface":n==="LineString"&&a===!0?n="Curve":n==="MultiLineString"&&c===!0&&(n="MultiCurve")),H(this.namespace,n)}writeGeometryNode(e,t){t=this.adaptOptions(t);const n=H(this.namespace,"geom"),i={node:n,hasZ:this.hasZ,srsName:this.srsName,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_};return t&&Object.assign(i,t),this.writeGeometryElement(n,e,[i]),n}writeFeaturesNode(e,t){t=this.adaptOptions(t);const n=H(this.namespace,"featureMembers");n.setAttributeNS(Qr,"xsi:schemaLocation",this.schemaLocation);const i={srsName:this.srsName,hasZ:this.hasZ,curve:this.curve_,surface:this.surface_,multiSurface:this.multiSurface_,multiCurve:this.multiCurve_,featureNS:this.featureNS,featureType:this.featureType};return t&&Object.assign(i,t),this.writeFeatureMembers_(n,e,[i]),n}}I.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml":{pos:V(I.prototype.readFlatPos),posList:V(I.prototype.readFlatPosList),coordinates:V(J.prototype.readFlatCoordinates)}};I.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml":{interior:I.prototype.interiorParser,exterior:I.prototype.exteriorParser}};I.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml":{Point:V(B.prototype.readPoint),MultiPoint:V(B.prototype.readMultiPoint),LineString:V(B.prototype.readLineString),MultiLineString:V(B.prototype.readMultiLineString),LinearRing:V(B.prototype.readLinearRing),Polygon:V(B.prototype.readPolygon),MultiPolygon:V(B.prototype.readMultiPolygon),Surface:V(I.prototype.readSurface),MultiSurface:V(I.prototype.readMultiSurface),Curve:V(I.prototype.readCurve),MultiCurve:V(I.prototype.readMultiCurve),Envelope:V(I.prototype.readEnvelope)}};I.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml":{curveMember:$(I.prototype.curveMemberParser),curveMembers:$(I.prototype.curveMemberParser)}};I.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml":{surfaceMember:$(I.prototype.surfaceMemberParser),surfaceMembers:$(I.prototype.surfaceMemberParser)}};I.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml":{LineString:$(B.prototype.readLineString),Curve:$(I.prototype.readCurve)}};I.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml":{Polygon:$(B.prototype.readPolygon),Surface:$(I.prototype.readSurface)}};I.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml":{patches:V(I.prototype.readPatch)}};I.prototype.CURVE_PARSERS={"http://www.opengis.net/gml":{segments:V(I.prototype.readSegment)}};I.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml":{lowerCorner:$(I.prototype.readFlatPosList),upperCorner:$(I.prototype.readFlatPosList)}};I.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml":{PolygonPatch:V(I.prototype.readPolygonPatch)}};I.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml":{LineStringSegment:kl(I.prototype.readLineStringSegment)}};B.prototype.RING_PARSERS={"http://www.opengis.net/gml":{LinearRing:V(B.prototype.readFlatLinearRing),Ring:V(I.prototype.readFlatCurveRing)}};I.prototype.writeFeatures;I.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml":{exterior:T(I.prototype.writeRing),interior:T(I.prototype.writeRing)}};I.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml":{lowerCorner:T(ee),upperCorner:T(ee)}};I.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{surfaceMember:T(I.prototype.writeSurfaceOrPolygonMember),polygonMember:T(I.prototype.writeSurfaceOrPolygonMember)}};I.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{pointMember:T(I.prototype.writePointMember)}};I.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml":{lineStringMember:T(I.prototype.writeLineStringOrCurveMember),curveMember:T(I.prototype.writeLineStringOrCurveMember)}};I.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml":{Curve:T(I.prototype.writeCurveOrLineString),MultiCurve:T(I.prototype.writeMultiCurveOrLineString),Point:T(I.prototype.writePoint),MultiPoint:T(I.prototype.writeMultiPoint),LineString:T(I.prototype.writeCurveOrLineString),MultiLineString:T(I.prototype.writeMultiCurveOrLineString),LinearRing:T(I.prototype.writeLinearRing),Polygon:T(I.prototype.writeSurfaceOrPolygon),MultiPolygon:T(I.prototype.writeMultiSurfaceOrPolygon),Surface:T(I.prototype.writeSurfaceOrPolygon),MultiSurface:T(I.prototype.writeMultiSurfaceOrPolygon),Envelope:T(I.prototype.writeEnvelope)}};const no=I;no.prototype.writeFeatures;no.prototype.writeFeaturesNode;const xe=[null,"http://www.topografix.com/GPX/1/0","http://www.topografix.com/GPX/1/1"],Pd="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd",Ld={rte:fc,trk:dc,wpt:pc},Id=D(xe,{rte:$(fc),trk:$(dc),wpt:$(pc)}),Cd=D(xe,{text:b(F,"linkText"),type:b(F,"linkType")}),Fd=D(xe,{name:b(F),email:sp,link:yn}),Od=D(xe,{name:b(F),desc:b(F),author:b(rp),copyright:b(np),link:yn,time:b(Ti),keywords:b(F),bounds:ip,extensions:Ii}),Md=D(xe,{year:b(Te),license:b(F)}),Nd=D(xe,{rte:T(cp),trk:T(up),wpt:T(fp)});class Dd extends bi{constructor(e){super(),e=e||{},this.dataProjection=ae("EPSG:4326"),this.readExtensions_=e.readExtensions}handleReadExtensions_(e){e||(e=[]);for(let t=0,n=e.length;t<n;++t){const i=e[t];if(this.readExtensions_){const s=i.get("extensionsNode_")||null;this.readExtensions_(i,s)}i.set("extensionsNode_",void 0)}}readMetadata(e){return e?typeof e=="string"?this.readMetadataFromDocument(Jn(e)):Qn(e)?this.readMetadataFromDocument(e):this.readMetadataFromNode(e):null}readMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType===Node.ELEMENT_NODE){const n=this.readMetadataFromNode(t);if(n)return n}return null}readMetadataFromNode(e){if(!xe.includes(e.namespaceURI))return null;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(xe.includes(t.namespaceURI)&&t.localName==="metadata")return O({},Od,t,[]);return null}readFeatureFromNode(e,t){if(!xe.includes(e.namespaceURI))return null;const n=Ld[e.localName];if(!n)return null;const i=n(e,[this.getReadOptions(e,t)]);return i?(this.handleReadExtensions_([i]),i):null}readFeaturesFromNode(e,t){if(!xe.includes(e.namespaceURI))return[];if(e.localName=="gpx"){const n=O([],Id,e,[this.getReadOptions(e,t)]);return n?(this.handleReadExtensions_(n),n):[]}return[]}writeFeaturesNode(e,t){t=this.adaptOptions(t);const n=H("http://www.topografix.com/GPX/1/1","gpx");return n.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xsi",Qr),n.setAttributeNS(Qr,"xsi:schemaLocation",Pd),n.setAttribute("version","1.1"),n.setAttribute("creator","OpenLayers"),_e({node:n},Nd,tp,e,[t]),n}}const Ud=D(xe,{name:b(F),cmt:b(F),desc:b(F),src:b(F),link:yn,number:b(Te),extensions:Ii,type:b(F),rtept:op}),Bd=D(xe,{ele:b(De),time:b(Ti)}),Gd=D(xe,{name:b(F),cmt:b(F),desc:b(F),src:b(F),link:yn,number:b(Te),type:b(F),extensions:Ii,trkseg:lp}),zd=D(xe,{trkpt:ap}),kd=D(xe,{ele:b(De),time:b(Ti)}),$d=D(xe,{ele:b(De),time:b(Ti),magvar:b(De),geoidheight:b(De),name:b(F),cmt:b(F),desc:b(F),src:b(F),link:yn,sym:b(F),type:b(F),fix:b(F),sat:b(Te),hdop:b(De),vdop:b(De),pdop:b(De),ageofdgpsdata:b(De),dgpsid:b(Te),extensions:Ii}),Vd=["text","type"],Xd=D(xe,{text:T(ee),type:T(ee)}),Wd=D(xe,["name","cmt","desc","src","link","number","type","rtept"]),jd=D(xe,{name:T(ee),cmt:T(ee),desc:T(ee),src:T(ee),link:T(oo),number:T(ei),type:T(ee),rtept:$l(T(ao))}),Hd=D(xe,["ele","time"]),Zd=D(xe,["name","cmt","desc","src","link","number","type","trkseg"]),Yd=D(xe,{name:T(ee),cmt:T(ee),desc:T(ee),src:T(ee),link:T(oo),number:T(ei),type:T(ee),trkseg:$l(T(hp))}),qd=Ye("trkpt"),Kd=D(xe,{trkpt:T(ao)}),Jd=D(xe,["ele","time","magvar","geoidheight","name","cmt","desc","src","link","sym","type","fix","sat","hdop","vdop","pdop","ageofdgpsdata","dgpsid"]),Qd=D(xe,{ele:T(Xt),time:T(mh),magvar:T(Xt),geoidheight:T(Xt),name:T(ee),cmt:T(ee),desc:T(ee),src:T(ee),link:T(oo),sym:T(ee),type:T(ee),fix:T(ee),sat:T(ei),hdop:T(Xt),vdop:T(Xt),pdop:T(Xt),ageofdgpsdata:T(Xt),dgpsid:T(ei)}),ep={Point:"wpt",LineString:"rte",MultiLineString:"trk"};function tp(r,e,t){const n=r.getGeometry();if(n){const i=ep[n.getType()];if(i){const s=e[e.length-1].node;return H(s.namespaceURI,i)}}}function io(r,e,t,n){return r.push(parseFloat(t.getAttribute("lon")),parseFloat(t.getAttribute("lat"))),"ele"in n?(r.push(n.ele),delete n.ele,e.hasZ=!0):r.push(0),"time"in n?(r.push(n.time),delete n.time,e.hasM=!0):r.push(0),r}function so(r,e,t){let n="XY",i=2;if(r.hasZ&&r.hasM?(n="XYZM",i=4):r.hasZ?(n="XYZ",i=3):r.hasM&&(n="XYM",i=3),i!==4){for(let s=0,o=e.length/4;s<o;s++)e[s*i]=e[s*4],e[s*i+1]=e[s*4+1],r.hasZ&&(e[s*i+2]=e[s*4+2]),r.hasM&&(e[s*i+2]=e[s*4+3]);if(e.length=e.length/4*i,t)for(let s=0,o=t.length;s<o;s++)t[s]=t[s]/4*i}return n}function rp(r,e){const t=O({},Fd,r,e);if(t)return t}function np(r,e){const t=O({},Md,r,e);if(t){const n=r.getAttribute("author");return n!==null&&(t.author=n),t}}function ip(r,e){const t=e[e.length-1],n=r.getAttribute("minlat"),i=r.getAttribute("minlon"),s=r.getAttribute("maxlat"),o=r.getAttribute("maxlon");i!==null&&n!==null&&o!==null&&s!==null&&(t.bounds=[[parseFloat(i),parseFloat(n)],[parseFloat(o),parseFloat(s)]])}function sp(r,e){const t=e[e.length-1],n=r.getAttribute("id"),i=r.getAttribute("domain");n!==null&&i!==null&&(t.email=`${n}@${i}`)}function yn(r,e){const t=e[e.length-1],n=r.getAttribute("href");n!==null&&(t.link=n),Dt(Cd,r,e)}function Ii(r,e){const t=e[e.length-1];t.extensionsNode_=r}function op(r,e){const t=O({},Bd,r,e);if(t){const n=e[e.length-1],i=n.flatCoordinates,s=n.layoutOptions;io(i,s,r,t)}}function ap(r,e){const t=O({},kd,r,e);if(t){const n=e[e.length-1],i=n.flatCoordinates,s=n.layoutOptions;io(i,s,r,t)}}function lp(r,e){const t=e[e.length-1];Dt(zd,r,e);const n=t.flatCoordinates;t.ends.push(n.length)}function fc(r,e){const t=e[0],n=O({flatCoordinates:[],layoutOptions:{}},Ud,r,e);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const s=n.layoutOptions;delete n.layoutOptions;const o=so(s,i),a=new At(i,o);Ue(a,!1,t);const c=new ct(a);return c.setProperties(n,!0),c}function dc(r,e){const t=e[0],n=O({flatCoordinates:[],ends:[],layoutOptions:{}},Gd,r,e);if(!n)return;const i=n.flatCoordinates;delete n.flatCoordinates;const s=n.ends;delete n.ends;const o=n.layoutOptions;delete n.layoutOptions;const a=so(o,i,s),c=new gn(i,a,s);Ue(c,!1,t);const l=new ct(c);return l.setProperties(n,!0),l}function pc(r,e){const t=e[0],n=O({},$d,r,e);if(!n)return;const i={},s=io([],i,r,n),o=so(i,s),a=new xt(s,o);Ue(a,!1,t);const c=new ct(a);return c.setProperties(n,!0),c}function oo(r,e,t){r.setAttribute("href",e);const i=t[t.length-1].properties,s=[i.linkText,i.linkType];_e({node:r},Xd,Ar,s,t,Vd)}function ao(r,e,t){const n=t[t.length-1],s=n.node.namespaceURI,o=n.properties;switch(r.setAttributeNS(null,"lat",String(e[1])),r.setAttributeNS(null,"lon",String(e[0])),n.geometryLayout){case"XYZM":e[3]!==0&&(o.time=e[3]);case"XYZ":e[2]!==0&&(o.ele=e[2]);break;case"XYM":e[2]!==0&&(o.time=e[2]);break}const c=r.nodeName=="rtept"?Hd[s]:Jd[s],l=Us(o,c);_e({node:r,properties:o},Qd,Ar,l,t,c)}function cp(r,e,t){const n=t[0],i=e.getProperties(),s={node:r};s.properties=i;const o=e.getGeometry();if(o.getType()=="LineString"){const u=Ue(o,!0,n);s.geometryLayout=u.getLayout(),i.rtept=u.getCoordinates()}const a=t[t.length-1].node,c=Wd[a.namespaceURI],l=Us(i,c);_e(s,jd,Ar,l,t,c)}function up(r,e,t){const n=t[0],i=e.getProperties(),s={node:r};s.properties=i;const o=e.getGeometry();if(o.getType()=="MultiLineString"){const u=Ue(o,!0,n);i.trkseg=u.getLineStrings()}const a=t[t.length-1].node,c=Zd[a.namespaceURI],l=Us(i,c);_e(s,Yd,Ar,l,t,c)}function hp(r,e,t){const n={node:r};n.geometryLayout=e.getLayout(),n.properties={},_e(n,Kd,qd,e.getCoordinates(),t)}function fp(r,e,t){const n=t[0],i=t[t.length-1];i.properties=e.getProperties();const s=e.getGeometry();if(s.getType()=="Point"){const o=Ue(s,!0,n);i.geometryLayout=o.getLayout(),ao(r,o.getCoordinates(),t)}}const dp=/^B(\d{2})(\d{2})(\d{2})(\d{2})(\d{5})([NS])(\d{3})(\d{5})([EW])([AV])(\d{5})(\d{5})/,pp=/^H.([A-Z]{3}).*?:(.*)/,gp=/^HFDTE(\d{2})(\d{2})(\d{2})/,mp=/^HFDTEDATE:(\d{2})(\d{2})(\d{2}),(\d{2})/,_p=/\r\n|\r|\n/;class yp extends ac{constructor(e){super(),e=e||{},this.dataProjection=ae("EPSG:4326"),this.altitudeMode_=e.altitudeMode?e.altitudeMode:"none",this.lad_=!1,this.lod_=!1,this.ladStart_=0,this.ladStop_=0,this.lodStart_=0,this.lodStop_=0}readFeatureFromText(e,t){const n=this.altitudeMode_,i=e.split(_p),s={},o=[];let a=2e3,c=0,l=1,u=-1,h,f;for(h=0,f=i.length;h<f;++h){const m=i[h];let y;if(m.charAt(0)=="B"){if(y=dp.exec(m),y){const _=parseInt(y[1],10),E=parseInt(y[2],10),S=parseInt(y[3],10);let R=parseInt(y[4],10)+parseInt(y[5],10)/6e4;this.lad_&&(R+=parseInt(m.slice(this.ladStart_,this.ladStop_),10)/6e4/10**(this.ladStop_-this.ladStart_)),y[6]=="S"&&(R=-R);let w=parseInt(y[7],10)+parseInt(y[8],10)/6e4;if(this.lod_&&(w+=parseInt(m.slice(this.lodStart_,this.lodStop_),10)/6e4/10**(this.lodStop_-this.lodStart_)),y[9]=="W"&&(w=-w),o.push(w,R),n!="none"){let C;n=="gps"?C=parseInt(y[11],10):n=="barometric"?C=parseInt(y[12],10):C=0,o.push(C)}let A=Date.UTC(a,c,l,_,E,S);A<u&&(A=Date.UTC(a,c,l+1,_,E,S)),o.push(A/1e3),u=A}}else if(m.charAt(0)=="H")y=mp.exec(m),y?(l=parseInt(y[1],10),c=parseInt(y[2],10)-1,a=2e3+parseInt(y[3],10)):(y=gp.exec(m),y?(l=parseInt(y[1],10),c=parseInt(y[2],10)-1,a=2e3+parseInt(y[3],10)):(y=pp.exec(m),y&&(s[y[1]]=y[2].trim())));else if(m.charAt(0)=="I"){const _=parseInt(m.slice(1,3),10);for(let E=0;E<_;E++){const S=m.slice(7+E*7,10+E*7);if(S==="LAD"||S==="LOD"){const R=parseInt(m.slice(3+E*7,5+E*7),10)-1,w=parseInt(m.slice(5+E*7,7+E*7),10);S==="LAD"?(this.lad_=!0,this.ladStart_=R,this.ladStop_=w):S==="LOD"&&(this.lod_=!0,this.lodStart_=R,this.lodStop_=w)}}}}if(o.length===0)return null;const d=n=="none"?"XYM":"XYZM",p=new At(o,d),g=new ct(Ue(p,!1,t));return g.setProperties(s,!0),g}readFeaturesFromText(e,t){const n=this.readFeatureFromText(e,t);return n?[n]:[]}}const Re={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},Qt={};Qt[Re.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}};Qt[Re.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}};Qt[Re.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}};Qt.none={none:{supports:[],formats:[],qualities:[]}};const xp=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,Ra=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,Ep=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;function bp(r){let e=r.getComplianceLevelSupportedFeatures();return e===void 0&&(e=Qt[Re.VERSION1].level0),{url:r.imageInfo["@id"]===void 0?void 0:r.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:e.supports,formats:[...e.formats,r.imageInfo.formats===void 0?[]:r.imageInfo.formats],qualities:[...e.qualities,r.imageInfo.qualities===void 0?[]:r.imageInfo.qualities],resolutions:r.imageInfo.scale_factors,tileSize:r.imageInfo.tile_width!==void 0?r.imageInfo.tile_height!==void 0?[r.imageInfo.tile_width,r.imageInfo.tile_height]:[r.imageInfo.tile_width,r.imageInfo.tile_width]:r.imageInfo.tile_height!=null?[r.imageInfo.tile_height,r.imageInfo.tile_height]:void 0}}function Tp(r){const e=r.getComplianceLevelSupportedFeatures(),t=Array.isArray(r.imageInfo.profile)&&r.imageInfo.profile.length>1,n=t&&r.imageInfo.profile[1].supports?r.imageInfo.profile[1].supports:[],i=t&&r.imageInfo.profile[1].formats?r.imageInfo.profile[1].formats:[],s=t&&r.imageInfo.profile[1].qualities?r.imageInfo.profile[1].qualities:[];return{url:r.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:r.imageInfo.sizes===void 0?void 0:r.imageInfo.sizes.map(function(o){return[o.width,o.height]}),tileSize:r.imageInfo.tiles===void 0?void 0:[r.imageInfo.tiles.map(function(o){return o.width})[0],r.imageInfo.tiles.map(function(o){return o.height===void 0?o.width:o.height})[0]],resolutions:r.imageInfo.tiles===void 0?void 0:r.imageInfo.tiles.map(function(o){return o.scaleFactors})[0],supports:[...e.supports,...n],formats:[...e.formats,...i],qualities:[...e.qualities,...s]}}function wp(r){const e=r.getComplianceLevelSupportedFeatures(),t=r.imageInfo.extraFormats===void 0?e.formats:[...e.formats,...r.imageInfo.extraFormats],n=r.imageInfo.preferredFormats!==void 0&&Array.isArray(r.imageInfo.preferredFormats)&&r.imageInfo.preferredFormats.length>0?r.imageInfo.preferredFormats.filter(function(i){return["jpg","png","gif"].includes(i)}).reduce(function(i,s){return i===void 0&&t.includes(s)?s:i},void 0):void 0;return{url:r.imageInfo.id,sizes:r.imageInfo.sizes===void 0?void 0:r.imageInfo.sizes.map(function(i){return[i.width,i.height]}),tileSize:r.imageInfo.tiles===void 0?void 0:[r.imageInfo.tiles.map(function(i){return i.width})[0],r.imageInfo.tiles.map(function(i){return i.height})[0]],resolutions:r.imageInfo.tiles===void 0?void 0:r.imageInfo.tiles.map(function(i){return i.scaleFactors})[0],supports:r.imageInfo.extraFeatures===void 0?e.supports:[...e.supports,...r.imageInfo.extraFeatures],formats:t,qualities:r.imageInfo.extraQualities===void 0?e.qualities:[...e.qualities,...r.imageInfo.extraQualities],preferredFormat:n}}const Ci={};Ci[Re.VERSION1]=bp;Ci[Re.VERSION2]=Tp;Ci[Re.VERSION3]=wp;class Sp{constructor(e){this.setImageInfo(e)}setImageInfo(e){typeof e=="string"?this.imageInfo=JSON.parse(e):this.imageInfo=e}getImageApiVersion(){if(this.imageInfo===void 0)return;let e=this.imageInfo["@context"]||"ol-no-context";typeof e=="string"&&(e=[e]);for(let t=0;t<e.length;t++)switch(e[t]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return Re.VERSION1;case"http://iiif.io/api/image/2/context.json":return Re.VERSION2;case"http://iiif.io/api/image/3/context.json":return Re.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(Re.VERSION1)&&this.imageInfo.identifier)return Re.VERSION1;break}Je(!1,"Cannot determine IIIF Image API version from provided image information JSON")}getComplianceLevelEntryFromProfile(e){if(!(this.imageInfo===void 0||this.imageInfo.profile===void 0))switch(e===void 0&&(e=this.getImageApiVersion()),e){case Re.VERSION1:if(xp.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Re.VERSION3:if(Ep.test(this.imageInfo.profile))return this.imageInfo.profile;break;case Re.VERSION2:if(typeof this.imageInfo.profile=="string"&&Ra.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&typeof this.imageInfo.profile[0]=="string"&&Ra.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0];break}}getComplianceLevelFromProfile(e){const t=this.getComplianceLevelEntryFromProfile(e);if(t===void 0)return;const n=t.match(/level[0-2](?:\.json)?$/g);return Array.isArray(n)?n[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(this.imageInfo===void 0)return;const e=this.getImageApiVersion(),t=this.getComplianceLevelFromProfile(e);return t===void 0?Qt.none.none:Qt[e][t]}getTileSourceOptions(e){const t=e||{},n=this.getImageApiVersion();if(n===void 0)return;const i=n===void 0?void 0:Ci[n](this);if(i!==void 0)return{url:i.url,version:n,size:[this.imageInfo.width,this.imageInfo.height],sizes:i.sizes,format:t.format!==void 0&&i.formats.includes(t.format)?t.format:i.preferredFormat!==void 0?i.preferredFormat:"jpg",supports:i.supports,quality:t.quality&&i.qualities.includes(t.quality)?t.quality:i.qualities.includes("native")?"native":"default",resolutions:Array.isArray(i.resolutions)?i.resolutions.sort(function(s,o){return o-s}):void 0,tileSize:i.tileSize}}}class lo{read(e){if(!e)return null;if(typeof e=="string"){const t=Jn(e);return this.readFromDocument(t)}return Qn(e)?this.readFromDocument(e):this.readFromNode(e)}readFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFromNode(t);return null}readFromNode(e){Js()}}const Rp="http://www.w3.org/1999/xlink";function Cr(r){return r.getAttributeNS(Rp,"href")}const je=[null,"http://www.opengis.net/ows/1.1"],vp=D(je,{ServiceIdentification:b(qp),ServiceProvider:b(Jp),OperationsMetadata:b(Zp)});class gc extends lo{constructor(){super()}readFromNode(e){const t=O({},vp,e,[]);return t||null}}const Ap=D(je,{DeliveryPoint:b(F),City:b(F),AdministrativeArea:b(F),PostalCode:b(F),Country:b(F),ElectronicMailAddress:b(F)}),Pp=D(je,{Value:ue(Qp)}),Lp=D(je,{AllowedValues:b(kp)}),Ip=D(je,{Phone:b(Yp),Address:b(zp)}),Cp=D(je,{HTTP:b(jp)}),Fp=D(je,{Get:ue(Wp),Post:void 0}),Op=D(je,{DCP:b(Xp)}),Mp=D(je,{Operation:Hp}),Np=D(je,{Voice:b(F),Facsimile:b(F)}),Dp=D(je,{Constraint:ue($p)}),Up=D(je,{IndividualName:b(F),PositionName:b(F),ContactInfo:b(Vp)}),Bp=D(je,{Abstract:b(F),AccessConstraints:b(F),Fees:b(F),Title:b(F),ServiceTypeVersion:b(F),ServiceType:b(F)}),Gp=D(je,{ProviderName:b(F),ProviderSite:b(Cr),ServiceContact:b(Kp)});function zp(r,e){return O({},Ap,r,e)}function kp(r,e){return O({},Pp,r,e)}function $p(r,e){const t=r.getAttribute("name");if(t)return O({name:t},Lp,r,e)}function Vp(r,e){return O({},Ip,r,e)}function Xp(r,e){return O({},Cp,r,e)}function Wp(r,e){const t=Cr(r);if(t)return O({href:t},Dp,r,e)}function jp(r,e){return O({},Fp,r,e)}function Hp(r,e){const t=r.getAttribute("name"),n=O({},Op,r,e);if(!n)return;const i=e[e.length-1];i[t]=n}function Zp(r,e){return O({},Mp,r,e)}function Yp(r,e){return O({},Np,r,e)}function qp(r,e){return O({},Bp,r,e)}function Kp(r,e){return O({},Up,r,e)}function Jp(r,e){return O({},Gp,r,e)}function Qp(r,e){return F(r)}function va(r,e,t,n,i,s){i!==void 0?(i=i,s=s!==void 0?s:0):(i=[],s=0);let o=e;for(;o<t;){const a=r[o++];i[s++]=r[o++],i[s++]=a;for(let c=2;c<n;++c)i[s++]=r[o++]}return i.length=s,i}class eg extends ac{constructor(e){super(),e=e||{},this.dataProjection=ae("EPSG:4326"),this.factor_=e.factor?e.factor:1e5,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY"}readFeatureFromText(e,t){const n=this.readGeometryFromText(e,t);return new ct(n)}readFeaturesFromText(e,t){return[this.readFeatureFromText(e,t)]}readGeometryFromText(e,t){const n=lf(this.geometryLayout_),i=rg(e,n,this.factor_);va(i,0,i.length,n,i);const s=cf(i,0,i.length,n),o=new At(s,this.geometryLayout_);return Ue(o,!1,this.adaptOptions(t))}writeFeatureText(e,t){const n=e.getGeometry();if(n)return this.writeGeometryText(n,t);throw new Error("Expected `feature` to have a geometry")}writeFeaturesText(e,t){return this.writeFeatureText(e[0],t)}writeGeometryText(e,t){e=Ue(e,!0,this.adaptOptions(t));const n=e.getFlatCoordinates(),i=e.getStride();return va(n,0,n.length,i,n),tg(n,i,this.factor_)}}function tg(r,e,t){t=t||1e5;let n;const i=new Array(e);for(n=0;n<e;++n)i[n]=0;for(let s=0,o=r.length;s<o;)for(n=0;n<e;++n,++s){const a=r[s],c=a-i[n];i[n]=a,r[s]=c}return ng(r,t)}function rg(r,e,t){t=t||1e5;let n;const i=new Array(e);for(n=0;n<e;++n)i[n]=0;const s=ig(r,t);for(let o=0,a=s.length;o<a;)for(n=0;n<e;++n,++o)i[n]+=s[o],s[o]=i[n];return s}function ng(r,e){e=e||1e5;for(let t=0,n=r.length;t<n;++t)r[t]=Math.round(r[t]*e);return sg(r)}function ig(r,e){e=e||1e5;const t=og(r);for(let n=0,i=t.length;n<i;++n)t[n]/=e;return t}function sg(r){for(let e=0,t=r.length;e<t;++e){const n=r[e];r[e]=n<0?~(n<<1):n<<1}return ag(r)}function og(r){const e=lg(r);for(let t=0,n=e.length;t<n;++t){const i=e[t];e[t]=i&1?~(i>>1):i>>1}return e}function ag(r){let e="";for(let t=0,n=r.length;t<n;++t)e+=cg(r[t]);return e}function lg(r){const e=[];let t=0,n=0;for(let i=0,s=r.length;i<s;++i){const o=r.charCodeAt(i)-63;t|=(o&31)<<n,o<32?(e.push(t),t=0,n=0):n+=5}return e}function cg(r){let e,t="";for(;r>=32;)e=(32|r&31)+63,t+=String.fromCharCode(e),r>>=5;return e=r+63,t+=String.fromCharCode(e),t}class ie extends I{constructor(e){e=e||{},super(e),this.schemaLocation=e.schemaLocation?e.schemaLocation:this.namespace+" http://schemas.opengis.net/gml/3.2.1/gml.xsd"}writeGeometryElement(e,t,n){const i=n[n.length-1];n[n.length-1]=Object.assign({multiCurve:!0,multiSurface:!0},i),super.writeGeometryElement(e,t,n)}}ie.prototype.namespace="http://www.opengis.net/gml/3.2";ie.prototype.GEOMETRY_FLAT_COORDINATES_PARSERS={"http://www.opengis.net/gml/3.2":{pos:V(I.prototype.readFlatPos),posList:V(I.prototype.readFlatPosList),coordinates:V(J.prototype.readFlatCoordinates)}};ie.prototype.FLAT_LINEAR_RINGS_PARSERS={"http://www.opengis.net/gml/3.2":{interior:I.prototype.interiorParser,exterior:I.prototype.exteriorParser}};ie.prototype.GEOMETRY_PARSERS={"http://www.opengis.net/gml/3.2":{Point:V(B.prototype.readPoint),MultiPoint:V(B.prototype.readMultiPoint),LineString:V(B.prototype.readLineString),MultiLineString:V(B.prototype.readMultiLineString),LinearRing:V(B.prototype.readLinearRing),Polygon:V(B.prototype.readPolygon),MultiPolygon:V(B.prototype.readMultiPolygon),Surface:V(ie.prototype.readSurface),MultiSurface:V(I.prototype.readMultiSurface),Curve:V(ie.prototype.readCurve),MultiCurve:V(I.prototype.readMultiCurve),Envelope:V(ie.prototype.readEnvelope)}};ie.prototype.MULTICURVE_PARSERS={"http://www.opengis.net/gml/3.2":{curveMember:$(I.prototype.curveMemberParser),curveMembers:$(I.prototype.curveMemberParser)}};ie.prototype.MULTISURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{surfaceMember:$(I.prototype.surfaceMemberParser),surfaceMembers:$(I.prototype.surfaceMemberParser)}};ie.prototype.CURVEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:$(B.prototype.readLineString),Curve:$(I.prototype.readCurve)}};ie.prototype.SURFACEMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:$(B.prototype.readPolygon),Surface:$(I.prototype.readSurface)}};ie.prototype.SURFACE_PARSERS={"http://www.opengis.net/gml/3.2":{patches:V(I.prototype.readPatch)}};ie.prototype.CURVE_PARSERS={"http://www.opengis.net/gml/3.2":{segments:V(I.prototype.readSegment)}};ie.prototype.ENVELOPE_PARSERS={"http://www.opengis.net/gml/3.2":{lowerCorner:$(I.prototype.readFlatPosList),upperCorner:$(I.prototype.readFlatPosList)}};ie.prototype.PATCHES_PARSERS={"http://www.opengis.net/gml/3.2":{PolygonPatch:V(I.prototype.readPolygonPatch)}};ie.prototype.SEGMENTS_PARSERS={"http://www.opengis.net/gml/3.2":{LineStringSegment:kl(I.prototype.readLineStringSegment)}};ie.prototype.MULTIPOINT_PARSERS={"http://www.opengis.net/gml/3.2":{pointMember:$(B.prototype.pointMemberParser),pointMembers:$(B.prototype.pointMemberParser)}};ie.prototype.MULTILINESTRING_PARSERS={"http://www.opengis.net/gml/3.2":{lineStringMember:$(B.prototype.lineStringMemberParser),lineStringMembers:$(B.prototype.lineStringMemberParser)}};ie.prototype.MULTIPOLYGON_PARSERS={"http://www.opengis.net/gml/3.2":{polygonMember:$(B.prototype.polygonMemberParser),polygonMembers:$(B.prototype.polygonMemberParser)}};ie.prototype.POINTMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Point:$(B.prototype.readFlatCoordinatesFromNode)}};ie.prototype.LINESTRINGMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{LineString:$(B.prototype.readLineString)}};ie.prototype.POLYGONMEMBER_PARSERS={"http://www.opengis.net/gml/3.2":{Polygon:$(B.prototype.readPolygon)}};ie.prototype.RING_PARSERS={"http://www.opengis.net/gml/3.2":{LinearRing:V(B.prototype.readFlatLinearRing),Ring:V(ie.prototype.readFlatCurveRing)}};ie.prototype.RING_SERIALIZERS={"http://www.opengis.net/gml/3.2":{exterior:T(I.prototype.writeRing),interior:T(I.prototype.writeRing)}};ie.prototype.ENVELOPE_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lowerCorner:T(ee),upperCorner:T(ee)}};ie.prototype.SURFACEORPOLYGONMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{surfaceMember:T(I.prototype.writeSurfaceOrPolygonMember),polygonMember:T(I.prototype.writeSurfaceOrPolygonMember)}};ie.prototype.POINTMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{pointMember:T(I.prototype.writePointMember)}};ie.prototype.LINESTRINGORCURVEMEMBER_SERIALIZERS={"http://www.opengis.net/gml/3.2":{lineStringMember:T(I.prototype.writeLineStringOrCurveMember),curveMember:T(I.prototype.writeLineStringOrCurveMember)}};ie.prototype.GEOMETRY_SERIALIZERS={"http://www.opengis.net/gml/3.2":{Curve:T(I.prototype.writeCurveOrLineString),MultiCurve:T(I.prototype.writeMultiCurveOrLineString),Point:T(ie.prototype.writePoint),MultiPoint:T(I.prototype.writeMultiPoint),LineString:T(I.prototype.writeCurveOrLineString),MultiLineString:T(I.prototype.writeMultiCurveOrLineString),LinearRing:T(I.prototype.writeLinearRing),Polygon:T(I.prototype.writeSurfaceOrPolygon),MultiPolygon:T(I.prototype.writeMultiSurfaceOrPolygon),Surface:T(I.prototype.writeSurfaceOrPolygon),MultiSurface:T(I.prototype.writeMultiSurfaceOrPolygon),Envelope:T(I.prototype.writeEnvelope)}};class mc{constructor(e){this.tagName_=e}getTagName(){return this.tagName_}}class ug extends mc{constructor(e,t){super(e),this.conditions=t,Je(this.conditions.length>=2,"At least 2 conditions are required")}}class hg extends ug{constructor(e){super("And",Array.prototype.slice.call(arguments))}}class fg extends mc{constructor(e,t,n){if(super("BBOX"),this.geometryName=e,this.extent=t,t.length!==4)throw new Error("Expected an extent with four values ([minX, minY, maxX, maxY])");this.srsName=n}}function dg(r){const e=[null].concat(Array.prototype.slice.call(arguments));return new(Function.prototype.bind.apply(hg,e))}function pg(r,e,t){return new fg(r,e,t)}const Aa={"http://www.opengis.net/gml":{boundedBy:b(B.prototype.readExtentElement,"bounds")},"http://www.opengis.net/wfs/2.0":{member:$(B.prototype.readFeaturesInternal)}},gg={"http://www.opengis.net/wfs":{totalInserted:b(Te),totalUpdated:b(Te),totalDeleted:b(Te)},"http://www.opengis.net/wfs/2.0":{totalInserted:b(Te),totalUpdated:b(Te),totalDeleted:b(Te)}},mg={"http://www.opengis.net/wfs":{TransactionSummary:b(La,"transactionSummary"),InsertResults:b(Ca,"insertIds")},"http://www.opengis.net/wfs/2.0":{TransactionSummary:b(La,"transactionSummary"),InsertResults:b(Ca,"insertIds")}},_g={"http://www.opengis.net/wfs":{PropertyName:T(ee)},"http://www.opengis.net/wfs/2.0":{PropertyName:T(ee)}},_c={"http://www.opengis.net/wfs":{Insert:T(Fa),Update:T(Ma),Delete:T(Oa),Property:T(Na),Native:T(Da)},"http://www.opengis.net/wfs/2.0":{Insert:T(Fa),Update:T(Ma),Delete:T(Oa),Property:T(Na),Native:T(Da)}},yc="feature",co="http://www.w3.org/2000/xmlns/",uo={"2.0.0":"http://www.opengis.net/ogc/1.1","1.1.0":"http://www.opengis.net/ogc","1.0.0":"http://www.opengis.net/ogc"},ms={"2.0.0":"http://www.opengis.net/wfs/2.0","1.1.0":"http://www.opengis.net/wfs","1.0.0":"http://www.opengis.net/wfs"},ho={"2.0.0":"http://www.opengis.net/fes/2.0","1.1.0":"http://www.opengis.net/fes","1.0.0":"http://www.opengis.net/fes"},Pa={"2.0.0":"http://www.opengis.net/wfs/2.0 http://schemas.opengis.net/wfs/2.0/wfs.xsd","1.1.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.1.0/wfs.xsd","1.0.0":"http://www.opengis.net/wfs http://schemas.opengis.net/wfs/1.0.0/wfs.xsd"},fo={"2.0.0":ie,"1.1.0":I,"1.0.0":J},yg="1.1.0";class xg extends bi{constructor(e){super(),e=e||{},this.version_=e.version?e.version:yg,this.featureType_=e.featureType,this.featureNS_=e.featureNS,this.gmlFormat_=e.gmlFormat?e.gmlFormat:new fo[this.version_],this.schemaLocation_=e.schemaLocation?e.schemaLocation:Pa[this.version_]}getFeatureType(){return this.featureType_}setFeatureType(e){this.featureType_=e}readFeaturesFromNode(e,t){const n={node:e};Object.assign(n,{featureType:this.featureType_,featureNS:this.featureNS_}),Object.assign(n,this.getReadOptions(e,t||{}));const i=[n];let s;this.version_==="2.0.0"?s=Aa:s=this.gmlFormat_.FEATURE_COLLECTION_PARSERS;let o=O([],s,e,i,this.gmlFormat_);return o||(o=[]),o}readTransactionResponse(e){if(e){if(typeof e=="string"){const t=Jn(e);return this.readTransactionResponseFromDocument(t)}return Qn(e)?this.readTransactionResponseFromDocument(e):this.readTransactionResponseFromNode(e)}}readFeatureCollectionMetadata(e){if(e){if(typeof e=="string"){const t=Jn(e);return this.readFeatureCollectionMetadataFromDocument(t)}return Qn(e)?this.readFeatureCollectionMetadataFromDocument(e):this.readFeatureCollectionMetadataFromNode(e)}}readFeatureCollectionMetadataFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readFeatureCollectionMetadataFromNode(t)}readFeatureCollectionMetadataFromNode(e){const t={},n=Mt(e.getAttribute("numberOfFeatures"));return t.numberOfFeatures=n,O(t,Aa,e,[],this.gmlFormat_)}readTransactionResponseFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readTransactionResponseFromNode(t)}readTransactionResponseFromNode(e){return O({},mg,e,[])}writeGetFeature(e){const t=H(ms[this.version_],"GetFeature");t.setAttribute("service","WFS"),t.setAttribute("version",this.version_),e.handle&&t.setAttribute("handle",e.handle),e.outputFormat&&t.setAttribute("outputFormat",e.outputFormat),e.maxFeatures!==void 0&&t.setAttribute("maxFeatures",String(e.maxFeatures)),e.resultType&&t.setAttribute("resultType",e.resultType),e.startIndex!==void 0&&t.setAttribute("startIndex",String(e.startIndex)),e.count!==void 0&&t.setAttribute("count",String(e.count)),e.viewParams!==void 0&&t.setAttribute("viewParams",e.viewParams),t.setAttributeNS(Qr,"xsi:schemaLocation",this.schemaLocation_);const n={node:t};if(Object.assign(n,{version:this.version_,srsName:e.srsName,featureNS:e.featureNS?e.featureNS:this.featureNS_,featurePrefix:e.featurePrefix,propertyNames:e.propertyNames?e.propertyNames:[]}),Je(Array.isArray(e.featureTypes),"`options.featureTypes` must be an Array"),typeof e.featureTypes[0]=="string"){let i=e.filter;e.bbox&&(Je(e.geometryName,"`options.geometryName` must also be provided when `options.bbox` is set"),i=this.combineBboxAndFilter(e.geometryName,e.bbox,e.srsName,i)),Object.assign(n,{geometryName:e.geometryName,filter:i}),ja(t,e.featureTypes,[n])}else e.featureTypes.forEach(i=>{const s=this.combineBboxAndFilter(i.geometryName,i.bbox,e.srsName,e.filter);Object.assign(n,{geometryName:i.geometryName,filter:s}),ja(t,[i.name],[n])});return t}combineBboxAndFilter(e,t,n,i){const s=pg(e,t,n);return i?dg(i,s):s}writeTransaction(e,t,n,i){const s=[],o=i.version?i.version:this.version_,a=H(ms[o],"Transaction");a.setAttribute("service","WFS"),a.setAttribute("version",o);let c;i&&(c=i.gmlOptions?i.gmlOptions:{},i.handle&&a.setAttribute("handle",i.handle)),a.setAttributeNS(Qr,"xsi:schemaLocation",Pa[o]);const l=Eg(a,c,o,i);return e&&Mn("Insert",e,s,l),t&&Mn("Update",t,s,l),n&&Mn("Delete",n,s,l),i.nativeElements&&Mn("Native",i.nativeElements,s,l),a}readProjectionFromDocument(e){for(let t=e.firstChild;t;t=t.nextSibling)if(t.nodeType==Node.ELEMENT_NODE)return this.readProjectionFromNode(t);return null}readProjectionFromNode(e){if(e.firstElementChild&&e.firstElementChild.firstElementChild){e=e.firstElementChild.firstElementChild;for(let t=e.firstElementChild;t;t=t.nextElementSibling)if(!(t.childNodes.length===0||t.childNodes.length===1&&t.firstChild.nodeType===3)){const n=[{}];return this.gmlFormat_.readGeometryElement(t,n),ae(n.pop().srsName)}}return null}}function Eg(r,e,t,n){const i=n.featurePrefix?n.featurePrefix:yc;let s;return t==="1.0.0"?s=2:t==="1.1.0"?s=3:t==="2.0.0"&&(s=3.2),Object.assign({node:r},{version:t,featureNS:n.featureNS,featureType:n.featureType,featurePrefix:i,gmlVersion:s,hasZ:n.hasZ,srsName:n.srsName},e)}function Mn(r,e,t,n){_e(n,_c,Ye(r),e,t)}function La(r,e){return O({},gg,r,e)}const bg={"http://www.opengis.net/ogc":{FeatureId:$(function(r,e){return r.getAttribute("fid")})},"http://www.opengis.net/ogc/1.1":{FeatureId:$(function(r,e){return r.getAttribute("fid")})}};function Ia(r,e){Dt(bg,r,e)}const Tg={"http://www.opengis.net/wfs":{Feature:Ia},"http://www.opengis.net/wfs/2.0":{Feature:Ia}};function Ca(r,e){return O([],Tg,r,e)}function Fa(r,e,t){const n=t[t.length-1],i=n.featureType,s=n.featureNS,o=n.gmlVersion,a=H(s,i);r.appendChild(a),o===2?J.prototype.writeFeatureElement(a,e,t):o===3?I.prototype.writeFeatureElement(a,e,t):ie.prototype.writeFeatureElement(a,e,t)}function xc(r,e,t){const i=t[t.length-1].version,s=uo[i],o=H(s,"Filter"),a=H(s,"FeatureId");o.appendChild(a),a.setAttribute("fid",e),r.appendChild(o)}function po(r,e){r=r||yc;const t=r+":";return e.startsWith(t)?e:t+e}function Oa(r,e,t){const n=t[t.length-1];Je(e.getId()!==void 0,"Features must have an id set");const i=n.featureType,s=n.featurePrefix,o=n.featureNS,a=po(s,i);r.setAttribute("typeName",a),r.setAttributeNS(co,"xmlns:"+s,o);const c=e.getId();c!==void 0&&xc(r,c,t)}function Ma(r,e,t){const n=t[t.length-1];Je(e.getId()!==void 0,"Features must have an id set");const i=n.version,s=n.featureType,o=n.featurePrefix,a=n.featureNS,c=po(o,s),l=e.getGeometryName();r.setAttribute("typeName",c),r.setAttributeNS(co,"xmlns:"+o,a);const u=e.getId();if(u!==void 0){const h=e.getKeys(),f=[];for(let d=0,p=h.length;d<p;d++){const g=e.get(h[d]);if(g!==void 0){let m=h[d];g&&typeof g.getSimplifiedGeometry=="function"&&(m=l),f.push({name:m,value:g})}}_e({version:i,gmlVersion:n.gmlVersion,node:r,hasZ:n.hasZ,srsName:n.srsName},_c,Ye("Property"),f,t),xc(r,u,t)}}function Na(r,e,t){const n=t[t.length-1],i=n.version,s=ms[i],a=H(s,i==="2.0.0"?"ValueReference":"Name"),c=n.gmlVersion;if(r.appendChild(a),ee(a,e.name),e.value!==void 0&&e.value!==null){const l=H(s,"Value");r.appendChild(l),e.value&&typeof e.value.getSimplifiedGeometry=="function"?c===2?J.prototype.writeGeometryElement(l,e.value,t):c===3?I.prototype.writeGeometryElement(l,e.value,t):ie.prototype.writeGeometryElement(l,e.value,t):ee(l,e.value)}}function Da(r,e,t){e.vendorId&&r.setAttribute("vendorId",e.vendorId),e.safeToIgnore!==void 0&&r.setAttribute("safeToIgnore",String(e.safeToIgnore)),e.value!==void 0&&ee(r,e.value)}const Fi={"http://www.opengis.net/wfs":{Query:T(Ua)},"http://www.opengis.net/wfs/2.0":{Query:T(Ua)},"http://www.opengis.net/ogc":{During:T(za),And:T(Nn),Or:T(Nn),Not:T(ka),BBOX:T(Ba),Contains:T(Ft),Intersects:T(Ft),Within:T(Ft),DWithin:T(Ga),PropertyIsEqualTo:T(qe),PropertyIsNotEqualTo:T(qe),PropertyIsLessThan:T(qe),PropertyIsLessThanOrEqualTo:T(qe),PropertyIsGreaterThan:T(qe),PropertyIsGreaterThanOrEqualTo:T(qe),PropertyIsNull:T($a),PropertyIsBetween:T(Va),PropertyIsLike:T(Xa)},"http://www.opengis.net/fes/2.0":{During:T(za),And:T(Nn),Or:T(Nn),Not:T(ka),BBOX:T(Ba),Contains:T(Ft),Disjoint:T(Ft),Intersects:T(Ft),ResourceId:T(Sg),Within:T(Ft),DWithin:T(Ga),PropertyIsEqualTo:T(qe),PropertyIsNotEqualTo:T(qe),PropertyIsLessThan:T(qe),PropertyIsLessThanOrEqualTo:T(qe),PropertyIsGreaterThan:T(qe),PropertyIsGreaterThanOrEqualTo:T(qe),PropertyIsNull:T($a),PropertyIsBetween:T(Va),PropertyIsLike:T(Xa)}};function Ua(r,e,t){const n=t[t.length-1],i=n.version,s=n.featurePrefix,o=n.featureNS,a=n.propertyNames,c=n.srsName;let l;s?l=po(s,e):l=e;let u;i==="2.0.0"?u="typeNames":u="typeName",r.setAttribute(u,l),c&&r.setAttribute("srsName",c),o&&r.setAttributeNS(co,"xmlns:"+s,o);const h=Object.assign({},n);h.node=r,_e(h,_g,Ye("PropertyName"),a,t);const f=n.filter;if(f){const d=H(Oi(i),"Filter");r.appendChild(d),wg(d,f,t)}}function wg(r,e,t){const n=t[t.length-1],i={node:r};Object.assign(i,{context:n}),_e(i,Fi,Ye(e.getTagName()),[e],t)}function Ba(r,e,t){const n=t[t.length-1],s=n.context.version;n.srsName=e.srsName;const o=fo[s];Fr(s,r,e.geometryName),o.prototype.writeGeometryElement(r,e.extent,t)}function Sg(r,e,t){r.setAttribute("rid",e.rid)}function Ft(r,e,t){const n=t[t.length-1],s=n.context.version;n.srsName=e.srsName;const o=fo[s];Fr(s,r,e.geometryName),o.prototype.writeGeometryElement(r,e.geometry,t)}function Ga(r,e,t){const s=t[t.length-1].context.version;Ft(r,e,t);const o=H(Oi(s),"Distance");ee(o,e.distance.toString()),s==="2.0.0"?o.setAttribute("uom",e.unit):o.setAttribute("units",e.unit),r.appendChild(o)}function za(r,e,t){const s=t[t.length-1].context.version;ai(ho[s],"ValueReference",r,e.propertyName);const o=H(vt,"TimePeriod");r.appendChild(o);const a=H(vt,"begin");o.appendChild(a),Wa(a,e.begin);const c=H(vt,"end");o.appendChild(c),Wa(c,e.end)}function Nn(r,e,t){const i=t[t.length-1].context,s={node:r};Object.assign(s,{context:i});const o=e.conditions;for(let a=0,c=o.length;a<c;++a){const l=o[a];_e(s,Fi,Ye(l.getTagName()),[l],t)}}function ka(r,e,t){const i=t[t.length-1].context,s={node:r};Object.assign(s,{context:i});const o=e.condition;_e(s,Fi,Ye(o.getTagName()),[o],t)}function qe(r,e,t){const s=t[t.length-1].context.version;e.matchCase!==void 0&&r.setAttribute("matchCase",e.matchCase.toString()),Fr(s,r,e.propertyName),li(s,r,""+e.expression)}function $a(r,e,t){const s=t[t.length-1].context.version;Fr(s,r,e.propertyName)}function Va(r,e,t){const s=t[t.length-1].context.version,o=Oi(s);Fr(s,r,e.propertyName);const a=H(o,"LowerBoundary");r.appendChild(a),li(s,a,""+e.lowerBoundary);const c=H(o,"UpperBoundary");r.appendChild(c),li(s,c,""+e.upperBoundary)}function Xa(r,e,t){const s=t[t.length-1].context.version;r.setAttribute("wildCard",e.wildCard),r.setAttribute("singleChar",e.singleChar),r.setAttribute("escapeChar",e.escapeChar),e.matchCase!==void 0&&r.setAttribute("matchCase",e.matchCase.toString()),Fr(s,r,e.propertyName),li(s,r,""+e.pattern)}function ai(r,e,t,n){const i=H(r,e);ee(i,n),t.appendChild(i)}function li(r,e,t){ai(Oi(r),"Literal",e,t)}function Fr(r,e,t){r==="2.0.0"?ai(ho[r],"ValueReference",e,t):ai(uo[r],"PropertyName",e,t)}function Wa(r,e){const t=H(vt,"TimeInstant");r.appendChild(t);const n=H(vt,"timePosition");t.appendChild(n),ee(n,e)}function ja(r,e,t){const n=t[t.length-1],i=Object.assign({},n);i.node=r,_e(i,Fi,Ye("Query"),e,t)}function Oi(r){let e;return r==="2.0.0"?e=ho[r]:e=uo[r],e}const fe={POINT:1,LINE_STRING:2,POLYGON:3,MULTI_POINT:4,MULTI_LINE_STRING:5,MULTI_POLYGON:6,GEOMETRY_COLLECTION:7,POLYHEDRAL_SURFACE:15,TIN:16,TRIANGLE:17};class Ha{constructor(e){this.view_=e,this.pos_=0,this.initialized_=!1,this.isLittleEndian_=!1,this.hasZ_=!1,this.hasM_=!1,this.srid_=null,this.layout_="XY"}readUint8(){return this.view_.getUint8(this.pos_++)}readUint32(e){return this.view_.getUint32((this.pos_+=4)-4,e!==void 0?e:this.isLittleEndian_)}readDouble(e){return this.view_.getFloat64((this.pos_+=8)-8,e!==void 0?e:this.isLittleEndian_)}readPoint(){const e=[];return e.push(this.readDouble()),e.push(this.readDouble()),this.hasZ_&&e.push(this.readDouble()),this.hasM_&&e.push(this.readDouble()),e}readLineString(){const e=this.readUint32(),t=[];for(let n=0;n<e;n++)t.push(this.readPoint());return t}readPolygon(){const e=this.readUint32(),t=[];for(let n=0;n<e;n++)t.push(this.readLineString());return t}readWkbHeader(e){const n=this.readUint8()>0,i=this.readUint32(n),s=Math.floor((i&268435455)/1e3),o=!!(i&2147483648)||s===1||s===3,a=!!(i&1073741824)||s===2||s===3,c=!!(i&536870912),l=(i&268435455)%1e3,u=["XY",o?"Z":"",a?"M":""].join(""),h=c?this.readUint32(n):null;if(e!==void 0&&e!==l)throw new Error("Unexpected WKB geometry type "+l);if(this.initialized_){if(this.isLittleEndian_!==n)throw new Error("Inconsistent endian");if(this.layout_!==u)throw new Error("Inconsistent geometry layout");if(h&&this.srid_!==h)throw new Error("Inconsistent coordinate system (SRID)")}else this.isLittleEndian_=n,this.hasZ_=o,this.hasM_=a,this.layout_=u,this.srid_=h,this.initialized_=!0;return l}readWkbPayload(e){switch(e){case fe.POINT:return this.readPoint();case fe.LINE_STRING:return this.readLineString();case fe.POLYGON:case fe.TRIANGLE:return this.readPolygon();case fe.MULTI_POINT:return this.readMultiPoint();case fe.MULTI_LINE_STRING:return this.readMultiLineString();case fe.MULTI_POLYGON:case fe.POLYHEDRAL_SURFACE:case fe.TIN:return this.readMultiPolygon();case fe.GEOMETRY_COLLECTION:return this.readGeometryCollection();default:throw new Error("Unsupported WKB geometry type "+e+" is found")}}readWkbBlock(e){return this.readWkbPayload(this.readWkbHeader(e))}readWkbCollection(e,t){const n=this.readUint32(),i=[];for(let s=0;s<n;s++){const o=e.call(this,t);o&&i.push(o)}return i}readMultiPoint(){return this.readWkbCollection(this.readWkbBlock,fe.POINT)}readMultiLineString(){return this.readWkbCollection(this.readWkbBlock,fe.LINE_STRING)}readMultiPolygon(){return this.readWkbCollection(this.readWkbBlock,fe.POLYGON)}readGeometryCollection(){return this.readWkbCollection(this.readGeometry)}readGeometry(){const e=this.readWkbHeader(),t=this.readWkbPayload(e);switch(e){case fe.POINT:return new xt(t,this.layout_);case fe.LINE_STRING:return new At(t,this.layout_);case fe.POLYGON:case fe.TRIANGLE:return new Pi(t,this.layout_);case fe.MULTI_POINT:return new js(t,this.layout_);case fe.MULTI_LINE_STRING:return new gn(t,this.layout_);case fe.MULTI_POLYGON:case fe.POLYHEDRAL_SURFACE:case fe.TIN:return new Ai(t,this.layout_);case fe.GEOMETRY_COLLECTION:return new sn(t);default:return null}}getSrid(){return this.srid_}}class Rg{constructor(e){e=e||{},this.layout_=e.layout,this.isLittleEndian_=e.littleEndian!==!1,this.isEWKB_=e.ewkb!==!1,this.writeQueue_=[],this.nodata_=Object.assign({X:0,Y:0,Z:0,M:0},e.nodata)}writeUint8(e){this.writeQueue_.push([1,e])}writeUint32(e){this.writeQueue_.push([4,e])}writeDouble(e){this.writeQueue_.push([8,e])}writePoint(e,t){const n=Object.assign.apply(null,t.split("").map((i,s)=>({[i]:e[s]})));for(const i of this.layout_)this.writeDouble(i in n?n[i]:this.nodata_[i])}writeLineString(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writePoint(e[n],t)}writePolygon(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeLineString(e[n],t)}writeWkbHeader(e,t){e%=1e3,this.layout_.includes("Z")&&(e+=this.isEWKB_?2147483648:1e3),this.layout_.includes("M")&&(e+=this.isEWKB_?1073741824:2e3),this.isEWKB_&&Number.isInteger(t)&&(e|=536870912),this.writeUint8(this.isLittleEndian_?1:0),this.writeUint32(e),this.isEWKB_&&Number.isInteger(t)&&this.writeUint32(t)}writeMultiPoint(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeWkbHeader(1),this.writePoint(e[n],t)}writeMultiLineString(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeWkbHeader(2),this.writeLineString(e[n],t)}writeMultiPolygon(e,t){this.writeUint32(e.length);for(let n=0;n<e.length;n++)this.writeWkbHeader(3),this.writePolygon(e[n],t)}writeGeometryCollection(e){this.writeUint32(e.length);for(let t=0;t<e.length;t++)this.writeGeometry(e[t])}findMinimumLayout(e,t="XYZM"){const n=(i,s)=>i===s?i:i==="XYZM"?s:s==="XYZM"?i:"XY";if(e instanceof ua)return n(e.getLayout(),t);if(e instanceof sn){const i=e.getGeometriesArray();for(let s=0;s<i.length&&t!=="XY";s++)t=this.findMinimumLayout(i[s],t)}return t}writeGeometry(e,t){const n={Point:fe.POINT,LineString:fe.LINE_STRING,Polygon:fe.POLYGON,MultiPoint:fe.MULTI_POINT,MultiLineString:fe.MULTI_LINE_STRING,MultiPolygon:fe.MULTI_POLYGON,GeometryCollection:fe.GEOMETRY_COLLECTION},i=e.getType(),s=n[i];if(!s)throw new Error("GeometryType "+i+" is not supported");this.layout_||(this.layout_=this.findMinimumLayout(e)),this.writeWkbHeader(s,t),e instanceof ua?{Point:this.writePoint,LineString:this.writeLineString,Polygon:this.writePolygon,MultiPoint:this.writeMultiPoint,MultiLineString:this.writeMultiLineString,MultiPolygon:this.writeMultiPolygon}[i].call(this,e.getCoordinates(),e.getLayout()):e instanceof sn&&this.writeGeometryCollection(e.getGeometriesArray())}getBuffer(){const e=this.writeQueue_.reduce((s,o)=>s+o[0],0),t=new ArrayBuffer(e),n=new DataView(t);let i=0;return this.writeQueue_.forEach(s=>{switch(s[0]){case 1:n.setUint8(i,s[1]);break;case 4:n.setUint32(i,s[1],this.isLittleEndian_);break;case 8:n.setFloat64(i,s[1],this.isLittleEndian_);break}i+=s[0]}),t}}class vg extends uf{constructor(e){super(),e=e||{},this.splitCollection=!!e.splitCollection,this.viewCache_=null,this.hex_=e.hex!==!1,this.littleEndian_=e.littleEndian!==!1,this.ewkb_=e.ewkb!==!1,this.layout_=e.geometryLayout,this.nodataZ_=e.nodataZ||0,this.nodataM_=e.nodataM||0,this.srid_=e.srid}getType(){return this.hex_?"text":"arraybuffer"}readFeature(e,t){return new ct({geometry:this.readGeometry(e,t)})}readFeatures(e,t){let n=[];const i=this.readGeometry(e,t);return this.splitCollection&&i instanceof sn?n=i.getGeometriesArray():n=[i],n.map(s=>new ct({geometry:s}))}readGeometry(e,t){const n=Za(e);if(!n)return null;const s=new Ha(n).readGeometry();return this.viewCache_=n,t=this.getReadOptions(e,t),this.viewCache_=null,Ue(s,!1,t)}readProjection(e){const t=this.viewCache_||Za(e);if(!t)return;const n=new Ha(t);return n.readWkbHeader(),n.getSrid()&&ae("EPSG:"+n.getSrid())||void 0}writeFeature(e,t){return this.writeGeometry(e.getGeometry(),t)}writeFeatures(e,t){return this.writeGeometry(new sn(e.map(n=>n.getGeometry())),t)}writeGeometry(e,t){t=this.adaptOptions(t);const n=new Rg({layout:this.layout_,littleEndian:this.littleEndian_,ewkb:this.ewkb_,nodata:{Z:this.nodataZ_,M:this.nodataM_}});let i=Number.isInteger(this.srid_)?Number(this.srid_):null;if(this.srid_!==!1&&!Number.isInteger(this.srid_)){const o=t.dataProjection&&ae(t.dataProjection);if(o){const a=o.getCode();a.startsWith("EPSG:")&&(i=Number(a.substring(5)))}}n.writeGeometry(Ue(e,!0,t),i);const s=n.getBuffer();return this.hex_?Ag(s):s}}function Ag(r){const e=new Uint8Array(r);return Array.from(e.values()).map(t=>(t<16?"0":"")+Number(t).toString(16).toUpperCase()).join("")}function Pg(r){const e=new Uint8Array(r.length/2);for(let t=0;t<r.length/2;t++)e[t]=parseInt(r.substr(t*2,2),16);return new DataView(e.buffer)}function Za(r){return typeof r=="string"?Pg(r):ArrayBuffer.isView(r)?r instanceof DataView?r:new DataView(r.buffer,r.byteOffset,r.byteLength):r instanceof ArrayBuffer?new DataView(r):null}const ve=[null,"http://www.opengis.net/wms"];function Or(r){return hf(r[0].version,"1.3")>=0}const Lg=D(ve,{Service:b(Jg),Capability:b(Kg)}),Ec={Request:b(am),Exception:b(rm),Layer:b(nm)},Ig=D(ve,{...Ec,UserDefinedSymbolization:b(Yg)}),Cg=D(ve,Ec);class Fg extends lo{constructor(){super(),this.version=void 0}readFromNode(e){this.version=e.getAttribute("version").trim();const t=O({version:this.version},Lg,e,[]);return t||null}}const bc={Name:b(F),Title:b(F),Abstract:b(F),KeywordList:b(Ac),OnlineResource:b(Cr),ContactInformation:b(Qg),Fees:b(F),AccessConstraints:b(F)},Og=D(ve,bc),Mg=D(ve,{...bc,LayerLimit:b(Te),MaxWidth:b(Te),MaxHeight:b(Te)}),Ng=D(ve,{ContactPersonPrimary:b(em),ContactPosition:b(F),ContactAddress:b(tm),ContactVoiceTelephone:b(F),ContactFacsimileTelephone:b(F),ContactElectronicMailAddress:b(F)}),Dg=D(ve,{ContactPerson:b(F),ContactOrganization:b(F)}),Ug=D(ve,{AddressType:b(F),Address:b(F),City:b(F),StateOrProvince:b(F),PostCode:b(F),Country:b(F)}),Bg=D(ve,{Format:$(F)}),Tc={Name:b(F),Title:b(F),Abstract:b(F),KeywordList:b(Ac),BoundingBox:ue(Rc),Dimension:ue(im),Attribution:b(Zg),AuthorityURL:ue(um),Identifier:ue(F),MetadataURL:ue(hm),DataURL:ue(Lt),FeatureListURL:ue(Lt),Style:ue(fm),Layer:ue(Mi)},wc=D(ve,{...Tc,SRS:ue(F),Extent:b(sm),ScaleHint:ue(om),LatLonBoundingBox:b((r,e)=>Rc(r,e,!1)),Layer:ue(Mi)}),Sc=D(ve,{...Tc,CRS:ue(F),EX_GeographicBoundingBox:b(qg),MinScaleDenominator:b(De),MaxScaleDenominator:b(De),Layer:ue(Mi)}),Gg=D(ve,{Title:b(F),OnlineResource:b(Cr),LogoURL:b(vc)}),zg=D(ve,{westBoundLongitude:b(De),eastBoundLongitude:b(De),southBoundLatitude:b(De),northBoundLatitude:b(De)}),kg=D(ve,{GetCapabilities:b(Vi),GetMap:b(Vi),GetFeatureInfo:b(Vi)}),$g=D(ve,{Format:ue(F),DCPType:ue(lm)}),Vg=D(ve,{HTTP:b(cm)}),Xg=D(ve,{Get:b(Lt),Post:b(Lt)}),Wg=D(ve,{Name:b(F),Title:b(F),Abstract:b(F),LegendURL:ue(vc),StyleSheetURL:b(Lt),StyleURL:b(Lt)}),jg=D(ve,{Format:b(F),OnlineResource:b(Cr)}),Hg=D(ve,{Keyword:$(F)});function Zg(r,e){return O({},Gg,r,e)}function Yg(r,e){return{SupportSLD:!!nt(r.getAttribute("UserDefinedSymbolization")),UserLayer:!!nt(r.getAttribute("UserLayer")),UserStyle:!!nt(r.getAttribute("UserStyle")),RemoteWFS:!!nt(r.getAttribute("RemoteWFS"))}}function Rc(r,e,t=!0){const n=[mt(r.getAttribute("minx")),mt(r.getAttribute("miny")),mt(r.getAttribute("maxx")),mt(r.getAttribute("maxy"))],i=[mt(r.getAttribute("resx")),mt(r.getAttribute("resy"))],s={extent:n,res:i};return t&&(Or(e)?s.crs=r.getAttribute("CRS"):s.srs=r.getAttribute("SRS")),s}function qg(r,e){const t=O({},zg,r,e);if(!t)return;const n=t.westBoundLongitude,i=t.southBoundLatitude,s=t.eastBoundLongitude,o=t.northBoundLatitude;if(!(n===void 0||i===void 0||s===void 0||o===void 0))return[n,i,s,o]}function Kg(r,e){return O({},Or(e)?Cg:Ig,r,e)}function Jg(r,e){return O({},Or(e)?Mg:Og,r,e)}function Qg(r,e){return O({},Ng,r,e)}function em(r,e){return O({},Dg,r,e)}function tm(r,e){return O({},Ug,r,e)}function rm(r,e){return O([],Bg,r,e)}function nm(r,e){const t=O({},Or(e)?Sc:wc,r,e);return t.Layer===void 0?Object.assign(t,Mi(r,e)):t}function Mi(r,e){const t=Or(e),n=e[e.length-1],i=O({},t?Sc:wc,r,e);if(!i)return;let s=nt(r.getAttribute("queryable"));s===void 0&&(s=n.queryable),i.queryable=s!==void 0?s:!1;let o=Mt(r.getAttribute("cascaded"));o===void 0&&(o=n.cascaded),i.cascaded=o;let a=nt(r.getAttribute("opaque"));a===void 0&&(a=n.opaque),i.opaque=a!==void 0?a:!1;let c=nt(r.getAttribute("noSubsets"));c===void 0&&(c=n.noSubsets),i.noSubsets=c!==void 0?c:!1;let l=mt(r.getAttribute("fixedWidth"));l||(l=n.fixedWidth),i.fixedWidth=l;let u=mt(r.getAttribute("fixedHeight"));u||(u=n.fixedHeight),i.fixedHeight=u;const h=["Style","AuthorityURL"];t?h.push("CRS"):h.push("SRS","Dimension"),h.forEach(function(d){if(d in n){const p=i[d]||[];i[d]=p.concat(n[d])}});const f=["BoundingBox","Attribution"];return t?f.push("Dimension","EX_GeographicBoundingBox","MinScaleDenominator","MaxScaleDenominator"):f.push("LatLonBoundingBox","ScaleHint","Extent"),f.forEach(function(d){if(!(d in i)){const p=n[d];i[d]=p}}),i}function im(r,e){const t={name:r.getAttribute("name"),units:r.getAttribute("units"),unitSymbol:r.getAttribute("unitSymbol")};return Or(e)&&Object.assign(t,{default:r.getAttribute("default"),multipleValues:nt(r.getAttribute("multipleValues")),nearestValue:nt(r.getAttribute("nearestValue")),current:nt(r.getAttribute("current")),values:F(r)}),t}function sm(r,e){return{name:r.getAttribute("name"),default:r.getAttribute("default"),nearestValue:nt(r.getAttribute("nearestValue"))}}function om(r,e){return{min:mt(r.getAttribute("min")),max:mt(r.getAttribute("max"))}}function Lt(r,e){return O({},jg,r,e)}function am(r,e){return O({},kg,r,e)}function lm(r,e){return O({},Vg,r,e)}function cm(r,e){return O({},Xg,r,e)}function Vi(r,e){return O({},$g,r,e)}function vc(r,e){const t=Lt(r,e);if(t){const n=[Mt(r.getAttribute("width")),Mt(r.getAttribute("height"))];return t.size=n,t}}function um(r,e){const t=Lt(r,e);if(t)return t.name=r.getAttribute("name"),t}function hm(r,e){const t=Lt(r,e);if(t)return t.type=r.getAttribute("type"),t}function fm(r,e){return O({},Wg,r,e)}function Ac(r,e){return O([],Hg,r,e)}const dm="_feature",pm="_layer";class gm extends bi{constructor(e){super(),e=e||{},this.featureNS_="http://mapserver.gis.umn.edu/mapserver",this.gmlFormat_=new J,this.layers_=e.layers?e.layers:null}getLayers(){return this.layers_}setLayers(e){this.layers_=e}readFeatures_(e,t){e.setAttribute("namespaceURI",this.featureNS_);const n=e.localName;let i=[];if(e.childNodes.length===0)return i;if(n=="msGMLOutput")for(let s=0,o=e.childNodes.length;s<o;s++){const a=e.childNodes[s];if(a.nodeType!==Node.ELEMENT_NODE)continue;const c=a,l=t[0],u=pm,h=c.localName.replace(u,"");if(this.layers_&&!this.layers_.includes(h))continue;const f=h+dm;l.featureType=f,l.featureNS=this.featureNS_;const d={};d[f]=$(this.gmlFormat_.readFeatureElement,this.gmlFormat_);const p=D([l.featureNS,null],d);c.setAttribute("namespaceURI",this.featureNS_);const g=O([],p,c,t,this.gmlFormat_);g&&si(i,g)}if(n=="FeatureCollection"){const s=O([],this.gmlFormat_.FEATURE_COLLECTION_PARSERS,e,[{}],this.gmlFormat_);s&&(i=s)}return i}readFeaturesFromNode(e,t){const n={};return t&&Object.assign(n,this.getReadOptions(e,t)),this.readFeatures_(e,[n])}}const Et=[null,"http://www.opengis.net/wmts/1.0"],Mr=[null,"http://www.opengis.net/ows/1.1"],mm=D(Et,{Contents:b(vm)});let go=class extends lo{constructor(){super(),this.owsParser_=new gc}readFromNode(e){let t=e.getAttribute("version");t&&(t=t.trim());let n=this.owsParser_.readFromNode(e);return n?(n.version=t,n=O(n,mm,e,[]),n||null):null}};const _m=D(Et,{Layer:ue(Am),TileMatrixSet:ue(Pm)}),ym=D(Et,{Style:ue(Lm),Format:ue(F),TileMatrixSetLink:ue(Im),Dimension:ue(Cm),ResourceURL:ue(Fm)},D(Mr,{Title:b(F),Abstract:b(F),WGS84BoundingBox:b(Lc),BoundingBox:ue(Om),Identifier:b(F)})),xm=D(Et,{LegendURL:ue(Mm)},D(Mr,{Title:b(F),Identifier:b(F)})),Em=D(Et,{TileMatrixSet:b(F),TileMatrixSetLimits:b(Dm)}),bm=D(Et,{TileMatrixLimits:$(Um)}),Tm=D(Et,{TileMatrix:b(F),MinTileRow:b(Te),MaxTileRow:b(Te),MinTileCol:b(Te),MaxTileCol:b(Te)}),wm=D(Et,{Default:b(F),Value:ue(F)},D(Mr,{Identifier:b(F)})),Pc=D(Mr,{LowerCorner:$(_s),UpperCorner:$(_s)}),Sm=D(Et,{WellKnownScaleSet:b(F),TileMatrix:ue(Nm)},D(Mr,{SupportedCRS:b(F),Identifier:b(F),BoundingBox:b(Lc)})),Rm=D(Et,{TopLeftCorner:b(_s),ScaleDenominator:b(De),TileWidth:b(Te),TileHeight:b(Te),MatrixWidth:b(Te),MatrixHeight:b(Te)},D(Mr,{Identifier:b(F)}));function vm(r,e){return O({},_m,r,e)}function Am(r,e){return O({},ym,r,e)}function Pm(r,e){return O({},Sm,r,e)}function Lm(r,e){const t=O({},xm,r,e);if(!t)return;const n=r.getAttribute("isDefault")==="true";return t.isDefault=n,t}function Im(r,e){return O({},Em,r,e)}function Cm(r,e){return O({},wm,r,e)}function Fm(r,e){const t=r.getAttribute("format"),n=r.getAttribute("template"),i=r.getAttribute("resourceType"),s={};return t&&(s.format=t),n&&(s.template=n),i&&(s.resourceType=i),s}function Lc(r,e){const t=O([],Pc,r,e);if(t.length==2)return Qs(t)}function Om(r,e){const t=r.getAttribute("crs"),n=O([],Pc,r,e);if(n.length==2)return{extent:Qs(n),crs:t}}function Mm(r,e){const t={};return t.format=r.getAttribute("format"),t.href=Cr(r),t}function _s(r,e){const t=F(r).split(/\s+/);if(!t||t.length!=2)return;const n=+t[0],i=+t[1];if(!(isNaN(n)||isNaN(i)))return[n,i]}function Nm(r,e){return O({},Rm,r,e)}function Dm(r,e){return O([],bm,r,e)}function Um(r,e){return O({},Tm,r,e)}const Bm=Object.freeze(Object.defineProperty({__proto__:null,EsriJSON:cd,GML:no,GPX:Dd,GeoJSON:Zs,IGC:yp,IIIFInfo:Sp,KML:_h,MVT:Vl,OWS:gc,Polyline:eg,TopoJSON:yh,WFS:xg,WKB:vg,WKT:Gf,WMSCapabilities:Fg,WMSGetFeatureInfo:gm,WMTSCapabilities:go},Symbol.toStringTag,{value:"Module"})),Zr={GENERATE_POLYGON_BUFFERS:"GENERATE_POLYGON_BUFFERS",GENERATE_POINT_BUFFERS:"GENERATE_POINT_BUFFERS",GENERATE_LINE_STRING_BUFFERS:"GENERATE_LINE_STRING_BUFFERS"},Ya=.985;function Ic(r,e){e=e||[];const t=256,n=t-1;return e[0]=Math.floor(r/t/t/t)/n,e[1]=Math.floor(r/t/t)%t/n,e[2]=Math.floor(r/t)%t/n,e[3]=r%t/n,e}function Cc(r){let e=0;const t=256,n=t-1;return e+=Math.round(r[0]*t*t*t*n),e+=Math.round(r[1]*t*t*n),e+=Math.round(r[2]*t*n),e+=Math.round(r[3]*n),e}function Gm(r){const e=Array.isArray(r)?r:[r];if("style"in e[0]){const t=[],n=e,i=[];for(const s of n){const o=Array.isArray(s.style)?s.style:[s.style];let a=s.filter;s.else&&i.length&&(a=["all",...i.map(l=>["!",l])],s.filter&&a.push(s.filter),a.length<3&&(a=a[1])),s.filter&&i.push(s.filter);const c=o.map(l=>({style:l,...a&&{filter:a}}));t.push(...c)}return t}return"builder"in e[0]?e:e.map(t=>({style:t}))}const xn=34962,En=34963,mo=35044,ci=35048,zm=5121,km=5123,$m=5125,Fc=5126,qa=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function Vm(r,e){e=Object.assign({preserveDrawingBuffer:!0,antialias:!xh},e);const t=qa.length;for(let n=0;n<t;++n)try{const i=r.getContext(qa[n],e);if(i)return i}catch{}return null}const Xm={STATIC_DRAW:mo};class wr{constructor(e,t){this.array_=null,this.type_=e,Je(e===xn||e===En,"A `WebGLArrayBuffer` must either be of type `ELEMENT_ARRAY_BUFFER` or `ARRAY_BUFFER`"),this.usage_=t!==void 0?t:Xm.STATIC_DRAW}ofSize(e){return this.array_=new(Dn(this.type_))(e),this}fromArray(e){return this.array_=Dn(this.type_).from(e),this}fromArrayBuffer(e){return this.array_=new(Dn(this.type_))(e),this}getType(){return this.type_}getArray(){return this.array_}setArray(e){const t=Dn(this.type_);if(!(e instanceof t))throw new Error(`Expected ${t}`);this.array_=e}getUsage(){return this.usage_}getSize(){return this.array_?this.array_.length:0}}function Dn(r){switch(r){case xn:return Float32Array;case En:return Uint32Array;default:return Float32Array}}function rr(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function ui(r,e){return r[0]=e[0],r[1]=e[1],r[4]=e[2],r[5]=e[3],r[12]=e[4],r[13]=e[5],r}function ys(r,e,t,n,i,s,o){o=o??rr();const a=1/(r-e),c=1/(t-n),l=1/(i-s);return o[0]=-2*a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*c,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*l,o[11]=0,o[12]=(r+e)*a,o[13]=(n+t)*c,o[14]=(s+i)*l,o[15]=1,o}function Ka(r,e,t,n,i){return i=i??rr(),i[0]=r[0]*e,i[1]=r[1]*e,i[2]=r[2]*e,i[3]=r[3]*e,i[4]=r[4]*t,i[5]=r[5]*t,i[6]=r[6]*t,i[7]=r[7]*t,i[8]=r[8]*n,i[9]=r[9]*n,i[10]=r[10]*n,i[11]=r[11]*n,i[12]=r[12],i[13]=r[13],i[14]=r[14],i[15]=r[15],i}function Wm(r,e,t,n,i){i=i??rr();let s,o,a,c,l,u,h,f,d,p,g,m;return r===i?(i[12]=r[0]*e+r[4]*t+r[8]*n+r[12],i[13]=r[1]*e+r[5]*t+r[9]*n+r[13],i[14]=r[2]*e+r[6]*t+r[10]*n+r[14],i[15]=r[3]*e+r[7]*t+r[11]*n+r[15]):(s=r[0],o=r[1],a=r[2],c=r[3],l=r[4],u=r[5],h=r[6],f=r[7],d=r[8],p=r[9],g=r[10],m=r[11],i[0]=s,i[1]=o,i[2]=a,i[3]=c,i[4]=l,i[5]=u,i[6]=h,i[7]=f,i[8]=d,i[9]=p,i[10]=g,i[11]=m,i[12]=s*e+l*t+d*n+r[12],i[13]=o*e+u*t+p*n+r[13],i[14]=a*e+h*t+g*n+r[14],i[15]=c*e+f*t+m*n+r[15]),i}function jm(r,e,t,n){return n=n??rr(),n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=r,n[13]=e,n[14]=t,n[15]=1,n}const Un={LOST:"webglcontextlost",RESTORED:"webglcontextrestored"},Hm=`
  precision mediump float;

  attribute vec2 a_position;
  varying vec2 v_texCoord;
  varying vec2 v_screenCoord;

  uniform vec2 u_screenSize;

  void main() {
    v_texCoord = a_position * 0.5 + 0.5;
    v_screenCoord = v_texCoord * u_screenSize;
    gl_Position = vec4(a_position, 0.0, 1.0);
  }
`,Zm=`
  precision mediump float;

  uniform sampler2D u_image;
  uniform float u_opacity;

  varying vec2 v_texCoord;

  void main() {
    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;
  }
`;class Ja{constructor(e){this.gl_=e.webGlContext;const t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer(),this.depthBuffer_=t.createRenderbuffer();const n=t.createShader(t.VERTEX_SHADER);t.shaderSource(n,e.vertexShader||Hm),t.compileShader(n);const i=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(i,e.fragmentShader||Zm),t.compileShader(i),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,n),t.attachShader(this.renderTargetProgram_,i),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();const s=[-1,-1,1,-1,-1,1,1,-1,1,1,-1,1];t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array(s),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(o=>{this.uniforms_.push({value:e.uniforms[o],location:t.getUniformLocation(this.renderTargetProgram_,o)})})}getRenderTargetTexture(){return this.renderTargetTexture_}getGL(){return this.gl_}init(e){const t=this.getGL(),n=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.bindRenderbuffer(t.RENDERBUFFER,this.getDepthBuffer()),t.viewport(0,0,n[0],n[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==n[0]||this.renderTargetTextureSize_[1]!==n[1]){this.renderTargetTextureSize_=n;const i=0,s=t.RGBA,o=0,a=t.RGBA,c=t.UNSIGNED_BYTE,l=null;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,i,s,n[0],n[1],o,a,c,l),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,n[0],n[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthBuffer_)}}apply(e,t,n,i){const s=this.getGL(),o=e.size;if(s.bindFramebuffer(s.FRAMEBUFFER,t?t.getFrameBuffer():null),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.renderTargetTexture_),!t){const c=de(s.canvas);if(!e.renderTargets[c]){const l=s.getContextAttributes();l&&l.preserveDrawingBuffer&&(s.clearColor(0,0,0,0),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT)),e.renderTargets[c]=!0}}s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.ONE,s.ONE_MINUS_SRC_ALPHA),s.viewport(0,0,s.drawingBufferWidth,s.drawingBufferHeight),s.bindBuffer(s.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),s.useProgram(this.renderTargetProgram_),s.enableVertexAttribArray(this.renderTargetAttribLocation_),s.vertexAttribPointer(this.renderTargetAttribLocation_,2,s.FLOAT,!1,0,0),s.uniform2f(this.renderTargetUniformLocation_,o[0],o[1]),s.uniform1i(this.renderTargetTextureLocation_,0);const a=e.layerStatesArray[e.layerIndex].opacity;s.uniform1f(this.renderTargetOpacityLocation_,a),this.applyUniforms(e),n&&n(s,e),s.drawArrays(s.TRIANGLES,0,6),i&&i(s,e)}getFrameBuffer(){return this.frameBuffer_}getDepthBuffer(){return this.depthBuffer_}applyUniforms(e){const t=this.getGL();let n,i=1;this.uniforms_.forEach(function(s){if(n=typeof s.value=="function"?s.value(e):s.value,n instanceof HTMLCanvasElement||n instanceof ImageData)s.texture||(s.texture=t.createTexture()),t.activeTexture(t[`TEXTURE${i}`]),t.bindTexture(t.TEXTURE_2D,s.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),n instanceof ImageData?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,n.width,n.height,0,t.UNSIGNED_BYTE,new Uint8Array(n.data)):t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.uniform1i(s.location,i++);else if(Array.isArray(n))switch(n.length){case 2:t.uniform2f(s.location,n[0],n[1]);return;case 3:t.uniform3f(s.location,n[0],n[1],n[2]);return;case 4:t.uniform4f(s.location,n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(s.location,n)})}}const gt={PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix",TIME:"u_time",ZOOM:"u_zoom",RESOLUTION:"u_resolution",ROTATION:"u_rotation",VIEWPORT_SIZE_PX:"u_viewportSizePx",PIXEL_RATIO:"u_pixelRatio",HIT_DETECTION:"u_hitDetection"},Se={UNSIGNED_BYTE:zm,UNSIGNED_SHORT:km,UNSIGNED_INT:$m,FLOAT:Fc},hi={};function Qa(r){return"shared/"+r}let el=0;function Ym(){const r="unique/"+el;return el+=1,r}function qm(r){let e=hi[r];if(!e){const t=document.createElement("canvas");t.width=1,t.height=1,t.style.position="absolute",t.style.left="0",e={users:0,context:Vm(t)},hi[r]=e}return e.users+=1,e.context}function Km(r){const e=hi[r];if(!e||(e.users-=1,e.users>0))return;const t=e.context,n=t.getExtension("WEBGL_lose_context");n&&n.loseContext();const i=t.canvas;i.width=1,i.height=1,delete hi[r]}class Jm extends ic{constructor(e){super(),e=e||{},this.boundHandleWebGLContextLost_=this.handleWebGLContextLost.bind(this),this.boundHandleWebGLContextRestored_=this.handleWebGLContextRestored.bind(this),this.canvasCacheKey_=e.canvasCacheKey?Qa(e.canvasCacheKey):Ym(),this.gl_=qm(this.canvasCacheKey_),this.bufferCache_={},this.extensionCache_={},this.currentProgram_=null,this.needsToBeRecreated_=!1;const t=this.gl_.canvas;t.addEventListener(Un.LOST,this.boundHandleWebGLContextLost_),t.addEventListener(Un.RESTORED,this.boundHandleWebGLContextRestored_),this.offsetRotateMatrix_=Ce(),this.offsetScaleMatrix_=Ce(),this.tmpMat4_=rr(),this.uniformLocationsByProgram_={},this.attribLocationsByProgram_={},this.uniforms_=[],e.uniforms&&this.setUniforms(e.uniforms),this.postProcessPasses_=e.postProcesses?e.postProcesses.map(n=>new Ja({webGlContext:this.gl_,scaleRatio:n.scaleRatio,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,uniforms:n.uniforms})):[new Ja({webGlContext:this.gl_})],this.shaderCompileErrors_=null,this.startTime_=Date.now()}setUniforms(e){this.uniforms_=[],this.addUniforms(e)}addUniforms(e){for(const t in e)this.uniforms_.push({name:t,value:e[t]})}canvasCacheKeyMatches(e){return this.canvasCacheKey_===Qa(e)}getExtension(e){if(e in this.extensionCache_)return this.extensionCache_[e];const t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t}bindBuffer(e){const t=this.gl_,n=de(e);let i=this.bufferCache_[n];if(!i){const s=t.createBuffer();i={buffer:e,webGlBuffer:s},this.bufferCache_[n]=i}t.bindBuffer(e.getType(),i.webGlBuffer)}flushBufferData(e){const t=this.gl_;this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())}deleteBuffer(e){const t=de(e);delete this.bufferCache_[t]}disposeInternal(){const e=this.gl_.canvas;e.removeEventListener(Un.LOST,this.boundHandleWebGLContextLost_),e.removeEventListener(Un.RESTORED,this.boundHandleWebGLContextRestored_),Km(this.canvasCacheKey_),delete this.gl_}prepareDraw(e,t,n){const i=this.gl_,s=this.getCanvas(),o=e.size,a=e.pixelRatio;(s.width!==o[0]*a||s.height!==o[1]*a)&&(s.width=o[0]*a,s.height=o[1]*a,s.style.width=o[0]+"px",s.style.height=o[1]+"px");for(let c=this.postProcessPasses_.length-1;c>=0;c--)this.postProcessPasses_[c].init(e);i.bindTexture(i.TEXTURE_2D,null),i.clearColor(0,0,0,0),i.depthRange(0,1),i.clearDepth(1),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),i.enable(i.BLEND),i.blendFunc(i.ONE,t?i.ZERO:i.ONE_MINUS_SRC_ALPHA),n?(i.enable(i.DEPTH_TEST),i.depthFunc(i.LEQUAL)):i.disable(i.DEPTH_TEST)}bindFrameBuffer(e,t){const n=this.getGL();n.bindFramebuffer(n.FRAMEBUFFER,e),t&&n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0)}bindInitialFrameBuffer(){const e=this.getGL(),t=this.postProcessPasses_[0].getFrameBuffer();e.bindFramebuffer(e.FRAMEBUFFER,t);const n=this.postProcessPasses_[0].getRenderTargetTexture();e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}bindTexture(e,t,n){const i=this.gl_;i.activeTexture(i.TEXTURE0+t),i.bindTexture(i.TEXTURE_2D,e),i.uniform1i(this.getUniformLocation(n),t)}bindAttribute(e,t,n){const i=this.getGL();this.bindBuffer(e);const s=this.getAttributeLocation(t);i.enableVertexAttribArray(s),i.vertexAttribPointer(s,n,i.FLOAT,!1,0,0)}prepareDrawToRenderTarget(e,t,n,i){const s=this.gl_,o=t.getSize();s.bindFramebuffer(s.FRAMEBUFFER,t.getFramebuffer()),s.bindRenderbuffer(s.RENDERBUFFER,t.getDepthbuffer()),s.viewport(0,0,o[0],o[1]),s.bindTexture(s.TEXTURE_2D,t.getTexture()),s.clearColor(0,0,0,0),s.depthRange(0,1),s.clearDepth(1),s.clear(s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT),s.enable(s.BLEND),s.blendFunc(s.ONE,n?s.ZERO:s.ONE_MINUS_SRC_ALPHA),i?(s.enable(s.DEPTH_TEST),s.depthFunc(s.LEQUAL)):s.disable(s.DEPTH_TEST)}drawElements(e,t){const n=this.gl_;this.getExtension("OES_element_index_uint");const i=n.UNSIGNED_INT,s=4,o=t-e,a=e*s;n.drawElements(n.TRIANGLES,o,i,a)}finalizeDraw(e,t,n){for(let i=0,s=this.postProcessPasses_.length;i<s;i++)i===s-1?this.postProcessPasses_[i].apply(e,null,t,n):this.postProcessPasses_[i].apply(e,this.postProcessPasses_[i+1])}getCanvas(){return this.gl_.canvas}getGL(){return this.gl_}applyFrameState(e){const t=e.size,n=e.viewState.rotation,i=e.pixelRatio;this.setUniformFloatValue(gt.TIME,(Date.now()-this.startTime_)*.001),this.setUniformFloatValue(gt.ZOOM,e.viewState.zoom),this.setUniformFloatValue(gt.RESOLUTION,e.viewState.resolution),this.setUniformFloatValue(gt.PIXEL_RATIO,i),this.setUniformFloatVec2(gt.VIEWPORT_SIZE_PX,[t[0],t[1]]),this.setUniformFloatValue(gt.ROTATION,n)}applyHitDetectionUniform(e){const t=this.getUniformLocation(gt.HIT_DETECTION);this.getGL().uniform1i(t,e?1:0),e&&this.setUniformFloatValue(gt.PIXEL_RATIO,.5)}applyUniforms(e){const t=this.gl_;let n,i=0;this.uniforms_.forEach(s=>{if(n=typeof s.value=="function"?s.value(e):s.value,n instanceof HTMLCanvasElement||n instanceof HTMLImageElement||n instanceof ImageData||n instanceof WebGLTexture){n instanceof WebGLTexture&&!s.texture?(s.prevValue=void 0,s.texture=n):s.texture||(s.prevValue=void 0,s.texture=t.createTexture()),this.bindTexture(s.texture,i,s.name),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE);const o=!(n instanceof HTMLImageElement)||n.complete;!(n instanceof WebGLTexture)&&o&&s.prevValue!==n&&(s.prevValue=n,t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n)),i++}else if(Array.isArray(n)&&n.length===6)this.setUniformMatrixValue(s.name,ui(this.tmpMat4_,n));else if(Array.isArray(n)&&n.length<=4)switch(n.length){case 2:t.uniform2f(this.getUniformLocation(s.name),n[0],n[1]);return;case 3:t.uniform3f(this.getUniformLocation(s.name),n[0],n[1],n[2]);return;case 4:t.uniform4f(this.getUniformLocation(s.name),n[0],n[1],n[2],n[3]);return;default:return}else typeof n=="number"&&t.uniform1f(this.getUniformLocation(s.name),n)})}useProgram(e,t){this.gl_.useProgram(e),this.currentProgram_=e,t&&(this.applyFrameState(t),this.applyUniforms(t))}compileShader(e,t){const n=this.gl_,i=n.createShader(t);return n.shaderSource(i,e),n.compileShader(i),i}getProgram(e,t){const n=this.gl_,i=this.compileShader(e,n.FRAGMENT_SHADER),s=this.compileShader(t,n.VERTEX_SHADER),o=n.createProgram();if(n.attachShader(o,i),n.attachShader(o,s),n.linkProgram(o),!n.getShaderParameter(i,n.COMPILE_STATUS)){const a=`Fragment shader compilation failed: ${n.getShaderInfoLog(i)}`;throw new Error(a)}if(n.deleteShader(i),!n.getShaderParameter(s,n.COMPILE_STATUS)){const a=`Vertex shader compilation failed: ${n.getShaderInfoLog(s)}`;throw new Error(a)}if(n.deleteShader(s),!n.getProgramParameter(o,n.LINK_STATUS)){const a=`GL program linking failed: ${n.getProgramInfoLog(o)}`;throw new Error(a)}return o}getUniformLocation(e){const t=de(this.currentProgram_);return this.uniformLocationsByProgram_[t]===void 0&&(this.uniformLocationsByProgram_[t]={}),this.uniformLocationsByProgram_[t][e]===void 0&&(this.uniformLocationsByProgram_[t][e]=this.gl_.getUniformLocation(this.currentProgram_,e)),this.uniformLocationsByProgram_[t][e]}getAttributeLocation(e){const t=de(this.currentProgram_);return this.attribLocationsByProgram_[t]===void 0&&(this.attribLocationsByProgram_[t]={}),this.attribLocationsByProgram_[t][e]===void 0&&(this.attribLocationsByProgram_[t][e]=this.gl_.getAttribLocation(this.currentProgram_,e)),this.attribLocationsByProgram_[t][e]}makeProjectionTransform(e,t){const n=e.size,i=e.viewState.rotation,s=e.viewState.resolution,o=e.viewState.center;return Ys(t,0,0,2/(s*n[0]),2/(s*n[1]),-i,-o[0],-o[1]),t}setUniformFloatValue(e,t){this.gl_.uniform1f(this.getUniformLocation(e),t)}setUniformFloatVec2(e,t){this.gl_.uniform2fv(this.getUniformLocation(e),t)}setUniformFloatVec4(e,t){this.gl_.uniform4fv(this.getUniformLocation(e),t)}setUniformMatrixValue(e,t){this.gl_.uniformMatrix4fv(this.getUniformLocation(e),!1,t)}enableAttributeArray_(e,t,n,i,s){const o=this.getAttributeLocation(e);o<0||(this.gl_.enableVertexAttribArray(o),this.gl_.vertexAttribPointer(o,t,n,!1,i,s))}enableAttributes(e){const t=Qm(e);let n=0;for(let i=0;i<e.length;i++){const s=e[i];this.enableAttributeArray_(s.name,s.size,s.type||Fc,t,n),n+=s.size*Oc(s.type)}}handleWebGLContextLost(e){vf(this.bufferCache_),this.currentProgram_=null,e.preventDefault()}handleWebGLContextRestored(){this.needsToBeRecreated_=!0}needsToBeRecreated(){return this.needsToBeRecreated_}createTexture(e,t,n,i){const s=this.gl_;n=n||s.createTexture();const o=i?s.NEAREST:s.LINEAR;s.bindTexture(s.TEXTURE_2D,n),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,o),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE);const a=0,c=s.RGBA,l=0,u=s.RGBA,h=s.UNSIGNED_BYTE;return t instanceof Uint8Array?s.texImage2D(s.TEXTURE_2D,a,c,e[0],e[1],l,u,h,t):t?s.texImage2D(s.TEXTURE_2D,a,c,u,h,t):s.texImage2D(s.TEXTURE_2D,a,c,e[0],e[1],l,u,h,null),n}}function Qm(r){let e=0;for(let t=0;t<r.length;t++){const n=r[t];e+=n.size*Oc(n.type)}return e}function Oc(r){switch(r){case Se.UNSIGNED_BYTE:return Uint8Array.BYTES_PER_ELEMENT;case Se.UNSIGNED_SHORT:return Uint16Array.BYTES_PER_ELEMENT;case Se.UNSIGNED_INT:return Uint32Array.BYTES_PER_ELEMENT;case Se.FLOAT:default:return Float32Array.BYTES_PER_ELEMENT}}const ut=new Uint8Array(4);class Mc{constructor(e,t){this.helper_=e;const n=e.getGL();this.texture_=n.createTexture(),this.framebuffer_=n.createFramebuffer(),this.depthbuffer_=n.createRenderbuffer(),this.size_=t||[1,1],this.data_=new Uint8Array(0),this.dataCacheDirty_=!0,this.updateSize_()}setSize(e){Af(e,this.size_)||(this.size_[0]=e[0],this.size_[1]=e[1],this.updateSize_())}getSize(){return this.size_}clearCachedData(){this.dataCacheDirty_=!0}readAll(){if(this.dataCacheDirty_){const e=this.size_,t=this.helper_.getGL();t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.readPixels(0,0,e[0],e[1],t.RGBA,t.UNSIGNED_BYTE,this.data_),this.dataCacheDirty_=!1}return this.data_}readPixel(e,t){if(e<0||t<0||e>this.size_[0]||t>=this.size_[1])return ut[0]=0,ut[1]=0,ut[2]=0,ut[3]=0,ut;this.readAll();const n=Math.floor(e)+(this.size_[1]-Math.floor(t)-1)*this.size_[0];return ut[0]=this.data_[n*4],ut[1]=this.data_[n*4+1],ut[2]=this.data_[n*4+2],ut[3]=this.data_[n*4+3],ut}getTexture(){return this.texture_}getFramebuffer(){return this.framebuffer_}getDepthbuffer(){return this.depthbuffer_}updateSize_(){const e=this.size_,t=this.helper_.getGL();this.texture_=this.helper_.createTexture(e,null,this.texture_),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer_),t.viewport(0,0,e[0],e[1]),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture_,0),t.bindRenderbuffer(t.RENDERBUFFER,this.depthbuffer_),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e[0],e[1]),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,this.depthbuffer_),this.data_=new Uint8Array(e[0]*e[1]*4)}}function Nc(){const r='const t="GENERATE_POLYGON_BUFFERS",e="GENERATE_POINT_BUFFERS",n="GENERATE_LINE_STRING_BUFFERS";function r(t,e,n=2){const r=e&&e.length,o=r?e[0]*n:t.length;let u=x(t,0,o,n,!0);const f=[];if(!u||u.next===u.prev)return f;let s,l,h;if(r&&(u=function(t,e,n,r){const o=[];for(let n=0,i=e.length;n<i;n++){const u=x(t,e[n]*r,n<i-1?e[n+1]*r:t.length,r,!1);u===u.next&&(u.steiner=!0),o.push(p(u))}o.sort(c);for(let t=0;t<o.length;t++)n=a(o[t],n);return n}(t,e,u,n)),t.length>80*n){s=1/0,l=1/0;let e=-1/0,r=-1/0;for(let x=n;x<o;x+=n){const n=t[x],o=t[x+1];n<s&&(s=n),o<l&&(l=o),n>e&&(e=n),o>r&&(r=o)}h=Math.max(e-s,r-l),h=0!==h?32767/h:0}return i(u,f,n,s,l,h,0),f}function x(t,e,n,r,x){let o;if(x===function(t,e,n,r){let x=0;for(let o=e,i=n-r;o<n;o+=r)x+=(t[i]-t[o])*(t[o+1]+t[i+1]),i=o;return x}(t,e,n,r)>0)for(let x=e;x<n;x+=r)o=I(x/r|0,t[x],t[x+1],o);else for(let x=n-r;x>=e;x-=r)o=I(x/r|0,t[x],t[x+1],o);return o&&m(o,o.next)&&(z(o),o=o.next),o}function o(t,e){if(!t)return t;e||(e=t);let n,r=t;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==M(r.prev,r,r.next))r=r.next;else{if(z(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function i(t,e,n,r,x,c,a){if(!t)return;!a&&c&&function(t,e,n,r){let x=t;do{0===x.z&&(x.z=y(x.x,x.y,e,n,r)),x.prevZ=x.prev,x.nextZ=x.next,x=x.next}while(x!==t);x.prevZ.nextZ=null,x.prevZ=null,function(t){let e,n=1;do{let r,x=t;t=null;let o=null;for(e=0;x;){e++;let i=x,u=0;for(let t=0;t<n&&(u++,i=i.nextZ,i);t++);let f=n;for(;u>0||f>0&&i;)0!==u&&(0===f||!i||x.z<=i.z)?(r=x,x=x.nextZ,u--):(r=i,i=i.nextZ,f--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;x=i}o.nextZ=null,n*=2}while(e>1)}(x)}(t,r,x,c);let h=t;for(;t.prev!==t.next;){const y=t.prev,p=t.next;if(c?f(t,r,x,c):u(t))e.push(y.i,t.i,p.i),z(t),t=p.next,h=p.next;else if((t=p)===h){a?1===a?i(t=s(o(t),e),e,n,r,x,c,2):2===a&&l(t,e,n,r,x,c):i(o(t),e,n,r,x,c,1);break}}}function u(t){const e=t.prev,n=t,r=t.next;if(M(e,n,r)>=0)return!1;const x=e.x,o=n.x,i=r.x,u=e.y,f=n.y,s=r.y,l=Math.min(x,o,i),c=Math.min(u,f,s),a=Math.max(x,o,i),h=Math.max(u,f,s);let y=r.next;for(;y!==e;){if(y.x>=l&&y.x<=a&&y.y>=c&&y.y<=h&&g(x,u,o,f,i,s,y.x,y.y)&&M(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function f(t,e,n,r){const x=t.prev,o=t,i=t.next;if(M(x,o,i)>=0)return!1;const u=x.x,f=o.x,s=i.x,l=x.y,c=o.y,a=i.y,h=Math.min(u,f,s),p=Math.min(l,c,a),v=Math.max(u,f,s),b=Math.max(l,c,a),m=y(h,p,e,n,r),Z=y(v,b,e,n,r);let d=t.prevZ,w=t.nextZ;for(;d&&d.z>=m&&w&&w.z<=Z;){if(d.x>=h&&d.x<=v&&d.y>=p&&d.y<=b&&d!==x&&d!==i&&g(u,l,f,c,s,a,d.x,d.y)&&M(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,w.x>=h&&w.x<=v&&w.y>=p&&w.y<=b&&w!==x&&w!==i&&g(u,l,f,c,s,a,w.x,w.y)&&M(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;d&&d.z>=m;){if(d.x>=h&&d.x<=v&&d.y>=p&&d.y<=b&&d!==x&&d!==i&&g(u,l,f,c,s,a,d.x,d.y)&&M(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;w&&w.z<=Z;){if(w.x>=h&&w.x<=v&&w.y>=p&&w.y<=b&&w!==x&&w!==i&&g(u,l,f,c,s,a,w.x,w.y)&&M(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function s(t,e){let n=t;do{const r=n.prev,x=n.next.next;!m(r,x)&&Z(r,n,n.next,x)&&A(r,x)&&A(x,r)&&(e.push(r.i,n.i,x.i),z(n),z(n.next),n=t=x),n=n.next}while(n!==t);return o(n)}function l(t,e,n,r,x,u){let f=t;do{let t=f.next.next;for(;t!==f.prev;){if(f.i!==t.i&&b(f,t)){let s=E(f,t);return f=o(f,f.next),s=o(s,s.next),i(f,e,n,r,x,u,0),void i(s,e,n,r,x,u,0)}t=t.next}f=f.next}while(f!==t)}function c(t,e){let n=t.x-e.x;if(0===n&&(n=t.y-e.y,0===n)){n=(t.next.y-t.y)/(t.next.x-t.x)-(e.next.y-e.y)/(e.next.x-e.x)}return n}function a(t,e){const n=function(t,e){let n=e;const r=t.x,x=t.y;let o,i=-1/0;if(m(t,n))return n;do{if(m(t,n.next))return n.next;if(x<=n.y&&x>=n.next.y&&n.next.y!==n.y){const t=n.x+(x-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>i&&(i=t,o=n.x<n.next.x?n:n.next,t===r))return o}n=n.next}while(n!==e);if(!o)return null;const u=o,f=o.x,s=o.y;let l=1/0;n=o;do{if(r>=n.x&&n.x>=f&&r!==n.x&&v(x<s?r:i,x,f,s,x<s?i:r,x,n.x,n.y)){const e=Math.abs(x-n.y)/(r-n.x);A(n,t)&&(e<l||e===l&&(n.x>o.x||n.x===o.x&&h(o,n)))&&(o=n,l=e)}n=n.next}while(n!==u);return o}(t,e);if(!n)return e;const r=E(n,t);return o(r,r.next),o(n,n.next)}function h(t,e){return M(t.prev,t,e.prev)<0&&M(e.next,t,t.next)<0}function y(t,e,n,r,x){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*x|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*x|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function p(t){let e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function v(t,e,n,r,x,o,i,u){return(x-i)*(e-u)>=(t-i)*(o-u)&&(t-i)*(r-u)>=(n-i)*(e-u)&&(n-i)*(o-u)>=(x-i)*(r-u)}function g(t,e,n,r,x,o,i,u){return!(t===i&&e===u)&&v(t,e,n,r,x,o,i,u)}function b(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Z(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(A(t,e)&&A(e,t)&&function(t,e){let n=t,r=!1;const x=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&x<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(M(t.prev,t,e.prev)||M(t,e.prev,e))||m(t,e)&&M(t.prev,t,t.next)>0&&M(e.prev,e,e.next)>0)}function M(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function m(t,e){return t.x===e.x&&t.y===e.y}function Z(t,e,n,r){const x=w(M(t,e,n)),o=w(M(t,e,r)),i=w(M(n,r,t)),u=w(M(n,r,e));return x!==o&&i!==u||(!(0!==x||!d(t,n,e))||(!(0!==o||!d(t,r,e))||(!(0!==i||!d(n,t,r))||!(0!==u||!d(n,e,r)))))}function d(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function w(t){return t>0?1:t<0?-1:0}function A(t,e){return M(t.prev,t,t.next)<0?M(t,e,t.next)>=0&&M(t,t.prev,e)>=0:M(t,e,t.prev)<0||M(t,t.next,e)<0}function E(t,e){const n=F(t.i,t.x,t.y),r=F(e.i,e.x,e.y),x=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=x,x.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function I(t,e,n,r){const x=F(t,e,n);return r?(x.next=r.next,x.prev=r,r.next.prev=x,r.next=x):(x.prev=x,x.next=x),x}function z(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function F(t,e,n){return{i:t,x:e,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function P(t,e){const n=e[0],r=e[1];return e[0]=t[0]*n+t[2]*r+t[4],e[1]=t[1]*n+t[3]*r+t[5],e}function B(t,e){const n=(r=e)[0]*r[3]-r[1]*r[2];var r;!function(t,e){if(!t)throw new Error(e)}(0!==n,"Transformation matrix cannot be inverted");const x=e[0],o=e[1],i=e[2],u=e[3],f=e[4],s=e[5];return t[0]=u/n,t[1]=-o/n,t[2]=-i/n,t[3]=x/n,t[4]=(i*s-u*f)/n,t[5]=-(x*s-o*f)/n,t}new Array(6);const N=[],R={vertexPosition:0,indexPosition:0};function S(t,e,n,r,x){t[e+0]=n,t[e+1]=r,t[e+2]=x}function T(t,e,n,r,x,o){const i=3+x,u=t[e+0],f=t[e+1],s=N;s.length=x;for(let n=0;n<s.length;n++)s[n]=t[e+2+n];let l=o?o.vertexPosition:0,c=o?o.indexPosition:0;const a=l/i;return S(n,l,u,f,0),s.length&&n.set(s,l+3),l+=i,S(n,l,u,f,1),s.length&&n.set(s,l+3),l+=i,S(n,l,u,f,2),s.length&&n.set(s,l+3),l+=i,S(n,l,u,f,3),s.length&&n.set(s,l+3),l+=i,r[c++]=a,r[c++]=a+1,r[c++]=a+3,r[c++]=a+1,r[c++]=a+2,r[c++]=a+3,R.vertexPosition=l,R.indexPosition=c,R}function _(t,e,n,r,x,o,i,u,f,s,l){const c=10+u.length,a=o.length/c,h=[t[e+0],t[e+1]],y=[t[n],t[n+1]],p=t[e+2],v=t[n+2],g=P(f,[...h]),b=P(f,[...y]);function M(t,e,n){const r=Math.sqrt((e[0]-t[0])*(e[0]-t[0])+(e[1]-t[1])*(e[1]-t[1])),x=[(e[0]-t[0])/r,(e[1]-t[1])/r],o=[-x[1],x[0]],i=Math.sqrt((n[0]-t[0])*(n[0]-t[0])+(n[1]-t[1])*(n[1]-t[1])),u=[(n[0]-t[0])/i,(n[1]-t[1])/i],f=0===r||0===i?0:Math.acos((s=u[0]*x[0]+u[1]*x[1],l=-1,c=1,Math.min(Math.max(s,l),c)));var s,l,c;return u[0]*o[0]+u[1]*o[1]>0?f:2*Math.PI-f}let m=-1,Z=-1,d=l;const w=null!==x;if(null!==r){m=M(g,b,P(f,[...[t[r],t[r+1]]])),Math.cos(m)<=.985&&(d+=Math.tan((m-Math.PI)/2))}if(w){Z=M(b,g,P(f,[...[t[x],t[x+1]]])),Math.cos(Z)<=.985&&(d+=Math.tan((Math.PI-Z)/2))}function A(t,e){return 0===e?1e4*t:Math.sign(e)*(1e4*t+Math.abs(e))}return o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(0,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(1,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(2,l)),o.push(...u),o.push(h[0],h[1],p,y[0],y[1],v,m,Z,s,A(3,l)),o.push(...u),i.push(a,a+1,a+2,a+1,a+3,a+2),{length:s+Math.sqrt((b[0]-g[0])*(b[0]-g[0])+(b[1]-g[1])*(b[1]-g[1])),angle:d}}function O(t,e,n,x,o){const i=2+o;let u=e;const f=t.slice(u,u+o);u+=o;const s=t[u++];let l=0;const c=new Array(s-1);for(let e=0;e<s;e++)l+=t[u++],e<s-1&&(c[e]=l);const a=t.slice(u,u+2*l),h=r(a,c,2);for(let t=0;t<h.length;t++)x.push(h[t]+n.length/i);for(let t=0;t<a.length;t+=2)n.push(a[t],a[t+1],...f);return u+2*l}const U=self;U.onmessage=r=>{const x=r.data;switch(x.type){case e:{const t=3,e=2,n=x.customAttributesSize,r=e+n,o=new Float32Array(x.renderInstructions),i=o.length/r,u=4*i*(n+t),f=new Uint32Array(6*i),s=new Float32Array(u);let l;for(let t=0;t<o.length;t+=r)l=T(o,t,s,f,n,l);const c=Object.assign({vertexBuffer:s.buffer,indexBuffer:f.buffer,renderInstructions:o.buffer},x);U.postMessage(c,[s.buffer,f.buffer,o.buffer]);break}case n:{const t=[],e=[],n=x.customAttributesSize,r=3,o=new Float32Array(x.renderInstructions);let i=0;const u=[1,0,0,1,0,0];let f,s;for(B(u,x.renderInstructionsTransform);i<o.length;){s=Array.from(o.slice(i,i+n)),i+=n,f=o[i++];const x=i,l=i+(f-1)*r,c=o[x]===o[l]&&o[x+1]===o[l+1];let a=0,h=0;for(let n=0;n<f-1;n++){let y=null;n>0?y=i+(n-1)*r:c&&(y=l-r);let p=null;n<f-2?p=i+(n+2)*r:c&&(p=x+r);const v=_(o,i+n*r,i+(n+1)*r,y,p,t,e,s,u,a,h);a=v.length,h=v.angle}i+=f*r}const l=Uint32Array.from(e),c=Float32Array.from(t),a=Object.assign({vertexBuffer:c.buffer,indexBuffer:l.buffer,renderInstructions:o.buffer},x);U.postMessage(a,[c.buffer,l.buffer,o.buffer]);break}case t:{const t=[],e=[],n=x.customAttributesSize,r=new Float32Array(x.renderInstructions);let o=0;for(;o<r.length;)o=O(r,o,t,e,n);const i=Uint32Array.from(e),u=Float32Array.from(t),f=Object.assign({vertexBuffer:u.buffer,indexBuffer:i.buffer,renderInstructions:r.buffer},x);U.postMessage(f,[u.buffer,i.buffer,r.buffer]);break}}};';return new Worker(typeof Blob>"u"?"data:application/javascript;base64,"+Buffer.from(r,"binary").toString("base64"):URL.createObjectURL(new Blob([r],{type:"application/javascript"})))}class bn extends Eh{constructor(e,t){super(e),t=t||{},this.inversePixelTransform_=Ce(),this.postProcesses_=t.postProcesses,this.uniforms_=t.uniforms,this.helper,this.onMapChanged_=()=>{this.clearCache(),this.removeHelper()},e.addChangeListener(fs.MAP,this.onMapChanged_),this.dispatchPreComposeEvent=this.dispatchPreComposeEvent.bind(this),this.dispatchPostComposeEvent=this.dispatchPostComposeEvent.bind(this)}dispatchPreComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(jt.PRECOMPOSE)){const i=new Gi(jt.PRECOMPOSE,void 0,t,e);n.dispatchEvent(i)}}dispatchPostComposeEvent(e,t){const n=this.getLayer();if(n.hasListener(jt.POSTCOMPOSE)){const i=new Gi(jt.POSTCOMPOSE,void 0,t,e);n.dispatchEvent(i)}}reset(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)}removeHelper(){this.helper&&(this.helper.dispose(),delete this.helper)}prepareFrame(e){if(this.getLayer().getRenderSource()){let t=!0,n=-1,i;for(let o=0,a=e.layerStatesArray.length;o<a;o++){const c=e.layerStatesArray[o].layer,l=c.getRenderer();if(!(l instanceof bn)){t=!0;continue}const u=c.getClassName();if((t||u!==i)&&(n+=1,t=!1),i=u,l===this)break}const s="map/"+e.mapId+"/group/"+n;(!this.helper||!this.helper.canvasCacheKeyMatches(s)||this.helper.needsToBeRecreated())&&(this.removeHelper(),this.helper=new Jm({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:s}),i&&(this.helper.getCanvas().className=i),this.afterHelperCreated())}return this.prepareFrameInternal(e)}afterHelperCreated(){}prepareFrameInternal(e){return!0}clearCache(){}disposeInternal(){var e;this.clearCache(),this.removeHelper(),(e=this.getLayer())==null||e.removeChangeListener(fs.MAP,this.onMapChanged_),super.disposeInternal()}dispatchRenderEvent_(e,t,n){const i=this.getLayer();if(i.hasListener(e)){Ys(this.inversePixelTransform_,0,0,n.pixelRatio,-n.pixelRatio,0,0,-n.size[1]);const s=new Gi(e,this.inversePixelTransform_,n,t);i.dispatchEvent(s)}}preRender(e,t){this.dispatchRenderEvent_(jt.PRERENDER,e,t)}postRender(e,t){this.dispatchRenderEvent_(jt.POSTRENDER,e,t)}}function Dc(r,e){const t=r.viewState.projection,i=e.getSource().getWrapX()&&t.canWrapX(),s=t.getExtent(),o=r.extent,a=i?Fe(s):null,c=i?Math.ceil((o[2]-s[2])/a)+1:1;return[i?Math.floor((o[0]-s[0])/a):0,c,a]}class Uc extends bn{constructor(e,t){const n=t.uniforms||{},i=Ce();n[gt.PROJECTION_MATRIX]=i,super(e,{uniforms:n,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.verticesBuffer_=new wr(xn,ci),this.indicesBuffer_=new wr(En,ci),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.program_,this.hitDetectionEnabled_=t.hitDetectionEnabled??!0;const s=t.attributes?t.attributes.map(function(a){return{name:"a_"+a.name,size:1,type:Se.FLOAT}}):[];this.attributes=[{name:"a_position",size:2,type:Se.FLOAT},{name:"a_index",size:1,type:Se.FLOAT}],this.hitDetectionEnabled_&&(this.attributes.push({name:"a_hitColor",size:4,type:Se.FLOAT}),this.attributes.push({name:"a_featureUid",size:1,type:Se.FLOAT})),this.attributes.push(...s),this.customAttributes=t.attributes?t.attributes:[],this.previousExtent_=mn(),this.currentTransform_=i,this.renderTransform_=Ce(),this.invertRenderTransform_=Ce(),this.renderInstructions_=new Float32Array(0),this.hitRenderTarget_,this.lastSentId=0,this.worker_=Nc(),this.worker_.addEventListener("message",a=>{const c=a.data;if(c.type===Zr.GENERATE_POINT_BUFFERS){const l=c.projectionTransform;this.verticesBuffer_.fromArrayBuffer(c.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.fromArrayBuffer(c.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=l,on(this.invertRenderTransform_,this.renderTransform_),this.renderInstructions_=new Float32Array(a.data.renderInstructions),c.id===this.lastSentId&&(this.ready=!0),this.getLayer().changed()}}),this.featureCache_={},this.featureCount_=0;const o=this.getLayer().getSource();this.sourceListenKeys_=[St(o,Nt.ADDFEATURE,this.handleSourceFeatureAdded_,this),St(o,Nt.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),St(o,Nt.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),St(o,Nt.CLEAR,this.handleSourceFeatureClear_,this)],o.forEachFeature(a=>{const c=a.getGeometry();c&&c.getType()==="Point"&&(this.featureCache_[de(a)]={feature:a,properties:a.getProperties(),flatCoordinates:c.getFlatCoordinates()},this.featureCount_++)})}afterHelperCreated(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new Mc(this.helper)),this.verticesBuffer_.getArray()&&this.helper.flushBufferData(this.verticesBuffer_),this.indicesBuffer_.getArray()&&this.helper.flushBufferData(this.indicesBuffer_)}handleSourceFeatureAdded_(e){const t=e.feature,n=t.getGeometry();n&&n.getType()==="Point"&&(this.featureCache_[de(t)]={feature:t,properties:t.getProperties(),flatCoordinates:n.getFlatCoordinates()},this.featureCount_++)}handleSourceFeatureChanged_(e){const t=e.feature,n=de(t),i=this.featureCache_[n],s=t.getGeometry();i?s&&s.getType()==="Point"?(i.properties=t.getProperties(),i.flatCoordinates=s.getFlatCoordinates()):(delete this.featureCache_[n],this.featureCount_--):s&&s.getType()==="Point"&&(this.featureCache_[n]={feature:t,properties:t.getProperties(),flatCoordinates:s.getFlatCoordinates()},this.featureCount_++)}handleSourceFeatureDelete_(e){const t=e.feature,n=de(t);n in this.featureCache_&&(delete this.featureCache_[n],this.featureCount_--)}handleSourceFeatureClear_(){this.featureCache_={},this.featureCount_=0}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[n,i,s]=Dc(e,this.getLayer());return this.renderWorlds(e,!1,n,i,s),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent),this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,n,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),this.helper.getCanvas()}prepareFrameInternal(e){const t=this.getLayer(),n=t.getSource(),i=e.viewState,s=!e.viewHints[Bt.ANIMATING]&&!e.viewHints[Bt.INTERACTING],o=!ln(this.previousExtent_,e.extent),a=this.sourceRevision_<n.getRevision();if(a&&(this.sourceRevision_=n.getRevision()),s&&(o||a)){const c=i.projection,l=i.resolution,u=t instanceof wi?t.getRenderBuffer():0,h=eo(e.extent,u*l);n.loadFeatures(h,l,c),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.useProgram(this.program_,e),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0}rebuildBuffers_(e){const t=Ce();this.helper.makeProjectionTransform(e,t);const i=(this.hitDetectionEnabled_?7:2)+this.customAttributes.length,s=i*this.featureCount_,o=this.renderInstructions_&&this.renderInstructions_.length===s?this.renderInstructions_:new Float32Array(s);this.renderInstructions_=null;let a=[];const c=[];let l=-1;e.viewState.projection;for(const h in this.featureCache_){const f=this.featureCache_[h];if(a[0]=f.flatCoordinates[0],a[1]=f.flatCoordinates[1],Pt(t,a),o[++l]=a[0],o[++l]=a[1],this.hitDetectionEnabled_){const d=Ic(l+5,c);o[++l]=d[0],o[++l]=d[1],o[++l]=d[2],o[++l]=d[3],o[++l]=Number(h)}for(let d=0;d<this.customAttributes.length;d++){const p=this.customAttributes[d].callback(f.feature,f.properties);o[++l]=p}}const u={id:++this.lastSentId,type:Zr.GENERATE_POINT_BUFFERS,renderInstructions:o.buffer,customAttributesSize:i-2};u.projectionTransform=t,this.ready=!1,this.worker_.postMessage(u,[o.buffer])}forEachFeatureAtCoordinate(e,t,n,i,s){if(Je(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.renderInstructions_||!this.hitDetectionEnabled_)return;const o=Pt(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),c=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],l=Cc(c),u=this.renderInstructions_[l],h=Math.floor(u).toString(),d=this.getLayer().getSource().getFeatureByUid(h);if(d)return i(d,this.getLayer(),null)}renderWorlds(e,t,n,i,s){let o=n;this.helper.useProgram(this.program_,e),t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0)),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes);do{this.helper.makeProjectionTransform(e,this.currentTransform_),qs(this.currentTransform_,o*s,0),nn(this.currentTransform_,this.invertRenderTransform_),this.helper.applyUniforms(e),this.helper.applyHitDetectionUniform(t);const a=this.indicesBuffer_.getSize();this.helper.drawElements(0,a)}while(++o<i)}disposeInternal(){this.worker_.terminate(),this.sourceListenKeys_.forEach(function(e){oi(e)}),this.sourceListenKeys_=null,super.disposeInternal()}renderDeclutter(){}}class e_ extends Pf{constructor(e){super(),this.tile,this.handleTileChange_=this.handleTileChange_.bind(this),this.gutter=e.gutter||0,this.helper=e.helper,this.loaded=!1,this.ready=!1}setTile(e){if(e!==this.tile)if(this.tile&&this.tile.removeEventListener(ze.CHANGE,this.handleTileChange_),this.tile=e,this.loaded=e.getState()===Q.LOADED,this.loaded)this.uploadTile();else{if(e instanceof Bs){const t=e.getImage();t instanceof Image&&!t.crossOrigin&&(t.crossOrigin="anonymous")}e.addEventListener(ze.CHANGE,this.handleTileChange_)}}uploadTile(){Js()}setReady(){this.ready=!0,this.dispatchEvent(ze.CHANGE)}handleTileChange_(){this.tile.getState()===Q.LOADED&&(this.loaded=!0,this.uploadTile())}setHelper(e){this.helper=e,this.helper&&this.loaded&&this.uploadTile()}disposeInternal(){this.setHelper(null),this.tile.removeEventListener(ze.CHANGE,this.handleTileChange_)}}function Bc(r,e,t){const n=t?r.LINEAR:r.NEAREST;r.bindTexture(r.TEXTURE_2D,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,n)}function t_(r,e,t,n){Bc(r,e,n),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)}function tl(r,e,t,n,i,s){const o=r.getGL();let a,c;t instanceof Float32Array?(a=o.FLOAT,r.getExtension("OES_texture_float"),c=r.getExtension("OES_texture_float_linear")!==null):(a=o.UNSIGNED_BYTE,c=!0),Bc(o,e,s&&c);const l=t.byteLength/n[1];let u=1;l%8===0?u=8:l%4===0?u=4:l%2===0&&(u=2);let h;switch(i){case 1:{h=o.LUMINANCE;break}case 2:{h=o.LUMINANCE_ALPHA;break}case 3:{h=o.RGB;break}case 4:{h=o.RGBA;break}default:throw new Error(`Unsupported number of bands: ${i}`)}const f=o.getParameter(o.UNPACK_ALIGNMENT);o.pixelStorei(o.UNPACK_ALIGNMENT,u),o.texImage2D(o.TEXTURE_2D,0,h,n[0],n[1],0,h,a,t),o.pixelStorei(o.UNPACK_ALIGNMENT,f)}let fr=null;function r_(){fr=Gt(1,1,void 0,{willReadFrequently:!0})}class n_ extends e_{constructor(e){super(e),this.textures=[],this.renderSize_=ot(e.grid.getTileSize(e.tile.tileCoord[0])),this.bandCount=NaN;const t=new wr(xn,mo);t.fromArray([0,1,1,1,1,0,0,0]),this.helper.flushBufferData(t),this.coords=t,this.setTile(e.tile)}setHelper(e){var n;const t=(n=this.helper)==null?void 0:n.getGL();if(t){this.helper.deleteBuffer(this.coords);for(let i=0;i<this.textures.length;++i)t.deleteTexture(this.textures[i])}super.setHelper(e),e&&e.flushBufferData(this.coords)}uploadTile(){const e=this.helper,t=e.getGL(),n=this.tile;this.textures.length=0;let i;n instanceof Bs||n instanceof bh?i=n.getImage():i=n.getData();const s=os(i);if(s){const _=t.createTexture();this.textures.push(_),this.bandCount=4,t_(t,_,s,n.interpolate),this.setReady();return}i=ss(i);const o=n.getSize(),a=[o[0]+2*this.gutter,o[1]+2*this.gutter],c=i instanceof Float32Array,l=a[0]*a[1],u=c?Float32Array:Uint8Array,h=u.BYTES_PER_ELEMENT,f=i.byteLength/a[1];this.bandCount=Math.floor(f/h/a[0]);const d=Math.ceil(this.bandCount/4);if(d===1){const _=t.createTexture();this.textures.push(_),tl(e,_,i,a,this.bandCount,n.interpolate),this.setReady();return}const p=new Array(d);for(let _=0;_<d;++_){const E=t.createTexture();this.textures.push(E);const S=_<d-1?4:(this.bandCount-1)%4+1;p[_]=new u(l*S)}let g=0,m=0;const y=a[0]*this.bandCount;for(let _=0;_<a[1];++_){for(let E=0;E<y;++E){const S=i[m+E],R=Math.floor(g/this.bandCount),w=E%this.bandCount,A=Math.floor(w/4),C=p[A],P=C.length/l,v=w%4;C[R*P+v]=S,++g}m+=f/h}for(let _=0;_<d;++_){const E=this.textures[_],S=p[_],R=S.length/l;tl(e,E,S,a,R,n.interpolate)}this.setReady()}getImagePixelData_(e,t,n){const i=this.gutter,s=this.renderSize_[0],o=this.renderSize_[1];fr||r_(),fr.clearRect(0,0,1,1);const a=e.width,c=e.height,l=a-2*i,u=c-2*i,h=i+Math.floor(l*(t/s)),f=i+Math.floor(u*(n/o));let d;try{fr.drawImage(e,h,f,1,1,0,0,1,1),d=fr.getImageData(0,0,1,1).data}catch{return fr=null,null}return d}getArrayPixelData_(e,t,n,i){const s=this.gutter,o=this.renderSize_[0],a=this.renderSize_[1],c=t[0],l=t[1],u=c+2*s,h=l+2*s,f=s+Math.floor(c*(n/o)),d=s+Math.floor(l*(i/a));if(e instanceof DataView){const g=e.byteLength/(u*h),m=g*(d*u+f),y=e.buffer.slice(m,m+g);return new DataView(y)}const p=this.bandCount*(d*u+f);return e.slice(p,p+this.bandCount)}getPixelData(e,t){if(!this.loaded)return null;if(this.tile instanceof Gs){const n=this.tile.getData(),i=ss(n);if(i){const s=this.tile.getSize();return this.getArrayPixelData_(i,s,e,t)}return this.getImagePixelData_(os(n),e,t)}return this.getImagePixelData_(this.tile.getImage(),e,t)}}const i_={TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",RESOLUTION:"u_resolution",ZOOM:"u_zoom",GLOBAL_ALPHA:"u_globalAlpha",PROJECTION_MATRIX:"u_projectionMatrix",SCREEN_TO_WORLD_MATRIX:"u_screenToWorldMatrix"};function rl(r){return 1/(r+2)}function s_(){return{tileIds:new Set,representationsByZ:{}}}function nl(r,e){return r.tileIds.has(de(e))}function il(r,e,t){const n=r.representationsByZ;t in n||(n[t]=new Set),n[t].add(e),r.tileIds.add(de(e.tile))}function Xi(r,e){const t=r.layerStatesArray[r.layerIndex];t.extent&&(e=it(e,tc(t.extent,r.viewState.projection)));const n=t.layer.getRenderSource();if(!n.getWrapX()){const i=n.getTileGridForProjection(r.viewState.projection).getExtent();i&&(e=it(e,i))}return e}function xs(r,e){return`${r.getKey()},${r.getRevision()},${hr(e)}`}class o_ extends bn{constructor(e,t){super(e,{uniforms:t.uniforms,postProcesses:t.postProcesses}),this.renderComplete=!1,this.tileTransform_=Ce(),this.tempMat4=rr(),this.tempTileRange_=new Th(0,0,0,0),this.tempTileCoord_=as(0,0,0),this.tempSize_=[0,0];const n=t.cacheSize!==void 0?t.cacheSize:512;this.tileRepresentationCache=new Xl(n),this.frameState=null,this.renderedProjection_=void 0}reset(e){super.reset({uniforms:e.uniforms})}prepareFrameInternal(e){this.renderedProjection_?e.viewState.projection!==this.renderedProjection_&&(this.clearCache(),this.renderedProjection_=e.viewState.projection):this.renderedProjection_=e.viewState.projection;const n=this.getLayer().getRenderSource();return!n||Li(Xi(e,e.extent))?!1:n.getState()==="ready"}createTileRepresentation(e){return Js()}enqueueTiles(e,t,n,i,s){const o=e.viewState,a=this.getLayer(),c=a.getRenderSource(),l=c.getTileGridForProjection(o.projection),u=c.getGutterForProjection(o.projection),h=de(c);h in e.wantedTiles||(e.wantedTiles[h]={});const f=e.wantedTiles[h],d=this.tileRepresentationCache,p=a.getMapInternal(),g=Math.max(n-s,l.getMinZoom(),l.getZForResolution(Math.min(a.getMaxResolution(),p?p.getView().getResolutionForZoom(Math.max(a.getMinZoom(),0)):l.getResolution(0)),c.zDirection)),m=o.rotation,y=m?Lf(o.center,o.resolution,m,e.size):void 0;for(let _=n;_>=g;--_){const E=l.getTileRangeForExtentAndZ(t,_,this.tempTileRange_),S=l.getResolution(_);for(let R=E.minX;R<=E.maxX;++R)for(let w=E.minY;w<=E.maxY;++w){if(m&&!l.tileCoordIntersectsViewport([_,R,w],y))continue;const A=as(_,R,w,this.tempTileCoord_),C=xs(c,A);let P,v;if(d.containsKey(C)&&(P=d.get(C),v=P.tile),(!P||P.tile.key!==c.getKey())&&(v=c.getTile(_,R,w,e.pixelRatio,o.projection),!v)||nl(i,v))continue;P?P.setTile(v):(P=this.createTileRepresentation({tile:v,grid:l,helper:this.helper,gutter:u}),d.set(C,P)),il(i,P,_);const U=v.getKey();f[U]=!0,v.getState()===Q.IDLE&&(e.tileQueue.isKeyQueued(U)||e.tileQueue.enqueue([v,h,l.getTileCoordCenter(A),S]))}}}beforeTilesRender(e,t){this.helper.prepareDraw(this.frameState,!t,!0)}beforeTilesMaskRender(e){return!1}renderTile(e,t,n,i,s,o,a,c,l,u,h){}renderTileMask(e,t,n,i){}drawTile_(e,t,n,i,s,o,a){if(!t.ready)return;const l=t.tile.tileCoord,u=hr(l),h=u in o?o[u]:1,f=a.getResolution(n),d=ot(a.getTileSize(n),this.tempSize_),p=a.getOrigin(n),g=a.getTileCoordExtent(l),m=h<1?-1:rl(n);h<1&&(e.animate=!0);const y=e.viewState,_=y.center[0],E=y.center[1],S=d[0]+2*i,R=d[1]+2*i,w=S/R,A=(_-p[0])/(d[0]*f),C=(p[1]-E)/(d[1]*f),P=y.resolution/f,v=l[1],U=l[2];ff(this.tileTransform_),ha(this.tileTransform_,2/(e.size[0]*P/S),-2/(e.size[1]*P/S)),df(this.tileTransform_,y.rotation),ha(this.tileTransform_,1,1/w),qs(this.tileTransform_,(d[0]*(v-A)-i)/S,(d[1]*(U-C)-i)/R),this.renderTile(t,this.tileTransform_,e,s,f,d,p,g,m,i,h)}renderFrame(e){this.frameState=e,this.renderComplete=!0;const t=this.helper.getGL();this.preRender(t,e);const n=e.viewState,i=this.getLayer(),s=i.getRenderSource(),o=s.getTileGridForProjection(n.projection),a=s.getGutterForProjection(n.projection),c=Xi(e,e.extent),l=o.getZForResolution(n.resolution,s.zDirection),u=s_(),h=i.getPreload();if(e.nextExtent){const E=o.getZForResolution(n.nextResolution,s.zDirection),S=Xi(e,e.nextExtent);this.enqueueTiles(e,S,E,u,h)}this.enqueueTiles(e,c,l,u,0),h>0&&setTimeout(()=>{this.enqueueTiles(e,c,l-1,u,h-1)},0);const f={};let d=!1;const p=u.representationsByZ;if(l in p){const E=de(this),S=e.time;for(const R of p[l]){const w=R.tile;if(w.getState()===Q.EMPTY)continue;const A=w.tileCoord;if(R.ready){const v=w.getAlpha(E,S);if(v===1){w.endTransition(E);continue}d=!0;const U=hr(A);f[U]=v}if(this.renderComplete=!1,this.findAltTiles_(o,A,l+1,u))continue;const P=o.getMinZoom();for(let v=l-1;v>=P&&!this.findAltTiles_(o,A,v,u);--v);}}const g=Object.keys(p).map(Number).sort(If);if(this.beforeTilesMaskRender(e))for(let E=0,S=g.length;E<S;++E){const R=g[E];for(const w of p[R]){const A=w.tile.tileCoord;if(hr(A)in f)continue;const P=o.getTileCoordExtent(A);this.renderTileMask(w,R,P,rl(R))}}this.beforeTilesRender(e,d);for(let E=0,S=g.length;E<S;++E){const R=g[E];for(const w of p[R]){const A=w.tile.tileCoord;hr(A)in f||this.drawTile_(e,w,R,a,c,f,o)}}if(l in p)for(const E of p[l]){const S=E.tile.tileCoord;hr(S)in f&&this.drawTile_(e,E,l,a,c,f,o)}this.beforeFinalize(e),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const y=this.helper.getCanvas(),_=this.tileRepresentationCache;for(;_.canExpireCache();)_.pop().dispose();return this.postRender(t,e),y}beforeFinalize(e){}findAltTiles_(e,t,n,i){const s=e.getTileRangeForTileCoordAndZ(t,n,this.tempTileRange_);if(!s)return!1;let o=!0;const a=this.tileRepresentationCache,c=this.getLayer().getRenderSource();for(let l=s.minX;l<=s.maxX;++l)for(let u=s.minY;u<=s.maxY;++u){const h=xs(c,[n,l,u]);let f=!1;if(a.containsKey(h)){const d=a.get(h);d.ready&&!nl(i,d.tile)&&(il(i,d,n),f=!0)}f||(o=!1)}return o}clearCache(){super.clearCache();const e=this.tileRepresentationCache;e.forEach(t=>t.dispose()),e.clear()}afterHelperCreated(){super.afterHelperCreated(),this.tileRepresentationCache.forEach(e=>e.setHelper(this.helper))}disposeInternal(){super.disposeInternal(),delete this.frameState}}const j={...i_,TILE_TEXTURE_ARRAY:"u_tileTextures",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY"},jn={TEXTURE_COORD:"a_textureCoord"},a_=[{name:jn.TEXTURE_COORD,size:2,type:Se.FLOAT}];class l_ extends o_{constructor(e,t){super(e,t),this.program_,this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.indices_=new wr(En,mo),this.indices_.fromArray([0,1,3,1,2,3]),this.paletteTextures_=t.paletteTextures||[]}reset(e){if(super.reset(e),this.helper){const t=this.helper.getGL();for(const n of this.paletteTextures_)n.delete(t)}if(this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_);const t=this.helper.getGL();for(const n of this.paletteTextures_)n.getTexture(t)}}afterHelperCreated(){super.afterHelperCreated();const e=this.helper.getGL();for(const t of this.paletteTextures_)t.getTexture(e);this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)}removeHelper(){if(this.helper){const e=this.helper.getGL();for(const t of this.paletteTextures_)t.delete(e)}super.removeHelper()}createTileRepresentation(e){return new n_(e)}beforeTilesRender(e,t){super.beforeTilesRender(e,t),this.helper.useProgram(this.program_,e)}renderTile(e,t,n,i,s,o,a,c,l,u,h){const f=this.helper.getGL();this.helper.bindBuffer(e.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(a_);let d=0;for(;d<e.textures.length;){const w=`${j.TILE_TEXTURE_ARRAY}[${d}]`;this.helper.bindTexture(e.textures[d],d,w),++d}for(let w=0;w<this.paletteTextures_.length;++w){const A=this.paletteTextures_[w],C=A.getTexture(f);this.helper.bindTexture(C,d,A.name),++d}const p=n.viewState,g=o[0]+2*u,m=o[1]+2*u,_=e.tile.tileCoord,E=_[1],S=_[2];this.helper.setUniformMatrixValue(j.TILE_TRANSFORM,ui(this.tempMat4,t)),this.helper.setUniformFloatValue(j.TRANSITION_ALPHA,h),this.helper.setUniformFloatValue(j.DEPTH,l);let R=i;u>0&&(R=c,it(R,i,R)),this.helper.setUniformFloatVec4(j.RENDER_EXTENT,R),this.helper.setUniformFloatValue(j.RESOLUTION,p.resolution),this.helper.setUniformFloatValue(j.ZOOM,p.zoom),this.helper.setUniformFloatValue(j.TEXTURE_PIXEL_WIDTH,g),this.helper.setUniformFloatValue(j.TEXTURE_PIXEL_HEIGHT,m),this.helper.setUniformFloatValue(j.TEXTURE_RESOLUTION,s),this.helper.setUniformFloatValue(j.TEXTURE_ORIGIN_X,a[0]+E*o[0]*s-u*s),this.helper.setUniformFloatValue(j.TEXTURE_ORIGIN_Y,a[1]-S*o[1]*s+u*s),this.helper.drawElements(0,this.indices_.getSize())}getData(e){if(!this.helper.getGL())return null;const n=this.frameState;if(!n)return null;const i=this.getLayer(),s=Pt(n.pixelToCoordinateTransform,e.slice()),o=n.viewState,a=i.getExtent();if(a&&!gr(tc(a,o.projection),s))return null;const c=i.getSources(Qs([s]),o.resolution);let l,u,h;for(l=c.length-1;l>=0;--l)if(u=c[l],u.getState()==="ready"){if(h=u.getTileGridForProjection(o.projection),u.getWrapX())break;const d=h.getExtent();if(!d||gr(d,s))break}if(l<0)return null;const f=this.tileRepresentationCache;for(let d=h.getZForResolution(o.resolution);d>=h.getMinZoom();--d){const p=h.getTileCoordForCoordAndZ(s,d),g=xs(u,p);if(!f.containsKey(g))continue;const m=f.get(g);if(m.tile.getState()===Q.EMPTY)return null;if(!m.loaded)continue;const _=h.getOrigin(d),E=ot(h.getTileSize(d)),S=h.getResolution(d),R=(s[0]-_[0])/S-p[1]*E[0],w=(_[1]-s[1])/S-p[2]*E[1];return m.getPixelData(R,w)}return null}disposeInternal(){const e=this.helper;if(e){const t=e.getGL();for(const n of this.paletteTextures_)n.delete(t);this.paletteTextures_.length=0,t.deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_)}super.disposeInternal(),delete this.indices_}}class c_{constructor(e,t){this.name=e,this.data=t,this.texture_=null}getTexture(e){if(!this.texture_){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_}delete(e){this.texture_&&e.deleteTexture(this.texture_),this.texture_=null}}function u_(r,e){return`operator_${r}_${Object.keys(e.functions).length}`}function Kt(r){const e=r.toString();return e.includes(".")?e:e+".0"}function _o(r){if(r.length<2||r.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return`vec${r.length}(${r.map(Kt).join(", ")})`}function Hn(r){const e=en(r),t=e.length>3?e[3]:1;return _o([e[0]/255,e[1]/255,e[2]/255,t])}function h_(r){const e=ot(r);return _o(e)}const Wi={};let f_=0;function mr(r){return r in Wi||(Wi[r]=f_++),Wi[r]}function wt(r){return Kt(mr(r))}function yo(r){return"u_var_"+r}function Es(){return{inFragmentShader:!1,variables:{},properties:{},functions:{},bandCount:0,featureId:!1,geometryType:!1}}const ji="getBandValue",Gc="u_paletteTextures",zc="featureId",kc="geometryType";function d_(r,e,t,n){const i=wh(r,e,t);return xo(i,e,n)}function oe(r){return(e,t,n)=>{const i=t.args.length,s=new Array(i);for(let o=0;o<i;++o)s[o]=xo(t.args[o],n,e);return r(s,e)}}const p_={[Z.Get]:(r,e)=>{const n=e.args[0].value;return n in r.properties||(r.properties[n]={name:n,type:e.type}),(r.inFragmentShader?"v_prop_":"a_prop_")+n},[Z.Id]:r=>(r.featureId=!0,(r.inFragmentShader?"v_":"a_")+zc),[Z.GeometryType]:r=>(r.geometryType=!0,(r.inFragmentShader?"v_":"a_")+kc),[Z.LineMetric]:()=>"currentLineMetric",[Z.Var]:(r,e)=>{const n=e.args[0].value;return n in r.variables||(r.variables[n]={name:n,type:e.type}),yo(n)},[Z.Resolution]:()=>"u_resolution",[Z.Zoom]:()=>"u_zoom",[Z.Time]:()=>"u_time",[Z.Any]:oe(r=>`(${r.join(" || ")})`),[Z.All]:oe(r=>`(${r.join(" && ")})`),[Z.Not]:oe(([r])=>`(!${r})`),[Z.Equal]:oe(([r,e])=>`(${r} == ${e})`),[Z.NotEqual]:oe(([r,e])=>`(${r} != ${e})`),[Z.GreaterThan]:oe(([r,e])=>`(${r} > ${e})`),[Z.GreaterThanOrEqualTo]:oe(([r,e])=>`(${r} >= ${e})`),[Z.LessThan]:oe(([r,e])=>`(${r} < ${e})`),[Z.LessThanOrEqualTo]:oe(([r,e])=>`(${r} <= ${e})`),[Z.Multiply]:oe(r=>`(${r.join(" * ")})`),[Z.Divide]:oe(([r,e])=>`(${r} / ${e})`),[Z.Add]:oe(r=>`(${r.join(" + ")})`),[Z.Subtract]:oe(([r,e])=>`(${r} - ${e})`),[Z.Clamp]:oe(([r,e,t])=>`clamp(${r}, ${e}, ${t})`),[Z.Mod]:oe(([r,e])=>`mod(${r}, ${e})`),[Z.Pow]:oe(([r,e])=>`pow(${r}, ${e})`),[Z.Abs]:oe(([r])=>`abs(${r})`),[Z.Floor]:oe(([r])=>`floor(${r})`),[Z.Ceil]:oe(([r])=>`ceil(${r})`),[Z.Round]:oe(([r])=>`floor(${r} + 0.5)`),[Z.Sin]:oe(([r])=>`sin(${r})`),[Z.Cos]:oe(([r])=>`cos(${r})`),[Z.Atan]:oe(([r,e])=>e!==void 0?`atan(${r}, ${e})`:`atan(${r})`),[Z.Sqrt]:oe(([r])=>`sqrt(${r})`),[Z.Match]:oe(r=>{const e=r[0],t=r[r.length-1];let n=null;for(let i=r.length-3;i>=1;i-=2){const s=r[i],o=r[i+1];n=`(${e} == ${s} ? ${o} : ${n||t})`}return n}),[Z.Between]:oe(([r,e,t])=>`(${r} >= ${e} && ${r} <= ${t})`),[Z.Interpolate]:oe(([r,e,...t])=>{let n="";for(let i=0;i<t.length-2;i+=2){const s=t[i],o=n||t[i+1],a=t[i+2],c=t[i+3];let l;r===Kt(1)?l=`(${e} - ${s}) / (${a} - ${s})`:l=`(pow(${r}, (${e} - ${s})) - 1.0) / (pow(${r}, (${a} - ${s})) - 1.0)`,n=`mix(${o}, ${c}, clamp(${l}, 0.0, 1.0))`}return n}),[Z.Case]:oe(r=>{const e=r[r.length-1];let t=null;for(let n=r.length-3;n>=0;n-=2){const i=r[n],s=r[n+1];t=`(${i} ? ${s} : ${t||e})`}return t}),[Z.In]:oe(([r,...e],t)=>{const n=u_("in",t),i=[];for(let s=0;s<e.length;s+=1)i.push(`  if (inputValue == ${e[s]}) { return true; }`);return t.functions[n]=`bool ${n}(float inputValue) {
${i.join(`
`)}
  return false;
}`,`${n}(${r})`}),[Z.Array]:oe(r=>`vec${r.length}(${r.join(", ")})`),[Z.Color]:oe(r=>{if(r.length===1)return`vec4(vec3(${r[0]} / 255.0), 1.0)`;if(r.length===2)return`vec4(vec3(${r[0]} / 255.0), ${r[1]})`;const e=r.slice(0,3).map(n=>`${n} / 255.0`);if(r.length===3)return`vec4(${e.join(", ")}, 1.0)`;const t=r[3];return`vec4(${e.join(", ")}, ${t})`}),[Z.Band]:oe(([r,e,t],n)=>{if(!(ji in n.functions)){let i="";const s=n.bandCount||1;for(let o=0;o<s;o++){const a=Math.floor(o/4);let c=o%4;o===s-1&&c===1&&(c=3);const l=`${j.TILE_TEXTURE_ARRAY}[${a}]`;i+=`  if (band == ${o+1}.0) {
    return texture2D(${l}, v_textureCoord + vec2(dx, dy))[${c}];
  }
`}n.functions[ji]=`float getBandValue(float band, float xOffset, float yOffset) {
  float dx = xOffset / ${j.TEXTURE_PIXEL_WIDTH};
  float dy = yOffset / ${j.TEXTURE_PIXEL_HEIGHT};
${i}
}`}return`${ji}(${r}, ${e??"0.0"}, ${t??"0.0"})`}),[Z.Palette]:(r,e)=>{const[t,...n]=e.args,i=n.length,s=new Uint8Array(i*4);for(let l=0;l<n.length;l++){const u=n[l].value,h=en(u),f=l*4;s[f]=h[0],s[f+1]=h[1],s[f+2]=h[2],s[f+3]=h[3]*255}r.paletteTextures||(r.paletteTextures=[]);const o=`${Gc}[${r.paletteTextures.length}]`,a=new c_(o,s);r.paletteTextures.push(a);const c=xo(t,pe,r);return`texture2D(${o}, vec2((${c} + 0.5) / ${i}.0, 0.5))`}};function xo(r,e,t){if(r instanceof Sh){const n=p_[r.operator];if(n===void 0)throw new Error(`No compiler defined for this operator: ${JSON.stringify(r.operator)}`);return n(t,r,e)}if((r.type&pe)>0)return Kt(r.value);if((r.type&zs)>0)return r.value.toString();if((r.type&tn)>0)return wt(r.value.toString());if((r.type&Xe)>0)return Hn(r.value);if((r.type&zt)>0)return _o(r.value);if((r.type&Pr)>0)return h_(r.value);throw new Error(`Unexpected expression ${r.value} (expected type ${Rh(e)})`)}function g_(){return{"fill-color":"rgba(255,255,255,0.4)","stroke-color":"#3399CC","stroke-width":1.25,"circle-radius":5,"circle-fill-color":"rgba(255,255,255,0.4)","circle-stroke-width":1.25,"circle-stroke-color":"#3399CC"}}const or=`#ifdef GL_FRAGMENT_PRECISION_HIGH
precision highp float;
#else
precision mediump float;
#endif
uniform mat4 u_projectionMatrix;
uniform mat4 u_screenToWorldMatrix;
uniform vec2 u_viewportSizePx;
uniform float u_pixelRatio;
uniform float u_globalAlpha;
uniform float u_time;
uniform float u_zoom;
uniform float u_resolution;
uniform float u_rotation;
uniform vec4 u_renderExtent;
uniform vec2 u_patternOrigin;
uniform float u_depth;
uniform mediump int u_hitDetection;

const float PI = 3.141592653589793238;
const float TWO_PI = 2.0 * PI;
float currentLineMetric = 0.; // an actual value will be used in the stroke shaders
`,ar=g_();class $c{constructor(){this.uniforms_=[],this.attributes_=[],this.varyings_=[],this.hasSymbol_=!1,this.symbolSizeExpression_=`vec2(${Kt(ar["circle-radius"])} + ${Kt(ar["circle-stroke-width"]*.5)})`,this.symbolRotationExpression_="0.0",this.symbolOffsetExpression_="vec2(0.0)",this.symbolColorExpression_=Hn(ar["circle-fill-color"]),this.texCoordExpression_="vec4(0.0, 0.0, 1.0, 1.0)",this.discardExpression_="false",this.symbolRotateWithView_=!1,this.hasStroke_=!1,this.strokeWidthExpression_=Kt(ar["stroke-width"]),this.strokeColorExpression_=Hn(ar["stroke-color"]),this.strokeOffsetExpression_="0.",this.strokeCapExpression_=wt("round"),this.strokeJoinExpression_=wt("round"),this.strokeMiterLimitExpression_="10.",this.strokeDistanceFieldExpression_="-1000.",this.hasFill_=!1,this.fillColorExpression_=Hn(ar["fill-color"]),this.vertexShaderFunctions_=[],this.fragmentShaderFunctions_=[]}addUniform(e){return this.uniforms_.push(e),this}addAttribute(e){return this.attributes_.push(e),this}addVarying(e,t,n){return this.varyings_.push({name:e,type:t,expression:n}),this}setSymbolSizeExpression(e){return this.hasSymbol_=!0,this.symbolSizeExpression_=e,this}getSymbolSizeExpression(){return this.symbolSizeExpression_}setSymbolRotationExpression(e){return this.symbolRotationExpression_=e,this}setSymbolOffsetExpression(e){return this.symbolOffsetExpression_=e,this}getSymbolOffsetExpression(){return this.symbolOffsetExpression_}setSymbolColorExpression(e){return this.hasSymbol_=!0,this.symbolColorExpression_=e,this}getSymbolColorExpression(){return this.symbolColorExpression_}setTextureCoordinateExpression(e){return this.texCoordExpression_=e,this}setFragmentDiscardExpression(e){return this.discardExpression_=e,this}getFragmentDiscardExpression(){return this.discardExpression_}setSymbolRotateWithView(e){return this.symbolRotateWithView_=e,this}setStrokeWidthExpression(e){return this.hasStroke_=!0,this.strokeWidthExpression_=e,this}setStrokeColorExpression(e){return this.hasStroke_=!0,this.strokeColorExpression_=e,this}getStrokeColorExpression(){return this.strokeColorExpression_}setStrokeOffsetExpression(e){return this.strokeOffsetExpression_=e,this}setStrokeCapExpression(e){return this.strokeCapExpression_=e,this}setStrokeJoinExpression(e){return this.strokeJoinExpression_=e,this}setStrokeMiterLimitExpression(e){return this.strokeMiterLimitExpression_=e,this}setStrokeDistanceFieldExpression(e){return this.strokeDistanceFieldExpression_=e,this}setFillColorExpression(e){return this.hasFill_=!0,this.fillColorExpression_=e,this}getFillColorExpression(){return this.fillColorExpression_}addVertexShaderFunction(e){this.vertexShaderFunctions_.includes(e)||this.vertexShaderFunctions_.push(e)}addFragmentShaderFunction(e){this.fragmentShaderFunctions_.includes(e)||this.fragmentShaderFunctions_.push(e)}getSymbolVertexShader(){return this.hasSymbol_?`${or}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute float a_index;
attribute vec4 a_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec2 v_quadCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 pxToScreen(vec2 coordPx) {
  vec2 scaled = coordPx / u_viewportSizePx / 0.5;
  return scaled;
}

vec2 screenToPx(vec2 coordScreen) {
  return (coordScreen * 0.5 + 0.5) * u_viewportSizePx;
}

void main(void) {
  v_quadSizePx = ${this.symbolSizeExpression_};
  vec2 halfSizePx = v_quadSizePx * 0.5;
  vec2 centerOffsetPx = ${this.symbolOffsetExpression_};
  vec2 offsetPx = centerOffsetPx;
  if (a_index == 0.0) {
    offsetPx -= halfSizePx;
  } else if (a_index == 1.0) {
    offsetPx += halfSizePx * vec2(1., -1.);
  } else if (a_index == 2.0) {
    offsetPx += halfSizePx;
  } else {
    offsetPx += halfSizePx * vec2(-1., 1.);
  }
  float angle = ${this.symbolRotationExpression_};
  ${this.symbolRotateWithView_?"angle += u_rotation;":""}
  float c = cos(-angle);
  float s = sin(-angle);
  offsetPx = vec2(c * offsetPx.x - s * offsetPx.y, s * offsetPx.x + c * offsetPx.y);
  vec4 center = u_projectionMatrix * vec4(a_position, 0.0, 1.0);
  gl_Position = center + vec4(pxToScreen(offsetPx), u_depth, 0.);
  vec4 texCoord = ${this.texCoordExpression_};
  float u = a_index == 0.0 || a_index == 3.0 ? texCoord.s : texCoord.p;
  float v = a_index == 2.0 || a_index == 3.0 ? texCoord.t : texCoord.q;
  v_texCoord = vec2(u, v);
  v_hitColor = a_hitColor;
  v_angle = angle;
  c = cos(-v_angle);
  s = sin(-v_angle);
  centerOffsetPx = vec2(c * centerOffsetPx.x - s * centerOffsetPx.y, s * centerOffsetPx.x + c * centerOffsetPx.y); 
  v_centerPx = screenToPx(center.xy) + centerOffsetPx;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getSymbolFragmentShader(){return this.hasSymbol_?`${or}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec2 v_texCoord;
varying vec4 v_hitColor;
varying vec2 v_centerPx;
varying float v_angle;
varying vec2 v_quadSizePx;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

void main(void) {
  if (${this.discardExpression_}) { discard; }
  vec2 coordsPx = gl_FragCoord.xy / u_pixelRatio - v_centerPx; // relative to center
  float c = cos(v_angle);
  float s = sin(v_angle);
  coordsPx = vec2(c * coordsPx.x - s * coordsPx.y, s * coordsPx.x + c * coordsPx.y);
  gl_FragColor = ${this.symbolColorExpression_};
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.05) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getStrokeVertexShader(){return this.hasStroke_?`${or}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_segmentStart;
attribute vec2 a_segmentEnd;
attribute float a_measureStart;
attribute float a_measureEnd;
attribute float a_parameters;
attribute float a_distance;
attribute vec2 a_joinAngles;
attribute vec4 a_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
varying float v_measureStart;
varying float v_measureEnd;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

vec4 pxToScreen(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return vec4(screenPos, u_depth, 1.0);
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

vec2 getJoinOffsetDirection(vec2 normalPx, float joinAngle) {
  float halfAngle = joinAngle / 2.0;
  float c = cos(halfAngle);
  float s = sin(halfAngle);
  vec2 angleBisectorNormal = vec2(s * normalPx.x + c * normalPx.y, -c * normalPx.x + s * normalPx.y);
  float length = 1.0 / s;
  return angleBisectorNormal * length;
}

vec2 getOffsetPoint(vec2 point, vec2 normal, float joinAngle, float offsetPx) {
  // if on a cap or the join angle is too high, offset the line along the segment normal
  if (cos(joinAngle) > 0.998 || isCap(joinAngle)) {
    return point - normal * offsetPx;
  }
  // offset is applied along the inverted normal (positive offset goes "right" relative to line direction)
  return point - getJoinOffsetDirection(normal, joinAngle) * offsetPx;
}

void main(void) {
  v_angleStart = a_joinAngles.x;
  v_angleEnd = a_joinAngles.y;
  float vertexNumber = floor(abs(a_parameters) / 10000. + 0.5);
  currentLineMetric = vertexNumber < 1.5 ? a_measureStart : a_measureEnd;
  // we're reading the fractional part while keeping the sign (so -4.12 gives -0.12, 3.45 gives 0.45)
  float angleTangentSum = fract(abs(a_parameters) / 10000.) * 10000. * sign(a_parameters);

  float lineWidth = ${this.strokeWidthExpression_};
  float lineOffsetPx = ${this.strokeOffsetExpression_};

  // compute segment start/end in px with offset
  vec2 segmentStartPx = worldToPx(a_segmentStart);
  vec2 segmentEndPx = worldToPx(a_segmentEnd);
  vec2 tangentPx = normalize(segmentEndPx - segmentStartPx);
  vec2 normalPx = vec2(-tangentPx.y, tangentPx.x);
  segmentStartPx = getOffsetPoint(segmentStartPx, normalPx, v_angleStart, lineOffsetPx),
  segmentEndPx = getOffsetPoint(segmentEndPx, normalPx, v_angleEnd, lineOffsetPx);
  
  // compute current vertex position
  float normalDir = vertexNumber < 0.5 || (vertexNumber > 1.5 && vertexNumber < 2.5) ? 1.0 : -1.0;
  float tangentDir = vertexNumber < 1.5 ? 1.0 : -1.0;
  float angle = vertexNumber < 1.5 ? v_angleStart : v_angleEnd;
  vec2 joinDirection;
  vec2 positionPx = vertexNumber < 1.5 ? segmentStartPx : segmentEndPx;
  // if angle is too high, do not make a proper join
  if (cos(angle) > ${Ya} || isCap(angle)) {
    joinDirection = normalPx * normalDir - tangentPx * tangentDir;
  } else {
    joinDirection = getJoinOffsetDirection(normalPx * normalDir, angle);
  }
  positionPx = positionPx + joinDirection * (lineWidth * 0.5 + 1.); // adding 1 pixel for antialiasing
  gl_Position = pxToScreen(positionPx);

  v_segmentStart = segmentStartPx;
  v_segmentEnd = segmentEndPx;
  v_width = lineWidth;
  v_hitColor = a_hitColor;
  v_distanceOffsetPx = a_distance / u_resolution - (lineOffsetPx * angleTangentSum);
  v_measureStart = a_measureStart;
  v_measureEnd = a_measureEnd;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getStrokeFragmentShader(){return this.hasStroke_?`${or}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec2 v_segmentStart;
varying vec2 v_segmentEnd;
varying float v_angleStart;
varying float v_angleEnd;
varying float v_width;
varying vec4 v_hitColor;
varying float v_distanceOffsetPx;
varying float v_measureStart;
varying float v_measureEnd;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}

vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

bool isCap(float joinAngle) {
  return joinAngle < -0.1;
}

float segmentDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  vec2 tangent = normalize(end - start);
  vec2 normal = vec2(-tangent.y, tangent.x);
  vec2 startToPoint = point - start;
  return abs(dot(startToPoint, normal)) - width * 0.5;
}

float buttCapDistanceField(vec2 point, vec2 start, vec2 end) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  return dot(startToPoint, -tangent);
}

float squareCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return buttCapDistanceField(point, start, end) - width * 0.5;
}

float roundCapDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  float onSegment = max(0., 1000. * dot(point - start, end - start)); // this is very high when inside the segment
  return length(point - start) - width * 0.5 - onSegment;
}

float roundJoinDistanceField(vec2 point, vec2 start, vec2 end, float width) {
  return roundCapDistanceField(point, start, end, width);
}

float bevelJoinField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  vec2 startToPoint = point - start;
  vec2 tangent = normalize(end - start);
  float c = cos(joinAngle * 0.5);
  float s = sin(joinAngle * 0.5);
  float direction = -sign(sin(joinAngle));
  vec2 bisector = vec2(c * tangent.x - s * tangent.y, s * tangent.x + c * tangent.y);
  float radius = width * 0.5 * s;
  return dot(startToPoint, bisector * direction) - radius;
}

float miterJoinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle) {
  if (cos(joinAngle) > ${Ya}) { // avoid risking a division by zero
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  float miterLength = 1. / sin(joinAngle * 0.5);
  float miterLimit = ${this.strokeMiterLimitExpression_};
  if (miterLength > miterLimit) {
    return bevelJoinField(point, start, end, width, joinAngle);
  }
  return -1000.;
}

float capDistanceField(vec2 point, vec2 start, vec2 end, float width, float capType) {
   if (capType == ${wt("butt")}) {
    return buttCapDistanceField(point, start, end);
  } else if (capType == ${wt("square")}) {
    return squareCapDistanceField(point, start, end, width);
  }
  return roundCapDistanceField(point, start, end, width);
}

float joinDistanceField(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float joinType) {
  if (joinType == ${wt("bevel")}) {
    return bevelJoinField(point, start, end, width, joinAngle);
  } else if (joinType == ${wt("miter")}) {
    return miterJoinDistanceField(point, start, end, width, joinAngle);
  }
  return roundJoinDistanceField(point, start, end, width);
}

float computeSegmentPointDistance(vec2 point, vec2 start, vec2 end, float width, float joinAngle, float capType, float joinType) {
  if (isCap(joinAngle)) {
    return capDistanceField(point, start, end, width, capType);
  }
  return joinDistanceField(point, start, end, width, joinAngle, joinType);
}

void main(void) {
  vec2 currentPoint = gl_FragCoord.xy / u_pixelRatio;
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(currentPoint);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif

  float segmentLength = length(v_segmentEnd - v_segmentStart);
  vec2 segmentTangent = (v_segmentEnd - v_segmentStart) / segmentLength;
  vec2 segmentNormal = vec2(-segmentTangent.y, segmentTangent.x);
  vec2 startToPoint = currentPoint - v_segmentStart;
  float lengthToPoint = max(0., min(dot(segmentTangent, startToPoint), segmentLength));
  float currentLengthPx = lengthToPoint + v_distanceOffsetPx; 
  float currentRadiusPx = abs(dot(segmentNormal, startToPoint));
  float currentRadiusRatio = dot(segmentNormal, startToPoint) * 2. / v_width;
  currentLineMetric = mix(v_measureStart, v_measureEnd, lengthToPoint / segmentLength);

  if (${this.discardExpression_}) { discard; }

  vec4 color = ${this.strokeColorExpression_};
  float capType = ${this.strokeCapExpression_};
  float joinType = ${this.strokeJoinExpression_};
  float segmentStartDistance = computeSegmentPointDistance(currentPoint, v_segmentStart, v_segmentEnd, v_width, v_angleStart, capType, joinType);
  float segmentEndDistance = computeSegmentPointDistance(currentPoint, v_segmentEnd, v_segmentStart, v_width, v_angleEnd, capType, joinType);
  float distance = max(
    segmentDistanceField(currentPoint, v_segmentStart, v_segmentEnd, v_width),
    max(segmentStartDistance, segmentEndDistance)
  );
  distance = max(distance, ${this.strokeDistanceFieldExpression_});
  color.a *= smoothstep(0.5, -0.5, distance);
  gl_FragColor = color;
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}getFillVertexShader(){return this.hasFill_?`${or}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
attribute vec2 a_position;
attribute vec4 a_hitColor;
${this.attributes_.map(function(e){return"attribute "+e+";"}).join(`
`)}
varying vec4 v_hitColor;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.vertexShaderFunctions_.join(`
`)}
void main(void) {
  gl_Position = u_projectionMatrix * vec4(a_position, u_depth, 1.0);
  v_hitColor = a_hitColor;
${this.varyings_.map(function(e){return"  "+e.name+" = "+e.expression+";"}).join(`
`)}
}`:null}getFillFragmentShader(){return this.hasFill_?`${or}
${this.uniforms_.map(function(e){return"uniform "+e+";"}).join(`
`)}
varying vec4 v_hitColor;
${this.varyings_.map(function(e){return"varying "+e.type+" "+e.name+";"}).join(`
`)}
${this.fragmentShaderFunctions_.join(`
`)}
vec2 pxToWorld(vec2 pxPos) {
  vec2 screenPos = 2.0 * pxPos / u_viewportSizePx - 1.0;
  return (u_screenToWorldMatrix * vec4(screenPos, 0.0, 1.0)).xy;
}

vec2 worldToPx(vec2 worldPos) {
  vec4 screenPos = u_projectionMatrix * vec4(worldPos, 0.0, 1.0);
  return (0.5 * screenPos.xy + 0.5) * u_viewportSizePx;
}

void main(void) {
  vec2 pxPos = gl_FragCoord.xy / u_pixelRatio;
  vec2 pxOrigin = worldToPx(u_patternOrigin);
  #ifdef GL_FRAGMENT_PRECISION_HIGH
  vec2 worldPos = pxToWorld(pxPos);
  if (
    abs(u_renderExtent[0] - u_renderExtent[2]) > 0.0 && (
      worldPos[0] < u_renderExtent[0] ||
      worldPos[1] < u_renderExtent[1] ||
      worldPos[0] > u_renderExtent[2] ||
      worldPos[1] > u_renderExtent[3]
    )
  ) {
    discard;
  }
  #endif
  if (${this.discardExpression_}) { discard; }
  gl_FragColor = ${this.fillColorExpression_};
  gl_FragColor.a *= u_globalAlpha;
  gl_FragColor.rgb *= gl_FragColor.a;
  if (u_hitDetection > 0) {
    if (gl_FragColor.a < 0.1) { discard; };
    gl_FragColor = v_hitColor;
  }
}`:null}}const Qe={BLUR:"blur",GRADIENT:"gradient",RADIUS:"radius"},m_=["#00f","#0ff","#0f0","#ff0","#f00"];class __ extends wi{constructor(e){e=e||{};const t=Object.assign({},e);delete t.gradient,delete t.radius,delete t.blur,delete t.weight,super(t),this.gradient_=null,this.addChangeListener(Qe.GRADIENT,this.handleGradientChanged_),this.setGradient(e.gradient?e.gradient:m_),this.setBlur(e.blur!==void 0?e.blur:15),this.setRadius(e.radius!==void 0?e.radius:8);const n=e.weight?e.weight:"weight";this.weightFunction_=typeof n=="string"?i=>i.get(n):n,this.setRenderOrder(null)}getBlur(){return this.get(Qe.BLUR)}getGradient(){return this.get(Qe.GRADIENT)}getRadius(){return this.get(Qe.RADIUS)}handleGradientChanged_(){this.gradient_=y_(this.getGradient())}setBlur(e){this.set(Qe.BLUR,e)}setGradient(e){this.set(Qe.GRADIENT,e)}setRadius(e){this.set(Qe.RADIUS,e)}createRenderer(){const e=new $c().addAttribute("float a_weight").addVarying("v_weight","float","a_weight").addUniform("float u_size").addUniform("float u_blurSlope").setSymbolSizeExpression("vec2(u_size)").setSymbolColorExpression("vec4(smoothstep(0., 1., (1. - length(coordsPx * 2. / v_quadSizePx)) * u_blurSlope) * v_weight)");return new Uc(this,{className:this.getClassName(),attributes:[{name:"weight",callback:t=>{const n=this.weightFunction_(t);return n!==void 0?Ee(n,0,1):1}}],uniforms:{u_size:()=>(this.get(Qe.RADIUS)+this.get(Qe.BLUR))*2,u_blurSlope:()=>this.get(Qe.RADIUS)/Math.max(1,this.get(Qe.BLUR))},hitDetectionEnabled:!0,vertexShader:e.getSymbolVertexShader(),fragmentShader:e.getSymbolFragmentShader(),postProcesses:[{fragmentShader:`
            precision mediump float;

            uniform sampler2D u_image;
            uniform sampler2D u_gradientTexture;
            uniform float u_opacity;

            varying vec2 v_texCoord;

            void main() {
              vec4 color = texture2D(u_image, v_texCoord);
              gl_FragColor.a = color.a * u_opacity;
              gl_FragColor.rgb = texture2D(u_gradientTexture, vec2(0.5, color.a)).rgb;
              gl_FragColor.rgb *= gl_FragColor.a;
            }`,uniforms:{u_gradientTexture:()=>this.gradient_,u_opacity:()=>this.getOpacity()}}]})}renderDeclutter(){}}function y_(r){const n=Gt(1,256),i=n.createLinearGradient(0,0,1,256),s=1/(r.length-1);for(let o=0,a=r.length;o<a;++o)i.addColorStop(o*s,r[o]);return n.fillStyle=i,n.fillRect(0,0,1,256),n.canvas}class x_ extends vh{constructor(e){super(e),this.vectorRenderer_=new Ah(e),this.layerImageRatio_=e.getImageRatio(),this.coordinateToVectorPixelTransform_=Ce(),this.renderedPixelToCoordinateTransform_=null}disposeInternal(){this.vectorRenderer_.dispose(),super.disposeInternal()}getFeatures(e){if(!this.vectorRenderer_)return Promise.resolve([]);const t=Pt(this.coordinateToVectorPixelTransform_,Pt(this.renderedPixelToCoordinateTransform_,e.slice()));return this.vectorRenderer_.getFeatures(t)}handleFontsChanged(){this.vectorRenderer_.handleFontsChanged()}prepareFrame(e){const t=e.pixelRatio,n=e.viewState,i=n.resolution,s=e.viewHints,o=this.vectorRenderer_;let a=e.extent;this.layerImageRatio_!==1&&(a=a.slice(0),sc(a,this.layerImageRatio_));const c=Fe(a)/i,l=at(a)/i;if(!s[Bt.ANIMATING]&&!s[Bt.INTERACTING]&&!Li(a)){o.useContainer(null,null);const u=o.context,h=e.layerStatesArray[e.layerIndex],f=Object.assign({},h,{opacity:1}),d=Object.assign({},e,{extent:a,size:[c,l],viewState:Object.assign({},e.viewState,{rotation:0}),layerStatesArray:[f],layerIndex:0,declutter:null}),p=this.getLayer().getDeclutter();p&&(d.declutter={[p]:new Ph(9)});let g=!0;const m=new ro(a,i,t,u.canvas,function(y){o.prepareFrame(d)&&o.replayGroupChanged&&(o.clipping=!1,o.renderFrame(d,null)&&(o.renderDeclutter(d),o.renderDeferred(d),g=!1),y())});m.addEventListener(ze.CHANGE,()=>{if(m.getState()!==Ht.LOADED)return;this.image=g?null:m;const y=m.getPixelRatio(),_=Lh(m.getResolution())*t/y;this.renderedResolution=_,this.coordinateToVectorPixelTransform_=Ys(this.coordinateToVectorPixelTransform_,c/2,l/2,1/_,-1/_,0,-n.center[0],-n.center[1])}),m.load()}return this.image&&(this.renderedPixelToCoordinateTransform_=e.pixelToCoordinateTransform.slice()),!!this.image}preRender(){}postRender(){}renderDeclutter(){}forEachFeatureAtCoordinate(e,t,n,i,s){return this.vectorRenderer_?this.vectorRenderer_.forEachFeatureAtCoordinate(e,t,n,i,s):super.forEachFeatureAtCoordinate(e,t,n,i,s)}}class E_ extends wi{constructor(e){e=e||{};const t=Object.assign({},e);delete t.imageRatio,super(t),this.imageRatio_=e.imageRatio!==void 0?e.imageRatio:1}getImageRatio(){return this.imageRatio_}createRenderer(){return new x_(this)}}function W(r,e,t){const n=Wl();return d_(e,t,n,r)}function b_(r){const e=en(r),t=e[0]*256,n=e[1],i=e[2]*256,s=Math.round(e[3]*255);return[t+n,i+s]}const T_=`vec4 unpackColor(vec2 packedColor) {
  return vec4(
    fract(floor(packedColor[0] / 256.0) / 256.0),
    fract(packedColor[0] / 256.0),
    fract(floor(packedColor[1] / 256.0) / 256.0),
    fract(packedColor[1] / 256.0)
  );
}`;function bs(r){return r===Xe||r===Pr?2:r===zt?4:1}function Bn(r){const e=bs(r);return e>1?`vec${e}`:"float"}function fi(r){return(JSON.stringify(r).split("").reduce((t,n)=>(t<<5)-t+n.charCodeAt(0),0)>>>0).toString()}function Eo(r,e,t,n){if(`${n}radius`in r&&n!=="icon-"){let i=W(t,r[`${n}radius`],pe);if(`${n}radius2`in r){const s=W(t,r[`${n}radius2`],pe);i=`max(${i}, ${s})`}`${n}stroke-width`in r&&(i=`(${i} + ${W(t,r[`${n}stroke-width`],pe)} * 0.5)`),e.setSymbolSizeExpression(`vec2(${i} * 2. + 0.5)`)}if(`${n}scale`in r){const i=W(t,r[`${n}scale`],Pr);e.setSymbolSizeExpression(`${e.getSymbolSizeExpression()} * ${i}`)}`${n}displacement`in r&&e.setSymbolOffsetExpression(W(t,r[`${n}displacement`],zt)),`${n}rotation`in r&&e.setSymbolRotationExpression(W(t,r[`${n}rotation`],pe)),`${n}rotate-with-view`in r&&e.setSymbolRotateWithView(!!r[`${n}rotate-with-view`])}function Vc(r,e,t,n,i){let s="vec4(0.)";if(e!==null&&(s=e),t!==null&&n!==null){const c=`smoothstep(-${n} + 0.63, -${n} - 0.58, ${r})`;s=`mix(${t}, ${s}, ${c})`}const o=`(1.0 - smoothstep(-0.63, 0.58, ${r}))`;let a=`${s} * vec4(1.0, 1.0, 1.0, ${o})`;return i!==null&&(a=`${a} * vec4(1.0, 1.0, 1.0, ${i})`),a}function bo(r,e,t,n,i){const s=new Image;s.crossOrigin=r[`${n}cross-origin`]===void 0?"anonymous":r[`${n}cross-origin`],Je(typeof r[`${n}src`]=="string",`WebGL layers do not support expressions for the ${n}src style property`),s.src=r[`${n}src`],t[`u_texture${i}_size`]=()=>s.complete?[s.width,s.height]:[0,0],e.addUniform(`vec2 u_texture${i}_size`);const o=`u_texture${i}_size`;return t[`u_texture${i}`]=s,e.addUniform(`sampler2D u_texture${i}`),o}function To(r,e,t,n,i){let s=W(t,r[`${e}offset`],zt);if(`${e}offset-origin`in r)switch(r[`${e}offset-origin`]){case"top-right":s=`vec2(${n}.x, 0.) + ${i} * vec2(-1., 0.) + ${s} * vec2(-1., 1.)`;break;case"bottom-left":s=`vec2(0., ${n}.y) + ${i} * vec2(0., -1.) + ${s} * vec2(1., -1.)`;break;case"bottom-right":s=`${n} - ${i} - ${s}`;break}return s}function w_(r,e,t,n,i){i.functions.circleDistanceField=`float circleDistanceField(vec2 point, float radius) {
  return length(point) - radius;
}`,Eo(r,e,n,"circle-");let s=null;"circle-opacity"in r&&(s=W(i,r["circle-opacity"],pe));let o="coordsPx";"circle-scale"in r&&(o=`coordsPx / ${W(i,r["circle-scale"],Pr)}`);let a=null;"circle-fill-color"in r&&(a=W(i,r["circle-fill-color"],Xe));let c=null;"circle-stroke-color"in r&&(c=W(i,r["circle-stroke-color"],Xe));let l=W(i,r["circle-radius"],pe),u=null;"circle-stroke-width"in r&&(u=W(i,r["circle-stroke-width"],pe),l=`(${l} + ${u} * 0.5)`);const h=`circleDistanceField(${o}, ${l})`,f=Vc(h,a,c,u,s);e.setSymbolColorExpression(f)}function S_(r,e,t,n,i){i.functions.round=`float round(float v) {
  return sign(v) * floor(abs(v) + 0.5);
}`,i.functions.starDistanceField=`float starDistanceField(vec2 point, float numPoints, float radius, float radius2, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round(beta / alpha) * alpha; // angle in sector
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  vec2 tipToPoint = inSector + vec2(-radius, 0.);
  vec2 edgeNormal = vec2(radius2 * sin(alpha * 0.5), -radius2 * cos(alpha * 0.5) + radius);
  return dot(normalize(edgeNormal), tipToPoint);
}`,i.functions.regularDistanceField=`float regularDistanceField(vec2 point, float numPoints, float radius, float angle) {
  float startAngle = -PI * 0.5 + angle; // tip starts upwards and rotates clockwise with angle
  float c = cos(startAngle);
  float s = sin(startAngle);
  vec2 pointRotated = vec2(c * point.x - s * point.y, s * point.x + c * point.y);
  float alpha = TWO_PI / numPoints; // the angle of one sector
  float radiusIn = radius * cos(PI / numPoints);
  float beta = atan(pointRotated.y, pointRotated.x);
  float gamma = round((beta - alpha * 0.5) / alpha) * alpha + alpha * 0.5; // angle in sector from mid
  c = cos(-gamma);
  s = sin(-gamma);
  vec2 inSector = vec2(c * pointRotated.x - s * pointRotated.y, abs(s * pointRotated.x + c * pointRotated.y));
  return inSector.x - radiusIn;
}`,Eo(r,e,n,"shape-");let s=null;"shape-opacity"in r&&(s=W(i,r["shape-opacity"],pe));let o="coordsPx";"shape-scale"in r&&(o=`coordsPx / ${W(i,r["shape-scale"],Pr)}`);let a=null;"shape-fill-color"in r&&(a=W(i,r["shape-fill-color"],Xe));let c=null;"shape-stroke-color"in r&&(c=W(i,r["shape-stroke-color"],Xe));let l=null;"shape-stroke-width"in r&&(l=W(i,r["shape-stroke-width"],pe));const u=W(i,r["shape-points"],pe);let h="0.";"shape-angle"in r&&(h=W(i,r["shape-angle"],pe));let f,d=W(i,r["shape-radius"],pe);if(l!==null&&(d=`${d} + ${l} * 0.5`),"shape-radius2"in r){let g=W(i,r["shape-radius2"],pe);l!==null&&(g=`${g} + ${l} * 0.5`),f=`starDistanceField(${o}, ${u}, ${d}, ${g}, ${h})`}else f=`regularDistanceField(${o}, ${u}, ${d}, ${h})`;const p=Vc(f,a,c,l,s);e.setSymbolColorExpression(p)}function R_(r,e,t,n,i){let s="vec4(1.0)";"icon-color"in r&&(s=W(i,r["icon-color"],Xe)),"icon-opacity"in r&&(s=`${s} * vec4(1.0, 1.0, 1.0, ${W(i,r["icon-opacity"],pe)})`);const o=fi(r["icon-src"]),a=bo(r,e,t,"icon-",o);if(e.setSymbolColorExpression(`${s} * texture2D(u_texture${o}, v_texCoord)`).setSymbolSizeExpression(a),"icon-width"in r&&"icon-height"in r&&e.setSymbolSizeExpression(`vec2(${W(n,r["icon-width"],pe)}, ${W(n,r["icon-height"],pe)})`),"icon-offset"in r&&"icon-size"in r){const c=W(n,r["icon-size"],zt),l=e.getSymbolSizeExpression();e.setSymbolSizeExpression(c);const u=To(r,"icon-",n,"v_quadSizePx",c);e.setTextureCoordinateExpression(`(vec4((${u}).xyxy) + vec4(0., 0., ${c})) / (${l}).xyxy`)}if(Eo(r,e,n,"icon-"),"icon-anchor"in r){const c=W(n,r["icon-anchor"],zt);let l="1.0";"icon-scale"in r&&(l=W(n,r["icon-scale"],Pr));let u;r["icon-anchor-x-units"]==="pixels"&&r["icon-anchor-y-units"]==="pixels"?u=`${c} * ${l}`:r["icon-anchor-x-units"]==="pixels"?u=`${c} * vec2(vec2(${l}).x, v_quadSizePx.y)`:r["icon-anchor-y-units"]==="pixels"?u=`${c} * vec2(v_quadSizePx.x, vec2(${l}).x)`:u=`${c} * v_quadSizePx`;let h=`v_quadSizePx * vec2(0.5, -0.5) + ${u} * vec2(-1., 1.)`;if("icon-anchor-origin"in r)switch(r["icon-anchor-origin"]){case"top-right":h=`v_quadSizePx * -0.5 + ${u}`;break;case"bottom-left":h=`v_quadSizePx * 0.5 - ${u}`;break;case"bottom-right":h=`v_quadSizePx * vec2(-0.5, 0.5) + ${u} * vec2(1., -1.)`;break}e.setSymbolOffsetExpression(`${e.getSymbolOffsetExpression()} + ${h}`)}}function v_(r,e,t,n,i){if("stroke-color"in r&&e.setStrokeColorExpression(W(i,r["stroke-color"],Xe)),"stroke-pattern-src"in r){const s=fi(r["stroke-pattern-src"]),o=bo(r,e,t,"stroke-pattern-",s);let a=o,c="vec2(0.)";"stroke-pattern-offset"in r&&"stroke-pattern-size"in r&&(a=W(i,r["stroke-pattern-size"],zt),c=To(r,"stroke-pattern-",i,o,a));let l="0.";"stroke-pattern-spacing"in r&&(l=W(i,r["stroke-pattern-spacing"],pe)),i.functions.sampleStrokePattern=`vec4 sampleStrokePattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, float spacingPx, float currentLengthPx, float currentRadiusRatio, float lineWidth) {
  float currentLengthScaled = currentLengthPx * sampleSize.y / lineWidth;
  float spacingScaled = spacingPx * sampleSize.y / lineWidth;
  float uCoordPx = mod(currentLengthScaled, (sampleSize.x + spacingScaled));
  // make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  uCoordPx = clamp(uCoordPx, 0.5, sampleSize.x - 0.5);
  float vCoordPx = (-currentRadiusRatio * 0.5 + 0.5) * sampleSize.y;
  vec2 texCoord = (vec2(uCoordPx, vCoordPx) + textureOffset) / textureSize;
  return texture2D(texture, texCoord);
}`;const u=`u_texture${s}`;let h="1.";"stroke-color"in r&&(h=e.getStrokeColorExpression()),e.setStrokeColorExpression(`${h} * sampleStrokePattern(${u}, ${o}, ${c}, ${a}, ${l}, currentLengthPx, currentRadiusRatio, v_width)`)}if("stroke-width"in r&&e.setStrokeWidthExpression(W(n,r["stroke-width"],pe)),"stroke-offset"in r&&e.setStrokeOffsetExpression(W(n,r["stroke-offset"],pe)),"stroke-line-cap"in r&&e.setStrokeCapExpression(W(n,r["stroke-line-cap"],tn)),"stroke-line-join"in r&&e.setStrokeJoinExpression(W(n,r["stroke-line-join"],tn)),"stroke-miter-limit"in r&&e.setStrokeMiterLimitExpression(W(n,r["stroke-miter-limit"],pe)),"stroke-line-dash"in r){i.functions.getSingleDashDistance=`float getSingleDashDistance(float distance, float radius, float dashOffset, float dashLength, float dashLengthTotal, float capType) {
  float localDistance = mod(distance, dashLengthTotal);
  float distanceSegment = abs(localDistance - dashOffset - dashLength * 0.5) - dashLength * 0.5;
  distanceSegment = min(distanceSegment, dashLengthTotal - localDistance);
  if (capType == ${wt("square")}) {
    distanceSegment -= v_width * 0.5;
  } else if (capType == ${wt("round")}) {
    distanceSegment = min(distanceSegment, sqrt(distanceSegment * distanceSegment + radius * radius) - v_width * 0.5);
  }
  return distanceSegment;
}`;let s=r["stroke-line-dash"].map(d=>W(i,d,pe));s.length%2===1&&(s=[...s,...s]);let o="0.";"stroke-line-dash-offset"in r&&(o=W(n,r["stroke-line-dash-offset"],pe));const c=`dashDistanceField_${fi(r["stroke-line-dash"])}`,l=s.map((d,p)=>`float dashLength${p} = ${d};`),u=s.map((d,p)=>`dashLength${p}`).join(" + ");let h="0.",f=`getSingleDashDistance(distance, radius, ${h}, dashLength0, totalDashLength, capType)`;for(let d=2;d<s.length;d+=2)h=`${h} + dashLength${d-2} + dashLength${d-1}`,f=`min(${f}, getSingleDashDistance(distance, radius, ${h}, dashLength${d}, totalDashLength, capType))`;i.functions[c]=`float ${c}(float distance, float radius, float capType) {
  ${l.join(`
  `)}
  float totalDashLength = ${u};
  return ${f};
}`,e.setStrokeDistanceFieldExpression(`${c}(currentLengthPx + ${o}, currentRadiusPx, capType)`)}}function A_(r,e,t,n,i){if("fill-color"in r&&e.setFillColorExpression(W(i,r["fill-color"],Xe)),"fill-pattern-src"in r){const s=fi(r["fill-pattern-src"]),o=bo(r,e,t,"fill-pattern-",s);let a=o,c="vec2(0.)";"fill-pattern-offset"in r&&"fill-pattern-size"in r&&(a=W(i,r["fill-pattern-size"],zt),c=To(r,"fill-pattern-",i,o,a)),i.functions.sampleFillPattern=`vec4 sampleFillPattern(sampler2D texture, vec2 textureSize, vec2 textureOffset, vec2 sampleSize, vec2 pxOrigin, vec2 pxPosition) {
  float scaleRatio = pow(2., mod(u_zoom + 0.5, 1.) - 0.5);
  vec2 pxRelativePos = pxPosition - pxOrigin;
  // rotate the relative position from origin by the current view rotation
  pxRelativePos = vec2(pxRelativePos.x * cos(u_rotation) - pxRelativePos.y * sin(u_rotation), pxRelativePos.x * sin(u_rotation) + pxRelativePos.y * cos(u_rotation));
  // sample position is computed according to the sample offset & size
  vec2 samplePos = mod(pxRelativePos / scaleRatio, sampleSize);
  // also make sure that we're not sampling too close to the borders to avoid interpolation with outside pixels
  samplePos = clamp(samplePos, vec2(0.5), sampleSize - vec2(0.5));
  samplePos.y = sampleSize.y - samplePos.y; // invert y axis so that images appear upright
  return texture2D(texture, (samplePos + textureOffset) / textureSize);
}`;const l=`u_texture${s}`;let u="1.";"fill-color"in r&&(u=e.getFillColorExpression()),e.setFillColorExpression(`${u} * sampleFillPattern(${l}, ${o}, ${c}, ${a}, pxOrigin, pxPos)`)}}function Xc(r,e,t){const n=Es(),i={...Es(),inFragmentShader:!0,variables:n.variables},s=new $c,o={};if("icon-src"in r?R_(r,s,o,n,i):"shape-points"in r?S_(r,s,o,n,i):"circle-radius"in r&&w_(r,s,o,n,i),v_(r,s,o,n,i),A_(r,s,o,n,i),t){const l=W(i,t,zs);s.setFragmentDiscardExpression(`!${l}`)}for(const l in i.variables){const u=i.variables[l],h=yo(u.name);let f=Bn(u.type);u.type===Xe&&(f="vec4"),s.addUniform(`${f} ${h}`),o[h]=()=>{const d=e[u.name];return typeof d=="number"?d:typeof d=="boolean"?d?1:0:u.type===Xe?en(d||"#eee"):typeof d=="string"?mr(d):d}}for(const l in i.properties){const u=i.properties[l];n.properties[l]||(n.properties[l]=u);let h=Bn(u.type),f=`a_prop_${u.name}`;u.type===Xe&&(h="vec4",f=`unpackColor(${f})`,s.addVertexShaderFunction(T_)),s.addVarying(`v_prop_${u.name}`,h,f)}for(const l in n.properties){const u=n.properties[l];s.addAttribute(`${Bn(u.type)} a_prop_${u.name}`)}for(const l in n.functions)s.addVertexShaderFunction(n.functions[l]);for(const l in i.functions)s.addFragmentShaderFunction(i.functions[l]);const a={};for(const l in n.properties){const u=n.properties[l],h=f=>{const d=f.get(u.name);return u.type===Xe?b_([...en(d||"#eee")]):typeof d=="string"?mr(d):typeof d=="boolean"?d?1:0:d};a[`prop_${u.name}`]={size:bs(u.type),callback:h}}function c(l,u,h,f){const d=n[l],p=i[l];if(!d&&!p)return;const g=Bn(h),m=bs(h);s.addAttribute(`${g} a_${u}`),p&&s.addVarying(`v_${u}`,g,`a_${u}`),a[u]={size:m,callback:f}}return c("geometryType",kc,tn,l=>mr(jl(l.getGeometry()))),c("featureId",zc,tn|pe,l=>{const u=l.getId()??null;return typeof u=="string"?mr(u):u}),{builder:s,attributes:a,uniforms:o}}class P_ extends ks{constructor(e){const t=Object.assign({},e);super(t),this.styleVariables_=e.variables||{},this.parseResult_=Xc(e.style,this.styleVariables_,e.filter),this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){const e=Object.keys(this.parseResult_.attributes).map(t=>({name:t,...this.parseResult_.attributes[t]}));return new Uc(this,{vertexShader:this.parseResult_.builder.getSymbolVertexShader(),fragmentShader:this.parseResult_.builder.getSymbolFragmentShader(),hitDetectionEnabled:!this.hitDetectionDisabled_,uniforms:this.parseResult_.uniforms,attributes:e})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}function sl(r,e){const t=`
    attribute vec2 ${jn.TEXTURE_COORD};
    uniform mat4 ${j.TILE_TRANSFORM};
    uniform float ${j.TEXTURE_PIXEL_WIDTH};
    uniform float ${j.TEXTURE_PIXEL_HEIGHT};
    uniform float ${j.TEXTURE_RESOLUTION};
    uniform float ${j.TEXTURE_ORIGIN_X};
    uniform float ${j.TEXTURE_ORIGIN_Y};
    uniform float ${j.DEPTH};

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;

    void main() {
      v_textureCoord = ${jn.TEXTURE_COORD};
      v_mapCoord = vec2(
        ${j.TEXTURE_ORIGIN_X} + ${j.TEXTURE_RESOLUTION} * ${j.TEXTURE_PIXEL_WIDTH} * v_textureCoord[0],
        ${j.TEXTURE_ORIGIN_Y} - ${j.TEXTURE_RESOLUTION} * ${j.TEXTURE_PIXEL_HEIGHT} * v_textureCoord[1]
      );
      gl_Position = ${j.TILE_TRANSFORM} * vec4(${jn.TEXTURE_COORD}, ${j.DEPTH}, 1.0);
    }
  `,n={...Es(),inFragmentShader:!0,bandCount:e},i=[];if(r.color!==void 0){const h=W(n,r.color,Xe);i.push(`color = ${h};`)}if(r.contrast!==void 0){const h=W(n,r.contrast,pe);i.push(`color.rgb = clamp((${h} + 1.0) * color.rgb - (${h} / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.exposure!==void 0){const h=W(n,r.exposure,pe);i.push(`color.rgb = clamp((${h} + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}if(r.saturation!==void 0){const h=W(n,r.saturation,pe);i.push(`
      float saturation = ${h} + 1.0;
      float sr = (1.0 - saturation) * 0.2126;
      float sg = (1.0 - saturation) * 0.7152;
      float sb = (1.0 - saturation) * 0.0722;
      mat3 saturationMatrix = mat3(
        sr + saturation, sr, sr,
        sg, sg + saturation, sg,
        sb, sb, sb + saturation
      );
      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));
    `)}if(r.gamma!==void 0){const h=W(n,r.gamma,pe);i.push(`color.rgb = pow(color.rgb, vec3(1.0 / ${h}));`)}if(r.brightness!==void 0){const h=W(n,r.brightness,pe);i.push(`color.rgb = clamp(color.rgb + ${h}, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));`)}const s={},o=Object.keys(n.variables).length;if(o>1&&!r.variables)throw new Error(`Missing variables in style (expected ${n.variables})`);for(let h=0;h<o;++h){const f=n.variables[Object.keys(n.variables)[h]];if(!(f.name in r.variables))throw new Error(`Missing '${f.name}' in style variables`);const d=yo(f.name);s[d]=function(){let p=r.variables[f.name];return typeof p=="string"&&(p=mr(p)),p!==void 0?p:-9999999}}const a=Object.keys(s).map(function(h){return`uniform float ${h};`}),c=Math.ceil(e/4);a.push(`uniform sampler2D ${j.TILE_TEXTURE_ARRAY}[${c}];`),n.paletteTextures&&a.push(`uniform sampler2D ${Gc}[${n.paletteTextures.length}];`);const l=Object.keys(n.functions).map(function(h){return n.functions[h]}),u=`
    #ifdef GL_FRAGMENT_PRECISION_HIGH
    precision highp float;
    #else
    precision mediump float;
    #endif

    varying vec2 v_textureCoord;
    varying vec2 v_mapCoord;
    uniform vec4 ${j.RENDER_EXTENT};
    uniform float ${j.TRANSITION_ALPHA};
    uniform float ${j.TEXTURE_PIXEL_WIDTH};
    uniform float ${j.TEXTURE_PIXEL_HEIGHT};
    uniform float ${j.RESOLUTION};
    uniform float ${j.ZOOM};

    ${a.join(`
`)}

    ${l.join(`
`)}

    void main() {
      if (
        v_mapCoord[0] < ${j.RENDER_EXTENT}[0] ||
        v_mapCoord[1] < ${j.RENDER_EXTENT}[1] ||
        v_mapCoord[0] > ${j.RENDER_EXTENT}[2] ||
        v_mapCoord[1] > ${j.RENDER_EXTENT}[3]
      ) {
        discard;
      }

      vec4 color = texture2D(${j.TILE_TEXTURE_ARRAY}[0],  v_textureCoord);

      ${i.join(`
`)}

      gl_FragColor = color;
      gl_FragColor.rgb *= gl_FragColor.a;
      gl_FragColor *= ${j.TRANSITION_ALPHA};
    }`;return{vertexShader:t,fragmentShader:u,uniforms:s,paletteTextures:n.paletteTextures}}class di extends Ih{constructor(e){e=e?Object.assign({},e):{};const t=e.style||{};delete e.style,super(e),this.sources_=e.sources,this.renderedSource_=null,this.renderedResolution_=NaN,this.style_=t,this.styleVariables_=this.style_.variables||{},this.handleSourceUpdate_(),this.addChangeListener(fs.SOURCE,this.handleSourceUpdate_)}getSources(e,t){const n=this.getSource();return this.sources_?typeof this.sources_=="function"?this.sources_(e,t):this.sources_:n?[n]:[]}getRenderSource(){return this.renderedSource_||this.getSource()}getSourceState(){const e=this.getRenderSource();return e?e.getState():"undefined"}handleSourceUpdate_(){this.hasRenderer()&&this.getRenderer().clearCache();const e=this.getSource();if(e)if(e.getState()==="loading"){const t=()=>{e.getState()==="ready"&&(e.removeEventListener("change",t),this.setStyle(this.style_))};e.addEventListener("change",t)}else this.setStyle(this.style_)}getSourceBandCount_(){const e=Number.MAX_SAFE_INTEGER,t=this.getSources([-e,-e,e,e],e);return t&&t.length&&"bandCount"in t[0]?t[0].bandCount:4}createRenderer(){const e=sl(this.style_,this.getSourceBandCount_());return new l_(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.getCacheSize(),paletteTextures:e.paletteTextures})}renderSources(e,t){const n=this.getRenderer();let i;for(let s=0,o=t.length;s<o;++s)this.renderedSource_=t[s],n.prepareFrame(e)&&(i=n.renderFrame(e));return i}render(e,t){this.rendered=!0;const n=e.viewState,i=this.getSources(e.extent,n.resolution);let s=!0;for(let a=0,c=i.length;a<c;++a){const l=i[a],u=l.getState();if(u=="loading"){const h=()=>{l.getState()=="ready"&&(l.removeEventListener("change",h),this.changed())};l.addEventListener("change",h)}s=s&&u=="ready"}const o=this.renderSources(e,i);if(this.getRenderer().renderComplete&&s)return this.renderedResolution_=n.resolution,o;if(this.renderedResolution_>.5*n.resolution){const a=this.getSources(e.extent,this.renderedResolution_).filter(c=>!i.includes(c));if(a.length>0)return this.renderSources(e,a)}return o}setStyle(e){if(this.styleVariables_=e.variables||{},this.style_=e,this.hasRenderer()){const t=sl(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()}}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}}di.prototype.dispose;class wo{constructor(){this.globalCounter_=0,this.refToFeature_=new Map,this.uidToRef_=new Map,this.freeGlobalRef_=[],this.polygonBatch={entries:{},geometriesCount:0,verticesCount:0,ringsCount:0},this.pointBatch={entries:{},geometriesCount:0},this.lineStringBatch={entries:{},geometriesCount:0,verticesCount:0}}addFeatures(e,t){for(let n=0;n<e.length;n++)this.addFeature(e[n],t)}addFeature(e,t){let n=e.getGeometry();n&&(t&&(n=n.clone(),n.applyTransform(t)),this.addGeometry_(n,e))}clearFeatureEntryInPointBatch_(e){const t=de(e),n=this.pointBatch.entries[t];if(n)return this.pointBatch.geometriesCount-=n.flatCoordss.length,delete this.pointBatch.entries[t],n}clearFeatureEntryInLineStringBatch_(e){const t=de(e),n=this.lineStringBatch.entries[t];if(n)return this.lineStringBatch.verticesCount-=n.verticesCount,this.lineStringBatch.geometriesCount-=n.flatCoordss.length,delete this.lineStringBatch.entries[t],n}clearFeatureEntryInPolygonBatch_(e){const t=de(e),n=this.polygonBatch.entries[t];if(n)return this.polygonBatch.verticesCount-=n.verticesCount,this.polygonBatch.ringsCount-=n.ringsCount,this.polygonBatch.geometriesCount-=n.flatCoordss.length,delete this.polygonBatch.entries[t],n}addGeometry_(e,t){var i;const n=e.getType();switch(n){case"GeometryCollection":{const s=e.getGeometriesArray();for(const o of s)this.addGeometry_(o,t);break}case"MultiPolygon":{const s=e;this.addCoordinates_(n,s.getFlatCoordinates(),s.getEndss(),t,de(t),s.getStride());break}case"MultiLineString":{const s=e;this.addCoordinates_(n,s.getFlatCoordinates(),s.getEnds(),t,de(t),s.getStride());break}case"MultiPoint":{const s=e;this.addCoordinates_(n,s.getFlatCoordinates(),null,t,de(t),s.getStride());break}case"Polygon":{const s=e;this.addCoordinates_(n,s.getFlatCoordinates(),s.getEnds(),t,de(t),s.getStride());break}case"Point":{const s=e;this.addCoordinates_(n,s.getFlatCoordinates(),null,t,de(t),s.getStride());break}case"LineString":case"LinearRing":{const s=e,o=s.getStride();this.addCoordinates_(n,s.getFlatCoordinates(),null,t,de(t),o,(i=s.getLayout)==null?void 0:i.call(s));break}}}addCoordinates_(e,t,n,i,s,o,a){let c;switch(e){case"MultiPolygon":{const l=n;for(let u=0,h=l.length;u<h;u++){let f=l[u];const d=u>0?l[u-1]:null,p=d?d[d.length-1]:0,g=f[f.length-1];f=p>0?f.map(m=>m-p):f,this.addCoordinates_("Polygon",t.slice(p,g),f,i,s,o,a)}break}case"MultiLineString":{const l=n;for(let u=0,h=l.length;u<h;u++){const f=u>0?l[u-1]:0;this.addCoordinates_("LineString",t.slice(f,l[u]),null,i,s,o,a)}break}case"MultiPoint":for(let l=0,u=t.length;l<u;l+=o)this.addCoordinates_("Point",t.slice(l,l+2),null,i,s,null,null);break;case"Polygon":{const l=n;if(i instanceof pf){const f=gf(t,l);if(f.length>1){this.addCoordinates_("MultiPolygon",t,f,i,s,o,a);return}}this.polygonBatch.entries[s]||(this.polygonBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[],verticesCount:0,ringsCount:0,ringsVerticesCounts:[]})),c=t.length/o;const u=n.length,h=n.map((f,d,p)=>d>0?(f-p[d-1])/o:f/o);this.polygonBatch.verticesCount+=c,this.polygonBatch.ringsCount+=u,this.polygonBatch.geometriesCount++,this.polygonBatch.entries[s].flatCoordss.push(L_(t,o)),this.polygonBatch.entries[s].ringsVerticesCounts.push(h),this.polygonBatch.entries[s].verticesCount+=c,this.polygonBatch.entries[s].ringsCount+=u;for(let f=0,d=l.length;f<d;f++){const p=f>0?l[f-1]:0;this.addCoordinates_("LinearRing",t.slice(p,l[f]),null,i,s,o,a)}break}case"Point":this.pointBatch.entries[s]||(this.pointBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[]})),this.pointBatch.geometriesCount++,this.pointBatch.entries[s].flatCoordss.push(t);break;case"LineString":case"LinearRing":this.lineStringBatch.entries[s]||(this.lineStringBatch.entries[s]=this.addRefToEntry_(s,{feature:i,flatCoordss:[],verticesCount:0})),c=t.length/o,this.lineStringBatch.verticesCount+=c,this.lineStringBatch.geometriesCount++,this.lineStringBatch.entries[s].flatCoordss.push(I_(t,o,a)),this.lineStringBatch.entries[s].verticesCount+=c;break}}addRefToEntry_(e,t){const n=this.uidToRef_.get(e),i=n||this.freeGlobalRef_.pop()||++this.globalCounter_;return t.ref=i,n||(this.refToFeature_.set(i,t.feature),this.uidToRef_.set(e,i)),t}returnRef_(e,t){if(!e)throw new Error("This feature has no ref: "+t);this.refToFeature_.delete(e),this.uidToRef_.delete(t),this.freeGlobalRef_.push(e)}changeFeature(e){this.removeFeature(e);const t=e.getGeometry();t&&this.addGeometry_(t,e)}removeFeature(e){let t=this.clearFeatureEntryInPointBatch_(e);t=this.clearFeatureEntryInPolygonBatch_(e)||t,t=this.clearFeatureEntryInLineStringBatch_(e)||t,t&&this.returnRef_(t.ref,de(t.feature))}clear(){this.polygonBatch.entries={},this.polygonBatch.geometriesCount=0,this.polygonBatch.verticesCount=0,this.polygonBatch.ringsCount=0,this.lineStringBatch.entries={},this.lineStringBatch.geometriesCount=0,this.lineStringBatch.verticesCount=0,this.pointBatch.entries={},this.pointBatch.geometriesCount=0,this.globalCounter_=0,this.freeGlobalRef_=[],this.refToFeature_.clear(),this.uidToRef_.clear()}getFeatureFromRef(e){return this.refToFeature_.get(e)}isEmpty(){return this.globalCounter_===0}filter(e){const t=new wo;for(const n of this.refToFeature_.values())e(n)&&t.addFeature(n);return t}}function L_(r,e){return e===2?r:r.filter((t,n)=>n%e<2)}function I_(r,e,t){return e===3&&t==="XYM"?r:e===4?r.filter((n,i)=>i%e!==2):e===3?r.map((n,i)=>i%e!==2?n:0):new Array(r.length*1.5).fill(0).map((n,i)=>i%3===2?0:r[Math.round(i/1.5)])}function So(r,e,t,n){let i=0;for(const s in e){const o=e[s],a=o.callback.call(t,t.feature);r[n+i++]=(a==null?void 0:a[0])??a,!(!o.size||o.size===1)&&(r[n+i++]=a[1],!(o.size<3)&&(r[n+i++]=a[2],!(o.size<4)&&(r[n+i++]=a[3])))}return i}function Ni(r){return Object.keys(r).reduce((e,t)=>e+(r[t].size||1),0)}function C_(r,e,t,n){const i=(2+Ni(t))*r.geometriesCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in r.entries){const c=r.entries[a];for(let l=0,u=c.flatCoordss.length;l<u;l++)s[0]=c.flatCoordss[l][0],s[1]=c.flatCoordss[l][1],Pt(n,s),e[o++]=s[0],e[o++]=s[1],o+=So(e,t,c,o)}return e}function F_(r,e,t,n){const i=3*r.verticesCount+(1+Ni(t))*r.geometriesCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in r.entries){const c=r.entries[a];for(let l=0,u=c.flatCoordss.length;l<u;l++){s.length=c.flatCoordss[l].length,rc(c.flatCoordss[l],0,s.length,3,n,s,3),o+=So(e,t,c,o),e[o++]=s.length/3;for(let h=0,f=s.length;h<f;h+=3)e[o++]=s[h],e[o++]=s[h+1],e[o++]=s[h+2]}}return e}function O_(r,e,t,n){const i=2*r.verticesCount+(1+Ni(t))*r.geometriesCount+r.ringsCount;(!e||e.length!==i)&&(e=new Float32Array(i));const s=[];let o=0;for(const a in r.entries){const c=r.entries[a];for(let l=0,u=c.flatCoordss.length;l<u;l++){s.length=c.flatCoordss[l].length,rc(c.flatCoordss[l],0,s.length,2,n,s),o+=So(e,t,c,o),e[o++]=c.ringsVerticesCounts[l].length;for(let h=0,f=c.ringsVerticesCounts[l].length;h<f;h++)e[o++]=c.ringsVerticesCounts[l][h];for(let h=0,f=s.length;h<f;h+=2)e[o++]=s[h],e[o++]=s[h+1]}}return e}const M_=[];let Hi;function N_(){return Hi||(Hi=Nc()),Hi}let D_=0;const ht={POSITION:"a_position",INDEX:"a_index",SEGMENT_START:"a_segmentStart",SEGMENT_END:"a_segmentEnd",MEASURE_START:"a_measureStart",MEASURE_END:"a_measureEnd",PARAMETERS:"a_parameters",JOIN_ANGLES:"a_joinAngles",DISTANCE:"a_distance"};class U_{constructor(e,t,n,i,s){this.helper_,this.hitDetectionEnabled_=!!i;let o=e;if(!("builder"in e)){const u=e,h=Xc(u.style,t,u.filter);o={builder:h.builder,attributes:h.attributes,uniforms:h.uniforms}}this.fillProgram_,this.strokeProgram_,this.symbolProgram_,this.hasFill_=!!o.builder.getFillVertexShader(),this.hasFill_&&(this.fillVertexShader_=o.builder.getFillVertexShader(),this.fillFragmentShader_=o.builder.getFillFragmentShader()),this.hasStroke_=!!o.builder.getStrokeVertexShader(),this.hasStroke_&&(this.strokeVertexShader_=o.builder.getStrokeVertexShader(),this.strokeFragmentShader_=o.builder.getStrokeFragmentShader()),this.hasSymbol_=!!o.builder.getSymbolVertexShader(),this.hasSymbol_&&(this.symbolVertexShader_=o.builder.getSymbolVertexShader(),this.symbolFragmentShader_=o.builder.getSymbolFragmentShader()),this.featureFilter_=null,s&&(this.featureFilter_=this.computeFeatureFilter(s));const c=this.hitDetectionEnabled_?{hitColor:{callback(){return Ic(this.ref,M_)},size:4}}:{};this.customAttributes_=Object.assign({},c,o.attributes),this.uniforms_=o.uniforms;const l=Object.entries(this.customAttributes_).map(([u,h])=>({name:`a_${u}`,size:h.size||1,type:Se.FLOAT}));this.polygonAttributesDesc_=[{name:ht.POSITION,size:2,type:Se.FLOAT},...l],this.lineStringAttributesDesc_=[{name:ht.SEGMENT_START,size:2,type:Se.FLOAT},{name:ht.MEASURE_START,size:1,type:Se.FLOAT},{name:ht.SEGMENT_END,size:2,type:Se.FLOAT},{name:ht.MEASURE_END,size:1,type:Se.FLOAT},{name:ht.JOIN_ANGLES,size:2,type:Se.FLOAT},{name:ht.DISTANCE,size:1,type:Se.FLOAT},{name:ht.PARAMETERS,size:1,type:Se.FLOAT},...l],this.pointAttributesDesc_=[{name:ht.POSITION,size:2,type:Se.FLOAT},{name:ht.INDEX,size:1,type:Se.FLOAT},...l],this.setHelper(n)}computeFeatureFilter(e){const t=Wl();let n;try{n=Ch(e,zs,t)}catch{return null}if(t.mapState||t.variables.size>0)return null;const i=Fh();return s=>{if(i.properties=s.getPropertiesInternal(),t.featureId){const o=s.getId();o!==void 0?i.featureId=o:i.featureId=null}return i.geometryType=jl(s.getGeometry()),n(i)}}async generateBuffers(e,t){let n=e;if(this.featureFilter_&&(n=n.filter(this.featureFilter_),n.isEmpty()))return null;const i=this.generateRenderInstructions_(n,t),[s,o,a]=await Promise.all([this.generateBuffersForType_(i.polygonInstructions,"Polygon",t),this.generateBuffersForType_(i.lineStringInstructions,"LineString",t),this.generateBuffersForType_(i.pointInstructions,"Point",t)]),c=on(Ce(),t);return{polygonBuffers:s,lineStringBuffers:o,pointBuffers:a,invertVerticesTransform:c}}generateRenderInstructions_(e,t){const n=this.hasFill_?O_(e.polygonBatch,new Float32Array(0),this.customAttributes_,t):null,i=this.hasStroke_?F_(e.lineStringBatch,new Float32Array(0),this.customAttributes_,t):null,s=this.hasSymbol_?C_(e.pointBatch,new Float32Array(0),this.customAttributes_,t):null;return{polygonInstructions:n,lineStringInstructions:i,pointInstructions:s}}generateBuffersForType_(e,t,n){if(e===null)return null;const i=D_++;let s;switch(t){case"Polygon":s=Zr.GENERATE_POLYGON_BUFFERS;break;case"LineString":s=Zr.GENERATE_LINE_STRING_BUFFERS;break;case"Point":s=Zr.GENERATE_POINT_BUFFERS;break}const o={id:i,type:s,renderInstructions:e.buffer,renderInstructionsTransform:n,customAttributesSize:Ni(this.customAttributes_)},a=N_();return a.postMessage(o,[e.buffer]),e=null,new Promise(c=>{const l=u=>{const h=u.data;if(h.id!==i||(a.removeEventListener("message",l),!this.helper_.getGL()))return;const f=new wr(xn,ci).fromArrayBuffer(h.vertexBuffer),d=new wr(En,ci).fromArrayBuffer(h.indexBuffer);this.helper_.flushBufferData(f),this.helper_.flushBufferData(d),c([d,f])};a.addEventListener("message",l)})}render(e,t,n){this.hasFill_&&this.renderInternal_(e.polygonBuffers[0],e.polygonBuffers[1],this.fillProgram_,this.polygonAttributesDesc_,t,n),this.hasStroke_&&this.renderInternal_(e.lineStringBuffers[0],e.lineStringBuffers[1],this.strokeProgram_,this.lineStringAttributesDesc_,t,n),this.hasSymbol_&&this.renderInternal_(e.pointBuffers[0],e.pointBuffers[1],this.symbolProgram_,this.pointAttributesDesc_,t,n)}renderInternal_(e,t,n,i,s,o){const a=e.getSize();a!==0&&(this.helper_.useProgram(n,s),this.helper_.bindBuffer(t),this.helper_.bindBuffer(e),this.helper_.enableAttributes(i),o(),this.helper_.drawElements(0,a))}setHelper(e,t=null){this.helper_=e,this.hasFill_&&(this.fillProgram_=this.helper_.getProgram(this.fillFragmentShader_,this.fillVertexShader_)),this.hasStroke_&&(this.strokeProgram_=this.helper_.getProgram(this.strokeFragmentShader_,this.strokeVertexShader_)),this.hasSymbol_&&(this.symbolProgram_=this.helper_.getProgram(this.symbolFragmentShader_,this.symbolVertexShader_)),this.helper_.addUniforms(this.uniforms_),t&&(t.polygonBuffers&&(this.helper_.flushBufferData(t.polygonBuffers[0]),this.helper_.flushBufferData(t.polygonBuffers[1])),t.lineStringBuffers&&(this.helper_.flushBufferData(t.lineStringBuffers[0]),this.helper_.flushBufferData(t.lineStringBuffers[1])),t.pointBuffers&&(this.helper_.flushBufferData(t.pointBuffers[0]),this.helper_.flushBufferData(t.pointBuffers[1])))}}const lr={...gt,RENDER_EXTENT:"u_renderExtent",PATTERN_ORIGIN:"u_patternOrigin",GLOBAL_ALPHA:"u_globalAlpha"};class B_ extends bn{constructor(e,t){const n={[lr.RENDER_EXTENT]:[0,0,0,0],[lr.PATTERN_ORIGIN]:[0,0],[lr.GLOBAL_ALPHA]:1};super(e,{uniforms:n,postProcesses:t.postProcesses}),this.hitDetectionEnabled_=!t.disableHitDetection,this.hitRenderTarget_,this.sourceRevision_=-1,this.previousExtent_=mn(),this.currentTransform_=Ce(),this.tmpCoords_=[0,0],this.tmpTransform_=Ce(),this.tmpMat4_=rr(),this.currentFrameStateTransform_=Ce(),this.styleVariables_={},this.styles_=[],this.styleRenderers_=[],this.buffers_=[],this.applyOptions_(t),this.batch_=new wo,this.initialFeaturesAdded_=!1,this.sourceListenKeys_=null}addInitialFeatures_(e){const t=this.getLayer().getSource();let n;this.batch_.addFeatures(t.getFeatures(),n),this.sourceListenKeys_=[St(t,Nt.ADDFEATURE,this.handleSourceFeatureAdded_.bind(this,n)),St(t,Nt.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),St(t,Nt.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),St(t,Nt.CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(e){this.styleVariables_=e.variables,this.styles_=Gm(e.style)}createRenderers_(){this.buffers_=[],this.styleRenderers_=this.styles_.map(e=>new U_(e,this.styleVariables_,this.helper,this.hitDetectionEnabled_,"filter"in e?e.filter:null))}reset(e){this.applyOptions_(e),this.helper&&this.createRenderers_(),super.reset(e)}afterHelperCreated(){this.styleRenderers_.length?this.styleRenderers_.forEach((e,t)=>e.setHelper(this.helper,this.buffers_[t])):this.createRenderers_(),this.hitDetectionEnabled_&&(this.hitRenderTarget_=new Mc(this.helper))}handleSourceFeatureAdded_(e,t){const n=t.feature;this.batch_.addFeature(n,e)}handleSourceFeatureChanged_(e){const t=e.feature;this.batch_.changeFeature(t)}handleSourceFeatureDelete_(e){const t=e.feature;this.batch_.removeFeature(t)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(e){mf(this.tmpTransform_,this.currentFrameStateTransform_),nn(this.tmpTransform_,e),this.helper.setUniformMatrixValue(lr.PROJECTION_MATRIX,ui(this.tmpMat4_,this.tmpTransform_)),on(this.tmpTransform_,this.tmpTransform_),this.helper.setUniformMatrixValue(lr.SCREEN_TO_WORLD_MATRIX,ui(this.tmpMat4_,this.tmpTransform_)),this.tmpCoords_[0]=0,this.tmpCoords_[1]=0,on(this.tmpTransform_,e),Pt(this.tmpTransform_,this.tmpCoords_),this.helper.setUniformFloatVec2(lr.PATTERN_ORIGIN,this.tmpCoords_)}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const[n,i,s]=Dc(e,this.getLayer());this.helper.prepareDraw(e),this.renderWorlds(e,!1,n,i,s),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);const o=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderWorlds(e,!0,n,i,s),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),o}prepareFrameInternal(e){this.initialFeaturesAdded_||(this.addInitialFeatures_(e),this.initialFeaturesAdded_=!0);const t=this.getLayer(),n=t.getSource(),i=e.viewState,s=!e.viewHints[Bt.ANIMATING]&&!e.viewHints[Bt.INTERACTING],o=!ln(this.previousExtent_,e.extent),a=this.sourceRevision_<n.getRevision();if(a&&(this.sourceRevision_=n.getRevision()),s&&(o||a)){const c=i.projection,l=i.resolution,u=t instanceof wi?t.getRenderBuffer():0,h=eo(e.extent,u*l);n.loadFeatures(h,l,c),this.ready=!1;const f=this.helper.makeProjectionTransform(e,Ce()),d=this.styleRenderers_.map((p,g)=>p.generateBuffers(this.batch_,f).then(m=>{this.buffers_[g]&&this.disposeBuffers(this.buffers_[g]),this.buffers_[g]=m}));Promise.all(d).then(()=>{this.ready=!0,this.getLayer().changed()}),this.previousExtent_=e.extent.slice()}return!0}renderWorlds(e,t,n,i,s){let o=n;t&&(this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0));do{this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_),qs(this.currentFrameStateTransform_,o*s,0);for(let a=0,c=this.styleRenderers_.length;a<c;a++){const l=this.styleRenderers_[a],u=this.buffers_[a];u&&l.render(u,e,()=>{this.applyUniforms_(u.invertVerticesTransform),this.helper.applyHitDetectionUniform(t)})}}while(++o<i)}forEachFeatureAtCoordinate(e,t,n,i,s){if(Je(this.hitDetectionEnabled_,"`forEachFeatureAtCoordinate` cannot be used on a WebGL layer if the hit detection logic has been disabled using the `disableHitDetection: true` option."),!this.styleRenderers_.length||!this.hitDetectionEnabled_)return;const o=Pt(t.coordinateToPixelTransform,e.slice()),a=this.hitRenderTarget_.readPixel(o[0]/2,o[1]/2),c=[a[0]/255,a[1]/255,a[2]/255,a[3]/255],l=Cc(c),u=this.batch_.getFeatureFromRef(l);if(u)return i(u,this.getLayer(),null)}disposeBuffers(e){const t=n=>{for(const i of n)i&&this.helper.deleteBuffer(i)};e.pointBuffers&&t(e.pointBuffers),e.lineStringBuffers&&t(e.lineStringBuffers),e.polygonBuffers&&t(e.polygonBuffers)}disposeInternal(){this.buffers_.forEach(e=>{e&&this.disposeBuffers(e)}),this.sourceListenKeys_&&(this.sourceListenKeys_.forEach(function(e){oi(e)}),this.sourceListenKeys_=null),super.disposeInternal()}}class G_ extends ks{constructor(e){const t=Object.assign({},e);super(t),this.styleVariables_=e.variables||{},this.style_=e.style,this.hitDetectionDisabled_=!!e.disableHitDetection}createRenderer(){return new B_(this,{style:this.style_,variables:this.styleVariables_,disableHitDetection:this.hitDetectionDisabled_})}updateStyleVariables(e){Object.assign(this.styleVariables_,e),this.changed()}setStyle(e){this.style=e,this.clearRenderer(),this.changed()}}const z_=Object.freeze(Object.defineProperty({__proto__:null,Graticule:od,Group:lc,Heatmap:__,Image:$s,Layer:ks,Tile:ti,Vector:Ds,VectorImage:E_,VectorTile:Hl,WebGLPoints:P_,WebGLTile:di,WebGLVector:G_},Symbol.toStringTag,{value:"Module"}));function k_(r){const e=r[0],t=new Array(e);let n=1<<e-1,i,s;for(i=0;i<e;++i)s=48,r[1]&n&&(s+=1),r[2]&n&&(s+=2),t[i]=String.fromCharCode(s),n>>=1;return t.join("")}const $_='<a class="ol-attribution-bing-tos" href="https://www.microsoft.com/maps/product/terms.html" target="_blank">Terms of Use</a>';class V_ extends Ct{constructor(e){const t=e.hidpi!==void 0?e.hidpi:!1;super({cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,projection:ae("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.hidpi_=t,this.culture_=e.culture!==void 0?e.culture:"en-us",this.maxZoom_=e.maxZoom!==void 0?e.maxZoom:-1,this.apiKey_=e.key,this.imagerySet_=e.imagerySet,this.placeholderTiles_=e.placeholderTiles;const n="https://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.imagerySet_+"?uriScheme=https&include=ImageryProviders&key="+this.apiKey_+"&c="+this.culture_;fetch(n).then(i=>i.json()).then(i=>this.handleImageryMetadataResponse(i))}getApiKey(){return this.apiKey_}getImagerySet(){return this.imagerySet_}handleImageryMetadataResponse(e){if(e.statusCode!=200||e.statusDescription!="OK"||e.authenticationResultCode!="ValidCredentials"||e.resourceSets.length!=1||e.resourceSets[0].resources.length!=1){this.setState("error");return}const t=e.resourceSets[0].resources[0],n=this.maxZoom_==-1?t.zoomMax:this.maxZoom_,i=this.getProjection(),s=dn(i),o=this.hidpi_?2:1,a=t.imageWidth==t.imageHeight?t.imageWidth/o:[t.imageWidth/o,t.imageHeight/o],c=pn({extent:s,minZoom:t.zoomMin,maxZoom:n,tileSize:a});this.tileGrid=c;const l=this.culture_,u=this.hidpi_,h=this.placeholderTiles_;if(this.tileUrlFunction=Vs(t.imageUrlSubdomains.map(function(f){const d=[0,0,0],p=t.imageUrl.replace("{subdomain}",f).replace("{culture}",l);return function(g,m,y){if(!g)return;as(g[0],g[1],g[2],d);const _=new URL(p.replace("{quadkey}",k_(d))),E=_.searchParams;return u&&(E.set("dpi","d1"),E.set("device","mobile")),h===!0?E.delete("n"):h===!1&&E.set("n","z"),_.toString()}})),t.imageryProviders){const f=Ks(ae("EPSG:4326"),this.getProjection());this.setAttributions(d=>{const p=[],g=d.viewState,m=this.getTileGrid(),y=m.getZForResolution(g.resolution,this.zDirection),E=m.getTileCoordForCoordAndZ(g.center,y)[0];return t.imageryProviders.map(function(S){let R=!1;const w=S.coverageAreas;for(let A=0,C=w.length;A<C;++A){const P=w[A];if(E>=P.zoomMin&&E<=P.zoomMax){const v=P.bbox,U=[v[1],v[0],v[3],v[2]],M=Tr(U,f);if(br(M,d.extent)){R=!0;break}}}R&&p.push(S.attribution)}),p.push($_),p})}this.setState("ready")}}class X_ extends rn{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,maxZoom:e.maxZoom!==void 0?e.maxZoom:18,minZoom:e.minZoom,projection:e.projection,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection}),this.account_=e.account,this.mapId_=e.map||"",this.config_=e.config||{},this.templateCache_={},this.initializeMap_()}getConfig(){return this.config_}updateConfig(e){Object.assign(this.config_,e),this.initializeMap_()}setConfig(e){this.config_=e||{},this.initializeMap_()}initializeMap_(){const e=JSON.stringify(this.config_);if(this.templateCache_[e]){this.applyTemplate_(this.templateCache_[e]);return}let t="https://"+this.account_+".carto.com/api/v1/map";this.mapId_&&(t+="/named/"+this.mapId_);const n=new XMLHttpRequest;n.addEventListener("load",this.handleInitResponse_.bind(this,e)),n.addEventListener("error",this.handleInitError_.bind(this)),n.open("POST",t),n.setRequestHeader("Content-type","application/json"),n.send(JSON.stringify(this.config_))}handleInitResponse_(e,t){const n=t.target;if(!n.status||n.status>=200&&n.status<300){let i;try{i=JSON.parse(n.responseText)}catch{this.setState("error");return}this.applyTemplate_(i),this.templateCache_[e]=i,this.setState("ready")}else this.setState("error")}handleInitError_(e){this.setState("error")}applyTemplate_(e){const t="https://"+e.cdn_url.https+"/"+this.account_+"/api/v1/map/"+e.layergroupid+"/{z}/{x}/{y}.png";this.setUrl(t)}}class W_ extends fn{constructor(e){e=e||{},super({attributions:e.attributions,wrapX:e.wrapX}),this.resolution=void 0,this.distance=e.distance!==void 0?e.distance:20,this.minDistance=e.minDistance||0,this.interpolationRatio=0,this.features=[],this.geometryFunction=e.geometryFunction||function(t){const n=t.getGeometry();return Je(!n||n.getType()==="Point","The default `geometryFunction` can only handle `Point` or null geometries"),n},this.createCustomCluster_=e.createCluster,this.source=null,this.boundRefresh_=this.refresh.bind(this),this.updateDistance(this.distance,this.minDistance),this.setSource(e.source||null)}clear(e){this.features.length=0,super.clear(e)}getDistance(){return this.distance}getSource(){return this.source}loadFeatures(e,t,n){var i;(i=this.source)==null||i.loadFeatures(e,t,n),t!==this.resolution&&(this.resolution=t,this.refresh())}setDistance(e){this.updateDistance(e,this.minDistance)}setMinDistance(e){this.updateDistance(this.distance,e)}getMinDistance(){return this.minDistance}setSource(e){this.source&&this.source.removeEventListener(ze.CHANGE,this.boundRefresh_),this.source=e,e&&e.addEventListener(ze.CHANGE,this.boundRefresh_),this.refresh()}refresh(){this.clear(),this.cluster(),this.addFeatures(this.features)}updateDistance(e,t){const n=e===0?0:Math.min(t,e)/e,i=e!==this.distance||this.interpolationRatio!==n;this.distance=e,this.minDistance=t,this.interpolationRatio=n,i&&this.refresh()}cluster(){if(this.resolution===void 0||!this.source)return;const e=mn(),t=this.distance*this.resolution,n=this.source.getFeatures(),i={};for(let s=0,o=n.length;s<o;s++){const a=n[s];if(!(de(a)in i)){const c=this.geometryFunction(a);if(c){const l=c.getCoordinates();Cf(l,e),eo(e,t,e);const u=this.source.getFeaturesInExtent(e).filter(function(h){const f=de(h);return f in i?!1:(i[f]=!0,!0)});this.features.push(this.createCluster(u,e))}}}}createCluster(e,t){const n=[0,0];for(let a=e.length-1;a>=0;--a){const c=this.geometryFunction(e[a]);c?_f(n,c.getCoordinates()):e.splice(a,1)}yf(n,1/e.length);const i=Ut(t),s=this.interpolationRatio,o=new xt([n[0]*(1-s)+i[0]*s,n[1]*(1-s)+i[1]*s]);return this.createCustomCluster_?this.createCustomCluster_(o,e):new ct({geometry:o,features:e})}}const j_=`
  attribute vec4 a_position;
  attribute vec4 a_texcoord;

  uniform mat4 u_matrix;
  uniform mat4 u_textureMatrix;

  varying vec2 v_texcoord;

  void main() {
    gl_Position = u_matrix * a_position;
    vec2 texcoord = (u_textureMatrix * a_texcoord).xy;
    v_texcoord = texcoord;
  }
`,H_=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (
      v_texcoord.x < 0.0 ||
      v_texcoord.y < 0.0 ||
      v_texcoord.x > 1.0 ||
      v_texcoord.y > 1.0
    ) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;class Z_{constructor(e){this.gl_=e,this.program_=Ts(e,H_,j_),this.positionLocation=e.getAttribLocation(this.program_,"a_position"),this.texcoordLocation=e.getAttribLocation(this.program_,"a_texcoord"),this.matrixLocation=e.getUniformLocation(this.program_,"u_matrix"),this.textureMatrixLocation=e.getUniformLocation(this.program_,"u_textureMatrix"),this.textureLocation=e.getUniformLocation(this.program_,"u_texture"),this.positionBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.positionBuffer),this.positions=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.positions),e.STATIC_DRAW),this.texcoordBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.texcoordBuffer),this.texcoords=[0,0,0,1,1,0,1,0,0,1,1,1],e.bufferData(e.ARRAY_BUFFER,new Float32Array(this.texcoords),e.STATIC_DRAW)}drawImage(e,t,n,i,s,o,a,c,l,u,h,f,d){const p=this.gl_;c===void 0&&(c=i),l===void 0&&(l=s),o===void 0&&(o=t),a===void 0&&(a=n),u===void 0&&(u=o),h===void 0&&(h=a),f===void 0&&(f=p.canvas.width),d===void 0&&(d=p.canvas.height),p.bindTexture(p.TEXTURE_2D,e),p.useProgram(this.program_),p.bindBuffer(p.ARRAY_BUFFER,this.positionBuffer),p.enableVertexAttribArray(this.positionLocation),p.vertexAttribPointer(this.positionLocation,2,p.FLOAT,!1,0,0),p.bindBuffer(p.ARRAY_BUFFER,this.texcoordBuffer),p.enableVertexAttribArray(this.texcoordLocation),p.vertexAttribPointer(this.texcoordLocation,2,p.FLOAT,!1,0,0);let g=ys(0,f,0,d,-1,1);g=Wm(g,c,l,0),g=Ka(g,u,h,1),p.uniformMatrix4fv(this.matrixLocation,!1,g);let m=jm(i/t,s/n,0);m=Ka(m,o/t,a/n,1),p.uniformMatrix4fv(this.textureMatrixLocation,!1,m),p.uniform1i(this.textureLocation,0),p.drawArrays(p.TRIANGLES,0,this.positions.length/2)}}function ol(r,e,t){const n=r.createShader(e);if(n===null)throw new Error("Shader compilation failed");if(r.shaderSource(n,t),r.compileShader(n),!r.getShaderParameter(n,r.COMPILE_STATUS)){const i=r.getShaderInfoLog(n);throw i===null?new Error("Shader info log creation failed"):new Error(i)}return n}function Ts(r,e,t){const n=r.createProgram(),i=ol(r,r.VERTEX_SHADER,t),s=ol(r,r.FRAGMENT_SHADER,e);if(n===null)throw new Error("Program creation failed");if(r.attachShader(n,i),r.attachShader(n,s),r.linkProgram(n),!r.getProgramParameter(n,r.LINK_STATUS))throw r.getProgramInfoLog(n)===null?new Error("Program info log creation failed"):new Error;return n}const Y_=`
  attribute vec4 a_position;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
  }
`,q_=`
  precision mediump float;

  uniform vec4 u_val;
  void main() {
     gl_FragColor = u_val;
  }
`,K_=`
  attribute vec4 a_position;
  attribute vec2 a_texcoord;

  varying vec2 v_texcoord;

  uniform mat4 u_matrix;

  void main() {
     gl_Position = u_matrix * a_position;
     v_texcoord = a_texcoord;
  }
`,J_=`
  precision mediump float;

  varying vec2 v_texcoord;

  uniform sampler2D u_texture;

  void main() {
    if (v_texcoord.x < 0.0 || v_texcoord.x > 1.0 || v_texcoord.y < 0.0 || v_texcoord.y > 1.0) {
      discard;
    }
    gl_FragColor = texture2D(u_texture, v_texcoord);
  }
`;function Q_(r,e,t,n){let i;return t&&t.length?i=t.shift():Oh?i=new OffscreenCanvas(r||300,e||300):i=document.createElement("canvas"),r&&(i.width=r),e&&(i.height=e),i.getContext("webgl",n)}function ey(r){const e=r.canvas;e.width=1,e.height=1,r.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT|r.STENCIL_BUFFER_BIT)}const al=[];function ty(r,e,t,n,i,s,o,a,c,l,u,h,f,d){const p=Math.round(n*e),g=Math.round(n*t);r.canvas.width=p,r.canvas.height=g;let m,y;if(y=r.createTexture(),r.bindTexture(r.TEXTURE_2D,y),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),f?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,p,g,0,r.RGBA,u,null),m=r.createFramebuffer(),r.bindFramebuffer(r.FRAMEBUFFER,m),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,y,0),m===null)throw new Error("Could not create framebuffer");if(y===null)throw new Error("Could not create texture");if(c.length===0)return{width:p,height:g,framebuffer:m,texture:y};const _=mn();c.forEach(function(v,U,M){Ff(_,v.extent)});let E,S,R;const w=1/i;{if(E=r.createTexture(),y===null)throw new Error("Could not create texture");S=Math.round(Fe(_)*w),R=Math.round(at(_)*w);const v=r.getParameter(r.MAX_TEXTURE_SIZE),U=Math.max(S,R),M=U>v?v/U:1,z=Math.round(S*M),N=Math.round(R*M);r.bindTexture(r.TEXTURE_2D,E),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),f?(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR)):(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.NEAREST)),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,z,N,0,r.RGBA,u,null);const G=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,G),r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,E,0);const re=new Z_(r);c.forEach(function(X,q,ne){const se=(X.extent[0]-_[0])*w*M,ge=-(X.extent[3]-_[3])*w*M,be=Fe(X.extent)*w*M,me=at(X.extent)*w*M;if(r.bindFramebuffer(r.FRAMEBUFFER,G),r.viewport(0,0,z,N),X.clipExtent){const we=(X.clipExtent[0]-_[0])*w*M,Le=-(X.clipExtent[3]-_[3])*w*M,Ae=Fe(X.clipExtent)*w*M,Me=at(X.clipExtent)*w*M;r.enable(r.SCISSOR_TEST),r.scissor(f?we:Math.round(we),f?Le:Math.round(Le),f?Ae:Math.round(we+Ae)-Math.round(we),f?Me:Math.round(Le+Me)-Math.round(Le))}re.drawImage(X.texture,X.width,X.height,l,l,X.width-2*l,X.height-2*l,f?se:Math.round(se),f?ge:Math.round(ge),f?be:Math.round(se+be)-Math.round(se),f?me:Math.round(ge+me)-Math.round(ge),z,N),r.disable(r.SCISSOR_TEST)}),r.deleteFramebuffer(G)}const A=hs(o),C=hs(_),P=v=>{const U=(v[0][0]-A[0])/s*n,M=-(v[0][1]-A[1])/s*n,z=(v[1][0]-A[0])/s*n,N=-(v[1][1]-A[1])/s*n,G=(v[2][0]-A[0])/s*n,re=-(v[2][1]-A[1])/s*n;return{u1:z,v1:N,u0:U,v0:M,u2:G,v2:re}};r.bindFramebuffer(r.FRAMEBUFFER,m),r.viewport(0,0,p,g);{const v=[],U=[],M=Ts(r,J_,K_);r.useProgram(M);const z=r.getUniformLocation(M,"u_texture");r.bindTexture(r.TEXTURE_2D,E),r.uniform1i(z,0),a.getTriangles().forEach(function(se,ge,be){const me=se.source,we=se.target,{u1:Le,v1:Ae,u0:Me,v0:nr,u2:ir,v2:bt}=P(we),In=(me[0][0]-C[0])/i/S,Cn=-(me[0][1]-C[1])/i/R,ah=(me[1][0]-C[0])/i/S,lh=-(me[1][1]-C[1])/i/R,ch=(me[2][0]-C[0])/i/S,uh=-(me[2][1]-C[1])/i/R;v.push(Le,Ae,Me,nr,ir,bt),U.push(ah,lh,In,Cn,ch,uh)});const N=ys(0,p,g,0,-1,1),G=r.getUniformLocation(M,"u_matrix");r.uniformMatrix4fv(G,!1,N);const re=r.getAttribLocation(M,"a_position"),X=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,X),r.bufferData(r.ARRAY_BUFFER,new Float32Array(v),r.STATIC_DRAW),r.vertexAttribPointer(re,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(re);const q=r.getAttribLocation(M,"a_texcoord"),ne=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,ne),r.bufferData(r.ARRAY_BUFFER,new Float32Array(U),r.STATIC_DRAW),r.vertexAttribPointer(q,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(q),r.drawArrays(r.TRIANGLES,0,v.length/2)}if(h){const v=Ts(r,q_,Y_);r.useProgram(v);const U=ys(0,p,g,0,-1,1),M=r.getUniformLocation(v,"u_matrix");r.uniformMatrix4fv(M,!1,U);const z=Array.isArray(h)?h:[0,0,0,255],N=r.getUniformLocation(v,"u_val");r.uniform4fv(N,z);const G=r.getAttribLocation(v,"a_position"),re=r.createBuffer();r.bindBuffer(r.ARRAY_BUFFER,re),r.vertexAttribPointer(G,2,r.FLOAT,!1,0,0),r.enableVertexAttribArray(G);const X=a.getTriangles().reduce(function(q,ne){const se=ne.target,{u1:ge,v1:be,u0:me,v0:we,u2:Le,v2:Ae}=P(se);return q.concat([ge,be,me,we,me,we,Le,Ae,Le,Ae,ge,be])},[]);r.bufferData(r.ARRAY_BUFFER,new Float32Array(X),r.STATIC_DRAW),r.drawArrays(r.LINES,0,X.length/2)}return{width:p,height:g,framebuffer:m,texture:y}}class ry extends Gs{constructor(e){super({tileCoord:e.tileCoord,loader:()=>Promise.resolve(new Uint8ClampedArray(4)),interpolate:e.interpolate,transition:e.transition}),this.renderEdges_=e.renderEdges!==void 0?e.renderEdges:!1,this.pixelRatio_=e.pixelRatio,this.gutter_=e.gutter,this.reprojData_=null,this.reprojError_=null,this.reprojSize_=void 0,this.sourceTileGrid_=e.sourceTileGrid,this.targetTileGrid_=e.targetTileGrid,this.wrappedTileCoord_=e.wrappedTileCoord||e.tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const t=e.sourceProj,n=t.getExtent(),i=e.sourceTileGrid.getExtent();this.clipExtent_=t.canWrapX()?i?it(n,i):n:i;const s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),o=this.targetTileGrid_.getExtent();let a=this.sourceTileGrid_.getExtent();const c=o?it(s,o):s;if(ga(c)===0){this.state=Q.EMPTY;return}n&&(a?a=it(a,n):a=n);const l=this.targetTileGrid_.getResolution(this.wrappedTileCoord_[0]),u=e.targetProj,h=Nh(t,u,c,l);if(!isFinite(h)||h<=0){this.state=Q.EMPTY;return}const f=e.errorThreshold!==void 0?e.errorThreshold:Dh;if(this.triangulation_=new Uh(t,u,c,a,h*f,l,e.transformMatrix),this.triangulation_.getTriangles().length===0){this.state=Q.EMPTY;return}this.sourceZ_=this.sourceTileGrid_.getZForResolution(h);let d=this.triangulation_.calculateSourceExtent();if(a&&(t.canWrapX()?(d[1]=Ee(d[1],a[1],a[3]),d[3]=Ee(d[3],a[1],a[3])):d=it(d,a)),!ga(d))this.state=Q.EMPTY;else{let p=0,g=0;t.canWrapX()&&(p=Fe(n),g=Math.floor((d[0]-n[0])/p)),Of(d.slice(),t,!0).forEach(y=>{const _=this.sourceTileGrid_.getTileRangeForExtentAndZ(y,this.sourceZ_),E=e.getTileFunction;for(let S=_.minX;S<=_.maxX;S++)for(let R=_.minY;R<=_.maxY;R++){const w=E(this.sourceZ_,S,R,this.pixelRatio_);if(w){const A=g*p;this.sourceTiles_.push({tile:w,offset:A})}}++g}),this.sourceTiles_.length===0&&(this.state=Q.EMPTY)}}getSize(){return this.reprojSize_}getData(){return this.reprojData_}getError(){return this.reprojError_}reproject_(){const e=[];let t=!1;if(this.sourceTiles_.forEach(S=>{var ge;const R=S.tile;if(!R||R.getState()!==Q.LOADED)return;const w=R.getSize(),A=this.gutter_;let C;const P=ss(R.getData());P?C=P:(t=!0,C=Mh(os(R.getData())));const v=[w[0]+2*A,w[1]+2*A],U=C instanceof Float32Array,M=v[0]*v[1],z=U?Float32Array:Uint8ClampedArray,N=new z(C.buffer),G=z.BYTES_PER_ELEMENT,re=G*N.length/M,X=N.byteLength/v[1],q=Math.floor(X/G/v[0]),ne=this.sourceTileGrid_.getTileCoordExtent(R.tileCoord);ne[0]+=S.offset,ne[2]+=S.offset;const se=(ge=this.clipExtent_)==null?void 0:ge.slice();se&&(se[0]+=S.offset,se[2]+=S.offset),e.push({extent:ne,clipExtent:se,data:N,dataType:z,bytesPerPixel:re,pixelSize:v,bandCount:q})}),this.sourceTiles_.length=0,e.length===0){this.state=Q.ERROR,this.changed();return}const n=this.wrappedTileCoord_[0],i=this.targetTileGrid_.getTileSize(n),s=typeof i=="number"?i:i[0],o=typeof i=="number"?i:i[1],a=s*this.pixelRatio_,c=o*this.pixelRatio_,l=this.targetTileGrid_.getResolution(n),u=this.sourceTileGrid_.getResolution(this.sourceZ_),h=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_),f=e[0].bandCount,d=new e[0].dataType(f*a*c),p=Q_(a,c,al,{premultipliedAlpha:!1,antialias:!1});let g;const m=p.RGBA;let y;e[0].dataType==Float32Array?(y=p.FLOAT,p.getExtension("WEBGL_color_buffer_float"),p.getExtension("OES_texture_float"),p.getExtension("EXT_float_blend"),g=p.getExtension("OES_texture_float_linear")!==null&&this.interpolate):(y=p.UNSIGNED_BYTE,g=this.interpolate);const _=4,E=Math.ceil(f/_);for(let S=E-1;S>=0;--S){const R=[];for(let z=0,N=e.length;z<N;++z){const G=e[z],re=G.pixelSize,X=re[0],q=re[1],ne=new G.dataType(_*X*q),se=G.data;let ge=S*_;for(let me=0,we=ne.length;me<we;me+=_)ne[me]=se[ge],ne[me+1]=se[ge+1],ne[me+2]=se[ge+2],ne[me+3]=se[ge+3],ge+=f;const be=p.createTexture();p.bindTexture(p.TEXTURE_2D,be),g?(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.LINEAR),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.LINEAR)):(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST)),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texImage2D(p.TEXTURE_2D,0,m,X,q,0,m,y,ne),R.push({extent:G.extent,clipExtent:G.clipExtent,texture:be,width:X,height:q})}const{framebuffer:w,width:A,height:C}=ty(p,s,o,this.pixelRatio_,u,l,h,this.triangulation_,R,this.gutter_,y,this.renderEdges_,g),P=A,v=C*_,U=new e[0].dataType(P*v);p.bindFramebuffer(p.FRAMEBUFFER,w),p.readPixels(0,0,A,C,p.RGBA,y,U);let M=S*_;for(let z=0,N=U.length;z<N;z+=_){const G=(P-1-(z/v|0))*v+z%v;d[M]=U[G],d[M+1]=U[G+1],d[M+2]=U[G+2],d[M+3]=U[G+3],M+=f}}if(ey(p),al.push(p.canvas),t){const S=Gt(s,o),R=new ImageData(d,s);S.putImageData(R,0,0),this.reprojData_=S.canvas}else this.reprojData_=d;this.reprojSize_=[Math.round(a),Math.round(c)],this.state=Q.LOADED,this.changed()}load(){if(this.state!==Q.IDLE&&this.state!==Q.ERROR)return;this.state=Q.LOADING,this.changed();let e=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(({tile:t})=>{const n=t.getState();if(n!==Q.IDLE&&n!==Q.LOADING)return;e++;const i=St(t,ze.CHANGE,()=>{const s=t.getState();(s==Q.LOADED||s==Q.ERROR||s==Q.EMPTY)&&(oi(i),e--,e===0&&(this.unlistenSources_(),this.reproject_()))});this.sourcesListenerKeys_.push(i)}),e===0?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach(function({tile:t}){t.getState()==Q.IDLE&&t.load()})}unlistenSources_(){this.sourcesListenerKeys_.forEach(oi),this.sourcesListenerKeys_=null}}class Tn extends Si{constructor(e){const t=e.projection===void 0?"EPSG:3857":e.projection;let n=e.tileGrid;n===void 0&&t&&(n=pn({extent:dn(t),maxResolution:e.maxResolution,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize})),super({cacheSize:.1,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,projection:t,tileGrid:n,state:e.state,wrapX:e.wrapX,transition:e.transition,interpolate:e.interpolate,key:e.key,zDirection:e.zDirection}),this.gutter_=e.gutter!==void 0?e.gutter:0,this.tileSize_=e.tileSize?ot(e.tileSize):null,this.tileSizes_=null,this.tileLoadingKeys_={},this.loader_=e.loader,this.handleTileChange_=this.handleTileChange_.bind(this),this.bandCount=e.bandCount===void 0?4:e.bandCount,this.tileGridForProjection_={},this.crossOrigin_=e.crossOrigin||"anonymous",this.transformMatrix=null}setTileSizes(e){this.tileSizes_=e}getTileSize(e){if(this.tileSizes_)return this.tileSizes_[e];if(this.tileSize_)return this.tileSize_;const t=this.getTileGrid();return t?ot(t.getTileSize(e)):[256,256]}getGutterForProjection(e){const t=this.getProjection();return(!t||Wn(t,e))&&!this.transformMatrix?this.gutter_:0}setLoader(e){this.loader_=e}getReprojTile_(e,t,n,i,s){const o=this.tileGrid||this.getTileGridForProjection(s||i),a=Math.max.apply(null,o.getResolutions().map((d,p)=>{const g=ot(o.getTileSize(p)),m=this.getTileSize(p);return Math.max(m[0]/g[0],m[1]/g[1])})),c=this.getTileGridForProjection(i),l=[e,t,n],u=this.getTileCoordForTileUrlFunction(l,i),h=Object.assign({sourceProj:s||i,sourceTileGrid:o,targetProj:i,targetTileGrid:c,tileCoord:l,wrappedTileCoord:u,pixelRatio:a,gutter:this.gutter_,getTileFunction:(d,p,g,m)=>this.getTile(d,p,g,m),transformMatrix:this.transformMatrix},this.tileOptions),f=new ry(h);return f.key=this.getKey(),f}getTile(e,t,n,i,s){var E;const o=this.getProjection();if(s&&(o&&!Wn(o,s)||this.transformMatrix))return this.getReprojTile_(e,t,n,s,o);const a=this.getTileSize(e),c=this.loader_,l=new AbortController,u={signal:l.signal,crossOrigin:this.crossOrigin_},h=this.getTileCoordForTileUrlFunction([e,t,n]);if(!h)return null;const f=h[0],d=h[1],p=h[2],g=(E=this.getTileGrid())==null?void 0:E.getFullTileRange(f);g&&(u.maxY=g.getHeight()-1);function m(){return Mf(function(){return c(f,d,p,u)})}const y=Object.assign({tileCoord:[e,t,n],loader:m,size:a,controller:l},this.tileOptions),_=new Gs(y);return _.key=this.getKey(),_.addEventListener(ze.CHANGE,this.handleTileChange_),_}handleTileChange_(e){const t=e.target,n=de(t),i=t.getState();let s;i==Q.LOADING?(this.tileLoadingKeys_[n]=!0,s=zi.TILELOADSTART):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],s=i==Q.ERROR?zi.TILELOADERROR:i==Q.LOADED?zi.TILELOADEND:void 0),s&&this.dispatchEvent(new Bh(s,t))}getTileGridForProjection(e){const t=this.getProjection();if(this.tileGrid&&(!t||Wn(t,e))&&!this.transformMatrix)return this.tileGrid;const n=de(e);return n in this.tileGridForProjection_||(this.tileGridForProjection_[n]=Gh(e)),this.tileGridForProjection_[n]}setTileGridForProjection(e,t){const n=ae(e);if(n){const i=de(n);i in this.tileGridForProjection_||(this.tileGridForProjection_[i]=t)}}}function Oe(r){return(e,...t)=>ny(r,e,t)}function Nr(r,e){return Oe(Wc(r,e).get)}const{apply:ny,getOwnPropertyDescriptor:Wc,getPrototypeOf:Ro,ownKeys:iy}=Reflect,{iterator:wn,toStringTag:sy}=Symbol,oy=Object,{create:vo,defineProperty:ay}=oy,ly=Array,cy=ly.prototype,jc=cy[wn],uy=Oe(jc),Hc=ArrayBuffer,hy=Hc.prototype;Nr(hy,"byteLength");const ll=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null;ll&&Nr(ll.prototype,"byteLength");const Zc=Ro(Uint8Array);Zc.from;const ke=Zc.prototype;ke[wn];Oe(ke.keys);Oe(ke.values);Oe(ke.entries);Oe(ke.set);Oe(ke.reverse);Oe(ke.fill);Oe(ke.copyWithin);Oe(ke.sort);Oe(ke.slice);Oe(ke.subarray);Nr(ke,"buffer");Nr(ke,"byteOffset");Nr(ke,"length");Nr(ke,sy);const fy=Uint8Array,Yc=Uint16Array,Ao=Uint32Array,dy=Float32Array,cn=Ro([][wn]()),qc=Oe(cn.next),py=Oe(function*(){}().next),gy=Ro(cn),my=DataView.prototype,_y=Oe(my.getUint16),Po=WeakMap,Kc=Po.prototype,Jc=Oe(Kc.get),yy=Oe(Kc.set),Qc=new Po,xy=vo(null,{next:{value:function(){const e=Jc(Qc,this);return qc(e)}},[wn]:{value:function(){return this}}});function Ey(r){if(r[wn]===jc&&cn.next===qc)return r;const e=vo(xy);return yy(Qc,e,uy(r)),e}const by=new Po,Ty=vo(gy,{next:{value:function(){const e=Jc(by,this);return py(e)},writable:!0,configurable:!0}});for(const r of iy(cn))r!=="next"&&ay(Ty,r,Wc(cn,r));const eu=new Hc(4),wy=new dy(eu),Sy=new Ao(eu),ft=new Yc(512),dt=new fy(512);for(let r=0;r<256;++r){const e=r-127;e<-24?(ft[r]=0,ft[r|256]=32768,dt[r]=24,dt[r|256]=24):e<-14?(ft[r]=1024>>-e-14,ft[r|256]=1024>>-e-14|32768,dt[r]=-e-1,dt[r|256]=-e-1):e<=15?(ft[r]=e+15<<10,ft[r|256]=e+15<<10|32768,dt[r]=13,dt[r|256]=13):e<128?(ft[r]=31744,ft[r|256]=64512,dt[r]=24,dt[r|256]=24):(ft[r]=31744,ft[r|256]=64512,dt[r]=13,dt[r|256]=13)}const Lo=new Ao(2048);for(let r=1;r<1024;++r){let e=r<<13,t=0;for(;!(e&8388608);)e<<=1,t-=8388608;e&=-8388609,t+=947912704,Lo[r]=e|t}for(let r=1024;r<2048;++r)Lo[r]=939524096+(r-1024<<13);const Dr=new Ao(64);for(let r=1;r<31;++r)Dr[r]=r<<23;Dr[31]=1199570944;Dr[32]=2147483648;for(let r=33;r<63;++r)Dr[r]=2147483648+(r-32<<23);Dr[63]=3347054592;const tu=new Yc(64);for(let r=1;r<64;++r)r!==32&&(tu[r]=1024);function Ry(r){const e=r>>10;return Sy[0]=Lo[tu[e]+(r&1023)]+Dr[e],wy[0]}function ru(r,e,...t){return Ry(_y(r,e,...Ey(t)))}var Io={exports:{}};function nu(r,e,t){const n=t&&t.debug||!1;n&&console.log("[xml-utils] getting "+e+" in "+r);const i=typeof r=="object"?r.outer:r,s=i.slice(0,i.indexOf(">")+1),o=['"',"'"];for(let a=0;a<o.length;a++){const c=o[a],l=e+"\\="+c+"([^"+c+"]*)"+c;n&&console.log("[xml-utils] pattern:",l);const h=new RegExp(l).exec(s);if(n&&console.log("[xml-utils] match:",h),h)return h[1]}}Io.exports=nu;Io.exports.default=nu;var vy=Io.exports;const Zi=to(vy);var Co={exports:{}},Fo={exports:{}},Oo={exports:{}};function iu(r,e,t){const i=new RegExp(e).exec(r.slice(t));return i?t+i.index:-1}Oo.exports=iu;Oo.exports.default=iu;var Ay=Oo.exports,Mo={exports:{}};function su(r,e,t){const i=new RegExp(e).exec(r.slice(t));return i?t+i.index+i[0].length-1:-1}Mo.exports=su;Mo.exports.default=su;var Py=Mo.exports,No={exports:{}};function ou(r,e){const t=new RegExp(e,"g"),n=r.match(t);return n?n.length:0}No.exports=ou;No.exports.default=ou;var Ly=No.exports;const Iy=Ay,Yi=Py,cl=Ly;function au(r,e,t){const n=t&&t.debug||!1,i=!(t&&typeof t.nested===!1),s=t&&t.startIndex||0;n&&console.log("[xml-utils] starting findTagByName with",e," and ",t);const o=Iy(r,`<${e}[ 
>/]`,s);if(n&&console.log("[xml-utils] start:",o),o===-1)return;const a=r.slice(o+e.length);let c=Yi(a,"^[^<]*[ /]>",0);const l=c!==-1&&a[c-1]==="/";if(n&&console.log("[xml-utils] selfClosing:",l),l===!1)if(i){let d=0,p=1,g=0;for(;(c=Yi(a,"[ /]"+e+">",d))!==-1;){const m=a.substring(d,c+1);if(p+=cl(m,"<"+e+`[ 
	>]`),g+=cl(m,"</"+e+">"),g>=p)break;d=c}}else c=Yi(a,"[ /]"+e+">",0);const u=o+e.length+c+1;if(n&&console.log("[xml-utils] end:",u),u===-1)return;const h=r.slice(o,u);let f;return l?f=null:f=h.slice(h.indexOf(">")+1,h.lastIndexOf("<")),{inner:f,outer:h,start:o,end:u}}Fo.exports=au;Fo.exports.default=au;var Cy=Fo.exports;const Fy=Cy;function lu(r,e,t){const n=[],i=t&&t.debug||!1,s=t&&typeof t.nested=="boolean"?t.nested:!0;let o=t&&t.startIndex||0,a;for(;a=Fy(r,e,{debug:i,startIndex:o});)s?o=a.start+1+e.length:o=a.end,n.push(a);return i&&console.log("findTagsByName found",n.length,"tags"),n}Co.exports=lu;Co.exports.default=lu;var Oy=Co.exports;const My=to(Oy),Yr={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",340:"SMinSampleValue",341:"SMaxSampleValue",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop",33550:"ModelPixelScale",33922:"ModelTiepoint",34264:"ModelTransformation",34735:"GeoKeyDirectory",34736:"GeoDoubleParams",34737:"GeoAsciiParams",50674:"LercParameters"},pt={};for(const r in Yr)Yr.hasOwnProperty(r)&&(pt[Yr[r]]=parseInt(r,10));const Ny=[pt.BitsPerSample,pt.ExtraSamples,pt.SampleFormat,pt.StripByteCounts,pt.StripOffsets,pt.StripRowCounts,pt.TileByteCounts,pt.TileOffsets,pt.SubIFDs],qi={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE",13:"IFD",16:"LONG8",17:"SLONG8",18:"IFD8"},Y={};for(const r in qi)qi.hasOwnProperty(r)&&(Y[qi[r]]=parseInt(r,10));const $e={WhiteIsZero:0,BlackIsZero:1,RGB:2,Palette:3,CMYK:5,YCbCr:6,CIELab:8,ICCLab:9},Dy={Unspecified:0},Pb={AddCompression:1},Lb={None:0,Deflate:1,Zstandard:2},Uy={1024:"GTModelTypeGeoKey",1025:"GTRasterTypeGeoKey",1026:"GTCitationGeoKey",2048:"GeographicTypeGeoKey",2049:"GeogCitationGeoKey",2050:"GeogGeodeticDatumGeoKey",2051:"GeogPrimeMeridianGeoKey",2052:"GeogLinearUnitsGeoKey",2053:"GeogLinearUnitSizeGeoKey",2054:"GeogAngularUnitsGeoKey",2055:"GeogAngularUnitSizeGeoKey",2056:"GeogEllipsoidGeoKey",2057:"GeogSemiMajorAxisGeoKey",2058:"GeogSemiMinorAxisGeoKey",2059:"GeogInvFlatteningGeoKey",2060:"GeogAzimuthUnitsGeoKey",2061:"GeogPrimeMeridianLongGeoKey",2062:"GeogTOWGS84GeoKey",3072:"ProjectedCSTypeGeoKey",3073:"PCSCitationGeoKey",3074:"ProjectionGeoKey",3075:"ProjCoordTransGeoKey",3076:"ProjLinearUnitsGeoKey",3077:"ProjLinearUnitSizeGeoKey",3078:"ProjStdParallel1GeoKey",3079:"ProjStdParallel2GeoKey",3080:"ProjNatOriginLongGeoKey",3081:"ProjNatOriginLatGeoKey",3082:"ProjFalseEastingGeoKey",3083:"ProjFalseNorthingGeoKey",3084:"ProjFalseOriginLongGeoKey",3085:"ProjFalseOriginLatGeoKey",3086:"ProjFalseOriginEastingGeoKey",3087:"ProjFalseOriginNorthingGeoKey",3088:"ProjCenterLongGeoKey",3089:"ProjCenterLatGeoKey",3090:"ProjCenterEastingGeoKey",3091:"ProjCenterNorthingGeoKey",3092:"ProjScaleAtNatOriginGeoKey",3093:"ProjScaleAtCenterGeoKey",3094:"ProjAzimuthAngleGeoKey",3095:"ProjStraightVertPoleLongGeoKey",3096:"ProjRectifiedGridAngleGeoKey",4096:"VerticalCSTypeGeoKey",4097:"VerticalCitationGeoKey",4098:"VerticalDatumGeoKey",4099:"VerticalUnitsGeoKey"};function By(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3);let s;for(let o=0,a=0;o<r.length;++o,a+=3)s=256-r[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function Gy(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3);let s;for(let o=0,a=0;o<r.length;++o,a+=3)s=r[o]/e*256,i[a]=s,i[a+1]=s,i[a+2]=s;return i}function zy(r,e){const{width:t,height:n}=r,i=new Uint8Array(t*n*3),s=e.length/3,o=e.length/3*2;for(let a=0,c=0;a<r.length;++a,c+=3){const l=r[a];i[c]=e[l]/65536*256,i[c+1]=e[l+s]/65536*256,i[c+2]=e[l+o]/65536*256}return i}function ky(r){const{width:e,height:t}=r,n=new Uint8Array(e*t*3);for(let i=0,s=0;i<r.length;i+=4,s+=3){const o=r[i],a=r[i+1],c=r[i+2],l=r[i+3];n[s]=255*((255-o)/256)*((255-l)/256),n[s+1]=255*((255-a)/256)*((255-l)/256),n[s+2]=255*((255-c)/256)*((255-l)/256)}return n}function $y(r){const{width:e,height:t}=r,n=new Uint8ClampedArray(e*t*3);for(let i=0,s=0;i<r.length;i+=3,s+=3){const o=r[i],a=r[i+1],c=r[i+2];n[s]=o+1.402*(c-128),n[s+1]=o-.34414*(a-128)-.71414*(c-128),n[s+2]=o+1.772*(a-128)}return n}const Vy=.95047,Xy=1,Wy=1.08883;function jy(r){const{width:e,height:t}=r,n=new Uint8Array(e*t*3);for(let i=0,s=0;i<r.length;i+=3,s+=3){const o=r[i+0],a=r[i+1]<<24>>24,c=r[i+2]<<24>>24;let l=(o+16)/116,u=a/500+l,h=l-c/200,f,d,p;u=Vy*(u*u*u>.008856?u*u*u:(u-16/116)/7.787),l=Xy*(l*l*l>.008856?l*l*l:(l-16/116)/7.787),h=Wy*(h*h*h>.008856?h*h*h:(h-16/116)/7.787),f=u*3.2406+l*-1.5372+h*-.4986,d=u*-.9689+l*1.8758+h*.0415,p=u*.0557+l*-.204+h*1.057,f=f>.0031308?1.055*f**(1/2.4)-.055:12.92*f,d=d>.0031308?1.055*d**(1/2.4)-.055:12.92*d,p=p>.0031308?1.055*p**(1/2.4)-.055:12.92*p,n[s]=Math.max(0,Math.min(1,f))*255,n[s+1]=Math.max(0,Math.min(1,d))*255,n[s+2]=Math.max(0,Math.min(1,p))*255}return n}const cu=new Map;function Vt(r,e){Array.isArray(r)||(r=[r]),r.forEach(t=>cu.set(t,e))}async function uu(r){const e=cu.get(r.Compression);if(!e)throw new Error(`Unknown compression method identifier: ${r.Compression}`);const t=await e();return new t(r)}Vt([void 0,1],()=>$t(()=>import("./raw.DxtaBMev.js"),__vite__mapDeps([0,1])).then(r=>r.default));Vt(5,()=>$t(()=>import("./lzw.BikwkTY2.js"),__vite__mapDeps([2,1])).then(r=>r.default));Vt(6,()=>{throw new Error("old style JPEG compression is not supported.")});Vt(7,()=>$t(()=>import("./jpeg.CbvpOiPg.js"),__vite__mapDeps([3,1])).then(r=>r.default));Vt([8,32946],()=>$t(()=>import("./deflate.B4_27dB1.js"),__vite__mapDeps([4,5,1])).then(r=>r.default));Vt(32773,()=>$t(()=>import("./packbits.D6Qr5eNi.js"),__vite__mapDeps([6,1])).then(r=>r.default));Vt(34887,()=>$t(()=>import("./lerc.azU1oScZ.js"),__vite__mapDeps([7,5,8,1,9,10,11,12,13,14,15,16])).then(async r=>(await r.zstd.init(),r)).then(r=>r.default));Vt(50001,()=>$t(()=>import("./webimage.CU41Mh7j.js"),__vite__mapDeps([17,1])).then(r=>r.default));function Di(r,e,t,n=1){return new(Object.getPrototypeOf(r)).constructor(e*t*n)}function Hy(r,e,t,n,i){const s=e/n,o=t/i;return r.map(a=>{const c=Di(a,n,i);for(let l=0;l<i;++l){const u=Math.min(Math.round(o*l),t-1);for(let h=0;h<n;++h){const f=Math.min(Math.round(s*h),e-1),d=a[u*e+f];c[l*n+h]=d}}return c})}function xr(r,e,t){return(1-t)*r+t*e}function Zy(r,e,t,n,i){const s=e/n,o=t/i;return r.map(a=>{const c=Di(a,n,i);for(let l=0;l<i;++l){const u=o*l,h=Math.floor(u),f=Math.min(Math.ceil(u),t-1);for(let d=0;d<n;++d){const p=s*d,g=p%1,m=Math.floor(p),y=Math.min(Math.ceil(p),e-1),_=a[h*e+m],E=a[h*e+y],S=a[f*e+m],R=a[f*e+y],w=xr(xr(_,E,g),xr(S,R,g),u%1);c[l*n+d]=w}}return c})}function Yy(r,e,t,n,i,s="nearest"){switch(s.toLowerCase()){case"nearest":return Hy(r,e,t,n,i);case"bilinear":case"linear":return Zy(r,e,t,n,i);default:throw new Error(`Unsupported resampling method: '${s}'`)}}function qy(r,e,t,n,i,s){const o=e/n,a=t/i,c=Di(r,n,i,s);for(let l=0;l<i;++l){const u=Math.min(Math.round(a*l),t-1);for(let h=0;h<n;++h){const f=Math.min(Math.round(o*h),e-1);for(let d=0;d<s;++d){const p=r[u*e*s+f*s+d];c[l*n*s+h*s+d]=p}}}return c}function Ky(r,e,t,n,i,s){const o=e/n,a=t/i,c=Di(r,n,i,s);for(let l=0;l<i;++l){const u=a*l,h=Math.floor(u),f=Math.min(Math.ceil(u),t-1);for(let d=0;d<n;++d){const p=o*d,g=p%1,m=Math.floor(p),y=Math.min(Math.ceil(p),e-1);for(let _=0;_<s;++_){const E=r[h*e*s+m*s+_],S=r[h*e*s+y*s+_],R=r[f*e*s+m*s+_],w=r[f*e*s+y*s+_],A=xr(xr(E,S,g),xr(R,w,g),u%1);c[l*n*s+d*s+_]=A}}}return c}function Jy(r,e,t,n,i,s,o="nearest"){switch(o.toLowerCase()){case"nearest":return qy(r,e,t,n,i,s);case"bilinear":case"linear":return Ky(r,e,t,n,i,s);default:throw new Error(`Unsupported resampling method: '${o}'`)}}function Qy(r,e,t){let n=0;for(let i=e;i<t;++i)n+=r[i];return n}function ws(r,e,t){switch(r){case 1:if(e<=8)return new Uint8Array(t);if(e<=16)return new Uint16Array(t);if(e<=32)return new Uint32Array(t);break;case 2:if(e===8)return new Int8Array(t);if(e===16)return new Int16Array(t);if(e===32)return new Int32Array(t);break;case 3:switch(e){case 16:case 32:return new Float32Array(t);case 64:return new Float64Array(t)}break}throw Error("Unsupported data format/bitsPerSample")}function e0(r,e){return(r===1||r===2)&&e<=32&&e%8===0?!1:!(r===3&&(e===16||e===32||e===64))}function t0(r,e,t,n,i,s,o){const a=new DataView(r),c=t===2?o*s:o*s*n,l=t===2?1:n,u=ws(e,i,c),h=parseInt("1".repeat(i),2);if(e===1){let f;t===1?f=n*i:f=i;let d=s*f;d&7&&(d=d+7&-8);for(let p=0;p<o;++p){const g=p*d;for(let m=0;m<s;++m){const y=g+m*l*i;for(let _=0;_<l;++_){const E=y+_*i,S=(p*s+m)*l+_,R=Math.floor(E/8),w=E%8;if(w+i<=8)u[S]=a.getUint8(R)>>8-i-w&h;else if(w+i<=16)u[S]=a.getUint16(R)>>16-i-w&h;else if(w+i<=24){const A=a.getUint16(R)<<8|a.getUint8(R+2);u[S]=A>>24-i-w&h}else u[S]=a.getUint32(R)>>32-i-w&h}}}}return u.buffer}class hu{constructor(e,t,n,i,s,o){this.fileDirectory=e,this.geoKeys=t,this.dataView=n,this.littleEndian=i,this.tiles=s?{}:null,this.isTiled=!e.StripOffsets;const a=e.PlanarConfiguration;if(this.planarConfiguration=typeof a>"u"?1:a,this.planarConfiguration!==1&&this.planarConfiguration!==2)throw new Error("Invalid planar configuration.");this.source=o}getFileDirectory(){return this.fileDirectory}getGeoKeys(){return this.geoKeys}getWidth(){return this.fileDirectory.ImageWidth}getHeight(){return this.fileDirectory.ImageLength}getSamplesPerPixel(){return typeof this.fileDirectory.SamplesPerPixel<"u"?this.fileDirectory.SamplesPerPixel:1}getTileWidth(){return this.isTiled?this.fileDirectory.TileWidth:this.getWidth()}getTileHeight(){return this.isTiled?this.fileDirectory.TileLength:typeof this.fileDirectory.RowsPerStrip<"u"?Math.min(this.fileDirectory.RowsPerStrip,this.getHeight()):this.getHeight()}getBlockWidth(){return this.getTileWidth()}getBlockHeight(e){return this.isTiled||(e+1)*this.getTileHeight()<=this.getHeight()?this.getTileHeight():this.getHeight()-e*this.getTileHeight()}getBytesPerPixel(){let e=0;for(let t=0;t<this.fileDirectory.BitsPerSample.length;++t)e+=this.getSampleByteSize(t);return e}getSampleByteSize(e){if(e>=this.fileDirectory.BitsPerSample.length)throw new RangeError(`Sample index ${e} is out of range.`);return Math.ceil(this.fileDirectory.BitsPerSample[e]/8)}getReaderForSample(e){const t=this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1,n=this.fileDirectory.BitsPerSample[e];switch(t){case 1:if(n<=8)return DataView.prototype.getUint8;if(n<=16)return DataView.prototype.getUint16;if(n<=32)return DataView.prototype.getUint32;break;case 2:if(n<=8)return DataView.prototype.getInt8;if(n<=16)return DataView.prototype.getInt16;if(n<=32)return DataView.prototype.getInt32;break;case 3:switch(n){case 16:return function(i,s){return ru(this,i,s)};case 32:return DataView.prototype.getFloat32;case 64:return DataView.prototype.getFloat64}break}throw Error("Unsupported data format/bitsPerSample")}getSampleFormat(e=0){return this.fileDirectory.SampleFormat?this.fileDirectory.SampleFormat[e]:1}getBitsPerSample(e=0){return this.fileDirectory.BitsPerSample[e]}getArrayForSample(e,t){const n=this.getSampleFormat(e),i=this.getBitsPerSample(e);return ws(n,i,t)}async getTileOrStrip(e,t,n,i,s){const o=Math.ceil(this.getWidth()/this.getTileWidth()),a=Math.ceil(this.getHeight()/this.getTileHeight());let c;const{tiles:l}=this;this.planarConfiguration===1?c=t*o+e:this.planarConfiguration===2&&(c=n*o*a+t*o+e);let u,h;this.isTiled?(u=this.fileDirectory.TileOffsets[c],h=this.fileDirectory.TileByteCounts[c]):(u=this.fileDirectory.StripOffsets[c],h=this.fileDirectory.StripByteCounts[c]);const f=(await this.source.fetch([{offset:u,length:h}],s))[0];let d;return l===null||!l[c]?(d=(async()=>{let p=await i.decode(this.fileDirectory,f);const g=this.getSampleFormat(),m=this.getBitsPerSample();return e0(g,m)&&(p=t0(p,g,this.planarConfiguration,this.getSamplesPerPixel(),m,this.getTileWidth(),this.getBlockHeight(t))),p})(),l!==null&&(l[c]=d)):d=l[c],{x:e,y:t,sample:n,data:await d}}async _readRaster(e,t,n,i,s,o,a,c,l){const u=this.getTileWidth(),h=this.getTileHeight(),f=this.getWidth(),d=this.getHeight(),p=Math.max(Math.floor(e[0]/u),0),g=Math.min(Math.ceil(e[2]/u),Math.ceil(f/u)),m=Math.max(Math.floor(e[1]/h),0),y=Math.min(Math.ceil(e[3]/h),Math.ceil(d/h)),_=e[2]-e[0];let E=this.getBytesPerPixel();const S=[],R=[];for(let C=0;C<t.length;++C)this.planarConfiguration===1?S.push(Qy(this.fileDirectory.BitsPerSample,0,t[C])/8):S.push(0),R.push(this.getReaderForSample(t[C]));const w=[],{littleEndian:A}=this;for(let C=m;C<y;++C)for(let P=p;P<g;++P){let v;this.planarConfiguration===1&&(v=this.getTileOrStrip(P,C,0,s,l));for(let U=0;U<t.length;++U){const M=U,z=t[U];this.planarConfiguration===2&&(E=this.getSampleByteSize(z),v=this.getTileOrStrip(P,C,z,s,l));const N=v.then(G=>{const re=G.data,X=new DataView(re),q=this.getBlockHeight(G.y),ne=G.y*h,se=G.x*u,ge=ne+q,be=(G.x+1)*u,me=R[M],we=Math.min(q,q-(ge-e[3]),d-ne),Le=Math.min(u,u-(be-e[2]),f-se);for(let Ae=Math.max(0,e[1]-ne);Ae<we;++Ae)for(let Me=Math.max(0,e[0]-se);Me<Le;++Me){const nr=(Ae*u+Me)*E,ir=me.call(X,nr+S[M],A);let bt;i?(bt=(Ae+ne-e[1])*_*t.length+(Me+se-e[0])*t.length+M,n[bt]=ir):(bt=(Ae+ne-e[1])*_+Me+se-e[0],n[M][bt]=ir)}});w.push(N)}}if(await Promise.all(w),o&&e[2]-e[0]!==o||a&&e[3]-e[1]!==a){let C;return i?C=Jy(n,e[2]-e[0],e[3]-e[1],o,a,t.length,c):C=Yy(n,e[2]-e[0],e[3]-e[1],o,a,c),C.width=o,C.height=a,C}return n.width=o||e[2]-e[0],n.height=a||e[3]-e[1],n}async readRasters({window:e,samples:t=[],interleave:n,pool:i=null,width:s,height:o,resampleMethod:a,fillValue:c,signal:l}={}){const u=e||[0,0,this.getWidth(),this.getHeight()];if(u[0]>u[2]||u[1]>u[3])throw new Error("Invalid subsets");const h=u[2]-u[0],f=u[3]-u[1],d=h*f,p=this.getSamplesPerPixel();if(!t||!t.length)for(let _=0;_<p;++_)t.push(_);else for(let _=0;_<t.length;++_)if(t[_]>=p)return Promise.reject(new RangeError(`Invalid sample index '${t[_]}'.`));let g;if(n){const _=this.fileDirectory.SampleFormat?Math.max.apply(null,this.fileDirectory.SampleFormat):1,E=Math.max.apply(null,this.fileDirectory.BitsPerSample);g=ws(_,E,d*t.length),c&&g.fill(c)}else{g=[];for(let _=0;_<t.length;++_){const E=this.getArrayForSample(t[_],d);Array.isArray(c)&&_<c.length?E.fill(c[_]):c&&!Array.isArray(c)&&E.fill(c),g.push(E)}}const m=i||await uu(this.fileDirectory);return await this._readRaster(u,t,g,n,m,s,o,a,l)}async readRGB({window:e,interleave:t=!0,pool:n=null,width:i,height:s,resampleMethod:o,enableAlpha:a=!1,signal:c}={}){const l=e||[0,0,this.getWidth(),this.getHeight()];if(l[0]>l[2]||l[1]>l[3])throw new Error("Invalid subsets");const u=this.fileDirectory.PhotometricInterpretation;if(u===$e.RGB){let y=[0,1,2];if(this.fileDirectory.ExtraSamples!==Dy.Unspecified&&a){y=[];for(let _=0;_<this.fileDirectory.BitsPerSample.length;_+=1)y.push(_)}return this.readRasters({window:e,interleave:t,samples:y,pool:n,width:i,height:s,resampleMethod:o,signal:c})}let h;switch(u){case $e.WhiteIsZero:case $e.BlackIsZero:case $e.Palette:h=[0];break;case $e.CMYK:h=[0,1,2,3];break;case $e.YCbCr:case $e.CIELab:h=[0,1,2];break;default:throw new Error("Invalid or unsupported photometric interpretation.")}const f={window:l,interleave:!0,samples:h,pool:n,width:i,height:s,resampleMethod:o,signal:c},{fileDirectory:d}=this,p=await this.readRasters(f),g=2**this.fileDirectory.BitsPerSample[0];let m;switch(u){case $e.WhiteIsZero:m=By(p,g);break;case $e.BlackIsZero:m=Gy(p,g);break;case $e.Palette:m=zy(p,d.ColorMap);break;case $e.CMYK:m=ky(p);break;case $e.YCbCr:m=$y(p);break;case $e.CIELab:m=jy(p);break;default:throw new Error("Unsupported photometric interpretation.")}if(!t){const y=new Uint8Array(m.length/3),_=new Uint8Array(m.length/3),E=new Uint8Array(m.length/3);for(let S=0,R=0;S<m.length;S+=3,++R)y[R]=m[S],_[R]=m[S+1],E[R]=m[S+2];m=[y,_,E]}return m.width=p.width,m.height=p.height,m}getTiePoints(){if(!this.fileDirectory.ModelTiepoint)return[];const e=[];for(let t=0;t<this.fileDirectory.ModelTiepoint.length;t+=6)e.push({i:this.fileDirectory.ModelTiepoint[t],j:this.fileDirectory.ModelTiepoint[t+1],k:this.fileDirectory.ModelTiepoint[t+2],x:this.fileDirectory.ModelTiepoint[t+3],y:this.fileDirectory.ModelTiepoint[t+4],z:this.fileDirectory.ModelTiepoint[t+5]});return e}getGDALMetadata(e=null){const t={};if(!this.fileDirectory.GDAL_METADATA)return null;const n=this.fileDirectory.GDAL_METADATA;let i=My(n,"Item");e===null?i=i.filter(s=>Zi(s,"sample")===void 0):i=i.filter(s=>Number(Zi(s,"sample"))===e);for(let s=0;s<i.length;++s){const o=i[s];t[Zi(o,"name")]=o.inner}return t}getGDALNoData(){if(!this.fileDirectory.GDAL_NODATA)return null;const e=this.fileDirectory.GDAL_NODATA;return Number(e.substring(0,e.length-1))}getOrigin(){const e=this.fileDirectory.ModelTiepoint,t=this.fileDirectory.ModelTransformation;if(e&&e.length===6)return[e[3],e[4],e[5]];if(t)return[t[3],t[7],t[11]];throw new Error("The image does not have an affine transformation.")}getResolution(e=null){const t=this.fileDirectory.ModelPixelScale,n=this.fileDirectory.ModelTransformation;if(t)return[t[0],-t[1],t[2]];if(n)return n[1]===0&&n[4]===0?[n[0],-n[5],n[10]]:[Math.sqrt(n[0]*n[0]+n[4]*n[4]),-Math.sqrt(n[1]*n[1]+n[5]*n[5]),n[10]];if(e){const[i,s,o]=e.getResolution();return[i*e.getWidth()/this.getWidth(),s*e.getHeight()/this.getHeight(),o*e.getWidth()/this.getWidth()]}throw new Error("The image does not have an affine transformation.")}pixelIsArea(){return this.geoKeys.GTRasterTypeGeoKey===1}getBoundingBox(e=!1){const t=this.getHeight(),n=this.getWidth();if(this.fileDirectory.ModelTransformation&&!e){const[i,s,o,a,c,l,u,h]=this.fileDirectory.ModelTransformation,d=[[0,0],[0,t],[n,0],[n,t]].map(([m,y])=>[a+i*m+s*y,h+c*m+l*y]),p=d.map(m=>m[0]),g=d.map(m=>m[1]);return[Math.min(...p),Math.min(...g),Math.max(...p),Math.max(...g)]}else{const i=this.getOrigin(),s=this.getResolution(),o=i[0],a=i[1],c=o+s[0]*n,l=a+s[1]*t;return[Math.min(o,c),Math.min(a,l),Math.max(o,c),Math.max(a,l)]}}}class r0{constructor(e){this._dataView=new DataView(e)}get buffer(){return this._dataView.buffer}getUint64(e,t){const n=this.getUint32(e,t),i=this.getUint32(e+4,t);let s;if(t){if(s=n+2**32*i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}if(s=2**32*n+i,!Number.isSafeInteger(s))throw new Error(`${s} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return s}getInt64(e,t){let n=0;const i=(this._dataView.getUint8(e+(t?7:0))&128)>0;let s=!0;for(let o=0;o<8;o++){let a=this._dataView.getUint8(e+(t?o:7-o));i&&(s?a!==0&&(a=~(a-1)&255,s=!1):a=~a&255),n+=a*256**o}return i&&(n=-n),n}getUint8(e,t){return this._dataView.getUint8(e,t)}getInt8(e,t){return this._dataView.getInt8(e,t)}getUint16(e,t){return this._dataView.getUint16(e,t)}getInt16(e,t){return this._dataView.getInt16(e,t)}getUint32(e,t){return this._dataView.getUint32(e,t)}getInt32(e,t){return this._dataView.getInt32(e,t)}getFloat16(e,t){return ru(this._dataView,e,t)}getFloat32(e,t){return this._dataView.getFloat32(e,t)}getFloat64(e,t){return this._dataView.getFloat64(e,t)}}class n0{constructor(e,t,n,i){this._dataView=new DataView(e),this._sliceOffset=t,this._littleEndian=n,this._bigTiff=i}get sliceOffset(){return this._sliceOffset}get sliceTop(){return this._sliceOffset+this.buffer.byteLength}get littleEndian(){return this._littleEndian}get bigTiff(){return this._bigTiff}get buffer(){return this._dataView.buffer}covers(e,t){return this.sliceOffset<=e&&this.sliceTop>=e+t}readUint8(e){return this._dataView.getUint8(e-this._sliceOffset,this._littleEndian)}readInt8(e){return this._dataView.getInt8(e-this._sliceOffset,this._littleEndian)}readUint16(e){return this._dataView.getUint16(e-this._sliceOffset,this._littleEndian)}readInt16(e){return this._dataView.getInt16(e-this._sliceOffset,this._littleEndian)}readUint32(e){return this._dataView.getUint32(e-this._sliceOffset,this._littleEndian)}readInt32(e){return this._dataView.getInt32(e-this._sliceOffset,this._littleEndian)}readFloat32(e){return this._dataView.getFloat32(e-this._sliceOffset,this._littleEndian)}readFloat64(e){return this._dataView.getFloat64(e-this._sliceOffset,this._littleEndian)}readUint64(e){const t=this.readUint32(e),n=this.readUint32(e+4);let i;if(this._littleEndian){if(i=t+2**32*n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}if(i=2**32*t+n,!Number.isSafeInteger(i))throw new Error(`${i} exceeds MAX_SAFE_INTEGER. Precision may be lost. Please report if you get this message to https://github.com/geotiffjs/geotiff.js/issues`);return i}readInt64(e){let t=0;const n=(this._dataView.getUint8(e+(this._littleEndian?7:0))&128)>0;let i=!0;for(let s=0;s<8;s++){let o=this._dataView.getUint8(e+(this._littleEndian?s:7-s));n&&(i?o!==0&&(o=~(o-1)&255,i=!1):o=~o&255),t+=o*256**s}return n&&(t=-t),t}readOffset(e){return this._bigTiff?this.readUint64(e):this.readUint32(e)}}const i0=typeof navigator<"u"&&navigator.hardwareConcurrency||2;class s0{constructor(e=i0,t){this.workers=null,this._awaitingDecoder=null,this.size=e,this.messageId=0,e&&(this._awaitingDecoder=t?Promise.resolve(t):new Promise(n=>{$t(()=>import("./decoder.CaSv2t6h.js"),[]).then(i=>{n(i.create)})}),this._awaitingDecoder.then(n=>{this._awaitingDecoder=null,this.workers=[];for(let i=0;i<e;i++)this.workers.push({worker:n(),idle:!0})}))}async decode(e,t){return this._awaitingDecoder&&await this._awaitingDecoder,this.size===0?uu(e).then(n=>n.decode(e,t)):new Promise(n=>{const i=this.workers.find(a=>a.idle)||this.workers[Math.floor(Math.random()*this.size)];i.idle=!1;const s=this.messageId++,o=a=>{a.data.id===s&&(i.idle=!0,n(a.data.decoded),i.worker.removeEventListener("message",o))};i.worker.addEventListener("message",o),i.worker.postMessage({fileDirectory:e,buffer:t,id:s},[t])})}destroy(){this.workers&&(this.workers.forEach(e=>{e.worker.terminate()}),this.workers=null)}}const ul=`\r
\r
`;function fu(r){if(typeof Object.fromEntries<"u")return Object.fromEntries(r);const e={};for(const[t,n]of r)e[t.toLowerCase()]=n;return e}function o0(r){const e=r.split(`\r
`).map(t=>{const n=t.split(":").map(i=>i.trim());return n[0]=n[0].toLowerCase(),n});return fu(e)}function a0(r){const[e,...t]=r.split(";").map(i=>i.trim()),n=t.map(i=>i.split("="));return{type:e,params:fu(n)}}function Ss(r){let e,t,n;return r&&([,e,t,n]=r.match(/bytes (\d+)-(\d+)\/(\d+)/),e=parseInt(e,10),t=parseInt(t,10),n=parseInt(n,10)),{start:e,end:t,total:n}}function l0(r,e){let t=null;const n=new TextDecoder("ascii"),i=[],s=`--${e}`,o=`${s}--`;for(let a=0;a<10;++a)n.decode(new Uint8Array(r,a,s.length))===s&&(t=a);if(t===null)throw new Error("Could not find initial boundary");for(;t<r.byteLength;){const a=n.decode(new Uint8Array(r,t,Math.min(s.length+1024,r.byteLength-t)));if(a.length===0||a.startsWith(o))break;if(!a.startsWith(s))throw new Error("Part does not start with boundary");const c=a.substr(s.length+2);if(c.length===0)break;const l=c.indexOf(ul),u=o0(c.substr(0,l)),{start:h,end:f,total:d}=Ss(u["content-range"]),p=t+s.length+l+ul.length,g=parseInt(f,10)+1-parseInt(h,10);i.push({headers:u,data:r.slice(p,p+g),offset:h,length:g,fileSize:d}),t=p+g+4}return i}class Do{async fetch(e,t=void 0){return Promise.all(e.map(n=>this.fetchSlice(n,t)))}async fetchSlice(e){throw new Error(`fetching of slice ${e} not possible, not implemented`)}get fileSize(){return null}async close(){}}class c0 extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if(typeof e.maxAge=="number"&&e.maxAge===0)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if(typeof this.onEviction=="function")for(const[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return typeof t.expiry=="number"&&t.expiry<=Date.now()?(typeof this.onEviction=="function"&&this.onEviction(e,t.value),this.delete(e)):!1}_getOrDeleteIfExpired(e,t){if(this._deleteIfExpired(e,t)===!1)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield e)}for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(this._deleteIfExpired(e,t)===!1)return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){const i=typeof n=="number"&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;return this.cache.has(e)?this.cache.set(e,{value:t,expiry:i}):this._set(e,{value:t,expiry:i}),this}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):this.oldCache.has(e)?!this._deleteIfExpired(e,this.oldCache.get(e)):!1}peek(e){if(this.cache.has(e))return this._peek(e,this.cache);if(this.oldCache.has(e))return this._peek(e,this.oldCache)}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,n]=e;this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}for(const e of this.oldCache){const[t,n]=e;this.cache.has(t)||this._deleteIfExpired(t,n)===!1&&(yield[t,n.value])}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const n=e[t],[i,s]=n;this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const n=e[t],[i,s]=n;this.cache.has(i)||this._deleteIfExpired(i,s)===!1&&(yield[i,s.value])}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[n,i]of this.entriesAscending())e.call(t,i,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}async function u0(r){return new Promise(e=>setTimeout(e,r))}function h0(r,e){const t=Array.isArray(r)?r:Array.from(r),n=Array.isArray(e)?e:Array.from(e);return t.map((i,s)=>[i,n[s]])}class Sr extends Error{constructor(e){super(e),Error.captureStackTrace&&Error.captureStackTrace(this,Sr),this.name="AbortError"}}class f0 extends Error{constructor(e,t){super(t),this.errors=e,this.message=t,this.name="AggregateError"}}const d0=f0;class p0{constructor(e,t,n=null){this.offset=e,this.length=t,this.data=n}get top(){return this.offset+this.length}}class hl{constructor(e,t,n){this.offset=e,this.length=t,this.blockIds=n}}class g0 extends Do{constructor(e,{blockSize:t=65536,cacheSize:n=100}={}){super(),this.source=e,this.blockSize=t,this.blockCache=new c0({maxSize:n,onEviction:(i,s)=>{this.evictedBlocks.set(i,s)}}),this.evictedBlocks=new Map,this.blockRequests=new Map,this.blockIdsToFetch=new Set,this.abortedBlockIds=new Set}get fileSize(){return this.source.fileSize}async fetch(e,t){const n=[],i=[],s=[];this.evictedBlocks.clear();for(const{offset:f,length:d}of e){let p=f+d;const{fileSize:g}=this;g!==null&&(p=Math.min(p,g));const m=Math.floor(f/this.blockSize)*this.blockSize;for(let y=m;y<p;y+=this.blockSize){const _=Math.floor(y/this.blockSize);!this.blockCache.has(_)&&!this.blockRequests.has(_)&&(this.blockIdsToFetch.add(_),i.push(_)),this.blockRequests.has(_)&&n.push(this.blockRequests.get(_)),s.push(_)}}await u0(),this.fetchBlocks(t);const o=[];for(const f of i)this.blockRequests.has(f)&&o.push(this.blockRequests.get(f));await Promise.allSettled(n),await Promise.allSettled(o);const a=[],c=s.filter(f=>this.abortedBlockIds.has(f)||!this.blockCache.has(f));if(c.forEach(f=>this.blockIdsToFetch.add(f)),c.length>0&&t&&!t.aborted){this.fetchBlocks(null);for(const f of c){const d=this.blockRequests.get(f);if(!d)throw new Error(`Block ${f} is not in the block requests`);a.push(d)}await Promise.allSettled(a)}if(t&&t.aborted)throw new Sr("Request was aborted");const l=s.map(f=>this.blockCache.get(f)||this.evictedBlocks.get(f)),u=l.filter(f=>!f);if(u.length)throw new d0(u,"Request failed");const h=new Map(h0(s,l));return this.readSliceData(e,h)}fetchBlocks(e){if(this.blockIdsToFetch.size>0){const t=this.groupBlocks(this.blockIdsToFetch),n=this.source.fetch(t,e);for(let i=0;i<t.length;++i){const s=t[i];for(const o of s.blockIds)this.blockRequests.set(o,(async()=>{try{const a=(await n)[i],c=o*this.blockSize,l=c-a.offset,u=Math.min(l+this.blockSize,a.data.byteLength),h=a.data.slice(l,u),f=new p0(c,h.byteLength,h,o);this.blockCache.set(o,f),this.abortedBlockIds.delete(o)}catch(a){if(a.name==="AbortError")a.signal=e,this.blockCache.delete(o),this.abortedBlockIds.add(o);else throw a}finally{this.blockRequests.delete(o)}})())}this.blockIdsToFetch.clear()}}groupBlocks(e){const t=Array.from(e).sort((o,a)=>o-a);if(t.length===0)return[];let n=[],i=null;const s=[];for(const o of t)i===null||i+1===o?(n.push(o),i=o):(s.push(new hl(n[0]*this.blockSize,n.length*this.blockSize,n)),n=[o],i=o);return s.push(new hl(n[0]*this.blockSize,n.length*this.blockSize,n)),s}readSliceData(e,t){return e.map(n=>{let i=n.offset+n.length;this.fileSize!==null&&(i=Math.min(this.fileSize,i));const s=Math.floor(n.offset/this.blockSize),o=Math.floor(i/this.blockSize),a=new ArrayBuffer(n.length),c=new Uint8Array(a);for(let l=s;l<=o;++l){const u=t.get(l),h=u.offset-n.offset,f=u.top-i;let d=0,p=0,g;h<0?d=-h:h>0&&(p=h),f<0?g=u.length-d:g=i-u.offset-d;const m=new Uint8Array(u.data,d,g);c.set(m,p)}return a})}}class Uo{get ok(){return this.status>=200&&this.status<=299}get status(){throw new Error("not implemented")}getHeader(e){throw new Error("not implemented")}async getData(){throw new Error("not implemented")}}class Bo{constructor(e){this.url=e}async request({headers:e,signal:t}={}){throw new Error("request is not implemented")}}class m0 extends Uo{constructor(e){super(),this.response=e}get status(){return this.response.status}getHeader(e){return this.response.headers.get(e)}async getData(){return this.response.arrayBuffer?await this.response.arrayBuffer():(await this.response.buffer()).buffer}}class _0 extends Bo{constructor(e,t){super(e),this.credentials=t}async request({headers:e,signal:t}={}){const n=await fetch(this.url,{headers:e,credentials:this.credentials,signal:t});return new m0(n)}}class y0 extends Uo{constructor(e,t){super(),this.xhr=e,this.data=t}get status(){return this.xhr.status}getHeader(e){return this.xhr.getResponseHeader(e)}async getData(){return this.data}}class x0 extends Bo{constructRequest(e,t){return new Promise((n,i)=>{const s=new XMLHttpRequest;s.open("GET",this.url),s.responseType="arraybuffer";for(const[o,a]of Object.entries(e))s.setRequestHeader(o,a);s.onload=()=>{const o=s.response;n(new y0(s,o))},s.onerror=i,s.onabort=()=>i(new Sr("Request aborted")),s.send(),t&&(t.aborted&&s.abort(),t.addEventListener("abort",()=>s.abort()))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}const Ki={};class E0 extends Uo{constructor(e,t){super(),this.response=e,this.dataPromise=t}get status(){return this.response.statusCode}getHeader(e){return this.response.headers[e]}async getData(){return await this.dataPromise}}class b0 extends Bo{constructor(e){super(e),this.parsedUrl=Ki.parse(this.url),this.httpApi=(this.parsedUrl.protocol==="http:",Ki)}constructRequest(e,t){return new Promise((n,i)=>{const s=this.httpApi.get({...this.parsedUrl,headers:e},o=>{const a=new Promise(c=>{const l=[];o.on("data",u=>{l.push(u)}),o.on("end",()=>{const u=Buffer.concat(l).buffer;c(u)}),o.on("error",i)});n(new E0(o,a))});s.on("error",i),t&&(t.aborted&&s.destroy(new Sr("Request aborted")),t.addEventListener("abort",()=>s.destroy(new Sr("Request aborted"))))})}async request({headers:e,signal:t}={}){return await this.constructRequest(e,t)}}class Go extends Do{constructor(e,t,n,i){super(),this.client=e,this.headers=t,this.maxRanges=n,this.allowFullFile=i,this._fileSize=null}async fetch(e,t){return this.maxRanges>=e.length?this.fetchSlices(e,t):(this.maxRanges>0&&e.length>1,Promise.all(e.map(n=>this.fetchSlice(n,t))))}async fetchSlices(e,t){const n=await this.client.request({headers:{...this.headers,Range:`bytes=${e.map(({offset:i,length:s})=>`${i}-${i+s}`).join(",")}`},signal:t});if(n.ok)if(n.status===206){const{type:i,params:s}=a0(n.getHeader("content-type"));if(i==="multipart/byteranges"){const h=l0(await n.getData(),s.boundary);return this._fileSize=h[0].fileSize||null,h}const o=await n.getData(),{start:a,end:c,total:l}=Ss(n.getHeader("content-range"));this._fileSize=l||null;const u=[{data:o,offset:a,length:c-a}];if(e.length>1){const h=await Promise.all(e.slice(1).map(f=>this.fetchSlice(f,t)));return u.concat(h)}return u}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const i=await n.getData();return this._fileSize=i.byteLength,[{data:i,offset:0,length:i.byteLength}]}else throw new Error("Error fetching data.")}async fetchSlice(e,t){const{offset:n,length:i}=e,s=await this.client.request({headers:{...this.headers,Range:`bytes=${n}-${n+i}`},signal:t});if(s.ok)if(s.status===206){const o=await s.getData(),{total:a}=Ss(s.getHeader("content-range"));return this._fileSize=a||null,{data:o,offset:n,length:i}}else{if(!this.allowFullFile)throw new Error("Server responded with full file");const o=await s.getData();return this._fileSize=o.byteLength,{data:o,offset:0,length:o.byteLength}}else throw new Error("Error fetching data.")}get fileSize(){return this._fileSize}}function zo(r,{blockSize:e,cacheSize:t}){return e===null?r:new g0(r,{blockSize:e,cacheSize:t})}function T0(r,{headers:e={},credentials:t,maxRanges:n=0,allowFullFile:i=!1,...s}={}){const o=new _0(r,t),a=new Go(o,e,n,i);return zo(a,s)}function w0(r,{headers:e={},maxRanges:t=0,allowFullFile:n=!1,...i}={}){const s=new x0(r),o=new Go(s,e,t,n);return zo(o,i)}function S0(r,{headers:e={},maxRanges:t=0,allowFullFile:n=!1,...i}={}){const s=new b0(r),o=new Go(s,e,t,n);return zo(o,i)}function Rs(r,{forceXHR:e=!1,...t}={}){return typeof fetch=="function"&&!e?T0(r,t):typeof XMLHttpRequest<"u"?w0(r,t):S0(r,t)}class R0 extends Do{constructor(e){super(),this.file=e}async fetchSlice(e,t){return new Promise((n,i)=>{const s=this.file.slice(e.offset,e.offset+e.length),o=new FileReader;o.onload=a=>n(a.target.result),o.onerror=i,o.onabort=i,o.readAsArrayBuffer(s),t&&t.addEventListener("abort",()=>o.abort())})}}function v0(r){return new R0(r)}function vs(r){switch(r){case Y.BYTE:case Y.ASCII:case Y.SBYTE:case Y.UNDEFINED:return 1;case Y.SHORT:case Y.SSHORT:return 2;case Y.LONG:case Y.SLONG:case Y.FLOAT:case Y.IFD:return 4;case Y.RATIONAL:case Y.SRATIONAL:case Y.DOUBLE:case Y.LONG8:case Y.SLONG8:case Y.IFD8:return 8;default:throw new RangeError(`Invalid field type: ${r}`)}}function A0(r){const e=r.GeoKeyDirectory;if(!e)return null;const t={};for(let n=4;n<=e[3]*4;n+=4){const i=Uy[e[n]],s=e[n+1]?Yr[e[n+1]]:null,o=e[n+2],a=e[n+3];let c=null;if(!s)c=a;else{if(c=r[s],typeof c>"u"||c===null)throw new Error(`Could not get value of geoKey '${i}'.`);typeof c=="string"?c=c.substring(a,a+o-1):c.subarray&&(c=c.subarray(a,a+o),o===1&&(c=c[0]))}t[i]=c}return t}function cr(r,e,t,n){let i=null,s=null;const o=vs(e);switch(e){case Y.BYTE:case Y.ASCII:case Y.UNDEFINED:i=new Uint8Array(t),s=r.readUint8;break;case Y.SBYTE:i=new Int8Array(t),s=r.readInt8;break;case Y.SHORT:i=new Uint16Array(t),s=r.readUint16;break;case Y.SSHORT:i=new Int16Array(t),s=r.readInt16;break;case Y.LONG:case Y.IFD:i=new Uint32Array(t),s=r.readUint32;break;case Y.SLONG:i=new Int32Array(t),s=r.readInt32;break;case Y.LONG8:case Y.IFD8:i=new Array(t),s=r.readUint64;break;case Y.SLONG8:i=new Array(t),s=r.readInt64;break;case Y.RATIONAL:i=new Uint32Array(t*2),s=r.readUint32;break;case Y.SRATIONAL:i=new Int32Array(t*2),s=r.readInt32;break;case Y.FLOAT:i=new Float32Array(t),s=r.readFloat32;break;case Y.DOUBLE:i=new Float64Array(t),s=r.readFloat64;break;default:throw new RangeError(`Invalid field type: ${e}`)}if(e===Y.RATIONAL||e===Y.SRATIONAL)for(let a=0;a<t;a+=2)i[a]=s.call(r,n+a*o),i[a+1]=s.call(r,n+(a*o+4));else for(let a=0;a<t;++a)i[a]=s.call(r,n+a*o);return e===Y.ASCII?new TextDecoder("utf-8").decode(i):i}class P0{constructor(e,t,n){this.fileDirectory=e,this.geoKeyDirectory=t,this.nextIFDByteOffset=n}}class Gn extends Error{constructor(e){super(`No image at index ${e}`),this.index=e}}class du{async readRasters(e={}){const{window:t,width:n,height:i}=e;let{resX:s,resY:o,bbox:a}=e;const c=await this.getImage();let l=c;const u=await this.getImageCount(),h=c.getBoundingBox();if(t&&a)throw new Error('Both "bbox" and "window" passed.');if(n||i){if(t){const[p,g]=c.getOrigin(),[m,y]=c.getResolution();a=[p+t[0]*m,g+t[1]*y,p+t[2]*m,g+t[3]*y]}const d=a||h;if(n){if(s)throw new Error("Both width and resX passed");s=(d[2]-d[0])/n}if(i){if(o)throw new Error("Both width and resY passed");o=(d[3]-d[1])/i}}if(s||o){const d=[];for(let p=0;p<u;++p){const g=await this.getImage(p),{SubfileType:m,NewSubfileType:y}=g.fileDirectory;(p===0||m===2||y&1)&&d.push(g)}d.sort((p,g)=>p.getWidth()-g.getWidth());for(let p=0;p<d.length;++p){const g=d[p],m=(h[2]-h[0])/g.getWidth(),y=(h[3]-h[1])/g.getHeight();if(l=g,s&&s>m||o&&o>y)break}}let f=t;if(a){const[d,p]=c.getOrigin(),[g,m]=l.getResolution(c);f=[Math.round((a[0]-d)/g),Math.round((a[1]-p)/m),Math.round((a[2]-d)/g),Math.round((a[3]-p)/m)],f=[Math.min(f[0],f[2]),Math.min(f[1],f[3]),Math.max(f[0],f[2]),Math.max(f[1],f[3])]}return l.readRasters({...e,window:f})}}class Rr extends du{constructor(e,t,n,i,s={}){super(),this.source=e,this.littleEndian=t,this.bigTiff=n,this.firstIFDOffset=i,this.cache=s.cache||!1,this.ifdRequests=[],this.ghostValues=null}async getSlice(e,t){const n=this.bigTiff?4048:1024;return new n0((await this.source.fetch([{offset:e,length:typeof t<"u"?t:n}]))[0],e,this.littleEndian,this.bigTiff)}async parseFileDirectoryAt(e){const t=this.bigTiff?20:12,n=this.bigTiff?8:2;let i=await this.getSlice(e);const s=this.bigTiff?i.readUint64(e):i.readUint16(e),o=s*t+(this.bigTiff?16:6);i.covers(e,o)||(i=await this.getSlice(e,o));const a={};let c=e+(this.bigTiff?8:2);for(let h=0;h<s;c+=t,++h){const f=i.readUint16(c),d=i.readUint16(c+2),p=this.bigTiff?i.readUint64(c+4):i.readUint32(c+4);let g,m;const y=vs(d),_=c+(this.bigTiff?12:8);if(y*p<=(this.bigTiff?8:4))g=cr(i,d,p,_);else{const E=i.readOffset(_),S=vs(d)*p;if(i.covers(E,S))g=cr(i,d,p,E);else{const R=await this.getSlice(E,S);g=cr(R,d,p,E)}}p===1&&Ny.indexOf(f)===-1&&!(d===Y.RATIONAL||d===Y.SRATIONAL)?m=g[0]:m=g,a[Yr[f]]=m}const l=A0(a),u=i.readOffset(e+n+t*s);return new P0(a,l,u)}async requestIFD(e){if(this.ifdRequests[e])return this.ifdRequests[e];if(e===0)return this.ifdRequests[e]=this.parseFileDirectoryAt(this.firstIFDOffset),this.ifdRequests[e];if(!this.ifdRequests[e-1])try{this.ifdRequests[e-1]=this.requestIFD(e-1)}catch(t){throw t instanceof Gn?new Gn(e):t}return this.ifdRequests[e]=(async()=>{const t=await this.ifdRequests[e-1];if(t.nextIFDByteOffset===0)throw new Gn(e);return this.parseFileDirectoryAt(t.nextIFDByteOffset)})(),this.ifdRequests[e]}async getImage(e=0){const t=await this.requestIFD(e);return new hu(t.fileDirectory,t.geoKeyDirectory,this.dataView,this.littleEndian,this.cache,this.source)}async getImageCount(){let e=0,t=!0;for(;t;)try{await this.requestIFD(e),++e}catch(n){if(n instanceof Gn)t=!1;else throw n}return e}async getGhostValues(){const e=this.bigTiff?16:8;if(this.ghostValues)return this.ghostValues;const t="GDAL_STRUCTURAL_METADATA_SIZE=",n=t.length+100;let i=await this.getSlice(e,n);if(t===cr(i,Y.ASCII,t.length,e)){const o=cr(i,Y.ASCII,n,e).split(`
`)[0],a=Number(o.split("=")[1].split(" ")[0])+o.length;a>n&&(i=await this.getSlice(e,a));const c=cr(i,Y.ASCII,a,e);this.ghostValues={},c.split(`
`).filter(l=>l.length>0).map(l=>l.split("=")).forEach(([l,u])=>{this.ghostValues[l]=u})}return this.ghostValues}static async fromSource(e,t,n){const i=(await e.fetch([{offset:0,length:1024}],n))[0],s=new r0(i),o=s.getUint16(0,0);let a;if(o===18761)a=!0;else if(o===19789)a=!1;else throw new TypeError("Invalid byte order value.");const c=s.getUint16(2,a);let l;if(c===42)l=!1;else if(c===43){if(l=!0,s.getUint16(4,a)!==8)throw new Error("Unsupported offset byte-size.")}else throw new TypeError("Invalid magic number.");const u=l?s.getUint64(8,a):s.getUint32(4,a);return new Rr(e,a,l,u,t)}close(){return typeof this.source.close=="function"?this.source.close():!1}}class L0 extends du{constructor(e,t){super(),this.mainFile=e,this.overviewFiles=t,this.imageFiles=[e].concat(t),this.fileDirectoriesPerFile=null,this.fileDirectoriesPerFileParsing=null,this.imageCount=null}async parseFileDirectoriesPerFile(){const e=[this.mainFile.parseFileDirectoryAt(this.mainFile.firstIFDOffset)].concat(this.overviewFiles.map(t=>t.parseFileDirectoryAt(t.firstIFDOffset)));return this.fileDirectoriesPerFile=await Promise.all(e),this.fileDirectoriesPerFile}async getImage(e=0){await this.getImageCount(),await this.parseFileDirectoriesPerFile();let t=0,n=0;for(let i=0;i<this.imageFiles.length;i++){const s=this.imageFiles[i];for(let o=0;o<this.imageCounts[i];o++){if(e===t){const a=await s.requestIFD(n);return new hu(a.fileDirectory,a.geoKeyDirectory,s.dataView,s.littleEndian,s.cache,s.source)}t++,n++}n=0}throw new RangeError("Invalid image index")}async getImageCount(){if(this.imageCount!==null)return this.imageCount;const e=[this.mainFile.getImageCount()].concat(this.overviewFiles.map(t=>t.getImageCount()));return this.imageCounts=await Promise.all(e),this.imageCount=this.imageCounts.reduce((t,n)=>t+n,0),this.imageCount}}async function I0(r,e={},t){return Rr.fromSource(Rs(r,e),t)}async function C0(r,e){return Rr.fromSource(v0(r),e)}async function F0(r,e=[],t={},n){const i=await Rr.fromSource(Rs(r,t),n),s=await Promise.all(e.map(o=>Rr.fromSource(Rs(o,t))));return new L0(i,s)}function O0(r){return((r.fileDirectory.NewSubfileType||0)&4)===4}function M0(r,e){if(!r)return!1;if(r===!0)return!0;if(e.getSamplesPerPixel()!==3)return!1;const t=e.fileDirectory.PhotometricInterpretation,n=$e;return t===n.CMYK||t===n.YCbCr||t===n.CIELab||t===n.ICCLab}const fl="STATISTICS_MAXIMUM",dl="STATISTICS_MINIMUM",Ji=256;let Qi;function N0(){return Qi||(Qi=new s0),Qi}function D0(r){try{return r.getBoundingBox(!0)}catch{return[0,0,r.getWidth(),r.getHeight()]}}function U0(r){try{return r.getOrigin().slice(0,2)}catch{return[0,r.getHeight()]}}function B0(r,e){try{return r.getResolution(e)}catch{return[e.getWidth()/r.getWidth(),e.getHeight()/r.getHeight()]}}function G0(r){const e=r.geoKeys;if(!e)return null;if(e.ProjectedCSTypeGeoKey&&e.ProjectedCSTypeGeoKey!==32767){const t="EPSG:"+e.ProjectedCSTypeGeoKey;let n=ae(t);if(!n){const i=fa(e.ProjLinearUnitsGeoKey);i&&(n=new da({code:t,units:i}))}return n}if(e.GeographicTypeGeoKey&&e.GeographicTypeGeoKey!==32767){const t="EPSG:"+e.GeographicTypeGeoKey;let n=ae(t);if(!n){const i=fa(e.GeogAngularUnitsGeoKey);i&&(n=new da({code:t,units:i}))}return n}return null}function z0(r){return r.getImageCount().then(function(e){const t=new Array(e);for(let n=0;n<e;++n)t[n]=r.getImage(n);return Promise.all(t)})}function k0(r,e){let t;return r.blob?t=C0(r.blob):r.overviews?t=F0(r.url,r.overviews,e):t=I0(r.url,e),t.then(z0)}function Xr(r,e,t,n,i){if(Array.isArray(r)){const s=r.length;if(!Array.isArray(e)||s!=e.length){const o=new Error(n);throw i(o),o}for(let o=0;o<s;++o)Xr(r[o],e[o],t,n,i);return}if(e=e,Math.abs(r-e)>t*r)throw new Error(n)}function $0(r){return r instanceof Int8Array?-128:r instanceof Int16Array?-32768:r instanceof Int32Array?-2147483648:r instanceof Float32Array?12e-39:0}function V0(r){return r instanceof Int8Array?127:r instanceof Uint8Array||r instanceof Uint8ClampedArray?255:r instanceof Int16Array?32767:r instanceof Uint16Array?65535:r instanceof Int32Array?2147483647:r instanceof Uint32Array?4294967295:r instanceof Float32Array?34e37:255}class ko extends Tn{constructor(e){super({state:"loading",tileGrid:null,projection:e.projection||null,transition:e.transition,interpolate:e.interpolate!==!1,wrapX:e.wrapX}),this.sourceInfo_=e.sources;const t=this.sourceInfo_.length;this.sourceOptions_=e.sourceOptions,this.sourceImagery_=new Array(t),this.sourceMasks_=new Array(t),this.resolutionFactors_=new Array(t),this.samplesPerPixel_,this.nodataValues_,this.metadata_,this.normalize_=e.normalize!==!1,this.addAlpha_=!1,this.error_=null,this.convertToRGB_=e.convertToRGB||!1,this.setKey(this.sourceInfo_.map(s=>s.url).join(","));const n=this,i=new Array(t);for(let s=0;s<t;++s)i[s]=k0(this.sourceInfo_[s],this.sourceOptions_);Promise.all(i).then(function(s){n.configure_(s)}).catch(function(s){an(s),n.error_=s,n.setState("error")})}getError(){return this.error_}determineProjection(e){const t=e[0];for(let n=t.length-1;n>=0;--n){const i=t[n],s=G0(i);if(s){this.projection=s;break}}}determineTransformMatrix(e){const t=e[0];for(let n=t.length-1;n>=0;--n){const s=t[n].fileDirectory.ModelTransformation;if(s){const[o,a,c,l,u,h,f,d]=s,p=nn(nn([1/Math.sqrt(o*o+u*u),0,0,-1/Math.sqrt(a*a+h*h),l,d],[o,u,a,h,0,0]),[1,0,0,1,-l,-d]);this.transformMatrix=p,this.addAlpha_=!0;break}}}configure_(e){let t,n,i,s,o;const a=new Array(e.length),c=new Array(e.length),l=new Array(e.length);let u=0;const h=e.length;for(let m=0;m<h;++m){const y=[],_=[];e[m].forEach(P=>{O0(P)?_.push(P):y.push(P)});const E=y.length;if(_.length>0&&_.length!==E)throw new Error(`Expected one mask per image found ${_.length} masks and ${E} images`);let S,R;const w=new Array(E),A=new Array(E),C=new Array(E);c[m]=new Array(E),l[m]=new Array(E);for(let P=0;P<E;++P){const v=y[P],U=v.getGDALNoData();l[m][P]=v.getGDALMetadata(0),c[m][P]=U;const M=this.sourceInfo_[m].bands;a[m]=M?M.length:v.getSamplesPerPixel();const z=E-(P+1);S||(S=D0(v)),R||(R=U0(v));const N=B0(v,y[0]);C[z]=N[0];const G=[v.getTileWidth(),v.getTileHeight()];G[0]!==G[1]&&G[1]<Ji&&(G[0]=Ji,G[1]=Ji),w[z]=G;const re=N[0]/Math.abs(N[1]);A[z]=[G[0],G[1]/re]}if(t?it(t,S,t):t=S,!n)n=R;else{const P=`Origin mismatch for source ${m}, got [${R}] but expected [${n}]`;Xr(n,R,0,P,this.viewRejector)}if(!o)o=C,this.resolutionFactors_[m]=1;else{o.length-u>C.length&&(u=o.length-C.length);const P=o[o.length-1]/C[C.length-1];this.resolutionFactors_[m]=P;const v=C.map(M=>M*=P),U=`Resolution mismatch for source ${m}, got [${v}] but expected [${o}]`;Xr(o.slice(u,o.length),v,.02,U,this.viewRejector)}i?Xr(i.slice(u,i.length),A,.01,`Tile size mismatch for source ${m}`,this.viewRejector):i=A,s?Xr(s.slice(u,s.length),w,0,`Tile size mismatch for source ${m}`,this.viewRejector):s=w,this.sourceImagery_[m]=y.reverse(),this.sourceMasks_[m]=_.reverse()}for(let m=0,y=this.sourceImagery_.length;m<y;++m){const _=this.sourceImagery_[m];for(;_.length<o.length;)_.unshift(void 0)}this.getProjection()||this.determineProjection(e),this.determineTransformMatrix(e),this.samplesPerPixel_=a,this.nodataValues_=c,this.metadata_=l;e:for(let m=0;m<h;++m){if(this.sourceInfo_[m].nodata!==void 0){this.addAlpha_=!0;break}if(this.sourceMasks_[m].length){this.addAlpha_=!0;break}const y=c[m],_=this.sourceInfo_[m].bands;if(_){for(let E=0;E<_.length;++E)if(y[_[E]-1]!==null){this.addAlpha_=!0;break e}continue}for(let E=0;E<y.length;++E)if(y[E]!==null){this.addAlpha_=!0;break e}}let f=this.addAlpha_?1:0;for(let m=0;m<h;++m)f+=a[m];this.bandCount=f;const d=new Ri({extent:t,minZoom:u,origin:n,resolutions:o,tileSizes:i});this.tileGrid=d,this.setTileSizes(s),this.setLoader(this.loadTile_.bind(this)),this.setState("ready");const p=1;o.length===2?o=[o[0],o[1],o[1]/2]:o.length===1&&(o=[o[0]*2,o[0],o[0]/2]);let g=t;if(this.transformMatrix){const m=on(Ce(),this.transformMatrix.slice()),y=xf(_=>Pt(m,_));g=Tr(t,y)}this.viewResolver({showFullExtent:!0,projection:this.projection,resolutions:o,center:bf(Ut(g),this.projection),extent:Ef(g,this.projection),zoom:p})}loadTile_(e,t,n,i){const s=this.getTileSize(e),o=this.sourceImagery_.length,a=new Array(o*2),c=this.nodataValues_,l=this.sourceInfo_,u=N0();for(let h=0;h<o;++h){const f=l[h],d=this.resolutionFactors_[h],p=[Math.round(t*(s[0]*d)),Math.round(n*(s[1]*d)),Math.round((t+1)*(s[0]*d)),Math.round((n+1)*(s[1]*d))],g=this.sourceImagery_[h][e];let m;f.bands&&(m=f.bands.map(function(R){return R-1}));let y;"nodata"in f&&f.nodata!==null?y=f.nodata:m?y=m.map(function(R){return c[h][R]}):y=c[h];const _={window:p,width:s[0],height:s[1],samples:m,fillValue:y,pool:u,interleave:!1,signal:i.signal};M0(this.convertToRGB_,g)?a[h]=g.readRGB(_):a[h]=g.readRasters(_);const E=o+h,S=this.sourceMasks_[h][e];if(!S){a[E]=Promise.resolve(null);continue}a[E]=S.readRasters({window:p,width:s[0],height:s[1],samples:[0],pool:u,interleave:!1})}return Promise.all(a).then(this.composeTile_.bind(this,s)).catch(function(h){throw an(h),h})}composeTile_(e,t){const n=this.metadata_,i=this.sourceInfo_,s=this.sourceImagery_.length,o=this.bandCount,a=this.samplesPerPixel_,c=this.nodataValues_,l=this.normalize_,u=this.addAlpha_,h=e[0]*e[1],f=h*o;let d;l?d=new Uint8Array(f):d=new Float32Array(f);let p=0;for(let g=0;g<h;++g){let m=u;for(let y=0;y<s;++y){const _=i[y];let E=_.min,S=_.max,R,w;if(l){const A=n[y][0];E===void 0&&(A&&dl in A?E=parseFloat(A[dl]):E=$0(t[y][0])),S===void 0&&(A&&fl in A?S=parseFloat(A[fl]):S=V0(t[y][0])),R=255/(S-E),w=-E*R}for(let A=0;A<a[y];++A){const C=t[y][A][g];let P;if(l?P=Ee(R*C+w,0,255):P=C,!u)d[p]=P;else{let v=_.nodata;if(v===void 0){let M;_.bands?M=_.bands[A]-1:M=A,v=c[y][M]}const U=isNaN(v);(!U&&C!==v||U&&!isNaN(C))&&(m=!1,d[p]=P)}p++}if(!m){const A=s+y,C=t[A];C&&!C[0][g]&&(m=!0)}}u&&(m||(d[p]=255),p++)}return d}}ko.prototype.getView;const X0="https://tile.googleapis.com/v1/createSession",W0="https://tile.googleapis.com/v1/2dtiles",j0="https://tile.googleapis.com/tile/v1/viewport",H0=22;class Z0 extends Ct{constructor(e){const t=!!e.highDpi;super({attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,projection:"EPSG:3857",reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,tilePixelRatio:t?2:1,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.apiKey_=e.key,this.error_=null;const n={mapType:e.mapType||"roadmap",language:e.language||"en-US",region:e.region||"US"};e.imageFormat&&(n.imageFormat=e.imageFormat),e.scale&&(n.scale=e.scale),t&&(n.highDpi=!0),e.layerTypes&&(n.layerTypes=e.layerTypes),e.styles&&(n.styles=e.styles),e.overlay===!0&&(n.overlay=!0),e.apiOptions&&(n.apiOptions=e.apiOptions),this.sessionTokenRequest_=n,this.sessionTokenValue_,this.sessionRefreshId_,this.previousViewportAttribution_,this.previousViewportExtent_,this.createSession_()}getError(){return this.error_}fetchSessionToken(e,t){return fetch(e,t)}async createSession_(){const e=X0+"?key="+this.apiKey_,t={method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.sessionTokenRequest_)},n=await this.fetchSessionToken(e,t);if(!n.ok){try{const h=await n.json();this.error_=new Error(h.error.message)}catch{this.error_=new Error("Error fetching session token")}this.setState("error");return}const i=await n.json(),s=this.getTilePixelRatio(1),o=[i.tileWidth/s,i.tileHeight/s];this.tileGrid=pn({extent:dn(this.getProjection()),maxZoom:H0,tileSize:o});const a=i.session;this.sessionTokenValue_=a;const c=this.apiKey_;this.tileUrlFunction=function(h,f,d){const p=h[0],g=h[1],m=h[2];return`${W0}/${p}/${g}/${m}?session=${a}&key=${c}`};const l=parseInt(i.expiry,10)*1e3,u=Math.max(l-Date.now()-60*1e3,1);this.sessionRefreshId_=setTimeout(()=>this.createSession_(),u),this.setAttributions(this.fetchAttributions_.bind(this)),this.setState("ready")}async fetchAttributions_(e){if(e.viewHints[Bt.ANIMATING]||e.viewHints[Bt.INTERACTING]||e.animate)return this.previousViewportAttribution_;const[t,n]=pa(Nf(e.extent),e.viewState.projection),[i,s]=pa(Df(e.extent),e.viewState.projection),c=`zoom=${this.getTileGrid().getZForResolution(e.viewState.resolution,this.zDirection)}&north=${s}&south=${n}&east=${i}&west=${t}`;if(this.previousViewportExtent_==c)return this.previousViewportAttribution_;this.previousViewportExtent_=c;const l=this.sessionTokenValue_,u=this.apiKey_,h=`${j0}?session=${l}&key=${u}&${c}`;return this.previousViewportAttribution_=await fetch(h).then(f=>f.json()).then(f=>f.copyright),this.previousViewportAttribution_}disposeInternal(){clearTimeout(this.sessionRefreshId_),super.disposeInternal()}}let pu=class extends Bs{constructor(e,t,n,i,s,o,a){super(t,n,i,s,o,a),this.zoomifyImage_=null,this.tileSize_=e}getImage(){if(this.zoomifyImage_)return this.zoomifyImage_;const e=super.getImage();if(this.state==Q.LOADED){const t=this.tileSize_;if(e.width==t[0]&&e.height==t[1])return this.zoomifyImage_=e,e;const n=Gt(t[0],t[1]);return n.drawImage(e,0,0),this.zoomifyImage_=n.canvas,n.canvas}return e}};class Y0 extends Ct{constructor(e){const t=e.size,n=e.tierSizeCalculation!==void 0?e.tierSizeCalculation:"default",i=e.tilePixelRatio||1,s=t[0],o=t[1],a=[],c=e.tileSize||ls;let l=c*i;switch(n){case"default":for(;s>l||o>l;)a.push([Math.ceil(s/l),Math.ceil(o/l)]),l+=l;break;case"truncated":let w=s,A=o;for(;w>l||A>l;)a.push([Math.ceil(w/l),Math.ceil(A/l)]),w>>=1,A>>=1;break;default:throw new Error("Unknown `tierSizeCalculation` configured")}a.push([1,1]),a.reverse();const u=[i],h=[0];for(let w=1,A=a.length;w<A;w++)u.push(i<<w),h.push(a[w-1][0]*a[w-1][1]+h[w-1]);u.reverse();const f=new Ri({tileSize:c,extent:e.extent||[0,-o,s,0],resolutions:u});let d=e.url;d&&!d.includes("{TileGroup}")&&!d.includes("{tileIndex}")&&(d+="{TileGroup}/{z}-{x}-{y}.jpg");const p=Zl(d);let g=c*i;function m(w){return function(A,C,P){if(!A)return;const v=A[0],U=A[1],M=A[2],z=U+M*a[v][0],N=(z+h[v])/g|0,G={z:v,x:U,y:M,tileIndex:z,TileGroup:"TileGroup"+N};return w.replace(/\{(\w+?)\}/g,function(re,X){return G[X]})}}const y=Vs(p.map(m)),_=pu.bind(null,ot(c*i));super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,tilePixelRatio:i,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileClass:_,tileGrid:f,tileUrlFunction:y,transition:e.transition}),this.zDirection=e.zDirection;const E=f.getTileCoordForCoordAndResolution(Ut(f.getExtent()),u[u.length-1]),S=y(E,1,null),R=new Image;R.addEventListener("error",()=>{g=c,this.changed()}),R.src=S}}function Gr(r){return r.toLocaleString("en",{maximumFractionDigits:10})}class q0 extends Ct{constructor(e){const t=e||{};let n=t.url||"";n=n+(n.lastIndexOf("/")===n.length-1||n===""?"":"/");const i=t.version||Re.VERSION2,s=t.sizes||[],o=t.size;Je(o!=null&&Array.isArray(o)&&o.length==2&&!isNaN(o[0])&&o[0]>0&&!isNaN(o[1])&&o[1]>0,"Missing or invalid `size`");const a=o[0],c=o[1],l=t.tileSize,u=t.tilePixelRatio||1,h=t.format||"jpg",f=t.quality||(t.version==Re.VERSION1?"native":"default");let d=t.resolutions||[];const p=t.supports||[],g=t.extent||[0,-c,a,0],m=s!=null&&Array.isArray(s)&&s.length>0,y=l!==void 0&&(typeof l=="number"&&Number.isInteger(l)&&l>0||Array.isArray(l)&&l.length>0),_=p!=null&&Array.isArray(p)&&(p.includes("regionByPx")||p.includes("regionByPct"))&&(p.includes("sizeByWh")||p.includes("sizeByH")||p.includes("sizeByW")||p.includes("sizeByPct"));let E,S,R;if(d.sort(function(P,v){return v-P}),y||_)if(l!=null&&(typeof l=="number"&&Number.isInteger(l)&&l>0?(E=l,S=l):Array.isArray(l)&&l.length>0&&((l.length==1||l[1]==null&&Number.isInteger(l[0]))&&(E=l[0],S=l[0]),l.length==2&&(Number.isInteger(l[0])&&Number.isInteger(l[1])?(E=l[0],S=l[1]):l[0]==null&&Number.isInteger(l[1])&&(E=l[1],S=l[1])))),(E===void 0||S===void 0)&&(E=ls,S=ls),d.length==0){R=Math.max(Math.ceil(Math.log(a/E)/Math.LN2),Math.ceil(Math.log(c/S)/Math.LN2));for(let P=R;P>=0;P--)d.push(Math.pow(2,P))}else{const P=Math.max(...d);R=Math.round(Math.log(P)/Math.LN2)}else if(E=a,S=c,d=[],m){s.sort(function(v,U){return v[0]-U[0]}),R=-1;const P=[];for(let v=0;v<s.length;v++){const U=a/s[v][0];if(d.length>0&&d[d.length-1]==U){P.push(v);continue}d.push(U),R++}if(P.length>0)for(let v=0;v<P.length;v++)s.splice(P[v]-v,1)}else d.push(1),s.push([a,c]),R=0;const w=new Ri({tileSize:[E,S],extent:g,origin:hs(g),resolutions:d}),A=function(P,v,U){let M,z;const N=P[0];if(N>R)return;const G=P[1],re=P[2],X=d[N];if(!(G===void 0||re===void 0||X===void 0||G<0||Math.ceil(a/X/E)<=G||re<0||Math.ceil(c/X/S)<=re)){if(_||y){const q=G*E*X,ne=re*S*X;let se=E*X,ge=S*X,be=E,me=S;if(q+se>a&&(se=a-q),ne+ge>c&&(ge=c-ne),q+E*X>a&&(be=Math.floor((a-q+X-1)/X)),ne+S*X>c&&(me=Math.floor((c-ne+X-1)/X)),q==0&&se==a&&ne==0&&ge==c)M="full";else if(!_||p.includes("regionByPx"))M=q+","+ne+","+se+","+ge;else if(p.includes("regionByPct")){const we=Gr(q/a*100),Le=Gr(ne/c*100),Ae=Gr(se/a*100),Me=Gr(ge/c*100);M="pct:"+we+","+Le+","+Ae+","+Me}i==Re.VERSION3&&(!_||p.includes("sizeByWh"))?z=be+","+me:!_||p.includes("sizeByW")?z=be+",":p.includes("sizeByH")?z=","+me:p.includes("sizeByWh")?z=be+","+me:p.includes("sizeByPct")&&(z="pct:"+Gr(100/X))}else if(M="full",m){const q=s[N][0],ne=s[N][1];i==Re.VERSION3?q==a&&ne==c?z="max":z=q+","+ne:q==a?z="full":z=q+","}else z=i==Re.VERSION3?"max":"full";return n+M+"/"+z+"/0/"+f+"."+h}},C=pu.bind(null,ot(l||256).map(function(P){return P*u}));super({attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,crossOrigin:t.crossOrigin,interpolate:t.interpolate,projection:t.projection,reprojectionErrorThreshold:t.reprojectionErrorThreshold,state:t.state,tileClass:C,tileGrid:w,tilePixelRatio:t.tilePixelRatio,tileUrlFunction:A,transition:t.transition}),this.zDirection=t.zDirection}}function gu(r,e,t,n,i,s){const o=i.getCode().split(/:(?=\d+$)/).pop(),a=t/n,c=[ma(Fe(e)/a,la),ma(at(e)/a,la)];s.SIZE=c[0]+","+c[1],s.BBOX=e.join(","),s.BBOXSR=o,s.IMAGESR=o,s.DPI=Math.round(s.DPI?s.DPI*n:90*n);const l=r.replace(/MapServer\/?$/,"MapServer/export").replace(/ImageServer\/?$/,"ImageServer/exportImage");return ri(l,s)}function mu(r){const e=r.load?r.load:Lr,t=ae(r.projection||"EPSG:3857"),n=r.ratio??1.5,i=r.crossOrigin??null;return function(s,o,a){a=r.hidpi?a:1;const c={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};Object.assign(c,r.params),s=Yl(s,o,a,n);const l=gu(r.url,s,o,a,t,c),u=new Image;return u.crossOrigin=i,e(u,l).then(h=>{const f=Fe(s)/h.width*a;return{image:h,extent:s,resolution:f,pixelRatio:a}})}}class K0 extends tr{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Xs,this.params_=Object.assign({},e.params),this.imageSize_=[0,0],this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,n,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=mu({crossOrigin:this.crossOrigin_,params:this.params_,projection:i,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),Lr(s))})),super.getImageInternal(e,t,n,i))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}class J0 extends tr{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions,state:e.state}),this.canvasFunction_=e.canvasFunction,this.canvas_=null,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5}getImageInternal(e,t,n,i){t=this.findNearestResolution(t);let s=this.canvas_;if(s&&this.renderedRevision_==this.getRevision()&&s.getResolution()==t&&s.getPixelRatio()==n&&ii(s.getExtent(),e))return s;e=e.slice(),sc(e,this.ratio_);const o=Fe(e)/t,a=at(e)/t,c=[o*n,a*n],l=this.canvasFunction_.call(this,e,t,n,c,i);return l&&(s=new ro(e,t,n,l)),this.canvas_=s,this.renderedRevision_=this.getRevision(),s}}function Q0(r,e,t,n){const i=Fe(r),s=at(r),o=e[0],a=e[1],c=.0254/n;return a*i>o*s?i*t/(o*c):s*t/(a*c)}function ex(r,e,t,n,i,s,o){const a=Q0(t,n,s,o),c=Ut(t),l={OPERATION:i?"GETDYNAMICMAPOVERLAYIMAGE":"GETMAPIMAGE",VERSION:"2.0.0",LOCALE:"en",CLIENTAGENT:"ol/source/ImageMapGuide source",CLIP:"1",SETDISPLAYDPI:o,SETDISPLAYWIDTH:Math.round(n[0]),SETDISPLAYHEIGHT:Math.round(n[1]),SETVIEWSCALE:a,SETVIEWCENTERX:c[0],SETVIEWCENTERY:c[1]};return Object.assign(l,e),ri(r,l)}function _u(r){const e=r.load||Lr,t=r.useOverlay??!1,n=r.metersPerUnit||1,i=r.displayDpi||96,s=r.ratio??1,o=r.crossOrigin??null;return function(a,c,l){const u=new Image;u.crossOrigin=o,a=Yl(a,c,l,s);const h=Fe(a)/c,f=at(a)/c,d=[h*l,f*l],p=ex(r.url,r.params,a,d,t,n,i);return e(u,p).then(g=>({image:g,extent:a,pixelRatio:l}))}}class tx extends tr{constructor(e){super({interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.displayDpi_=e.displayDpi!==void 0?e.displayDpi:96,this.params_=Object.assign({},e.params),this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Xs,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.metersPerUnit_=e.metersPerUnit!==void 0?e.metersPerUnit:1,this.ratio_=e.ratio!==void 0?e.ratio:1,this.useOverlay_=e.useOverlay!==void 0?e.useOverlay:!1,this.renderedRevision_=0,this.loaderProjection_=null}getParams(){return this.params_}getImageInternal(e,t,n,i){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==i)&&(this.loaderProjection_=i,this.loader=_u({crossOrigin:this.crossOrigin_,params:this.params_,hidpi:this.hidpi_,metersPerUnit:this.metersPerUnit_,url:this.url_,useOverlay:this.useOverlay_,ratio:this.ratio_,load:(s,o)=>(this.image.setImage(s),this.imageLoadFunction_(this.image,o),Lr(s))})),super.getImageInternal(e,t,n,i))}getImageLoadFunction(){return this.imageLoadFunction_}updateParams(e){Object.assign(this.params_,e),this.changed()}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}changed(){this.image=null,super.changed()}}function yu(r){const e=r.load||Lr,t=r.imageExtent,n=r.crossOrigin??null;return()=>{const i=new Image;return i.crossOrigin=n,e(i,r.url).then(s=>{const o=Fe(t)/s.width,a=at(t)/s.height;return{image:s,extent:t,resolution:o!==a?[o,a]:a,pixelRatio:1}})}}class xu extends tr{constructor(e){const t=e.crossOrigin!==void 0?e.crossOrigin:null,n=e.imageLoadFunction!==void 0?e.imageLoadFunction:Xs;super({attributions:e.attributions,interpolate:e.interpolate,projection:ae(e.projection)}),this.url_=e.url,this.imageExtent_=e.imageExtent,this.image=null,this.image=new zl(this.imageExtent_,void 0,1,yu({url:e.url,imageExtent:e.imageExtent,crossOrigin:t,load:(i,s)=>(this.image.setImage(i),n(this.image,s),Lr(i))})),this.image.addEventListener(ze.CHANGE,this.handleImageChange.bind(this))}getImageExtent(){return this.imageExtent_}getImageInternal(e,t,n,i){return br(e,this.image.getExtent())?this.image:null}getUrl(){return this.url_}}const rx=new Error("Image failed to load");function Eu(r,e,t,n,i){return new Promise((s,o)=>{const a=new Image;a.crossOrigin=i.crossOrigin??null,a.addEventListener("load",()=>s(a)),a.addEventListener("error",()=>o(rx)),a.src=ql(r,e,t,n,i.maxY)})}function pl(r){return function(e,t,n,i){const s=zh(r,e,t,n);return Eu(s,e,t,n,i)}}function nx(r){return function(e,t,n,i){const s=r(e,t,n,i);return Eu(s,e,t,n,i)}}function gl(r){let e;if(Array.isArray(r))e=pl(r);else if(typeof r=="string"){const t=Zl(r);e=pl(t)}else if(typeof r=="function")e=nx(r);else throw new Error("The url option must be a single template, an array of templates, or a function for getting a URL");return e}let ml=0;function _l(r){return Array.isArray(r)?r.join(`
`):typeof r=="string"?r:(++ml,"url-function-key-"+ml)}class bu extends Tn{constructor(e){e=e||{};let t=e.loader,n;e.url&&(t=gl(e.url),n=_l(e.url));const i=t?e.state:"loading",s=e.wrapX===void 0?!0:e.wrapX;super({loader:t,key:n,attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,maxZoom:e.maxZoom,minZoom:e.minZoom,tileSize:e.tileSize,gutter:e.gutter,maxResolution:e.maxResolution,projection:e.projection,tileGrid:e.tileGrid,state:i,wrapX:s,transition:e.transition,interpolate:e.interpolate!==!1,crossOrigin:e.crossOrigin,zDirection:e.zDirection})}setUrl(e){const t=gl(e);this.setLoader(t),this.setKey(_l(e)),this.getState()!=="ready"&&this.setState("ready")}}function $o(r,e,t,n){const i=document.createElement("script"),s="olc_"+de(e);function o(){delete window[s],i.parentNode.removeChild(i)}i.async=!0,i.src=r+(r.includes("?")?"&":"?")+"callback="+s;const a=setTimeout(function(){o(),t&&t()},1e4);window[s]=function(c){clearTimeout(a),o(),e(c)},document.head.appendChild(i)}class ix extends Error{constructor(e){const t="Unexpected response status: "+e.status;super(t),this.name="ResponseError",this.response=e}}class sx extends Error{constructor(e){super("Failed to issue request"),this.name="ClientError",this.client=e}}function Tu(r){return new Promise(function(e,t){function n(o){const a=o.target;if(!a.status||a.status>=200&&a.status<300){let c;try{c=JSON.parse(a.responseText)}catch(l){const u="Error parsing response text as JSON: "+l.message;t(new Error(u));return}e(c);return}t(new ix(a))}function i(o){t(new sx(o.target))}const s=new XMLHttpRequest;s.addEventListener("load",n),s.addEventListener("error",i),s.open("GET",r),s.setRequestHeader("Accept","application/json"),s.send()})}function wu(r,e){return e.includes("://")?e:new URL(e,r).href}const ox={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},ax={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function Su(r,e){if(!e.length)return r;const t=new URL(r,"file:/");if(t.pathname.split("/").includes("collections"))return an('The "collections" query parameter cannot be added to collection endpoints'),r;const n=e.map(o=>encodeURIComponent(o)).join(",");t.searchParams.append("collections",n);const i=r.split("?")[0],s=decodeURIComponent(t.searchParams.toString());return`${i}?${s}`}function lx(r,e,t){let n,i;for(let s=0;s<r.length;++s){const o=r[s];if(o.rel==="item"){if(o.type===e){n=o.href;break}(ox[o.type]||!i&&o.type.startsWith("image/"))&&(i=o.href)}}if(!n)if(i)n=i;else throw new Error('Could not find "item" link');return t&&(n=Su(n,t)),n}function cx(r,e,t,n){let i,s;const o={};for(let a=0;a<r.length;++a){const c=r[a];if(o[c.type]=c.href,c.rel==="item"){if(c.type===e){i=c.href;break}ax[c.type]&&(s=c.href)}}if(!i&&t)for(let a=0;a<t.length;++a){const c=t[a];if(o[c]){i=o[c];break}}if(!i)if(s)i=s;else throw new Error('Could not find "item" link');return n&&(i=Su(i,n)),i}function yl(r,e,t,n){let i=r.projection;if(!i&&(typeof e.crs=="string"?i=ae(e.crs):"uri"in e.crs&&(i=ae(e.crs.uri)),!i))throw new Error(`Unsupported CRS: ${JSON.stringify(e.crs)}`);const s=e.orderedAxes,a=!(s?s.slice(0,2).map(w=>w.replace(/E|X|Lon/i,"e").replace(/N|Y|Lat/i,"n")).join(""):i.getAxisOrientation()).startsWith("en"),c=e.tileMatrices,l={};for(let w=0;w<c.length;++w){const A=c[w];l[A.id]=A}const u={},h=[];if(n)for(let w=0;w<n.length;++w){const A=n[w],C=A.tileMatrix;h.push(C),u[C]=A}else for(let w=0;w<c.length;++w){const A=c[w].id;h.push(A)}const f=h.length,d=new Array(f),p=new Array(f),g=new Array(f),m=new Array(f),y=[-1/0,-1/0,1/0,1/0];for(let w=0;w<f;++w){const A=h[w],C=l[A],P=C.pointOfOrigin;a?d[w]=[P[1],P[0]]:d[w]=P,p[w]=C.cellSize,g[w]=[C.matrixWidth,C.matrixHeight],m[w]=[C.tileWidth,C.tileHeight];const v=u[A];if(v){const U=C.cellSize*C.tileWidth,M=d[w][0]+v.minTileCol*U,z=d[w][0]+(v.maxTileCol+1)*U,N=C.cellSize*C.tileHeight,G=C.cornerOfOrigin==="bottomLeft";let re,X;G?(re=d[w][1]+v.minTileRow*N,X=d[w][1]+(v.maxTileRow+1)*N):(re=d[w][1]-(v.maxTileRow+1)*N,X=d[w][1]-v.minTileRow*N),it(y,[M,re,z,X],y)}}const _=new Ri({origins:d,resolutions:p,sizes:g,tileSizes:m,extent:n?y:void 0}),E=r.context,S=r.url;function R(w,A,C){if(!w)return;const P=h[w[0]],v=l[P],U=v.cornerOfOrigin==="bottomLeft",M={tileMatrix:P,tileCol:w[1],tileRow:U?-w[2]-1:w[2]};if(n){const N=u[v.id];if(M.tileCol<N.minTileCol||M.tileCol>N.maxTileCol||M.tileRow<N.minTileRow||M.tileRow>N.maxTileRow)return}Object.assign(M,E);const z=t.replace(/\{(\w+?)\}/g,function(N,G){return M[G]});return wu(S,z)}return{grid:_,projection:i,urlTemplate:t,urlFunction:R}}function ux(r,e){const t=e.tileMatrixSetLimits;let n;if(e.dataType==="map")n=lx(e.links,r.mediaType,r.collections);else if(e.dataType==="vector")n=cx(e.links,r.mediaType,r.supportedMediaTypes,r.collections);else throw new Error('Expected tileset data type to be "map" or "vector"');if(e.tileMatrixSet)return yl(r,e.tileMatrixSet,n,t);const i=e.links.find(a=>a.rel==="http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme");if(!i)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const s=i.href,o=wu(r.url,s);return Tu(o).then(function(a){return yl(r,a,n,t)})}function Ru(r){return Tu(r.url).then(function(e){return ux(r,e)})}class hx extends Ct{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,context:e.context||null,collections:e.collections};Ru(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.projection=e.projection,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){an(e),this.setState("error")}}class fx extends vi{constructor(e){super({attributions:e.attributions,attributionsCollapsible:e.attributionsCollapsible,cacheSize:e.cacheSize,format:e.format,overlaps:e.overlaps,projection:e.projection,tileClass:e.tileClass,transition:e.transition,wrapX:e.wrapX,zDirection:e.zDirection,state:"loading"});const t={url:e.url,projection:this.getProjection(),mediaType:e.mediaType,supportedMediaTypes:e.format.supportedMediaTypes,context:e.context||null,collections:e.collections};Ru(t).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(e){this.tileGrid=e.grid,this.projection=e.projection,this.setTileUrlFunction(e.urlFunction,e.urlTemplate),this.setState("ready")}handleError_(e){an(e),this.setState("error")}}function vu(r){return function(e){const t=e.buffers,n=e.meta,i=e.imageOps,s=e.width,o=e.height,a=t.length,c=t[0].byteLength;if(i){const f=new Array(a);for(let p=0;p<a;++p)f[p]=new ImageData(new Uint8ClampedArray(t[p]),s,o);return r(f,n).data.buffer}const l=new Uint8ClampedArray(c),u=new Array(a),h=new Array(a);for(let f=0;f<a;++f)u[f]=new Uint8ClampedArray(t[f]),h[f]=[0,0,0,0];for(let f=0;f<c;f+=4){for(let p=0;p<a;++p){const g=u[p];h[p][0]=g[f],h[p][1]=g[f+1],h[p][2]=g[f+2],h[p][3]=g[f+3]}const d=r(h,n);l[f]=d[0],l[f+1]=d[1],l[f+2]=d[2],l[f+3]=d[3]}return l.buffer}}function dx(r,e){const n=Object.keys(r.lib||{}).map(function(s){return"const "+s+" = "+r.lib[s].toString()+";"}).concat(["const __minion__ = ("+vu.toString()+")(",r.operation.toString(),");",'self.addEventListener("message", function(event) {',"  const buffer = __minion__(event.data);","  self.postMessage({buffer: buffer, meta: event.data.meta}, [buffer]);","});"]),i=new Worker(typeof Blob>"u"?"data:text/javascript;base64,"+Buffer.from(n.join(`
`),"binary").toString("base64"):URL.createObjectURL(new Blob(n,{type:"text/javascript"})));return i.addEventListener("message",e),i}function px(r,e){const t=vu(r.operation);let n=!1;return{postMessage:function(i){setTimeout(function(){n||e({data:{buffer:t(i),meta:i.meta}})},0)},terminate:function(){n=!0}}}class gx extends ic{constructor(e){super(),this.imageOps_=!!e.imageOps;let t;e.threads===0?t=0:this.imageOps_?t=1:t=e.threads||1;const n=new Array(t);if(t)for(let i=0;i<t;++i)n[i]=dx(e,this.onWorkerMessage_.bind(this,i));else n[0]=px(e,this.onWorkerMessage_.bind(this,0));this.workers_=n,this.queue_=[],this.maxQueueLength_=e.queue||1/0,this.running_=0,this.dataLookup_={},this.job_=null}process(e,t,n){this.enqueue_({inputs:e,meta:t,callback:n}),this.dispatch_()}enqueue_(e){for(this.queue_.push(e);this.queue_.length>this.maxQueueLength_;)this.queue_.shift().callback(null,null)}dispatch_(){if(this.running_||this.queue_.length===0)return;const e=this.queue_.shift();this.job_=e;const t=e.inputs[0].width,n=e.inputs[0].height,i=e.inputs.map(function(c){return c.data.buffer}),s=this.workers_.length;if(this.running_=s,s===1){this.workers_[0].postMessage({buffers:i,meta:e.meta,imageOps:this.imageOps_,width:t,height:n},i);return}const o=e.inputs[0].data.length,a=4*Math.ceil(o/4/s);for(let c=0;c<s;++c){const l=c*a,u=[];for(let h=0,f=i.length;h<f;++h)u.push(i[h].slice(l,l+a));this.workers_[c].postMessage({buffers:u,meta:e.meta,imageOps:this.imageOps_,width:t,height:n},u)}}onWorkerMessage_(e,t){this.disposed||(this.dataLookup_[e]=t.data,--this.running_,this.running_===0&&this.resolveJob_())}resolveJob_(){const e=this.job_,t=this.workers_.length;let n,i;if(t===1)n=new Uint8ClampedArray(this.dataLookup_[0].buffer),i=this.dataLookup_[0].meta;else{const s=e.inputs[0].data.length;n=new Uint8ClampedArray(s),i=new Array(t);const o=4*Math.ceil(s/4/t);for(let a=0;a<t;++a){const c=this.dataLookup_[a].buffer,l=a*o;n.set(new Uint8ClampedArray(c),l),i[a]=this.dataLookup_[a].meta}}this.job_=null,this.dataLookup_={},e.callback(null,new ImageData(n,e.inputs[0].width,e.inputs[0].height),i),this.dispatch_()}disposeInternal(){for(let e=0;e<this.workers_.length;++e)this.workers_[e].terminate();this.workers_.length=0}}const xl={BEFOREOPERATIONS:"beforeoperations",AFTEROPERATIONS:"afteroperations"};class El extends oc{constructor(e,t,n){super(e),this.extent=t.extent,this.resolution=t.viewState.resolution/t.pixelRatio,this.data=n}}class Au extends tr{constructor(e){super({projection:null}),this.on,this.once,this.un,this.processor_=null,this.operationType_=e.operationType!==void 0?e.operationType:"pixel",this.threads_=e.threads!==void 0?e.threads:1,this.layers_=yx(e.sources);const t=this.changed.bind(this);for(let n=0,i=this.layers_.length;n<i;++n)this.layers_[n].addEventListener(ze.CHANGE,t);this.useResolutions_=e.resolutions!==null,this.tileQueue_=new kh(function(){return 1},this.processSources_.bind(this)),this.requestedFrameState_,this.renderedImageCanvas_=null,this.renderedRevision_,this.frameState_={animate:!1,coordinateToPixelTransform:Ce(),declutter:null,extent:null,index:0,layerIndex:0,layerStatesArray:_x(this.layers_),pixelRatio:1,pixelToCoordinateTransform:Ce(),postRenderFunctions:[],size:[0,0],tileQueue:this.tileQueue_,time:Date.now(),usedTiles:{},viewState:{rotation:0},viewHints:[],wantedTiles:{},mapId:de(this),renderTargets:{}},this.setAttributions(function(n){var s;const i=[];for(let o=0,a=e.sources.length;o<a;++o){const c=e.sources[o],l=c instanceof Ws?c:c.getSource();if(!l)continue;const u=(s=l.getAttributions())==null?void 0:s(n);typeof u=="string"?i.push(u):u!==void 0&&i.push(...u)}return i}),e.operation!==void 0&&this.setOperation(e.operation,e.lib)}setOperation(e,t){this.processor_&&this.processor_.dispose(),this.processor_=new gx({operation:e,imageOps:this.operationType_==="image",queue:1,lib:t,threads:this.threads_}),this.changed()}updateFrameState_(e,t,n){const i=Object.assign({},this.frameState_);i.viewState=Object.assign({},i.viewState);const s=Ut(e);i.size[0]=Math.ceil(Fe(e)/t),i.size[1]=Math.ceil(at(e)/t),i.extent=[s[0]-i.size[0]*t/2,s[1]-i.size[1]*t/2,s[0]+i.size[0]*t/2,s[1]+i.size[1]*t/2],i.time=Date.now();const o=i.viewState;return o.center=s,o.projection=n,o.resolution=t,i}allSourcesReady_(){let e=!0,t;for(let n=0,i=this.layers_.length;n<i;++n)if(t=this.layers_[n].getSource(),!t||t.getState()!=="ready"){e=!1;break}return e}getImage(e,t,n,i){if(!this.allSourcesReady_())return null;this.tileQueue_.loadMoreTiles(16,16),t=this.findNearestResolution(t);const s=this.updateFrameState_(e,t,i);if(this.requestedFrameState_=s,this.renderedImageCanvas_){const o=this.renderedImageCanvas_.getResolution(),a=this.renderedImageCanvas_.getExtent();(t!==o||!ln(s.extent,a))&&(this.renderedImageCanvas_=null)}return(!this.renderedImageCanvas_||this.getRevision()!==this.renderedRevision_)&&this.processSources_(),s.animate&&requestAnimationFrame(this.changed.bind(this)),this.renderedImageCanvas_}processSources_(){const e=this.requestedFrameState_,t=this.layers_.length,n=new Array(t);for(let s=0;s<t;++s){e.layerIndex=s,e.renderTargets={};const o=mx(this.layers_[s],e);if(o)n[s]=o;else return}const i={};this.dispatchEvent(new El(xl.BEFOREOPERATIONS,e,i)),this.processor_.process(n,i,this.onWorkerComplete_.bind(this,e))}onWorkerComplete_(e,t,n,i){if(t||!n)return;const s=e.extent,o=e.viewState.resolution;if(o!==this.requestedFrameState_.viewState.resolution||!ln(s,this.requestedFrameState_.extent))return;let a;if(this.renderedImageCanvas_)a=this.renderedImageCanvas_.getImage().getContext("2d");else{const c=Math.round(Fe(s)/o),l=Math.round(at(s)/o);a=Gt(c,l),this.renderedImageCanvas_=new ro(s,o,1,a.canvas)}a.putImageData(n,0,0),e.animate?requestAnimationFrame(this.changed.bind(this)):this.changed(),this.renderedRevision_=this.getRevision(),this.dispatchEvent(new El(xl.AFTEROPERATIONS,e,i))}getResolutions(e){if(!this.useResolutions_)return null;let t=super.getResolutions();if(!t)for(let n=0,i=this.layers_.length;n<i&&(t=this.layers_[n].getSource().getResolutions(e),!t);++n);return t}disposeInternal(){this.processor_&&this.processor_.dispose(),super.disposeInternal()}}Au.prototype.dispose;let Wt=null;function mx(r,e){const t=r.getRenderer();if(!t)throw new Error("Unsupported layer type: "+r);if(!t.prepareFrame(e))return null;const n=e.size[0],i=e.size[1];if(n===0||i===0)return null;const s=t.renderFrame(e,null);let o;if(s instanceof HTMLCanvasElement)o=s;else{if(s&&(o=s.firstElementChild),!(o instanceof HTMLCanvasElement))throw new Error("Unsupported rendered element: "+o);if(o.width===n&&o.height===i)return o.getContext("2d").getImageData(0,0,n,i)}if(!Wt)Wt=Gt(n,i,void 0,{willReadFrequently:!0});else{const a=Wt.canvas;a.width!==n||a.height!==i?Wt=Gt(n,i,void 0,{willReadFrequently:!0}):Wt.clearRect(0,0,n,i)}return Wt.drawImage(o,0,0,n,i),Wt.getImageData(0,0,n,i)}function _x(r){return r.map(function(e){return e.getLayerState()})}function yx(r){const e=r.length,t=new Array(e);for(let n=0;n<e;++n)t[n]=xx(r[n]);return t}function xx(r){let e;return r instanceof Ws?r instanceof Si?e=new ti({source:r}):r instanceof tr&&(e=new $s({source:r})):e=r,e}const Ex='&copy; <a href="https://www.stadiamaps.com/" target="_blank">Stadia Maps</a>',bx='&copy; <a href="https://openmaptiles.org/" target="_blank">OpenMapTiles</a>',Tx='&copy; <a href="https://stamen.com/" target="_blank">Stamen Design</a>',wx={stamen_terrain:{extension:"png"},stamen_terrain_background:{extension:"png"},stamen_terrain_labels:{extension:"png"},stamen_terrain_lines:{extension:"png"},stamen_toner_background:{extension:"png"},stamen_toner:{extension:"png"},stamen_toner_labels:{extension:"png"},stamen_toner_lines:{extension:"png"},stamen_toner_lite:{extension:"png"},stamen_watercolor:{extension:"jpg"},alidade_smooth:{extension:"png"},alidade_smooth_dark:{extension:"png"},alidade_satellite:{extension:"png"},outdoors:{extension:"png"},osm_bright:{extension:"png"}},Sx={stamen_terrain:{minZoom:0,maxZoom:18,retina:!0},stamen_toner:{minZoom:0,maxZoom:20,retina:!0},stamen_watercolor:{minZoom:1,maxZoom:18,retina:!1}};class Rx extends rn{constructor(e){const t=e.layer.indexOf("-"),n=t==-1?e.layer:e.layer.slice(0,t),i=Sx[n]||{minZoom:0,maxZoom:20,retina:!0},s=wx[e.layer],o=e.apiKey?"?api_key="+e.apiKey:"",a=i.retina&&e.retina?"@2x":"",c=e.url!==void 0?e.url:"https://tiles.stadiamaps.com/tiles/"+e.layer+"/{z}/{x}/{y}"+a+"."+s.extension+o,l=[Ex,bx,$h];e.layer.startsWith("stamen_")&&l.splice(1,0,Tx),super({attributions:l,cacheSize:e.cacheSize,crossOrigin:"anonymous",interpolate:e.interpolate,maxZoom:e.maxZoom!==void 0?e.maxZoom:i.maxZoom,minZoom:e.minZoom!==void 0?e.minZoom:i.minZoom,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileLoadFunction:e.tileLoadFunction,transition:e.transition,url:c,tilePixelRatio:a?2:1,wrapX:e.wrapX,zDirection:e.zDirection})}}class vx extends Ct{constructor(e){e=e||{},super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:e.projection,reprojectionErrorThreshold:e.reprojectionErrorThreshold,tileGrid:e.tileGrid,tileLoadFunction:e.tileLoadFunction,url:e.url,urls:e.urls,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.params_=Object.assign({},e.params),this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.tmpExtent_=mn(),this.setKey(this.getKeyForParams_())}getKeyForParams_(){let e=0;const t=[];for(const n in this.params_)t[e++]=n+"-"+this.params_[n];return t.join("/")}getParams(){return this.params_}getRequestUrl_(e,t,n,i,s,o){const a=this.urls;if(!a)return;let c;if(a.length==1)c=a[0];else{const l=Uf(Vh(e),a.length);c=a[l]}return gu(c,n,(this.tileGrid||this.getTileGridForProjection(s)).getResolution(e[0]),i,s,o)}getTilePixelRatio(e){return this.hidpi_?e:1}updateParams(e){Object.assign(this.params_,e),this.setKey(this.getKeyForParams_())}tileUrlFunction(e,t,n){let i=this.getTileGrid();if(i||(i=this.getTileGridForProjection(n)),i.getResolutions().length<=e[0])return;t!=1&&!this.hidpi_&&(t=1);const s=i.getTileCoordExtent(e,this.tmpExtent_);let o=ot(i.getTileSize(e[0]),this.tmpSize);t!=1&&(o=Xh(o,t,this.tmpSize));const a={F:"image",FORMAT:"PNG32",TRANSPARENT:!0};return Object.assign(a,this.params_),this.getRequestUrl_(e,o,s,t,n,a)}}class Ax extends bu{constructor(e){e=e||{};const t=e.template||"z:{z} x:{x} y:{y}",n=e.source;super({transition:0,wrapX:e.wrapX!==void 0?e.wrapX:n!==void 0?n.getWrapX():void 0});const i=()=>{var o;this.projection=e.projection!==void 0?ae(e.projection):n!==void 0?n.getProjection():this.projection,this.tileGrid=e.tileGrid!==void 0?e.tileGrid:n!==void 0?n.getTileGrid():this.tileGrid,this.zDirection=e.zDirection!==void 0?e.zDirection:n!==void 0?n.zDirection:this.zDirection,n instanceof Tn&&(this.transformMatrix=((o=n.transformMatrix)==null?void 0:o.slice())||null);const s=this.tileGrid;s&&this.setTileSizes(s.getResolutions().map((a,c)=>ot(s.getTileSize(c)).map(l=>Math.max(Math.floor(l),1)))),this.setLoader((a,c,l,u)=>{const h=ql(t,a,c,l,u.maxY),[f,d]=this.getTileSize(a),p=Gt(f,d);return p.strokeStyle="grey",p.strokeRect(.5,.5,f+.5,d+.5),p.fillStyle="grey",p.strokeStyle="white",p.textAlign="center",p.textBaseline="middle",p.font="24px sans-serif",p.lineWidth=4,p.strokeText(h,f/2,d/2,f),p.fillText(h,f/2,d/2,f),p.canvas}),this.setState("ready")};if(n===void 0||n.getState()==="ready")i();else{const s=()=>{n.getState()==="ready"&&(n.removeEventListener(ze.CHANGE,s),i())};n.addEventListener(ze.CHANGE,s)}}}class Pu extends Ct{constructor(e){if(super({attributions:e.attributions,cacheSize:e.cacheSize,crossOrigin:e.crossOrigin,interpolate:e.interpolate,projection:ae("EPSG:3857"),reprojectionErrorThreshold:e.reprojectionErrorThreshold,state:"loading",tileLoadFunction:e.tileLoadFunction,wrapX:e.wrapX!==void 0?e.wrapX:!0,transition:e.transition,zDirection:e.zDirection}),this.tileJSON_=null,this.tileSize_=e.tileSize,e.url)if(e.jsonp)$o(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let n;try{n=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(e){const t=ae("EPSG:4326"),n=this.getProjection();let i;if(e.bounds!==void 0){const l=Ks(t,n);i=Tr(e.bounds,l)}const s=dn(n),o=e.minzoom||0,a=e.maxzoom||22,c=pn({extent:s,maxZoom:a,minZoom:o,tileSize:this.tileSize_});if(this.tileGrid=c,this.tileUrlFunction=Kl(e.tiles,c),e.attribution&&!this.getAttributions()){const l=i!==void 0?i:s;this.setAttributions(function(u){return br(l,u.extent)?[e.attribution]:null})}this.tileJSON_=e,this.setState("ready")}handleTileJSONError(){this.setState("error")}}class Px extends jh{constructor(e,t,n,i,s,o){super(e,t),this.src_=n,this.extent_=i,this.preemptive_=s,this.grid_=null,this.keys_=null,this.data_=null,this.jsonp_=o}getImage(){return null}getData(e){if(!this.grid_||!this.keys_)return null;const t=(e[0]-this.extent_[0])/(this.extent_[2]-this.extent_[0]),n=(e[1]-this.extent_[1])/(this.extent_[3]-this.extent_[1]),i=this.grid_[Math.floor((1-n)*this.grid_.length)];if(typeof i!="string")return null;let s=i.charCodeAt(Math.floor(t*i.length));s>=93&&s--,s>=35&&s--,s-=32;let o=null;if(s in this.keys_){const a=this.keys_[s];this.data_&&a in this.data_?o=this.data_[a]:o=a}return o}forDataAtCoordinate(e,t,n){this.state==Q.EMPTY&&n===!0?(this.state=Q.IDLE,Bf(this,ze.CHANGE,i=>{t(this.getData(e))}),this.loadInternal_()):n===!0?setTimeout(()=>{t(this.getData(e))},0):t(this.getData(e))}getKey(){return this.src_}handleError_(){this.state=Q.ERROR,this.changed()}handleLoad_(e){this.grid_=e.grid,this.keys_=e.keys,this.data_=e.data,this.state=Q.LOADED,this.changed()}loadInternal_(){if(this.state==Q.IDLE)if(this.state=Q.LOADING,this.jsonp_)$o(this.src_,this.handleLoad_.bind(this),this.handleError_.bind(this));else{const e=new XMLHttpRequest;e.addEventListener("load",this.onXHRLoad_.bind(this)),e.addEventListener("error",this.onXHRError_.bind(this)),e.open("GET",this.src_),e.send()}}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let n;try{n=JSON.parse(t.responseText)}catch{this.handleError_();return}this.handleLoad_(n)}else this.handleError_()}onXHRError_(e){this.handleError_()}load(){this.preemptive_?this.loadInternal_():this.setState(Q.EMPTY)}}class Lx extends Si{constructor(e){if(super({projection:ae("EPSG:3857"),state:"loading",wrapX:e.wrapX!==void 0?e.wrapX:!0,zDirection:e.zDirection}),this.preemptive_=e.preemptive!==void 0?e.preemptive:!0,this.tileUrlFunction_=Wh,this.template_=void 0,this.jsonp_=e.jsonp||!1,e.url)if(this.jsonp_)$o(e.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const t=new XMLHttpRequest;t.addEventListener("load",this.onXHRLoad_.bind(this)),t.addEventListener("error",this.onXHRError_.bind(this)),t.open("GET",e.url),t.send()}else if(e.tileJSON)this.handleTileJSONResponse(e.tileJSON);else throw new Error("Either `url` or `tileJSON` options must be provided")}onXHRLoad_(e){const t=e.target;if(!t.status||t.status>=200&&t.status<300){let n;try{n=JSON.parse(t.responseText)}catch{this.handleTileJSONError();return}this.handleTileJSONResponse(n)}else this.handleTileJSONError()}onXHRError_(e){this.handleTileJSONError()}getTemplate(){return this.template_}forDataAtCoordinateAndResolution(e,t,n,i){if(this.tileGrid){const s=this.tileGrid.getZForResolution(t,this.zDirection),o=this.tileGrid.getTileCoordForCoordAndZ(e,s);this.getTile(o[0],o[1],o[2],1,this.getProjection()).forDataAtCoordinate(e,n,i)}else i===!0?setTimeout(function(){n(null)},0):n(null)}handleTileJSONError(){this.setState("error")}handleTileJSONResponse(e){const t=ae("EPSG:4326"),n=this.getProjection();let i;if(e.bounds!==void 0){const u=Ks(t,n);i=Tr(e.bounds,u)}const s=dn(n),o=e.minzoom||0,a=e.maxzoom||22,c=pn({extent:s,maxZoom:a,minZoom:o});this.tileGrid=c,this.template_=e.template;const l=e.grids;if(!l){this.setState("error");return}if(this.tileUrlFunction_=Kl(l,c),e.attribution){const u=i!==void 0?i:s;this.setAttributions(function(h){return br(u,h.extent)?[e.attribution]:null})}this.setState("ready")}getTile(e,t,n,i,s){const o=[e,t,n],a=this.getTileCoordForTileUrlFunction(o,s),c=this.tileUrlFunction_(a,i,s);return new Px(o,c!==void 0?Q.IDLE:Q.EMPTY,c!==void 0?c:"",this.tileGrid.getTileCoordExtent(o),this.preemptive_,this.jsonp_)}}function Ix(r,e){const t=new Xl(32),n=r.getExtent();return function(i,s){t.expireCache(),n&&(i=it(n,i));const o=r.getZForResolution(s),a=[];return r.forEachTileCoord(i,o,c=>{const l=c.toString();if(!t.containsKey(l)){const u=e(c);t.set(l,u)}a.push(t.get(l))}),a}}const Cx=Object.freeze(Object.defineProperty({__proto__:null,BingMaps:V_,CartoDB:X_,Cluster:W_,DataTile:Tn,GeoTIFF:ko,Google:Z0,IIIF:q0,Image:tr,ImageArcGISRest:K0,ImageCanvas:J0,ImageMapGuide:tx,ImageStatic:xu,ImageTile:bu,ImageWMS:Hh,OGCMapTile:hx,OGCVectorTile:fx,OSM:Zh,Raster:Au,Source:Ws,StadiaMaps:Rx,Tile:Si,TileArcGISRest:vx,TileDebug:Ax,TileImage:Ct,TileJSON:Pu,TileWMS:Jl,UTFGrid:Lx,UrlTile:Yh,Vector:fn,VectorTile:vi,WMTS:Ql,XYZ:rn,Zoomify:Y0,createArcGISRestLoader:mu,createMapGuideLoader:_u,createStaticLoader:yu,createWMSLoader:qh,sourcesFromTileGrid:Ix},Symbol.toStringTag,{value:"Module"}));window.eoxMapAdvancedOlFormats=Bm;var Ge=(r,e,t)=>new Promise((n,i)=>{var s=c=>{try{a(t.next(c))}catch(l){i(l)}},o=c=>{try{a(t.throw(c))}catch(l){i(l)}},a=c=>c.done?n(c.value):Promise.resolve(c.value).then(s,o);a((t=t.apply(r,e)).next())}),Ze=Uint8Array,qr=Uint16Array,Fx=Int32Array,Lu=new Ze([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Iu=new Ze([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),Ox=new Ze([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Cu=function(r,e){for(var t=new qr(31),n=0;n<31;++n)t[n]=e+=1<<r[n-1];for(var i=new Fx(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)i[s]=s-t[n]<<5|n;return{b:t,r:i}},Fu=Cu(Lu,2),Ou=Fu.b,Mx=Fu.r;Ou[28]=258,Mx[258]=28;var Nx=Cu(Iu,0),Dx=Nx.b,Mu=new qr(32768);for(he=0;he<32768;++he)Tt=(he&43690)>>1|(he&21845)<<1,Tt=(Tt&52428)>>2|(Tt&13107)<<2,Tt=(Tt&61680)>>4|(Tt&3855)<<4,Mu[he]=((Tt&65280)>>8|(Tt&255)<<8)>>1;var Tt,he,Kr=function(r,e,t){for(var n=r.length,i=0,s=new qr(e);i<n;++i)r[i]&&++s[r[i]-1];var o=new qr(e);for(i=1;i<e;++i)o[i]=o[i-1]+s[i-1]<<1;var a;{a=new qr(1<<e);var c=15-e;for(i=0;i<n;++i)if(r[i])for(var l=i<<4|r[i],u=e-r[i],h=o[r[i]-1]++<<u,f=h|(1<<u)-1;h<=f;++h)a[Mu[h]>>c]=l}return a},Sn=new Ze(288);for(he=0;he<144;++he)Sn[he]=8;var he;for(he=144;he<256;++he)Sn[he]=9;var he;for(he=256;he<280;++he)Sn[he]=7;var he;for(he=280;he<288;++he)Sn[he]=8;var he,Nu=new Ze(32);for(he=0;he<32;++he)Nu[he]=5;var he,Ux=Kr(Sn,9),Bx=Kr(Nu,5),es=function(r){for(var e=r[0],t=1;t<r.length;++t)r[t]>e&&(e=r[t]);return e},et=function(r,e,t){var n=e/8|0;return(r[n]|r[n+1]<<8)>>(e&7)&t},ts=function(r,e){var t=e/8|0;return(r[t]|r[t+1]<<8|r[t+2]<<16)>>(e&7)},Gx=function(r){return(r+7)/8|0},zx=function(r,e,t){(t==null||t>r.length)&&(t=r.length);var n=new Ze(t-e);return n.set(r.subarray(e,t)),n},kx=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],He=function(r,e,t){var n=new Error(e||kx[r]);if(n.code=r,Error.captureStackTrace&&Error.captureStackTrace(n,He),!t)throw n;return n},Vo=function(r,e,t,n){var i=r.length,s=0;if(!i||e.f&&!e.l)return t||new Ze(0);var o=!t||e.i!=2,a=e.i;t||(t=new Ze(i*3));var c=function(bt){var In=t.length;if(bt>In){var Cn=new Ze(Math.max(In*2,bt));Cn.set(t),t=Cn}},l=e.f||0,u=e.p||0,h=e.b||0,f=e.l,d=e.d,p=e.m,g=e.n,m=i*8;do{if(!f){l=et(r,u,1);var y=et(r,u+1,3);if(u+=3,y)if(y==1)f=Ux,d=Bx,p=9,g=5;else if(y==2){var R=et(r,u,31)+257,w=et(r,u+10,15)+4,A=R+et(r,u+5,31)+1;u+=14;for(var C=new Ze(A),P=new Ze(19),v=0;v<w;++v)P[Ox[v]]=et(r,u+v*3,7);u+=w*3;for(var U=es(P),M=(1<<U)-1,z=Kr(P,U),v=0;v<A;){var N=z[et(r,u,M)];u+=N&15;var _=N>>4;if(_<16)C[v++]=_;else{var G=0,re=0;for(_==16?(re=3+et(r,u,3),u+=2,G=C[v-1]):_==17?(re=3+et(r,u,7),u+=3):_==18&&(re=11+et(r,u,127),u+=7);re--;)C[v++]=G}}var X=C.subarray(0,R),q=C.subarray(R);p=es(X),g=es(q),f=Kr(X,p),d=Kr(q,g)}else He(1);else{var _=Gx(u)+4,E=r[_-4]|r[_-3]<<8,S=_+E;if(S>i){a&&He(0);break}o&&c(h+E),t.set(r.subarray(_,S),h),e.b=h+=E,e.p=u=S*8,e.f=l;continue}if(u>m){a&&He(0);break}}o&&c(h+131072);for(var ne=(1<<p)-1,se=(1<<g)-1,ge=u;;ge=u){var G=f[ts(r,u)&ne],be=G>>4;if(u+=G&15,u>m){a&&He(0);break}if(G||He(2),be<256)t[h++]=be;else if(be==256){ge=u,f=null;break}else{var me=be-254;if(be>264){var v=be-257,we=Lu[v];me=et(r,u,(1<<we)-1)+Ou[v],u+=we}var Le=d[ts(r,u)&se],Ae=Le>>4;Le||He(3),u+=Le&15;var q=Dx[Ae];if(Ae>3){var we=Iu[Ae];q+=ts(r,u)&(1<<we)-1,u+=we}if(u>m){a&&He(0);break}o&&c(h+131072);var Me=h+me;if(h<q){var nr=s-q,ir=Math.min(q,Me);for(nr+h<0&&He(3);h<ir;++h)t[h]=n[nr+h]}for(;h<Me;h+=4)t[h]=t[h-q],t[h+1]=t[h+1-q],t[h+2]=t[h+2-q],t[h+3]=t[h+3-q];h=Me}}e.l=f,e.p=ge,e.b=h,e.f=l,f&&(l=1,e.m=p,e.d=d,e.n=g)}while(!l);return h==t.length?t:zx(t,0,h)},$x=new Ze(0),Vx=function(r){(r[0]!=31||r[1]!=139||r[2]!=8)&&He(6,"invalid gzip data");var e=r[3],t=10;e&4&&(t+=(r[10]|r[11]<<8)+2);for(var n=(e>>3&1)+(e>>4&1);n>0;n-=!r[t++]);return t+(e&2)},Xx=function(r){var e=r.length;return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0},Wx=function(r,e){return((r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31)&&He(6,"invalid zlib data"),(r[1]>>5&1)==1&&He(6,"invalid zlib data: "+(r[1]&32?"need":"unexpected")+" dictionary"),(r[1]>>3&4)+2};function jx(r,e){return Vo(r,{i:2},e,e)}function Hx(r,e){var t=Vx(r);return t+8>r.length&&He(6,"invalid gzip data"),Vo(r.subarray(t,-8),{i:2},new Ze(Xx(r)),e)}function Zx(r,e){return Vo(r.subarray(Wx(r),-4),{i:2},e,e)}function As(r,e){return r[0]==31&&r[1]==139&&r[2]==8?Hx(r,e):(r[0]&15)!=8||r[0]>>4>7||(r[0]<<8|r[1])%31?jx(r,e):Zx(r,e)}var Yx=typeof TextDecoder<"u"&&new TextDecoder,qx=0;try{Yx.decode($x,{stream:!0}),qx=1}catch{}var Du=(r,e)=>r*Math.pow(2,e),zr=(r,e)=>Math.floor(r/Math.pow(2,e)),pi=(r,e)=>Du(r.getUint16(e+1,!0),8)+r.getUint8(e),Uu=(r,e)=>Du(r.getUint32(e+2,!0),16)+r.getUint16(e,!0),Kx=(r,e,t,n,i)=>{if(r!=n.getUint8(i))return r-n.getUint8(i);const s=pi(n,i+1);if(e!=s)return e-s;const o=pi(n,i+4);return t!=o?t-o:0},Jx=(r,e,t,n)=>{const i=Bu(r,e|128,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],is_dir:!0}:null},bl=(r,e,t,n)=>{const i=Bu(r,e,t,n);return i?{z:e,x:t,y:n,offset:i[0],length:i[1],is_dir:!1}:null},Bu=(r,e,t,n)=>{let i=0,s=r.byteLength/17-1;for(;i<=s;){const o=s+i>>1,a=Kx(e,t,n,r,o*17);if(a>0)i=o+1;else if(a<0)s=o-1;else return[Uu(r,o*17+7),r.getUint32(o*17+13,!0)]}return null},Qx=(r,e)=>r.is_dir&&!e.is_dir?1:!r.is_dir&&e.is_dir?-1:r.z!==e.z?r.z-e.z:r.x!==e.x?r.x-e.x:r.y-e.y,Gu=(r,e)=>{const t=r.getUint8(e*17);return{z:t&127,x:pi(r,e*17+1),y:pi(r,e*17+4),offset:Uu(r,e*17+7),length:r.getUint32(e*17+13,!0),is_dir:t>>7===1}},Tl=r=>{const e=[],t=new DataView(r);for(let n=0;n<t.byteLength/17;n++)e.push(Gu(t,n));return eE(e)},eE=r=>{r.sort(Qx);const e=new ArrayBuffer(17*r.length),t=new Uint8Array(e);for(let n=0;n<r.length;n++){const i=r[n];let s=i.z;i.is_dir&&(s=s|128),t[n*17]=s,t[n*17+1]=i.x&255,t[n*17+2]=i.x>>8&255,t[n*17+3]=i.x>>16&255,t[n*17+4]=i.y&255,t[n*17+5]=i.y>>8&255,t[n*17+6]=i.y>>16&255,t[n*17+7]=i.offset&255,t[n*17+8]=zr(i.offset,8)&255,t[n*17+9]=zr(i.offset,16)&255,t[n*17+10]=zr(i.offset,24)&255,t[n*17+11]=zr(i.offset,32)&255,t[n*17+12]=zr(i.offset,48)&255,t[n*17+13]=i.length&255,t[n*17+14]=i.length>>8&255,t[n*17+15]=i.length>>16&255,t[n*17+16]=i.length>>24&255}return e},tE=(r,e)=>{if(r.byteLength<17)return null;const t=r.byteLength/17,n=Gu(r,t-1);if(n.is_dir){const i=n.z,s=e.z-i,o=Math.trunc(e.x/(1<<s)),a=Math.trunc(e.y/(1<<s));return{z:i,x:o,y:a}}return null};function rE(r){return Ge(this,null,function*(){const e=yield r.getBytes(0,512e3),t=new DataView(e.data),n=t.getUint32(4,!0),i=t.getUint16(8,!0),s=new TextDecoder("utf-8"),o=JSON.parse(s.decode(new DataView(e.data,10,n)));let a=0;o.compression==="gzip"&&(a=2);let c=0;"minzoom"in o&&(c=+o.minzoom);let l=0;"maxzoom"in o&&(l=+o.maxzoom);let u=0,h=0,f=0,d=-180,p=-85,g=180,m=85;if(o.bounds){const _=o.bounds.split(",");d=+_[0],p=+_[1],g=+_[2],m=+_[3]}if(o.center){const _=o.center.split(",");u=+_[0],h=+_[1],f=+_[2]}return{specVersion:t.getUint16(2,!0),rootDirectoryOffset:10+n,rootDirectoryLength:i*17,jsonMetadataOffset:10,jsonMetadataLength:n,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:a,tileType:1,minZoom:c,maxZoom:l,minLon:d,minLat:p,maxLon:g,maxLat:m,centerZoom:f,centerLon:u,centerLat:h,etag:e.etag}})}function nE(r,e,t,n,i,s,o){return Ge(this,null,function*(){let a=yield t.getArrayBuffer(e,r.rootDirectoryOffset,r.rootDirectoryLength,r);r.specVersion===1&&(a=Tl(a));const c=bl(new DataView(a),n,i,s);if(c){let h=(yield e.getBytes(c.offset,c.length,o)).data;const f=new DataView(h);return f.getUint8(0)==31&&f.getUint8(1)==139&&(h=As(new Uint8Array(h))),{data:h}}const l=tE(new DataView(a),{z:n,x:i,y:s});if(l){const u=Jx(new DataView(a),l.z,l.x,l.y);if(u){let h=yield t.getArrayBuffer(e,u.offset,u.length,r);r.specVersion===1&&(h=Tl(h));const f=bl(new DataView(h),n,i,s);if(f){let p=(yield e.getBytes(f.offset,f.length,o)).data;const g=new DataView(p);return g.getUint8(0)==31&&g.getUint8(1)==139&&(p=As(new Uint8Array(p))),{data:p}}}}})}var zu={getHeader:rE,getZxy:nE};function ur(r,e){return(e>>>0)*4294967296+(r>>>0)}function iE(r,e){const t=e.buf;let n,i;if(i=t[e.pos++],n=(i&112)>>4,i<128||(i=t[e.pos++],n|=(i&127)<<3,i<128)||(i=t[e.pos++],n|=(i&127)<<10,i<128)||(i=t[e.pos++],n|=(i&127)<<17,i<128)||(i=t[e.pos++],n|=(i&127)<<24,i<128)||(i=t[e.pos++],n|=(i&1)<<31,i<128))return ur(r,n);throw new Error("Expected varint not more than 10 bytes")}function kr(r){const e=r.buf;let t,n;return n=e[r.pos++],t=n&127,n<128||(n=e[r.pos++],t|=(n&127)<<7,n<128)||(n=e[r.pos++],t|=(n&127)<<14,n<128)||(n=e[r.pos++],t|=(n&127)<<21,n<128)?t:(n=e[r.pos],t|=(n&15)<<28,iE(t,r))}function sE(r,e,t,n){if(n==0){t==1&&(e[0]=r-1-e[0],e[1]=r-1-e[1]);const i=e[0];e[0]=e[1],e[1]=i}}var oE=[0,1,5,21,85,341,1365,5461,21845,87381,349525,1398101,5592405,22369621,89478485,357913941,1431655765,5726623061,22906492245,91625968981,366503875925,1466015503701,5864062014805,23456248059221,93824992236885,375299968947541,0x5555555555555];function aE(r,e,t){if(r>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,r)-1||t>Math.pow(2,r)-1)throw Error("tile x/y outside zoom level bounds");const n=oE[r],i=Math.pow(2,r);let s=0,o=0,a=0;const c=[e,t];let l=i/2;for(;l>0;)s=(c[0]&l)>0?1:0,o=(c[1]&l)>0?1:0,a+=l*l*(3*s^o),sE(l,c,s,o),l=l/2;return n+a}function ku(r,e){return Ge(this,null,function*(){if(e===1||e===0)return r;if(e===2){if(typeof globalThis.DecompressionStream>"u")return As(new Uint8Array(r));{let n=new Response(r).body.pipeThrough(new globalThis.DecompressionStream("gzip"));return new Response(n).arrayBuffer()}}else throw Error("Compression method not supported")})}var dr=(r=>(r[r.Unknown=0]="Unknown",r[r.Mvt=1]="Mvt",r[r.Png=2]="Png",r[r.Jpeg=3]="Jpeg",r[r.Webp=4]="Webp",r[r.Avif=5]="Avif",r))(dr||{}),lE=127;function cE(r,e){let t=0,n=r.length-1;for(;t<=n;){const i=n+t>>1,s=e-r[i].tileId;if(s>0)t=i+1;else if(s<0)n=i-1;else return r[i]}return n>=0&&(r[n].runLength===0||e-r[n].tileId<r[n].runLength)?r[n]:null}var uE=class{constructor(r,e=new Headers){this.url=r,this.customHeaders=e}getKey(){return this.url}setHeaders(r){this.customHeaders=r}getBytes(r,e,t){return Ge(this,null,function*(){let n;t||(n=new AbortController,t=n.signal);const i=new Headers(this.customHeaders);i.set("Range","bytes="+r+"-"+(r+e-1));let s=yield fetch(this.url,{signal:t,headers:i});if(s.status===416&&r===0){const c=s.headers.get("Content-Range");if(!c||!c.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const l=+c.substr(8);s=yield fetch(this.url,{signal:t,headers:{Range:"bytes=0-"+(l-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const o=s.headers.get("Content-Length");if(s.status===200&&(!o||+o>e))throw n&&n.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function tt(r,e){const t=r.getUint32(e+4,!0),n=r.getUint32(e+0,!0);return t*Math.pow(2,32)+n}function hE(r,e){const t=new DataView(r),n=t.getUint8(7);if(n>3)throw Error(`Archive is spec version ${n} but this library supports up to spec version 3`);return{specVersion:n,rootDirectoryOffset:tt(t,8),rootDirectoryLength:tt(t,16),jsonMetadataOffset:tt(t,24),jsonMetadataLength:tt(t,32),leafDirectoryOffset:tt(t,40),leafDirectoryLength:tt(t,48),tileDataOffset:tt(t,56),tileDataLength:tt(t,64),numAddressedTiles:tt(t,72),numTileEntries:tt(t,80),numTileContents:tt(t,88),clustered:t.getUint8(96)===1,internalCompression:t.getUint8(97),tileCompression:t.getUint8(98),tileType:t.getUint8(99),minZoom:t.getUint8(100),maxZoom:t.getUint8(101),minLon:t.getInt32(102,!0)/1e7,minLat:t.getInt32(106,!0)/1e7,maxLon:t.getInt32(110,!0)/1e7,maxLat:t.getInt32(114,!0)/1e7,centerZoom:t.getUint8(118),centerLon:t.getInt32(119,!0)/1e7,centerLat:t.getInt32(123,!0)/1e7,etag:e}}function $u(r){const e={buf:new Uint8Array(r),pos:0},t=kr(e),n=[];let i=0;for(let s=0;s<t;s++){const o=kr(e);n.push({tileId:i+o,offset:0,length:0,runLength:1}),i+=o}for(let s=0;s<t;s++)n[s].runLength=kr(e);for(let s=0;s<t;s++)n[s].length=kr(e);for(let s=0;s<t;s++){const o=kr(e);o===0&&s>0?n[s].offset=n[s-1].offset+n[s-1].length:n[s].offset=o-1}return n}function fE(r){const e=new DataView(r);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var _r=class extends Error{};function dE(r,e,t,n){return Ge(this,null,function*(){const i=yield r.getBytes(0,16384);if(new DataView(i.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(fE(i.data)<3)return[yield zu.getHeader(r)];const o=i.data.slice(0,lE);let a=i.etag;n&&i.etag!=n&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+r.getKey()),a=void 0);const c=hE(o,a);if(t){const l=i.data.slice(c.rootDirectoryOffset,c.rootDirectoryOffset+c.rootDirectoryLength),u=r.getKey()+"|"+(c.etag||"")+"|"+c.rootDirectoryOffset+"|"+c.rootDirectoryLength,h=$u(yield e(l,c.internalCompression));return[c,[u,h.length,h]]}return[c,void 0]})}function pE(r,e,t,n,i){return Ge(this,null,function*(){const s=yield r.getBytes(t,n);if(i.etag&&i.etag!==s.etag)throw new _r(s.etag);const o=yield e(s.data,i.internalCompression),a=$u(o);if(a.length===0)throw new Error("Empty directory is invalid");return a})}var gE=class{constructor(r=100,e=!0,t=ku){this.cache=new Map,this.maxCacheEntries=r,this.counter=1,this.prefetch=e,this.decompress=t}getHeader(r,e){return Ge(this,null,function*(){const t=r.getKey();if(this.cache.has(t))return this.cache.get(t).lastUsed=this.counter++,yield this.cache.get(t).data;const n=new Promise((i,s)=>{dE(r,this.decompress,this.prefetch,e).then(o=>{o[1]&&this.cache.set(o[1][0],{lastUsed:this.counter++,data:Promise.resolve(o[1][2])}),i(o[0]),this.prune()}).catch(o=>{s(o)})});return this.cache.set(t,{lastUsed:this.counter++,data:n}),n})}getDirectory(r,e,t,n){return Ge(this,null,function*(){const i=r.getKey()+"|"+(n.etag||"")+"|"+e+"|"+t;if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;const s=new Promise((o,a)=>{pE(r,this.decompress,e,t,n).then(c=>{o(c),this.prune()}).catch(c=>{a(c)})});return this.cache.set(i,{lastUsed:this.counter++,data:s}),s})}getArrayBuffer(r,e,t,n){return Ge(this,null,function*(){const i=r.getKey()+"|"+(n.etag||"")+"|"+e+"|"+t;if(this.cache.has(i))return this.cache.get(i).lastUsed=this.counter++,yield this.cache.get(i).data;const s=new Promise((o,a)=>{r.getBytes(e,t).then(c=>{if(n.etag&&n.etag!==c.etag)throw new _r(c.etag);o(c.data),this.cache.has(i),this.prune()}).catch(c=>{a(c)})});return this.cache.set(i,{lastUsed:this.counter++,data:s}),s})}prune(){if(this.cache.size>=this.maxCacheEntries){let r=1/0,e;this.cache.forEach((t,n)=>{t.lastUsed<r&&(r=t.lastUsed,e=n)}),e&&this.cache.delete(e)}}invalidate(r,e){return Ge(this,null,function*(){this.cache.delete(r.getKey()),yield this.getHeader(r,e)})}},Xo=class{constructor(r,e,t){typeof r=="string"?this.source=new uE(r):this.source=r,t?this.decompress=t:this.decompress=ku,e?this.cache=e:this.cache=new gE}getHeader(){return Ge(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(r,e,t,n){return Ge(this,null,function*(){const i=aE(r,e,t),s=yield this.cache.getHeader(this.source);if(s.specVersion<3)return zu.getZxy(s,this.source,this.cache,r,e,t,n);if(r<s.minZoom||r>s.maxZoom)return;let o=s.rootDirectoryOffset,a=s.rootDirectoryLength;for(let c=0;c<=3;c++){const l=yield this.cache.getDirectory(this.source,o,a,s),u=cE(l,i);if(u)if(u.runLength>0){const h=yield this.source.getBytes(s.tileDataOffset+u.offset,u.length,n);if(s.etag&&s.etag!==h.etag)throw new _r(h.etag);return{data:yield this.decompress(h.data,s.tileCompression),cacheControl:h.cacheControl,expires:h.expires}}else o=s.leafDirectoryOffset+u.offset,a=u.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(r,e,t,n){return Ge(this,null,function*(){try{return yield this.getZxyAttempt(r,e,t,n)}catch(i){if(i instanceof _r)return this.cache.invalidate(this.source,i.message),yield this.getZxyAttempt(r,e,t,n);throw i}})}getMetadataAttempt(){return Ge(this,null,function*(){const r=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(r.jsonMetadataOffset,r.jsonMetadataLength);if(r.etag&&r.etag!==e.etag)throw new _r(e.etag);const t=yield this.decompress(e.data,r.internalCompression),n=new TextDecoder("utf-8");return JSON.parse(n.decode(t))})}getMetadata(){return Ge(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(r){if(r instanceof _r)return this.cache.invalidate(this.source,r.message),yield this.getMetadataAttempt();throw r}})}};class mE extends oc{constructor(e){super(ze.ERROR),this.error=e}}class ye{constructor(e){this.name=e}toString(){return this.name}}ye.GeoTIFF=new ye("GeoTIFF");ye.ImageStatic=new ye("ImageStatic");ye.PMTilesRaster=new ye("PMTilesRaster");ye.PMTilesVector=new ye("PMTilesVector");ye.TileJSON=new ye("TileJSON");ye.TileWMS=new ye("TileWMS");ye.WMTS=new ye("WMTS");ye.XYZ=new ye("XYZ");var Ps=Wf;const Wo="1.1.0",L=!0,k={classification:"https://stac-extensions.github.io/classification/v2.0.0/schema.json",datacube:"https://stac-extensions.github.io/datacube/v2.2.0/schema.json",eo:"https://stac-extensions.github.io/eo/v2.0.0/schema.json",file:"https://stac-extensions.github.io/file/v2.1.0/schema.json","item-assets":"https://stac-extensions.github.io/item-assets/v1.0.0/schema.json",label:"https://stac-extensions.github.io/label/v1.0.1/schema.json",pointcloud:"https://stac-extensions.github.io/pointcloud/v1.0.0/schema.json",processing:"https://stac-extensions.github.io/processing/v1.2.0/schema.json",projection:"https://stac-extensions.github.io/projection/v2.0.0/schema.json",raster:"https://stac-extensions.github.io/raster/v2.0.0/schema.json",sar:"https://stac-extensions.github.io/sar/v1.0.0/schema.json",sat:"https://stac-extensions.github.io/sat/v1.0.0/schema.json",scientific:"https://stac-extensions.github.io/scientific/v1.0.0/schema.json",table:"https://stac-extensions.github.io/table/v1.2.0/schema.json",timestamps:"https://stac-extensions.github.io/timestamps/v1.1.0/schema.json",version:"https://stac-extensions.github.io/version/v1.2.0/schema.json",view:"https://stac-extensions.github.io/view/v1.0.0/schema.json"},Jt={itemAndCollection:{"classification:":k.classification,"cube:":k.datacube,"eo:":k.eo,"file:":k.file,"label:":k.label,"pc:":k.pointcloud,"processing:":k.processing,"proj:":k.projection,"raster:":k.raster,"sar:":k.sar,"sat:":k.sat,"sci:":k.scientific,"view:":k.view,version:k.version,deprecated:k.version,published:k.timestamps,expires:k.timestamps,unpublished:k.timestamps},catalog:{},collection:{},item:{}};Jt.collection=Object.assign(Jt.collection,Jt.itemAndCollection);Jt.item=Object.assign(Jt.item,Jt.itemAndCollection);var Wr={parseExtension(r){let e=r.match(/^https?:\/\/stac-extensions.github.io\/([^\/]+)\/v([^\/]+)\/[^.]+.json$/i);if(e)return{id:e[1],version:e[2]};let t=r.match(/(\d+\.\d+(\.\d+)([a-z_.-][\w.-]+)?)/i);if(t)return{id:r,version:t[1]};if(r in k)return{id:r,version:"0.0.0"}}},K={version:Wo,extensions:{},set(r){if(typeof r.stac_version!="string"?K.version="0.6.0":K.version=r.stac_version,Array.isArray(r.stac_extensions))for(let e of r.stac_extensions){let t=Wr.parseExtension(e);t&&(K.extensions[t.id]=t.version)}},before(r,e=null){return K.compare("<",r,e)},compare(r,e,t=null){let n=t?K.extensions[t]:K.version;return typeof n>"u"?!1:Ps.compare(n,e,r)}},x={type(r){let e=typeof r;if(e==="object"){if(r===null)return"null";if(Array.isArray(r))return"array"}return e},is(r,e){return Array.isArray(e)?e.includes(x.type(r)):x.type(r)===e},isDefined(r){return typeof r<"u"},isObject(r){return typeof r=="object"&&r===Object(r)&&!Array.isArray(r)},rename(r,e,t){return typeof r[e]<"u"&&typeof r[t]>"u"?(r[t]=r[e],delete r[e],!0):!1},copy(r,e,t){return typeof r[e]<"u"&&typeof r[t]>"u"?(r[t]=r[e],!0):!1},forAll(r,e,t){if(r[e]&&typeof r[e]=="object")for(let n in r[e])t(r[e][n])},toArray(r,e){return typeof r[e]<"u"&&!Array.isArray(r[e])?(r[e]=[r[e]],!0):!1},flattenArray(r,e,t,n=!1){if(Array.isArray(r[e])){for(let i in r[e])if(typeof t[i]=="string"){let s=r[e][i];r[t[i]]=n?[s]:s}return delete r[e],!0}return!1},flattenOneElementArray(r,e,t=!1){return!t&&Array.isArray(r[e])?r[e].length===1?(r[e]=r[e][0],!0):!1:!0},removeFromArray(r,e,t){if(Array.isArray(r[e])){let n=r[e].indexOf(t);return n>-1&&r[e].splice(n,1),!0}return!1},pickFirst(r,e){return Array.isArray(r[e])&&r[e].length>0?(r[e]=r[e][0],!0):(delete r[e],!1)},ensure(r,e,t){return x.type(t)!==x.type(r[e])&&(r[e]=t),!0},upgradeExtension(r,e){let{id:t,version:n}=Wr.parseExtension(e),i=r.stac_extensions.findIndex(s=>{let o=Wr.parseExtension(s);return o&&o.id===t&&Ps.compare(o.version,n,"<")});return i!==-1?(r.stac_extensions[i]=e,!0):!1},addExtension(r,e){let{id:t,version:n}=Wr.parseExtension(e),i=r.stac_extensions.findIndex(s=>{if(s===e)return!0;let o=Wr.parseExtension(s);return!!(o&&o.id===t&&Ps.compare(o.version,n,"<"))});return i===-1?r.stac_extensions.push(e):r.stac_extensions[i]=e,r.stac_extensions.sort(),!0},removeExtension(r,e){return x.removeFromArray(r,"stac_extensions",e)},migrateExtensionShortnames(r){let e=Object.keys(k),t=Object.values(k);return x.mapValues(r,"stac_extensions",e,t)},populateExtensions(r,e){let t=[];(e=="catalog"||e=="collection")&&t.push(r),(e=="item"||e=="collection")&&x.isObject(r.assets)&&(t=t.concat(Object.values(r.assets))),e=="collection"&&x.isObject(r.item_assets)&&(t=t.concat(Object.values(r.item_assets))),e=="collection"&&x.isObject(r.summaries)&&t.push(r.summaries),e=="item"&&x.isObject(r.properties)&&t.push(r.properties),t.push(r.links);let n;for(;n=t.pop();)Object.keys(n).forEach(i=>{Array.isArray(n.bands)&&(t=t.concat(n.bands));let s=i.match(/^(\w+:|[^:]+$)/i);if(Array.isArray(s)){let o=Jt[e][s[0]];x.is(o,"string")&&x.addExtension(r,o)}})},mapValues(r,e,t,n){let i=s=>{let o=t.indexOf(s);return o>=0?n[o]:s};return Array.isArray(r[e])?r[e]=r[e].map(i):typeof r[e]<"u"&&(r[e]=i(r[e])),!0},mapObject(r,e){for(let t in r)r[t]=e(r[t],t)},moveTo(r,e,t,n=!1,i=!1){let s;return n?i?s=o=>Array.isArray(o):s=o=>Array.isArray(o)&&o.length===1:s=x.isDefined,s(r[e])?(t[e]=n&&!i?r[e][0]:r[e],delete r[e],!0):!1},runAll(r,e,t,n){for(let i in r)i.startsWith("migrate")||r[i](e,t,n)},toUTC(r,e){if(x.is(r[e],"string"))try{return r[e]=this.toISOString(r[e]),!0}catch{}return delete r[e],!1},toISOString(r){return r instanceof Date||(r=new Date(r)),r.toISOString().replace(/\.0+/,"")},formatString(r,e,t){const n=i=>x.is(i,["string","number"])?t.replaceAll("{}",i):i;Array.isArray(r[e])?r[e]=r[e].map(n):r[e]=n(r[e])}},yt={multihash:null,hexToUint8(r){if(r.length===0||r.length%2!==0)throw new Error(`The string "${r}" is not valid hex.`);return new Uint8Array(r.match(/.{1,2}/g).map(e=>parseInt(e,16)))},uint8ToHex(r){return r.reduce((e,t)=>e+t.toString(16).padStart(2,"0"),"")},toMultihash(r,e,t){if(!yt.multihash||!x.is(r[e],"string"))return!1;try{const n=yt.multihash.encode(yt.hexToUint8(r[e]),t);return r[e]=yt.uint8ToHex(n),!0}catch(n){return console.warn(n),!1}}},jo={migrate(r,e=!0){return K.set(r),e&&(r.stac_version=Wo),r.type="Catalog",x.ensure(r,"stac_extensions",[]),K.before("1.0.0-rc.1")&&x.migrateExtensionShortnames(r),x.ensure(r,"id",""),x.ensure(r,"description",""),x.ensure(r,"links",[]),x.runAll(jo,r,r),K.before("0.8.0")&&x.populateExtensions(r,"catalog"),r}},Ho={migrate(r,e=!0){return jo.migrate(r,e),r.type="Collection",K.before("1.0.0-rc.1")&&x.migrateExtensionShortnames(r),x.ensure(r,"license","other"),x.ensure(r,"extent",{spatial:{bbox:[]},temporal:{interval:[]}}),x.runAll(Ho,r,r),x.isObject(r.properties)&&(x.removeFromArray(r,"stac_extensions","commons"),delete r.properties),K.before("0.8.0")&&x.populateExtensions(r,"collection"),K.before("1.0.0-beta.1")&&x.mapValues(r,"stac_extensions",["assets"],["item-assets"]),r},extent(r){if(x.ensure(r,"extent",{}),K.before("0.8.0")&&(Array.isArray(r.extent.spatial)&&(r.extent.spatial={bbox:[r.extent.spatial]}),Array.isArray(r.extent.temporal)&&(r.extent.temporal={interval:[r.extent.temporal]})),x.ensure(r.extent,"spatial",{}),x.ensure(r.extent.spatial,"bbox",[]),x.ensure(r.extent,"temporal",{}),x.ensure(r.extent.temporal,"interval",[]),K.before("1.0.0-rc.3")){if(r.extent.temporal.interval.length>1){let e,t;for(let n of r.extent.temporal.interval){if(n[0]===null)e=null;else if(typeof n[0]=="string"&&e!==null)try{let i=new Date(n[0]);(typeof e>"u"||i<e)&&(e=i)}catch{}if(n[1]===null)t=null;else if(typeof n[1]=="string"&&t!==null)try{let i=new Date(n[1]);(typeof t>"u"||i>t)&&(t=i)}catch{}}r.extent.temporal.interval.unshift([e?x.toISOString(e):null,t?x.toISOString(t):null])}if(r.extent.spatial.bbox.length>1){let e=r.extent.spatial.bbox.reduce((t,n)=>Array.isArray(n)?Math.max(n.length,t):t,4);if(e>=4){let t=new Array(e).fill(null),n=e/2;for(let i of r.extent.spatial.bbox){if(!Array.isArray(i)||i.length<4)break;for(let s in i){let o=i[s];t[s]===null?t[s]=o:s<n?t[s]=Math.min(o,t[s]):t[s]=Math.max(o,t[s])}}t.findIndex(i=>i===null)===-1&&r.extent.spatial.bbox.unshift(t)}}}},collectionAssets(r){K.before("1.0.0-rc.1")&&x.removeExtension(r,"collection-assets"),un.migrateAll(r)},itemAsset(r){K.before("1.0.0-beta.2")&&x.rename(r,"item_assets","assets"),x.removeExtension(r,k["item-assets"]),un.migrateAll(r,"item_assets")},summaries(r){if(x.ensure(r,"summaries",{}),K.before("0.8.0")&&x.isObject(r.other_properties)){for(let e in r.other_properties){let t=r.other_properties[e];Array.isArray(t.extent)&&t.extent.length===2?r.summaries[e]={minimum:t.extent[0],maximum:t.extent[1]}:Array.isArray(t.values)&&(t.values.filter(n=>Array.isArray(n)).length===t.values.length?r.summaries[e]=t.values.reduce((n,i)=>n.concat(i),[]):r.summaries[e]=t.values)}delete r.other_properties}if(K.before("1.0.0-beta.1")&&x.isObject(r.properties)&&!r.links.find(e=>["child","item"].includes(e.rel)))for(let e in r.properties){let t=r.properties[e];Array.isArray(t)||(t=[t]),r.summaries[e]=t}K.before("1.0.0-rc.1")&&x.mapObject(r.summaries,e=>(x.rename(e,"min","minimum"),x.rename(e,"max","maximum"),e)),Rn.migrate(r.summaries,r,!0),x.moveTo(r.summaries,"sci:doi",r,!0)&&x.addExtension(r,k.scientific),x.moveTo(r.summaries,"sci:publications",r,!0,!0)&&x.addExtension(r,k.scientific),x.moveTo(r.summaries,"sci:citation",r,!0)&&x.addExtension(r,k.scientific),x.moveTo(r.summaries,"cube:dimensions",r,!0)&&x.addExtension(r,k.datacube),Object.keys(r.summaries).length===0&&delete r.summaries}},Zo={migrate(r,e=null,t=!0){K.set(r),t&&(r.stac_version=Wo),x.ensure(r,"stac_extensions",[]),K.before("1.0.0-rc.1")&&x.migrateExtensionShortnames(r),x.ensure(r,"id",""),x.ensure(r,"type","Feature"),x.isObject(r.geometry)||(r.geometry=null),r.geometry!==null&&x.ensure(r,"bbox",[]),x.ensure(r,"properties",{}),x.ensure(r,"links",[]),x.ensure(r,"assets",{});let n=!1;return x.isObject(e)&&x.isObject(e.properties)&&(x.removeFromArray(r,"stac_extensions","commons"),r.properties=Object.assign({},e.properties,r.properties),n=!0),x.runAll(Zo,r,r),Rn.migrate(r.properties,r),un.migrateAll(r),(K.before("0.8.0")||n)&&x.populateExtensions(r,"item"),r}},Vu={migrate(r,e=!0){return x.ensure(r,"collections",[]),x.ensure(r,"links",[]),x.runAll(Vu,r,r),r.collections=r.collections.map(t=>Ho.migrate(t,e)),r}},Xu={migrate(r,e=!0){return x.ensure(r,"type","FeatureCollection"),x.ensure(r,"features",[]),x.ensure(r,"links",[]),x.runAll(Xu,r,r),r.features=r.features.map(t=>Zo.migrate(t,null,e)),r}},un={migrateAll(r,e="assets"){for(let t in r[e])un.migrate(r[e][t],r)},migrate(r,e){return x.runAll(un,r,e),Rn.migrate(r,e),r},mediaTypes(r){x.is(r.type,"string")&&x.mapValues(r,"type",["image/vnd.stac.geotiff","image/vnd.stac.geotiff; cloud-optimized=true"],["image/tiff; application=geotiff","image/tiff; application=geotiff; profile=cloud-optimized"])}},Ls={migrateAll(r,e){if(K.before("1.0.0")){const t=x.isObject(e.properties)&&Array.isArray(e.properties.bands)?e.properties.bands:[];if(Array.isArray(r["eo:bands"]))for(let n in r["eo:bands"]){let i=r["eo:bands"][n];x.is(i,"number")&&x.isObject(t[i])&&(i=t[i]),x.isObject(i)||(i={}),r["eo:bands"][n]=i}}if(K.before("1.1.0-beta.1")&&(Array.isArray(r["raster:bands"])||Array.isArray(r["eo:bands"]))){x.ensure(r,"bands",[]);const t=r["raster:bands"]||[],n=r["eo:bands"]||[],i=Math.max(t.length,n.length);for(let s=0;s<i;s++)x.ensure(r.bands,s,{}),Object.assign(r.bands[s],t[s],n[s]),r.bands[s]=Ls.migrate(r.bands[s],e);delete r["raster:bands"],delete r["eo:bands"]}},migrate(r,e){return x.runAll(Ls,r,e),Rn.migrate(r,e),r},eo(r){K.before("2.0.0-beta.1","eo")&&(x.rename(r,"common_name","eo:common_name"),x.rename(r,"center_wavelength","eo:center_wavelength"),x.rename(r,"full_width_half_max","eo:full_width_half_max"),x.rename(r,"solar_illumination","eo:solar_illumination"))},raster(r){K.before("2.0.0-beta.1","raster")&&(x.rename(r,"sampling","raster:sampling"),x.rename(r,"bits_per_sample","raster:bits_per_sample"),x.rename(r,"spatial_resolution","raster:spatial_resolution"),x.rename(r,"scale","raster:scale"),x.rename(r,"offset","raster:offset"),x.rename(r,"histogram","raster:histogram"))}},Rn={migrate(r,e,t=!1){return x.runAll(Rn,r,e,t),r},_commonMetadata(r,e){K.before("1.0.0-rc.3")&&(x.toUTC(r,"created"),x.toUTC(r,"updated")),Ls.migrateAll(r,e)},_timestamps(r,e){x.toUTC(r,"published"),x.toUTC(r,"expires"),x.toUTC(r,"unpublished"),x.upgradeExtension(e,k.timestamps)},_versioningIndicator(r,e){x.upgradeExtension(e,k.version)},checksum(r,e){K.before("0.9.0")&&yt.multihash&&(x.rename(r,"checksum:md5","checksum:multihash")&&yt.toMultihash(r,"checksum:multihash","md5"),x.rename(r,"checksum:sha1","checksum:multihash")&&yt.toMultihash(r,"checksum:multihash","sha1"),x.rename(r,"checksum:sha2","checksum:multihash")&&yt.toMultihash(r,"checksum:multihash","sha2-256"),x.rename(r,"checksum:sha3","checksum:multihash")&&yt.toMultihash(r,"checksum:multihash","sha3-256")),K.before("1.0.0-rc.1")&&x.rename(r,"checksum:multihash","file:checksum")&&x.addExtension(e,k.file),x.removeExtension(e,"checksum")},classification(r,e){K.before("1.1.0","classification")&&x.forAll(r,"classification:classes",t=>x.rename(t,"color-hint","color_hint")),K.before("2.0.0","classification")&&x.forAll(r,"classification:classes",t=>x.ensure(t,"name",t.description)),x.upgradeExtension(e,k.classification)},cube(r,e){x.upgradeExtension(e,k.datacube)},dtr(r,e){K.before("0.9.0")&&(x.rename(r,"dtr:start_datetime","start_datetime"),x.rename(r,"dtr:end_datetime","end_datetime"),x.removeExtension(e,"datetime-range"))},eo(r,e){K.before("0.9.0")&&(x.rename(r,"eo:epsg","proj:epsg")&&x.addExtension(e,k.projection),x.rename(r,"eo:platform","platform"),x.rename(r,"eo:instrument","instruments")&&x.toArray(r,"instruments"),x.rename(r,"eo:constellation","constellation"),x.rename(r,"eo:off_nadir","view:off_nadir")&&x.addExtension(e,k.view),x.rename(r,"eo:azimuth","view:azimuth")&&x.addExtension(e,k.view),x.rename(r,"eo:incidence_angle","view:incidence_angle")&&x.addExtension(e,k.view),x.rename(r,"eo:sun_azimuth","view:sun_azimuth")&&x.addExtension(e,k.view),x.rename(r,"eo:sun_elevation","view:sun_elevation")&&x.addExtension(e,k.view)),K.before("1.0.0-beta.1")&&x.rename(r,"eo:gsd","gsd"),x.upgradeExtension(e,k.eo)},file(r,e,t){x.rename(r,"file:bits_per_sample","raster:bits_per_sample")&&x.addExtension(e,k.raster),x.rename(r,"file:data_type","data_type"),x.rename(r,"file:unit","unit"),Array.isArray(r["file:nodata"])&&r["file:nodata"].length>1&&x.copy(r,"file:nodata","nodata:values"),x.rename(r,"file:nodata","nodata")&&!t&&x.pickFirst(r,"nodata"),x.upgradeExtension(e,k.file)},label(r,e){K.before("0.8.0")&&(x.rename(r,"label:property","label:properties"),x.rename(r,"label:task","label:tasks"),x.rename(r,"label:overview","label:overviews")&&x.toArray(r,"label:overviews"),x.rename(r,"label:method","label:methods"),x.toArray(r,"label:classes")),x.upgradeExtension(e,k.label)},pc(r,e){K.before("0.8.0")&&x.rename(r,"pc:schema","pc:schemas"),x.upgradeExtension(e,k.pointcloud)},processing(r,e){x.upgradeExtension(e,k.processing)},proj(r,e){x.rename(r,"proj:epsg","proj:code")&&x.formatString(r,"proj:code","EPSG:{}"),x.upgradeExtension(e,k.projection)},raster(r,e){x.upgradeExtension(e,k.raster)},sar(r,e,t){x.rename(r,"sar:incidence_angle","view:incidence_angle")&&x.addExtension(e,k.view),x.rename(r,"sar:pass_direction","sat:orbit_state")&&x.mapValues(r,"sat:orbit_state",[null],["geostationary"])&&x.addExtension(e,k.sat),K.before("0.7.0")&&(x.flattenArray(r,"sar:resolution",["sar:resolution_range","sar:resolution_azimuth"],t),x.flattenArray(r,"sar:pixel_spacing",["sar:pixel_spacing_range","sar:pixel_spacing_azimuth"],t),x.flattenArray(r,"sar:looks",["sar:looks_range","sar:looks_azimuth","sar:looks_equivalent_number"],t),x.rename(r,"sar:off_nadir","view:off_nadir")&&x.addExtension(e,k.view)),K.before("0.9.0")&&(x.rename(r,"sar:platform","platform"),x.rename(r,"sar:instrument","instruments")&&x.toArray(r,"instruments"),x.rename(r,"sar:constellation","constellation"),x.rename(r,"sar:type","sar:product_type"),x.rename(r,"sar:polarization","sar:polarizations"),x.flattenOneElementArray(r,"sar:absolute_orbit",t)&&x.rename(r,"sar:absolute_orbit","sat:absolute_orbit")&&x.addExtension(e,k.sat),x.flattenOneElementArray(r,"sar:relative_orbit",t)&&x.rename(r,"sar:relative_orbit","sat:relative_orbit")&&x.addExtension(e,k.sat)),x.upgradeExtension(e,k.sar)},sat(r,e){K.before("0.9.0")&&(x.rename(r,"sat:off_nadir_angle","sat:off_nadir"),x.rename(r,"sat:azimuth_angle","sat:azimuth"),x.rename(r,"sat:sun_azimuth_angle","sat:sun_azimuth"),x.rename(r,"sat:sun_elevation_angle","sat:sun_elevation")),x.upgradeExtension(e,k.sat)},sci(r,e){x.upgradeExtension(e,k.scientific)},item(r){K.before("0.8.0")&&(x.rename(r,"item:license","license"),x.rename(r,"item:providers","providers"))},table(r,e){x.upgradeExtension(e,k.table)},view(r,e){x.upgradeExtension(e,k.view)}},pr={item(r,e=null,t=!0){return Zo.migrate(r,e,t)},catalog(r,e=!0){return jo.migrate(r,e)},collection(r,e=!0){return Ho.migrate(r,e)},collectionCollection(r,e=!0){return Vu.migrate(r,e)},itemCollection(r,e=!0){return Xu.migrate(r,e)},stac(r,e=!0){return r.type==="Feature"?pr.item(r,null,e):r.type==="FeatureCollection"?pr.itemCollection(r,e):r.type==="Collection"||!r.type&&x.isDefined(r.extent)&&x.isDefined(r.license)?pr.collection(r,e):!r.type&&Array.isArray(r.collections)?pr.collectionCollection(r,e):pr.catalog(r,e)},enableMultihash(r){yt.multihash=r}},_E=pr;const yE=to(_E);function Ve(r){return typeof r=="string"&&r.length>0}function yr(r,e,t,n=1e-8){if(typeof r!="number")return null;const i=e-n,s=t+n;return r<i||r>s?null:Math.min(Math.max(r,e),t)}function We(r){return typeof r=="object"&&r===Object(r)&&!Array.isArray(r)}function xE(r){switch(r){case"int8":return-128;case"int16":return-32768;case"int32":return-2147483648}return r.startsWith("u")?0:null}function EE(r){switch(r){case"int8":return 127;case"uint8":return 255;case"int16":return 32767;case"uint16":return 65535;case"int32":return 2147483647;case"uint32":return 4294967295}return null}function Wu(r){const e={minimum:null,maximum:null},t=c=>c.minimum!==null&&c.maximum!==null,n=r.getMetadata("statistics");if(We(n)&&(typeof n.minimum=="number"&&(e.minimum=n.minimum),typeof n.maximum=="number"&&(e.maximum=n.maximum),t(e)))return e;const i=r.getMetadata("raster:histogram");if(We(i)&&(typeof i.min=="number"&&(e.minimum=i.min),typeof i.max=="number"&&(e.maximum=i.max),t(e)))return e;const s=r.getMetadata("classification:classes");if(Array.isArray(s)&&(s.reduce((c,l)=>(c.minimum=Math.min(c.minimum,l.value),c.maximum=Math.max(c.maximum,l.value),c),e),t(e)))return e;const o=r.getMetadata("file:values");if(Array.isArray(o)&&(o.reduce((c,l)=>(c.minimum=Math.min(c.minimum,...l.values),c.maximum=Math.max(c.maximum,...l.values),c),e),t(e)))return e;const a=r.getMetadata("data_type");return a&&(e.minimum=xE(a),e.maximum=EE(a)),e}function ju(r){let e=[];const t=r.getMetadata("nodata");if(typeof t<"u")e.push(t);else{const n=r.getMetadata("file:nodata");if(typeof n<"u")e=n;else{const i=r.getMetadata("classification:classes");Array.isArray(i)&&(e=i.filter(s=>!!s.nodata).map(s=>s.value))}}return e.map(n=>n==="nan"?NaN:n==="+inf"?1/0:n==="-inf"?-1/0:n)}function Ur(r){let e=r.length>=6,t=r[0],n=r[e?3:2],i=r[1],s=r[e?4:3],o={west:t,east:n,south:i,north:s};return e&&(o.base=r[2],o.height=r[5]),o}function rs(r){let{west:e,east:t,south:n,north:i}=Ur(r);return[[[e,i],[e,n],[t,n],[t,i],[e,i]]]}function bE(r){if(r=lt(r,!0),!r)return null;let e=Ur(r),t=[];if(Yu(r)){let n=(e.west+360+e.east)/2;n>180&&(n-=360),t.push(n)}else t.push((e.west+e.east)/2);return t.push((e.south+e.north)/2),typeof e.base<"u"&&t.push((e.base+e.height)/2),t}function Hu(r){if(Array.isArray(r[0]))return r.map(Hu);const[e,t]=r;return[yr(e,-180,180),yr(t,-90,90)]}function Zn(r){return We(r)&&(r.bbox&&(r.bbox=lt(r.bbox)),r.type==="FeatureCollection"?r.features.forEach(e=>Zn(e)):r.type==="Feature"?r.geometry=Zn(r.geometry):r.type==="GeometryCollection"?r.geometries.forEach(e=>Zn(e)):r.coordinates&&(r.coordinates=Hu(r.coordinates))),r}function Zu(r){const e=lt(r);if(e?r=[e]:Array.isArray(r)&&(r=r.map(i=>lt(i)).filter(i=>i!==null)),!Array.isArray(r)||r.length===0)return null;let t=r.reduce((i,s)=>{if(Yu(s)){let{west:o,east:a,south:c,north:l}=Ur(s);i.push(rs([-180,c,a,l])),i.push(rs([o,c,180,l]))}else i.push(rs(s));return i},[]),n=null;if(t.length===1?n={type:"Polygon",coordinates:t[0]}:t.length>1&&(n={type:"MultiPolygon",coordinates:t}),n)return{type:"Feature",geometry:n,properties:{}}}function lt(r,e=!1){if(!Array.isArray(r)||![4,6].includes(r.length))return null;let{west:t,east:n,south:i,north:s,base:o,height:a}=Ur(r);return t=yr(t,-180,180),i=yr(i,-90,90),n=yr(n,-180,180),s=yr(s,-90,90),e&&r.length===6?r=[t,i,o,n,s,a]:r=[t,i,n,s],r.some(c=>c===null)?null:r}function Yu(r){if(r=lt(r),!r)return!1;let{west:e,east:t}=Ur(r);return e>t}function Yo(r){if(!Array.isArray(r)||r.length===0)return null;let e={west:180,south:90,east:-180,north:-90};r.forEach(n=>{if(n=lt(n),!n)return;let i=Ur(n),s=["west","south"];for(let o in i){let a=s.includes(o)?Math.min:Math.max;e[o]=a(e[o],i[o])}});let t=[e.west,e.south,e.east,e.north];return lt(t)}class vn{constructor(e,t={},n=[]){if(!We(e))throw new Error("Given data is not an object");if(e instanceof vn){for(let i of n)this[i]=e[i];e=e.toJSON()}this._keyMap=t,this._privateKeys=["_keyMap","_privateKeys"].concat(n);for(let i in e)typeof this[i]>"u"&&(i in t?this[i]=t[i](e[i],this):this[i]=e[i])}isItem(){return this.type==="Feature"}isCatalog(){return this.type==="Catalog"}isCatalogLike(){return this.isCatalog()||this.isCollection()}isCollection(){return this.type==="Collection"}isItemCollection(){return this.type==="FeatureCollection"}isCollectionCollection(){return!1}isAsset(){return!1}isLink(){return!1}isBand(){return!1}getObjectType(){}getAbsoluteUrl(){return null}getMetadata(e){return this[e]}toGeoJSON(){return null}getBoundingBox(){return null}getCenter(){return bE(this.getBoundingBox())}getBoundingBoxes(){return[]}toJSON(){let e={};return Object.keys(this).forEach(t=>{if(typeof this[t]=="function"||this._privateKeys.includes(t))return;let n=this[t];if(t in this._keyMap){let i=Array.isArray(n)?[]:{};for(let s in n)i[s]=n[s].toJSON();n=i}e[t]=n}),e}}const wl=["http","https"];function TE(r,e,t=!0){return wE(r,e,!1,t)}function wE(r,e=null,t=!1,n=!0){let i=ds(r);if(e&&i.is("relative")){let s=ds(e),o=s.path();!o.endsWith("/")&&!o.endsWith(".json")&&s.path(o+"/"),i=i.absoluteTo(s)}return i.normalize(),t&&(i.query(""),i.fragment("")),n?i.toString():i}const Is="application/geo+json",SE=["application/json",Is,"text/json"],Sl=["image/gif","image/jpeg","image/apng","image/png","image/webp"],qu=["image/tiff; application=geotiff; profile=cloud-optimized","image/vnd.stac.geotiff; cloud-optimized=true"],Ku=["application/geotiff","image/tiff; application=geotiff","image/vnd.stac.geotiff"].concat(qu);function qo(r,e,t=!1){return Array.isArray(e)||(e=[e]),t&&typeof r>"u"?!0:typeof r!="string"?!1:(e=e.map(n=>n.toLowerCase()),e.includes(r.toLowerCase()))}function RE(r,e=!1){return qo(r,SE,e)}class Ju extends vn{constructor(e,t=null,n={},i=[]){super(e,n,["_context"].concat(i)),this._context||(this._context=t)}getAbsoluteUrl(e=!0){return this._context?TE(this.href,this._context.getAbsoluteUrl(),e):this.href.includes("://")?this.href:null}getContext(){return this._context}canBrowserDisplayImage(e=!1){if(typeof this.href!="string")return!1;if(!e&&typeof this.type>"u")return!1;let t=new ds(this.href),n=t.protocol().toLowerCase(),i=t.suffix().toLowerCase();return Ve(n)&&!wl.includes(n)?!1:Ve(this.type)&&Sl.includes(this.type.toLowerCase())?!0:!!(typeof this.type>"u"&&Ve(i)&&(i==="jpg"||Sl.includes("image/"+i)))}isType(e){return Ve(this.type)&&qo(this.type,e)}isGeoTIFF(){return this.isType(Ku)}isCOG(){return this.isType(qu)}isHTTP(){let t=this.getAbsoluteUrl(!1).protocol().toLowerCase();return Ve(t)&&wl.includes(t)}isPreview(){return!1}}class Ko extends Ju{constructor(e,t=null){super(e,t)}isLink(){return!0}getObjectType(){return"Link"}isPreview(){return this.rel==="preview"}static fromLinks(e,t=null){return Array.isArray(e)?e.map(n=>We(n)?new Ko(n,t):n):[]}}class Qu extends vn{constructor(e,t=null,n={},i=[]){if(super(e,Object.assign({links:Ko.fromLinks},n),["_url"].concat(i)),!this._url&&(this._url=t,!this._url)){let s=this.getSelfLink();s&&(this._url=s.href)}}getAbsoluteUrl(){return this._url}setAbsoluteUrl(e){this._url=e}getStacLinksWithRel(e,t=!0){return this.getLinksWithRels([e]).filter(n=>RE(n.type,t))}getStacLinkWithRel(e,t=!0){const n=this.getStacLinksWithRel(e,t);return n.length>0?n[0]:null}getLinks(){return Array.isArray(this.links)?this.links.filter(e=>We(e)&&Ve(e.href)):[]}getLinkWithRel(e){return this.getLinks().find(t=>t.rel===e)||null}getLinksWithRels(e){return this.getLinks().filter(t=>e.includes(t.rel))}getLinksWithOtherRels(e){return this.getLinks().filter(t=>!e.includes(t.rel))}getSelfLink(){return this.getStacLinkWithRel("self")}getRootLink(){return this.getStacLinkWithRel("root")}getParentLink(){return this.getStacLinkWithRel("parent")}}class Jo extends Qu{constructor(e,t=null,n={},i=[]){super(e,t,n,i)}getAll(){return[]}}class An extends vn{constructor(e,t=null,n=null){super(e,{},["_index","_context"]),typeof this._index!="number"&&(this._index=typeof t=="string"?parseInt(t,10):t),this._context||(this._context=n)}getContext(){return this._context}getObjectType(){return"Band"}isBand(){return!0}getIndex(){return this._index}getMetadata(e){if(typeof this[e]<"u")return this[e];if(this._context)return this._context.getMetadata(e)}getMinMaxValues(){return Wu(this)}getNoDataValues(){return ju(this)}static fromBands(e,t=null){let n=[];if(Array.isArray(e))for(let i in e)n[i]=new An(e[i],i,t);return n}}const vE=["created","updated","published","expires","unpublished","bands"];class st extends Ju{constructor(e,t=null,n=null){const i={bands:An.fromBands,alternate:st.fromAssets};super(e,n,i,["_key"]),this._key||(this._key=t)}getObjectType(){return"Asset"}isAsset(){return!0}getAbsoluteUrl(e=!0){return this.isDefinition()?null:super.getAbsoluteUrl(e)}getKey(){return this._key}getMetadata(e){if(typeof this[e]<"u")return this[e];if(this._context instanceof st)return this._context.getMetadata(e);if(this._context&&!vE.includes(e))return this._context.getMetadata(e)}getBands(){return this.bands||[]}findVisualBands(){const e={red:null,green:null,blue:null},t=this.getBands();for(const i in t){const s=parseInt(i,10),o=t[s];We(o)&&Ve(o["eo:common_name"])&&o["eo:common_name"]in e&&(e[o["eo:common_name"]]=o)}return Object.values(e).every(i=>i!==null)?e:null}findBand(e,t="name"){Array.isArray(e)||(e=[e]);const n=this.getBands(),i=n.findIndex(s=>We(s)&&e.includes(s[t]));return i>=0?n[i]:null}getBand(e){return We(e)||e===null?e:this.getBands()[e]||null}getMinMaxValues(){return Wu(this)}getNoDataValues(){return ju(this)}isDefinition(){return!Ve(this.href)}isHTTP(){return this.isDefinition()?null:super.isHTTP()}isPreview(){const e=["thumbnail","overview"];return e.includes(this.getKey())?!0:Array.isArray(this.roles)&&this.roles.some(t=>e.includes(t))}hasRole(e,t=!1){return Array.isArray(e)||(e=[e]),t&&e.includes(this.getKey())?!0:Array.isArray(this.roles)&&!!this.roles.find(n=>e.includes(n))}static fromAssets(e,t=null){let n={};if(We(e))for(let i in e)n[i]=new st(e[i],i,t);return n}}class _t extends Qu{constructor(e,t=null,n={},i=[]){super(e,t,n,i)}getTemporalExtent(){return null}getTemporalExtents(){return[]}getIcons(e=!0){return this.getLinksWithRels(["icon"]).filter(t=>t.canBrowserDisplayImage(e))}getThumbnails(e=!0,t=null){let n=this.getAssets().filter(i=>i.isPreview());if(n.length===0&&(n=this.getLinks().filter(i=>i.isPreview())),e&&(n=n.filter(i=>i.canBrowserDisplayImage())),t&&n.length>1){let i=s=>Array.isArray(s.roles)&&s.roles.includes(t)||s.getKey()===t;n=n.filter(i).concat(n.filter(s=>!i(s)))}return n}getDefaultGeoTIFF(e=!0,t=!1){var i;return(i=this.rankGeoTIFFs(e,t)[0])==null?void 0:i.asset}rankGeoTIFFs(e=!0,t=!1,n=null,i=null){We(n)||(n={data:1,visual:2,thumbnail:2,overview:3});let s=[],o=this.getAssetsByTypes(Ku);e&&(o=o.filter(c=>c.isHTTP()&&(!t||c.isCOG())));let a=Object.entries(n);for(let c of o){let l=0;if(a.length>0){let u=a.filter(([h])=>c.hasRole(h,!0)).map(([,h])=>h);u.length>0&&(l+=Math.max(...u))}!t&&c.isCOG()&&(l+=2),c.findVisualBands()&&(l+=1),typeof i=="function"&&(l+=i(c)),s.push({asset:c,score:l})}return s.sort((c,l)=>l.score-c.score),s}findVisualAssets(){let e={red:null,green:null,blue:null},t=Object.keys(e),n=this.getAssets();for(let s of n){let o=s.findBand(t,"eo:common_name");o&&(e[o["eo:common_name"]]=s)}return Object.values(e).every(s=>s!==null)?e:null}getAsset(e){return We(this.assets)&&this.assets[e]||null}getAssets(){return We(this.assets)?Object.values(this.assets):[]}getAssetsWithRoles(e,t=!1){return this.getAssets().filter(n=>n.hasRole(e,t))}getAssetWithRole(e,t=!1){return this.getAssetsWithRoles([e],t)[0]||null}getAssetsByTypes(e){return this.getAssets().filter(t=>qo(t.type,e))}equals(e){return this===e?!0:!(e instanceof _t)||this.getObjectType()!==e.getObjectType()?!1:!!(this.id&&this.id===e.id)}supportsExtension(e){if(!Array.isArray(this.stac_extensions))return!1;let t=new RegExp("^"+e.replaceAll("*","[^/]+")+"$");return this.stac_extensions.some(n=>t.test(n))}}class eh extends _t{constructor(e,t=null,n={},i=[]){super(e,t,n,i)}getObjectType(){return this.type}getSearchLink(e=null){let t=this.getStacLinksWithRel("search");return e?t[0]||null:t.find(n=>n.method===e||!e&&!n.method)||null}getApiCollectionsLink(){return this.getStacLinkWithRel("data")}getApiItemsLink(){return this.getStacLinkWithRel("items")}getChildLinks(){return this.getStacLinksWithRel("child")}getItemLinks(){return this.getStacLinksWithRel("item")}}class AE extends eh{constructor(e,t=null){super(e,t)}}function jr(r){if(Ve(r)&&r.length>=10)try{let t=r.match(/^(-?\d{1,})-(\d\d)-(\d\d)[T ](\d\d):(\d\d):(\d\d)(?:\.(\d*))?(?:Z|[+-]00:00)?$/i).slice(1).map(n=>parseInt(n,10));return new Date(Date.UTC(t[0],t[1]-1,t[2],t[3],t[4],t[5],t[6]||0))}catch{return null}return null}function PE(r,e){return new Date(r.valueOf()+(e-r)/2)}function th(r){if(!Array.isArray(r)||r.length===0)return null;let e,t;const n=(i,s,o)=>typeof i>"u"?s:i===null||s===null?null:o(i,s);return r.forEach(([i,s])=>{e=n(e,i,Math.min),t=n(t,s,Math.max)}),[e===null?null:new Date(e),t===null?null:new Date(t)]}class rh extends eh{constructor(e,t=null){const n={assets:st.fromAssets,item_assets:st.fromAssets};super(e,t,n)}toGeoJSON(){let e=Zu(this.getBoundingBoxes());return e&&(e.id=this.id),e}getBoundingBox(){let e=this.getRawBoundingBoxes();return e.length>0?lt(e[0]):null}getBoundingBoxes(){let e=this.getRawBoundingBoxes();return e.length===1?[lt(e[0])]:e.length>1?e.slice(1).map(lt):null}getRawBoundingBoxes(){var t,n;let e=(n=(t=this.extent)==null?void 0:t.spatial)==null?void 0:n.bbox;return Array.isArray(e)&&e.length>0?e:[]}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){var t,n;let e=(n=(t=this.extent)==null?void 0:t.temporal)==null?void 0:n.interval;return Array.isArray(e)&&e.length>0?e.filter(i=>Array.isArray(i)&&(Ve(i[0])||Ve(i[1]))).map(i=>i.map(s=>jr(s))):[]}getSummary(e){return this.summaries[e]}getBands(){let e=this.getMetadata("bands");return Array.isArray(e)||(e=this.getSummary("bands")),Array.isArray(e)?An.fromBands(e,this):[]}}class LE extends Jo{constructor(e,t=null){const n={collections:i=>i.map(s=>new rh(s))};super(e,t,n)}getObjectType(){return"CollectionCollection"}getAll(){return this.collections}isCollectionCollection(){return!0}toGeoJSON(){return{type:"FeatureCollection",features:this.collections.map(t=>t.toGeoJSON()).filter(t=>t!==null)}}getBoundingBox(){return Yo(this.getBoundingBoxes())}getBoundingBoxes(){return this.collections.map(e=>e.getBoundingBox())}getTemporalExtent(){return th(this.getTemporalExtents())}getTemporalExtents(){return this.collections.map(e=>e.getTemporalExtent())}}class Qo extends _t{constructor(e,t=null){super(e,t,{assets:st.fromAssets})}getObjectType(){return"Item"}toGeoJSON(){return this.toJSON()}getBoundingBox(){return lt(this.bbox)}getBoundingBoxes(){const e=this.getBoundingBox();return e?[e]:[]}getDateTime(){let e=jr(this.properties.datetime);if(!e){let t=jr(this.properties.start_datetime),n=jr(this.properties.end_datetime);return t&&n?PE(t,n):t||n}return e}getTemporalExtent(){return this.getTemporalExtents()[0]||null}getTemporalExtents(){let e=[];return Ve(this.properties.start_datetime)||Ve(this.properties.end_datetime)?e=[[this.properties.start_datetime||null,this.properties.end_datetime||null]]:Ve(this.properties.datetime)&&(e=[[this.properties.datetime,this.properties.datetime]]),e.map(t=>t.map(n=>jr(n)))}getMetadata(e){return this.properties[e]}getBands(){const e=this.getMetadata("bands");return Array.isArray(e)?An.fromBands(e,this):[]}getCollectionLink(){return this.getStacLinkWithRel("collection")}}class nh extends Jo{constructor(e,t=null){const n={features:i=>i.map(s=>new Qo(s))};super(e,t,n)}getObjectType(){return"ItemCollection"}getAll(){return this.features}toGeoJSON(){return this.toJSON()}getBoundingBox(){return Yo(this.getBoundingBoxes())}getBoundingBoxes(){return this.features.map(e=>e.getBoundingBox())}getTemporalExtent(){return th(this.getTemporalExtents())}getTemporalExtents(){return this.features.map(e=>e.getTemporalExtent())}}function zn(r,e=!0,t=!1){return e&&(r=yE.stac(r,t)),r.type==="Feature"?new Qo(r):r.type==="FeatureCollection"?new nh(r):r.type==="Collection"||!r.type&&typeof r.extent<"u"&&typeof r.license<"u"?new rh(r):!r.type&&Array.isArray(r.collections)?new LE(r):new AE(r)}const IE="https://stac-extensions.github.io/label/v1.*/schema.json",ih=new qn({color:"rgba(0,0,0,0)"});function sh(r,e,t="rgba(255,255,255,0.4)",n=5){let i=ih;t&&(i=new qn({color:t}));const s=new Yn({color:r,width:e});return new Xn({image:new Kh({fill:i,stroke:s,radius:n}),fill:i,stroke:s})}const CE=sh("#3399CC",3),Rl=sh("#ff9933",2,null);function FE(r,e){const t={url:r.getAbsoluteUrl()};let n=r;r.getBands().length===1&&(n=r.getBand(0));const{minimum:i,maximum:s}=n.getMinMaxValues();typeof i=="number"&&(t.min=i),typeof s=="number"&&(t.max=s);const o=n.getNoDataValues();return o.length>0&&(t.nodata=o[0]),e.length>0&&(t.bands=e),t}async function vl(r,e=void 0){let t=e;if(Jh()){const n=r.getMetadata("proj:code");if(n)try{if(n.startsWith("EPSG:")){const i=parseInt(n.replace("EPSG:",""),10);t=await Qh(i)}}catch{}}return t}function Al(r,e){const t=r.clone();return e.hasOnlyBounds()||t.setFill(ih),t}function OE(r){let e=r.href;if(e.includes("{s}"))if(Array.isArray(r["href:servers"])&&r["href:servers"].length>0){const t=Math.random()*r["href:servers"].length|0;e=e.replace("{s}",r["href:servers"][t])}else return null;return e}class Pl extends Tn{constructor(t){super({...t,state:"loading"});le(this,"loadImage",t=>new Promise((n,i)=>{const s=new Image;s.addEventListener("load",()=>n(s)),s.addEventListener("error",()=>i(new Error("load failed"))),s.src=t}));const n=new Xo(t.url);n.getHeader().then(i=>{this.tileGrid.minZoom=i.minZoom,this.tileGrid.maxZoom=i.maxZoom,this.setLoader(async(s,o,a)=>{const c=await n.getZxy(s,o,a),l=URL.createObjectURL(new Blob([c.data])),u=await this.loadImage(l);return URL.revokeObjectURL(l),u}),this.setState("ready")})}}class ME extends vi{constructor(t){super({...t,state:"loading",url:"pmtiles://"+t.url+"/{z}/{x}/{y}",format:new Vl});le(this,"tileLoadFunction",(t,n)=>{const i=new RegExp(/pmtiles:\/\/(.+)\/(\d+)\/(\d+)\/(\d+)/),s=n.match(i),o=+s[2],a=+s[3],c=+s[4];t.setLoader((l,u,h)=>{t.setState(Q.LOADING),this.pmtiles_.getZxy(o,a,c).then(f=>{if(f){const d=t.getFormat();t.setFeatures(d.readFeatures(f.data,{extent:l,featureProjection:h})),t.setState(Q.LOADED)}else t.setFeatures([]),t.setState(Q.EMPTY)}).catch(f=>{t.setFeatures([]),t.setState(Q.ERROR)})})});this.pmtiles_=new Xo(t.url),this.pmtiles_.getHeader().then(n=>{this.tileGrid.minZoom=n.minZoom,this.tileGrid.maxZoom=n.maxZoom,this.setTileLoadFunction(this.tileLoadFunction),this.setState("ready")})}}class ea extends lc{constructor(e){const t={};if(["opacity","visible","zIndex","minResolution","maxResolution","minZoom","maxZoom","properties"].forEach(n=>t[n]=e[n]),super(t),this.getSourceOptions_=e.getSourceOptions,this.children_=null,this.childrenOptions_=e.childrenOptions||{},this.assets_=null,this.bands_=[],this.crossOrigin_=e.crossOrigin||null,this.displayFootprint_=e.displayFootprint!==!1,this.displayGeoTiffByDefault_=!!e.displayGeoTiffByDefault,this.displayPreview_=!!e.displayPreview,this.displayOverview_=e.displayOverview!==!1,this.displayWebMapLink_=e.displayWebMapLink||!1,this.buildTileUrlTemplate_=e.buildTileUrlTemplate||null,this.useTileLayerAsFallback_=e.useTileLayerAsFallback||!1,this.boundsStyle_=e.boundsStyle||CE,this.collectionStyle_=e.collectionStyle||Rl,this.boundsLayer_=null,this.disableMigration_=e.disableMigration||!1,this.map_=null,this.eventQueue_=[],e.httpRequestFn&&(this.fetch_=e.httpRequestFn),e.data){try{this.configure_(e.data,e.url,e.children,e.assets,e.bands)}catch(n){this.handleError_(n)}return}if(!e.url)throw new Error("Either url or data must be provided");this.fetch_(e.url).then(n=>this.configure_(n,e.url,e.children,e.assets,e.bands)).catch(n=>this.handleError_(n))}async fetch_(e,t="json"){const n=await fetch(e);if(!n.ok)throw new Error(`Unexpected response from ${e}: ${n.status}`);return t==="json"?await n.json():t==="text"?await n.text():null}getBoundsLayer(){return this.boundsLayer_}isEmpty(){var e;if(this.getLayers().getLength()>1)return!1;const n=(e=this.getData())===null||e===void 0?void 0:e.getBoundingBox();return!n||Li(n)?!0:!this.boundsLayer_||!this.displayFootprint_}handleError_(e){this.dispatch_(new mE(e))}configure_(e,t=null,n=null,i=null,s=[]){let o;e instanceof st||e instanceof _t?o=e:o=zn(e,!this.disableMigration_),t&&t.includes("://")&&o instanceof _t&&o.setAbsoluteUrl(t),this.set("stac",o),this.bands_=s,this.boundsLayer_=this.addFootprint_();const a=()=>{this.boundsLayer_&&this.boundsLayer_.setStyle(Al(this.boundsStyle_,this))};this.getLayers().on("add",a),this.getLayers().on("remove",a);const c=h=>this.handleError_(h),l=this.setChildren(n).catch(c),u=this.setAssets(i).catch(c);Promise.all([l,u]).then(()=>this.dispatch_("layersready")),this.dispatch_("sourceready")}dispatch_(e){this.eventQueue_.push(e),this.flush_()}flush_(){if(this.map_){for(const e of this.eventQueue_)this.dispatchEvent(e);this.eventQueue_=[]}}setMap_(e){this.map_!==e&&(this.map_=e,this.flush_())}async addChildren_(e,t={}){const n=e.map(i=>{const s={data:i,crossOrigin:this.crossOrigin_,boundsStyle:this.collectionStyle_,displayGeoTiffByDefault:this.displayGeoTiffByDefault_,displayOverview:this.displayOverview_,displayPreview:this.displayPreview_,displayFootprint:this.displayFootprint_,useTileLayerAsFallback:this.useTileLayerAsFallback_,buildTileUrlTemplate:this.buildTileUrlTemplate_},o=new ea(Object.assign(s,t));return o.on("sourceready",()=>{o.map_&&this.setMap_(o.map_)}),this.addLayer_(o,null),o});return await Promise.all(n)}async addPreviewImage_(e){const t=await vl(e,"EPSG:4326"),n=e.getContext().getBoundingBoxes();if(n.length!==1)return;const i=n[0];let s={url:e.getAbsoluteUrl(),projection:t,imageExtent:us(i,"EPSG:4326",t),crossOrigin:this.crossOrigin_};this.getSourceOptions_&&(s=await this.getSourceOptions_(ye.ImageStatic,s,e));const o=new $s({source:new xu(s)});return this.addLayer_(o,e),o}async addLayerForLink(e){const t=OE(e);if(!t)return;const n={attributions:e.getMetadata("attribution")||this.getData().getMetadata("attribution"),crossOrigin:this.crossOrigin_,url:t},i=async(o,a)=>(this.getSourceOptions_&&(a=await this.getSourceOptions_(o,a,e)),a),s=[];switch(e.rel){case"pmtiles":const a=await new Xo(n.url).getHeader();let c;switch(a.tileType){case dr.Mvt:c=new ME(await i(ye.PMTilesVector,n));break;case dr.Avif:case dr.Jpeg:case dr.Png:case dr.Webp:c=new Pl(await i(ye.PMTilesRaster,n));break;default:return}s.push(c);break;case"tilejson":s.push(new Pu(await i(ye.TileJSON,n)));break;case"wms":if(!Array.isArray(e["wms:layers"]))break;for(const h in e["wms:layers"]){const f=e["wms:layers"][h]||"";let d="";Array.isArray(e["wms:styles"])&&typeof e["wms:styles"][h]=="string"&&(d=e["wms:styles"][h]);const p=Object.assign({LAYERS:f,STYLES:d},e["wms:dimensions"]);typeof e["wms:transparent"]=="boolean"&&(p.TRANSPARENT=String(e["wms:transparent"])),typeof e.type=="string"&&e.type.startsWith("image/")&&(p.FORMAT=e.type);const g=await i(ye.TileWMS,Object.assign({},n,{params:p}));s.push(new Jl(g))}break;case"wmts":const l=await this.getWmtsCapabilities_(t);if(!l)return;const u=Array.isArray(e["wmts:layer"])?e["wmts:layer"]:[e["wmts:layer"]];for(const h of u){let f=Object.assign({},n,{layer:h});typeof e.type=="string"&&e.type.startsWith("image/")&&(f.format=e.type),f=await i(ye.WMTS,f),s.push(new Ql(ec(l,f)))}break;case"xyz":s.push(new rn(await i(ye.XYZ,n)));break;default:return}return s.map(o=>{let a;return o instanceof vi?a=new Hl({source:o,declutter:!0}):o instanceof Pl?a=new di({source:o}):a=new ti({source:o}),this.addLayer_(a,e),a})}async addGeoTiff_(e){if(this.buildTileUrlTemplate_&&!this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);let n={sources:[FE(e,this.bands_)]};const i=await vl(e);i&&(n.projection=i),this.getSourceOptions_&&(n=await this.getSourceOptions_(ye.GeoTIFF,n,e));const s=new ko(n),o=new Promise((a,c)=>{s.on("error",c),s.on("change",()=>{s.getState()==="error"?c(s.getError()):a()})});try{await o;const a=new di({source:s});return this.addLayer_(a,e),a}catch(a){if(this.useTileLayerAsFallback_)return await this.addTileLayerForImagery_(e);this.handleError_(a)}}async addTileLayerForImagery_(e){let t=this.buildTileUrlTemplate_(e);t instanceof Promise&&(t=await t);let n={crossOrigin:this.crossOrigin_,url:t};this.getSourceOptions_&&(n=await this.getSourceOptions_(ye.XYZ,n,e));const i=new ti({source:new rn(n)});return this.addLayer_(i,e),i}addLayer_(e,t=null,n=0){t&&e.set("stac",t),e.setZIndex(n),this.getLayers().push(e)}addFootprint_(){let e=null;const t=this.getData();if(t.isItemCollection()||t.isCollectionCollection()?e=Zu(t.getBoundingBox()):e=t.toGeoJSON(),e){const n=this.createGeoJsonLayer_(e,Al(this.boundsStyle_,this),this.displayFootprint_);return n.set("bounds",!0),n.on("change",()=>this.setMap_(n.getMapInternal())),this.addLayer_(n,t,1),n}return null}async addGeoJson_(e){try{const t=await this.fetch_(e.getAbsoluteUrl()),n=this.createGeoJsonLayer_(t);return this.addLayer_(n,e),n}catch(t){this.handleError_(t)}}createGeoJsonLayer_(e,t=null,n=!0){const i=new Zs,s=new fn({format:i,loader:(o,a,c)=>{e=Zn(e);const l=i.readFeatures(e,{featureProjection:c});s.addFeatures(l)}});return t||(t=Rl),new Ds({source:s,style:t,visible:n})}async addLabelExtension_(){const e=this.getData();if(!(e instanceof Qo))return;let t=e.getAssetsWithRoles(["labels","labels-vector"],!0),n;t.length>1&&(n=t.find(s=>s.roles.includes("labels-vector"))),n||(n=e.getAsset("vector_labels")),n||(t=e.getAssets().filter(s=>s.type===Is&&!s.roles),t.length===1&&(n=t[0]));const i=e.getLinksWithRels(["source"]);if(n&&i.length>0){const s=i.map(async a=>{try{const c=await this.fetch_(a.getAbsoluteUrl());return zn(c)}catch(c){return this.handleError_(c),null}}),o=(await Promise.all(s)).filter(a=>a instanceof _t);await this.addChildren_(o,{displayFootprint:!1})}try{await this.addGeoJson_(n)}catch(s){this.handleError_(s)}}async updateLayers_(){const e=this.getLayers();for(let i=e.getLength()-1;i>=0;i--){const s=e.item(i);s.get("stac")&&!s.get("bounds")&&e.removeAt(i)}const t=this.getData();if(Array.isArray(this.displayWebMapLink_)){const i=this.getWebMapLinks().map(async s=>await this.addLayerForLink(s));await Promise.all(i)}this.children_&&await this.addChildren_(this.children_,this.childrenOptions_);const n=this.getAssets();if(n){const i=n.map(async s=>{if(s){if(s.type===Is)return await this.addGeoJson_(s);if(s.isGeoTIFF())return await this.addGeoTiff_(s);if(s.canBrowserDisplayImage())return await this.addPreviewImage_(s)}});await Promise.all(i)}if(this.hasOnlyBounds()){if(t instanceof Jo)await this.addChildren_(t.getAll(),this.childrenOptions_);else if(t instanceof _t){if(t.isItem()&&t.supportsExtension(IE)&&t.getMetadata("label:type")==="vector"){await this.addLabelExtension_();return}const i=this.getWebMapLinks();if(i.length>0)await this.addLayerForLink(i[0]);else{const s=t.getDefaultGeoTIFF(!0,!this.displayGeoTiffByDefault_);let o;if(s&&this.displayOverview_&&(o=await this.addGeoTiff_(s)),this.displayPreview_&&(!s||!o)){const a=t.getThumbnails(!0,"overview");a.length>0&&await this.addPreviewImage_(a[0])}}}}}hasOnlyBounds(){const e=this.getBoundsLayer();return typeof this.getLayersArray().find(n=>n!==e)>"u"}getWebMapLinks(){const e=this.getData();if(e instanceof st)return[];let t=["xyz","tilejson","pmtiles","wmts","wms"];typeof this.displayWebMapLink_=="string"&&(t=[this.displayWebMapLink_]);let n=e.getLinksWithRels(t);return Array.isArray(this.displayWebMapLink_)?n=this.displayWebMapLink_.map(i=>{if(typeof i=="string"){const s=n.find(o=>o.id===i);return s||null}return i}).filter(i=>!!i):n.sort((i,s)=>{const o=t.indexOf(i.rel),a=t.indexOf(s.rel);return o-a}),n}async setAssets(e){if(Array.isArray(e)){const t=this.getData();this.assets_=e.map(n=>t instanceof _t&&typeof n=="string"?t.getAsset(n):n instanceof st?n:new st(n))}else this.assets_=null;await this.updateLayers_()}async setChildren(e,t={}){if(!e){this.children_=null,this.childrenOptions_={};return}e instanceof nh?this.children_=e.getAll():We(e)&&e.type==="FeatureCollection"?this.children_=zn(e,!this.disableMigration_).getAll():Array.isArray(e)?this.children_=e.map(n=>n instanceof _t?n:zn(n,!this.disableMigration_)):this.children_=null,this.children_&&this.children_.length===0&&(this.children_=null),this.childrenOptions_=t,await this.updateLayers_()}getData(){return this.get("stac")}getChildren(){return this.children_}getAssets(){return this.assets_}getExtent(){if(!this.map_)return;const e=this.map_.getView();if(!e)return;let t;const n=this.getData();n&&(t=n.getBoundingBox());const i=this.getChildren();if(!t&&i){const s=i.map(o=>o.getBoundingBox());t=Yo(s)}if(t)return us(t,"EPSG:4326",e.getProjection())}getAttributions(){const e=[],t=this.getData();if(t){const n=t.getMetadata("attribution");n&&n.push(n)}return e}getSource(){return null}async getWmtsCapabilities_(e){try{const t=new URL(e);t.searchParams.set("service","wmts"),t.searchParams.set("request","GetCapabilities");const n=await this.fetch_(t.toString(),"text");return new go().read(n)}catch{return null}}}ef(tf);window.eoxMapAdvancedOlLayers={...z_,STAC:ea};class NE extends Ct{constructor(e){super({attributions:e.attributions,cacheSize:e.cacheSize,tilePixelRatio:e.tilePixelRatio,transition:e.transition,interpolate:e.interpolate!==void 0?e.interpolate:!0,key:e.key,attributionsCollapsible:e.attributionsCollapsible,zDirection:e.zDirection,wrapX:e.wrapX}),this.version_=e.version!==void 0?e.version:"1.0.0",this.dimensions_=e.dimensions!==void 0?e.dimensions:{},this.layer_=e.layer,fetch(e.url).then(t=>t.text()).then(t=>new window.DOMParser().parseFromString(t,"application/xml")).then(t=>{this.handleCapabilitiesResponse(t,e)})}handleCapabilitiesResponse(e,t){const i=new go().read(e),s=ec(i,t);this.crossOrigin=s.crossOrigin,this.projection=s.projection,this.tileGrid=s.tileGrid,this.requestEncoding_=s.requestEncoding,this.matrixSet_=s.matrixSet,this.style_=s.style,this.format_=s.format,this.dimensions_=s.dimensions,this.setUrls(s.urls),this.urls&&this.urls.length>0&&(this.tileUrlFunction=Vs(this.urls.map(this.createFromWMTSTemplate.bind(this)))),this.setState("ready")}createFromWMTSTemplate(e){const t=this.requestEncoding_,n={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};t==="KVP"&&Object.assign(n,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),e=t==="KVP"?ri(e,n):e.replace(/\{(\w+?)\}/g,(o,a)=>a.toLowerCase()in n?n[a.toLowerCase()]:o);const i=this.tileGrid,s=this.dimensions_;return function(o){if(!o)return;const a={TileMatrix:i.getMatrixId(o[0]),TileCol:o[1],TileRow:o[2]};Object.assign(a,s);let c=e;return t==="KVP"?c=ri(c,a):c=c.replace(/\{(\w+?)\}/g,(l,u)=>a[u]),c}}}const qt=new Uint8Array([102,103,98,3,102,103,98,0]),Rt=4,$r=4,Vr=4,Pn=4,Ot=new Int32Array(2),Ll=new Float32Array(Ot.buffer),Il=new Float64Array(Ot.buffer),kn=new Uint16Array(new Uint8Array([1,0]).buffer)[0]===1;var Cs;(function(r){r[r.UTF8_BYTES=1]="UTF8_BYTES",r[r.UTF16_STRING=2]="UTF16_STRING"})(Cs||(Cs={}));class It{constructor(e){this.bytes_=e,this.position_=0,this.text_decoder_=new TextDecoder}static allocate(e){return new It(new Uint8Array(e))}clear(){this.position_=0}bytes(){return this.bytes_}position(){return this.position_}setPosition(e){this.position_=e}capacity(){return this.bytes_.length}readInt8(e){return this.readUint8(e)<<24>>24}readUint8(e){return this.bytes_[e]}readInt16(e){return this.readUint16(e)<<16>>16}readUint16(e){return this.bytes_[e]|this.bytes_[e+1]<<8}readInt32(e){return this.bytes_[e]|this.bytes_[e+1]<<8|this.bytes_[e+2]<<16|this.bytes_[e+3]<<24}readUint32(e){return this.readInt32(e)>>>0}readInt64(e){return BigInt.asIntN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readUint64(e){return BigInt.asUintN(64,BigInt(this.readUint32(e))+(BigInt(this.readUint32(e+4))<<BigInt(32)))}readFloat32(e){return Ot[0]=this.readInt32(e),Ll[0]}readFloat64(e){return Ot[kn?0:1]=this.readInt32(e),Ot[kn?1:0]=this.readInt32(e+4),Il[0]}writeInt8(e,t){this.bytes_[e]=t}writeUint8(e,t){this.bytes_[e]=t}writeInt16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeUint16(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8}writeInt32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeUint32(e,t){this.bytes_[e]=t,this.bytes_[e+1]=t>>8,this.bytes_[e+2]=t>>16,this.bytes_[e+3]=t>>24}writeInt64(e,t){this.writeInt32(e,Number(BigInt.asIntN(32,t))),this.writeInt32(e+4,Number(BigInt.asIntN(32,t>>BigInt(32))))}writeUint64(e,t){this.writeUint32(e,Number(BigInt.asUintN(32,t))),this.writeUint32(e+4,Number(BigInt.asUintN(32,t>>BigInt(32))))}writeFloat32(e,t){Ll[0]=t,this.writeInt32(e,Ot[0])}writeFloat64(e,t){Il[0]=t,this.writeInt32(e,Ot[kn?0:1]),this.writeInt32(e+4,Ot[kn?1:0])}getBufferIdentifier(){if(this.bytes_.length<this.position_+$r+Vr)throw new Error("FlatBuffers: ByteBuffer is too short to contain an identifier.");let e="";for(let t=0;t<Vr;t++)e+=String.fromCharCode(this.readInt8(this.position_+$r+t));return e}__offset(e,t){const n=e-this.readInt32(e);return t<this.readInt16(n)?this.readInt16(n+t):0}__union(e,t){return e.bb_pos=t+this.readInt32(t),e.bb=this,e}__string(e,t){e+=this.readInt32(e);const n=this.readInt32(e);e+=$r;const i=this.bytes_.subarray(e,e+n);return t===Cs.UTF8_BYTES?i:this.text_decoder_.decode(i)}__union_with_string(e,t){return typeof e=="string"?this.__string(t):this.__union(e,t)}__indirect(e){return e+this.readInt32(e)}__vector(e){return e+this.readInt32(e)+$r}__vector_len(e){return this.readInt32(e+this.readInt32(e))}__has_identifier(e){if(e.length!=Vr)throw new Error("FlatBuffers: file identifier must be length "+Vr);for(let t=0;t<Vr;t++)if(e.charCodeAt(t)!=this.readInt8(this.position()+$r+t))return!1;return!0}createScalarList(e,t){const n=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&n.push(s)}return n}createObjList(e,t){const n=[];for(let i=0;i<t;++i){const s=e(i);s!==null&&n.push(s.unpack())}return n}}var ce,Ie=((ce={})[ce.Byte=0]="Byte",ce[ce.UByte=1]="UByte",ce[ce.Bool=2]="Bool",ce[ce.Short=3]="Short",ce[ce.UShort=4]="UShort",ce[ce.Int=5]="Int",ce[ce.UInt=6]="UInt",ce[ce.Long=7]="Long",ce[ce.ULong=8]="ULong",ce[ce.Float=9]="Float",ce[ce.Double=10]="Double",ce[ce.String=11]="String",ce[ce.Json=12]="Json",ce[ce.DateTime=13]="DateTime",ce[ce.Binary=14]="Binary",ce);class Pe{constructor(){le(this,"bb",null);le(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsColumn(e,t){return(t||new Pe).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsColumn(e,t){return e.setPosition(e.position()+Pn),(t||new Pe).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}type(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readUint8(this.bb_pos+e):Ie.Byte}title(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}width(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.readInt32(this.bb_pos+e):-1}precision(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.readInt32(this.bb_pos+e):-1}scale(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readInt32(this.bb_pos+e):-1}nullable(){let e=this.bb.__offset(this.bb_pos,18);return!e||!!this.bb.readInt8(this.bb_pos+e)}unique(){let e=this.bb.__offset(this.bb_pos,20);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}primaryKey(){let e=this.bb.__offset(this.bb_pos,22);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}metadata(e){let t=this.bb.__offset(this.bb_pos,24);return t?this.bb.__string(this.bb_pos+t,e):null}static startColumn(e){e.startObject(11)}static addName(e,t){e.addFieldOffset(0,t,0)}static addType(e,t){e.addFieldInt8(1,t,Ie.Byte)}static addTitle(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWidth(e,t){e.addFieldInt32(4,t,-1)}static addPrecision(e,t){e.addFieldInt32(5,t,-1)}static addScale(e,t){e.addFieldInt32(6,t,-1)}static addNullable(e,t){e.addFieldInt8(7,+t,1)}static addUnique(e,t){e.addFieldInt8(8,+t,0)}static addPrimaryKey(e,t){e.addFieldInt8(9,+t,0)}static addMetadata(e,t){e.addFieldOffset(10,t,0)}static endColumn(e){let t=e.endObject();return e.requiredField(t,4),t}static createColumn(e,t,n,i,s,o,a,c,l,u,h,f){return Pe.startColumn(e),Pe.addName(e,t),Pe.addType(e,n),Pe.addTitle(e,i),Pe.addDescription(e,s),Pe.addWidth(e,o),Pe.addPrecision(e,a),Pe.addScale(e,c),Pe.addNullable(e,l),Pe.addUnique(e,u),Pe.addPrimaryKey(e,h),Pe.addMetadata(e,f),Pe.endColumn(e)}}var te,Ne=((te={})[te.Unknown=0]="Unknown",te[te.Point=1]="Point",te[te.LineString=2]="LineString",te[te.Polygon=3]="Polygon",te[te.MultiPoint=4]="MultiPoint",te[te.MultiLineString=5]="MultiLineString",te[te.MultiPolygon=6]="MultiPolygon",te[te.GeometryCollection=7]="GeometryCollection",te[te.CircularString=8]="CircularString",te[te.CompoundCurve=9]="CompoundCurve",te[te.CurvePolygon=10]="CurvePolygon",te[te.MultiCurve=11]="MultiCurve",te[te.MultiSurface=12]="MultiSurface",te[te.Curve=13]="Curve",te[te.Surface=14]="Surface",te[te.PolyhedralSurface=15]="PolyhedralSurface",te[te.TIN=16]="TIN",te[te.Triangle=17]="Triangle",te);class Be{constructor(){le(this,"bb",null);le(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsGeometry(e,t){return(t||new Be).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsGeometry(e,t){return e.setPosition(e.position()+Pn),(t||new Be).__init(e.readInt32(e.position())+e.position(),e)}ends(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.readUint32(this.bb.__vector(this.bb_pos+t)+4*e):0}endsLength(){let e=this.bb.__offset(this.bb_pos,4);return e?this.bb.__vector_len(this.bb_pos+e):0}endsArray(){let e=this.bb.__offset(this.bb_pos,4);return e?new Uint32Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}xy(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}xyLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}xyArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}z(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}zLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}zArray(){let e=this.bb.__offset(this.bb_pos,8);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}m(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}mLength(){let e=this.bb.__offset(this.bb_pos,10);return e?this.bb.__vector_len(this.bb_pos+e):0}mArray(){let e=this.bb.__offset(this.bb_pos,10);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}t(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}tLength(){let e=this.bb.__offset(this.bb_pos,12);return e?this.bb.__vector_len(this.bb_pos+e):0}tArray(){let e=this.bb.__offset(this.bb_pos,12);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}tm(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.readUint64(this.bb.__vector(this.bb_pos+t)+8*e):BigInt(0)}tmLength(){let e=this.bb.__offset(this.bb_pos,14);return e?this.bb.__vector_len(this.bb_pos+e):0}type(){let e=this.bb.__offset(this.bb_pos,16);return e?this.bb.readUint8(this.bb_pos+e):Ne.Unknown}parts(e,t){let n=this.bb.__offset(this.bb_pos,18);return n?(t||new Be).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}partsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}static startGeometry(e){e.startObject(8)}static addEnds(e,t){e.addFieldOffset(0,t,0)}static createEndsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addInt32(t[n]);return e.endVector()}static startEndsVector(e,t){e.startVector(4,t,4)}static addXy(e,t){e.addFieldOffset(1,t,0)}static createXyVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startXyVector(e,t){e.startVector(8,t,8)}static addZ(e,t){e.addFieldOffset(2,t,0)}static createZVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startZVector(e,t){e.startVector(8,t,8)}static addM(e,t){e.addFieldOffset(3,t,0)}static createMVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startMVector(e,t){e.startVector(8,t,8)}static addT(e,t){e.addFieldOffset(4,t,0)}static createTVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startTVector(e,t){e.startVector(8,t,8)}static addTm(e,t){e.addFieldOffset(5,t,0)}static createTmVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addInt64(t[n]);return e.endVector()}static startTmVector(e,t){e.startVector(8,t,8)}static addType(e,t){e.addFieldInt8(6,t,Ne.Unknown)}static addParts(e,t){e.addFieldOffset(7,t,0)}static createPartsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startPartsVector(e,t){e.startVector(4,t,4)}static endGeometry(e){return e.endObject()}static createGeometry(e,t,n,i,s,o,a,c,l){return Be.startGeometry(e),Be.addEnds(e,t),Be.addXy(e,n),Be.addZ(e,i),Be.addM(e,s),Be.addT(e,o),Be.addTm(e,a),Be.addType(e,c),Be.addParts(e,l),Be.endGeometry(e)}}class rt{constructor(){le(this,"bb",null);le(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsFeature(e,t){return(t||new rt).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsFeature(e,t){return e.setPosition(e.position()+Pn),(t||new rt).__init(e.readInt32(e.position())+e.position(),e)}geometry(e){let t=this.bb.__offset(this.bb_pos,4);return t?(e||new Be).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}properties(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readUint8(this.bb.__vector(this.bb_pos+t)+e):0}propertiesLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}propertiesArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Uint8Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}columns(e,t){let n=this.bb.__offset(this.bb_pos,8);return n?(t||new Pe).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.__vector_len(this.bb_pos+e):0}static startFeature(e){e.startObject(3)}static addGeometry(e,t){e.addFieldOffset(0,t,0)}static addProperties(e,t){e.addFieldOffset(1,t,0)}static createPropertiesVector(e,t){e.startVector(1,t.length,1);for(let n=t.length-1;n>=0;n--)e.addInt8(t[n]);return e.endVector()}static startPropertiesVector(e,t){e.startVector(1,t,1)}static addColumns(e,t){e.addFieldOffset(2,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static endFeature(e){return e.endObject()}static finishFeatureBuffer(e,t){e.finish(t)}static finishSizePrefixedFeatureBuffer(e,t){e.finish(t,void 0,!0)}static createFeature(e,t,n,i){return rt.startFeature(e),rt.addGeometry(e,t),rt.addProperties(e,n),rt.addColumns(e,i),rt.endFeature(e)}}function ns(r,e){let t=[];for(let n=0;n<r.length;n+=2){let i=[r[n],r[n+1]];e&&i.push(e[n>>1]),t.push(i)}return t}new TextEncoder;let Cl=new TextDecoder;function DE(r,e){let t={};if(!e||e.length===0)return t;let n=r.propertiesArray();if(!n)return t;let i=new DataView(n.buffer,n.byteOffset),s=r.propertiesLength(),o=0;for(;o<s;){let a=i.getUint16(o,!0);o+=2;let c=e[a],l=c.name;switch(c.type){case Ie.Bool:t[l]=!!i.getUint8(o),o+=1;break;case Ie.Byte:t[l]=i.getInt8(o),o+=1;break;case Ie.UByte:t[l]=i.getUint8(o),o+=1;break;case Ie.Short:t[l]=i.getInt16(o,!0),o+=2;break;case Ie.UShort:t[l]=i.getUint16(o,!0),o+=2;break;case Ie.Int:t[l]=i.getInt32(o,!0),o+=4;break;case Ie.UInt:t[l]=i.getUint32(o,!0),o+=4;break;case Ie.Long:t[l]=Number(i.getBigInt64(o,!0)),o+=8;break;case Ie.ULong:t[l]=Number(i.getBigUint64(o,!0)),o+=8;break;case Ie.Float:t[l]=i.getFloat32(o,!0),o+=4;break;case Ie.Double:t[l]=i.getFloat64(o,!0),o+=8;break;case Ie.DateTime:case Ie.String:{let u=i.getUint32(o,!0);o+=4,t[l]=Cl.decode(n.subarray(o,o+u)),o+=u;break}case Ie.Json:{let u=i.getUint32(o,!0);o+=4;let h=Cl.decode(n.subarray(o,o+u));t[l]=JSON.parse(h),o+=u;break}case Ie.Binary:{let u=i.getUint32(o,!0);o+=4,t[l]=n.subarray(o,o+u),o+=u;break}default:throw Error(`Unknown type ${c.type}`)}}return t}const ta=new Uint8Array(0);function UE(){return this._source.cancel()}function BE(r,e){if(!r.length)return e;if(!e.length)return r;var t=new Uint8Array(r.length+e.length);return t.set(r),t.set(e,r.length),t}function GE(){var r=this,e=r._array.subarray(r._index);return r._source.read().then(function(t){return r._array=ta,r._index=0,t.done?e.length>0?{done:!1,value:e}:{done:!0,value:void 0}:{done:!1,value:BE(e,t.value)}})}function zE(r){if((r|=0)<0)throw new Error("invalid length");var e=this,t=this._array.length-this._index;if(this._index+r<=this._array.length)return Promise.resolve(this._array.subarray(this._index,this._index+=r));var n=new Uint8Array(r);return n.set(this._array.subarray(this._index)),function i(){return e._source.read().then(function(s){return s.done?(e._array=ta,e._index=0,t>0?n.subarray(0,t):null):t+s.value.length>=r?(e._array=s.value,e._index=r-t,n.set(s.value.subarray(0,r-t),t),n):(n.set(s.value,t),t+=s.value.length,i())})}()}function kE(r){return typeof r.slice=="function"?r:new Ui(typeof r.read=="function"?r:r.getReader())}function Ui(r){this._source=r,this._array=ta,this._index=0}Ui.prototype.read=GE;Ui.prototype.slice=zE;Ui.prototype.cancel=UE;class Ke{constructor(){le(this,"bb",null);le(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsCrs(e,t){return(t||new Ke).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsCrs(e,t){return e.setPosition(e.position()+Pn),(t||new Ke).__init(e.readInt32(e.position())+e.position(),e)}org(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}code(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.readInt32(this.bb_pos+e):0}name(e){let t=this.bb.__offset(this.bb_pos,8);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,10);return t?this.bb.__string(this.bb_pos+t,e):null}wkt(e){let t=this.bb.__offset(this.bb_pos,12);return t?this.bb.__string(this.bb_pos+t,e):null}codeString(e){let t=this.bb.__offset(this.bb_pos,14);return t?this.bb.__string(this.bb_pos+t,e):null}static startCrs(e){e.startObject(6)}static addOrg(e,t){e.addFieldOffset(0,t,0)}static addCode(e,t){e.addFieldInt32(1,t,0)}static addName(e,t){e.addFieldOffset(2,t,0)}static addDescription(e,t){e.addFieldOffset(3,t,0)}static addWkt(e,t){e.addFieldOffset(4,t,0)}static addCodeString(e,t){e.addFieldOffset(5,t,0)}static endCrs(e){return e.endObject()}static createCrs(e,t,n,i,s,o,a){return Ke.startCrs(e),Ke.addOrg(e,t),Ke.addCode(e,n),Ke.addName(e,i),Ke.addDescription(e,s),Ke.addWkt(e,o),Ke.addCodeString(e,a),Ke.endCrs(e)}}class gi{constructor(){le(this,"bb",null);le(this,"bb_pos",0)}__init(e,t){return this.bb_pos=e,this.bb=t,this}static getRootAsHeader(e,t){return(t||new gi).__init(e.readInt32(e.position())+e.position(),e)}static getSizePrefixedRootAsHeader(e,t){return e.setPosition(e.position()+Pn),(t||new gi).__init(e.readInt32(e.position())+e.position(),e)}name(e){let t=this.bb.__offset(this.bb_pos,4);return t?this.bb.__string(this.bb_pos+t,e):null}envelope(e){let t=this.bb.__offset(this.bb_pos,6);return t?this.bb.readFloat64(this.bb.__vector(this.bb_pos+t)+8*e):0}envelopeLength(){let e=this.bb.__offset(this.bb_pos,6);return e?this.bb.__vector_len(this.bb_pos+e):0}envelopeArray(){let e=this.bb.__offset(this.bb_pos,6);return e?new Float64Array(this.bb.bytes().buffer,this.bb.bytes().byteOffset+this.bb.__vector(this.bb_pos+e),this.bb.__vector_len(this.bb_pos+e)):null}geometryType(){let e=this.bb.__offset(this.bb_pos,8);return e?this.bb.readUint8(this.bb_pos+e):Ne.Unknown}hasZ(){let e=this.bb.__offset(this.bb_pos,10);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasM(){let e=this.bb.__offset(this.bb_pos,12);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasT(){let e=this.bb.__offset(this.bb_pos,14);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}hasTm(){let e=this.bb.__offset(this.bb_pos,16);return!!e&&!!this.bb.readInt8(this.bb_pos+e)}columns(e,t){let n=this.bb.__offset(this.bb_pos,18);return n?(t||new Pe).__init(this.bb.__indirect(this.bb.__vector(this.bb_pos+n)+4*e),this.bb):null}columnsLength(){let e=this.bb.__offset(this.bb_pos,18);return e?this.bb.__vector_len(this.bb_pos+e):0}featuresCount(){let e=this.bb.__offset(this.bb_pos,20);return e?this.bb.readUint64(this.bb_pos+e):BigInt("0")}indexNodeSize(){let e=this.bb.__offset(this.bb_pos,22);return e?this.bb.readUint16(this.bb_pos+e):16}crs(e){let t=this.bb.__offset(this.bb_pos,24);return t?(e||new Ke).__init(this.bb.__indirect(this.bb_pos+t),this.bb):null}title(e){let t=this.bb.__offset(this.bb_pos,26);return t?this.bb.__string(this.bb_pos+t,e):null}description(e){let t=this.bb.__offset(this.bb_pos,28);return t?this.bb.__string(this.bb_pos+t,e):null}metadata(e){let t=this.bb.__offset(this.bb_pos,30);return t?this.bb.__string(this.bb_pos+t,e):null}static startHeader(e){e.startObject(14)}static addName(e,t){e.addFieldOffset(0,t,0)}static addEnvelope(e,t){e.addFieldOffset(1,t,0)}static createEnvelopeVector(e,t){e.startVector(8,t.length,8);for(let n=t.length-1;n>=0;n--)e.addFloat64(t[n]);return e.endVector()}static startEnvelopeVector(e,t){e.startVector(8,t,8)}static addGeometryType(e,t){e.addFieldInt8(2,t,Ne.Unknown)}static addHasZ(e,t){e.addFieldInt8(3,+t,0)}static addHasM(e,t){e.addFieldInt8(4,+t,0)}static addHasT(e,t){e.addFieldInt8(5,+t,0)}static addHasTm(e,t){e.addFieldInt8(6,+t,0)}static addColumns(e,t){e.addFieldOffset(7,t,0)}static createColumnsVector(e,t){e.startVector(4,t.length,4);for(let n=t.length-1;n>=0;n--)e.addOffset(t[n]);return e.endVector()}static startColumnsVector(e,t){e.startVector(4,t,4)}static addFeaturesCount(e,t){e.addFieldInt64(8,t,BigInt("0"))}static addIndexNodeSize(e,t){e.addFieldInt16(9,t,16)}static addCrs(e,t){e.addFieldOffset(10,t,0)}static addTitle(e,t){e.addFieldOffset(11,t,0)}static addDescription(e,t){e.addFieldOffset(12,t,0)}static addMetadata(e,t){e.addFieldOffset(13,t,0)}static endHeader(e){return e.endObject()}static finishHeaderBuffer(e,t){e.finish(t)}static finishSizePrefixedHeaderBuffer(e,t){e.finish(t,void 0,!0)}}function ra(r){let e=gi.getRootAsHeader(r),t=e.featuresCount(),n=e.indexNodeSize(),i=[];for(let a=0;a<e.columnsLength();a++){let c=e.columns(a);if(!c)throw Error("Column unexpectedly missing");if(!c.name())throw Error("Column name unexpectedly missing");i.push({name:c.name(),type:c.type(),title:c.title(),description:c.description(),width:c.width(),precision:c.precision(),scale:c.scale(),nullable:c.nullable(),unique:c.unique(),primary_key:c.primaryKey()})}let s=e.crs(),o=s?{org:s.org(),code:s.code(),name:s.name(),description:s.description(),wkt:s.wkt(),code_string:s.codeString()}:null;return{geometryType:e.geometryType(),columns:i,envelope:null,featuresCount:Number(t),indexNodeSize:n,crs:o,title:e.title(),description:e.description(),metadata:e.metadata()}}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Fs=function(r,e){return Fs=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},Fs(r,e)};function $E(r,e){Fs(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function vr(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((n=n.apply(r,[])).next())})}function kt(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Br(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function hn(r){return this instanceof hn?(this.v=r,this):new hn(r)}function VE(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),i,s=[];return i={},o("next"),o("throw"),o("return"),i[Symbol.asyncIterator]=function(){return this},i;function o(f){n[f]&&(i[f]=function(d){return new Promise(function(p,g){s.push([f,d,p,g])>1||a(f,d)})})}function a(f,d){try{c(n[f](d))}catch(p){h(s[0][3],p)}}function c(f){f.value instanceof hn?Promise.resolve(f.value.v).then(l,u):h(s[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function h(f,d){f(d),s.shift(),s.length&&a(s[0][0],s[0][1])}}var oh=function(r){$E(e,r);function e(t){var n=r.call(this,t)||this;return Object.defineProperty(n,"name",{value:"RepeaterOverflowError",enumerable:!1}),typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf(n,n.constructor.prototype):n.__proto__=n.constructor.prototype,typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(n,n.constructor),n}return e}(Error);(function(){function r(e){if(e<0)throw new RangeError("Capacity may not be less than 0");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return this._q.length>=this._c},enumerable:!1,configurable:!0}),r.prototype.add=function(e){if(this.full)throw new Error("Buffer full");this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})();(function(){function r(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(e){for(;this._q.length>=this._c;)this._q.shift();this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})();(function(){function r(e){if(e<1)throw new RangeError("Capacity may not be less than 1");this._c=e,this._q=[]}return Object.defineProperty(r.prototype,"empty",{get:function(){return this._q.length===0},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"full",{get:function(){return!1},enumerable:!1,configurable:!0}),r.prototype.add=function(e){this._q.length<this._c&&this._q.push(e)},r.prototype.remove=function(){if(this.empty)throw new Error("Buffer empty");return this._q.shift()},r})();function Os(r){r!=null&&typeof r.then=="function"&&r.then(yi,yi)}var is=0,Fl=1,er=2,mi=3,Ms=4,_i=1024,yi=function(){};function Er(r){var e=r.err,t=Promise.resolve(r.execution).then(function(n){if(e!=null)throw e;return n});return r.err=void 0,r.execution=t.then(function(){},function(){}),r.pending===void 0?t:r.pending.then(function(){return t})}function Yt(r,e){var t=r.state>=mi;return Promise.resolve(e).then(function(n){return!t&&r.state>=Ms?Er(r).then(function(i){return{value:i,done:!0}}):{value:n,done:t}})}function na(r,e){var t,n;if(!(r.state>=er))if(r.state=er,r.onnext(),r.onstop(),r.err==null&&(r.err=e),r.pushes.length===0&&(typeof r.buffer>"u"||r.buffer.empty))Jr(r);else try{for(var i=Br(r.pushes),s=i.next();!s.done;s=i.next()){var o=s.value;o.resolve()}}catch(a){t={error:a}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}}function Jr(r){var e,t;if(!(r.state>=mi)){r.state<er&&na(r),r.state=mi,r.buffer=void 0;try{for(var n=Br(r.nexts),i=n.next();!i.done;i=n.next()){var s=i.value,o=r.pending===void 0?Er(r):r.pending.then(function(){return Er(r)});s.resolve(Yt(r,o))}}catch(a){e={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}r.pushes=[],r.nexts=[]}}function Ol(r){r.state>=Ms||(r.state<mi&&Jr(r),r.state=Ms)}function XE(r,e){if(Os(e),r.pushes.length>=_i)throw new oh("No more than "+_i+" pending calls to push are allowed on a single repeater.");if(r.state>=er)return Promise.resolve(void 0);var t=r.pending===void 0?Promise.resolve(e):r.pending.then(function(){return e});t=t.catch(function(c){r.state<er&&(r.err=c),Ol(r)});var n;if(r.nexts.length){var i=r.nexts.shift();i.resolve(Yt(r,t)),r.nexts.length?n=Promise.resolve(r.nexts[0].value):typeof r.buffer<"u"&&!r.buffer.full?n=Promise.resolve(void 0):n=new Promise(function(c){return r.onnext=c})}else typeof r.buffer<"u"&&!r.buffer.full?(r.buffer.add(t),n=Promise.resolve(void 0)):n=new Promise(function(c){return r.pushes.push({resolve:c,value:t})});var s=!0,o={},a=n.catch(function(c){if(s)throw c});return o.then=function(c,l){return s=!1,Promise.prototype.then.call(n,c,l)},o.catch=function(c){return s=!1,Promise.prototype.catch.call(n,c)},o.finally=n.finally.bind(n),r.pending=t.then(function(){return a}).catch(function(c){r.err=c,Ol(r)}),o}function WE(r){var e=na.bind(null,r),t=new Promise(function(n){return r.onstop=n});return e.then=t.then.bind(t),e.catch=t.catch.bind(t),e.finally=t.finally.bind(t),e}function jE(r){if(!(r.state>=Fl)){r.state=Fl;var e=XE.bind(null,r),t=WE(r);r.execution=new Promise(function(n){return n(r.executor(e,t))}),r.execution.catch(function(){return na(r)})}}var $n=new WeakMap,Ln=function(){function r(e,t){$n.set(this,{executor:e,buffer:t,err:void 0,state:is,pushes:[],nexts:[],pending:void 0,execution:void 0,onnext:yi,onstop:yi})}return r.prototype.next=function(e){Os(e);var t=$n.get(this);if(t===void 0)throw new Error("WeakMap error");if(t.nexts.length>=_i)throw new oh("No more than "+_i+" pending calls to next are allowed on a single repeater.");if(t.state<=is&&jE(t),t.onnext(e),typeof t.buffer<"u"&&!t.buffer.empty){var n=Yt(t,t.buffer.remove());if(t.pushes.length){var i=t.pushes.shift();t.buffer.add(i.value),t.onnext=i.resolve}return n}else if(t.pushes.length){var s=t.pushes.shift();return t.onnext=s.resolve,Yt(t,s.value)}else if(t.state>=er)return Jr(t),Yt(t,Er(t));return new Promise(function(o){return t.nexts.push({resolve:o,value:e})})},r.prototype.return=function(e){Os(e);var t=$n.get(this);if(t===void 0)throw new Error("WeakMap error");return Jr(t),t.execution=Promise.resolve(t.execution).then(function(){return e}),Yt(t,Er(t))},r.prototype.throw=function(e){var t=$n.get(this);if(t===void 0)throw new Error("WeakMap error");return t.state<=is||t.state>=er||typeof t.buffer<"u"&&!t.buffer.empty?(Jr(t),t.err==null&&(t.err=e),Yt(t,Er(t))):this.next(Promise.reject(e))},r.prototype[Symbol.asyncIterator]=function(){return this},r.race=HE,r.merge=ZE,r.zip=YE,r.latest=qE,r}();function Bi(r,e){var t,n,i=[],s=function(l){l!=null&&typeof l[Symbol.asyncIterator]=="function"?i.push(l[Symbol.asyncIterator]()):l!=null&&typeof l[Symbol.iterator]=="function"?i.push(l[Symbol.iterator]()):i.push(function(){return VE(this,arguments,function(){return kt(this,function(f){switch(f.label){case 0:return e.yieldValues?[4,hn(l)]:[3,3];case 1:return[4,f.sent()];case 2:f.sent(),f.label=3;case 3:return e.returnValues?[4,hn(l)]:[3,5];case 4:return[2,f.sent()];case 5:return[2]}})})}())};try{for(var o=Br(r),a=o.next();!a.done;a=o.next()){var c=a.value;s(c)}}catch(l){t={error:l}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return i}function HE(r){var e=this,t=Bi(r,{returnValues:!0});return new Ln(function(n,i){return vr(e,void 0,void 0,function(){var s,o,a,c,l,u;return kt(this,function(h){switch(h.label){case 0:if(!t.length)return i(),[2];o=!1,i.then(function(){s(),o=!0}),h.label=1;case 1:h.trys.push([1,,5,7]),c=void 0,l=0,u=function(){var f,d,p,g,m,y;return kt(this,function(_){switch(_.label){case 0:f=l;try{for(d=(m=void 0,Br(t)),p=d.next();!p.done;p=d.next())g=p.value,Promise.resolve(g.next()).then(function(E){E.done?(i(),a===void 0&&(a=E)):l===f&&(l++,s(E))},function(E){return i(E)})}catch(E){m={error:E}}finally{try{p&&!p.done&&(y=d.return)&&y.call(d)}finally{if(m)throw m.error}}return[4,new Promise(function(E){return s=E})];case 1:return c=_.sent(),c===void 0?[3,3]:[4,n(c.value)];case 2:_.sent(),_.label=3;case 3:return[2]}})},h.label=2;case 2:return o?[3,4]:[5,u()];case 3:return h.sent(),[3,2];case 4:return[2,a&&a.value];case 5:return i(),[4,Promise.race(t.map(function(f){return f.return&&f.return()}))];case 6:return h.sent(),[7];case 7:return[2]}})})})}function ZE(r){var e=this,t=Bi(r,{yieldValues:!0});return new Ln(function(n,i){return vr(e,void 0,void 0,function(){var s,o,a,c=this;return kt(this,function(l){switch(l.label){case 0:if(!t.length)return i(),[2];s=[],o=!1,i.then(function(){var u,h;o=!0;try{for(var f=Br(s),d=f.next();!d.done;d=f.next()){var p=d.value;p()}}catch(g){u={error:g}}finally{try{d&&!d.done&&(h=f.return)&&h.call(f)}finally{if(u)throw u.error}}}),l.label=1;case 1:return l.trys.push([1,,3,4]),[4,Promise.all(t.map(function(u,h){return vr(c,void 0,void 0,function(){var f,d;return kt(this,function(p){switch(p.label){case 0:p.trys.push([0,,6,9]),p.label=1;case 1:return o?[3,5]:(Promise.resolve(u.next()).then(function(g){return s[h](g)},function(g){return i(g)}),[4,new Promise(function(g){s[h]=g})]);case 2:return f=p.sent(),f===void 0?[3,4]:f.done?(a=f,[2]):[4,n(f.value)];case 3:p.sent(),p.label=4;case 4:return[3,1];case 5:return[3,9];case 6:return d=u.return,d?[4,u.return()]:[3,8];case 7:d=p.sent(),p.label=8;case 8:return[7];case 9:return[2]}})})}))];case 2:return l.sent(),[2,a&&a.value];case 3:return i(),[7];case 4:return[2]}})})})}function YE(r){var e=this,t=Bi(r,{returnValues:!0});return new Ln(function(n,i){return vr(e,void 0,void 0,function(){var s,o,a,c;return kt(this,function(l){switch(l.label){case 0:if(!t.length)return i(),[2,[]];o=!1,i.then(function(){s(),o=!0}),l.label=1;case 1:l.trys.push([1,,6,8]),l.label=2;case 2:return o?[3,5]:(Promise.all(t.map(function(u){return u.next()})).then(function(u){return s(u)},function(u){return i(u)}),[4,new Promise(function(u){return s=u})]);case 3:return a=l.sent(),a===void 0?[2]:(c=a.map(function(u){return u.value}),a.some(function(u){return u.done})?[2,c]:[4,n(c)]);case 4:return l.sent(),[3,2];case 5:return[3,8];case 6:return i(),[4,Promise.all(t.map(function(u){return u.return&&u.return()}))];case 7:return l.sent(),[7];case 8:return[2]}})})})}function qE(r){var e=this,t=Bi(r,{yieldValues:!0,returnValues:!0});return new Ln(function(n,i){return vr(e,void 0,void 0,function(){var s,o,a,c,l,u=this;return kt(this,function(h){switch(h.label){case 0:if(!t.length)return i(),[2,[]];o=[],a=!1,i.then(function(){var f,d;s();try{for(var p=Br(o),g=p.next();!g.done;g=p.next()){var m=g.value;m()}}catch(y){f={error:y}}finally{try{g&&!g.done&&(d=p.return)&&d.call(p)}finally{if(f)throw f.error}}a=!0}),h.label=1;case 1:return h.trys.push([1,,5,7]),Promise.all(t.map(function(f){return f.next()})).then(function(f){return s(f)},function(f){return i(f)}),[4,new Promise(function(f){return s=f})];case 2:return c=h.sent(),c===void 0?[2]:(l=c.map(function(f){return f.value}),c.every(function(f){return f.done})?[2,l]:[4,n(l.slice())]);case 3:return h.sent(),[4,Promise.all(t.map(function(f,d){return vr(u,void 0,void 0,function(){var p;return kt(this,function(g){switch(g.label){case 0:if(c[d].done)return[2,c[d].value];g.label=1;case 1:return a?[3,4]:(Promise.resolve(f.next()).then(function(m){return o[d](m)},function(m){return i(m)}),[4,new Promise(function(m){return o[d]=m})]);case 2:return p=g.sent(),p===void 0?[2,c[d].value]:p.done?[2,p.value]:(l[d]=p.value,[4,n(l.slice())]);case 3:return g.sent(),[3,1];case 4:return[2]}})})}))];case 4:return[2,h.sent()];case 5:return i(),[4,Promise.all(t.map(function(f){return f.return&&f.return()}))];case 6:return h.sent(),[7];case 7:return[2]}})})})}const Ei=class Ei{constructor(){le(this,"_extraRequestThreshold",262144)}extraRequestThreshold(){return this._extraRequestThreshold}setExtraRequestThreshold(e){if(e<0)throw Error("extraRequestThreshold cannot be negative");this._extraRequestThreshold=e}};le(Ei,"global",new Ei);let xi=Ei;const KE=40,JE=16;function ia(r,e){e=Math.min(Math.max(+e,2),65535);let t=r,n=t;do n+=t=Math.ceil(t/e);while(t!==1);return 40*n}function QE(r,e){if(e<2)throw Error("Node size must be at least 2");if(r===0)throw Error("Number of items must be greater than 0");let t=r,n=t,i=[t];do n+=t=Math.ceil(t/e),i.push(t);while(t!==1);let s=[];for(let a of(t=n,i))s.push(t-a),t-=a;let o=[];for(let a=0;a<i.length;a++)o.push([s[a],s[a]+i[a]]);return o}async function*eb(r,e,t,n){class i{constructor(d,p){le(this,"_level");le(this,"nodes");this._level=p,this.nodes=d}level(){return this._level}startNodeIdx(){return this.nodes[0]}endNodeIdx(){return this.nodes[1]}extendEndNodeIdx(d){this.nodes[1]=d}toString(){return`[NodeRange level: ${this._level}, nodes: ${this.nodes[0]}-${this.nodes[1]}]`}}let{minX:s,minY:o,maxX:a,maxY:c}=t,l=QE(r,e),u=l[0][0],h=[new i([0,1],l.length-1)];for(;h.length!==0;){let f=h.shift(),d=f.startNodeIdx(),p=d>=u,g=(()=>{let[,_]=l[f.level()],E=Math.min(f.endNodeIdx()+e,_);return p&&E<_?E+1:E})(),m=g-d,y=new DataView(await n(40*d,40*m));for(let _=d;_<g;_++){let E=_-d,S=40*E;if(a<y.getFloat64(S+0,!0)||c<y.getFloat64(S+8,!0)||s>y.getFloat64(S+16,!0)||o>y.getFloat64(S+24,!0))continue;let R=y.getBigUint64(S+32,!0);if(p){let P=(()=>{if(_<r-1){let U=(E+1)*40;return y.getBigUint64(U+32,!0)-R}return null})(),v=_-u;yield[Number(R),v,Number(P)];continue}let w=xi.global.extraRequestThreshold()/40,A=h[h.length-1];if(A!==void 0&&A.level()===f.level()-1&&R<A.endNodeIdx()+w){A.extendEndNodeIdx(Number(R));continue}let C=(()=>{let P=f.level()-1;return new i([Number(R),Number(R)+1],P)})();A!==void 0&&(A.level(),C.level()),h.push(C)}}}class sa{constructor(e,t,n,i,s){le(this,"headerClient");le(this,"header");le(this,"headerLength");le(this,"indexLength");le(this,"nocache");this.headerClient=e,this.header=t,this.headerLength=n,this.indexLength=i,this.nocache=s}static async open(e,t){let n,i=new Ml(e,t),s=2024+(()=>{let l,u=0;for(l=0;l<3;l++)u+=JE**l*KE;return u})();if(!new Uint8Array(await i.getRange(0,8,s,"header")).subarray(0,3).every((l,u)=>qt[u]===l))throw Error("Not a FlatGeobuf file");if((n=new DataView(await i.getRange(8,4,s,"header")).getUint32(0,!0))>10485760||n<8)throw Error("Invalid header size");let o=await i.getRange(12,n,s,"header"),a=ra(new It(new Uint8Array(o))),c=ia(a.featuresCount,a.indexNodeSize);return new sa(i,a,n,c,t)}async*selectBbox(e){let t=this.lengthBeforeTree(),n=this.headerClient,i=async(c,l)=>n.getRange(t+c,l,0,"index"),s=[],o=[];for await(let c of eb(this.header.featuresCount,this.header.indexNodeSize,e,i)){let[l,u]=c,[,,h]=c;if(h||(h=4),o.length===0){o.push([l,h,u]);continue}let f=o[o.length-1];l-(f[0]+f[1])>xi.global.extraRequestThreshold()&&(s.push(o),o=[]),o.push([l,h,u])}this.headerClient.logUsage("header+index"),o.length>0&&s.push(o);let a=s.flatMap(c=>this.readFeatureBatch(c,this.nocache));yield*Ln.merge(a)}lengthBeforeTree(){return qt.length+Rt+this.headerLength}lengthBeforeFeatures(){return this.lengthBeforeTree()+this.indexLength}buildFeatureClient(e){return new Ml(this.headerClient.httpClient,e)}async*readFeatureBatch(e,t){let[n]=e[0],[i,s]=e[e.length-1],o=this.buildFeatureClient(t),a=i+s-n;for(let[c,,l]of e){let u=await this.readFeature(o,c,a);yield{id:l,feature:u},a=0}o.logUsage("feature")}async readFeature(e,t,n){let i,s=t+this.lengthBeforeFeatures();i=new DataView(await e.getRange(s,4,n,"feature length")).getUint32(0,!0);let o=new Uint8Array(await e.getRange(s+4,i,n,"feature data")),a=new Uint8Array(i+Rt);a.set(o,Rt);let c=new It(a);return c.setPosition(Rt),rt.getRootAsFeature(c)}}class Ml{constructor(e,t){le(this,"httpClient");le(this,"bytesEverUsed",0);le(this,"bytesEverFetched",0);le(this,"buffer",new ArrayBuffer(0));le(this,"head",0);if(typeof e=="string")this.httpClient=new Nl(e,t);else if(e instanceof Nl)this.httpClient=e;else throw Error("Unknown source ")}async getRange(e,t,n,i){this.bytesEverUsed+=t;let s=e-this.head,o=s+t;if(s>=0&&o<=this.buffer.byteLength)return this.buffer.slice(s,o);let a=Math.max(t,n);return this.bytesEverFetched+=a,this.buffer=await this.httpClient.getRange(e,a,i),this.head=e,this.buffer.slice(0,t)}logUsage(e){e.split(" ")[0],(100*this.bytesEverUsed/this.bytesEverFetched).toFixed(2)}}class Nl{constructor(e,t){le(this,"url");le(this,"nocache");le(this,"requestsEverMade",0);le(this,"bytesEverRequested",0);this.url=e,this.nocache=t}async getRange(e,t,n){this.requestsEverMade+=1,this.bytesEverRequested+=t;let i={Range:`bytes=${e}-${e+t-1}`};return this.nocache&&(i["Cache-Control"]="no-cache, no-store"),await(await fetch(this.url,{headers:i})).arrayBuffer()}}function tb(r,e,t){if(!r.subarray(0,3).every((u,h)=>qt[h]===u))throw Error("Not a FlatGeobuf file");let n=new It(r),i=n.readUint32(qt.length);n.setPosition(qt.length+Rt);let s=ra(n),o=qt.length+Rt+i,{indexNodeSize:a,featuresCount:c}=s;a>0&&(o+=ia(c,a));let l=[];for(;o<n.capacity();){let u=n.readUint32(o);n.setPosition(o+Rt);let h=rt.getRootAsFeature(n);l.push(e(l.length,h,s)),o+=Rt+u}return l}async function*rb(r,e,t){let n,i=kE(r),s=async d=>await i.slice(d),o=new Uint8Array(await s(8));if(!o.subarray(0,3).every((d,p)=>qt[p]===d))throw Error("Not a FlatGeobuf file");o=new Uint8Array(await s(4));let a=new It(o),c=a.readUint32(0);o=new Uint8Array(await s(c));let l=ra(a=new It(o)),{indexNodeSize:u,featuresCount:h}=l;if(u>0){let d=ia(h,u);await s(d)}let f=0;for(;n=await ib(s,l,e,f++);)yield n}async function*nb(r,e,t,n,i=!1){let s=await sa.open(r,i);for await(let o of s.selectBbox(e))yield t(o.id,o.feature,s.header)}async function ib(r,e,t,n){let i=new Uint8Array(await r(4,"feature length"));if(i.byteLength===0)return;let s=new It(i),o=s.readUint32(0);i=new Uint8Array(await r(o,"feature data"));let a=new Uint8Array(o+4);return a.set(i,4),(s=new It(a)).setPosition(Rt),t(n,rt.getRootAsFeature(s),e)}function Ns(r,e){let t=e;if(t===Ne.Unknown&&(t=r.type()),t===Ne.GeometryCollection){let i=[];for(let s=0;s<r.partsLength();s++){let o=r.parts(s),a=o.type();i.push(Ns(o,a))}return{type:Ne[t],geometries:i}}if(t===Ne.MultiPolygon){let i=[];for(let s=0;s<r.partsLength();s++)i.push(Ns(r.parts(s),Ne.Polygon));return{type:Ne[t],coordinates:i.map(s=>s.coordinates)}}let n=function(i,s){let o=i.xyArray(),a=i.zArray();switch(s){case Ne.Point:{let c=Array.from(o);return a&&c.push(a[0]),c}case Ne.MultiPoint:case Ne.LineString:return ns(o,a);case Ne.MultiLineString:case Ne.Polygon:return function(c,l,u){let h;if(!u||u.length===0)return[ns(c,l)];let f=0,d=Array.from(u).map(p=>c.slice(f,f=p<<1));return l&&(f=0,h=Array.from(u).map(p=>l.slice(f,f=p))),d.map((p,g)=>ns(p,h?h[g]:void 0))}(o,a,i.endsArray())}}(r,t);return{type:Ne[t],coordinates:n}}function oa(r,e,t){let n=t.columns;return{type:"Feature",id:r,geometry:Ns(e.geometry(),t.geometryType),properties:DE(e,n)}}function sb(r,e){return{type:"FeatureCollection",features:tb(r,oa)}}function ob(r,e){return rb(r,oa)}function ab(r,e,t,n=!1){return nb(r,e,oa,t,n)}function lb(r,e,t,n=!1){return r instanceof Uint8Array?sb(r):r instanceof ReadableStream?ob(r):ab(r,e,t,n)}const Dl=new Zs({featureProjection:"EPSG:3857"});class cb extends fn{constructor(e){super({url:e.url,attributions:e.attributions,wrapX:e.wrapX,format:Dl,strategy:rf}),this.ressourceURL=e.url,super.setLoader(this.loader)}fgbBoundingBox(e,t){const n=us(e,t.getCode(),"EPSG:4326");return{minX:n[0],minY:n[1],maxX:n[2],maxY:n[3]}}async loader(e,t,n,i,s){const o=this.fgbBoundingBox(e,n);try{if(o.minX!==-1/0){const a=[],c=lb(this.ressourceURL,o);for await(const l of c){const u=Dl.readFeature(l);a.push(u)}super.clear(),super.addFeatures(a),i(a)}}catch{s()}}}window.eoxMapAdvancedOlSources={...Cx,WMTSCapabilities:NE,FlatGeoBuf:cb};const Ul=async(r,e,t)=>{Zt.debug("Creating layers config",r,e,t);const n=[],i={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers",layerControlExpand:!0},layers:[]};for(const h of e){let f;t?f=await h.createLayersJson(new Date(t)):f=await h.createLayersJson(),f.forEach(d=>{d.properties.layerControlExpand=!0,d.properties.layerControlToolsExpand=!0}),i.layers.push(...f)}n.push(i);const s=await Ta.getIndicatorLayers(r),o=Ta.getGeoDBLayer(e);o&&i.layers.unshift(o);const a={type:"Group",properties:{id:"BaseLayersGroup",title:"Base Layers"},layers:[]},c=s.filter(h=>h.properties.group==="baselayer");if(c.length){let h=0,f=0;for(let d=0;d<c.length;d++){const p=c[d];"visible"in p.properties||(p.properties.visible=!1),p.properties.visible&&(h++,f=d)}h===0&&(c[0].properties.visible=!0),h>0&&c.forEach((d,p)=>{p!==f?d.properties.visible=!1:d.properties.visible=!0}),a.layers.push(...c),a.layers.forEach(d=>{d.properties.layerControlExclusive=!0})}else a.layers.push({type:"Tile",properties:{id:"osm",title:"Background",layerControlExclusive:!0},source:{type:"OSM"}});a.layers.length&&n.push(a);const l={type:"Group",properties:{id:"OverlayGroup",title:"Overlay Layers"},layers:[]},u=s.filter(h=>h.properties.group==="overlay");return u.length&&(l.layers.push(...u),n.unshift(l)),n};let Vn=null;const ub=(r,e)=>{const t=n=>{var a;const i=n.map,s=(a=r.value)==null?void 0:a.lonLatCenter,o=i==null?void 0:i.getView().getZoom();s&&!Number.isNaN(s[0])&&!Number.isNaN(s[1])&&!Number.isNaN(o)&&(e.value=[s[0],s[1],o],Hr.value&&(Hr.value=!1))};cc(()=>{var n,i;(i=(n=r.value)==null?void 0:n.map)==null||i.on("moveend",t)}),uc(()=>{var n,i;(i=(n=r.value)==null?void 0:n.map)==null||i.un("moveend",t)})},Bl=(r,e,t,n,i,s,o)=>{Zt.debug("InitMap",r.value,e.value,t.values,n.value);const a=Qf(ed),c=Xf([e,n],async([l,u],[h,f])=>{var d,p,g,m,y,_,E,S,R,w,A,C;if(l){Zt.debug("Selected Indicator watch triggered",l,u),((d=r==null?void 0:r.value)==null?void 0:d.id)==="main"&&Vn!==null&&((p=r==null?void 0:r.value)==null||p.map.setView(Vn),Vn=null);let P=[];const v=(l==null?void 0:l.id)===(h==null?void 0:h.id)&&u!==f,{selectedCompareStac:U}=ps(gs());if(((g=r==null?void 0:r.value)==null?void 0:g.id)==="main"?await Jf(l):U.value!==null&&(Vn=((m=r==null?void 0:r.value)==null?void 0:m.map.getView())??null,r.value.sync=s.value),v){P=await Ul(l,t,u),Zt.debug("Assigned layers after changing time only",JSON.parse(JSON.stringify(P))),i.value=P,await Ea(()=>{a.emit("time:updated",i.value)});return}P=await Ul(l,t,n.value);let M=null;const z=(_=(y=l==null?void 0:l.extent)==null?void 0:y.temporal)==null?void 0:_.interval;if(z&&z.length>0&&z[0].length>1&&(M=new Date(z[0][1]),Zt.debug("Indicator load: found stac extent, setting time to latest value",M)),M!==null&&M.toISOString()!==n.value&&(n.value=M.toISOString()),o&&((E=r==null?void 0:r.value)==null?void 0:E.id)==="main"&&(S=l.extent)!=null&&S.spatial.bbox&&!Hr.value){const N=(R=l.extent)==null?void 0:R.spatial.bbox[0],G=[(N==null?void 0:N[0])>-180?N==null?void 0:N[0]:-180,(N==null?void 0:N[1])>-90?N==null?void 0:N[1]:-90,(N==null?void 0:N[2])<180?N==null?void 0:N[2]:180,(N==null?void 0:N[3])<90?N==null?void 0:N[3]:90],re=(C=r.value)==null?void 0:C.transformExtent(G,"EPSG:4326",(A=(w=r.value)==null?void 0:w.map)==null?void 0:A.getView().getProjection());r.value.zoomExtent=re}Hr.value&&(Hr.value=!1),Zt.debug("Assigned layers",JSON.parse(JSON.stringify(P))),i.value=P,await Ea(()=>{var N;(N=r.value)==null||N.updateComplete.then(()=>{a.emit("layers:updated",i.value)})})}},{immediate:!0});uc(()=>{c()})},Gl=(r,e)=>{Zf(async()=>{const t=[];for(const n of r)t.push(...await n.getToolTipProperties());e.value=t,Zt.debug("Updated tooltip properties",e.value)})};function hb(r){return 3*r*r-2*r*r*r}const fb=[".enabled"],db=[".center",".zoom",".layers"],pb=[".propertyTransform"],gb=[".layers"],mb=[".propertyTransform"],_b={__name:"index",props:{enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>[15,48]},zoom:{type:Number,default:4},zoomToExtent:{type:Boolean,default:!0}},setup(r){var y,_,E,S,R;const e=r,t=sr([]),n=sr([]),i={Attribution:{collapsible:!0}},s=_a([((y=On.value)==null?void 0:y[0])??((_=e.center)==null?void 0:_[0]),((E=On.value)==null?void 0:E[1])??((S=e.center)==null?void 0:S[1])]),o=_a(((R=On.value)==null?void 0:R[2])??e.zoom),a=sr([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),c=sr([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),l={duration:1200,easing:hb},u=sr(null),h=sr(null),{selectedCompareStac:f}=ps(gs()),d=ki(()=>e.enableCompare&&f.value?"":"first");ub(u,On),cc(()=>{const{selectedCompareStac:w,selectedStac:A}=ps(gs());jf.value=u.value,e.enableCompare&&(Hf.value=h.value),e.enableCompare&&(Bl(h,w,Kf,ba,c,u,!1),Gl($i,n)),Bl(u,A,$i,ba,a,h,e.zoomToExtent)}),Gl($i,t);const p=ki(()=>({visibility:t.value.length?"visible":"hidden"})),g=ki(()=>({visibility:n.value.length?"visible":"hidden"})),m=w=>{const A=w==="main"?t:n,C=w=="main"?Yf:qf;return P=>{const v=JSON.parse(zf.render(JSON.stringify(A.value),{...C.value??{}})),U=v==null?void 0:v.find(M=>M.id===P.key);if(U)return typeof P.value=="object"&&(P.value=JSON.stringify(P.value)),isNaN(Number(P.value))||(P.value=Number(P.value).toFixed(4).toString()),{key:U.title||U.id,value:P.value+" "+(U.appendix||"")}}};return(w,A)=>(Vf(),$f("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":d.value},[Fn("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:u,id:"main",".animationOptions":l,".center":xa(s),".zoom":xa(o),".layers":a.value,".controls":i},[Fn("eox-map-tooltip",{style:ya(p.value),".propertyTransform":m("main")},null,44,pb)],40,db),Fn("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:h,".layers":c.value},[Fn("eox-map-tooltip",{style:ya(g.value),".propertyTransform":m("compare")},null,44,mb)],40,gb)],40,fb))}},Cb=Object.freeze(Object.defineProperty({__proto__:null,default:_b},Symbol.toStringTag,{value:"Module"}));export{Pb as L,Lb as a,Cb as i};
