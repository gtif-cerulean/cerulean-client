import"./main.DhV80bjL.js";import"./index.Cph2Llz8.js";import{_ as le,q as O,u as pe,s as q,a as H,k as ce,j as ue,d as W,h as U,r as de,t as fe,l as I,v as ye,w as ve,o as me,n as be,i as ge,x as he,y as X,z as Y,E as K}from"./eo-dash.BfXnrxyB.js";import{i as xe,E as Ce}from"./EodashMapBtns-L3A85DA6.BSxLpGgG.js";import{h as w,ah as Q,p as M,am as E,v as ae,c as D,o as G,j as N,e as $,k as R,N as Z,b as Pe,F as we,x as se,q as Oe}from"./framework.zZXfd1Xh.js";import"./lit-element.Deg-YTNa.js";import"./WMTS.DmaPcE84.js";import"./Group.DfJ6KxFj.js";import"./extent.CajDHjk1.js";import"./GeoJSON.Br7Jz3X5.js";import"./index.DK02avya.js";import"./getElement.CdRlZPdn.js";import"./addCommonStyleSheet.zOcQQLUh.js";import"./WKT.CRW3-4HE.js";import"./commonjsHelpers.BosuxZz1.js";import"./item.CC2Khh23.js";import"./ExportState-Cip-UQEf.DUtiyuXa.js";import"./PopUp-B12eDZck.D2faxJVe.js";import"./VOverlay-CzUTRzQ4.CRh5DT2N.js";import"./forwardRefs-BdnUHnn3.nhyb9eII.js";import"./transition-BldkGQTb.C6xYlF90.js";import"./index-Bn6EoGHh.C-L8kH9P.js";import"./VImg-DWbM65HQ.B4T5uVsf.js";import"./EodashItemFilter-C5OPsLyg.D-nQ329Y.js";import"./main.CboE5_zC.js";import"./unsafe-html.q2xQv78y.js";import"./directive.CvdRHFdJ.js";import"./when.BR7zwNJC.js";import"./dayjs.min.Ba62AOpW.js";import"./index.BUIxO2d3.js";import"./static.3li6NsVA.js";import"./repeat.DqtNkz5O.js";import"./directive-helpers.oNa9w_hR.js";import"./toolcool-range-slider.min.BBXDELo7.js";import"./orient2d.DArCjZZA.js";import"./index.BSpBAx16.js";import"./handling-C_il519l.Dz4ZZ9hG.js";import"./async-t3zo8KaO.B_dhxMFA.js";import"./utils.DZj92Qv1.js";import"./index-DiW6YH3L.CVgMNpLr.js";import"./VTooltip-T9BN-hpi.DlfX9Q2N.js";const ee=async(e,o,p)=>{I.debug("Creating layers config",e,o,p);const r=[],a={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers",layerControlExpand:!0},layers:[]};for(const d of o){let v;p?v=await d.createLayersJson(new Date(p)):v=await d.createLayersJson(),v.forEach(i=>{i.properties.layerControlExpand=!0,i.properties.layerControlToolsExpand=!0}),a.layers.push(...v)}r.push(a);const c=await K.getIndicatorLayers(e),u=K.getObservationPointsLayer(o);u&&a.layers.unshift(u);const y={type:"Group",properties:{id:"BaseLayersGroup",title:"Base Layers"},layers:[]},s=c.filter(d=>d.properties.group==="baselayer");if(s.length){let d=0,v=0;for(let i=0;i<s.length;i++){const m=s[i];"visible"in m.properties||(m.properties.visible=!1),m.properties.visible&&(d++,v=i)}d===0&&(s[0].properties.visible=!0),d>0&&s.forEach((i,m)=>{m!==v?i.properties.visible=!1:i.properties.visible=!0}),y.layers.push(...s),y.layers.forEach(i=>{i.properties.layerControlExclusive=!0})}else y.layers.push({type:"Tile",properties:{id:"osm",title:"Background",layerControlExclusive:!0},source:{type:"OSM"}});y.layers.length&&r.push(y);const b={type:"Group",properties:{id:"OverlayGroup",title:"Overlay Layers"},layers:[]},g=c.filter(d=>d.properties.group==="overlay");return g.length&&(b.layers.push(...g),r.unshift(b)),r};let A=null;const Ie=(e,o)=>{const p=r=>{var y;const a=r.map,c=(y=e.value)==null?void 0:y.lonLatCenter,u=a==null?void 0:a.getView().getZoom();c&&!Number.isNaN(c[0])&&!Number.isNaN(c[1])&&!Number.isNaN(u)&&(o.value=[c[0],c[1],u])};ae(()=>{var r,a;(a=(r=e.value)==null?void 0:r.map)==null||a.on("moveend",p)}),se(()=>{var r,a;(a=(r=e.value)==null?void 0:r.map)==null||a.un("moveend",p)})},oe=(e,o,p,r,a,c,u)=>{I.debug("InitMap",e.value,o.value,p.values,r.value);const y=Oe([o,r],async([s,b],[g,d])=>{var v,i,m,k,B,h,x,j,z,F,V,T,_,n,f,C;if(s){I.debug("Selected Indicator watch triggered",s,b),((v=e==null?void 0:e.value)==null?void 0:v.id)==="main"&&A!==null&&((i=e==null?void 0:e.value)==null||i.map.setView(A),A=null);let l=[];const S=(s==null?void 0:s.id)===(g==null?void 0:g.id)&&b!==d,{selectedCompareStac:L}=q(H());if(((m=e==null?void 0:e.value)==null?void 0:m.id)==="main"?await he(s):L.value!==null&&(A=((k=e==null?void 0:e.value)==null?void 0:k.map.getView())??null,e.value.sync=c.value),S){l=await ee(s,p,b),I.debug("Assigned layers after changing time only",JSON.parse(JSON.stringify(l))),a.value=l,X(((B=e.value)==null?void 0:B.id)==="compare"?"compareTime:updated":"time:updated",e.value,l);return}l=await ee(s,p,r.value);let P=null;const J=(x=(h=s==null?void 0:s.extent)==null?void 0:h.temporal)==null?void 0:x.interval;if(J&&J.length>0&&J[0].length>1&&(P=new Date(J[0][1]),I.debug("Indicator load: found stac extent, setting time to latest value",P)),P!==null&&P.toISOString()!==r.value&&!Y.value&&(r.value=P.toISOString()),u&&((j=e==null?void 0:e.value)==null?void 0:j.id)==="main"&&(z=s.extent)!=null&&z.spatial.bbox&&!(Y.value&&((F=O.value)!=null&&F[0])&&((V=O.value)!=null&&V[1]))){const t=(T=s.extent)==null?void 0:T.spatial.bbox[0],ie=[(t==null?void 0:t[0])>-180?t==null?void 0:t[0]:-180,(t==null?void 0:t[1])>-90?t==null?void 0:t[1]:-90,(t==null?void 0:t[2])<180?t==null?void 0:t[2]:180,(t==null?void 0:t[3])<90?t==null?void 0:t[3]:90],ne=(f=e.value)==null?void 0:f.transformExtent(ie,"EPSG:4326",(n=(_=e.value)==null?void 0:_.map)==null?void 0:n.getView().getProjection());e.value.zoomExtent=ne}I.debug("Assigned layers",JSON.parse(JSON.stringify(l))),a.value=l,await X(((C=e.value)==null?void 0:C.id)==="compare"?"compareLayers:updated":"layers:updated",e.value,a.value)}},{immediate:!0});se(()=>{y()})},te=(e,o)=>{ye(async(p,r)=>{if(p.includes("compare"))return;const a=[];for(const c of e)a.push(...await c.getToolTipProperties());o.value=a,I.debug("Updated tooltip properties",o.value)})},Le="#cursor-coordinates[data-v-828a8859]{position:fixed;left:24px;bottom:56px;color:#000000e6;font-size:13px;background:#fffe;border-radius:4px;border:none;padding:4px 8px}#scale-line[data-v-828a8859]{position:fixed;left:24px;bottom:24px;color:#fff}[data-v-828a8859] .ol-scale-line{background:#fffe!important;border-radius:4px!important;border:none!important;padding:4px 8px!important;font-size:12px!important;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif!important}[data-v-828a8859] .ol-scale-line-inner{display:flex;justify-content:center;border:1px solid rgba(0,0,0,.5)!important;border-top:none!important;color:#333!important;font-weight:500!important}.map-buttons-container[data-v-828a8859]{position:fixed;top:0;left:0;width:100%;height:100%;display:grid;grid-template-columns:repeat(12,1fr);grid-template-rows:repeat(12,1fr);pointer-events:none;z-index:1}.map-buttons-container[data-v-828a8859]>*{pointer-events:auto}",Me=[".enabled"],Ne=[".center",".zoom",".layers",".controls"],ke=[".propertyTransform"],Te=[".layers"],_e=[".propertyTransform"],Se={key:0,id:"cursor-coordinates",ref:"cursor-coords"},Be={key:1,id:"scale-line",ref:"scale-line"};var re;const je={__name:"index",props:{enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>{var e,o;return[((e=O.value)==null?void 0:e[0])??15,((o=O.value)==null?void 0:o[1])??48]}},zoom:{type:Number,default:((re=O.value)==null?void 0:re[2])??4},zoomToExtent:{type:Boolean,default:!0},enableCursorCoordinates:{type:Boolean,default:!0},enableScaleLine:{type:Boolean,default:!0},btnsPosition:{type:Object,default:()=>({x:"12/9/8",y:1,gap:16})},btns:{type:Object,default:()=>({enableExportMap:!0,enableChangeProjection:!0,enableCompareIndicators:!0,enableBackToPOIs:!0,enableSearch:!0,enableZoom:!0})}},setup(e){var _;const o=e,{width:p}=pe(),r=n=>{if(typeof n=="number")return n;if(typeof n=="string"){const f=n.split("/"),C=p.value;return C<960?parseInt(f[0])||1:C<1920?parseInt(f[1]||f[0])||1:parseInt(f[2]||f[1]||f[0])||1}return 1},a=w(()=>r(o.btnsPosition.x)),c=w(()=>r(o.btnsPosition.y)),u=w(()=>({exportMap:o.btns.enableExportMap??!0,changeProjection:o.btns.enableChangeProjection??!0,compareIndicators:o.btns.enableCompareIndicators??!0,backToPOIs:o.btns.enableBackToPOIs??!0,enableSearch:o.btns.enableSearch??!0,enableZoom:o.btns.enableZoom??!0})),y=Q("scale-line"),s=Q("cursor-coords"),b=M([]),g=M([]),d=w(()=>({Attribution:{collapsible:!0},ScaleLine:o.enableScaleLine?{target:y.value||void 0}:void 0,MousePosition:o.enableCursorCoordinates?{projection:"EPSG:4326",coordinateFormat:n=>`${n[1].toFixed(3)} °N, ${n[0].toFixed(3)} °E`,target:s.value||void 0}:void 0})),v=E(o.center),i=E(((_=O.value)==null?void 0:_[2])??o.zoom),m=M([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),k=M([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),B={duration:1200,easing:xe},h=M(null),x=M(null),{selectedCompareStac:j}=q(H()),z=w(()=>o.enableCompare&&j.value?"":"first");Ie(h,O),ae(()=>{const{selectedCompareStac:n,selectedStac:f}=q(H());ce.value=h.value,o.enableCompare&&(ue.value=x.value),o.enableCompare&&(oe(x,n,ge,W,k,h,!1),te(U,g)),oe(h,f,U,W,m,x,o.zoomToExtent)}),te(U,b);const F=w(()=>({visibility:b.value.length?"visible":"hidden"})),V=w(()=>({visibility:g.value.length?"visible":"hidden"})),T=n=>{const f=n==="main"?b:g,C=n=="main"?me:be;return l=>{const S=JSON.parse(ve.render(JSON.stringify(f.value),{...C.value??{}})),L=S==null?void 0:S.find(P=>P.id===l.key);if(L)return typeof l.value=="object"&&(l.value=JSON.stringify(l.value)),isNaN(Number(l.value))||(l.value=Number(l.value).toFixed(4).toString()),{key:L.title||L.id,value:l.value+" "+(L.appendix||"")}}};return(n,f)=>(G(),D(we,null,[N("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":z.value},[N("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:h,id:"main",".animationOptions":B,".center":R(v),".zoom":R(i),".layers":m.value,".controls":d.value},[N("eox-map-tooltip",{style:Z(F.value),".propertyTransform":T("main")},null,44,ke)],40,Ne),N("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:x,".layers":k.value},[N("eox-map-tooltip",{style:Z(V.value),".propertyTransform":T("compare")},null,44,_e)],40,Te)],40,Me),e.enableCursorCoordinates?(G(),D("div",Se,null,512)):$("v-if",!0),e.enableScaleLine?(G(),D("span",Be,null,512)):$("v-if",!0),N("div",{class:"map-buttons-container",style:Z(`margin: ${e.btnsPosition.gap}px 0 ${e.btnsPosition.gap}px 0`)},[R(de)||R(fe)?(G(),Pe(Ce,{key:0,style:Z({gridColumn:a.value,gridRow:c.value}),exportMap:u.value.exportMap,changeProjection:u.value.changeProjection,compareIndicators:u.value.compareIndicators,backToPOIs:u.value.backToPOIs,enableSearch:u.value.enableSearch,enableZoom:u.value.enableZoom},null,8,["style","exportMap","changeProjection","compareIndicators","backToPOIs","enableSearch","enableZoom"])):$("v-if",!0)],4)],64))}},wo=le(je,[["styles",[Le]],["__scopeId","data-v-828a8859"]]);export{wo as default};
