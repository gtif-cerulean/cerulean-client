import"./main.DhV80bjL.js";import"./index.DgnJeyba.js";import{_ as ce,q as I,u as ue,s as H,a as W,k as de,j as fe,d as Y,h as D,r as O,t as N,l as M,v as ye,w as ve,o as me,n as be,i as ge,x as xe,y as X,z as K,E as Q}from"./eo-dash.DdK4KFKg.js";import{i as he,E as Ce}from"./EodashMapBtns-D0j7qqUD.B1bwHSry.js";import{h as L,ah as E,p as _,am as ee,v as ie,c as $,o as q,j as k,e as oe,k as c,N as R,G as we,x as ne,q as Pe}from"./framework.DDGkrIY3.js";import"./lit-element.Deg-YTNa.js";import"./WMTS.DmaPcE84.js";import"./Group.DfJ6KxFj.js";import"./extent.CajDHjk1.js";import"./GeoJSON.Br7Jz3X5.js";import"./index.DK02avya.js";import"./getElement.CdRlZPdn.js";import"./addCommonStyleSheet.zOcQQLUh.js";import"./WKT.CRW3-4HE.js";import"./commonjsHelpers.BosuxZz1.js";import"./item.CC2Khh23.js";import"./ExportState-BvSFo98X.B93Y4woN.js";import"./PopUp-D2bZUVPo.Da29siwE.js";import"./forwardRefs-gCAuB5pd.UjDgk0Nh.js";import"./transition-DCrdcqk0.Bl-222Ir.js";import"./VImg-h5-8NQK7.DjNYGocU.js";import"./EodashItemFilter-DSNBlWQh.BRGrI44i.js";import"./main.CboE5_zC.js";import"./unsafe-html.q2xQv78y.js";import"./directive.CvdRHFdJ.js";import"./when.BR7zwNJC.js";import"./dayjs.min.Ba62AOpW.js";import"./index.BUIxO2d3.js";import"./static.3li6NsVA.js";import"./repeat.DqtNkz5O.js";import"./directive-helpers.oNa9w_hR.js";import"./toolcool-range-slider.min.BBXDELo7.js";import"./orient2d.DArCjZZA.js";import"./index.BSpBAx16.js";import"./handling-DBDpDHVG.BggwZZZs.js";import"./async-BfuTAJue.BQyAW_lZ.js";import"./utils.DZj92Qv1.js";const te=async(e,o,u)=>{M.debug("Creating layers config",e,o,u);const a=[],s={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers",layerControlExpand:!0},layers:[]};for(const y of o){let m;u?m=await y.createLayersJson(new Date(u)):m=await y.createLayersJson(),m.forEach(i=>{i.properties.layerControlExpand=!0,i.properties.layerControlToolsExpand=!0}),s.layers.push(...m)}a.push(s);const d=await Q.getIndicatorLayers(e),f=Q.getObservationPointsLayer(o);f&&s.layers.unshift(f);const v={type:"Group",properties:{id:"BaseLayersGroup",title:"Base Layers"},layers:[]},r=d.filter(y=>y.properties.group==="baselayer");if(r.length){let y=0,m=0;for(let i=0;i<r.length;i++){const b=r[i];"visible"in b.properties||(b.properties.visible=!1),b.properties.visible&&(y++,m=i)}y===0&&(r[0].properties.visible=!0),y>0&&r.forEach((i,b)=>{b!==m?i.properties.visible=!1:i.properties.visible=!0}),v.layers.push(...r),v.layers.forEach(i=>{i.properties.layerControlExclusive=!0})}else v.layers.push({type:"Tile",properties:{id:"osm",title:"Background",layerControlExclusive:!0},source:{type:"OSM"}});v.layers.length&&a.push(v);const g={type:"Group",properties:{id:"OverlayGroup",title:"Overlay Layers"},layers:[]},x=d.filter(y=>y.properties.group==="overlay");return x.length&&(g.layers.push(...x),a.unshift(g)),a};let U=null;const Oe=(e,o)=>{const u=a=>{var v;const s=a.map,d=(v=e.value)==null?void 0:v.lonLatCenter,f=s==null?void 0:s.getView().getZoom();d&&!Number.isNaN(d[0])&&!Number.isNaN(d[1])&&!Number.isNaN(f)&&(o.value=[d[0],d[1],f])};ie(()=>{var a,s;(s=(a=e.value)==null?void 0:a.map)==null||s.on("moveend",u)}),ne(()=>{var a,s;(s=(a=e.value)==null?void 0:a.map)==null||s.un("moveend",u)})},re=(e,o,u,a,s,d,f)=>{M.debug("InitMap",e.value,o.value,u.values,a.value);const v=Pe([o,a],async([r,g],[x,y])=>{var m,i,b,j,V,h,C,F,G,J,Z,S,B,n,l,w;if(r){M.debug("Selected Indicator watch triggered",r,g),((m=e==null?void 0:e.value)==null?void 0:m.id)==="main"&&U!==null&&((i=e==null?void 0:e.value)==null||i.map.setView(U),U=null);let p=[];const z=(r==null?void 0:r.id)===(x==null?void 0:x.id)&&g!==y,{selectedCompareStac:T}=H(W());if(((b=e==null?void 0:e.value)==null?void 0:b.id)==="main"?await xe(r):T.value!==null&&(U=((j=e==null?void 0:e.value)==null?void 0:j.map.getView())??null,e.value.sync=d.value),z){p=await te(r,u,g),M.debug("Assigned layers after changing time only",JSON.parse(JSON.stringify(p))),s.value=p,X(((V=e.value)==null?void 0:V.id)==="compare"?"compareTime:updated":"time:updated",e.value,p);return}p=await te(r,u,a.value);let P=null;const A=(C=(h=r==null?void 0:r.extent)==null?void 0:h.temporal)==null?void 0:C.interval;if(A&&A.length>0&&A[0].length>1&&(P=new Date(A[0][1]),M.debug("Indicator load: found stac extent, setting time to latest value",P)),P!==null&&P.toISOString()!==a.value&&!K.value&&(a.value=P.toISOString()),f&&((F=e==null?void 0:e.value)==null?void 0:F.id)==="main"&&(G=r.extent)!=null&&G.spatial.bbox&&!(K.value&&((J=I.value)!=null&&J[0])&&((Z=I.value)!=null&&Z[1]))){const t=(S=r.extent)==null?void 0:S.spatial.bbox[0],le=[(t==null?void 0:t[0])>-180?t==null?void 0:t[0]:-180,(t==null?void 0:t[1])>-90?t==null?void 0:t[1]:-90,(t==null?void 0:t[2])<180?t==null?void 0:t[2]:180,(t==null?void 0:t[3])<90?t==null?void 0:t[3]:90],pe=(l=e.value)==null?void 0:l.transformExtent(le,"EPSG:4326",(n=(B=e.value)==null?void 0:B.map)==null?void 0:n.getView().getProjection());e.value.zoomExtent=pe}M.debug("Assigned layers",JSON.parse(JSON.stringify(p))),s.value=p,await X(((w=e.value)==null?void 0:w.id)==="compare"?"compareLayers:updated":"layers:updated",e.value,s.value)}},{immediate:!0});ne(()=>{v()})},ae=(e,o)=>{ye(async(u,a)=>{if(u.includes("compare"))return;const s=[];for(const d of e)s.push(...await d.getToolTipProperties());o.value=s,M.debug("Updated tooltip properties",o.value)})},Ne="#cursor-coordinates[data-v-8d648956]{position:fixed;left:24px;bottom:54px;color:#000000e6;font-size:11px;font-family:var(--eox-body-font-family);background:#fffe;border-radius:4px;border:none;padding:0 3px;max-height:24px}@media (max-width: 959px){#cursor-coordinates[data-v-8d648956]{display:none}}#scale-line[data-v-8d648956]{position:fixed;left:24px;bottom:28px;color:#fff}@media (max-width: 959px){#scale-line[data-v-8d648956]{bottom:102px}}[data-v-8d648956] .ol-scale-line{background:#fffe!important;border-radius:4px!important;border:none!important;padding:0 3px 3px!important;font-size:10px!important;font-family:var(--eox-body-font-family);max-height:20px}[data-v-8d648956] .ol-scale-line-inner{display:flex;justify-content:center;border:1px solid rgba(0,0,0,.5)!important;border-top:none!important;color:#333!important;font-weight:500!important;transform:translateY(1px)}.map-buttons-container[data-v-8d648956]{position:fixed;top:0;left:0;width:100%;height:100%;display:grid;grid-template-columns:repeat(12,1fr);grid-template-rows:repeat(12,1fr);pointer-events:none;z-index:1}.map-buttons-container[data-v-8d648956]>*{pointer-events:auto}",Le=[".enabled"],Ie=[".center",".zoom",".layers",".controls"],Me=[".propertyTransform"],Te=[".layers"],_e=[".propertyTransform"],ke={key:0,id:"cursor-coordinates",ref:"cursor-coords"},je={key:1,id:"scale-line",ref:"scale-line"};var se;const Se={__name:"index",props:{enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>{var e,o;return[((e=I.value)==null?void 0:e[0])??15,((o=I.value)==null?void 0:o[1])??48]}},zoom:{type:Number,default:((se=I.value)==null?void 0:se[2])??4},zoomToExtent:{type:Boolean,default:!0},enableCursorCoordinates:{type:Boolean,default:!0},enableScaleLine:{type:Boolean,default:!0},btnsPosition:{type:Object,default:()=>({x:"12/9/10",y:1,gap:16})},btns:{type:Object,default:()=>({enableExportMap:!0,enableChangeProjection:!0,enableCompareIndicators:!0,enableBackToPOIs:!0,enableSearch:!0,enableZoom:!0})}},setup(e){var B;const o=e,{width:u}=ue(),a=n=>{if(typeof n=="number")return n;if(typeof n=="string"){const l=n.split("/"),w=u.value;return w<960?parseInt(l[0])||1:w<1920?parseInt(l[1]||l[0])||1:parseInt(l[2]||l[1]||l[0])||1}return 1},s=L(()=>a(o.btnsPosition.x)),d=L(()=>a(o.btnsPosition.y)),f=L(()=>({exportMap:o.btns.enableExportMap??!0,changeProjection:o.btns.enableChangeProjection??!0,compareIndicators:o.btns.enableCompareIndicators??!0,backToPOIs:o.btns.enableBackToPOIs??!0,enableSearch:o.btns.enableSearch??!0,enableZoom:o.btns.enableZoom??!0})),v=E("scale-line"),r=E("cursor-coords"),g=_([]),x=_([]),y=L(()=>{const n={Attribution:{collapsible:!0}};return o.enableScaleLine&&v.value&&(n.ScaleLine={target:v.value}),o.enableCursorCoordinates&&r.value&&(n.MousePosition={projection:"EPSG:4326",coordinateFormat:l=>`${l[1].toFixed(3)} °N, ${l[0].toFixed(3)} °E`,target:r.value}),n}),m=ee(o.center),i=ee(((B=I.value)==null?void 0:B[2])??o.zoom),b=_([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),j=_([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),V={duration:1200,easing:he},h=_(null),C=_(null),{selectedCompareStac:F}=H(W()),G=L(()=>o.enableCompare&&F.value?"":"first");Oe(h,I),ie(()=>{const{selectedCompareStac:n,selectedStac:l}=H(W());de.value=h.value,o.enableCompare&&(fe.value=C.value),o.enableCompare&&(re(C,n,ge,Y,j,h,!1),ae(D,x)),re(h,l,D,Y,b,C,o.zoomToExtent)}),ae(D,g);const J=L(()=>({visibility:g.value.length?"visible":"hidden"})),Z=L(()=>({visibility:x.value.length?"visible":"hidden"})),S=n=>{const l=n==="main"?g:x,w=n=="main"?me:be;return p=>{const z=JSON.parse(ve.render(JSON.stringify(l.value),{...w.value??{}})),T=z==null?void 0:z.find(P=>P.id===p.key);if(T)return typeof p.value=="object"&&(p.value=JSON.stringify(p.value)),isNaN(Number(p.value))||(p.value=Number(p.value).toFixed(4).toString()),{key:T.title||T.id,value:p.value+" "+(T.appendix||"")}}};return(n,l)=>(q(),$("span",null,[k("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":G.value},[k("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:h,id:"main",".animationOptions":V,".center":c(m),".zoom":c(i),".layers":b.value,".controls":y.value},[k("eox-map-tooltip",{style:R(J.value),".propertyTransform":S("main")},null,44,Me)],40,Ie),k("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:C,".layers":j.value},[k("eox-map-tooltip",{style:R(Z.value),".propertyTransform":S("compare")},null,44,_e)],40,Te)],40,Le),e.enableCursorCoordinates?(q(),$("div",ke,null,512)):oe("v-if",!0),e.enableScaleLine?(q(),$("span",je,null,512)):oe("v-if",!0),k("div",{class:"map-buttons-container",style:R(`margin: ${e.btnsPosition.gap}px 0 ${e.btnsPosition.gap}px 0`)},[we(Ce,{style:R({gridColumn:c(O)||c(N)?s.value:"12",gridRow:d.value}),exportMap:c(O)||c(N)?f.value.exportMap:!1,changeProjection:c(O)||c(N)?f.value.changeProjection:!1,compareIndicators:c(O)||c(N)?f.value.compareIndicators:!1,backToPOIs:c(O)||c(N)?f.value.backToPOIs:!1,enableSearch:c(O)||c(N)?f.value.enableSearch:!1,enableZoom:c(O)||c(N)?f.value.enableZoom:!1},null,8,["style","exportMap","changeProjection","compareIndicators","backToPOIs","enableSearch","enableZoom"])],4)]))}},go=ce(Se,[["styles",[Ne]],["__scopeId","data-v-8d648956"]]);export{go as default};
