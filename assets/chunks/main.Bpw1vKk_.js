var $i=Object.defineProperty;var It=s=>{throw TypeError(s)};var Ji=(s,e,t)=>e in s?$i(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var V=(s,e,t)=>Ji(s,typeof e!="symbol"?e+"":e,t),et=(s,e,t)=>e.has(s)||It("Cannot "+t);var I=(s,e,t)=>(et(s,e,"read from private field"),t?t.call(s):e.get(s)),k=(s,e,t)=>e.has(s)?It("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),D=(s,e,t,i)=>(et(s,e,"write to private field"),i?i.call(s,t):e.set(s,t),t),Rt=(s,e,t)=>(et(s,e,"access private method"),t);import{r as _t,x as Y,E as Qi}from"./lit-element.Deg-YTNa.js";import{C as A,a as B,G as Ft,L as q}from"./Group.B92TqkVs.js";import{b as Re,E as v,T as en,l as E,u as F,B as Fe,V as tn,Q as nn,R as pt,S as be,U as ce,W as ii,d as Ke,a as kt,h as ni,O as Ue,g as M,X as Nt,L as si,Y as dt,p as sn,Z as rn,c as tt,_ as on,I as an,F as ln,$ as R,C as it,a0 as ri,a1 as At,a2 as oi,a3 as hn,a4 as yt,x as ai,t as cn,a5 as li,N as Dt,n as dn,a6 as un,a7 as gn,a8 as fn,i as mn}from"./extent.dxdZqxc7.js";import{P as hi,C as U,a as X,b as He,r as ci,c as le,d as Ae,e as de,l as _n,M as vt,W as pn,f as di,i as ui,s as gi,g as yn,R as vn,h as pe,B as Cn,j as bn,D as wn,T as En,V as j,k as xn,m as De,n as Mt,L as fi,K as Pn,o as Tn,p as ut,q as mi,t as Sn,u as Ln,v as ue,w as $e,x as Ot,y as _i,z as In,A as Rn,E as Fn,I as kn,F as Nn,G as An,H as Dn,J as Mn,N as On,O as Vn,Q as Gn,S as jn,U as zn,X as Kn,Y as Un,Z as Hn,_ as Wn,$ as Bn,a0 as Zn,a1 as Yn,a2 as qn,a3 as Xn,a4 as Vt,a5 as Gt,a6 as $n,a7 as Jn,a8 as Qn}from"./WMTS.CEIOrrZ9.js";import{s as es,r as pi,P as ke,e as ts,m as is,w as yi,f as jt,g as we,h as zt,i as S,j as ns,S as ss,k as rs,l as os,L as ye,n as as,o as ls,p as Je,q as W,u as Ct,v as hs,x as N,y as cs,a as z,d as ne,z as We,A as vi,B as ds,C as Be,D as us,E as gs,H as Kt,c as fs,b as Ci,M as bi,G as ms,R as _s,I as Ze,J as ps,K as wi,N as Ei,O as xi,Q as ys}from"./GeoJSON.DV_SCRZg.js";import{g as vs}from"./getElement.DO5DovG0.js";class ee extends Re{constructor(e,t,i){super(e),this.map=t,this.frameState=i!==void 0?i:null}}class H extends ee{constructor(e,t,i,n,r,o){super(e,t,r),this.originalEvent=i,this.pixel_=null,this.coordinate_=null,this.dragging=n!==void 0?n:!1,this.activePointers=o}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(e){this.pixel_=e}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(e){this.coordinate_=e}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}}const y={SINGLECLICK:"singleclick",CLICK:v.CLICK,DBLCLICK:v.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"},K={POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROUT:"pointerout"};class Cs extends en{constructor(e,t){super(e),this.map_=e,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=t===void 0?1:t,this.down_=null;const i=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=i,this.pointerdownListenerKey_=E(i,K.POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=E(i,K.POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(v.TOUCHMOVE,this.boundHandleTouchMove_,hi?{passive:!1}:!1)}emulateClick_(e){let t=new H(y.CLICK,this.map_,e);this.dispatchEvent(t),this.clickTimeoutId_!==void 0?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,t=new H(y.DBLCLICK,this.map_,e),this.dispatchEvent(t)):this.clickTimeoutId_=setTimeout(()=>{this.clickTimeoutId_=void 0;const i=new H(y.SINGLECLICK,this.map_,e);this.dispatchEvent(i)},250)}updateActivePointers_(e){const t=e,i=t.pointerId;if(t.type==y.POINTERUP||t.type==y.POINTERCANCEL){delete this.trackedTouches_[i];for(const n in this.trackedTouches_)if(this.trackedTouches_[n].target!==t.target){delete this.trackedTouches_[n];break}}else(t.type==y.POINTERDOWN||t.type==y.POINTERMOVE)&&(this.trackedTouches_[i]=t);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(e){this.updateActivePointers_(e);const t=new H(y.POINTERUP,this.map_,e,void 0,void 0,this.activePointers_);this.dispatchEvent(t),this.emulateClicks_&&!t.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(e)&&this.emulateClick_(this.down_),this.activePointers_.length===0&&(this.dragListenerKeys_.forEach(F),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(e){return e.button===0}handlePointerDown_(e){this.emulateClicks_=this.activePointers_.length===0,this.updateActivePointers_(e);const t=new H(y.POINTERDOWN,this.map_,e,void 0,void 0,this.activePointers_);if(this.dispatchEvent(t),this.down_=new PointerEvent(e.type,e),Object.defineProperty(this.down_,"target",{writable:!1,value:e.target}),this.dragListenerKeys_.length===0){const i=this.map_.getOwnerDocument();this.dragListenerKeys_.push(E(i,y.POINTERMOVE,this.handlePointerMove_,this),E(i,y.POINTERUP,this.handlePointerUp_,this),E(this.element_,y.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==i&&this.dragListenerKeys_.push(E(this.element_.getRootNode(),y.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(e){if(this.isMoving_(e)){this.updateActivePointers_(e),this.dragging_=!0;const t=new H(y.POINTERDRAG,this.map_,e,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(t)}}relayMoveEvent_(e){this.originalPointerMoveEvent_=e;const t=!!(this.down_&&this.isMoving_(e));this.dispatchEvent(new H(y.POINTERMOVE,this.map_,e,t))}handleTouchMove_(e){const t=this.originalPointerMoveEvent_;(!t||t.defaultPrevented)&&(typeof e.cancelable!="boolean"||e.cancelable===!0)&&e.preventDefault()}isMoving_(e){return this.dragging_||Math.abs(e.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(e.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&(F(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(v.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&(F(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(F),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const G={POSTRENDER:"postrender",MOVESTART:"movestart",MOVEEND:"moveend",LOADSTART:"loadstart",LOADEND:"loadend"},x={LAYERGROUP:"layergroup",SIZE:"size",TARGET:"target",VIEW:"view"};class O extends Fe{constructor(e){super();const t=e.element;t&&!e.target&&!t.style.pointerEvents&&(t.style.pointerEvents="auto"),this.element=t||null,this.target_=null,this.map_=null,this.listenerKeys=[],e.render&&(this.render=e.render),e.target&&this.setTarget(e.target)}disposeInternal(){var e;(e=this.element)==null||e.remove(),super.disposeInternal()}getMap(){return this.map_}setMap(e){var t;this.map_&&((t=this.element)==null||t.remove());for(let i=0,n=this.listenerKeys.length;i<n;++i)F(this.listenerKeys[i]);if(this.listenerKeys.length=0,this.map_=e,e){const i=this.target_??e.getOverlayContainerStopEvent();this.element&&i.appendChild(this.element),this.render!==tn&&this.listenerKeys.push(E(e,G.POSTRENDER,this.render,this)),e.render()}}render(e){}setTarget(e){this.target_=typeof e=="string"?document.getElementById(e):e}}class Pi extends O{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=e.collapsible!==void 0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.attributions_=e.attributions;const t=e.className!==void 0?e.className:"ol-attribution",i=e.tipLabel!==void 0?e.tipLabel:"Attributions",n=e.expandClassName!==void 0?e.expandClassName:t+"-expand",r=e.collapseLabel!==void 0?e.collapseLabel:"›",o=e.collapseClassName!==void 0?e.collapseClassName:t+"-collapse";typeof r=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=r,this.collapseLabel_.className=o):this.collapseLabel_=r;const a=e.label!==void 0?e.label:"i";typeof a=="string"?(this.label_=document.createElement("span"),this.label_.textContent=a,this.label_.className=n):this.label_=a;const l=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=i,this.toggleButton_.appendChild(l),this.toggleButton_.addEventListener(v.CLICK,this.handleClick_.bind(this),!1);const c=t+" "+U+" "+X+(this.collapsed_&&this.collapsible_?" "+He:"")+(this.collapsible_?"":" ol-uncollapsible"),h=this.element;h.className=c,h.appendChild(this.toggleButton_),h.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(e){const t=this.getMap().getAllLayers(),i=new Set(t.flatMap(n=>n.getAttributions(e)));if(this.attributions_!==void 0&&(Array.isArray(this.attributions_)?this.attributions_.forEach(n=>i.add(n)):i.add(this.attributions_)),!this.overrideCollapsible_){const n=!t.some(r=>{var o;return((o=r.getSource())==null?void 0:o.getAttributionsCollapsible())===!1});this.setCollapsible(n)}return Array.from(i)}async updateElement_(e){if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=await Promise.all(this.collectSourceAttributions_(e).map(n=>nn(()=>n))),i=t.length>0;if(this.renderedVisible_!=i&&(this.element.style.display=i?"":"none",this.renderedVisible_=i),!pt(t,this.renderedAttributions_)){ci(this.ulElement_);for(let n=0,r=t.length;n<r;++n){const o=document.createElement("li");o.innerHTML=t[n],this.ulElement_.appendChild(o)}this.renderedAttributions_=t}}handleClick_(e){e.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(He),this.collapsed_?le(this.collapseLabel_,this.label_):le(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(e){this.userCollapsed_=e,!(!this.collapsible_||this.collapsed_===e)&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(e){this.updateElement_(e.frameState)}}class Ti extends O{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target});const t=e.className!==void 0?e.className:"ol-rotate",i=e.label!==void 0?e.label:"⇧",n=e.compassClassName!==void 0?e.compassClassName:"ol-compass";this.label_=null,typeof i=="string"?(this.label_=document.createElement("span"),this.label_.className=n,this.label_.textContent=i):(this.label_=i,this.label_.classList.add(n));const r=e.tipLabel?e.tipLabel:"Reset rotation",o=document.createElement("button");o.className=t+"-reset",o.setAttribute("type","button"),o.title=r,o.appendChild(this.label_),o.addEventListener(v.CLICK,this.handleClick_.bind(this),!1);const a=t+" "+U+" "+X,l=this.element;l.className=a,l.appendChild(o),this.callResetNorth_=e.resetNorth?e.resetNorth:void 0,this.duration_=e.duration!==void 0?e.duration:250,this.autoHide_=e.autoHide!==void 0?e.autoHide:!0,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(Ae)}handleClick_(e){e.preventDefault(),this.callResetNorth_!==void 0?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const t=this.getMap().getView();if(!t)return;const i=t.getRotation();i!==void 0&&(this.duration_>0&&i%(2*Math.PI)!==0?t.animate({rotation:0,duration:this.duration_,easing:de}):t.setRotation(0))}render(e){const t=e.frameState;if(!t)return;const i=t.viewState.rotation;if(i!=this.rotation_){const n="rotate("+i+"rad)";if(this.autoHide_){const r=this.element.classList.contains(Ae);!r&&i===0?this.element.classList.add(Ae):r&&i!==0&&this.element.classList.remove(Ae)}this.label_.style.transform=n}this.rotation_=i}}class Si extends O{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target});const t=e.className!==void 0?e.className:"ol-zoom",i=e.delta!==void 0?e.delta:1,n=e.zoomInClassName!==void 0?e.zoomInClassName:t+"-in",r=e.zoomOutClassName!==void 0?e.zoomOutClassName:t+"-out",o=e.zoomInLabel!==void 0?e.zoomInLabel:"+",a=e.zoomOutLabel!==void 0?e.zoomOutLabel:"–",l=e.zoomInTipLabel!==void 0?e.zoomInTipLabel:"Zoom in",c=e.zoomOutTipLabel!==void 0?e.zoomOutTipLabel:"Zoom out",h=document.createElement("button");h.className=n,h.setAttribute("type","button"),h.title=l,h.appendChild(typeof o=="string"?document.createTextNode(o):o),h.addEventListener(v.CLICK,this.handleClick_.bind(this,i),!1);const g=document.createElement("button");g.className=r,g.setAttribute("type","button"),g.title=c,g.appendChild(typeof a=="string"?document.createTextNode(a):a),g.addEventListener(v.CLICK,this.handleClick_.bind(this,-i),!1);const d=t+" "+U+" "+X,u=this.element;u.className=d,u.appendChild(h),u.appendChild(g),this.duration_=e.duration!==void 0?e.duration:250}handleClick_(e,t){t.preventDefault(),this.zoomByDelta_(e)}zoomByDelta_(e){const i=this.getMap().getView();if(!i)return;const n=i.getZoom();if(n!==void 0){const r=i.getConstrainedZoom(n+e);this.duration_>0?(i.getAnimating()&&i.cancelAnimations(),i.animate({zoom:r,duration:this.duration_,easing:de})):i.setZoom(r)}}}function bs(s){s=s||{};const e=new A;return(s.zoom!==void 0?s.zoom:!0)&&e.push(new Si(s.zoomOptions)),(s.rotate!==void 0?s.rotate:!0)&&e.push(new Ti(s.rotateOptions)),(s.attribution!==void 0?s.attribution:!0)&&e.push(new Pi(s.attributionOptions)),e}class ws{constructor(e,t,i){this.decay_=e,this.minVelocity_=t,this.delay_=i,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(e,t){this.points_.push(e,t,Date.now())}end(){if(this.points_.length<6)return!1;const e=Date.now()-this.delay_,t=this.points_.length-3;if(this.points_[t+2]<e)return!1;let i=t-3;for(;i>0&&this.points_[i+2]>e;)i-=3;const n=this.points_[t+2]-this.points_[i+2];if(n<1e3/60)return!1;const r=this.points_[t]-this.points_[i],o=this.points_[t+1]-this.points_[i+1];return this.angle_=Math.atan2(o,r),this.initialVelocity_=Math.sqrt(r*r+o*o)/n,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}}const gt={ACTIVE:"active"};class Ne extends Fe{constructor(e){super(),this.on,this.once,this.un,e&&e.handleEvent&&(this.handleEvent=e.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(gt.ACTIVE)}getMap(){return this.map_}handleEvent(e){return!0}setActive(e){this.set(gt.ACTIVE,e)}setMap(e){this.map_=e}}function Es(s,e,t){const i=s.getCenterInternal();if(i){const n=[i[0]+e[0],i[1]+e[1]];s.animateInternal({duration:t!==void 0?t:250,easing:_n,center:s.getConstrainedCenter(n)})}}function bt(s,e,t,i){const n=s.getZoom();if(n===void 0)return;const r=s.getConstrainedZoom(n+e),o=s.getResolutionForZoom(r);s.getAnimating()&&s.cancelAnimations(),s.animate({resolution:o,anchor:t,duration:i!==void 0?i:250,easing:de})}class xs extends Ne{constructor(e){super(),e=e||{},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:250}handleEvent(e){let t=!1;if(e.type==y.DBLCLICK){const i=e.originalEvent,n=e.map,r=e.coordinate,o=i.shiftKey?-this.delta_:this.delta_,a=n.getView();bt(a,o,r,this.duration_),i.preventDefault(),t=!0}return!t}}function ft(s){const e=arguments;return function(t){let i=!0;for(let n=0,r=e.length;n<r&&(i=i&&e[n](t),!!i);++n);return i}}const Ps=function(s){const e=s.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Ts=function(s){const e=s.originalEvent;return e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Ss=function(s){const e=s.map.getTargetElement(),t=e.getRootNode(),i=s.map.getOwnerDocument().activeElement;return t instanceof ShadowRoot?t.host.contains(i):e.contains(i)},Li=function(s){const e=s.map.getTargetElement(),t=e.getRootNode();return(t instanceof ShadowRoot?t.host:e).hasAttribute("tabindex")?Ss(s):!0},Ye=be,Ii=function(s){const e=s.originalEvent;return e instanceof PointerEvent&&e.button==0&&!(pn&&vt&&e.ctrlKey)},Ls=ce,Is=function(s){return s.type==y.SINGLECLICK},wt=function(s){const e=s.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&!e.shiftKey},Ut=function(s){const e=s.originalEvent;return!e.altKey&&(vt?e.metaKey:e.ctrlKey)&&!e.shiftKey},Rs=function(s){const e=s.originalEvent;return vt?e.metaKey:e.ctrlKey},Ri=function(s){const e=s.originalEvent;return!e.altKey&&!(e.metaKey||e.ctrlKey)&&e.shiftKey},Fi=function(s){const e=s.originalEvent,t=e.target.tagName;return t!=="INPUT"&&t!=="SELECT"&&t!=="TEXTAREA"&&!e.target.isContentEditable},nt=function(s){const e=s.originalEvent;return e instanceof PointerEvent&&e.pointerType=="mouse"},ki=function(s){const e=s.originalEvent;return e instanceof PointerEvent&&e.isPrimary&&e.button===0};class $ extends Ne{constructor(e){e=e||{},super(e),e.handleDownEvent&&(this.handleDownEvent=e.handleDownEvent),e.handleDragEvent&&(this.handleDragEvent=e.handleDragEvent),e.handleMoveEvent&&(this.handleMoveEvent=e.handleMoveEvent),e.handleUpEvent&&(this.handleUpEvent=e.handleUpEvent),e.stopDown&&(this.stopDown=e.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(e){return!1}handleDragEvent(e){}handleEvent(e){if(!e.originalEvent)return!0;let t=!1;if(this.updateTrackedPointers_(e),this.handlingDownUpSequence){if(e.type==y.POINTERDRAG)this.handleDragEvent(e),e.originalEvent.preventDefault();else if(e.type==y.POINTERUP){const i=this.handleUpEvent(e);this.handlingDownUpSequence=i&&this.targetPointers.length>0}}else if(e.type==y.POINTERDOWN){const i=this.handleDownEvent(e);this.handlingDownUpSequence=i,t=this.stopDown(i)}else e.type==y.POINTERMOVE&&this.handleMoveEvent(e);return!t}handleMoveEvent(e){}handleUpEvent(e){return!1}stopDown(e){return e}updateTrackedPointers_(e){e.activePointers&&(this.targetPointers=e.activePointers)}}function Et(s){const e=s.length;let t=0,i=0;for(let n=0;n<e;n++)t+=s[n].clientX,i+=s[n].clientY;return{clientX:t/e,clientY:i/e}}class ve extends ${constructor(e){super({stopDown:ce}),e=e||{},this.kinetic_=e.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const t=e.condition?e.condition:ft(wt,ki);this.condition_=e.onFocusOnly?ft(Li,t):t,this.noKinetic_=!1}handleDragEvent(e){const t=e.map;this.panning_||(this.panning_=!0,t.getView().beginInteraction());const i=this.targetPointers,n=t.getEventPixel(Et(i));if(i.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(n[0],n[1]),this.lastCentroid){const r=[this.lastCentroid[0]-n[0],n[1]-this.lastCentroid[1]],a=e.map.getView();es(r,a.getResolution()),pi(r,a.getRotation()),a.adjustCenterInternal(r)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=n,this.lastPointersCount_=i.length,e.originalEvent.preventDefault()}handleUpEvent(e){const t=e.map,i=t.getView();if(this.targetPointers.length===0){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const n=this.kinetic_.getDistance(),r=this.kinetic_.getAngle(),o=i.getCenterInternal(),a=t.getPixelFromCoordinateInternal(o),l=t.getCoordinateFromPixelInternal([a[0]-n*Math.cos(r),a[1]-n*Math.sin(r)]);i.animateInternal({center:i.getConstrainedCenter(l),duration:500,easing:de})}return this.panning_&&(this.panning_=!1,i.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(e){if(this.targetPointers.length>0&&this.condition_(e)){const i=e.map.getView();return this.lastCentroid=null,i.getAnimating()&&i.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}class Fs extends ${constructor(e){e=e||{},super({stopDown:ce}),this.condition_=e.condition?e.condition:Ts,this.lastAngle_=void 0,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){if(!nt(e))return;const t=e.map,i=t.getView();if(i.getConstraints().rotation===di)return;const n=t.getSize(),r=e.pixel,o=Math.atan2(n[1]/2-r[1],r[0]-n[0]/2);if(this.lastAngle_!==void 0){const a=o-this.lastAngle_;i.adjustRotationInternal(-a)}this.lastAngle_=o}handleUpEvent(e){return nt(e)?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){return nt(e)&&Ii(e)&&this.condition_(e)?(e.map.getView().beginInteraction(),this.lastAngle_=void 0,!0):!1}}class ks extends ii{constructor(e){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+e,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const e=this.startPixel_,t=this.endPixel_,i="px",n=this.element_.style;n.left=Math.min(e[0],t[0])+i,n.top=Math.min(e[1],t[1])+i,n.width=Math.abs(t[0]-e[0])+i,n.height=Math.abs(t[1]-e[1])+i}setMap(e){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const t=this.element_.style;t.left="inherit",t.top="inherit",t.width="inherit",t.height="inherit"}this.map_=e,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(e,t){this.startPixel_=e,this.endPixel_=t,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){if(!this.map_)return;const e=this.startPixel_,t=this.endPixel_,n=[e,[e[0],t[1]],t,[t[0],e[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);n[4]=n[0].slice(),this.geometry_?this.geometry_.setCoordinates([n]):this.geometry_=new ke([n])}getGeometry(){return this.geometry_}}const Q={BOXSTART:"boxstart",BOXDRAG:"boxdrag",BOXEND:"boxend",BOXCANCEL:"boxcancel"};class fe extends Re{constructor(e,t,i){super(e),this.coordinate=t,this.mapBrowserEvent=i}}class Ns extends ${constructor(e){super(),this.on,this.once,this.un,e=e??{},this.box_=new ks(e.className||"ol-dragbox"),this.minArea_=e.minArea??64,e.onBoxEnd&&(this.onBoxEnd=e.onBoxEnd),this.startPixel_=null,this.condition_=e.condition??Ii,this.boxEndCondition_=e.boxEndCondition??this.defaultBoxEndCondition}defaultBoxEndCondition(e,t,i){const n=i[0]-t[0],r=i[1]-t[1];return n*n+r*r>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(e){this.startPixel_&&(this.box_.setPixels(this.startPixel_,e.pixel),this.dispatchEvent(new fe(Q.BOXDRAG,e.coordinate,e)))}handleUpEvent(e){if(!this.startPixel_)return!1;const t=this.boxEndCondition_(e,this.startPixel_,e.pixel);return t&&this.onBoxEnd(e),this.dispatchEvent(new fe(t?Q.BOXEND:Q.BOXCANCEL,e.coordinate,e)),this.box_.setMap(null),this.startPixel_=null,!1}handleDownEvent(e){return this.condition_(e)?(this.startPixel_=e.pixel,this.box_.setMap(e.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new fe(Q.BOXSTART,e.coordinate,e)),!0):!1}onBoxEnd(e){}setActive(e){e||(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new fe(Q.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setActive(e)}setMap(e){this.getMap()&&(this.box_.setMap(null),this.startPixel_&&(this.dispatchEvent(new fe(Q.BOXCANCEL,this.startPixel_,null)),this.startPixel_=null)),super.setMap(e)}}class As extends Ns{constructor(e){e=e||{};const t=e.condition?e.condition:Ri;super({condition:t,className:e.className||"ol-dragzoom",minArea:e.minArea}),this.duration_=e.duration!==void 0?e.duration:200,this.out_=e.out!==void 0?e.out:!1}onBoxEnd(e){const i=this.getMap().getView();let n=this.getGeometry();if(this.out_){const r=i.rotatedExtentForGeometry(n),o=i.getResolutionForExtentInternal(r),a=i.getResolution()/o;n=n.clone(),n.scale(a*a)}i.fitInternal(n,{duration:this.duration_,easing:de})}}const Z={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",DOWN:"ArrowDown"};class Ds extends Ne{constructor(e){super(),e=e||{},this.defaultCondition_=function(t){return wt(t)&&Fi(t)},this.condition_=e.condition!==void 0?e.condition:this.defaultCondition_,this.duration_=e.duration!==void 0?e.duration:100,this.pixelDelta_=e.pixelDelta!==void 0?e.pixelDelta:128}handleEvent(e){let t=!1;if(e.type==v.KEYDOWN){const i=e.originalEvent,n=i.key;if(this.condition_(e)&&(n==Z.DOWN||n==Z.LEFT||n==Z.RIGHT||n==Z.UP)){const o=e.map.getView(),a=o.getResolution()*this.pixelDelta_;let l=0,c=0;n==Z.DOWN?c=-a:n==Z.LEFT?l=-a:n==Z.RIGHT?l=a:c=a;const h=[l,c];pi(h,o.getRotation()),Es(o,h,this.duration_),i.preventDefault(),t=!0}}return!t}}class Ms extends Ne{constructor(e){super(),e=e||{},this.condition_=e.condition?e.condition:function(t){return!Rs(t)&&Fi(t)},this.delta_=e.delta?e.delta:1,this.duration_=e.duration!==void 0?e.duration:100}handleEvent(e){let t=!1;if(e.type==v.KEYDOWN||e.type==v.KEYPRESS){const i=e.originalEvent,n=i.key;if(this.condition_(e)&&(n==="+"||n==="-")){const r=e.map,o=n==="+"?this.delta_:-this.delta_,a=r.getView();bt(a,o,void 0,this.duration_),i.preventDefault(),t=!0}}return!t}}class qe extends Ne{constructor(e){e=e||{},super(e),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=e.maxDelta!==void 0?e.maxDelta:1,this.duration_=e.duration!==void 0?e.duration:250,this.timeout_=e.timeout!==void 0?e.timeout:80,this.useAnchor_=e.useAnchor!==void 0?e.useAnchor:!0,this.constrainResolution_=e.constrainResolution!==void 0?e.constrainResolution:!1;const t=e.condition?e.condition:Ye;this.condition_=e.onFocusOnly?ft(Li,t):t,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const e=this.getMap();if(!e)return;e.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null)}handleEvent(e){if(!this.condition_(e)||e.type!==v.WHEEL)return!0;const i=e.map,n=e.originalEvent;n.preventDefault(),this.useAnchor_&&(this.lastAnchor_=e.pixel);let r;if(e.type==v.WHEEL&&(r=n.deltaY,n.deltaMode===WheelEvent.DOM_DELTA_LINE&&(r*=40)),r===0)return!1;this.lastDelta_=r;const o=Date.now();this.startTime_===void 0&&(this.startTime_=o),(!this.mode_||o-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(r)<4?"trackpad":"wheel");const a=i.getView();if(this.mode_==="trackpad"&&!(a.getConstrainResolution()||this.constrainResolution_))return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(a.getAnimating()&&a.cancelAnimations(),a.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),a.adjustZoom(-r/this.deltaPerZoom_,this.lastAnchor_?i.getCoordinateFromPixel(this.lastAnchor_):null),this.startTime_=o,!1;this.totalDelta_+=r;const l=Math.max(this.timeout_-(o-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,i),l),!1}handleWheelZoom_(e){const t=e.getView();t.getAnimating()&&t.cancelAnimations();let i=-Ke(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(t.getConstrainResolution()||this.constrainResolution_)&&(i=i?i>0?1:-1:0),bt(t,i,this.lastAnchor_?e.getCoordinateFromPixel(this.lastAnchor_):null,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(e){this.useAnchor_=e,e||(this.lastAnchor_=null)}}class Os extends ${constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=ce),super(t),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=e.threshold!==void 0?e.threshold:.3,this.duration_=e.duration!==void 0?e.duration:250}handleDragEvent(e){let t=0;const i=this.targetPointers[0],n=this.targetPointers[1],r=Math.atan2(n.clientY-i.clientY,n.clientX-i.clientX);if(this.lastAngle_!==void 0){const l=r-this.lastAngle_;this.rotationDelta_+=l,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),t=l}this.lastAngle_=r;const o=e.map,a=o.getView();a.getConstraints().rotation!==di&&(this.anchor_=o.getCoordinateFromPixelInternal(o.getEventPixel(Et(this.targetPointers))),this.rotating_&&(o.render(),a.adjustRotationInternal(t,this.anchor_)))}handleUpEvent(e){return this.targetPointers.length<2?(e.map.getView().endInteraction(this.duration_),!1):!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}class Vs extends ${constructor(e){e=e||{};const t=e;t.stopDown||(t.stopDown=ce),super(t),this.anchor_=null,this.duration_=e.duration!==void 0?e.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(e){let t=1;const i=this.targetPointers[0],n=this.targetPointers[1],r=i.clientX-n.clientX,o=i.clientY-n.clientY,a=Math.sqrt(r*r+o*o);this.lastDistance_!==void 0&&(t=this.lastDistance_/a),this.lastDistance_=a;const l=e.map,c=l.getView();t!=1&&(this.lastScaleDelta_=t),this.anchor_=l.getCoordinateFromPixelInternal(l.getEventPixel(Et(this.targetPointers))),l.render(),c.adjustResolutionInternal(t,this.anchor_)}handleUpEvent(e){if(this.targetPointers.length<2){const i=e.map.getView(),n=this.lastScaleDelta_>1?1:-1;return i.endInteraction(this.duration_,n),!1}return!0}handleDownEvent(e){if(this.targetPointers.length>=2){const t=e.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||t.getView().beginInteraction(),!0}return!1}}function Gs(s){s=s||{};const e=new A,t=new ws(-.005,.05,100);return(s.altShiftDragRotate!==void 0?s.altShiftDragRotate:!0)&&e.push(new Fs),(s.doubleClickZoom!==void 0?s.doubleClickZoom:!0)&&e.push(new xs({delta:s.zoomDelta,duration:s.zoomDuration})),(s.dragPan!==void 0?s.dragPan:!0)&&e.push(new ve({onFocusOnly:s.onFocusOnly,kinetic:t})),(s.pinchRotate!==void 0?s.pinchRotate:!0)&&e.push(new Os),(s.pinchZoom!==void 0?s.pinchZoom:!0)&&e.push(new Vs({duration:s.zoomDuration})),(s.keyboard!==void 0?s.keyboard:!0)&&(e.push(new Ds),e.push(new Ms({delta:s.zoomDelta,duration:s.zoomDuration}))),(s.mouseWheelZoom!==void 0?s.mouseWheelZoom:!0)&&e.push(new qe({onFocusOnly:s.onFocusOnly,duration:s.zoomDuration})),(s.shiftDragZoom!==void 0?s.shiftDragZoom:!0)&&e.push(new As({duration:s.zoomDuration})),e}class js extends ii{constructor(e){super(),this.map_=e}dispatchRenderEvent(e,t){kt()}calculateMatrices2D(e){const t=e.viewState,i=e.coordinateToPixelTransform,n=e.pixelToCoordinateTransform;ts(i,e.size[0]/2,e.size[1]/2,1/t.resolution,-1/t.resolution,-t.rotation,-t.center[0],-t.center[1]),is(n,i)}forEachFeatureAtCoordinate(e,t,i,n,r,o,a,l){let c;const h=t.viewState;function g(C,L,ge,J){return r.call(o,L,C?ge:null,J)}const d=h.projection,u=yi(e.slice(),d),f=[[0,0]];if(d.canWrapX()&&n){const C=d.getExtent(),L=ni(C);f.push([-L,0],[L,0])}const m=t.layerStatesArray,_=m.length,p=[],b=[];for(let C=0;C<f.length;C++)for(let L=_-1;L>=0;--L){const ge=m[L],J=ge.layer;if(J.hasRenderer()&&ui(ge,h)&&a.call(l,J)){const Tt=J.getRenderer(),St=J.getSource();if(Tt&&St){const Lt=St.getWrapX()?u:e,Xi=g.bind(null,ge.managed);b[0]=Lt[0]+f[C][0],b[1]=Lt[1]+f[C][1],c=Tt.forEachFeatureAtCoordinate(b,t,i,Xi,p)}if(c)return c}}if(p.length===0)return;const P=1/p.length;return p.forEach((C,L)=>C.distanceSq+=L*P),p.sort((C,L)=>C.distanceSq-L.distanceSq),p.some(C=>c=C.callback(C.feature,C.layer,C.geometry)),c}hasFeatureAtCoordinate(e,t,i,n,r,o){return this.forEachFeatureAtCoordinate(e,t,i,n,be,this,r,o)!==void 0}getMap(){return this.map_}renderFrame(e){kt()}scheduleExpireIconCache(e){gi.canExpireCache()&&e.postRenderFunctions.push(zs)}}function zs(s,e){gi.expire()}class Ks extends js{constructor(e){super(e),this.fontChangeListenerKey_=E(yn,Ue.PROPERTYCHANGE,e.redrawText,e),this.element_=document.createElement("div");const t=this.element_.style;t.position="absolute",t.width="100%",t.height="100%",t.zIndex="0",this.element_.className=U+" ol-layers";const i=e.getViewport();i.insertBefore(this.element_,i.firstChild||null),this.children_=[],this.renderedVisible_=!0}dispatchRenderEvent(e,t){const i=this.getMap();if(i.hasListener(e)){const n=new vn(e,void 0,t);i.dispatchEvent(n)}}disposeInternal(){F(this.fontChangeListenerKey_),this.element_.remove(),super.disposeInternal()}renderFrame(e){if(!e){this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1);return}this.calculateMatrices2D(e),this.dispatchRenderEvent(pe.PRECOMPOSE,e);const t=e.layerStatesArray.sort((a,l)=>a.zIndex-l.zIndex);t.some(a=>a.layer instanceof Cn&&a.layer.getDeclutter())&&(e.declutter={});const n=e.viewState;this.children_.length=0;const r=[];let o=null;for(let a=0,l=t.length;a<l;++a){const c=t[a];e.layerIndex=a;const h=c.layer,g=h.getSourceState();if(!ui(c,n)||g!="ready"&&g!="undefined"){h.unrender();continue}const d=h.render(e,o);d&&(d!==o&&(this.children_.push(d),o=d),r.push(c))}this.declutter(e,r),bn(this.element_,this.children_),this.dispatchRenderEvent(pe.POSTCOMPOSE,e),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(e)}declutter(e,t){if(e.declutter){for(let i=t.length-1;i>=0;--i){const n=t[i],r=n.layer;r.getDeclutter()&&r.renderDeclutter(e,n)}t.forEach(i=>i.layer.renderDeferred(e))}}}function Ni(s){if(s instanceof fi){s.setMapInternal(null);return}s instanceof q&&s.getLayers().forEach(Ni)}function Ai(s,e){if(s instanceof fi){s.setMapInternal(e);return}if(s instanceof q){const t=s.getLayers().getArray();for(let i=0,n=t.length;i<n;++i)Ai(t[i],e)}}class Di extends Fe{constructor(e){super(),e=e||{},this.on,this.once,this.un;const t=Us(e);this.renderComplete_=!1,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=e.maxTilesLoading!==void 0?e.maxTilesLoading:16,this.pixelRatio_=e.pixelRatio!==void 0?e.pixelRatio:wn,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=jt(),this.pixelToCoordinateTransform_=jt(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=e.moveTolerance,this.keyboardEventTarget_=t.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver(()=>this.updateSize()),this.controls=t.controls||bs(),this.interactions=t.interactions||Gs({onFocusOnly:!0}),this.overlays_=t.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new En(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(x.LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(x.VIEW,this.handleViewChanged_),this.addChangeListener(x.SIZE,this.handleSizeChanged_),this.addChangeListener(x.TARGET,this.handleTargetChanged_),this.setProperties(t.values);const i=this;e.view&&!(e.view instanceof j)&&e.view.then(function(n){i.setView(new j(n))}),this.controls.addEventListener(B.ADD,n=>{n.element.setMap(this)}),this.controls.addEventListener(B.REMOVE,n=>{n.element.setMap(null)}),this.interactions.addEventListener(B.ADD,n=>{n.element.setMap(this)}),this.interactions.addEventListener(B.REMOVE,n=>{n.element.setMap(null)}),this.overlays_.addEventListener(B.ADD,n=>{this.addOverlayInternal_(n.element)}),this.overlays_.addEventListener(B.REMOVE,n=>{const r=n.element.getId();r!==void 0&&delete this.overlayIdIndex_[r.toString()],n.element.setMap(null)}),this.controls.forEach(n=>{n.setMap(this)}),this.interactions.forEach(n=>{n.setMap(this)}),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(e){this.getControls().push(e)}addInteraction(e){this.getInteractions().push(e)}addLayer(e){this.getLayerGroup().getLayers().push(e)}handleLayerAdd_(e){Ai(e.layer,this)}addOverlay(e){this.getOverlays().push(e)}addOverlayInternal_(e){const t=e.getId();t!==void 0&&(this.overlayIdIndex_[t.toString()]=e),e.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(e,t,i){if(!this.frameState_||!this.renderer_)return;const n=this.getCoordinateFromPixelInternal(e);i=i!==void 0?i:{};const r=i.hitTolerance!==void 0?i.hitTolerance:0,o=i.layerFilter!==void 0?i.layerFilter:be,a=i.checkWrapped!==!1;return this.renderer_.forEachFeatureAtCoordinate(n,this.frameState_,r,a,t,null,o,null)}getFeaturesAtPixel(e,t){const i=[];return this.forEachFeatureAtPixel(e,function(n){i.push(n)},t),i}getAllLayers(){const e=[];function t(i){i.forEach(function(n){n instanceof q?t(n.getLayers()):e.push(n)})}return t(this.getLayers()),e}hasFeatureAtPixel(e,t){if(!this.frameState_||!this.renderer_)return!1;const i=this.getCoordinateFromPixelInternal(e);t=t!==void 0?t:{};const n=t.layerFilter!==void 0?t.layerFilter:be,r=t.hitTolerance!==void 0?t.hitTolerance:0,o=t.checkWrapped!==!1;return this.renderer_.hasFeatureAtCoordinate(i,this.frameState_,r,o,n,null)}getEventCoordinate(e){return this.getCoordinateFromPixel(this.getEventPixel(e))}getEventCoordinateInternal(e){return this.getCoordinateFromPixelInternal(this.getEventPixel(e))}getEventPixel(e){const i=this.viewport_.getBoundingClientRect(),n=this.getSize(),r=i.width/n[0],o=i.height/n[1],a="changedTouches"in e?e.changedTouches[0]:e;return[(a.clientX-i.left)/r,(a.clientY-i.top)/o]}getTarget(){return this.get(x.TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(e){return we(this.getCoordinateFromPixelInternal(e),this.getView().getProjection())}getCoordinateFromPixelInternal(e){const t=this.frameState_;return t?zt(t.pixelToCoordinateTransform,e.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(e){const t=this.overlayIdIndex_[e.toString()];return t!==void 0?t:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(x.LAYERGROUP)}setLayers(e){const t=this.getLayerGroup();if(e instanceof A){t.setLayers(e);return}const i=t.getLayers();i.clear(),i.extend(e)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t];if(!n.visible)continue;const r=n.layer.getRenderer();if(r&&!r.ready)return!0;const o=n.layer.getSource();if(o&&o.loading)return!0}return!1}getPixelFromCoordinate(e){const t=S(e,this.getView().getProjection());return this.getPixelFromCoordinateInternal(t)}getPixelFromCoordinateInternal(e){const t=this.frameState_;return t?zt(t.coordinateToPixelTransform,e.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(x.SIZE)}getView(){return this.get(x.VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const e=this.getTargetElement();return e?e.ownerDocument:document}getTilePriority(e,t,i,n){return xn(this.frameState_,e,t,i,n)}handleBrowserEvent(e,t){t=t||e.type;const i=new H(t,this,e);this.handleMapBrowserEvent(i)}handleMapBrowserEvent(e){if(!this.frameState_)return;const t=e.originalEvent,i=t.type;if(i===K.POINTERDOWN||i===v.WHEEL||i===v.KEYDOWN){const n=this.getOwnerDocument(),r=this.viewport_.getRootNode?this.viewport_.getRootNode():n,o=t.target,a=r instanceof ShadowRoot?r.host===o?r.host.ownerDocument:r:r===n?n.documentElement:r;if(this.overlayContainerStopEvent_.contains(o)||!a.contains(o))return}if(e.frameState=this.frameState_,this.dispatchEvent(e)!==!1){const n=this.getInteractions().getArray().slice();for(let r=n.length-1;r>=0;r--){const o=n[r];if(o.getMap()!==this||!o.getActive()||!this.getTargetElement())continue;if(!o.handleEvent(e)||e.propagationStopped)break}}}handlePostRender(){const e=this.frameState_,t=this.tileQueue_;if(!t.isEmpty()){let n=this.maxTilesLoading_,r=n;if(e){const o=e.viewHints;if(o[De.ANIMATING]||o[De.INTERACTING]){const a=Date.now()-e.time>8;n=a?0:8,r=a?0:2}}t.getTilesLoading()<n&&(t.reprioritize(),t.loadMoreTiles(n,r))}e&&this.renderer_&&!e.animate&&(this.renderComplete_?(this.hasListener(pe.RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(pe.RENDERCOMPLETE,e),this.loaded_===!1&&(this.loaded_=!0,this.dispatchEvent(new ee(G.LOADEND,this,e)))):this.loaded_===!0&&(this.loaded_=!1,this.dispatchEvent(new ee(G.LOADSTART,this,e))));const i=this.postRenderFunctions_;if(e)for(let n=0,r=i.length;n<r;++n)i[n](this,e);i.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,n=this.targetChangeHandlerKeys_.length;i<n;++i)F(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(v.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(v.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,this.viewport_.remove()}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const i=this.targetElement_.getRootNode();i instanceof ShadowRoot&&this.resizeObserver_.unobserve(i.host),this.setSize(void 0)}const e=this.getTarget(),t=typeof e=="string"?document.getElementById(e):e;if(this.targetElement_=t,!t)this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);else{t.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Ks(this)),this.mapBrowserEventHandler_=new Cs(this,this.moveTolerance_);for(const r in y)this.mapBrowserEventHandler_.addEventListener(y[r],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(v.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(v.WHEEL,this.boundHandleBrowserEvent_,hi?{passive:!1}:!1);let i;if(this.keyboardEventTarget_)i=this.keyboardEventTarget_;else{const r=t.getRootNode();i=r instanceof ShadowRoot?r.host:t}this.targetChangeHandlerKeys_=[E(i,v.KEYDOWN,this.handleBrowserEvent,this),E(i,v.KEYPRESS,this.handleBrowserEvent,this)];const n=t.getRootNode();n instanceof ShadowRoot&&this.resizeObserver_.observe(n.host),this.resizeObserver_.observe(t)}this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&(F(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&(F(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const e=this.getView();e&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=E(e,Ue.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=E(e,v.CHANGE,this.handleViewPropertyChanged_,this),e.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(F),this.layerGroupPropertyListenerKeys_=null);const e=this.getLayerGroup();e&&(this.handleLayerAdd_(new Ft("addlayer",e)),this.layerGroupPropertyListenerKeys_=[E(e,Ue.PROPERTYCHANGE,this.render,this),E(e,v.CHANGE,this.render,this),E(e,"addlayer",this.handleLayerAdd_,this),E(e,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const e=this.getLayerGroup().getLayerStatesArray();for(let t=0,i=e.length;t<i;++t){const n=e[t].layer;n.hasRenderer()&&n.getRenderer().handleFontsChanged()}}render(){this.renderer_&&this.animationDelayKey_===void 0&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}removeControl(e){return this.getControls().remove(e)}removeInteraction(e){return this.getInteractions().remove(e)}removeLayer(e){return this.getLayerGroup().getLayers().remove(e)}handleLayerRemove_(e){Ni(e.layer)}removeOverlay(e){return this.getOverlays().remove(e)}renderFrame_(e){const t=this.getSize(),i=this.getView(),n=this.frameState_;let r=null;if(t!==void 0&&Mt(t)&&i&&i.isDef()){const o=i.getHints(this.frameState_?this.frameState_.viewHints:void 0),a=i.getState();if(r={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutter:null,extent:Nt(a.center,a.resolution,a.rotation,t),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size:t,tileQueue:this.tileQueue_,time:e,usedTiles:{},viewState:a,viewHints:o,wantedTiles:{},mapId:M(this),renderTargets:{}},a.nextCenter&&a.nextResolution){const l=isNaN(a.nextRotation)?a.rotation:a.nextRotation;r.nextExtent=Nt(a.nextCenter,a.nextResolution,l,t)}}this.frameState_=r,this.renderer_.renderFrame(r),r&&(r.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,r.postRenderFunctions),n&&(!this.previousExtent_||!si(this.previousExtent_)&&!dt(r.extent,this.previousExtent_))&&(this.dispatchEvent(new ee(G.MOVESTART,this,n)),this.previousExtent_=sn(this.previousExtent_)),this.previousExtent_&&!r.viewHints[De.ANIMATING]&&!r.viewHints[De.INTERACTING]&&!dt(r.extent,this.previousExtent_)&&(this.dispatchEvent(new ee(G.MOVEEND,this,r)),rn(r.extent,this.previousExtent_))),this.dispatchEvent(new ee(G.POSTRENDER,this,r)),this.renderComplete_=(this.hasListener(G.LOADSTART)||this.hasListener(G.LOADEND)||this.hasListener(pe.RENDERCOMPLETE))&&!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady(),this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout(()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()},0))}setLayerGroup(e){const t=this.getLayerGroup();t&&this.handleLayerRemove_(new Ft("removelayer",t)),this.set(x.LAYERGROUP,e)}setSize(e){this.set(x.SIZE,e)}setTarget(e){this.set(x.TARGET,e)}setView(e){if(!e||e instanceof j){this.set(x.VIEW,e);return}this.set(x.VIEW,new j);const t=this;e.then(function(i){t.setView(new j(i))})}updateSize(){const e=this.getTargetElement();let t;if(e){const n=getComputedStyle(e),r=e.offsetWidth-parseFloat(n.borderLeftWidth)-parseFloat(n.paddingLeft)-parseFloat(n.paddingRight)-parseFloat(n.borderRightWidth),o=e.offsetHeight-parseFloat(n.borderTopWidth)-parseFloat(n.paddingTop)-parseFloat(n.paddingBottom)-parseFloat(n.borderBottomWidth);!isNaN(r)&&!isNaN(o)&&(t=[Math.max(0,r),Math.max(0,o)],!Mt(t)&&(e.offsetWidth||e.offsetHeight||e.getClientRects().length)&&ns("No map visible because the map container's width or height are 0."))}const i=this.getSize();t&&(!i||!pt(t,i))&&(this.setSize(t),this.updateViewportSize_(t))}updateViewportSize_(e){const t=this.getView();t&&t.setViewportSize(e)}}function Us(s){let e=null;s.keyboardEventTarget!==void 0&&(e=typeof s.keyboardEventTarget=="string"?document.getElementById(s.keyboardEventTarget):s.keyboardEventTarget);const t={},i=s.layers&&typeof s.layers.getLayers=="function"?s.layers:new q({layers:s.layers});t[x.LAYERGROUP]=i,t[x.TARGET]=s.target,t[x.VIEW]=s.view instanceof j?s.view:new j;let n;s.controls!==void 0&&(Array.isArray(s.controls)?n=new A(s.controls.slice()):(tt(typeof s.controls.getArray=="function","Expected `controls` to be an array or an `ol/Collection.js`"),n=s.controls));let r;s.interactions!==void 0&&(Array.isArray(s.interactions)?r=new A(s.interactions.slice()):(tt(typeof s.interactions.getArray=="function","Expected `interactions` to be an array or an `ol/Collection.js`"),r=s.interactions));let o;return s.overlays!==void 0?Array.isArray(s.overlays)?o=new A(s.overlays.slice()):(tt(typeof s.overlays.getArray=="function","Expected `overlays` to be an array or an `ol/Collection.js`"),o=s.overlays):o=new A,{controls:n,interactions:r,keyboardEventTarget:e,overlays:o,values:t}}const Hs=':root,:host{--ol-background-color: white;--ol-accent-background-color: #F5F5F5;--ol-subtle-background-color: rgba(128, 128, 128, .25);--ol-partial-background-color: rgba(255, 255, 255, .75);--ol-foreground-color: #333333;--ol-subtle-foreground-color: #666666;--ol-brand-color: #00AAFF}.ol-box{box-sizing:border-box;border-radius:2px;border:1.5px solid var(--ol-background-color);background-color:var(--ol-partial-background-color)}.ol-mouse-position{top:8px;right:8px;position:absolute}.ol-scale-line{background:var(--ol-partial-background-color);border-radius:4px;bottom:8px;left:8px;padding:2px;position:absolute}.ol-scale-line-inner{border:1px solid var(--ol-subtle-foreground-color);border-top:none;color:var(--ol-foreground-color);font-size:10px;text-align:center;margin:1px;will-change:contents,width;transition:all .25s}.ol-scale-bar{position:absolute;bottom:8px;left:8px}.ol-scale-bar-inner{display:flex}.ol-scale-step-marker{width:1px;height:15px;background-color:var(--ol-foreground-color);float:right;z-index:10}.ol-scale-step-text{position:absolute;bottom:-5px;font-size:10px;z-index:11;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-text{position:absolute;font-size:12px;text-align:center;bottom:25px;color:var(--ol-foreground-color);text-shadow:-1.5px 0 var(--ol-partial-background-color),0 1.5px var(--ol-partial-background-color),1.5px 0 var(--ol-partial-background-color),0 -1.5px var(--ol-partial-background-color)}.ol-scale-singlebar{position:relative;height:10px;z-index:9;box-sizing:border-box;border:1px solid var(--ol-foreground-color)}.ol-scale-singlebar-even{background-color:var(--ol-subtle-foreground-color)}.ol-scale-singlebar-odd{background-color:var(--ol-background-color)}.ol-unsupported{display:none}.ol-viewport,.ol-unselectable{-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none;-webkit-tap-highlight-color:transparent}.ol-viewport canvas{all:unset;overflow:hidden}.ol-viewport{touch-action:pan-x pan-y}.ol-selectable{-webkit-touch-callout:default;-webkit-user-select:text;-moz-user-select:text;user-select:text}.ol-grabbing{cursor:-webkit-grabbing;cursor:-moz-grabbing;cursor:grabbing}.ol-grab{cursor:move;cursor:-webkit-grab;cursor:-moz-grab;cursor:grab}.ol-control{position:absolute;background-color:var(--ol-subtle-background-color);border-radius:4px}.ol-zoom{top:.5em;left:.5em}.ol-rotate{top:.5em;right:.5em;transition:opacity .25s linear,visibility 0s linear}.ol-rotate.ol-hidden{opacity:0;visibility:hidden;transition:opacity .25s linear,visibility 0s linear .25s}.ol-zoom-extent{top:4.643em;left:.5em}.ol-full-screen{right:.5em;top:.5em}.ol-control button{display:block;margin:1px;padding:0;color:var(--ol-subtle-foreground-color);font-weight:700;text-decoration:none;font-size:inherit;text-align:center;height:1.375em;width:1.375em;line-height:.4em;background-color:var(--ol-background-color);border:none;border-radius:2px}.ol-control button::-moz-focus-inner{border:none;padding:0}.ol-zoom-extent button{line-height:1.4em}.ol-compass{display:block;font-weight:400;will-change:transform}.ol-touch .ol-control button{font-size:1.5em}.ol-touch .ol-zoom-extent{top:5.5em}.ol-control button:hover,.ol-control button:focus{text-decoration:none;outline:1px solid var(--ol-subtle-foreground-color);color:var(--ol-foreground-color)}.ol-zoom .ol-zoom-in{border-radius:2px 2px 0 0}.ol-zoom .ol-zoom-out{border-radius:0 0 2px 2px}.ol-attribution{text-align:right;bottom:.5em;right:.5em;max-width:calc(100% - 1.3em);display:flex;flex-flow:row-reverse;align-items:center}.ol-attribution a{color:var(--ol-subtle-foreground-color);text-decoration:none}.ol-attribution ul{margin:0;padding:1px .5em;color:var(--ol-foreground-color);text-shadow:0 0 2px var(--ol-background-color);font-size:12px}.ol-attribution li{display:inline;list-style:none}.ol-attribution li:not(:last-child):after{content:" "}.ol-attribution img{max-height:2em;max-width:inherit;vertical-align:middle}.ol-attribution button{flex-shrink:0}.ol-attribution.ol-collapsed ul{display:none}.ol-attribution:not(.ol-collapsed){background:var(--ol-partial-background-color)}.ol-attribution.ol-uncollapsible{bottom:0;right:0;border-radius:4px 0 0}.ol-attribution.ol-uncollapsible img{margin-top:-.2em;max-height:1.6em}.ol-attribution.ol-uncollapsible button{display:none}.ol-zoomslider{top:4.5em;left:.5em;height:200px}.ol-zoomslider button{position:relative;height:10px}.ol-touch .ol-zoomslider{top:5.5em}.ol-overviewmap{left:.5em;bottom:.5em}.ol-overviewmap.ol-uncollapsible{bottom:0;left:0;border-radius:0 4px 0 0}.ol-overviewmap .ol-overviewmap-map,.ol-overviewmap button{display:block}.ol-overviewmap .ol-overviewmap-map{border:1px solid var(--ol-subtle-foreground-color);height:150px;width:150px}.ol-overviewmap:not(.ol-collapsed) button{bottom:0;left:0;position:absolute}.ol-overviewmap.ol-collapsed .ol-overviewmap-map,.ol-overviewmap.ol-uncollapsible button{display:none}.ol-overviewmap:not(.ol-collapsed){background:var(--ol-subtle-background-color)}.ol-overviewmap-box{border:1.5px dotted var(--ol-subtle-foreground-color)}.ol-overviewmap .ol-overviewmap-box:hover{cursor:move}.ol-overviewmap .ol-viewport:hover{cursor:pointer}',Ws=".geolocation{top:65px;left:.5em}.ol-touch.geolocation{top:80px}.loading-indicator{position:absolute;pointer-events:none!important;display:flex;align-items:center;justify-content:center;background-color:#0000}.loading-indicator.small{bottom:.5em;left:.5em;width:30px;height:30px}.loading-indicator.fullscreen{width:100%;height:100%}.disabled{filter:brightness(1.7);pointer-events:none}";/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Bs=(s,e,t)=>{for(const i of e)if(i[0]===s)return(0,i[1])();return t==null?void 0:t()};var Xe,Mi;class Zs extends _t{constructor(){super();k(this,Xe);this.value=50,this.enabled="true"}static get properties(){return{value:{attribute:"value",type:Number},enabled:{attribute:"enabled",type:String}}}render(){return Y`
      <style>
        :host {
          display: block;
        }
        /* Inspired by https://www.codehim.com/html5-css3/html-css-image-comparison-slider/ */
        .eox-map-compare {
          --thumb-bgc: #fff;
          --thumb-w: 0.2rem;

          position: relative;
          height: 100%;
        }
        .eox-map-compare::after {
          content: "";
          display: block;
        }
        .eox-map-compare__first,
        .eox-map-compare__second {
          height: 100%;
          object-fit: cover;
          position: absolute;
          top: 0;
          width: 100%;
        }
        .eox-map-compare__first {
          clip-path: polygon(
            0% 0%,
            ${this.value}% 0%,
            ${this.value}% 100%,
            0% 100%
          );
        }
        .eox-map-compare__second {
          clip-path: polygon(
            100% 0%,
            ${this.value}% 0%,
            ${this.value}% 100%,
            100% 100%
          );
        }
        .eox-map-compare__range {
          background-color: transparent;
          box-sizing: border-box;
          font-family: inherit;
          height: 100%;
          margin: 0;
          outline: none;
          position: absolute;
          top: 0;
          width: 100%;
          pointer-events: none;
        }
        .eox-map-compare__range::-moz-range-thumb {
          background-color: var(--thumb-bgc);
          cursor: ew-resize;
          height: 100%;
          width: var(--thumb-w);
          pointer-events: all;
          box-shadow: 0 0 5px black;
          clip-path: inset(0 -5px 0 -5px);
        }
        .eox-map-compare__range::-webkit-slider-thumb {
          background-color: var(--thumb-bgc);
          cursor: ew-resize;
          height: 100%;
          width: var(--thumb-w);
          pointer-events: all;
          position: relative;
          box-shadow: 0 0 5px black;
          -webkit-clip-path: inset(0 -5px 0 -5px);
          clip-path: inset(0 -5px 0 -5px);
        }
        .eox-map-compare__range::-moz-range-track {
          background: transparent;
          background-size: 100%;
          box-sizing: border-box;
        }
        .eox-map-compare__range::-webkit-slider-runnable-track {
          background: transparent;
          background-size: 100%;
          box-sizing: border-box;
          height: 100%;
        }
        .eox-map-compare__range,
        .eox-map-compare__range::-webkit-slider-runnable-track,
        .eox-map-compare__range::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
        }
      </style>
      ${Bs(this.enabled,[["first",()=>Y`<slot name="first"></slot>`],["second",()=>Y`<slot name="second"></slot>`]],()=>Y`
          <div class="eox-map-compare">
            <div class="eox-map-compare__first">
              <slot name="first"></slot>
            </div>
            <div class="eox-map-compare__second">
              <slot name="second"></slot>
            </div>
            <input
              type="range"
              class="eox-map-compare__range"
              min="0"
              max="100"
              value=${this.value}
              @input=${Rt(this,Xe,Mi)}
            />
          </div>
        `)}
    `}}Xe=new WeakSet,Mi=function(t){this.value=parseInt(t.target.value)};customElements.define("eox-map-compare",Zs);class Qe extends ss{constructor(e,t,i){super(),i!==void 0&&t===void 0?this.setFlatCoordinates(i,e):(t=t||0,this.setCenterAndRadius(e,t,i))}clone(){const e=new Qe(this.flatCoordinates.slice(),void 0,this.layout);return e.applyProperties(this),e}closestPointXY(e,t,i,n){const r=this.flatCoordinates,o=e-r[0],a=t-r[1],l=o*o+a*a;if(l<n){if(l===0)for(let c=0;c<this.stride;++c)i[c]=r[c];else{const c=this.getRadius()/Math.sqrt(l);i[0]=r[0]+c*o,i[1]=r[1]+c*a;for(let h=2;h<this.stride;++h)i[h]=r[h]}return i.length=this.stride,l}return n}containsXY(e,t){const i=this.flatCoordinates,n=e-i[0],r=t-i[1];return n*n+r*r<=this.getRadiusSquared_()}getCenter(){return this.flatCoordinates.slice(0,this.stride)}computeExtent(e){const t=this.flatCoordinates,i=t[this.stride]-t[0];return on(t[0]-i,t[1]-i,t[0]+i,t[1]+i,e)}getRadius(){return Math.sqrt(this.getRadiusSquared_())}getRadiusSquared_(){const e=this.flatCoordinates[this.stride]-this.flatCoordinates[0],t=this.flatCoordinates[this.stride+1]-this.flatCoordinates[1];return e*e+t*t}getType(){return"Circle"}intersectsExtent(e){const t=this.getExtent();if(an(e,t)){const i=this.getCenter();return e[0]<=i[0]&&e[2]>=i[0]||e[1]<=i[1]&&e[3]>=i[1]?!0:ln(e,this.intersectsCoordinate.bind(this))}return!1}setCenter(e){const t=this.stride,i=this.flatCoordinates[t]-this.flatCoordinates[0],n=e.slice();n[t]=n[0]+i;for(let r=1;r<t;++r)n[t+r]=e[r];this.setFlatCoordinates(this.layout,n),this.changed()}setCenterAndRadius(e,t,i){this.setLayout(i,e,0),this.flatCoordinates||(this.flatCoordinates=[]);const n=this.flatCoordinates;let r=rs(n,0,e,this.stride);n[r++]=n[0]+t;for(let o=1,a=this.stride;o<a;++o)n[r++]=n[o];n.length=r,this.changed()}getCoordinates(){return null}setCoordinates(e,t){}setRadius(e){this.flatCoordinates[this.stride]=this.flatCoordinates[0]+e,this.changed()}rotate(e,t){const i=this.getCenter(),n=this.getStride();this.setCenter(os(i,0,i.length,n,e,t,i)),this.changed()}}Qe.prototype.transform;const xt={dataProjection:"EPSG:4326",featureProjection:"EPSG:3857"};function Oi(s,e,t,i=!1,n=!1,r=!0){const o=i?[s.feature]:s.features;n&&e.getSource().clear();const a=e.getSource().getFeatures();if(!e.get("multipleFeatures")&&(a.length||o.length>1))return console.error("Multiple features detected!");o.forEach(h=>{const g=h.getGeometry();if(g instanceof ye){const u=as(g,{radius:6378137,projection:"EPSG:3857"});h.set("measure",u)}else if(g instanceof ke){const u=ls(g,{radius:6378137,projection:"EPSG:3857"});h.set("measure",u)}const d=M(h);h.set("id",d),h.setId(d)}),!i&&o.length&&(e.getSource().addFeatures(o),t.map.getView().fit(e.getSource().getExtent(),{duration:r?750:0}));const l=new Je,c=JSON.parse(l.writeFeatures(o,xt));(i||n)&&Ht(t,"drawend",s,c),Ht(t,"addfeatures",s,c)}function Ht(s,e,t,i){const n=new CustomEvent(e,{detail:{originalEvent:t,geoJSON:i}});s.dispatchEvent(n)}function Vi(s){s.setRotation(s.getRotation())}function Ys(s,e,t,i=!1,n=xt,r=!0){try{const o=qs(s);if(!o){console.error("Unsupported format or invalid data");return}const a=o.readFeatures(s,n);Oi({features:a},e,t,!1,i,r)}catch(o){console.error("Error parsing data:",o)}}function qs(s){return Xs(s)?new Je:$s(s)?new Pn({extractStyles:!1}):Js(s)?new Tn:null}function Xs(s){try{const e=JSON.parse(s);return e.type==="FeatureCollection"||e.type==="Feature"}catch{return!1}}function $s(s){return s.includes("<kml")&&s.includes("</kml>")}function Js(s){try{const e=JSON.parse(s);return e.type==="Topology"&&e.objects}catch{return!1}}function Qs(s,e,t=void 0){ut.defs(s,e),mi(ut),typeof t<"u"&&W(s).setExtent(t)}async function er(s){return mi(ut),await Sn(s)}function tr(s){return new Je().writeFeaturesObject(s,xt)}function Gi(s,e,t=void 0){return t||(t="EPSG:4326"),Ct(s,e,t)}function ji(s,e,t=void 0){return t||(t="EPSG:4326"),hs(s,e,t)}function Wt(s,e=!1){e?(s.addInteraction(new qe({condition:Ut})),"ontouchstart"in window||navigator.maxTouchPoints>0?s.addInteraction(new ve({condition:function(i){return this.getPointerCount()===2||Ut(i)}})):s.addInteraction(new ve)):(s.addInteraction(new qe),s.addInteraction(new ve))}function ir(s){s.getInteractions().getArray().forEach(e=>{(e instanceof qe||e instanceof ve)&&s.removeInteraction(e)})}function nr(s,e,t=.001){let i=!0;for(let n=s.length-1;n>=0;--n)if(!sr(s[n],e[n],t)){i=!1;break}return i}function sr(s,e,t=.001){return Math.abs(s-e)<t}function zi(s){if(s){const e=s;return!N(e,[0,0])&&e[0]>=-180&&e[0]<=180&&e[1]>=-90&&e[1]<=90?cs(e):e}return[0,0]}const Bt=0,Ce=1,Zt=[0,0,0,0],se=[],st={MODIFYSTART:"modifystart",MODIFYEND:"modifyend"};class rt extends Re{constructor(e,t,i){super(e),this.features=t,this.mapBrowserEvent=i}}class rr extends ${constructor(e){super(e),this.on,this.once,this.un,this.boundHandleFeatureChange_=this.handleFeatureChange_.bind(this),this.condition_=e.condition?e.condition:ki,this.defaultDeleteCondition_=function(i){return Ps(i)&&Is(i)},this.deleteCondition_=e.deleteCondition?e.deleteCondition:this.defaultDeleteCondition_,this.insertVertexCondition_=e.insertVertexCondition?e.insertVertexCondition:Ye,this.vertexFeature_=null,this.vertexSegments_=null,this.lastPixel_=[0,0],this.ignoreNextSingleClick_=!1,this.featuresBeingModified_=null,this.rBush_=new Ln,this.pixelTolerance_=e.pixelTolerance!==void 0?e.pixelTolerance:10,this.snappedToVertex_=!1,this.changingFeature_=!1,this.dragSegments_=[],this.overlay_=new ue({source:new $e({useSpatialIndex:!1,wrapX:!!e.wrapX}),style:e.style?e.style:ar(),updateWhileAnimating:!0,updateWhileInteracting:!0}),this.SEGMENT_WRITERS_={Point:this.writePointGeometry_.bind(this),LineString:this.writeLineStringGeometry_.bind(this),LinearRing:this.writeLineStringGeometry_.bind(this),Polygon:this.writePolygonGeometry_.bind(this),MultiPoint:this.writeMultiPointGeometry_.bind(this),MultiLineString:this.writeMultiLineStringGeometry_.bind(this),MultiPolygon:this.writeMultiPolygonGeometry_.bind(this),Circle:this.writeCircleGeometry_.bind(this),GeometryCollection:this.writeGeometryCollectionGeometry_.bind(this)},this.source_=null,this.hitDetection_=null;let t;if(e.features?t=e.features:e.source&&(this.source_=e.source,t=new A(this.source_.getFeatures()),this.source_.addEventListener(Ot.ADDFEATURE,this.handleSourceAdd_.bind(this)),this.source_.addEventListener(Ot.REMOVEFEATURE,this.handleSourceRemove_.bind(this))),!t)throw new Error("The modify interaction requires features, a source or a layer");e.hitDetection&&(this.hitDetection_=e.hitDetection),this.features_=t,this.features_.forEach(this.addFeature_.bind(this)),this.features_.addEventListener(B.ADD,this.handleFeatureAdd_.bind(this)),this.features_.addEventListener(B.REMOVE,this.handleFeatureRemove_.bind(this)),this.lastPointerEvent_=null,this.delta_=[0,0],this.snapToPointer_=e.snapToPointer===void 0?!this.hitDetection_:e.snapToPointer}addFeature_(e){const t=e.getGeometry();if(t){const n=this.SEGMENT_WRITERS_[t.getType()];n&&n(e,t)}const i=this.getMap();i&&i.isRendered()&&this.getActive()&&this.handlePointerAtPixel_(i.getCoordinateFromPixel(this.lastPixel_)),e.addEventListener(v.CHANGE,this.boundHandleFeatureChange_)}willModifyFeatures_(e,t){if(!this.featuresBeingModified_){this.featuresBeingModified_=new A;const i=this.featuresBeingModified_.getArray();for(let n=0,r=t.length;n<r;++n){const o=t[n].feature;o&&!i.includes(o)&&this.featuresBeingModified_.push(o)}this.featuresBeingModified_.getLength()===0?this.featuresBeingModified_=null:this.dispatchEvent(new rt(st.MODIFYSTART,this.featuresBeingModified_,e))}}removeFeature_(e){this.removeFeatureSegmentData_(e),this.vertexFeature_&&this.features_.getLength()===0&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.removeEventListener(v.CHANGE,this.boundHandleFeatureChange_)}removeFeatureSegmentData_(e){const t=this.rBush_,i=[];t.forEach(function(n){e===n.feature&&i.push(n)});for(let n=i.length-1;n>=0;--n){const r=i[n];for(let o=this.dragSegments_.length-1;o>=0;--o)this.dragSegments_[o][0]===r&&this.dragSegments_.splice(o,1);t.remove(r)}}setActive(e){this.vertexFeature_&&!e&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),super.setActive(e)}setMap(e){this.overlay_.setMap(e),super.setMap(e)}getOverlay(){return this.overlay_}handleSourceAdd_(e){e.feature&&this.features_.push(e.feature)}handleSourceRemove_(e){e.feature&&this.features_.remove(e.feature)}handleFeatureAdd_(e){this.addFeature_(e.element)}handleFeatureChange_(e){if(!this.changingFeature_){const t=e.target;this.removeFeature_(t),this.addFeature_(t)}}handleFeatureRemove_(e){this.removeFeature_(e.element)}writePointGeometry_(e,t){const i=t.getCoordinates(),n={feature:e,geometry:t,segment:[i,i]};this.rBush_.insert(t.getExtent(),n)}writeMultiPointGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){const o=i[n],a={feature:e,geometry:t,depth:[n],index:n,segment:[o,o]};this.rBush_.insert(t.getExtent(),a)}}writeLineStringGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length-1;n<r;++n){const o=i.slice(n,n+2),a={feature:e,geometry:t,index:n,segment:o};this.rBush_.insert(R(o),a)}}writeMultiLineStringGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){const o=i[n];for(let a=0,l=o.length-1;a<l;++a){const c=o.slice(a,a+2),h={feature:e,geometry:t,depth:[n],index:a,segment:c};this.rBush_.insert(R(c),h)}}}writePolygonGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){const o=i[n];for(let a=0,l=o.length-1;a<l;++a){const c=o.slice(a,a+2),h={feature:e,geometry:t,depth:[n],index:a,segment:c};this.rBush_.insert(R(c),h)}}}writeMultiPolygonGeometry_(e,t){const i=t.getCoordinates();for(let n=0,r=i.length;n<r;++n){const o=i[n];for(let a=0,l=o.length;a<l;++a){const c=o[a];for(let h=0,g=c.length-1;h<g;++h){const d=c.slice(h,h+2),u={feature:e,geometry:t,depth:[a,n],index:h,segment:d};this.rBush_.insert(R(d),u)}}}}writeCircleGeometry_(e,t){const i=t.getCenter(),n={feature:e,geometry:t,index:Bt,segment:[i,i]},r={feature:e,geometry:t,index:Ce,segment:[i,i]},o=[n,r];n.featureSegments=o,r.featureSegments=o,this.rBush_.insert(it(i),n);let a=t;this.rBush_.insert(a.getExtent(),r)}writeGeometryCollectionGeometry_(e,t){const i=t.getGeometriesArray();for(let n=0;n<i.length;++n){const r=i[n],o=this.SEGMENT_WRITERS_[r.getType()];o(e,r)}}createOrUpdateVertexFeature_(e,t,i,n){let r=this.vertexFeature_;return r?r.getGeometry().setCoordinates(e):(r=new z(new ne(e)),this.vertexFeature_=r,this.overlay_.getSource().addFeature(r)),r.set("features",t),r.set("geometries",i),r.set("existing",n),r}handleEvent(e){if(!e.originalEvent)return!0;this.lastPointerEvent_=e;let t;return!e.map.getView().getInteracting()&&e.type==y.POINTERMOVE&&!this.handlingDownUpSequence&&this.handlePointerMove_(e),this.vertexFeature_&&this.deleteCondition_(e)&&(e.type!=y.SINGLECLICK||!this.ignoreNextSingleClick_?t=this.removePoint():t=!0),e.type==y.SINGLECLICK&&(this.ignoreNextSingleClick_=!1),super.handleEvent(e)&&!t}findInsertVerticesAndUpdateDragSegments_(e){this.handlePointerAtPixel_(e),this.dragSegments_.length=0,this.featuresBeingModified_=null;const t=this.vertexFeature_;if(!t)return;this.getMap().getView().getProjection();const i=[],n=t.getGeometry().getCoordinates(),r=R([n]),o=this.rBush_.getInExtent(r),a={};o.sort(or);for(let l=0,c=o.length;l<c;++l){const h=o[l],g=h.segment;let d=M(h.geometry);const u=h.depth;if(u&&(d+="-"+u.join("-")),a[d]||(a[d]=new Array(2)),h.geometry.getType()==="Circle"&&h.index===Ce){const f=qt(e,h);N(f,n)&&!a[d][0]&&(this.dragSegments_.push([h,0]),a[d][0]=h);continue}if(N(g[0],n)&&!a[d][0]){this.dragSegments_.push([h,0]),a[d][0]=h;continue}if(N(g[1],n)&&!a[d][1]){if(a[d][0]&&a[d][0].index===0){let f=h.geometry.getCoordinates();switch(h.geometry.getType()){case"LineString":case"MultiLineString":continue;case"MultiPolygon":f=f[u[1]];case"Polygon":if(h.index!==f[u[0]].length-2)continue;break}}this.dragSegments_.push([h,1]),a[d][1]=h;continue}M(g)in this.vertexSegments_&&!a[d][0]&&!a[d][1]&&i.push(h)}return i}handleDragEvent(e){this.ignoreNextSingleClick_=!1,this.willModifyFeatures_(e,this.dragSegments_.map(([r])=>r));const t=[e.coordinate[0]+this.delta_[0],e.coordinate[1]+this.delta_[1]],i=[],n=[];for(let r=0,o=this.dragSegments_.length;r<o;++r){const a=this.dragSegments_[r],l=a[0],c=l.feature;i.includes(c)||i.push(c);const h=l.geometry;n.includes(h)||n.push(h);const g=l.depth;let d;const u=l.segment,f=a[1];for(;t.length<h.getStride();)t.push(u[f][t.length]);switch(h.getType()){case"Point":d=t,u[0]=t,u[1]=t;break;case"MultiPoint":d=h.getCoordinates(),d[l.index]=t,u[0]=t,u[1]=t;break;case"LineString":d=h.getCoordinates(),d[l.index+f]=t,u[f]=t;break;case"MultiLineString":d=h.getCoordinates(),d[g[0]][l.index+f]=t,u[f]=t;break;case"Polygon":d=h.getCoordinates(),d[g[0]][l.index+f]=t,u[f]=t;break;case"MultiPolygon":d=h.getCoordinates(),d[g[1]][g[0]][l.index+f]=t,u[f]=t;break;case"Circle":const m=h;if(u[0]=t,u[1]=t,l.index===Bt)this.changingFeature_=!0,m.setCenter(t),this.changingFeature_=!1;else{this.changingFeature_=!0,e.map.getView().getProjection();let _=We(S(m.getCenter()),S(t));m.setRadius(_),this.changingFeature_=!1}break}d&&this.setGeometryCoordinates_(h,d)}this.createOrUpdateVertexFeature_(t,i,n,!0)}handleDownEvent(e){if(!this.condition_(e))return!1;const t=e.coordinate,i=this.findInsertVerticesAndUpdateDragSegments_(t);if(i!=null&&i.length&&this.insertVertexCondition_(e)&&(this.willModifyFeatures_(e,i),this.vertexFeature_)){const n=this.vertexFeature_.getGeometry().getCoordinates();for(let r=i.length-1;r>=0;--r)this.insertVertex_(i[r],n);this.ignoreNextSingleClick_=!0}return!!this.vertexFeature_}handleUpEvent(e){for(let t=this.dragSegments_.length-1;t>=0;--t){const i=this.dragSegments_[t][0],n=i.geometry;if(n.getType()==="Circle"){const r=n,o=r.getCenter(),a=i.featureSegments[0],l=i.featureSegments[1];a.segment[0]=o,a.segment[1]=o,l.segment[0]=o,l.segment[1]=o,this.rBush_.update(it(o),a);let c=r;this.rBush_.update(c.getExtent(),l)}else this.rBush_.update(R(i.segment),i)}return this.featuresBeingModified_&&(this.dispatchEvent(new rt(st.MODIFYEND,this.featuresBeingModified_,e)),this.featuresBeingModified_=null),!1}handlePointerMove_(e){this.lastPixel_=e.pixel,this.handlePointerAtPixel_(e.coordinate)}handlePointerAtPixel_(e){const t=this.getMap(),i=t.getPixelFromCoordinate(e);t.getView().getProjection();const n=function(a,l){return Yt(e,a)-Yt(e,l)};let r,o;if(this.hitDetection_){const a=typeof this.hitDetection_=="object"?l=>l===this.hitDetection_:void 0;t.forEachFeatureAtPixel(i,(l,c,h)=>{h&&h.getType()==="Point"&&(h=new ne(we(h.getCoordinates())));const g=h||l.getGeometry();if(g&&g.getType()==="Point"&&l instanceof z&&this.features_.getArray().includes(l)){o=g;const d=l.getGeometry().getFlatCoordinates().slice(0,2);r=[{feature:l,geometry:o,segment:[d,d]}]}return!0},{layerFilter:a})}if(!r){const a=vi(it(e,Zt)),l=t.getView().getResolution()*this.pixelTolerance_,c=ds(ri(a,l,Zt));r=this.rBush_.getInExtent(c)}if(r&&r.length>0){const a=r.sort(n)[0],l=a.segment;let c=qt(e,a);const h=t.getPixelFromCoordinate(c);let g=We(i,h);if(o||g<=this.pixelTolerance_){const d={};if(d[M(l)]=!0,this.snapToPointer_||(this.delta_[0]=c[0]-e[0],this.delta_[1]=c[1]-e[1]),a.geometry.getType()==="Circle"&&a.index===Ce)this.snappedToVertex_=!0,this.createOrUpdateVertexFeature_(c,[a.feature],[a.geometry],this.snappedToVertex_);else{const u=t.getPixelFromCoordinate(l[0]),f=t.getPixelFromCoordinate(l[1]),m=Be(h,u),_=Be(h,f);if(g=Math.sqrt(Math.min(m,_)),this.snappedToVertex_=g<=this.pixelTolerance_,!this.snappedToVertex_&&!this.insertVertexCondition_(this.lastPointerEvent_)){this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null);return}this.snappedToVertex_&&(c=m>_?l[1]:l[0]),this.createOrUpdateVertexFeature_(c,[a.feature],[a.geometry],this.snappedToVertex_);const p={};p[M(a.geometry)]=!0;for(let b=1,P=r.length;b<P;++b){const C=r[b].segment;if(N(l[0],C[0])&&N(l[1],C[1])||N(l[0],C[1])&&N(l[1],C[0])){const L=M(r[b].geometry);L in p||(p[L]=!0,d[M(C)]=!0)}else break}}this.vertexSegments_=d;return}}this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null)}insertVertex_(e,t){const i=e.segment,n=e.feature,r=e.geometry,o=e.depth,a=e.index;let l;for(;t.length<r.getStride();)t.push(0);switch(r.getType()){case"MultiLineString":l=r.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"Polygon":l=r.getCoordinates(),l[o[0]].splice(a+1,0,t);break;case"MultiPolygon":l=r.getCoordinates(),l[o[1]][o[0]].splice(a+1,0,t);break;case"LineString":l=r.getCoordinates(),l.splice(a+1,0,t);break;default:return!1}this.setGeometryCoordinates_(r,l);const c=this.rBush_;c.remove(e),this.updateSegmentIndices_(r,a,o,1);const h={segment:[i[0],t],feature:n,geometry:r,depth:o,index:a};c.insert(R(h.segment),h),this.dragSegments_.push([h,1]);const g={segment:[t,i[1]],feature:n,geometry:r,depth:o,index:a+1};return c.insert(R(g.segment),g),this.dragSegments_.push([g,0]),!0}updatePointer_(e){var t;return e&&this.findInsertVerticesAndUpdateDragSegments_(e),(t=this.vertexFeature_)==null?void 0:t.getGeometry().getCoordinates()}getPoint(){var t;const e=(t=this.vertexFeature_)==null?void 0:t.getGeometry().getCoordinates();return e?we(e,this.getMap().getView().getProjection()):null}canRemovePoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(R([e])).some(({segment:i})=>N(i[0],e)||N(i[1],e))}removePoint(e){if(e&&(e=S(e,this.getMap().getView().getProjection()),this.updatePointer_(e)),!this.lastPointerEvent_||this.lastPointerEvent_&&this.lastPointerEvent_.type!=y.POINTERDRAG){const t=this.lastPointerEvent_;this.willModifyFeatures_(t,this.dragSegments_.map(([n])=>n));const i=this.removeVertex_();return this.featuresBeingModified_&&this.dispatchEvent(new rt(st.MODIFYEND,this.featuresBeingModified_,t)),this.featuresBeingModified_=null,i}return!1}removeVertex_(){const e=this.dragSegments_,t={};let i=!1,n,r,o,a,l,c,h,g,d,u,f;for(l=e.length-1;l>=0;--l)o=e[l],u=o[0],f=M(u.feature),u.depth&&(f+="-"+u.depth.join("-")),f in t||(t[f]={}),o[1]===0?(t[f].right=u,t[f].index=u.index):o[1]==1&&(t[f].left=u,t[f].index=u.index+1);for(f in t){switch(d=t[f].right,h=t[f].left,c=t[f].index,g=c-1,h!==void 0?u=h:u=d,g<0&&(g=0),a=u.geometry,r=a.getCoordinates(),n=r,i=!1,a.getType()){case"MultiLineString":r[u.depth[0]].length>2&&(r[u.depth[0]].splice(c,1),i=!0);break;case"LineString":r.length>2&&(r.splice(c,1),i=!0);break;case"MultiPolygon":n=n[u.depth[1]];case"Polygon":n=n[u.depth[0]],n.length>4&&(c==n.length-1&&(c=0),n.splice(c,1),i=!0,c===0&&(n.pop(),n.push(n[0]),g=n.length-1));break}if(i){this.setGeometryCoordinates_(a,r);const m=[];if(h!==void 0&&(this.rBush_.remove(h),m.push(h.segment[0])),d!==void 0&&(this.rBush_.remove(d),m.push(d.segment[1])),h!==void 0&&d!==void 0){const _={depth:u.depth,feature:u.feature,geometry:u.geometry,index:g,segment:m};this.rBush_.insert(R(_.segment),_)}this.updateSegmentIndices_(a,c,u.depth,-1),this.vertexFeature_&&(this.overlay_.getSource().removeFeature(this.vertexFeature_),this.vertexFeature_=null),e.length=0}}return i}canInsertPoint(){if(!this.vertexFeature_||this.vertexFeature_.get("geometries").every(i=>i.getType()==="Circle"||i.getType().endsWith("Point")))return!1;const e=this.vertexFeature_.getGeometry().getCoordinates();return this.rBush_.getInExtent(R([e])).some(({segment:i})=>!(N(i[0],e)||N(i[1],e)))}insertPoint(e){var n;const t=e?S(e,this.getMap().getView().getProjection()):(n=this.vertexFeature_)==null?void 0:n.getGeometry().getCoordinates();return t?this.findInsertVerticesAndUpdateDragSegments_(t).reduce((r,o)=>r||this.insertVertex_(o,t),!1):!1}setGeometryCoordinates_(e,t){this.changingFeature_=!0,e.setCoordinates(t),this.changingFeature_=!1}updateSegmentIndices_(e,t,i,n){this.rBush_.forEachInExtent(e.getExtent(),function(r){r.geometry===e&&(i===void 0||r.depth===void 0||pt(r.depth,i))&&r.index>t&&(r.index+=n)})}}function or(s,e){return s.index-e.index}function Yt(s,e,t){const i=e.geometry;if(i.getType()==="Circle"){let r=i;if(e.index===Ce){const o=Be(r.getCenter(),S(s)),a=Math.sqrt(o)-r.getRadius();return a*a}}const n=S(s);return se[0]=S(e.segment[0]),se[1]=S(e.segment[1]),gs(n,se)}function qt(s,e,t){const i=e.geometry;if(i.getType()==="Circle"&&e.index===Ce)return we(i.getClosestPoint(S(s)));const n=S(s);return se[0]=S(e.segment[0]),se[1]=S(e.segment[1]),we(us(n,se))}function ar(){const s=_i();return function(e,t){return s.Point}}const Me={DRAWSTART:"drawstart",DRAWEND:"drawend",DRAWABORT:"drawabort"};class Oe extends Re{constructor(e,t){super(e),this.feature=t}}function lr(s,e){const t=[];for(let i=0;i<e.length;++i){const r=e[i].getGeometry();Ki(s,r,t)}return t}function Ve(s,e){return ai(s[0],s[1],e[0],e[1])}function te(s,e){const t=s.length;return e<0?s[e+t]:e>=t?s[e-t]:s[e]}function Ge(s,e,t){let i,n;e<t?(i=e,n=t):(i=t,n=e);const r=Math.ceil(i),o=Math.floor(n);if(r>o){const l=ie(s,i),c=ie(s,n);return Ve(l,c)}let a=0;if(i<r){const l=ie(s,i),c=te(s,r);a+=Ve(l,c)}if(o<n){const l=te(s,o),c=ie(s,n);a+=Ve(l,c)}for(let l=r;l<o-1;++l){const c=te(s,l),h=te(s,l+1);a+=Ve(c,h)}return a}function Ki(s,e,t){if(e instanceof ye){je(s,e.getCoordinates(),!1,t);return}if(e instanceof Ci){const i=e.getCoordinates();for(let n=0,r=i.length;n<r;++n)je(s,i[n],!1,t);return}if(e instanceof ke){const i=e.getCoordinates();for(let n=0,r=i.length;n<r;++n)je(s,i[n],!0,t);return}if(e instanceof bi){const i=e.getCoordinates();for(let n=0,r=i.length;n<r;++n){const o=i[n];for(let a=0,l=o.length;a<l;++a)je(s,o[a],!0,t)}return}if(e instanceof ms){const i=e.getGeometries();for(let n=0;n<i.length;++n)Ki(s,i[n],t);return}}const ot={index:-1,endIndex:NaN};function hr(s,e,t,i){const n=s[0],r=s[1];let o=1/0,a=-1,l=NaN;for(let g=0;g<e.targets.length;++g){const d=e.targets[g],u=d.coordinates;let f=1/0,m;for(let _=0;_<u.length-1;++_){const p=u[_],b=u[_+1],P=Ui(n,r,p,b);P.squaredDistance<f&&(f=P.squaredDistance,m=_+P.along)}f<o&&(o=f,d.ring&&e.targetIndex===g&&(d.endIndex>d.startIndex?m<d.startIndex&&(m+=u.length):d.endIndex<d.startIndex&&m>d.startIndex&&(m-=u.length)),l=m,a=g)}const c=e.targets[a];let h=c.ring;if(e.targetIndex===a&&h){const g=ie(c.coordinates,l),d=t.getPixelFromCoordinate(g);We(d,e.startPx)>i&&(h=!1)}if(h){const g=c.coordinates,d=g.length,u=c.startIndex,f=l;if(u<f){const m=Ge(g,u,f);Ge(g,u,f-d)<m&&(l-=d)}else{const m=Ge(g,u,f);Ge(g,u,f+d)<m&&(l+=d)}}return ot.index=a,ot.endIndex=l,ot}function je(s,e,t,i){const n=s[0],r=s[1];for(let o=0,a=e.length-1;o<a;++o){const l=e[o],c=e[o+1],h=Ui(n,r,l,c);if(h.squaredDistance===0){const g=o+h.along;i.push({coordinates:e,ring:t,startIndex:g,endIndex:g});return}}}const at={along:0,squaredDistance:0};function Ui(s,e,t,i){const n=t[0],r=t[1],o=i[0],a=i[1],l=o-n,c=a-r;let h=0,g=n,d=r;return(l!==0||c!==0)&&(h=Ke(((s-n)*l+(e-r)*c)/(l*l+c*c),0,1),g+=l*h,d+=c*h),at.along=h,at.squaredDistance=cn(ai(s,e,g,d),10),at}function ie(s,e){const t=s.length;let i=Math.floor(e);const n=e-i;i>=t?i-=t:i<0&&(i+=t);let r=i+1;r>=t&&(r-=t);const o=s[i],a=o[0],l=o[1],c=s[r],h=c[0]-a,g=c[1]-l;return[a+h*n,l+g*n]}class cr extends ${constructor(e){const t=e;t.stopDown||(t.stopDown=ce),super(t),this.on,this.once,this.un,this.shouldHandle_=!1,this.downPx_=null,this.downTimeout_,this.lastDragTime_,this.pointerType_,this.freehand_=!1,this.source_=e.source?e.source:null,this.features_=e.features?e.features:null,this.snapTolerance_=e.snapTolerance?e.snapTolerance:12,this.type_=e.type,this.mode_=gr(this.type_),this.stopClick_=!!e.stopClick,this.minPoints_=e.minPoints?e.minPoints:this.mode_==="Polygon"?3:2,this.maxPoints_=this.mode_==="Circle"?2:e.maxPoints?e.maxPoints:1/0,this.finishCondition_=e.finishCondition?e.finishCondition:be,this.geometryLayout_=e.geometryLayout?e.geometryLayout:"XY";let i=e.geometryFunction;if(!i){const n=this.mode_;if(n==="Circle")i=(r,o,a)=>{const l=o||new Qe([NaN,NaN]),c=S(r[0]),h=Be(c,S(r[r.length-1]));return l.setCenterAndRadius(c,Math.sqrt(h),this.geometryLayout_),l};else{let r;n==="Point"?r=ne:n==="LineString"?r=ye:n==="Polygon"&&(r=ke),i=(o,a,l)=>(a?n==="Polygon"?o[0].length?a.setCoordinates([o[0].concat([o[0][0]])],this.geometryLayout_):a.setCoordinates([],this.geometryLayout_):a.setCoordinates(o,this.geometryLayout_):a=new r(o,this.geometryLayout_),a)}}this.geometryFunction_=i,this.dragVertexDelay_=e.dragVertexDelay!==void 0?e.dragVertexDelay:500,this.finishCoordinate_=null,this.sketchFeature_=null,this.sketchPoint_=null,this.sketchCoords_=null,this.sketchLine_=null,this.sketchLineCoords_=null,this.squaredClickTolerance_=e.clickTolerance?e.clickTolerance*e.clickTolerance:36,this.overlay_=new ue({source:new $e({useSpatialIndex:!1,wrapX:e.wrapX?e.wrapX:!1}),style:e.style?e.style:dr(),updateWhileInteracting:!0}),this.geometryName_=e.geometryName,this.condition_=e.condition?e.condition:wt,this.freehandCondition_,e.freehand?this.freehandCondition_=Ye:this.freehandCondition_=e.freehandCondition?e.freehandCondition:Ri,this.traceCondition_,this.setTrace(e.trace||!1),this.traceState_={active:!1},this.traceSource_=e.traceSource||e.source||null,this.addChangeListener(gt.ACTIVE,this.updateState_)}setTrace(e){let t;e?e===!0?t=Ye:t=e:t=Ls,this.traceCondition_=t}setMap(e){super.setMap(e),this.updateState_()}getOverlay(){return this.overlay_}handleEvent(e){e.originalEvent.type===v.CONTEXTMENU&&e.originalEvent.preventDefault(),this.freehand_=this.mode_!=="Point"&&this.freehandCondition_(e);let t=e.type===y.POINTERMOVE,i=!0;return!this.freehand_&&this.lastDragTime_&&e.type===y.POINTERDRAG&&(Date.now()-this.lastDragTime_>=this.dragVertexDelay_?(this.downPx_=e.pixel,this.shouldHandle_=!this.freehand_,t=!0):this.lastDragTime_=void 0,this.shouldHandle_&&this.downTimeout_!==void 0&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0)),this.freehand_&&e.type===y.POINTERDRAG&&this.sketchFeature_!==null?(this.addToDrawing_(e.coordinate),i=!1):this.freehand_&&e.type===y.POINTERDOWN?i=!1:t&&this.getPointerCount()<2?(i=e.type===y.POINTERMOVE,i&&this.freehand_?(this.handlePointerMove_(e),this.shouldHandle_&&e.originalEvent.preventDefault()):(e.originalEvent.pointerType==="mouse"||e.type===y.POINTERDRAG&&this.downTimeout_===void 0)&&this.handlePointerMove_(e)):e.type===y.DBLCLICK&&(i=!1),super.handleEvent(e)&&i}handleDownEvent(e){return this.shouldHandle_=!this.freehand_,this.freehand_?(this.downPx_=e.pixel,this.finishCoordinate_||this.startDrawing_(e.coordinate),!0):this.condition_(e)?(this.lastDragTime_=Date.now(),this.downTimeout_=setTimeout(()=>{this.handlePointerMove_(new H(y.POINTERMOVE,e.map,e.originalEvent,!1,e.frameState))},this.dragVertexDelay_),this.downPx_=e.pixel,!0):(this.lastDragTime_=void 0,!1)}deactivateTrace_(){this.traceState_={active:!1}}toggleTraceState_(e){if(!this.traceSource_||!this.traceCondition_(e))return;if(this.traceState_.active){this.deactivateTrace_();return}const t=this.getMap(),i=t.getCoordinateFromPixel([e.pixel[0]-this.snapTolerance_,e.pixel[1]+this.snapTolerance_]),n=t.getCoordinateFromPixel([e.pixel[0]+this.snapTolerance_,e.pixel[1]-this.snapTolerance_]),r=R([i,n]),o=this.traceSource_.getFeaturesInExtent(r);if(o.length===0)return;const a=lr(e.coordinate,o);a.length&&(this.traceState_={active:!0,startPx:e.pixel.slice(),targets:a,targetIndex:-1})}addOrRemoveTracedCoordinates_(e,t){const i=e.startIndex<=e.endIndex,n=e.startIndex<=t;i===n?i&&t>e.endIndex||!i&&t<e.endIndex?this.addTracedCoordinates_(e,e.endIndex,t):(i&&t<e.endIndex||!i&&t>e.endIndex)&&this.removeTracedCoordinates_(t,e.endIndex):(this.removeTracedCoordinates_(e.startIndex,e.endIndex),this.addTracedCoordinates_(e,e.startIndex,t))}removeTracedCoordinates_(e,t){if(e===t)return;let i=0;if(e<t){const n=Math.ceil(e);let r=Math.floor(t);r===t&&(r-=1),i=r-n+1}else{const n=Math.floor(e);let r=Math.ceil(t);r===t&&(r+=1),i=n-r+1}i>0&&this.removeLastPoints_(i)}addTracedCoordinates_(e,t,i){if(t===i)return;const n=[];if(t<i){const r=Math.ceil(t);let o=Math.floor(i);o===i&&(o-=1);for(let a=r;a<=o;++a)n.push(te(e.coordinates,a))}else{const r=Math.floor(t);let o=Math.ceil(i);o===i&&(o+=1);for(let a=r;a>=o;--a)n.push(te(e.coordinates,a))}n.length&&this.appendCoordinates(n)}updateTrace_(e){const t=this.traceState_;if(!t.active||t.targetIndex===-1&&We(t.startPx,e.pixel)<this.snapTolerance_)return;const i=hr(e.coordinate,t,this.getMap(),this.snapTolerance_);if(t.targetIndex!==i.index){if(t.targetIndex!==-1){const l=t.targets[t.targetIndex];this.removeTracedCoordinates_(l.startIndex,l.endIndex)}const a=t.targets[i.index];this.addTracedCoordinates_(a,a.startIndex,i.endIndex)}else{const a=t.targets[t.targetIndex];this.addOrRemoveTracedCoordinates_(a,i.endIndex)}t.targetIndex=i.index;const n=t.targets[t.targetIndex];n.endIndex=i.endIndex;const r=ie(n.coordinates,n.endIndex),o=this.getMap().getPixelFromCoordinate(r);e.coordinate=r,e.pixel=[Math.round(o[0]),Math.round(o[1])]}handleUpEvent(e){let t=!0;if(this.getPointerCount()===0){this.downTimeout_&&(clearTimeout(this.downTimeout_),this.downTimeout_=void 0),this.handlePointerMove_(e);const i=this.traceState_.active;if(this.toggleTraceState_(e),this.shouldHandle_){const n=!this.finishCoordinate_;n&&this.startDrawing_(e.coordinate),!n&&this.freehand_?this.finishDrawing():!this.freehand_&&(!n||this.mode_==="Point")&&(this.atFinish_(e.pixel,i)?this.finishCondition_(e)&&this.finishDrawing():this.addToDrawing_(e.coordinate)),t=!1}else this.freehand_&&this.abortDrawing()}return!t&&this.stopClick_&&e.preventDefault(),t}handlePointerMove_(e){if(this.pointerType_=e.originalEvent.pointerType,this.downPx_&&(!this.freehand_&&this.shouldHandle_||this.freehand_&&!this.shouldHandle_)){const t=this.downPx_,i=e.pixel,n=t[0]-i[0],r=t[1]-i[1],o=n*n+r*r;if(this.shouldHandle_=this.freehand_?o>this.squaredClickTolerance_:o<=this.squaredClickTolerance_,!this.shouldHandle_)return}if(!this.finishCoordinate_){this.createOrUpdateSketchPoint_(e.coordinate.slice());return}this.updateTrace_(e),this.modifyDrawing_(e.coordinate)}atFinish_(e,t){let i=!1;if(this.sketchFeature_){let n=!1,r=[this.finishCoordinate_];const o=this.mode_;if(o==="Point")i=!0;else if(o==="Circle")i=this.sketchCoords_.length===2;else if(o==="LineString")n=!t&&this.sketchCoords_.length>this.minPoints_;else if(o==="Polygon"){const a=this.sketchCoords_;n=a[0].length>this.minPoints_,r=[a[0][0],a[0][a[0].length-2]],t?r=[a[0][0]]:r=[a[0][0],a[0][a[0].length-2]]}if(n){const a=this.getMap();for(let l=0,c=r.length;l<c;l++){const h=r[l],g=a.getPixelFromCoordinate(h),d=e[0]-g[0],u=e[1]-g[1],f=this.freehand_?1:this.snapTolerance_;if(i=Math.sqrt(d*d+u*u)<=f,i){this.finishCoordinate_=h;break}}}}return i}createOrUpdateSketchPoint_(e){this.sketchPoint_?this.sketchPoint_.getGeometry().setCoordinates(e):(this.sketchPoint_=new z(new ne(e)),this.updateSketchFeatures_())}createOrUpdateCustomSketchLine_(e){this.sketchLine_||(this.sketchLine_=new z);const t=e.getLinearRing(0);let i=this.sketchLine_.getGeometry();i?(i.setFlatCoordinates(t.getLayout(),t.getFlatCoordinates()),i.changed()):(i=new ye(t.getFlatCoordinates(),t.getLayout()),this.sketchLine_.setGeometry(i))}startDrawing_(e){const t=this.getMap().getView().getProjection(),i=Kt(this.geometryLayout_);for(;e.length<i;)e.push(0);this.finishCoordinate_=e,this.mode_==="Point"?this.sketchCoords_=e.slice():this.mode_==="Polygon"?(this.sketchCoords_=[[e.slice(),e.slice()]],this.sketchLineCoords_=this.sketchCoords_[0]):this.sketchCoords_=[e.slice(),e.slice()],this.sketchLineCoords_&&(this.sketchLine_=new z(new ye(this.sketchLineCoords_)));const n=this.geometryFunction_(this.sketchCoords_,void 0,t);this.sketchFeature_=new z,this.geometryName_&&this.sketchFeature_.setGeometryName(this.geometryName_),this.sketchFeature_.setGeometry(n),this.updateSketchFeatures_(),this.dispatchEvent(new Oe(Me.DRAWSTART,this.sketchFeature_))}modifyDrawing_(e){const t=this.getMap(),i=this.sketchFeature_.getGeometry(),n=t.getView().getProjection(),r=Kt(this.geometryLayout_);let o,a;for(;e.length<r;)e.push(0);this.mode_==="Point"?a=this.sketchCoords_:this.mode_==="Polygon"?(o=this.sketchCoords_[0],a=o[o.length-1],this.atFinish_(t.getPixelFromCoordinate(e))&&(e=this.finishCoordinate_.slice())):(o=this.sketchCoords_,a=o[o.length-1]),a[0]=e[0],a[1]=e[1],this.geometryFunction_(this.sketchCoords_,i,n),this.sketchPoint_&&this.sketchPoint_.getGeometry().setCoordinates(e),i.getType()==="Polygon"&&this.mode_!=="Polygon"?this.createOrUpdateCustomSketchLine_(i):this.sketchLineCoords_&&this.sketchLine_.getGeometry().setCoordinates(this.sketchLineCoords_),this.updateSketchFeatures_()}addToDrawing_(e){const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection();let n,r;const o=this.mode_;return o==="LineString"||o==="Circle"?(this.finishCoordinate_=e.slice(),r=this.sketchCoords_,r.length>=this.maxPoints_&&(this.freehand_?r.pop():n=!0),r.push(e.slice()),this.geometryFunction_(r,t,i)):o==="Polygon"&&(r=this.sketchCoords_[0],r.length>=this.maxPoints_&&(this.freehand_?r.pop():n=!0),r.push(e.slice()),n&&(this.finishCoordinate_=r[0]),this.geometryFunction_(this.sketchCoords_,t,i)),this.createOrUpdateSketchPoint_(e.slice()),this.updateSketchFeatures_(),n?this.finishDrawing():this.sketchFeature_}removeLastPoints_(e){if(!this.sketchFeature_)return;const t=this.sketchFeature_.getGeometry(),i=this.getMap().getView().getProjection(),n=this.mode_;for(let r=0;r<e;++r){let o;if(n==="LineString"||n==="Circle"){if(o=this.sketchCoords_,o.splice(-2,1),o.length>=2){this.finishCoordinate_=o[o.length-2].slice();const a=this.finishCoordinate_.slice();o[o.length-1]=a,this.createOrUpdateSketchPoint_(a)}this.geometryFunction_(o,t,i),t.getType()==="Polygon"&&this.sketchLine_&&this.createOrUpdateCustomSketchLine_(t)}else if(n==="Polygon"){o=this.sketchCoords_[0],o.splice(-2,1);const a=this.sketchLine_.getGeometry();if(o.length>=2){const l=o[o.length-2].slice();o[o.length-1]=l,this.createOrUpdateSketchPoint_(l)}a.setCoordinates(o),this.geometryFunction_(this.sketchCoords_,t,i)}if(o.length===1){this.abortDrawing();break}}this.updateSketchFeatures_()}removeLastPoint(){this.removeLastPoints_(1)}finishDrawing(){const e=this.abortDrawing_();if(!e)return null;let t=this.sketchCoords_;const i=e.getGeometry(),n=this.getMap().getView().getProjection();return this.mode_==="LineString"?(t.pop(),this.geometryFunction_(t,i,n)):this.mode_==="Polygon"&&(t[0].pop(),this.geometryFunction_(t,i,n),t=i.getCoordinates()),this.type_==="MultiPoint"?e.setGeometry(new fs([t])):this.type_==="MultiLineString"?e.setGeometry(new Ci([t])):this.type_==="MultiPolygon"&&e.setGeometry(new bi([t])),this.dispatchEvent(new Oe(Me.DRAWEND,e)),this.features_&&this.features_.push(e),this.source_&&this.source_.addFeature(e),e}abortDrawing_(){this.finishCoordinate_=null;const e=this.sketchFeature_;return this.sketchFeature_=null,this.sketchPoint_=null,this.sketchLine_=null,this.overlay_.getSource().clear(!0),this.deactivateTrace_(),e}abortDrawing(){const e=this.abortDrawing_();e&&this.dispatchEvent(new Oe(Me.DRAWABORT,e))}appendCoordinates(e){const t=this.mode_,i=!this.sketchFeature_;i&&this.startDrawing_(e[0]);let n;if(t==="LineString"||t==="Circle")n=this.sketchCoords_;else if(t==="Polygon")n=this.sketchCoords_&&this.sketchCoords_.length?this.sketchCoords_[0]:[];else return;i&&n.shift(),n.pop();for(let o=0;o<e.length;o++)this.addToDrawing_(e[o]);const r=e[e.length-1];this.sketchFeature_=this.addToDrawing_(r),this.modifyDrawing_(r)}extend(e){const i=e.getGeometry();this.sketchFeature_=e,this.sketchCoords_=i.getCoordinates();const n=this.sketchCoords_[this.sketchCoords_.length-1];this.finishCoordinate_=n.slice(),this.sketchCoords_.push(n.slice()),this.sketchPoint_=new z(new ne(n)),this.updateSketchFeatures_(),this.dispatchEvent(new Oe(Me.DRAWSTART,this.sketchFeature_))}updateSketchFeatures_(){const e=[];this.sketchFeature_&&e.push(this.sketchFeature_),this.sketchLine_&&e.push(this.sketchLine_),this.sketchPoint_&&e.push(this.sketchPoint_);const t=this.overlay_.getSource();t.clear(!0),t.addFeatures(e)}updateState_(){const e=this.getMap(),t=this.getActive();(!e||!t)&&this.abortDrawing(),this.overlay_.setMap(t?e:null)}}function dr(){const s=_i();return function(e,t){return s[e.getGeometry().getType()]}}function ur(){return function(s,e,t){const i=R([s[0],s[s.length-1]].map(function(r){return S(r)})),n=[[At(i),oi(i),hn(i),yt(i),At(i)]];return e?e.setCoordinates(n):e=new ke(n),e}}function gr(s){switch(s){case"Point":case"MultiPoint":return"Point";case"LineString":case"MultiLineString":return"LineString";case"Polygon":case"MultiPolygon":return"Polygon";case"Circle":return"Circle";default:throw new Error("Invalid type: "+s)}}function fr(s,e,t){const i=Object.assign({},t);if(s.interactions[i.id])throw Error(`Interaction with id: ${i.id} already exists.`);i.modify=typeof i.modify=="boolean"?i.modify:!0;const n=e.getSource();i.type==="Box"&&(i.geometryFunction=ur(),i.type="Circle");const r=new cr({...i,source:n});i.active===!1&&r.setActive(!1),r.on("drawend",l=>{e.get("isDrawingEnabled")&&Oi(l,e,s,!0)}),s.map.addInteraction(r),s.interactions[i.id]=r;const o=new rr({source:n});o.setActive(i.modify),s.map.addInteraction(o),s.interactions[`${i.id}_modify`]=o;const a=()=>{s.getLayerById(e.get("id"))||(s.removeInteraction(i.id),s.removeInteraction(`${i.id}_modify`),s.map.getLayerGroup().un("change",a))};s.map.getLayerGroup().on("change",a)}const T={ELEMENT:"element",MAP:"map",OFFSET:"offset",POSITION:"position",POSITIONING:"positioning"};class Hi extends Fe{constructor(e){super(),this.on,this.once,this.un,this.options=e,this.id=e.id,this.insertFirst=e.insertFirst!==void 0?e.insertFirst:!0,this.stopEvent=e.stopEvent!==void 0?e.stopEvent:!0,this.element=document.createElement("div"),this.element.className=e.className!==void 0?e.className:"ol-overlay-container "+In,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.autoPan=e.autoPan===!0?{}:e.autoPan||void 0,this.rendered={transform_:"",visible:!0},this.mapPostrenderListenerKey=null,this.addChangeListener(T.ELEMENT,this.handleElementChanged),this.addChangeListener(T.MAP,this.handleMapChanged),this.addChangeListener(T.OFFSET,this.handleOffsetChanged),this.addChangeListener(T.POSITION,this.handlePositionChanged),this.addChangeListener(T.POSITIONING,this.handlePositioningChanged),e.element!==void 0&&this.setElement(e.element),this.setOffset(e.offset!==void 0?e.offset:[0,0]),this.setPositioning(e.positioning||"top-left"),e.position!==void 0&&this.setPosition(e.position)}getElement(){return this.get(T.ELEMENT)}getId(){return this.id}getMap(){return this.get(T.MAP)||null}getOffset(){return this.get(T.OFFSET)}getPosition(){return this.get(T.POSITION)}getPositioning(){return this.get(T.POSITIONING)}handleElementChanged(){ci(this.element);const e=this.getElement();e&&this.element.appendChild(e)}handleMapChanged(){var t;this.mapPostrenderListenerKey&&((t=this.element)==null||t.remove(),F(this.mapPostrenderListenerKey),this.mapPostrenderListenerKey=null);const e=this.getMap();if(e){this.mapPostrenderListenerKey=E(e,G.POSTRENDER,this.render,this),this.updatePixelPosition();const i=this.stopEvent?e.getOverlayContainerStopEvent():e.getOverlayContainer();this.insertFirst?i.insertBefore(this.element,i.childNodes[0]||null):i.appendChild(this.element),this.performAutoPan()}}render(){this.updatePixelPosition()}handleOffsetChanged(){this.updatePixelPosition()}handlePositionChanged(){this.updatePixelPosition(),this.performAutoPan()}handlePositioningChanged(){this.updatePixelPosition()}setElement(e){this.set(T.ELEMENT,e)}setMap(e){this.set(T.MAP,e)}setOffset(e){this.set(T.OFFSET,e)}setPosition(e){this.set(T.POSITION,e)}performAutoPan(){this.autoPan&&this.panIntoView(this.autoPan)}panIntoView(e){const t=this.getMap();if(!t||!t.getTargetElement()||!this.get(T.POSITION))return;const i=this.getRect(t.getTargetElement(),t.getSize()),n=this.getElement(),r=this.getRect(n,[Rn(n),Fn(n)]);e=e||{};const o=e.margin===void 0?20:e.margin;if(!li(i,r)){const a=r[0]-i[0],l=i[2]-r[2],c=r[1]-i[1],h=i[3]-r[3],g=[0,0];if(a<0?g[0]=a-o:l<0&&(g[0]=Math.abs(l)+o),c<0?g[1]=c-o:h<0&&(g[1]=Math.abs(h)+o),g[0]!==0||g[1]!==0){const d=t.getView().getCenterInternal(),u=t.getPixelFromCoordinateInternal(d);if(!u)return;const f=[u[0]+g[0],u[1]+g[1]],m=e.animation||{};t.getView().animateInternal({center:t.getCoordinateFromPixelInternal(f),duration:m.duration,easing:m.easing})}}}getRect(e,t){const i=e.getBoundingClientRect(),n=i.left+window.pageXOffset,r=i.top+window.pageYOffset;return[n,r,n+t[0],r+t[1]]}setPositioning(e){this.set(T.POSITIONING,e)}setVisible(e){this.rendered.visible!==e&&(this.element.style.display=e?"":"none",this.rendered.visible=e)}updatePixelPosition(){const e=this.getMap(),t=this.getPosition();if(!e||!e.isRendered()||!t){this.setVisible(!1);return}const i=e.getPixelFromCoordinate(t),n=e.getSize();this.updateRenderedPosition(i,n)}updateRenderedPosition(e,t){const i=this.element.style,n=this.getOffset(),r=this.getPositioning();this.setVisible(!0);const o=Math.round(e[0]+n[0])+"px",a=Math.round(e[1]+n[1])+"px";let l="0%",c="0%";r=="bottom-right"||r=="center-right"||r=="top-right"?l="-100%":(r=="bottom-center"||r=="center-center"||r=="top-center")&&(l="-50%"),r=="bottom-left"||r=="bottom-center"||r=="bottom-right"?c="-100%":(r=="center-left"||r=="center-center"||r=="center-right")&&(c="-50%");const h=`translate(${l}, ${c}) translate(${o}, ${a})`;this.rendered.transform_!=h&&(this.rendered.transform_=h,i.transform=h)}getOptions(){return this.options}}class mr extends _t{static get properties(){return{feature:{attribute:!1,property:!0,type:Object},propertyTransform:{attribute:!1,property:!0,type:Function}}}constructor(){super(),this.feature=null,this.propertyTransform=(e,t)=>e}render(){return this.feature?Y` <style>
            ul {
              margin: 0;
              padding: 15px 15px 15px 30px;
              background: #0008;
              border-radius: 15px;
              color: white;
              max-width: 250px;
              font-size: small;
            }
            span {
              font-weight: bold;
            }
          </style>
          <ul>
            ${Object.entries(this.feature.getProperties()).map(([e,t])=>this.propertyTransform({key:e,value:t},this.feature)).filter(e=>e).map(({key:e,value:t})=>Y`<li><span>${e}</span>: ${t}</li>`)}
          </ul>`:Qi}}customElements.define("eox-map-tooltip",mr);class _r extends kn{constructor(e){e=e||{},super({attributions:e.attributions,interpolate:e.interpolate,projection:e.projection,resolutions:e.resolutions}),this.crossOrigin_=e.crossOrigin!==void 0?e.crossOrigin:null,this.url_=e.url,this.imageLoadFunction_=e.imageLoadFunction!==void 0?e.imageLoadFunction:Nn,this.params_=Object.assign({},e.params),this.serverType_=e.serverType,this.hidpi_=e.hidpi!==void 0?e.hidpi:!0,this.renderedRevision_=0,this.ratio_=e.ratio!==void 0?e.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(e,t,i,n){const r=W(i),o=this.getProjection();o&&o!==r&&(t=An(o,r,e,t),e=Ct(e,r,o));const a={url:this.url_,params:{...this.params_,...n},projection:o||r};return Dn(a,e,t)}getLegendUrl(e,t){return Mn({url:this.url_,params:{...this.params_,...t}},e)}getParams(){return this.params_}getImageInternal(e,t,i,n){return this.url_===void 0?null:((!this.loader||this.loaderProjection_!==n)&&(this.loaderProjection_=n,this.loader=On({crossOrigin:this.crossOrigin_,params:this.params_,projection:n,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(r,o)=>(this.image.setImage(r),this.imageLoadFunction_(this.image,o),Vn(r))})),super.getImageInternal(e,t,i,n))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(e){this.imageLoadFunction_=e,this.changed()}setUrl(e){e!=this.url_&&(this.url_=e,this.loader=null,this.changed())}setParams(e){this.params_=Object.assign({},e),this.changed()}updateParams(e){Object.assign(this.params_,e),this.changed()}changed(){this.image=null,super.changed()}}const pr={GeoJSON:Je,MVT:Yn},yr={Group:q,Image:zn,Tile:jn,Vector:ue,VectorTile:Gn},vr={ImageWMS:_r,OSM:Zn,Tile:Bn,TileWMS:Wn,Vector:$e,VectorTile:Hn,WMTS:Un,XYZ:Kn};function he(s,e,t=!0){var h,g;e=JSON.parse(JSON.stringify(e));const i={...window.eoxMapAdvancedOlFormats,...pr},n={...window.eoxMapAdvancedOlLayers,...yr},r={...window.eoxMapAdvancedOlSources,...vr},o=n[e.type],a=r[(h=e.source)==null?void 0:h.type];if(!o)throw new Error(`Layer type ${e.type} not supported!`);if(e.source&&!a)throw new Error(`Source type ${e.source.type} not supported!`);const l=Er(e),c=new o({...e,...e.source&&{source:new a({...e.source,..."format"in e.source&&e.source.type!=="WMTS"&&{format:new i[typeof e.source.format=="object"?e.source.format.type:e.source.format]({...typeof e.source.format=="object"&&{...e.source.format}})},..."tileGrid"in e.source&&{tileGrid:l},..."projection"in e.source&&{projection:W(e.source.projection)}})},...e.type==="Group"&&{layers:[]},...e.properties,style:void 0});if(c.set("_jsonDefinition",e,!0),e.type==="Group"){const d=e.layers.reverse().map(u=>he(s,u));d.forEach(u=>u.set("_group",c,!0)),c.setLayers(new A(d))}if("style"in e&&c.setStyle(e.style),t&&((g=e.interactions)!=null&&g.length))for(let d=0;d<e.interactions.length;d++){const u=e.interactions[d];Wi(s,c,u)}return Zi(c,e),c}function Wi(s,e,t){t.type==="draw"?fr(s,e,t.options):t.type==="select"&&wr(s,e,t.options)}function Bi(s,e,t){var r,o,a,l;const i=t.get("_jsonDefinition");if(e.type!==i.type||((r=e.source)==null?void 0:r.type)!==((o=i.source)==null?void 0:o.type))throw new Error("Layers are not compatible to be updated");const n=he(s,e,!1);if(JSON.stringify(e.source)!==JSON.stringify(i.source)&&t.setSource(n.getSource()),["Vector","VectorTile"].includes(e.type)&&JSON.stringify(e.style)!==JSON.stringify(i.style)&&t.setStyle(n.getStyle()),JSON.stringify(e.properties)!==JSON.stringify(i.properties)&&t.setProperties(e.properties),e.visible!==i.visible&&t.setVisible(e.visible),e.opacity&&e.opacity!==i.opacity&&t.setOpacity(e.opacity),JSON.stringify(e.interactions)!==JSON.stringify(i.interactions)&&((a=i.interactions)==null||a.forEach(c=>{const h=e.interactions.find(g=>{var d,u;return g.type===c.type&&((d=g.options)==null?void 0:d.id)===((u=c.options)==null?void 0:u.id)});h?h.type==="draw"?(s.interactions[h.options.id].setActive(h.options.active),s.interactions[`${h.options.id}_modify`].setActive(h.options.modify)):s.selectInteractions[h.options.id].setActive(h.options.active):c.type==="select"?s.removeSelect(c.options.id):s.removeInteraction(c.options.id)}),(l=e.interactions)==null||l.forEach(c=>{i.interactions.find(g=>{var d,u;return g.type===c.type&&((d=g.options)==null?void 0:d.id)===((u=c.options)==null?void 0:u.id)})||Wi(s,t,c)})),e.type==="Group"){const c=e.layers.map(u=>{var f;return(f=u.properties)==null?void 0:f.id}),h=t.getLayers();h.getArray().slice().forEach(u=>{c.includes(u.get("id"))||h.remove(u)}),e.layers.forEach(u=>{const f=u.properties.id;if(h.getArray().map(m=>m.get("id")).includes(f))Bi(s,u,s.getLayerById(f));else{const m=he(s,u);h.push(m)}});const d=c.toReversed();h.getArray().sort((u,f)=>d.indexOf(u.get("id"))-d.indexOf(f.get("id"))),h.changed()}return Zi(t,e),t.set("_jsonDefinition",e,!0),t}const Cr=(s,e)=>e?[...e].reverse().map(t=>he(s,t)):[];function Zi(s,e){s.on("change:opacity",()=>{e.opacity=s.getOpacity()}),s.on("change:visible",()=>{e.visible=s.getVisible()}),s.on("change:zIndex",()=>{e.zIndex=s.getZIndex()}),s.on("propertychange",t=>{t.key!=="map"&&(e.properties[t.key]=t.target.get(t.key))})}class br{constructor(e,t,i){V(this,"panIntoFeature",(e,t)=>{const i=e instanceof z||e instanceof _s?e.getGeometry().getExtent():e;this.eoxMap.map.getView().fit(i,t||{duration:750})});var h,g;this.eoxMap=e,this.selectLayer=t,this.options=i,this.active=i.active||t.getVisible(),this.panIn=i.panIn||!1,this.tooltip=i.tooltip!==!1,this.selectedFids=[];const n=this.eoxMap.map.getOverlayById("eox-map-tooltip");let r;this.tooltip&&(n?(this.tooltipElement=n.getElement(),r=n):(this.tooltipElement=this.eoxMap.querySelector("eox-map-tooltip")||((h=i.overlay)==null?void 0:h.element),this.tooltipElement&&(r=new Hi({element:this.tooltipElement,position:void 0,offset:[0,0],positioning:"top-left",className:"eox-map-tooltip",id:"eox-map-tooltip",...i.overlay}),this.eoxMap.map.addOverlay(r))));const o=()=>{r&&i.condition==="pointermove"&&r.setPosition(void 0)};e.map.on("change:target",d=>{var u,f;(u=d.oldValue)==null||u.removeEventListener("pointerleave",o),(f=d.target.getTargetElement())==null||f.addEventListener("pointerleave",o)}),(g=e.map.getTargetElement())==null||g.addEventListener("pointerleave",o);let a;if(this.options.layer)a=this.options.layer;else{const d=this.selectLayer.get("_jsonDefinition");a={...d,style:i.style,properties:{id:this.selectLayer.get("id")+"_select"},source:{type:d.type}}}a.renderMode="vector",delete a.interactions,this.selectStyleLayer=he(e,a),this.selectStyleLayer.setSource(this.selectLayer.getSource()),this.selectStyleLayer.setMap(this.eoxMap.map);const l=this.selectStyleLayer.getStyleFunction();this.selectStyleLayer.setStyle((d,u)=>this.selectedFids.length&&this.selectedFids.includes(this.getId(d))?l(d,u):null),this.listener=d=>{if(!this.active||d.dragging)return;const u=this.eoxMap.map.getView().getZoom();u<this.selectLayer.getMinZoom()||u>this.selectLayer.getMaxZoom()||this.selectLayer.getFeatures(d.pixel).then(f=>{const m=f.length?f[0]:null,_=m?[this.getId(m)]:[],p=this.selectedFids[0]!==_[0];if(this.selectedFids=_,p&&(this.selectStyleLayer.changed(),m&&this.panIn&&this.panIntoFeature(m)),r){const P=d.pixel[0]>this.eoxMap.offsetWidth/2?"right":"left",C=d.pixel[1]>this.eoxMap.offsetHeight/2?"bottom":"top";r.setPositioning(`${C}-${P}`),r.setPosition(m?d.coordinate:null),m&&this.tooltipElement&&(this.tooltipElement.feature=m)}const b=new CustomEvent("select",{detail:{id:i.id,originalEvent:d,feature:m}});this.eoxMap.dispatchEvent(b)})},this.eoxMap.map.on(i.condition||"click",this.listener),this.selectLayer.on("change:opacity",()=>{this.selectStyleLayer.setOpacity(this.selectLayer.getOpacity())}),this.selectLayer.on("change:visible",()=>{const d=this.selectLayer.getVisible();this.selectStyleLayer.setVisible(d),this.setActive(d)}),this.changeSourceListener=()=>{this.selectStyleLayer.setSource(this.selectLayer.getSource())},this.selectLayer.on("change:source",this.changeSourceListener);const c=()=>{var d,u;e.getLayerById(t.get("id"))?((d=this.selectStyleLayer)==null||d.setMap(this.eoxMap.map),r==null||r.setMap(this.eoxMap.map)):((u=this.selectStyleLayer)==null||u.setMap(null),r==null||r.setMap(null))};e.map.getLayerGroup().on("change",c),this.pointerMoveListener=d=>{d.dragging||(e.map.getTargetElement().style.cursor=e.map.hasFeatureAtPixel(d.pixel,{layerFilter:u=>{var f,m;return(m=(f=u.get("_jsonDefinition"))==null?void 0:f.interactions)==null?void 0:m.find(_=>{var p;return _.type=="select"&&((p=_.options)==null?void 0:p.condition)==="click"})},...i.atPixelOptions})?i.cursor||"pointer":"auto")},e.map.on("pointermove",this.pointerMoveListener)}setActive(e){this.active=e}highlightById(e,t){if(this.selectedFids=e,e.length&&t){const i=dn();if(this.selectLayer instanceof ue)for(let n=0;n<this.selectedFids.length;n++){const r=this.selectedFids[n],o=this.selectLayer.getSource().getFeatureById(r);o&&o.getGeometry()&&Dt(i,o.getGeometry().getExtent())}else{const n=this.eoxMap.map,r=this.selectLayer.getFeaturesInExtent(n.getView().calculateExtent(n.getSize()));for(let o=0;o<r.length;o++){const a=r[o];this.selectedFids.includes(this.getId(a))&&Dt(i,a.getGeometry().getExtent())}}si(i)||this.panIntoFeature(i,t)}this.selectStyleLayer.changed()}remove(){this.selectStyleLayer.setMap(null),delete this.eoxMap.selectInteractions[this.options.id],this.selectLayer.un("change:source",this.changeSourceListener),this.eoxMap.map.un(this.options.condition||"click",this.listener),this.eoxMap.map.un("pointermove",this.pointerMoveListener)}getId(e){if(this.options.idProperty)return e.get(this.options.idProperty);if(e.getId()!==void 0)return e.getId();if(e.get("id")!==void 0)return e.get("id");if(M(e)!==void 0)return M(e);throw Error("No feature id found. Please provide which feature property should be taken instead using idProperty.")}}function wr(s,e,t){if(s.interactions[t.id])throw Error(`Interaction with id: ${t.id} already exists.`);return s.selectInteractions[t.id]=new br(s,e,t),s.selectInteractions[t.id]}function Er(s){let e;if(!(!s||!s.source||!("tileGrid"in s.source))){if(s.source.tileGrid)if(s.source.type==="WMTS"){const i=W("EPSG:3857").getExtent(),n=ni(i)/128,r=new Array(19),o=new Array(19);for(let a=0;a<19;++a)r[a]=n/Math.pow(2,a),o[a]=a;e=new qn({resolutions:r,origin:yt(i),projection:s.source.tileGrid.projection||"EPSG:3857",matrixIds:o,...s.source.tileGrid})}else e=Xn({...s.source.tileGrid});return e}}function Pt(s,e){return Yi(s.map.getLayers().getArray()).find(i=>i.get("id")===e)}function Yi(s){const e=[];e.push(...s);let t=e.filter(i=>i instanceof q);for(;t.length;){const i=[];for(let n=0;n<t.length;n++){const r=t[n].getLayers().getArray();e.push(...r),i.push(...r.filter(o=>o instanceof q))}t=i}return e}function mt(s){const e=Object.assign({},s.animationOptions),t=s.map.getView();if(Vi(t),!e||!Object.keys(e).length){t.setCenter(s.center),t.setZoom(s.zoom);return}e.center=zi(s.center),e.zoom=s.zoom,t.animate(e)}const lt="units",xr=[1,2,5],me=25.4/.28;class Pr extends O{constructor(e){e=e||{};const t=document.createElement("div");t.style.pointerEvents="none",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un;const i=e.className!==void 0?e.className:e.bar?"ol-scale-bar":"ol-scale-line";this.innerElement_=document.createElement("div"),this.innerElement_.className=i+"-inner",this.element.className=i+" "+U,this.element.appendChild(this.innerElement_),this.viewState_=null,this.minWidth_=e.minWidth!==void 0?e.minWidth:64,this.maxWidth_=e.maxWidth,this.renderedVisible_=!1,this.renderedWidth_=void 0,this.renderedHTML_="",this.addChangeListener(lt,this.handleUnitsChanged_),this.setUnits(e.units||"metric"),this.scaleBar_=e.bar||!1,this.scaleBarSteps_=e.steps||4,this.scaleBarText_=e.text||!1,this.dpi_=e.dpi||void 0}getUnits(){return this.get(lt)}handleUnitsChanged_(){this.updateElement_()}setUnits(e){this.set(lt,e)}setDpi(e){this.dpi_=e}updateElement_(){const e=this.viewState_;if(!e){this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1);return}const t=e.center,i=e.projection,n=this.getUnits(),r=n=="degrees"?"degrees":"m";let o=Ze(i,e.resolution,t,r);const a=this.minWidth_*(this.dpi_||me)/me,l=this.maxWidth_!==void 0?this.maxWidth_*(this.dpi_||me)/me:void 0;let c=a*o,h="";if(n=="degrees"){const P=ps.degrees;c*=P,c<P/60?(h="″",o*=3600):c<P?(h="′",o*=60):h="°"}else if(n=="imperial")c<.9144?(h="in",o/=.0254):c<1609.344?(h="ft",o/=.3048):(h="mi",o/=1609.344);else if(n=="nautical")o/=1852,h="NM";else if(n=="metric")c<1e-6?(h="nm",o*=1e9):c<.001?(h="μm",o*=1e6):c<1?(h="mm",o*=1e3):c<1e3?h="m":(h="km",o/=1e3);else if(n=="us")c<.9144?(h="in",o*=39.37):c<1609.344?(h="ft",o/=.30480061):(h="mi",o/=1609.3472);else throw new Error("Invalid units");let g=3*Math.floor(Math.log(a*o)/Math.log(10)),d,u,f,m=0,_,p;for(;;){f=Math.floor(g/3);const P=Math.pow(10,f);if(d=xr[(g%3+3)%3]*P,u=Math.round(d/o),isNaN(u)){this.element.style.display="none",this.renderedVisible_=!1;return}if(l!==void 0&&u>=l){d=m,u=_,f=p;break}else if(u>=a)break;m=d,_=u,p=f,++g}const b=this.scaleBar_?this.createScaleBar(u,d,h):d.toFixed(f<0?-f:0)+" "+h;this.renderedHTML_!=b&&(this.innerElement_.innerHTML=b,this.renderedHTML_=b),this.renderedWidth_!=u&&(this.innerElement_.style.width=u+"px",this.renderedWidth_=u),this.renderedVisible_||(this.element.style.display="",this.renderedVisible_=!0)}createScaleBar(e,t,i){const n=this.getScaleForResolution(),r=n<1?Math.round(1/n).toLocaleString()+" : 1":"1 : "+Math.round(n).toLocaleString(),o=this.scaleBarSteps_,a=e/o,l=[this.createMarker("absolute")];for(let h=0;h<o;++h){const g=h%2===0?"ol-scale-singlebar-odd":"ol-scale-singlebar-even";l.push(`<div><div class="ol-scale-singlebar ${g}" style="width: ${a}px;"></div>`+this.createMarker("relative")+(h%2===0||o===2?this.createStepText(h,e,!1,t,i):"")+"</div>")}return l.push(this.createStepText(o,e,!0,t,i)),(this.scaleBarText_?`<div class="ol-scale-text" style="width: ${e}px;">`+r+"</div>":"")+l.join("")}createMarker(e){return`<div class="ol-scale-step-marker" style="position: ${e}; top: ${e==="absolute"?3:-10}px;"></div>`}createStepText(e,t,i,n,r){const a=(e===0?0:Math.round(n/this.scaleBarSteps_*e*100)/100)+(e===0?"":" "+r),l=e===0?-3:t/this.scaleBarSteps_*-1,c=e===0?0:t/this.scaleBarSteps_*2;return`<div class="ol-scale-step-text" style="margin-left: ${l}px;text-align: ${e===0?"left":"center"};min-width: ${c}px;left: ${i?t+"px":"unset"};">`+a+"</div>"}getScaleForResolution(){const e=Ze(this.viewState_.projection,this.viewState_.resolution,this.viewState_.center,"m"),t=this.dpi_||me,i=1e3/25.4;return e*i*t}render(e){const t=e.frameState;t?this.viewState_=t.viewState:this.viewState_=null,this.updateElement_()}}const Xt=["fullscreenchange","webkitfullscreenchange"],$t={ENTERFULLSCREEN:"enterfullscreen",LEAVEFULLSCREEN:"leavefullscreen"};class Tr extends O{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.on,this.once,this.un,this.keys_=e.keys!==void 0?e.keys:!1,this.source_=e.source,this.isInFullscreen_=!1,this.boundHandleMapTargetChange_=this.handleMapTargetChange_.bind(this),this.cssClassName_=e.className!==void 0?e.className:"ol-full-screen",this.documentListeners_=[],this.activeClassName_=e.activeClassName!==void 0?e.activeClassName.split(" "):[this.cssClassName_+"-true"],this.inactiveClassName_=e.inactiveClassName!==void 0?e.inactiveClassName.split(" "):[this.cssClassName_+"-false"];const t=e.label!==void 0?e.label:"⤢";this.labelNode_=typeof t=="string"?document.createTextNode(t):t;const i=e.labelActive!==void 0?e.labelActive:"×";this.labelActiveNode_=typeof i=="string"?document.createTextNode(i):i;const n=e.tipLabel?e.tipLabel:"Toggle full-screen";this.button_=document.createElement("button"),this.button_.title=n,this.button_.setAttribute("type","button"),this.button_.appendChild(this.labelNode_),this.button_.addEventListener(v.CLICK,this.handleClick_.bind(this),!1),this.setClassName_(this.button_,this.isInFullscreen_),this.element.className=`${this.cssClassName_} ${U} ${X}`,this.element.appendChild(this.button_)}handleClick_(e){e.preventDefault(),this.handleFullScreen_()}handleFullScreen_(){const e=this.getMap();if(!e)return;const t=e.getOwnerDocument();if(Jt(t))if(Qt(t))Lr(t);else{let i;this.source_?i=typeof this.source_=="string"?t.getElementById(this.source_):this.source_:i=e.getTargetElement(),this.keys_?Sr(i):qi(i)}}handleFullScreenChange_(){const e=this.getMap();if(!e)return;const t=this.isInFullscreen_;this.isInFullscreen_=Qt(e.getOwnerDocument()),t!==this.isInFullscreen_&&(this.setClassName_(this.button_,this.isInFullscreen_),this.isInFullscreen_?(le(this.labelActiveNode_,this.labelNode_),this.dispatchEvent($t.ENTERFULLSCREEN)):(le(this.labelNode_,this.labelActiveNode_),this.dispatchEvent($t.LEAVEFULLSCREEN)),e.updateSize())}setClassName_(e,t){t?(e.classList.remove(...this.inactiveClassName_),e.classList.add(...this.activeClassName_)):(e.classList.remove(...this.activeClassName_),e.classList.add(...this.inactiveClassName_))}setMap(e){const t=this.getMap();t&&t.removeChangeListener(x.TARGET,this.boundHandleMapTargetChange_),super.setMap(e),this.handleMapTargetChange_(),e&&e.addChangeListener(x.TARGET,this.boundHandleMapTargetChange_)}handleMapTargetChange_(){const e=this.documentListeners_;for(let i=0,n=e.length;i<n;++i)F(e[i]);e.length=0;const t=this.getMap();if(t){const i=t.getOwnerDocument();Jt(i)?this.element.classList.remove(Vt):this.element.classList.add(Vt);for(let n=0,r=Xt.length;n<r;++n)e.push(E(i,Xt[n],this.handleFullScreenChange_,this));this.handleFullScreenChange_()}}}function Jt(s){const e=s.body;return!!(e.webkitRequestFullscreen||e.requestFullscreen&&s.fullscreenEnabled)}function Qt(s){return!!(s.webkitIsFullScreen||s.fullscreenElement)}function qi(s){s.requestFullscreen?s.requestFullscreen():s.webkitRequestFullscreen&&s.webkitRequestFullscreen()}function Sr(s){s.webkitRequestFullscreen?s.webkitRequestFullscreen():qi(s)}function Lr(s){s.exitFullscreen?s.exitFullscreen():s.webkitExitFullscreen&&s.webkitExitFullscreen()}const _e={VERTICAL:0,HORIZONTAL:1};class Ir extends O{constructor(e){e=e||{},super({target:e.target,element:document.createElement("div"),render:e.render}),this.dragListenerKeys_=[],this.currentResolution_=void 0,this.direction_=_e.VERTICAL,this.dragging_,this.heightLimit_=0,this.widthLimit_=0,this.startX_,this.startY_,this.thumbSize_=null,this.sliderInitialized_=!1,this.duration_=e.duration!==void 0?e.duration:200;const t=e.className!==void 0?e.className:"ol-zoomslider",i=document.createElement("button");i.setAttribute("type","button"),i.className=t+"-thumb "+U;const n=this.element;n.className=t+" "+U+" "+X,n.appendChild(i),n.addEventListener(K.POINTERDOWN,this.handleDraggerStart_.bind(this),!1),n.addEventListener(K.POINTERMOVE,this.handleDraggerDrag_.bind(this),!1),n.addEventListener(K.POINTERUP,this.handleDraggerEnd_.bind(this),!1),n.addEventListener(v.CLICK,this.handleContainerClick_.bind(this),!1),i.addEventListener(v.CLICK,un,!1)}setMap(e){super.setMap(e),e&&e.render()}initSlider_(){const e=this.element;let t=e.offsetWidth,i=e.offsetHeight;if(t===0&&i===0)return this.sliderInitialized_=!1;const n=getComputedStyle(e);t-=parseFloat(n.paddingRight)+parseFloat(n.paddingLeft),i-=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom);const r=e.firstElementChild,o=getComputedStyle(r),a=r.offsetWidth+parseFloat(o.marginRight)+parseFloat(o.marginLeft),l=r.offsetHeight+parseFloat(o.marginTop)+parseFloat(o.marginBottom);return this.thumbSize_=[a,l],t>i?(this.direction_=_e.HORIZONTAL,this.widthLimit_=t-a):(this.direction_=_e.VERTICAL,this.heightLimit_=i-l),this.sliderInitialized_=!0}handleContainerClick_(e){const t=this.getMap().getView(),i=this.getRelativePosition_(e.offsetX-this.thumbSize_[0]/2,e.offsetY-this.thumbSize_[1]/2),n=this.getResolutionForPosition_(i),r=t.getConstrainedZoom(t.getZoomForResolution(n));t.animateInternal({zoom:r,duration:this.duration_,easing:de})}handleDraggerStart_(e){if(!this.dragging_&&e.target===this.element.firstElementChild){const t=this.element.firstElementChild;if(this.getMap().getView().beginInteraction(),this.startX_=e.clientX-parseFloat(t.style.left),this.startY_=e.clientY-parseFloat(t.style.top),this.dragging_=!0,this.dragListenerKeys_.length===0){const i=this.handleDraggerDrag_,n=this.handleDraggerEnd_,r=this.getMap().getOwnerDocument();this.dragListenerKeys_.push(E(r,K.POINTERMOVE,i,this),E(r,K.POINTERUP,n,this))}}}handleDraggerDrag_(e){if(this.dragging_){const t=e.clientX-this.startX_,i=e.clientY-this.startY_,n=this.getRelativePosition_(t,i);this.currentResolution_=this.getResolutionForPosition_(n),this.getMap().getView().setResolution(this.currentResolution_)}}handleDraggerEnd_(e){this.dragging_&&(this.getMap().getView().endInteraction(),this.dragging_=!1,this.startX_=void 0,this.startY_=void 0,this.dragListenerKeys_.forEach(F),this.dragListenerKeys_.length=0)}setThumbPosition_(e){const t=this.getPositionForResolution_(e),i=this.element.firstElementChild;this.direction_==_e.HORIZONTAL?i.style.left=this.widthLimit_*t+"px":i.style.top=this.heightLimit_*t+"px"}getRelativePosition_(e,t){let i;return this.direction_===_e.HORIZONTAL?i=e/this.widthLimit_:i=t/this.heightLimit_,Ke(i,0,1)}getResolutionForPosition_(e){return this.getMap().getView().getResolutionForValueFunction()(1-e)}getPositionForResolution_(e){const t=this.getMap().getView().getValueForResolutionFunction();return Ke(1-t(e),0,1)}render(e){if(!e.frameState||!this.sliderInitialized_&&!this.initSlider_())return;const t=e.frameState.viewState.resolution;this.currentResolution_=t,this.setThumbPosition_(t)}}const ht=.75,ze=.1;class Rr extends O{constructor(e){e=e||{},super({element:document.createElement("div"),render:e.render,target:e.target}),this.boundHandleRotationChanged_=this.handleRotationChanged_.bind(this),this.collapsed_=e.collapsed!==void 0?e.collapsed:!0,this.collapsible_=e.collapsible!==void 0?e.collapsible:!0,this.collapsible_||(this.collapsed_=!1),this.rotateWithView_=e.rotateWithView!==void 0?e.rotateWithView:!1,this.viewExtent_=void 0;const t=e.className!==void 0?e.className:"ol-overviewmap",i=e.tipLabel!==void 0?e.tipLabel:"Overview map",n=e.collapseLabel!==void 0?e.collapseLabel:"‹";typeof n=="string"?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=n):this.collapseLabel_=n;const r=e.label!==void 0?e.label:"›";typeof r=="string"?(this.label_=document.createElement("span"),this.label_.textContent=r):this.label_=r;const o=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_,a=document.createElement("button");a.setAttribute("type","button"),a.title=i,a.appendChild(o),a.addEventListener(v.CLICK,this.handleClick_.bind(this),!1),this.ovmapDiv_=document.createElement("div"),this.ovmapDiv_.className="ol-overviewmap-map",this.view_=e.view;const l=new Di({view:e.view,controls:new A,interactions:new A});this.ovmap_=l,e.layers&&e.layers.forEach(function(p){l.addLayer(p)});const c=document.createElement("div");c.className="ol-overviewmap-box",c.style.boxSizing="border-box",this.boxOverlay_=new Hi({position:[0,0],positioning:"center-center",element:c}),this.ovmap_.addOverlay(this.boxOverlay_);const h=t+" "+U+" "+X+(this.collapsed_&&this.collapsible_?" "+He:"")+(this.collapsible_?"":" ol-uncollapsible"),g=this.element;g.className=h,g.appendChild(this.ovmapDiv_),g.appendChild(a);const d=this.boxOverlay_,u=this.boxOverlay_.getElement(),f=p=>({clientX:p.clientX,clientY:p.clientY}),m=function(p){const b=f(p),P=l.getEventCoordinate(b);d.setPosition(P)},_=p=>{const b=l.getEventCoordinateInternal(p),P=this.getMap();P.getView().setCenterInternal(b);const C=P.getOwnerDocument();C.removeEventListener("pointermove",m),C.removeEventListener("pointerup",_)};this.ovmapDiv_.addEventListener("pointerdown",p=>{const b=this.getMap().getOwnerDocument();p.target===u&&b.addEventListener("pointermove",m),b.addEventListener("pointerup",_)})}setMap(e){const t=this.getMap();if(e!==t){if(t){const i=t.getView();i&&this.unbindView_(i),this.ovmap_.setTarget(null)}if(super.setMap(e),e){this.ovmap_.setTarget(this.ovmapDiv_),this.listenerKeys.push(E(e,Ue.PROPERTYCHANGE,this.handleMapPropertyChange_,this));const i=e.getView();i&&this.bindView_(i),this.ovmap_.isRendered()||this.updateBoxAfterOvmapIsRendered_()}}}handleMapPropertyChange_(e){if(e.key===x.VIEW){const t=e.oldValue;t&&this.unbindView_(t);const i=this.getMap().getView();this.bindView_(i)}else!this.ovmap_.isRendered()&&(e.key===x.TARGET||e.key===x.SIZE)&&this.ovmap_.updateSize()}bindView_(e){if(!this.view_){const t=new j({projection:e.getProjection()});this.ovmap_.setView(t)}e.addChangeListener(Gt.ROTATION,this.boundHandleRotationChanged_),this.handleRotationChanged_(),e.isDef()&&(this.ovmap_.updateSize(),this.resetExtent_())}unbindView_(e){e.removeChangeListener(Gt.ROTATION,this.boundHandleRotationChanged_)}handleRotationChanged_(){this.rotateWithView_&&this.ovmap_.getView().setRotation(this.getMap().getView().getRotation())}validateExtent_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),r=e.getView().calculateExtentInternal(i);if(this.viewExtent_&&dt(r,this.viewExtent_))return;this.viewExtent_=r;const o=t.getSize(),l=t.getView().calculateExtentInternal(o),c=t.getPixelFromCoordinateInternal(yt(r)),h=t.getPixelFromCoordinateInternal(oi(r)),g=Math.abs(c[0]-h[0]),d=Math.abs(c[1]-h[1]),u=o[0],f=o[1];g<u*ze||d<f*ze||g>u*ht||d>f*ht?this.resetExtent_():li(l,r)||this.recenter_()}resetExtent_(){const e=this.getMap(),t=this.ovmap_,i=e.getSize(),r=e.getView().calculateExtentInternal(i),o=t.getView(),a=Math.log(ht/ze)/Math.LN2,l=1/(Math.pow(2,a/2)*ze);gn(r,l),o.fitInternal(wi(r))}recenter_(){const e=this.getMap(),t=this.ovmap_,i=e.getView();t.getView().setCenterInternal(i.getCenterInternal())}updateBox_(){const e=this.getMap(),t=this.ovmap_;if(!e.isRendered()||!t.isRendered())return;const i=e.getSize(),n=e.getView(),r=t.getView(),o=this.rotateWithView_?0:-n.getRotation(),a=this.boxOverlay_,l=this.boxOverlay_.getElement(),c=n.getCenter(),h=n.getResolution(),g=r.getResolution(),d=i[0]*h/g,u=i[1]*h/g;if(a.setPosition(c),l){l.style.width=d+"px",l.style.height=u+"px";const f="rotate("+o+"rad)";l.style.transform=f}}updateBoxAfterOvmapIsRendered_(){this.ovmapPostrenderKey_||(this.ovmapPostrenderKey_=fn(this.ovmap_,G.POSTRENDER,e=>{delete this.ovmapPostrenderKey_,this.updateBox_()}))}handleClick_(e){e.preventDefault(),this.handleToggle_()}handleToggle_(){this.element.classList.toggle(He),this.collapsed_?le(this.collapseLabel_,this.label_):le(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_;const e=this.ovmap_;if(!this.collapsed_){if(e.isRendered()){this.viewExtent_=void 0,e.render();return}e.updateSize(),this.resetExtent_(),this.updateBoxAfterOvmapIsRendered_()}}getCollapsible(){return this.collapsible_}setCollapsible(e){this.collapsible_!==e&&(this.collapsible_=e,this.element.classList.toggle("ol-uncollapsible"),!e&&this.collapsed_&&this.handleToggle_())}setCollapsed(e){!this.collapsible_||this.collapsed_===e||this.handleToggle_()}getCollapsed(){return this.collapsed_}getRotateWithView(){return this.rotateWithView_}setRotateWithView(e){this.rotateWithView_!==e&&(this.rotateWithView_=e,this.getMap().getView().getRotation()!==0&&(this.rotateWithView_?this.handleRotationChanged_():this.ovmap_.getView().setRotation(0),this.viewExtent_=void 0,this.validateExtent_(),this.updateBox_()))}getOverviewMap(){return this.ovmap_}render(e){this.validateExtent_(),this.updateBox_()}}class Fr extends O{constructor(e){e=e||{},super({element:document.createElement("div"),target:e.target}),this.extent=e.extent?e.extent:null;const t=e.className!==void 0?e.className:"ol-zoom-extent",i=e.label!==void 0?e.label:"E",n=e.tipLabel!==void 0?e.tipLabel:"Fit to extent",r=document.createElement("button");r.setAttribute("type","button"),r.title=n,r.appendChild(typeof i=="string"?document.createTextNode(i):i),r.addEventListener(v.CLICK,this.handleClick_.bind(this),!1);const o=t+" "+U+" "+X,a=this.element;a.className=o,a.appendChild(r)}handleClick_(e){e.preventDefault(),this.handleZoomToExtent()}handleZoomToExtent(){const t=this.getMap().getView(),i=this.extent?vi(this.extent,t.getProjection()):t.getProjection().getExtent();t.fitInternal(wi(i))}}const ct="projection",ei="coordinateFormat";class kr extends O{constructor(e){e=e||{};const t=document.createElement("div");t.className=e.className!==void 0?e.className:"ol-mouse-position",super({element:t,render:e.render,target:e.target}),this.on,this.once,this.un,this.addChangeListener(ct,this.handleProjectionChanged_),e.coordinateFormat&&this.setCoordinateFormat(e.coordinateFormat),e.projection&&this.setProjection(e.projection),this.renderOnMouseOut_=e.placeholder!==void 0,this.placeholder_=this.renderOnMouseOut_?e.placeholder:"&#160;",this.renderedHTML_=t.innerHTML,this.mapProjection_=null,this.transform_=null,this.wrapX_=e.wrapX!==!1}handleProjectionChanged_(){this.transform_=null}getCoordinateFormat(){return this.get(ei)}getProjection(){return this.get(ct)}handleMouseMove(e){const t=this.getMap();this.updateHTML_(t.getEventPixel(e))}handleMouseOut(e){this.updateHTML_(null)}setMap(e){if(super.setMap(e),e){const t=e.getViewport();this.listenerKeys.push(E(t,K.POINTERMOVE,this.handleMouseMove,this)),this.renderOnMouseOut_&&this.listenerKeys.push(E(t,K.POINTEROUT,this.handleMouseOut,this)),this.updateHTML_(null)}}setCoordinateFormat(e){this.set(ei,e)}setProjection(e){this.set(ct,W(e))}updateHTML_(e){let t=this.placeholder_;if(e&&this.mapProjection_){if(!this.transform_){const r=this.getProjection();r?this.transform_=Ei(this.mapProjection_,r):this.transform_=xi}const n=this.getMap().getCoordinateFromPixelInternal(e);if(n){if(this.transform_(n,n),this.wrapX_){const o=this.getProjection()||this.mapProjection_;yi(n,o)}const r=this.getCoordinateFormat();r?t=r(n):t=n.toString()}}(!this.renderedHTML_||t!==this.renderedHTML_)&&(this.element.innerHTML=t,this.renderedHTML_=t)}render(e){const t=e.frameState;t?this.mapProjection_!=t.viewState.projection&&(this.mapProjection_=t.viewState.projection,this.transform_=null):this.mapProjection_=null}}const w={ACCURACY:"accuracy",ACCURACY_GEOMETRY:"accuracyGeometry",ALTITUDE:"altitude",ALTITUDE_ACCURACY:"altitudeAccuracy",HEADING:"heading",POSITION:"position",PROJECTION:"projection",SPEED:"speed",TRACKING:"tracking",TRACKING_OPTIONS:"trackingOptions"},Nr={ERROR:"error"};class Ar extends Re{constructor(e){super(Nr.ERROR),this.code=e.code,this.message=e.message}}class Dr extends Fe{constructor(e){super(),this.on,this.once,this.un,e=e||{},this.position_=null,this.transform_=xi,this.watchId_=void 0,this.addChangeListener(w.PROJECTION,this.handleProjectionChanged_),this.addChangeListener(w.TRACKING,this.handleTrackingChanged_),e.projection!==void 0&&this.setProjection(e.projection),e.trackingOptions!==void 0&&this.setTrackingOptions(e.trackingOptions),this.setTracking(e.tracking!==void 0?e.tracking:!1)}disposeInternal(){this.setTracking(!1),super.disposeInternal()}handleProjectionChanged_(){const e=this.getProjection();e&&(this.transform_=Ei(W("EPSG:4326"),e),this.position_&&this.set(w.POSITION,this.transform_(this.position_)))}handleTrackingChanged_(){if("geolocation"in navigator){const e=this.getTracking();e&&this.watchId_===void 0?this.watchId_=navigator.geolocation.watchPosition(this.positionChange_.bind(this),this.positionError_.bind(this),this.getTrackingOptions()):!e&&this.watchId_!==void 0&&(navigator.geolocation.clearWatch(this.watchId_),this.watchId_=void 0)}}positionChange_(e){const t=e.coords;this.set(w.ACCURACY,t.accuracy),this.set(w.ALTITUDE,t.altitude===null?void 0:t.altitude),this.set(w.ALTITUDE_ACCURACY,t.altitudeAccuracy===null?void 0:t.altitudeAccuracy),this.set(w.HEADING,t.heading===null?void 0:mn(t.heading)),this.position_?(this.position_[0]=t.longitude,this.position_[1]=t.latitude):this.position_=[t.longitude,t.latitude];const i=this.transform_(this.position_);this.set(w.POSITION,i.slice()),this.set(w.SPEED,t.speed===null?void 0:t.speed);const n=ys(this.position_,t.accuracy);n.applyTransform(this.transform_),this.set(w.ACCURACY_GEOMETRY,n),this.changed()}positionError_(e){this.dispatchEvent(new Ar(e))}getAccuracy(){return this.get(w.ACCURACY)}getAccuracyGeometry(){return this.get(w.ACCURACY_GEOMETRY)||null}getAltitude(){return this.get(w.ALTITUDE)}getAltitudeAccuracy(){return this.get(w.ALTITUDE_ACCURACY)}getHeading(){return this.get(w.HEADING)}getPosition(){return this.get(w.POSITION)}getProjection(){return this.get(w.PROJECTION)}getSpeed(){return this.get(w.SPEED)}getTracking(){return this.get(w.TRACKING)}getTrackingOptions(){return this.get(w.TRACKING_OPTIONS)}setProjection(e){this.set(w.PROJECTION,W(e))}setTracking(e){this.set(w.TRACKING,e)}setTrackingOptions(e){this.set(w.TRACKING_OPTIONS,e)}}class Mr extends O{constructor(e){const t=e||{},i=document.createElement("div");i.className="geolocation ol-unselectable ol-control";const n=document.createElement("button");n.title="Show your location";const r=document.createElement("img");if(t.buttonIcon)r.src=t.buttonIcon;else{const o=`url(
        "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='-6 -6 36 36'%3E %3Cpath d='M12,8A4,4 0 0,1 16,12A4,4 0 0,1 12,16A4,4 0 0,1 8,12A4,4 0 0,1 12,8M3.05,13H1V11H3.05C3.5,6.83 6.83,3.5 11,3.05V1H13V3.05C17.17,3.5 20.5,6.83 20.95,11H23V13H20.95C20.5,17.17 17.17,20.5 13,20.95V23H11V20.95C6.83,20.5 3.5,17.17 3.05,13M12,5A7,7 0 0,0 5,12A7,7 0 0,0 12,19A7,7 0 0,0 19,12A7,7 0 0,0 12,5Z' /%3E%3C/svg%3E"
      )`;r.style.background="var(--ol-subtle-foreground-color)",r.style.maskImage=o,r.style.webkitMaskImage=o}r.style.height="100%",r.style.width="100%",r.style.position="absolute",r.style.pointerEvents="none",i.appendChild(r),i.appendChild(n),super({element:i}),this._centerWhenReady=t.centerWhenReady,this._highAccuracy=t.highAccuracy,this._trackAccuracy=t.trackAccuracy,this._trackHeading=t.trackHeading,this._positionFeature=new z({geometry:new ne([NaN,NaN]),heading:0}),this._source=new $e({features:[this._positionFeature]}),this._trackAccuracy&&(this._accuracyFeature=new z,this._accuracyFeature.setStyle(new $n({fill:new Qn({color:"rgba(0, 0, 0, 0.2)"}),stroke:new Jn({width:2,color:"rgba(0, 0, 0, 0.7)"})})),this._source.addFeature(this._accuracyFeature)),this._layer=new ue({source:this._source}),t.style&&this._layer.setStyle(t.style),n.addEventListener("click",this.centerOnPosition.bind(this),!1)}setMap(e){this._layer.setMap(e),super.setMap(e),e&&this._centerWhenReady&&this.initGeolocation()}initGeolocation(){return new Promise((e,t)=>{const i=this.getMap();i&&(this._geolocation=new Dr({tracking:!0,trackingOptions:{enableHighAccuracy:this._highAccuracy},projection:i.getView().getProjection()})),this._centerWhenReady&&this._geolocation.once("change:position",n=>{i.getView().setCenter(n.target.getPosition())}),this._geolocation.on("error",n=>t(n)),this._geolocation.on("change:accuracyGeometry",()=>{this._trackAccuracy&&this._accuracyFeature.setGeometry(this._geolocation.getAccuracyGeometry())}),this._geolocation.on("change:heading",n=>{this._trackHeading&&this._highAccuracy&&this._positionFeature.set("heading",n.target.getHeading())}),this._geolocation.on("change:position",()=>{const n=this._geolocation.getPosition();this._positionFeature.getGeometry().setCoordinates(n||null),e(n)})})}getElement(){return this.element}async centerOnPosition(){var e,t;try{await this.initGeolocation();const i=(e=this._geolocation)==null?void 0:e.getPosition();i&&((t=this.getMap())==null||t.getView().setCenter(i))}catch(i){console.error(i)}}}class Or extends O{constructor(e){const t=e||{};t.opacity===void 0&&(t.opacity=1),t.type===void 0&&(t.type="small");const i=document.createElement("div");i.className="LoadingIndicator ol-unselectable ol-control",i.classList.add("loading-indicator"),i.style.opacity=String(t.opacity),t.spinnerSvg?i.innerHTML=t.spinnerSvg:i.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid" width="50" height="50" style="shape-rendering: auto; display: block; background: transparent;" xmlns:xlink="http://www.w3.org/1999/xlink"><g><circle stroke-dasharray="164.93361431346415 56.97787143782138" r="35" stroke-width="12" stroke="#1a467c" fill="none" cy="50" cx="50">
      <animateTransform keyTimes="0;1" values="0 50 50;360 50 50" dur="1.2222222222222223s" repeatCount="indefinite" type="rotate" attributeName="transform"></animateTransform>
      </circle></g></svg>`,t.type==="fullscreen"?i.classList.add("fullscreen"):i.classList.add("small"),super({element:i})}setMap(e){super.setMap(e),e&&(e.on("loadstart",()=>{this.getElement().style.visibility="visible"}),e.on("loadend",()=>{this.getElement().style.visibility="hidden"}))}getElement(){return this.element}}const Vr={Zoom:Si,Rotate:Ti,ScaleLine:Pr,FullScreen:Tr,ZoomSlider:Ir,Attribution:Pi,OverviewMap:Rr,ZoomToExtent:Fr,MousePosition:kr,Geolocation:Mr,LoadingIndicator:Or};function Gr(s,e,t,i){e&&e[t]?JSON.stringify(e[t])!==JSON.stringify(i)&&(s.removeControl(t),ti(s,t,i)):ti(s,t,i)}function ti(s,e,t){const i=Object.assign({},t);t&&t.layers&&(i.layers=Cr(s,t.layers));const n=new Vr[e](i);s.map.addControl(n),s.mapControls[e]=n}function jr(s,e){let t;const i=(s==null?void 0:s.length)&&nr(s,e.map.getView().getCenter());return s&&!i&&(!e.projection||e.projection==="EPSG:3857"?t=zi(s):t=s),t}function zr(s,e){if(!s||!s.length)return;const t=e.map.getView();return Vi(t),setTimeout(()=>t.fit(s,e.animationOptions),0),s}function Kr(s,e,t){const i=s;if(e){const n=Object.keys(e),r=Object.keys(i);for(let o=0,a=n.length;o<a;o++){const l=n[o];r.includes(l)||t.removeControl(l)}}if(i){const n=Object.keys(s);for(let r=0,o=n.length;r<o;r++){const a=n[r];Gr(t,e,a,s[a])}}return i}function Ur(s){return JSON.parse(JSON.stringify(s)).reverse()}function Hr(s,e,t){const i=Ur(s);e&&e.forEach(l=>{var c,h;if(!((c=l.properties)!=null&&c.id)||!i.find(g=>g.properties.id===l.properties.id)){const g=Pt(t,(h=l.properties)==null?void 0:h.id),u=g.get("_jsonDefinition").interactions;u==null||u.forEach(f=>{f.type==="select"?t.removeSelect(f.options.id):t.removeInteraction(f.options.id)}),t.map.removeLayer(g)}}),i.forEach(l=>{t.addOrUpdateLayer(l)});const n=i.map(l=>{var c;return(c=l.properties)==null?void 0:c.id});t.map.getLayers().getArray().sort((l,c)=>n.indexOf(l.get("id"))-n.indexOf(c.get("id")));let r=t.map.getLayers().getArray().reduce((l,c)=>{var h,g,d,u,f,m,_,p;return l.maxZoom=(g=(h=t.config)==null?void 0:h.view)!=null&&g.maxZoom?(u=(d=t.config)==null?void 0:d.view)==null?void 0:u.maxZoom:l.maxZoom===void 0||c.get("maxZoom")<l.maxZoom?c.get("maxZoom"):l.maxZoom,l.minZoom=(m=(f=t.config)==null?void 0:f.view)!=null&&m.minZoom?(p=(_=t.config)==null?void 0:_.view)==null?void 0:p.minZoom:l.minZoom===void 0||c.get("minZoom")>l.minZoom?c.get("minZoom"):l.minZoom,l},{minZoom:0,maxZoom:1/0});t.map.getLayers().getArray().map(l=>l.setMinZoom(l.get("minZoom")-1e-12));const o=t.map.getView().getMinZoom(),a=t.map.getView().getMaxZoom();return o!==r.minZoom&&t.map.getView().setMinZoom(r.minZoom>=0?r.minZoom:0),a!==r.maxZoom&&t.map.getView().setMaxZoom(r.maxZoom),t.map.on("moveend",()=>{var h;if(!((h=t==null?void 0:t.controls)!=null&&h.Zoom))return;const l=t.renderRoot.querySelector("button.ol-zoom-out"),c=t.renderRoot.querySelector("button.ol-zoom-in");t.map.getView().getZoom()>=r.maxZoom?c==null||c.classList.add("disabled"):c==null||c.classList.remove("disabled"),t.map.getView().getZoom()-1e-12<=r.minZoom?l==null||l.classList.add("disabled"):l==null||l.classList.remove("disabled")}),i}function Wr(s,e){return s?(ir(e.map),Wt(e.map,!0)):Wt(e.map),s}function Br(s,e){var t,i,n,r,o,a,l,c;return(s==null?void 0:s.animationOptions)!==void 0&&(e.animationOptions=s.animationOptions),e.projection=((t=s==null?void 0:s.view)==null?void 0:t.projection)||"EPSG:3857",e.layers=(s==null?void 0:s.layers)||[],e.controls=(s==null?void 0:s.controls)||{},e.preventScroll===void 0&&(e.preventScroll=s==null?void 0:s.preventScroll),e.zoom=((i=s==null?void 0:s.view)==null?void 0:i.zoom)||0,e.center=((n=s==null?void 0:s.view)==null?void 0:n.center)||[0,0],e.zoomExtent=(r=s==null?void 0:s.view)==null?void 0:r.zoomExtent,(o=s==null?void 0:s.view)!=null&&o.minZoom&&e.map.getView().setMinZoom((a=s==null?void 0:s.view)==null?void 0:a.minZoom),(l=s==null?void 0:s.view)!=null&&l.maxZoom&&e.map.getView().setMaxZoom((c=s==null?void 0:s.view)==null?void 0:c.maxZoom),s}function Zr(s,e,t){let i=e;const n=t.map.getView();if(s&&W(s)&&s!==n.getProjection().getCode()){const r=Ct(n.getCenter(),n.getProjection().getCode(),s),o=W(s),a=n.getResolution(),l=n.getProjection().getMetersPerUnit(),c=o.getMetersPerUnit(),h=Ze(n.getProjection(),1/l,n.getCenter(),"m")*l,g=Ze(o,1/c,r,"m")*c,d=a*h/g,u=new j({zoom:n.getZoom(),center:r,resolution:d,rotation:n.getRotation(),projection:s});["change:center","change:resolution","change:rotation","propertychange"].forEach(m=>{const _=n.getListeners(m);if(_!=null&&_.length)for(let p=_.length-1;p>=0;p--){const b=_[p];n.un(m,b),u.on(m,b)}}),t.map.setView(u),t.getFlatLayersArray(t.map.getLayers().getArray()).filter(m=>m instanceof ue).forEach(m=>m.getSource().refresh()),i=s,t.center=r}return i}function Yr(s,e){return s&&setTimeout(()=>{const t=vs(s);t&&(e.clientHeight<1&&!t.zoom?t.map.setView(e.map.getView()):e.map.setView(t.map.getView()))}),s}function qr(s){return s.projection==="EPSG:4326"?s.map.getView().getCenter():Gi(s.map.getView().getCenter(),s.projection)}function Xr(s){const e=s.map.getView().calculateExtent(s.map.getSize());return s.projection==="EPSG:4326"?e:ji(e,s.projection)}function $r(s,e){var r;s.interactions||(s.interactions=[]);const t=(r=s.properties)==null?void 0:r.id,i=t?Pt(e,t):!1;let n;return i?(Bi(e,s,i),n=i):(n=he(e,s),e.map.addLayer(n)),n}function Jr(s,e){e.map.removeInteraction(e.interactions[s]),delete e.interactions[s],e.interactions[`${s}_modify`]&&(e.map.removeInteraction(e.interactions[`${s}_modify`]),delete e.interactions[`${s}_modify`])}function Qr(s,e){e.selectInteractions[s].remove(),delete e.selectInteractions[s]}function eo(s,e){e.map.removeControl(e.mapControls[s]),delete e.mapControls[s]}function to(s,e){e.map.once("change:target",t=>{t.target.getView().setCenter(e.center)}),e.map.setTarget(e.renderRoot.querySelector("div")),s?e.map.getView().fit(s,e.animationOptions):mt(e),e.map.on("loadend",()=>{e.dispatchEvent(new CustomEvent("loadend",{detail:e.map}))}),e.dispatchEvent(new CustomEvent("mapmounted",{detail:e.map}))}var Ee,re,oe,xe,Pe,Te,Se,Le,Ie,ae;class io extends _t{constructor(){super();k(this,Ee);k(this,re);k(this,oe);k(this,xe);k(this,Pe);k(this,Te);k(this,Se);k(this,Le,[0,0]);k(this,Ie,0);k(this,ae,"EPSG:3857");V(this,"parseFeature",tr);V(this,"parseTextToFeature",Ys);V(this,"registerProjectionFromCode",er);V(this,"registerProjection",Qs);V(this,"getFlatLayersArray",Yi);V(this,"transform",Gi);V(this,"transformExtent",ji);V(this,"buffer",ri);this.map=new Di({controls:[],layers:[],view:new j({center:[0,0],zoom:0,projection:this.projection})}),this.interactions={},this.selectInteractions={},this.mapControls={}}static get properties(){return{center:{attribute:!1,type:Array},layers:{attribute:!1,type:Array},preventScroll:{attribute:"prevent-scroll",type:Boolean},config:{attribute:!1,type:Object},sync:{attribute:"sync",type:String},projection:{attribute:"projection",type:String},map:{attribute:!1,state:!0},intersections:{attribute:!1,state:!0,type:Object},selectInteractions:{attribute:!1,state:!0,type:Object},mapControls:{attribute:!1,state:!0,type:Object}}}set center(t){const i=jr(t,this);i!==void 0&&(D(this,Le,i),mt(this))}get center(){return I(this,Le)}get lonLatCenter(){return qr(this)}get lonLatExtent(){return Xr(this)}set zoom(t){t!==void 0&&(D(this,Ie,t),mt(this))}get zoom(){return I(this,Ie)}set zoomExtent(t){D(this,Ee,zr(t,this))}set controls(t){D(this,re,Kr(t,I(this,re),this))}get controls(){return I(this,re)}set layers(t){D(this,oe,Hr(t,I(this,oe),this))}get layers(){return I(this,oe)}set preventScroll(t){D(this,xe,Wr(t,this))}get preventScroll(){return I(this,xe)}set config(t){D(this,Pe,Br(t,this))}get config(){return I(this,Pe)}set animationOptions(t){D(this,Te,t)}get animationOptions(){return I(this,Te)}set projection(t){D(this,ae,Zr(t,I(this,ae),this))}get projection(){return I(this,ae)||"EPSG:3857"}set sync(t){D(this,Se,Yr(t,this))}get sync(){return I(this,Se)}addOrUpdateLayer(t){return $r(t,this)}removeInteraction(t){Jr(t,this)}removeSelect(t){Qr(t,this)}removeControl(t){eo(t,this)}getLayerById(t){return Pt(this,t)}firstUpdated(){to(I(this,Ee),this)}render(){return Y`
      <style>
        :host {
          display: block;
        }
        .eox-map-tooltip {
          pointer-events: none !important;
        }
        ${Hs}
        ${Ws}
      </style>
      <div style="width: 100%; height: 100%"></div>
      <slot></slot>
    `}}Ee=new WeakMap,re=new WeakMap,oe=new WeakMap,xe=new WeakMap,Pe=new WeakMap,Te=new WeakMap,Se=new WeakMap,Le=new WeakMap,Ie=new WeakMap,ae=new WeakMap;customElements.define("eox-map",io);export{io as EOxMap};
