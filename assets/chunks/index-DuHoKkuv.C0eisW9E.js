import"./main.B0MqJa3H.js";import"./index.BUfRP0w_.js";import{_ as me,x as _,u as ge,s as E,a as ee,o as xe,r as he,d as te,g as W,y as Ce,k as T,z as N,A as O,l as k,n as Se,B as we,v as Pe,t as Te,h as Ne,C as Oe,D as ae,E as Y,p as Le,F as re}from"./eo-dash.BDkEy2H5.js";import{i as Me}from"./easing-CH0-9wR8.CTB3jml5.js";import _e from"./EodashMapBtns-t3WvOiTJ.C6WCeAL5.js";import{h as L,ah as se,p as M,an as ne,v as oe,c as X,o as K,j as z,e as Q,k as r,N as D,G as ke,x as ue,q as Be}from"./framework.DIPWleRQ.js";import"./lit-element.Deg-YTNa.js";import"./WMTS.RT2X-Ydu.js";import"./Group.DfJ6KxFj.js";import"./extent.CajDHjk1.js";import"./GeoJSON.BZT5TuW2.js";import"./index.DK02avya.js";import"./getElement.CdRlZPdn.js";import"./addCommonStyleSheet.zOcQQLUh.js";import"./WKT.CT1EjoBW.js";import"./commonjsHelpers.BosuxZz1.js";import"./item.Bx-rtsOD.js";import"./ExportState-JWSJTHXu.BHCHCZot.js";import"./PopUp-a_wYB0jK.zc6DhEjy.js";import"./forwardRefs-CQyI7QaH.-lPFXI9w.js";import"./transition-BxmW4ILZ.tbxo-fXa.js";import"./VImg-TZmuaRoW.CWX-NjGe.js";import"./EodashItemFilter-BKzEWmOj.C9SrHbeJ.js";import"./handling-Ebi3ev5a.D1kkGDYS.js";import"./async-BDRX43ki.ByOL_3tK.js";import"./utils.DZj92Qv1.js";import"./index.BSpBAx16.js";import"./directive.CvdRHFdJ.js";import"./unsafe-html.BoorRBTK.js";import"./index.BUIxO2d3.js";const ie=async(e,o,c)=>{k.debug("Creating layers config",e,o,c);const t=[],s={type:"Group",properties:{id:"AnalysisGroup",title:"Data Layers",layerControlExpand:!0},layers:[]};for(const d of o){let a;if(c){const n=typeof c=="string"?new Date(c):c;a=await d.createLayersJson(n)}else a=await d.createLayersJson(void 0);a.forEach(n=>{n.properties.layerControlExpand=!0,n.properties.layerControlToolsExpand=!0}),s.layers.push(...a)}t.push(s);const f=await re.getIndicatorLayers(e),v=re.getObservationPointsLayer(o);v&&s.layers.unshift(v);const u={type:"Group",properties:{id:"BaseLayersGroup",title:"Base Layers"},layers:[]},b=f.filter(d=>d.properties.group==="baselayer");if(b.length){let d=0,a=0;for(let n=0;n<b.length;n++){const l=b[n];"visible"in l.properties||(l.properties.visible=!1),l.properties.visible&&(d++,a=n)}d===0&&(b[0].properties.visible=!0),d>0&&b.forEach((n,l)=>{l!==a?n.properties.visible=!1:n.properties.visible=!0}),u.layers.push(...b),u.layers.forEach(n=>{n.properties.layerControlExclusive=!0})}else u.layers.push({type:"Tile",properties:{id:"osm",title:"Background",layerControlExclusive:!0},source:{type:"OSM"}});u.layers.length&&t.push(u);const C={type:"Group",properties:{id:"OverlayGroup",title:"Overlay Layers"},layers:[]},m=f.filter(d=>d.properties.group==="overlay");return m.length&&(C.layers.push(...m),t.unshift(C)),t};let q=null;const Ie=(e,o)=>{const c=t=>{var u;const s=t.map,f=(u=e.value)==null?void 0:u.lonLatCenter,v=s==null?void 0:s.getView().getZoom();f&&!Number.isNaN(f[0])&&!Number.isNaN(f[1])&&!Number.isNaN(v)&&(o.value=[f[0],f[1],v])};oe(()=>{var t,s;(s=(t=e.value)==null?void 0:t.map)==null||s.on("moveend",c)}),ue(()=>{var t,s;(s=(t=e.value)==null?void 0:t.map)==null||s.un("moveend",c)})},le=(e,o,c,t,s,f,v,u)=>{k.debug("InitMap",e.value,o.value,c.values,t.value);const C=Be(u?[o,t,u]:[o,t],async(m,d)=>{var S,J,R,A,Z,V,U,F,G,i,p,x,y,I,h,j;const[a,n,l]=u?m:[m[0],m[1],null],[B,H,g]=u?d:[d[0],d[1],null];if(a){k.debug("Selected Indicator watch triggered",a,n),((S=e==null?void 0:e.value)==null?void 0:S.id)==="main"&&q!==null&&((J=e==null?void 0:e.value)==null||J.map.setView(q),q=null);let w=[];const de=(a==null?void 0:a.id)===(B==null?void 0:B.id)&&(n!==H||l&&(l==null?void 0:l.id)!==(g==null?void 0:g.id)),{selectedCompareStac:fe}=E(ee());if(((R=e==null?void 0:e.value)==null?void 0:R.id)==="main"?await Oe(a):fe.value!==null&&(q=((A=e==null?void 0:e.value)==null?void 0:A.map.getView())??null,e.value.sync=f.value),de){w=await ie(a,c,l??n),k.debug("Assigned layers after changing time only",JSON.parse(JSON.stringify(w))),s.value=w,ae(((Z=e.value)==null?void 0:Z.id)==="compare"?"compareTime:updated":"time:updated",e.value,w);return}let P=null;const $=(U=(V=a==null?void 0:a.extent)==null?void 0:V.temporal)==null?void 0:U.interval;if($&&$.length>0&&$[0].length>1&&(P=new Date($[0][1]),k.debug("Indicator load: found stac extent, setting time to latest value",P)),(!l&&P!==null&&P.toISOString()!==t.value&&!Y.value||Y.value&&!t.value&&P)&&(t.value=P.toISOString()),w=await ie(a,c,l??n),v&&!l&&((F=e==null?void 0:e.value)==null?void 0:F.id)==="main"&&(G=a.extent)!=null&&G.spatial.bbox&&!(Y.value&&((i=_.value)!=null&&i[0])&&((p=_.value)!=null&&p[1]))){const ve=(x=a.extent)==null?void 0:x.spatial.bbox[0],ye=Le([...ve]),be=(h=e.value)==null?void 0:h.transformExtent(ye,"EPSG:4326",(I=(y=e.value)==null?void 0:y.map)==null?void 0:I.getView().getProjection());e.value.zoomExtent=be}k.debug("Assigned layers",JSON.parse(JSON.stringify(w))),s.value=w,await ae(((j=e.value)==null?void 0:j.id)==="compare"?"compareLayers:updated":"layers:updated",e.value,s.value)}},{immediate:!0});ue(()=>{C()})},pe=(e,o)=>{Se(async(c,t)=>{if(c.includes("compare"))return;const s=[];for(const f of e)s.push(...await f.getToolTipProperties());o.value=s,k.debug("Updated tooltip properties",o.value)})},je="#cursor-coordinates[data-v-76f918a2]{position:fixed;left:24px;bottom:54px;color:#000000e6;font-size:11px;font-family:var(--eox-body-font-family);background:#fffe;border-radius:4px;border:none;padding:0 3px;max-height:24px}@media (max-width: 959px){#cursor-coordinates[data-v-76f918a2]{display:none}}#scale-line[data-v-76f918a2]{position:fixed;left:24px;bottom:28px;color:#fff}@media (max-width: 959px){#scale-line[data-v-76f918a2]{bottom:102px}}[data-v-76f918a2] .ol-scale-line{background:#fffe!important;border-radius:4px!important;border:none!important;padding:0 3px 3px!important;font-size:10px!important;font-family:var(--eox-body-font-family);max-height:20px}[data-v-76f918a2] .ol-scale-line-inner{display:flex;justify-content:center;border:1px solid rgba(0,0,0,.5)!important;border-top:none!important;color:#333!important;font-weight:500!important;transform:translateY(1px)}.map-buttons-container[data-v-76f918a2]{position:fixed;left:0;width:100%;height:100%;display:grid;grid-template-columns:repeat(12,1fr);grid-template-rows:repeat(12,1fr);pointer-events:none;z-index:1}.map-buttons-container[data-v-76f918a2]>*{pointer-events:auto}",ze=[".enabled"],Ve=[".center",".zoom",".layers",".controls"],Fe=[".propertyTransform"],Ge=[".layers"],Je=[".propertyTransform"],Re={key:0,id:"cursor-coordinates",ref:"cursor-coords"},Ae={key:1,id:"scale-line",ref:"scale-line"};var ce;const Ze={__name:"index",props:{enableCompare:{type:Boolean,default:!1},center:{type:Array,default:()=>{var e,o;return[((e=_.value)==null?void 0:e[0])??15,((o=_.value)==null?void 0:o[1])??48]}},zoom:{type:Number,default:((ce=_.value)==null?void 0:ce[2])??4},zoomToExtent:{type:Boolean,default:!0},enableCursorCoordinates:{type:Boolean,default:!0},enableScaleLine:{type:Boolean,default:!0},btnsPosition:{type:Object,default:()=>({x:"12/9/10",y:1,gap:16})},btns:{type:Object,default:()=>({enableExportMap:!0,enableChangeProjection:!0,enableCompareIndicators:!0,enableBackToPOIs:!0,enableSearch:!0,enableZoom:!0})}},setup(e){var G;const o=e,{width:c}=ge(),t=i=>{if(typeof i=="number")return i;if(typeof i=="string"){const p=i.split("/"),x=c.value;return x<960?parseInt(p[0])||1:x<1920?parseInt(p[1]||p[0])||1:parseInt(p[2]||p[1]||p[0])||1}return 1},s=L(()=>t(o.btnsPosition.x)),f=L(()=>t(o.btnsPosition.y)),v=L(()=>({exportMap:o.btns.enableExportMap??!0,changeProjection:o.btns.enableChangeProjection??!0,compareIndicators:o.btns.enableCompareIndicators??!0,backToPOIs:o.btns.enableBackToPOIs??!0,enableSearch:o.btns.enableSearch??!0,enableZoom:o.btns.enableZoom??!0})),u=se("scale-line"),b=se("cursor-coords"),C=M([]),m=M([]),d=L(()=>{const i={Attribution:{collapsible:!0}};return o.enableScaleLine&&u.value&&(i.ScaleLine={target:u.value}),o.enableCursorCoordinates&&b.value&&(i.MousePosition={projection:"EPSG:4326",coordinateFormat:p=>`${p[1].toFixed(3)} °N, ${p[0].toFixed(3)} °E`,target:b.value}),i}),a=ne(o.center),n=ne(((G=_.value)==null?void 0:G[2])??o.zoom),l=M([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),B=M([{type:"Tile",source:{type:"OSM"},properties:{id:"osm",title:"Background"}}]),H={duration:1200,easing:Me},g=M(null),S=M(null),{selectedCompareStac:J}=E(ee()),R=L(()=>o.enableCompare&&J.value?"":"first");Ie(g,_),oe(()=>{const{selectedCompareStac:i,selectedStac:p,selectedItem:x}=E(ee());xe.value=g.value,o.enableCompare&&(he.value=S.value),o.enableCompare&&(le(S,i,Ne,te,B,g,!1),pe(W,m)),le(g,p,W,te,l,S,o.zoomToExtent,x)}),pe(W,C);const A=L(()=>({visibility:C.value.length?"visible":"hidden"})),Z=L(()=>({visibility:m.value.length?"visible":"hidden"})),V=i=>{const p=i==="main"?C:m,x=i=="main"?Pe:Te;return y=>{const I=JSON.parse(we.render(JSON.stringify(p.value),{...x.value??{}})),h=I==null?void 0:I.find(j=>j.id===y.key);if(h){if(typeof y.value=="object"&&(y.value=JSON.stringify(y.value)),!isNaN(Number(y.value))){const j=isNaN(Number(h.decimals))?4:Number(h.decimals);y.value=Number(y.value).toFixed(j).toString()}return{key:h.title||h.id,value:y.value+" "+(h.appendix||"")}}}},{mainRect:U}=Ce(),F=M(0);return oe(()=>{const i=document.querySelector("eo-dash");F.value=(U.value.top||(i==null?void 0:i.getBoundingClientRect().top))??0}),(i,p)=>(K(),X("span",null,[z("eox-map-compare",{class:"fill-height fill-width overflow-none",".enabled":R.value},[z("eox-map",{class:"fill-height fill-width overflow-none",slot:"first",ref_key:"eoxMap",ref:g,id:"main",".animationOptions":H,".center":r(a),".zoom":r(n),".layers":l.value,".controls":d.value},[z("eox-map-tooltip",{style:D(A.value),".propertyTransform":V("main")},null,44,Fe)],40,Ve),z("eox-map",{class:"fill-height fill-width overflow-none",id:"compare",slot:"second",ref_key:"compareMap",ref:S,".layers":B.value},[z("eox-map-tooltip",{style:D(Z.value),".propertyTransform":V("compare")},null,44,Je)],40,Ge)],40,ze),e.enableCursorCoordinates?(K(),X("div",Re,null,512)):Q("v-if",!0),e.enableScaleLine?(K(),X("span",Ae,null,512)):Q("v-if",!0),z("div",{class:"map-buttons-container",style:D(`margin: ${e.btnsPosition.gap}px 0 ${e.btnsPosition.gap}px 0; top: ${F.value}px;`)},[Q(" prettier-ignore "),ke(_e,{style:D({gridColumn:r(T)||r(N)||r(O)?s.value:"12",gridRow:f.value}),exportMap:r(T)||r(N)||r(O)?v.value.exportMap:!1,changeProjection:r(T)||r(N)||r(O)?v.value.changeProjection:!1,compareIndicators:r(T)||r(N)||r(O)?v.value.compareIndicators:!1,backToPOIs:r(T)||r(N)||r(O)?v.value.backToPOIs:!1,enableSearch:r(T)||r(N)||r(O)?v.value.enableSearch:!1,enableZoom:r(T)||r(N)||r(O)?v.value.enableZoom:!1},null,8,["style","exportMap","changeProjection","compareIndicators","backToPOIs","enableSearch","enableZoom"])],4)]))}},ho=me(Ze,[["styles",[je]],["__scopeId","data-v-76f918a2"]]);export{ho as default};
