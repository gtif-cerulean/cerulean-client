import"./main.FvVIqQ42.js";import"./main.BRveyhr3.js";import"./main.D2OOEOJh.js";import{_ as F,s as R,a as q,r as z,o as G,H,k as M,E as U,bk as Q,V as I,bl as W,bm as X,n as Y,bn as Z,z as $,A as E}from"./eo-dash.Z_6i-lmK.js";import{c as ee,j as ae,P as oe}from"./ProcessList-BIN_Mb27.KANciklG.js";import te from"./EodashChart-5v7adDpG.B4N4tMuN.js";import{i as w,u as se,h as re}from"./handling-DSA67d6E.D69zxEMl.js";import{g as ne,f as ie,n as ce}from"./async-D6Lvv-fT.ChoiHGA6.js";import{p as m,ah as le,h as x,c as O,o as v,G as ue,e as y,b as k,j as pe,k as b,w as V,a as _,v as N,q as J,P as de}from"./framework.weLEZ_IP.js";import"./lit-element.L04JKUcP.js";import"./addCommonStyleSheet.B_D0kzpE.js";import"./sequential.BHUe01AH.js";import"./orient2d.DArCjZZA.js";import"./directive.CvdRHFdJ.js";import"./directive-helpers.ivFt-JzS.js";import"./when.BR7zwNJC.js";import"./getElement.CdRlZPdn.js";import"./GeoJSON.Bn398gYN.js";import"./extent.B6zYA2nd.js";import"./WKT.C5Hr-LXE.js";import"./browser.DKOFNV7U.js";import"./commonjsHelpers.BosuxZz1.js";import"./toolcool-range-slider.min.BBXDELo7.js";import"./utils.BMGuRnmn.js";import"./index.BSpBAx16.js";import"./index.BIJR-IiI.js";import"./item.Bx-rtsOD.js";import"./index-6LlXNkke.CTtZ7sOd.js";import"./VTooltip-Cc6au3Sn.DDWgbPpI.js";import"./forwardRefs--IccUBdR.Ca-boQzY.js";import"./transition-DFr4cXu8.DDLr5Y7i.js";const me=({selectedStac:o,jsonformEl:n,jsonformSchema:s,isProcessed:r,processResults:c,loading:l,isPolling:u,mapElement:e})=>{const i=X(Z);N(async()=>{((e==null?void 0:e.layers.length)??0)>1?await w({enableCompare:(e==null?void 0:e.id)==="compare",selectedStac:o,jsonformEl:n,jsonformSchema:s,isProcessed:r,processResults:c,loading:l,isPolling:u}):i.once(async()=>{await w({enableCompare:(e==null?void 0:e.id)==="compare",selectedStac:o,jsonformEl:n,jsonformSchema:s,isProcessed:r,loading:l,processResults:c,isPolling:u})})});const h=(e==null?void 0:e.id)==="compare"?"compareLayers:updated":"layers:updated";Y(async(p,C)=>{(p=="layertime:updated"||p=="compareLayertime:updated"||p=="time:updated"||p=="compareTime:updated")&&await se({jsonformSchema:s,newLayers:C}),p===h&&await w({enableCompare:(e==null?void 0:e.id)==="compare",selectedStac:o,jsonformEl:n,jsonformSchema:s,isProcessed:r,processResults:c,loading:l,isPolling:u})})};function ve(o,n,s,r){const c=async e=>{await r()},l=async()=>{await de(()=>{var e;(e=n.value)==null||e.addEventListener("change",c)})},u=()=>{var e;(e=n.value)==null||e.removeEventListener("change",c)};J(s,e=>{var i;o.value=((i=e==null?void 0:e.options)==null?void 0:i.execute)||!1}),N(()=>{J(o,async e=>{e?await l():u()},{immediate:!0})})}const fe="eox-jsonform{padding:.7em;min-height:0px}",ye={ref:"container",class:"py-1"},be=[".schema"],he={class:"mt-2 text-right"},Ce={__name:"index",props:{enableCompare:{type:Boolean,default:!1},vegaEmbedOptions:{type:Object,default(){return{actions:!0}}}},setup(o){const n=m(!1),s=m(null),r=le("jsonformEl"),c=x(()=>{var a;return(a=p.value)==null?void 0:a.links.filter(t=>t.endpoint==="eoxhub_workspaces").length}),l=m(!1),u=m(!1),e=m(!1),i=m([]),h=x(()=>!u.value&&!!s.value&&!!r.value),{selectedStac:p,selectedCompareStac:C}=R(q()),g=o.enableCompare?C:p,f=o.enableCompare?z:G,L=o.enableCompare?H:M,B=o.enableCompare?ee:ae,S=x(()=>{var a;return L.value+((a=f.value)==null?void 0:a.id)});me({selectedStac:g,mapElement:f.value,jsonformEl:r,jsonformSchema:s,isProcessed:n,processResults:i,loading:l,isPolling:e});const D=()=>{i.value.forEach(a=>{var d;if(!a)return;let t="";typeof a=="string"?(t=a.includes("/")?a.split("/").pop()??"":a,t=t.includes("?")?t.split("?")[0]:t):t=((d=g.value)==null?void 0:d.id)+"_process_results.json",ce(t,a)})},P=async()=>{var T,j,A;const a=ne(s.value);if(a&&Array.isArray((T=r.value)==null?void 0:T.value[a])&&!((j=r.value)!=null&&j.value[a].length)){n.value=!1;const K=o.enableCompare?$:E;K.value=null;return}const d=(A=r.value)==null?void 0:A.editor.validate();if(d!=null&&d.length){console.warn("[eodash] Form validation failed",d);return}i.value=[],await re({jobs:B,selectedStac:g,jsonformEl:r,jsonformSchema:s,loading:l,isPolling:e,processResults:i,mapElement:f.value}),n.value=!0,c.value&&ie(B,L.value)};return ve(u,r,s,P),(a,t)=>(v(),O("div",ye,[ue(oe,{"map-element":b(f),"enable-compare":o.enableCompare},null,8,["map-element","enable-compare"]),s.value?(v(),O("eox-jsonform",{key:S.value,ref_key:"jsonformEl",ref:r,".schema":s.value},null,40,be)):y("v-if",!0),b(U)?y("v-if",!0):(v(),k(te,{key:1,"vega-embed-options":o.vegaEmbedOptions,"enable-compare":o.enableCompare},null,8,["vega-embed-options","enable-compare"])),pe("div",he,[h.value?(v(),k(I,{key:0,loading:l.value,style:{"margin-right":"20px"},"append-icon":[b(Q)],onClick:P,color:"primary"},{default:V(()=>[...t[0]||(t[0]=[_(" Execute ",-1)])]),_:1},8,["loading","append-icon"])):y("v-if",!0),i.value.length&&n.value&&!c.value?(v(),k(I,{key:1,color:"primary","append-icon":[b(W)],onClick:D},{default:V(()=>[...t[1]||(t[1]=[_(" Download ",-1)])]),_:1},8,["append-icon"])):y("v-if",!0)])],512))}},Ze=F(Ce,[["styles",[fe]]]);export{Ze as default};
